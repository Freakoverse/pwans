function _mergeNamespaces(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in t)){const o=Object.getOwnPropertyDescriptor(n,s);o&&Object.defineProperty(t,s,o.get?o:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const scriptRel="modulepreload",assetsURL=function(t,e){return new URL(t,e).href},seen={},__vitePreload=function(e,r,n){let s=Promise.resolve();if(r&&r.length>0){let x=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};const c=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),f=u?.nonce||u?.getAttribute("nonce");s=x(r.map(p=>{if(p=assetsURL(p,n),p in seen)return;seen[p]=!0;const g=p.endsWith(".css"),y=g?'[rel="stylesheet"]':"";if(n)for(let R=c.length-1;R>=0;R--){const D=c[R];if(D.href===p&&(!g||D.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${y}`))return;const b=document.createElement("link");if(b.rel=g?"stylesheet":scriptRel,g||(b.as="script"),b.crossOrigin="",b.href=p,f&&b.setAttribute("nonce",f),document.head.appendChild(b),g)return new Promise((R,D)=>{b.addEventListener("load",R),b.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return s.then(c=>{for(const u of c||[])u.status==="rejected"&&o(u.reason);return e().catch(o)})};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function getAugmentedNamespace(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var r=function n(){var s=!1;try{s=this instanceof n}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var s=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return t[n]}})}),r}var jsxRuntime={exports:{}},reactJsxRuntime_production={};var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function r(n,s,o){var c=null;if(o!==void 0&&(c=""+o),s.key!==void 0&&(c=""+s.key),"key"in s){o={};for(var u in s)u!=="key"&&(o[u]=s[u])}else o=s;return s=o.ref,{$$typeof:t,type:n,key:c,ref:s!==void 0?s:null,props:o}}return reactJsxRuntime_production.Fragment=e,reactJsxRuntime_production.jsx=r,reactJsxRuntime_production.jsxs=r,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i$2=0,len=code.length;i$2<len;++i$2)lookup[i$2]=code[i$2],revLookup[code.charCodeAt(i$2)]=i$2;revLookup[45]=62;revLookup[95]=63;function getLens(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function byteLength(t){var e=getLens(t),r=e[0],n=e[1];return(r+n)*3/4-n}function _byteLength(t,e,r){return(e+r)*3/4-r}function toByteArray(t){var e,r=getLens(t),n=r[0],s=r[1],o=new Arr(_byteLength(t,n,s)),c=0,u=s>0?n-4:n,f;for(f=0;f<u;f+=4)e=revLookup[t.charCodeAt(f)]<<18|revLookup[t.charCodeAt(f+1)]<<12|revLookup[t.charCodeAt(f+2)]<<6|revLookup[t.charCodeAt(f+3)],o[c++]=e>>16&255,o[c++]=e>>8&255,o[c++]=e&255;return s===2&&(e=revLookup[t.charCodeAt(f)]<<2|revLookup[t.charCodeAt(f+1)]>>4,o[c++]=e&255),s===1&&(e=revLookup[t.charCodeAt(f)]<<10|revLookup[t.charCodeAt(f+1)]<<4|revLookup[t.charCodeAt(f+2)]>>2,o[c++]=e>>8&255,o[c++]=e&255),o}function tripletToBase64(t){return lookup[t>>18&63]+lookup[t>>12&63]+lookup[t>>6&63]+lookup[t&63]}function encodeChunk(t,e,r){for(var n,s=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(t[o+2]&255),s.push(tripletToBase64(n));return s.join("")}function fromByteArray(t){for(var e,r=t.length,n=r%3,s=[],o=16383,c=0,u=r-n;c<u;c+=o)s.push(encodeChunk(t,c,c+o>u?u:c+o));return n===1?(e=t[r-1],s.push(lookup[e>>2]+lookup[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],s.push(lookup[e>>10]+lookup[e>>4&63]+lookup[e<<2&63]+"=")),s.join("")}var ieee754={};ieee754.read=function(t,e,r,n,s){var o,c,u=s*8-n-1,f=(1<<u)-1,x=f>>1,p=-7,g=r?s-1:0,y=r?-1:1,b=t[e+g];for(g+=y,o=b&(1<<-p)-1,b>>=-p,p+=u;p>0;o=o*256+t[e+g],g+=y,p-=8);for(c=o&(1<<-p)-1,o>>=-p,p+=n;p>0;c=c*256+t[e+g],g+=y,p-=8);if(o===0)o=1-x;else{if(o===f)return c?NaN:(b?-1:1)*(1/0);c=c+Math.pow(2,n),o=o-x}return(b?-1:1)*c*Math.pow(2,o-n)};ieee754.write=function(t,e,r,n,s,o){var c,u,f,x=o*8-s-1,p=(1<<x)-1,g=p>>1,y=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=n?0:o-1,R=n?1:-1,D=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,c=p):(c=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-c))<1&&(c--,f*=2),c+g>=1?e+=y/f:e+=y*Math.pow(2,1-g),e*f>=2&&(c++,f/=2),c+g>=p?(u=0,c=p):c+g>=1?(u=(e*f-1)*Math.pow(2,s),c=c+g):(u=e*Math.pow(2,g-1)*Math.pow(2,s),c=0));s>=8;t[r+b]=u&255,b+=R,u/=256,s-=8);for(c=c<<s|u,x+=s;x>0;t[r+b]=c&255,b+=R,c/=256,x-=8);t[r+b-R]|=D*128};(function(t){const e=base64Js,r=ieee754,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=p,t.SlowBuffer=ze,t.INSPECT_MAX_BYTES=50;const s=2147483647;t.kMaxLength=s;const{Uint8Array:o,ArrayBuffer:c,SharedArrayBuffer:u}=globalThis;p.TYPED_ARRAY_SUPPORT=f(),!p.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function f(){try{const ht=new o(1),Qe={foo:function(){return 42}};return Object.setPrototypeOf(Qe,o.prototype),Object.setPrototypeOf(ht,Qe),ht.foo()===42}catch{return!1}}Object.defineProperty(p.prototype,"parent",{enumerable:!0,get:function(){if(p.isBuffer(this))return this.buffer}}),Object.defineProperty(p.prototype,"offset",{enumerable:!0,get:function(){if(p.isBuffer(this))return this.byteOffset}});function x(ht){if(ht>s)throw new RangeError('The value "'+ht+'" is invalid for option "size"');const Qe=new o(ht);return Object.setPrototypeOf(Qe,p.prototype),Qe}function p(ht,Qe,lt){if(typeof ht=="number"){if(typeof Qe=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return R(ht)}return g(ht,Qe,lt)}p.poolSize=8192;function g(ht,Qe,lt){if(typeof ht=="string")return D(ht,Qe);if(c.isView(ht))return Re(ht);if(ht==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ht);if(tr(ht,c)||ht&&tr(ht.buffer,c)||typeof u<"u"&&(tr(ht,u)||ht&&tr(ht.buffer,u)))return Fe(ht,Qe,lt);if(typeof ht=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const ar=ht.valueOf&&ht.valueOf();if(ar!=null&&ar!==ht)return p.from(ar,Qe,lt);const br=O(ht);if(br)return br;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof ht[Symbol.toPrimitive]=="function")return p.from(ht[Symbol.toPrimitive]("string"),Qe,lt);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ht)}p.from=function(ht,Qe,lt){return g(ht,Qe,lt)},Object.setPrototypeOf(p.prototype,o.prototype),Object.setPrototypeOf(p,o);function y(ht){if(typeof ht!="number")throw new TypeError('"size" argument must be of type number');if(ht<0)throw new RangeError('The value "'+ht+'" is invalid for option "size"')}function b(ht,Qe,lt){return y(ht),ht<=0?x(ht):Qe!==void 0?typeof lt=="string"?x(ht).fill(Qe,lt):x(ht).fill(Qe):x(ht)}p.alloc=function(ht,Qe,lt){return b(ht,Qe,lt)};function R(ht){return y(ht),x(ht<0?0:$e(ht)|0)}p.allocUnsafe=function(ht){return R(ht)},p.allocUnsafeSlow=function(ht){return R(ht)};function D(ht,Qe){if((typeof Qe!="string"||Qe==="")&&(Qe="utf8"),!p.isEncoding(Qe))throw new TypeError("Unknown encoding: "+Qe);const lt=q(ht,Qe)|0;let ar=x(lt);const br=ar.write(ht,Qe);return br!==lt&&(ar=ar.slice(0,br)),ar}function k(ht){const Qe=ht.length<0?0:$e(ht.length)|0,lt=x(Qe);for(let ar=0;ar<Qe;ar+=1)lt[ar]=ht[ar]&255;return lt}function Re(ht){if(tr(ht,o)){const Qe=new o(ht);return Fe(Qe.buffer,Qe.byteOffset,Qe.byteLength)}return k(ht)}function Fe(ht,Qe,lt){if(Qe<0||ht.byteLength<Qe)throw new RangeError('"offset" is outside of buffer bounds');if(ht.byteLength<Qe+(lt||0))throw new RangeError('"length" is outside of buffer bounds');let ar;return Qe===void 0&&lt===void 0?ar=new o(ht):lt===void 0?ar=new o(ht,Qe):ar=new o(ht,Qe,lt),Object.setPrototypeOf(ar,p.prototype),ar}function O(ht){if(p.isBuffer(ht)){const Qe=$e(ht.length)|0,lt=x(Qe);return lt.length===0||ht.copy(lt,0,0,Qe),lt}if(ht.length!==void 0)return typeof ht.length!="number"||yr(ht.length)?x(0):k(ht);if(ht.type==="Buffer"&&Array.isArray(ht.data))return k(ht.data)}function $e(ht){if(ht>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return ht|0}function ze(ht){return+ht!=ht&&(ht=0),p.alloc(+ht)}p.isBuffer=function(Qe){return Qe!=null&&Qe._isBuffer===!0&&Qe!==p.prototype},p.compare=function(Qe,lt){if(tr(Qe,o)&&(Qe=p.from(Qe,Qe.offset,Qe.byteLength)),tr(lt,o)&&(lt=p.from(lt,lt.offset,lt.byteLength)),!p.isBuffer(Qe)||!p.isBuffer(lt))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(Qe===lt)return 0;let ar=Qe.length,br=lt.length;for(let Sr=0,Rr=Math.min(ar,br);Sr<Rr;++Sr)if(Qe[Sr]!==lt[Sr]){ar=Qe[Sr],br=lt[Sr];break}return ar<br?-1:br<ar?1:0},p.isEncoding=function(Qe){switch(String(Qe).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},p.concat=function(Qe,lt){if(!Array.isArray(Qe))throw new TypeError('"list" argument must be an Array of Buffers');if(Qe.length===0)return p.alloc(0);let ar;if(lt===void 0)for(lt=0,ar=0;ar<Qe.length;++ar)lt+=Qe[ar].length;const br=p.allocUnsafe(lt);let Sr=0;for(ar=0;ar<Qe.length;++ar){let Rr=Qe[ar];if(tr(Rr,o))Sr+Rr.length>br.length?(p.isBuffer(Rr)||(Rr=p.from(Rr)),Rr.copy(br,Sr)):o.prototype.set.call(br,Rr,Sr);else if(p.isBuffer(Rr))Rr.copy(br,Sr);else throw new TypeError('"list" argument must be an Array of Buffers');Sr+=Rr.length}return br};function q(ht,Qe){if(p.isBuffer(ht))return ht.length;if(c.isView(ht)||tr(ht,c))return ht.byteLength;if(typeof ht!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof ht);const lt=ht.length,ar=arguments.length>2&&arguments[2]===!0;if(!ar&&lt===0)return 0;let br=!1;for(;;)switch(Qe){case"ascii":case"latin1":case"binary":return lt;case"utf8":case"utf-8":return Cr(ht).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return lt*2;case"hex":return lt>>>1;case"base64":return Nr(ht).length;default:if(br)return ar?-1:Cr(ht).length;Qe=(""+Qe).toLowerCase(),br=!0}}p.byteLength=q;function W(ht,Qe,lt){let ar=!1;if((Qe===void 0||Qe<0)&&(Qe=0),Qe>this.length||((lt===void 0||lt>this.length)&&(lt=this.length),lt<=0)||(lt>>>=0,Qe>>>=0,lt<=Qe))return"";for(ht||(ht="utf8");;)switch(ht){case"hex":return st(this,Qe,lt);case"utf8":case"utf-8":return Le(this,Qe,lt);case"ascii":return K(this,Qe,lt);case"latin1":case"binary":return L(this,Qe,lt);case"base64":return _e(this,Qe,lt);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return dt(this,Qe,lt);default:if(ar)throw new TypeError("Unknown encoding: "+ht);ht=(ht+"").toLowerCase(),ar=!0}}p.prototype._isBuffer=!0;function We(ht,Qe,lt){const ar=ht[Qe];ht[Qe]=ht[lt],ht[lt]=ar}p.prototype.swap16=function(){const Qe=this.length;if(Qe%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let lt=0;lt<Qe;lt+=2)We(this,lt,lt+1);return this},p.prototype.swap32=function(){const Qe=this.length;if(Qe%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let lt=0;lt<Qe;lt+=4)We(this,lt,lt+3),We(this,lt+1,lt+2);return this},p.prototype.swap64=function(){const Qe=this.length;if(Qe%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let lt=0;lt<Qe;lt+=8)We(this,lt,lt+7),We(this,lt+1,lt+6),We(this,lt+2,lt+5),We(this,lt+3,lt+4);return this},p.prototype.toString=function(){const Qe=this.length;return Qe===0?"":arguments.length===0?Le(this,0,Qe):W.apply(this,arguments)},p.prototype.toLocaleString=p.prototype.toString,p.prototype.equals=function(Qe){if(!p.isBuffer(Qe))throw new TypeError("Argument must be a Buffer");return this===Qe?!0:p.compare(this,Qe)===0},p.prototype.inspect=function(){let Qe="";const lt=t.INSPECT_MAX_BYTES;return Qe=this.toString("hex",0,lt).replace(/(.{2})/g,"$1 ").trim(),this.length>lt&&(Qe+=" ... "),"<Buffer "+Qe+">"},n&&(p.prototype[n]=p.prototype.inspect),p.prototype.compare=function(Qe,lt,ar,br,Sr){if(tr(Qe,o)&&(Qe=p.from(Qe,Qe.offset,Qe.byteLength)),!p.isBuffer(Qe))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof Qe);if(lt===void 0&&(lt=0),ar===void 0&&(ar=Qe?Qe.length:0),br===void 0&&(br=0),Sr===void 0&&(Sr=this.length),lt<0||ar>Qe.length||br<0||Sr>this.length)throw new RangeError("out of range index");if(br>=Sr&&lt>=ar)return 0;if(br>=Sr)return-1;if(lt>=ar)return 1;if(lt>>>=0,ar>>>=0,br>>>=0,Sr>>>=0,this===Qe)return 0;let Rr=Sr-br,Lr=ar-lt;const Gr=Math.min(Rr,Lr),zr=this.slice(br,Sr),Vr=Qe.slice(lt,ar);for(let Zr=0;Zr<Gr;++Zr)if(zr[Zr]!==Vr[Zr]){Rr=zr[Zr],Lr=Vr[Zr];break}return Rr<Lr?-1:Lr<Rr?1:0};function Xe(ht,Qe,lt,ar,br){if(ht.length===0)return-1;if(typeof lt=="string"?(ar=lt,lt=0):lt>2147483647?lt=2147483647:lt<-2147483648&&(lt=-2147483648),lt=+lt,yr(lt)&&(lt=br?0:ht.length-1),lt<0&&(lt=ht.length+lt),lt>=ht.length){if(br)return-1;lt=ht.length-1}else if(lt<0)if(br)lt=0;else return-1;if(typeof Qe=="string"&&(Qe=p.from(Qe,ar)),p.isBuffer(Qe))return Qe.length===0?-1:it(ht,Qe,lt,ar,br);if(typeof Qe=="number")return Qe=Qe&255,typeof o.prototype.indexOf=="function"?br?o.prototype.indexOf.call(ht,Qe,lt):o.prototype.lastIndexOf.call(ht,Qe,lt):it(ht,[Qe],lt,ar,br);throw new TypeError("val must be string, number or Buffer")}function it(ht,Qe,lt,ar,br){let Sr=1,Rr=ht.length,Lr=Qe.length;if(ar!==void 0&&(ar=String(ar).toLowerCase(),ar==="ucs2"||ar==="ucs-2"||ar==="utf16le"||ar==="utf-16le")){if(ht.length<2||Qe.length<2)return-1;Sr=2,Rr/=2,Lr/=2,lt/=2}function Gr(Vr,Zr){return Sr===1?Vr[Zr]:Vr.readUInt16BE(Zr*Sr)}let zr;if(br){let Vr=-1;for(zr=lt;zr<Rr;zr++)if(Gr(ht,zr)===Gr(Qe,Vr===-1?0:zr-Vr)){if(Vr===-1&&(Vr=zr),zr-Vr+1===Lr)return Vr*Sr}else Vr!==-1&&(zr-=zr-Vr),Vr=-1}else for(lt+Lr>Rr&&(lt=Rr-Lr),zr=lt;zr>=0;zr--){let Vr=!0;for(let Zr=0;Zr<Lr;Zr++)if(Gr(ht,zr+Zr)!==Gr(Qe,Zr)){Vr=!1;break}if(Vr)return zr}return-1}p.prototype.includes=function(Qe,lt,ar){return this.indexOf(Qe,lt,ar)!==-1},p.prototype.indexOf=function(Qe,lt,ar){return Xe(this,Qe,lt,ar,!0)},p.prototype.lastIndexOf=function(Qe,lt,ar){return Xe(this,Qe,lt,ar,!1)};function Ve(ht,Qe,lt,ar){lt=Number(lt)||0;const br=ht.length-lt;ar?(ar=Number(ar),ar>br&&(ar=br)):ar=br;const Sr=Qe.length;ar>Sr/2&&(ar=Sr/2);let Rr;for(Rr=0;Rr<ar;++Rr){const Lr=parseInt(Qe.substr(Rr*2,2),16);if(yr(Lr))return Rr;ht[lt+Rr]=Lr}return Rr}function v(ht,Qe,lt,ar){return or(Cr(Qe,ht.length-lt),ht,lt,ar)}function I(ht,Qe,lt,ar){return or(_r(Qe),ht,lt,ar)}function Ce(ht,Qe,lt,ar){return or(Nr(Qe),ht,lt,ar)}function P(ht,Qe,lt,ar){return or(Tr(Qe,ht.length-lt),ht,lt,ar)}p.prototype.write=function(Qe,lt,ar,br){if(lt===void 0)br="utf8",ar=this.length,lt=0;else if(ar===void 0&&typeof lt=="string")br=lt,ar=this.length,lt=0;else if(isFinite(lt))lt=lt>>>0,isFinite(ar)?(ar=ar>>>0,br===void 0&&(br="utf8")):(br=ar,ar=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Sr=this.length-lt;if((ar===void 0||ar>Sr)&&(ar=Sr),Qe.length>0&&(ar<0||lt<0)||lt>this.length)throw new RangeError("Attempt to write outside buffer bounds");br||(br="utf8");let Rr=!1;for(;;)switch(br){case"hex":return Ve(this,Qe,lt,ar);case"utf8":case"utf-8":return v(this,Qe,lt,ar);case"ascii":case"latin1":case"binary":return I(this,Qe,lt,ar);case"base64":return Ce(this,Qe,lt,ar);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,Qe,lt,ar);default:if(Rr)throw new TypeError("Unknown encoding: "+br);br=(""+br).toLowerCase(),Rr=!0}},p.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function _e(ht,Qe,lt){return Qe===0&&lt===ht.length?e.fromByteArray(ht):e.fromByteArray(ht.slice(Qe,lt))}function Le(ht,Qe,lt){lt=Math.min(ht.length,lt);const ar=[];let br=Qe;for(;br<lt;){const Sr=ht[br];let Rr=null,Lr=Sr>239?4:Sr>223?3:Sr>191?2:1;if(br+Lr<=lt){let Gr,zr,Vr,Zr;switch(Lr){case 1:Sr<128&&(Rr=Sr);break;case 2:Gr=ht[br+1],(Gr&192)===128&&(Zr=(Sr&31)<<6|Gr&63,Zr>127&&(Rr=Zr));break;case 3:Gr=ht[br+1],zr=ht[br+2],(Gr&192)===128&&(zr&192)===128&&(Zr=(Sr&15)<<12|(Gr&63)<<6|zr&63,Zr>2047&&(Zr<55296||Zr>57343)&&(Rr=Zr));break;case 4:Gr=ht[br+1],zr=ht[br+2],Vr=ht[br+3],(Gr&192)===128&&(zr&192)===128&&(Vr&192)===128&&(Zr=(Sr&15)<<18|(Gr&63)<<12|(zr&63)<<6|Vr&63,Zr>65535&&Zr<1114112&&(Rr=Zr))}}Rr===null?(Rr=65533,Lr=1):Rr>65535&&(Rr-=65536,ar.push(Rr>>>10&1023|55296),Rr=56320|Rr&1023),ar.push(Rr),br+=Lr}return je(ar)}const Ye=4096;function je(ht){const Qe=ht.length;if(Qe<=Ye)return String.fromCharCode.apply(String,ht);let lt="",ar=0;for(;ar<Qe;)lt+=String.fromCharCode.apply(String,ht.slice(ar,ar+=Ye));return lt}function K(ht,Qe,lt){let ar="";lt=Math.min(ht.length,lt);for(let br=Qe;br<lt;++br)ar+=String.fromCharCode(ht[br]&127);return ar}function L(ht,Qe,lt){let ar="";lt=Math.min(ht.length,lt);for(let br=Qe;br<lt;++br)ar+=String.fromCharCode(ht[br]);return ar}function st(ht,Qe,lt){const ar=ht.length;(!Qe||Qe<0)&&(Qe=0),(!lt||lt<0||lt>ar)&&(lt=ar);let br="";for(let Sr=Qe;Sr<lt;++Sr)br+=mr[ht[Sr]];return br}function dt(ht,Qe,lt){const ar=ht.slice(Qe,lt);let br="";for(let Sr=0;Sr<ar.length-1;Sr+=2)br+=String.fromCharCode(ar[Sr]+ar[Sr+1]*256);return br}p.prototype.slice=function(Qe,lt){const ar=this.length;Qe=~~Qe,lt=lt===void 0?ar:~~lt,Qe<0?(Qe+=ar,Qe<0&&(Qe=0)):Qe>ar&&(Qe=ar),lt<0?(lt+=ar,lt<0&&(lt=0)):lt>ar&&(lt=ar),lt<Qe&&(lt=Qe);const br=this.subarray(Qe,lt);return Object.setPrototypeOf(br,p.prototype),br};function Je(ht,Qe,lt){if(ht%1!==0||ht<0)throw new RangeError("offset is not uint");if(ht+Qe>lt)throw new RangeError("Trying to access beyond buffer length")}p.prototype.readUintLE=p.prototype.readUIntLE=function(Qe,lt,ar){Qe=Qe>>>0,lt=lt>>>0,ar||Je(Qe,lt,this.length);let br=this[Qe],Sr=1,Rr=0;for(;++Rr<lt&&(Sr*=256);)br+=this[Qe+Rr]*Sr;return br},p.prototype.readUintBE=p.prototype.readUIntBE=function(Qe,lt,ar){Qe=Qe>>>0,lt=lt>>>0,ar||Je(Qe,lt,this.length);let br=this[Qe+--lt],Sr=1;for(;lt>0&&(Sr*=256);)br+=this[Qe+--lt]*Sr;return br},p.prototype.readUint8=p.prototype.readUInt8=function(Qe,lt){return Qe=Qe>>>0,lt||Je(Qe,1,this.length),this[Qe]},p.prototype.readUint16LE=p.prototype.readUInt16LE=function(Qe,lt){return Qe=Qe>>>0,lt||Je(Qe,2,this.length),this[Qe]|this[Qe+1]<<8},p.prototype.readUint16BE=p.prototype.readUInt16BE=function(Qe,lt){return Qe=Qe>>>0,lt||Je(Qe,2,this.length),this[Qe]<<8|this[Qe+1]},p.prototype.readUint32LE=p.prototype.readUInt32LE=function(Qe,lt){return Qe=Qe>>>0,lt||Je(Qe,4,this.length),(this[Qe]|this[Qe+1]<<8|this[Qe+2]<<16)+this[Qe+3]*16777216},p.prototype.readUint32BE=p.prototype.readUInt32BE=function(Qe,lt){return Qe=Qe>>>0,lt||Je(Qe,4,this.length),this[Qe]*16777216+(this[Qe+1]<<16|this[Qe+2]<<8|this[Qe+3])},p.prototype.readBigUInt64LE=sr(function(Qe){Qe=Qe>>>0,xr(Qe,"offset");const lt=this[Qe],ar=this[Qe+7];(lt===void 0||ar===void 0)&&wr(Qe,this.length-8);const br=lt+this[++Qe]*2**8+this[++Qe]*2**16+this[++Qe]*2**24,Sr=this[++Qe]+this[++Qe]*2**8+this[++Qe]*2**16+ar*2**24;return BigInt(br)+(BigInt(Sr)<<BigInt(32))}),p.prototype.readBigUInt64BE=sr(function(Qe){Qe=Qe>>>0,xr(Qe,"offset");const lt=this[Qe],ar=this[Qe+7];(lt===void 0||ar===void 0)&&wr(Qe,this.length-8);const br=lt*2**24+this[++Qe]*2**16+this[++Qe]*2**8+this[++Qe],Sr=this[++Qe]*2**24+this[++Qe]*2**16+this[++Qe]*2**8+ar;return(BigInt(br)<<BigInt(32))+BigInt(Sr)}),p.prototype.readIntLE=function(Qe,lt,ar){Qe=Qe>>>0,lt=lt>>>0,ar||Je(Qe,lt,this.length);let br=this[Qe],Sr=1,Rr=0;for(;++Rr<lt&&(Sr*=256);)br+=this[Qe+Rr]*Sr;return Sr*=128,br>=Sr&&(br-=Math.pow(2,8*lt)),br},p.prototype.readIntBE=function(Qe,lt,ar){Qe=Qe>>>0,lt=lt>>>0,ar||Je(Qe,lt,this.length);let br=lt,Sr=1,Rr=this[Qe+--br];for(;br>0&&(Sr*=256);)Rr+=this[Qe+--br]*Sr;return Sr*=128,Rr>=Sr&&(Rr-=Math.pow(2,8*lt)),Rr},p.prototype.readInt8=function(Qe,lt){return Qe=Qe>>>0,lt||Je(Qe,1,this.length),this[Qe]&128?(255-this[Qe]+1)*-1:this[Qe]},p.prototype.readInt16LE=function(Qe,lt){Qe=Qe>>>0,lt||Je(Qe,2,this.length);const ar=this[Qe]|this[Qe+1]<<8;return ar&32768?ar|4294901760:ar},p.prototype.readInt16BE=function(Qe,lt){Qe=Qe>>>0,lt||Je(Qe,2,this.length);const ar=this[Qe+1]|this[Qe]<<8;return ar&32768?ar|4294901760:ar},p.prototype.readInt32LE=function(Qe,lt){return Qe=Qe>>>0,lt||Je(Qe,4,this.length),this[Qe]|this[Qe+1]<<8|this[Qe+2]<<16|this[Qe+3]<<24},p.prototype.readInt32BE=function(Qe,lt){return Qe=Qe>>>0,lt||Je(Qe,4,this.length),this[Qe]<<24|this[Qe+1]<<16|this[Qe+2]<<8|this[Qe+3]},p.prototype.readBigInt64LE=sr(function(Qe){Qe=Qe>>>0,xr(Qe,"offset");const lt=this[Qe],ar=this[Qe+7];(lt===void 0||ar===void 0)&&wr(Qe,this.length-8);const br=this[Qe+4]+this[Qe+5]*2**8+this[Qe+6]*2**16+(ar<<24);return(BigInt(br)<<BigInt(32))+BigInt(lt+this[++Qe]*2**8+this[++Qe]*2**16+this[++Qe]*2**24)}),p.prototype.readBigInt64BE=sr(function(Qe){Qe=Qe>>>0,xr(Qe,"offset");const lt=this[Qe],ar=this[Qe+7];(lt===void 0||ar===void 0)&&wr(Qe,this.length-8);const br=(lt<<24)+this[++Qe]*2**16+this[++Qe]*2**8+this[++Qe];return(BigInt(br)<<BigInt(32))+BigInt(this[++Qe]*2**24+this[++Qe]*2**16+this[++Qe]*2**8+ar)}),p.prototype.readFloatLE=function(Qe,lt){return Qe=Qe>>>0,lt||Je(Qe,4,this.length),r.read(this,Qe,!0,23,4)},p.prototype.readFloatBE=function(Qe,lt){return Qe=Qe>>>0,lt||Je(Qe,4,this.length),r.read(this,Qe,!1,23,4)},p.prototype.readDoubleLE=function(Qe,lt){return Qe=Qe>>>0,lt||Je(Qe,8,this.length),r.read(this,Qe,!0,52,8)},p.prototype.readDoubleBE=function(Qe,lt){return Qe=Qe>>>0,lt||Je(Qe,8,this.length),r.read(this,Qe,!1,52,8)};function pt(ht,Qe,lt,ar,br,Sr){if(!p.isBuffer(ht))throw new TypeError('"buffer" argument must be a Buffer instance');if(Qe>br||Qe<Sr)throw new RangeError('"value" argument is out of bounds');if(lt+ar>ht.length)throw new RangeError("Index out of range")}p.prototype.writeUintLE=p.prototype.writeUIntLE=function(Qe,lt,ar,br){if(Qe=+Qe,lt=lt>>>0,ar=ar>>>0,!br){const Lr=Math.pow(2,8*ar)-1;pt(this,Qe,lt,ar,Lr,0)}let Sr=1,Rr=0;for(this[lt]=Qe&255;++Rr<ar&&(Sr*=256);)this[lt+Rr]=Qe/Sr&255;return lt+ar},p.prototype.writeUintBE=p.prototype.writeUIntBE=function(Qe,lt,ar,br){if(Qe=+Qe,lt=lt>>>0,ar=ar>>>0,!br){const Lr=Math.pow(2,8*ar)-1;pt(this,Qe,lt,ar,Lr,0)}let Sr=ar-1,Rr=1;for(this[lt+Sr]=Qe&255;--Sr>=0&&(Rr*=256);)this[lt+Sr]=Qe/Rr&255;return lt+ar},p.prototype.writeUint8=p.prototype.writeUInt8=function(Qe,lt,ar){return Qe=+Qe,lt=lt>>>0,ar||pt(this,Qe,lt,1,255,0),this[lt]=Qe&255,lt+1},p.prototype.writeUint16LE=p.prototype.writeUInt16LE=function(Qe,lt,ar){return Qe=+Qe,lt=lt>>>0,ar||pt(this,Qe,lt,2,65535,0),this[lt]=Qe&255,this[lt+1]=Qe>>>8,lt+2},p.prototype.writeUint16BE=p.prototype.writeUInt16BE=function(Qe,lt,ar){return Qe=+Qe,lt=lt>>>0,ar||pt(this,Qe,lt,2,65535,0),this[lt]=Qe>>>8,this[lt+1]=Qe&255,lt+2},p.prototype.writeUint32LE=p.prototype.writeUInt32LE=function(Qe,lt,ar){return Qe=+Qe,lt=lt>>>0,ar||pt(this,Qe,lt,4,4294967295,0),this[lt+3]=Qe>>>24,this[lt+2]=Qe>>>16,this[lt+1]=Qe>>>8,this[lt]=Qe&255,lt+4},p.prototype.writeUint32BE=p.prototype.writeUInt32BE=function(Qe,lt,ar){return Qe=+Qe,lt=lt>>>0,ar||pt(this,Qe,lt,4,4294967295,0),this[lt]=Qe>>>24,this[lt+1]=Qe>>>16,this[lt+2]=Qe>>>8,this[lt+3]=Qe&255,lt+4};function rr(ht,Qe,lt,ar,br){Er(Qe,ar,br,ht,lt,7);let Sr=Number(Qe&BigInt(4294967295));ht[lt++]=Sr,Sr=Sr>>8,ht[lt++]=Sr,Sr=Sr>>8,ht[lt++]=Sr,Sr=Sr>>8,ht[lt++]=Sr;let Rr=Number(Qe>>BigInt(32)&BigInt(4294967295));return ht[lt++]=Rr,Rr=Rr>>8,ht[lt++]=Rr,Rr=Rr>>8,ht[lt++]=Rr,Rr=Rr>>8,ht[lt++]=Rr,lt}function cr(ht,Qe,lt,ar,br){Er(Qe,ar,br,ht,lt,7);let Sr=Number(Qe&BigInt(4294967295));ht[lt+7]=Sr,Sr=Sr>>8,ht[lt+6]=Sr,Sr=Sr>>8,ht[lt+5]=Sr,Sr=Sr>>8,ht[lt+4]=Sr;let Rr=Number(Qe>>BigInt(32)&BigInt(4294967295));return ht[lt+3]=Rr,Rr=Rr>>8,ht[lt+2]=Rr,Rr=Rr>>8,ht[lt+1]=Rr,Rr=Rr>>8,ht[lt]=Rr,lt+8}p.prototype.writeBigUInt64LE=sr(function(Qe,lt=0){return rr(this,Qe,lt,BigInt(0),BigInt("0xffffffffffffffff"))}),p.prototype.writeBigUInt64BE=sr(function(Qe,lt=0){return cr(this,Qe,lt,BigInt(0),BigInt("0xffffffffffffffff"))}),p.prototype.writeIntLE=function(Qe,lt,ar,br){if(Qe=+Qe,lt=lt>>>0,!br){const Gr=Math.pow(2,8*ar-1);pt(this,Qe,lt,ar,Gr-1,-Gr)}let Sr=0,Rr=1,Lr=0;for(this[lt]=Qe&255;++Sr<ar&&(Rr*=256);)Qe<0&&Lr===0&&this[lt+Sr-1]!==0&&(Lr=1),this[lt+Sr]=(Qe/Rr>>0)-Lr&255;return lt+ar},p.prototype.writeIntBE=function(Qe,lt,ar,br){if(Qe=+Qe,lt=lt>>>0,!br){const Gr=Math.pow(2,8*ar-1);pt(this,Qe,lt,ar,Gr-1,-Gr)}let Sr=ar-1,Rr=1,Lr=0;for(this[lt+Sr]=Qe&255;--Sr>=0&&(Rr*=256);)Qe<0&&Lr===0&&this[lt+Sr+1]!==0&&(Lr=1),this[lt+Sr]=(Qe/Rr>>0)-Lr&255;return lt+ar},p.prototype.writeInt8=function(Qe,lt,ar){return Qe=+Qe,lt=lt>>>0,ar||pt(this,Qe,lt,1,127,-128),Qe<0&&(Qe=255+Qe+1),this[lt]=Qe&255,lt+1},p.prototype.writeInt16LE=function(Qe,lt,ar){return Qe=+Qe,lt=lt>>>0,ar||pt(this,Qe,lt,2,32767,-32768),this[lt]=Qe&255,this[lt+1]=Qe>>>8,lt+2},p.prototype.writeInt16BE=function(Qe,lt,ar){return Qe=+Qe,lt=lt>>>0,ar||pt(this,Qe,lt,2,32767,-32768),this[lt]=Qe>>>8,this[lt+1]=Qe&255,lt+2},p.prototype.writeInt32LE=function(Qe,lt,ar){return Qe=+Qe,lt=lt>>>0,ar||pt(this,Qe,lt,4,2147483647,-2147483648),this[lt]=Qe&255,this[lt+1]=Qe>>>8,this[lt+2]=Qe>>>16,this[lt+3]=Qe>>>24,lt+4},p.prototype.writeInt32BE=function(Qe,lt,ar){return Qe=+Qe,lt=lt>>>0,ar||pt(this,Qe,lt,4,2147483647,-2147483648),Qe<0&&(Qe=4294967295+Qe+1),this[lt]=Qe>>>24,this[lt+1]=Qe>>>16,this[lt+2]=Qe>>>8,this[lt+3]=Qe&255,lt+4},p.prototype.writeBigInt64LE=sr(function(Qe,lt=0){return rr(this,Qe,lt,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),p.prototype.writeBigInt64BE=sr(function(Qe,lt=0){return cr(this,Qe,lt,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function fr(ht,Qe,lt,ar,br,Sr){if(lt+ar>ht.length)throw new RangeError("Index out of range");if(lt<0)throw new RangeError("Index out of range")}function ir(ht,Qe,lt,ar,br){return Qe=+Qe,lt=lt>>>0,br||fr(ht,Qe,lt,4),r.write(ht,Qe,lt,ar,23,4),lt+4}p.prototype.writeFloatLE=function(Qe,lt,ar){return ir(this,Qe,lt,!0,ar)},p.prototype.writeFloatBE=function(Qe,lt,ar){return ir(this,Qe,lt,!1,ar)};function ft(ht,Qe,lt,ar,br){return Qe=+Qe,lt=lt>>>0,br||fr(ht,Qe,lt,8),r.write(ht,Qe,lt,ar,52,8),lt+8}p.prototype.writeDoubleLE=function(Qe,lt,ar){return ft(this,Qe,lt,!0,ar)},p.prototype.writeDoubleBE=function(Qe,lt,ar){return ft(this,Qe,lt,!1,ar)},p.prototype.copy=function(Qe,lt,ar,br){if(!p.isBuffer(Qe))throw new TypeError("argument should be a Buffer");if(ar||(ar=0),!br&&br!==0&&(br=this.length),lt>=Qe.length&&(lt=Qe.length),lt||(lt=0),br>0&&br<ar&&(br=ar),br===ar||Qe.length===0||this.length===0)return 0;if(lt<0)throw new RangeError("targetStart out of bounds");if(ar<0||ar>=this.length)throw new RangeError("Index out of range");if(br<0)throw new RangeError("sourceEnd out of bounds");br>this.length&&(br=this.length),Qe.length-lt<br-ar&&(br=Qe.length-lt+ar);const Sr=br-ar;return this===Qe&&typeof o.prototype.copyWithin=="function"?this.copyWithin(lt,ar,br):o.prototype.set.call(Qe,this.subarray(ar,br),lt),Sr},p.prototype.fill=function(Qe,lt,ar,br){if(typeof Qe=="string"){if(typeof lt=="string"?(br=lt,lt=0,ar=this.length):typeof ar=="string"&&(br=ar,ar=this.length),br!==void 0&&typeof br!="string")throw new TypeError("encoding must be a string");if(typeof br=="string"&&!p.isEncoding(br))throw new TypeError("Unknown encoding: "+br);if(Qe.length===1){const Rr=Qe.charCodeAt(0);(br==="utf8"&&Rr<128||br==="latin1")&&(Qe=Rr)}}else typeof Qe=="number"?Qe=Qe&255:typeof Qe=="boolean"&&(Qe=Number(Qe));if(lt<0||this.length<lt||this.length<ar)throw new RangeError("Out of range index");if(ar<=lt)return this;lt=lt>>>0,ar=ar===void 0?this.length:ar>>>0,Qe||(Qe=0);let Sr;if(typeof Qe=="number")for(Sr=lt;Sr<ar;++Sr)this[Sr]=Qe;else{const Rr=p.isBuffer(Qe)?Qe:p.from(Qe,br),Lr=Rr.length;if(Lr===0)throw new TypeError('The value "'+Qe+'" is invalid for argument "value"');for(Sr=0;Sr<ar-lt;++Sr)this[Sr+lt]=Rr[Sr%Lr]}return this};const nr={};function lr(ht,Qe,lt){nr[ht]=class extends lt{constructor(){super(),Object.defineProperty(this,"message",{value:Qe.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${ht}]`,this.stack,delete this.name}get code(){return ht}set code(br){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:br,writable:!0})}toString(){return`${this.name} [${ht}]: ${this.message}`}}}lr("ERR_BUFFER_OUT_OF_BOUNDS",function(ht){return ht?`${ht} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),lr("ERR_INVALID_ARG_TYPE",function(ht,Qe){return`The "${ht}" argument must be of type number. Received type ${typeof Qe}`},TypeError),lr("ERR_OUT_OF_RANGE",function(ht,Qe,lt){let ar=`The value of "${ht}" is out of range.`,br=lt;return Number.isInteger(lt)&&Math.abs(lt)>2**32?br=er(String(lt)):typeof lt=="bigint"&&(br=String(lt),(lt>BigInt(2)**BigInt(32)||lt<-(BigInt(2)**BigInt(32)))&&(br=er(br)),br+="n"),ar+=` It must be ${Qe}. Received ${br}`,ar},RangeError);function er(ht){let Qe="",lt=ht.length;const ar=ht[0]==="-"?1:0;for(;lt>=ar+4;lt-=3)Qe=`_${ht.slice(lt-3,lt)}${Qe}`;return`${ht.slice(0,lt)}${Qe}`}function pr(ht,Qe,lt){xr(Qe,"offset"),(ht[Qe]===void 0||ht[Qe+lt]===void 0)&&wr(Qe,ht.length-(lt+1))}function Er(ht,Qe,lt,ar,br,Sr){if(ht>lt||ht<Qe){const Rr=typeof Qe=="bigint"?"n":"";let Lr;throw Qe===0||Qe===BigInt(0)?Lr=`>= 0${Rr} and < 2${Rr} ** ${(Sr+1)*8}${Rr}`:Lr=`>= -(2${Rr} ** ${(Sr+1)*8-1}${Rr}) and < 2 ** ${(Sr+1)*8-1}${Rr}`,new nr.ERR_OUT_OF_RANGE("value",Lr,ht)}pr(ar,br,Sr)}function xr(ht,Qe){if(typeof ht!="number")throw new nr.ERR_INVALID_ARG_TYPE(Qe,"number",ht)}function wr(ht,Qe,lt){throw Math.floor(ht)!==ht?(xr(ht,lt),new nr.ERR_OUT_OF_RANGE("offset","an integer",ht)):Qe<0?new nr.ERR_BUFFER_OUT_OF_BOUNDS:new nr.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${Qe}`,ht)}const Br=/[^+/0-9A-Za-z-_]/g;function hr(ht){if(ht=ht.split("=")[0],ht=ht.trim().replace(Br,""),ht.length<2)return"";for(;ht.length%4!==0;)ht=ht+"=";return ht}function Cr(ht,Qe){Qe=Qe||1/0;let lt;const ar=ht.length;let br=null;const Sr=[];for(let Rr=0;Rr<ar;++Rr){if(lt=ht.charCodeAt(Rr),lt>55295&&lt<57344){if(!br){if(lt>56319){(Qe-=3)>-1&&Sr.push(239,191,189);continue}else if(Rr+1===ar){(Qe-=3)>-1&&Sr.push(239,191,189);continue}br=lt;continue}if(lt<56320){(Qe-=3)>-1&&Sr.push(239,191,189),br=lt;continue}lt=(br-55296<<10|lt-56320)+65536}else br&&(Qe-=3)>-1&&Sr.push(239,191,189);if(br=null,lt<128){if((Qe-=1)<0)break;Sr.push(lt)}else if(lt<2048){if((Qe-=2)<0)break;Sr.push(lt>>6|192,lt&63|128)}else if(lt<65536){if((Qe-=3)<0)break;Sr.push(lt>>12|224,lt>>6&63|128,lt&63|128)}else if(lt<1114112){if((Qe-=4)<0)break;Sr.push(lt>>18|240,lt>>12&63|128,lt>>6&63|128,lt&63|128)}else throw new Error("Invalid code point")}return Sr}function _r(ht){const Qe=[];for(let lt=0;lt<ht.length;++lt)Qe.push(ht.charCodeAt(lt)&255);return Qe}function Tr(ht,Qe){let lt,ar,br;const Sr=[];for(let Rr=0;Rr<ht.length&&!((Qe-=2)<0);++Rr)lt=ht.charCodeAt(Rr),ar=lt>>8,br=lt%256,Sr.push(br),Sr.push(ar);return Sr}function Nr(ht){return e.toByteArray(hr(ht))}function or(ht,Qe,lt,ar){let br;for(br=0;br<ar&&!(br+lt>=Qe.length||br>=ht.length);++br)Qe[br+lt]=ht[br];return br}function tr(ht,Qe){return ht instanceof Qe||ht!=null&&ht.constructor!=null&&ht.constructor.name!=null&&ht.constructor.name===Qe.name}function yr(ht){return ht!==ht}const mr=(function(){const ht="0123456789abcdef",Qe=new Array(256);for(let lt=0;lt<16;++lt){const ar=lt*16;for(let br=0;br<16;++br)Qe[ar+br]=ht[lt]+ht[br]}return Qe})();function sr(ht){return typeof BigInt>"u"?Ar:ht}function Ar(){throw new Error("BigInt not supported")}})(buffer);const Buffer=buffer.Buffer,Buffer$1=buffer.Buffer;globalThis.Buffer=Buffer$1;var client={exports:{}};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var browser$2={exports:{}},process=browser$2.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout(t){if(cachedSetTimeout===setTimeout)return setTimeout(t,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(t,0);try{return cachedSetTimeout(t,0)}catch{try{return cachedSetTimeout.call(null,t,0)}catch{return cachedSetTimeout.call(this,t,0)}}}function runClearTimeout(t){if(cachedClearTimeout===clearTimeout)return clearTimeout(t);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(t);try{return cachedClearTimeout(t)}catch{try{return cachedClearTimeout.call(null,t)}catch{return cachedClearTimeout.call(this,t)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var t=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout(t)}}process.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];queue.push(new Item(t,e)),queue.length===1&&!draining&&runTimeout(drainQueue)};function Item(t,e){this.fun=t,this.array=e}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=!0;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(t){return[]};process.binding=function(t){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(t){throw new Error("process.chdir is not supported")};process.umask=function(){return 0};var browserExports$2=browser$2.exports;const process$1=getDefaultExportFromCjs(browserExports$2);var reactDomClient_production={},scheduler={exports:{}},scheduler_production={};var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,(function(t){function e(_e,Le){var Ye=_e.length;_e.push(Le);e:for(;0<Ye;){var je=Ye-1>>>1,K=_e[je];if(0<s(K,Le))_e[je]=Le,_e[Ye]=K,Ye=je;else break e}}function r(_e){return _e.length===0?null:_e[0]}function n(_e){if(_e.length===0)return null;var Le=_e[0],Ye=_e.pop();if(Ye!==Le){_e[0]=Ye;e:for(var je=0,K=_e.length,L=K>>>1;je<L;){var st=2*(je+1)-1,dt=_e[st],Je=st+1,pt=_e[Je];if(0>s(dt,Ye))Je<K&&0>s(pt,dt)?(_e[je]=pt,_e[Je]=Ye,je=Je):(_e[je]=dt,_e[st]=Ye,je=st);else if(Je<K&&0>s(pt,Ye))_e[je]=pt,_e[Je]=Ye,je=Je;else break e}}return Le}function s(_e,Le){var Ye=_e.sortIndex-Le.sortIndex;return Ye!==0?Ye:_e.id-Le.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var c=Date,u=c.now();t.unstable_now=function(){return c.now()-u}}var f=[],x=[],p=1,g=null,y=3,b=!1,R=!1,D=!1,k=!1,Re=typeof setTimeout=="function"?setTimeout:null,Fe=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function $e(_e){for(var Le=r(x);Le!==null;){if(Le.callback===null)n(x);else if(Le.startTime<=_e)n(x),Le.sortIndex=Le.expirationTime,e(f,Le);else break;Le=r(x)}}function ze(_e){if(D=!1,$e(_e),!R)if(r(f)!==null)R=!0,q||(q=!0,v());else{var Le=r(x);Le!==null&&P(ze,Le.startTime-_e)}}var q=!1,W=-1,We=5,Xe=-1;function it(){return k?!0:!(t.unstable_now()-Xe<We)}function Ve(){if(k=!1,q){var _e=t.unstable_now();Xe=_e;var Le=!0;try{e:{R=!1,D&&(D=!1,Fe(W),W=-1),b=!0;var Ye=y;try{t:{for($e(_e),g=r(f);g!==null&&!(g.expirationTime>_e&&it());){var je=g.callback;if(typeof je=="function"){g.callback=null,y=g.priorityLevel;var K=je(g.expirationTime<=_e);if(_e=t.unstable_now(),typeof K=="function"){g.callback=K,$e(_e),Le=!0;break t}g===r(f)&&n(f),$e(_e)}else n(f);g=r(f)}if(g!==null)Le=!0;else{var L=r(x);L!==null&&P(ze,L.startTime-_e),Le=!1}}break e}finally{g=null,y=Ye,b=!1}Le=void 0}}finally{Le?v():q=!1}}}var v;if(typeof O=="function")v=function(){O(Ve)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,Ce=I.port2;I.port1.onmessage=Ve,v=function(){Ce.postMessage(null)}}else v=function(){Re(Ve,0)};function P(_e,Le){W=Re(function(){_e(t.unstable_now())},Le)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(_e){_e.callback=null},t.unstable_forceFrameRate=function(_e){0>_e||125<_e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):We=0<_e?Math.floor(1e3/_e):5},t.unstable_getCurrentPriorityLevel=function(){return y},t.unstable_next=function(_e){switch(y){case 1:case 2:case 3:var Le=3;break;default:Le=y}var Ye=y;y=Le;try{return _e()}finally{y=Ye}},t.unstable_requestPaint=function(){k=!0},t.unstable_runWithPriority=function(_e,Le){switch(_e){case 1:case 2:case 3:case 4:case 5:break;default:_e=3}var Ye=y;y=_e;try{return Le()}finally{y=Ye}},t.unstable_scheduleCallback=function(_e,Le,Ye){var je=t.unstable_now();switch(typeof Ye=="object"&&Ye!==null?(Ye=Ye.delay,Ye=typeof Ye=="number"&&0<Ye?je+Ye:je):Ye=je,_e){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=Ye+K,_e={id:p++,callback:Le,priorityLevel:_e,startTime:Ye,expirationTime:K,sortIndex:-1},Ye>je?(_e.sortIndex=Ye,e(x,_e),r(f)===null&&_e===r(x)&&(D?(Fe(W),W=-1):D=!0,P(ze,Ye-je))):(_e.sortIndex=K,e(f,_e),R||b||(R=!0,q||(q=!0,v()))),_e},t.unstable_shouldYield=it,t.unstable_wrapCallback=function(_e){var Le=y;return function(){var Ye=y;y=Le;try{return _e.apply(this,arguments)}finally{y=Ye}}}})(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var react={exports:{}},react_production={},hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),y=Symbol.iterator;function b(L){return L===null||typeof L!="object"?null:(L=y&&L[y]||L["@@iterator"],typeof L=="function"?L:null)}var R={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},D=Object.assign,k={};function Re(L,st,dt){this.props=L,this.context=st,this.refs=k,this.updater=dt||R}Re.prototype.isReactComponent={},Re.prototype.setState=function(L,st){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,st,"setState")},Re.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};function Fe(){}Fe.prototype=Re.prototype;function O(L,st,dt){this.props=L,this.context=st,this.refs=k,this.updater=dt||R}var $e=O.prototype=new Fe;$e.constructor=O,D($e,Re.prototype),$e.isPureReactComponent=!0;var ze=Array.isArray;function q(){}var W={H:null,A:null,T:null,S:null},We=Object.prototype.hasOwnProperty;function Xe(L,st,dt){var Je=dt.ref;return{$$typeof:t,type:L,key:st,ref:Je!==void 0?Je:null,props:dt}}function it(L,st){return Xe(L.type,st,L.props)}function Ve(L){return typeof L=="object"&&L!==null&&L.$$typeof===t}function v(L){var st={"=":"=0",":":"=2"};return"$"+L.replace(/[=:]/g,function(dt){return st[dt]})}var I=/\/+/g;function Ce(L,st){return typeof L=="object"&&L!==null&&L.key!=null?v(""+L.key):st.toString(36)}function P(L){switch(L.status){case"fulfilled":return L.value;case"rejected":throw L.reason;default:switch(typeof L.status=="string"?L.then(q,q):(L.status="pending",L.then(function(st){L.status==="pending"&&(L.status="fulfilled",L.value=st)},function(st){L.status==="pending"&&(L.status="rejected",L.reason=st)})),L.status){case"fulfilled":return L.value;case"rejected":throw L.reason}}throw L}function _e(L,st,dt,Je,pt){var rr=typeof L;(rr==="undefined"||rr==="boolean")&&(L=null);var cr=!1;if(L===null)cr=!0;else switch(rr){case"bigint":case"string":case"number":cr=!0;break;case"object":switch(L.$$typeof){case t:case e:cr=!0;break;case p:return cr=L._init,_e(cr(L._payload),st,dt,Je,pt)}}if(cr)return pt=pt(L),cr=Je===""?"."+Ce(L,0):Je,ze(pt)?(dt="",cr!=null&&(dt=cr.replace(I,"$&/")+"/"),_e(pt,st,dt,"",function(ft){return ft})):pt!=null&&(Ve(pt)&&(pt=it(pt,dt+(pt.key==null||L&&L.key===pt.key?"":(""+pt.key).replace(I,"$&/")+"/")+cr)),st.push(pt)),1;cr=0;var fr=Je===""?".":Je+":";if(ze(L))for(var ir=0;ir<L.length;ir++)Je=L[ir],rr=fr+Ce(Je,ir),cr+=_e(Je,st,dt,rr,pt);else if(ir=b(L),typeof ir=="function")for(L=ir.call(L),ir=0;!(Je=L.next()).done;)Je=Je.value,rr=fr+Ce(Je,ir++),cr+=_e(Je,st,dt,rr,pt);else if(rr==="object"){if(typeof L.then=="function")return _e(P(L),st,dt,Je,pt);throw st=String(L),Error("Objects are not valid as a React child (found: "+(st==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":st)+"). If you meant to render a collection of children, use an array instead.")}return cr}function Le(L,st,dt){if(L==null)return L;var Je=[],pt=0;return _e(L,Je,"","",function(rr){return st.call(dt,rr,pt++)}),Je}function Ye(L){if(L._status===-1){var st=L._result;st=st(),st.then(function(dt){(L._status===0||L._status===-1)&&(L._status=1,L._result=dt)},function(dt){(L._status===0||L._status===-1)&&(L._status=2,L._result=dt)}),L._status===-1&&(L._status=0,L._result=st)}if(L._status===1)return L._result.default;throw L._result}var je=typeof reportError=="function"?reportError:function(L){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var st=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof L=="object"&&L!==null&&typeof L.message=="string"?String(L.message):String(L),error:L});if(!window.dispatchEvent(st))return}else if(typeof process$1=="object"&&typeof process$1.emit=="function"){process$1.emit("uncaughtException",L);return}console.error(L)},K={map:Le,forEach:function(L,st,dt){Le(L,function(){st.apply(this,arguments)},dt)},count:function(L){var st=0;return Le(L,function(){st++}),st},toArray:function(L){return Le(L,function(st){return st})||[]},only:function(L){if(!Ve(L))throw Error("React.Children.only expected to receive a single React element child.");return L}};return react_production.Activity=g,react_production.Children=K,react_production.Component=Re,react_production.Fragment=r,react_production.Profiler=s,react_production.PureComponent=O,react_production.StrictMode=n,react_production.Suspense=f,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=W,react_production.__COMPILER_RUNTIME={__proto__:null,c:function(L){return W.H.useMemoCache(L)}},react_production.cache=function(L){return function(){return L.apply(null,arguments)}},react_production.cacheSignal=function(){return null},react_production.cloneElement=function(L,st,dt){if(L==null)throw Error("The argument must be a React element, but you passed "+L+".");var Je=D({},L.props),pt=L.key;if(st!=null)for(rr in st.key!==void 0&&(pt=""+st.key),st)!We.call(st,rr)||rr==="key"||rr==="__self"||rr==="__source"||rr==="ref"&&st.ref===void 0||(Je[rr]=st[rr]);var rr=arguments.length-2;if(rr===1)Je.children=dt;else if(1<rr){for(var cr=Array(rr),fr=0;fr<rr;fr++)cr[fr]=arguments[fr+2];Je.children=cr}return Xe(L.type,pt,Je)},react_production.createContext=function(L){return L={$$typeof:c,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null},L.Provider=L,L.Consumer={$$typeof:o,_context:L},L},react_production.createElement=function(L,st,dt){var Je,pt={},rr=null;if(st!=null)for(Je in st.key!==void 0&&(rr=""+st.key),st)We.call(st,Je)&&Je!=="key"&&Je!=="__self"&&Je!=="__source"&&(pt[Je]=st[Je]);var cr=arguments.length-2;if(cr===1)pt.children=dt;else if(1<cr){for(var fr=Array(cr),ir=0;ir<cr;ir++)fr[ir]=arguments[ir+2];pt.children=fr}if(L&&L.defaultProps)for(Je in cr=L.defaultProps,cr)pt[Je]===void 0&&(pt[Je]=cr[Je]);return Xe(L,rr,pt)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(L){return{$$typeof:u,render:L}},react_production.isValidElement=Ve,react_production.lazy=function(L){return{$$typeof:p,_payload:{_status:-1,_result:L},_init:Ye}},react_production.memo=function(L,st){return{$$typeof:x,type:L,compare:st===void 0?null:st}},react_production.startTransition=function(L){var st=W.T,dt={};W.T=dt;try{var Je=L(),pt=W.S;pt!==null&&pt(dt,Je),typeof Je=="object"&&Je!==null&&typeof Je.then=="function"&&Je.then(q,je)}catch(rr){je(rr)}finally{st!==null&&dt.types!==null&&(st.types=dt.types),W.T=st}},react_production.unstable_useCacheRefresh=function(){return W.H.useCacheRefresh()},react_production.use=function(L){return W.H.use(L)},react_production.useActionState=function(L,st,dt){return W.H.useActionState(L,st,dt)},react_production.useCallback=function(L,st){return W.H.useCallback(L,st)},react_production.useContext=function(L){return W.H.useContext(L)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(L,st){return W.H.useDeferredValue(L,st)},react_production.useEffect=function(L,st){return W.H.useEffect(L,st)},react_production.useEffectEvent=function(L){return W.H.useEffectEvent(L)},react_production.useId=function(){return W.H.useId()},react_production.useImperativeHandle=function(L,st,dt){return W.H.useImperativeHandle(L,st,dt)},react_production.useInsertionEffect=function(L,st){return W.H.useInsertionEffect(L,st)},react_production.useLayoutEffect=function(L,st){return W.H.useLayoutEffect(L,st)},react_production.useMemo=function(L,st){return W.H.useMemo(L,st)},react_production.useOptimistic=function(L,st){return W.H.useOptimistic(L,st)},react_production.useReducer=function(L,st,dt){return W.H.useReducer(L,st,dt)},react_production.useRef=function(L){return W.H.useRef(L)},react_production.useState=function(L){return W.H.useState(L)},react_production.useSyncExternalStore=function(L,st,dt){return W.H.useSyncExternalStore(L,st,dt)},react_production.useTransition=function(){return W.H.useTransition()},react_production.version="19.2.3",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactDom={exports:{}},reactDom_production={};var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var t=requireReact();function e(f){var x="https://react.dev/errors/"+f;if(1<arguments.length){x+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)x+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+f+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var n={d:{f:r,r:function(){throw Error(e(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(f,x,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:g==null?null:""+g,children:f,containerInfo:x,implementation:p}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(f,x){if(f==="font")return"";if(typeof x=="string")return x==="use-credentials"?x:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,reactDom_production.createPortal=function(f,x){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!x||x.nodeType!==1&&x.nodeType!==9&&x.nodeType!==11)throw Error(e(299));return o(f,x,null,p)},reactDom_production.flushSync=function(f){var x=c.T,p=n.p;try{if(c.T=null,n.p=2,f)return f()}finally{c.T=x,n.p=p,n.d.f()}},reactDom_production.preconnect=function(f,x){typeof f=="string"&&(x?(x=x.crossOrigin,x=typeof x=="string"?x==="use-credentials"?x:"":void 0):x=null,n.d.C(f,x))},reactDom_production.prefetchDNS=function(f){typeof f=="string"&&n.d.D(f)},reactDom_production.preinit=function(f,x){if(typeof f=="string"&&x&&typeof x.as=="string"){var p=x.as,g=u(p,x.crossOrigin),y=typeof x.integrity=="string"?x.integrity:void 0,b=typeof x.fetchPriority=="string"?x.fetchPriority:void 0;p==="style"?n.d.S(f,typeof x.precedence=="string"?x.precedence:void 0,{crossOrigin:g,integrity:y,fetchPriority:b}):p==="script"&&n.d.X(f,{crossOrigin:g,integrity:y,fetchPriority:b,nonce:typeof x.nonce=="string"?x.nonce:void 0})}},reactDom_production.preinitModule=function(f,x){if(typeof f=="string")if(typeof x=="object"&&x!==null){if(x.as==null||x.as==="script"){var p=u(x.as,x.crossOrigin);n.d.M(f,{crossOrigin:p,integrity:typeof x.integrity=="string"?x.integrity:void 0,nonce:typeof x.nonce=="string"?x.nonce:void 0})}}else x==null&&n.d.M(f)},reactDom_production.preload=function(f,x){if(typeof f=="string"&&typeof x=="object"&&x!==null&&typeof x.as=="string"){var p=x.as,g=u(p,x.crossOrigin);n.d.L(f,p,{crossOrigin:g,integrity:typeof x.integrity=="string"?x.integrity:void 0,nonce:typeof x.nonce=="string"?x.nonce:void 0,type:typeof x.type=="string"?x.type:void 0,fetchPriority:typeof x.fetchPriority=="string"?x.fetchPriority:void 0,referrerPolicy:typeof x.referrerPolicy=="string"?x.referrerPolicy:void 0,imageSrcSet:typeof x.imageSrcSet=="string"?x.imageSrcSet:void 0,imageSizes:typeof x.imageSizes=="string"?x.imageSizes:void 0,media:typeof x.media=="string"?x.media:void 0})}},reactDom_production.preloadModule=function(f,x){if(typeof f=="string")if(x){var p=u(x.as,x.crossOrigin);n.d.m(f,{as:typeof x.as=="string"&&x.as!=="script"?x.as:void 0,crossOrigin:p,integrity:typeof x.integrity=="string"?x.integrity:void 0})}else n.d.m(f)},reactDom_production.requestFormReset=function(f){n.d.r(f)},reactDom_production.unstable_batchedUpdates=function(f,x){return f(x)},reactDom_production.useFormState=function(f,x,p){return c.H.useFormState(f,x,p)},reactDom_production.useFormStatus=function(){return c.H.useHostTransitionStatus()},reactDom_production.version="19.2.3",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),reactDom.exports=requireReactDom_production(),reactDom.exports}var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var t=requireScheduler(),e=requireReact(),r=requireReactDom();function n(a){var l="https://react.dev/errors/"+a;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)l+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function o(a){var l=a,m=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(m=l.return),a=l.return;while(a)}return l.tag===3?m:null}function c(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function u(a){if(a.tag===31){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function f(a){if(o(a)!==a)throw Error(n(188))}function x(a){var l=a.alternate;if(!l){if(l=o(a),l===null)throw Error(n(188));return l!==a?null:a}for(var m=a,w=l;;){var Se=m.return;if(Se===null)break;var Ge=Se.alternate;if(Ge===null){if(w=Se.return,w!==null){m=w;continue}break}if(Se.child===Ge.child){for(Ge=Se.child;Ge;){if(Ge===m)return f(Se),a;if(Ge===w)return f(Se),l;Ge=Ge.sibling}throw Error(n(188))}if(m.return!==w.return)m=Se,w=Ge;else{for(var Ot=!1,gr=Se.child;gr;){if(gr===m){Ot=!0,m=Se,w=Ge;break}if(gr===w){Ot=!0,w=Se,m=Ge;break}gr=gr.sibling}if(!Ot){for(gr=Ge.child;gr;){if(gr===m){Ot=!0,m=Ge,w=Se;break}if(gr===w){Ot=!0,w=Ge,m=Se;break}gr=gr.sibling}if(!Ot)throw Error(n(189))}}if(m.alternate!==w)throw Error(n(190))}if(m.tag!==3)throw Error(n(188));return m.stateNode.current===m?a:l}function p(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a;for(a=a.child;a!==null;){if(l=p(a),l!==null)return l;a=a.sibling}return null}var g=Object.assign,y=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),R=Symbol.for("react.portal"),D=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),Re=Symbol.for("react.profiler"),Fe=Symbol.for("react.consumer"),O=Symbol.for("react.context"),$e=Symbol.for("react.forward_ref"),ze=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),W=Symbol.for("react.memo"),We=Symbol.for("react.lazy"),Xe=Symbol.for("react.activity"),it=Symbol.for("react.memo_cache_sentinel"),Ve=Symbol.iterator;function v(a){return a===null||typeof a!="object"?null:(a=Ve&&a[Ve]||a["@@iterator"],typeof a=="function"?a:null)}var I=Symbol.for("react.client.reference");function Ce(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===I?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case D:return"Fragment";case Re:return"Profiler";case k:return"StrictMode";case ze:return"Suspense";case q:return"SuspenseList";case Xe:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case R:return"Portal";case O:return a.displayName||"Context";case Fe:return(a._context.displayName||"Context")+".Consumer";case $e:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case W:return l=a.displayName||null,l!==null?l:Ce(a.type)||"Memo";case We:l=a._payload,a=a._init;try{return Ce(a(l))}catch{}}return null}var P=Array.isArray,_e=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Le=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ye={pending:!1,data:null,method:null,action:null},je=[],K=-1;function L(a){return{current:a}}function st(a){0>K||(a.current=je[K],je[K]=null,K--)}function dt(a,l){K++,je[K]=a.current,a.current=l}var Je=L(null),pt=L(null),rr=L(null),cr=L(null);function fr(a,l){switch(dt(rr,l),dt(pt,a),dt(Je,null),l.nodeType){case 9:case 11:a=(a=l.documentElement)&&(a=a.namespaceURI)?Zd(a):0;break;default:if(a=l.tagName,l=l.namespaceURI)l=Zd(l),a=Qd(l,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}st(Je),dt(Je,a)}function ir(){st(Je),st(pt),st(rr)}function ft(a){a.memoizedState!==null&&dt(cr,a);var l=Je.current,m=Qd(l,a.type);l!==m&&(dt(pt,a),dt(Je,m))}function nr(a){pt.current===a&&(st(Je),st(pt)),cr.current===a&&(st(cr),ma._currentValue=Ye)}var lr,er;function pr(a){if(lr===void 0)try{throw Error()}catch(m){var l=m.stack.trim().match(/\n( *(at )?)/);lr=l&&l[1]||"",er=-1<m.stack.indexOf(`
    at`)?" (<anonymous>)":-1<m.stack.indexOf("@")?"@unknown:0:0":""}return`
`+lr+a+er}var Er=!1;function xr(a,l){if(!a||Er)return"";Er=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var w={DetermineComponentFrameRoot:function(){try{if(l){var Kr=function(){throw Error()};if(Object.defineProperty(Kr.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Kr,[])}catch(Ur){var Pr=Ur}Reflect.construct(a,[],Kr)}else{try{Kr.call()}catch(Ur){Pr=Ur}a.call(Kr.prototype)}}else{try{throw Error()}catch(Ur){Pr=Ur}(Kr=a())&&typeof Kr.catch=="function"&&Kr.catch(function(){})}}catch(Ur){if(Ur&&Pr&&typeof Ur.stack=="string")return[Ur.stack,Pr.stack]}return[null,null]}};w.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var Se=Object.getOwnPropertyDescriptor(w.DetermineComponentFrameRoot,"name");Se&&Se.configurable&&Object.defineProperty(w.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var Ge=w.DetermineComponentFrameRoot(),Ot=Ge[0],gr=Ge[1];if(Ot&&gr){var kr=Ot.split(`
`),Ir=gr.split(`
`);for(Se=w=0;w<kr.length&&!kr[w].includes("DetermineComponentFrameRoot");)w++;for(;Se<Ir.length&&!Ir[Se].includes("DetermineComponentFrameRoot");)Se++;if(w===kr.length||Se===Ir.length)for(w=kr.length-1,Se=Ir.length-1;1<=w&&0<=Se&&kr[w]!==Ir[Se];)Se--;for(;1<=w&&0<=Se;w--,Se--)if(kr[w]!==Ir[Se]){if(w!==1||Se!==1)do if(w--,Se--,0>Se||kr[w]!==Ir[Se]){var Hr=`
`+kr[w].replace(" at new "," at ");return a.displayName&&Hr.includes("<anonymous>")&&(Hr=Hr.replace("<anonymous>",a.displayName)),Hr}while(1<=w&&0<=Se);break}}}finally{Er=!1,Error.prepareStackTrace=m}return(m=a?a.displayName||a.name:"")?pr(m):""}function wr(a,l){switch(a.tag){case 26:case 27:case 5:return pr(a.type);case 16:return pr("Lazy");case 13:return a.child!==l&&l!==null?pr("Suspense Fallback"):pr("Suspense");case 19:return pr("SuspenseList");case 0:case 15:return xr(a.type,!1);case 11:return xr(a.type.render,!1);case 1:return xr(a.type,!0);case 31:return pr("Activity");default:return""}}function Br(a){try{var l="",m=null;do l+=wr(a,m),m=a,a=a.return;while(a);return l}catch(w){return`
Error generating stack: `+w.message+`
`+w.stack}}var hr=Object.prototype.hasOwnProperty,Cr=t.unstable_scheduleCallback,_r=t.unstable_cancelCallback,Tr=t.unstable_shouldYield,Nr=t.unstable_requestPaint,or=t.unstable_now,tr=t.unstable_getCurrentPriorityLevel,yr=t.unstable_ImmediatePriority,mr=t.unstable_UserBlockingPriority,sr=t.unstable_NormalPriority,Ar=t.unstable_LowPriority,ht=t.unstable_IdlePriority,Qe=t.log,lt=t.unstable_setDisableYieldValue,ar=null,br=null;function Sr(a){if(typeof Qe=="function"&&lt(a),br&&typeof br.setStrictMode=="function")try{br.setStrictMode(ar,a)}catch{}}var Rr=Math.clz32?Math.clz32:zr,Lr=Math.log,Gr=Math.LN2;function zr(a){return a>>>=0,a===0?32:31-(Lr(a)/Gr|0)|0}var Vr=256,Zr=262144,an=4194304;function nn(a){var l=a&42;if(l!==0)return l;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Xn(a,l,m){var w=a.pendingLanes;if(w===0)return 0;var Se=0,Ge=a.suspendedLanes,Ot=a.pingedLanes;a=a.warmLanes;var gr=w&134217727;return gr!==0?(w=gr&~Ge,w!==0?Se=nn(w):(Ot&=gr,Ot!==0?Se=nn(Ot):m||(m=gr&~a,m!==0&&(Se=nn(m))))):(gr=w&~Ge,gr!==0?Se=nn(gr):Ot!==0?Se=nn(Ot):m||(m=w&~a,m!==0&&(Se=nn(m)))),Se===0?0:l!==0&&l!==Se&&(l&Ge)===0&&(Ge=Se&-Se,m=l&-l,Ge>=m||Ge===32&&(m&4194048)!==0)?l:Se}function vn(a,l){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&l)===0}function gn(a,l){switch(a){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ai(){var a=an;return an<<=1,(an&62914560)===0&&(an=4194304),a}function dr(a){for(var l=[],m=0;31>m;m++)l.push(a);return l}function yt(a,l){a.pendingLanes|=l,l!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ft(a,l,m,w,Se,Ge){var Ot=a.pendingLanes;a.pendingLanes=m,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=m,a.entangledLanes&=m,a.errorRecoveryDisabledLanes&=m,a.shellSuspendCounter=0;var gr=a.entanglements,kr=a.expirationTimes,Ir=a.hiddenUpdates;for(m=Ot&~m;0<m;){var Hr=31-Rr(m),Kr=1<<Hr;gr[Hr]=0,kr[Hr]=-1;var Pr=Ir[Hr];if(Pr!==null)for(Ir[Hr]=null,Hr=0;Hr<Pr.length;Hr++){var Ur=Pr[Hr];Ur!==null&&(Ur.lane&=-536870913)}m&=~Kr}w!==0&&vr(a,w,0),Ge!==0&&Se===0&&a.tag!==0&&(a.suspendedLanes|=Ge&~(Ot&~l))}function vr(a,l,m){a.pendingLanes|=l,a.suspendedLanes&=~l;var w=31-Rr(l);a.entangledLanes|=l,a.entanglements[w]=a.entanglements[w]|1073741824|m&261930}function jr(a,l){var m=a.entangledLanes|=l;for(a=a.entanglements;m;){var w=31-Rr(m),Se=1<<w;Se&l|a[w]&l&&(a[w]|=l),m&=~Se}}function Mr(a,l){var m=l&-l;return m=(m&42)!==0?1:Or(m),(m&(a.suspendedLanes|l))!==0?0:m}function Or(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Yr(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function An(){var a=Le.p;return a!==0?a:(a=window.event,a===void 0?32:vf(a.type))}function tn(a,l){var m=Le.p;try{return Le.p=a,l()}finally{Le.p=m}}var Jr=Math.random().toString(36).slice(2),rn="__reactFiber$"+Jr,fn="__reactProps$"+Jr,_n="__reactContainer$"+Jr,Bi="__reactEvents$"+Jr,ko="__reactListeners$"+Jr,jo="__reactHandles$"+Jr,qi="__reactResources$"+Jr,Ts="__reactMarker$"+Jr;function Ci(a){delete a[rn],delete a[fn],delete a[Bi],delete a[ko],delete a[jo]}function Ss(a){var l=a[rn];if(l)return l;for(var m=a.parentNode;m;){if(l=m[_n]||m[rn]){if(m=l.alternate,l.child!==null||m!==null&&m.child!==null)for(a=of(a);a!==null;){if(m=a[rn])return m;a=of(a)}return l}a=m,m=a.parentNode}return null}function _s(a){if(a=a[rn]||a[_n]){var l=a.tag;if(l===5||l===6||l===13||l===31||l===26||l===27||l===3)return a}return null}function $s(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a.stateNode;throw Error(n(33))}function Rs(a){var l=a[qi];return l||(l=a[qi]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function Dn(a){a[Ts]=!0}var Ki=new Set,zi={};function vs(a,l){ks(a,l),ks(a+"Capture",l)}function ks(a,l){for(zi[a]=l,a=0;a<l.length;a++)Ki.add(l[a])}var No=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Vi={},Gi={};function Do(a){return hr.call(Gi,a)?!0:hr.call(Vi,a)?!1:No.test(a)?Gi[a]=!0:(Vi[a]=!0,!1)}function ba(a,l,m){if(Do(l))if(m===null)a.removeAttribute(l);else{switch(typeof m){case"undefined":case"function":case"symbol":a.removeAttribute(l);return;case"boolean":var w=l.toLowerCase().slice(0,5);if(w!=="data-"&&w!=="aria-"){a.removeAttribute(l);return}}a.setAttribute(l,""+m)}}function wa(a,l,m){if(m===null)a.removeAttribute(l);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(l);return}a.setAttribute(l,""+m)}}function Is(a,l,m,w){if(w===null)a.removeAttribute(m);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(m);return}a.setAttributeNS(l,m,""+w)}}function xs(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function q0(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function uh(a,l,m){var w=Object.getOwnPropertyDescriptor(a.constructor.prototype,l);if(!a.hasOwnProperty(l)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var Se=w.get,Ge=w.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return Se.call(this)},set:function(Ot){m=""+Ot,Ge.call(this,Ot)}}),Object.defineProperty(a,l,{enumerable:w.enumerable}),{getValue:function(){return m},setValue:function(Ot){m=""+Ot},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function $c(a){if(!a._valueTracker){var l=q0(a)?"checked":"value";a._valueTracker=uh(a,l,""+a[l])}}function K0(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var m=l.getValue(),w="";return a&&(w=q0(a)?a.checked?"true":"false":a.value),a=w,a!==m?(l.setValue(a),!0):!1}function va(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var xh=/[\n"\\]/g;function ds(a){return a.replace(xh,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function Ic(a,l,m,w,Se,Ge,Ot,gr){a.name="",Ot!=null&&typeof Ot!="function"&&typeof Ot!="symbol"&&typeof Ot!="boolean"?a.type=Ot:a.removeAttribute("type"),l!=null?Ot==="number"?(l===0&&a.value===""||a.value!=l)&&(a.value=""+xs(l)):a.value!==""+xs(l)&&(a.value=""+xs(l)):Ot!=="submit"&&Ot!=="reset"||a.removeAttribute("value"),l!=null?Pc(a,Ot,xs(l)):m!=null?Pc(a,Ot,xs(m)):w!=null&&a.removeAttribute("value"),Se==null&&Ge!=null&&(a.defaultChecked=!!Ge),Se!=null&&(a.checked=Se&&typeof Se!="function"&&typeof Se!="symbol"),gr!=null&&typeof gr!="function"&&typeof gr!="symbol"&&typeof gr!="boolean"?a.name=""+xs(gr):a.removeAttribute("name")}function z0(a,l,m,w,Se,Ge,Ot,gr){if(Ge!=null&&typeof Ge!="function"&&typeof Ge!="symbol"&&typeof Ge!="boolean"&&(a.type=Ge),l!=null||m!=null){if(!(Ge!=="submit"&&Ge!=="reset"||l!=null)){$c(a);return}m=m!=null?""+xs(m):"",l=l!=null?""+xs(l):m,gr||l===a.value||(a.value=l),a.defaultValue=l}w=w??Se,w=typeof w!="function"&&typeof w!="symbol"&&!!w,a.checked=gr?a.checked:!!w,a.defaultChecked=!!w,Ot!=null&&typeof Ot!="function"&&typeof Ot!="symbol"&&typeof Ot!="boolean"&&(a.name=Ot),$c(a)}function Pc(a,l,m){l==="number"&&va(a.ownerDocument)===a||a.defaultValue===""+m||(a.defaultValue=""+m)}function Wi(a,l,m,w){if(a=a.options,l){l={};for(var Se=0;Se<m.length;Se++)l["$"+m[Se]]=!0;for(m=0;m<a.length;m++)Se=l.hasOwnProperty("$"+a[m].value),a[m].selected!==Se&&(a[m].selected=Se),Se&&w&&(a[m].defaultSelected=!0)}else{for(m=""+xs(m),l=null,Se=0;Se<a.length;Se++){if(a[Se].value===m){a[Se].selected=!0,w&&(a[Se].defaultSelected=!0);return}l!==null||a[Se].disabled||(l=a[Se])}l!==null&&(l.selected=!0)}}function V0(a,l,m){if(l!=null&&(l=""+xs(l),l!==a.value&&(a.value=l),m==null)){a.defaultValue!==l&&(a.defaultValue=l);return}a.defaultValue=m!=null?""+xs(m):""}function G0(a,l,m,w){if(l==null){if(w!=null){if(m!=null)throw Error(n(92));if(P(w)){if(1<w.length)throw Error(n(93));w=w[0]}m=w}m==null&&(m=""),l=m}m=xs(l),a.defaultValue=m,w=a.textContent,w===m&&w!==""&&w!==null&&(a.value=w),$c(a)}function Yi(a,l){if(l){var m=a.firstChild;if(m&&m===a.lastChild&&m.nodeType===3){m.nodeValue=l;return}}a.textContent=l}var dh=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function W0(a,l,m){var w=l.indexOf("--")===0;m==null||typeof m=="boolean"||m===""?w?a.setProperty(l,""):l==="float"?a.cssFloat="":a[l]="":w?a.setProperty(l,m):typeof m!="number"||m===0||dh.has(l)?l==="float"?a.cssFloat=m:a[l]=(""+m).trim():a[l]=m+"px"}function Y0(a,l,m){if(l!=null&&typeof l!="object")throw Error(n(62));if(a=a.style,m!=null){for(var w in m)!m.hasOwnProperty(w)||l!=null&&l.hasOwnProperty(w)||(w.indexOf("--")===0?a.setProperty(w,""):w==="float"?a.cssFloat="":a[w]="");for(var Se in l)w=l[Se],l.hasOwnProperty(Se)&&m[Se]!==w&&W0(a,Se,w)}else for(var Ge in l)l.hasOwnProperty(Ge)&&W0(a,Ge,l[Ge])}function Mc(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fh=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),hh=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Aa(a){return hh.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function Ps(){}var Uc=null;function Oc(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Xi=null,Zi=null;function X0(a){var l=_s(a);if(l&&(a=l.stateNode)){var m=a[fn]||null;e:switch(a=l.stateNode,l.type){case"input":if(Ic(a,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name),l=m.name,m.type==="radio"&&l!=null){for(m=a;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll('input[name="'+ds(""+l)+'"][type="radio"]'),l=0;l<m.length;l++){var w=m[l];if(w!==a&&w.form===a.form){var Se=w[fn]||null;if(!Se)throw Error(n(90));Ic(w,Se.value,Se.defaultValue,Se.defaultValue,Se.checked,Se.defaultChecked,Se.type,Se.name)}}for(l=0;l<m.length;l++)w=m[l],w.form===a.form&&K0(w)}break e;case"textarea":V0(a,m.value,m.defaultValue);break e;case"select":l=m.value,l!=null&&Wi(a,!!m.multiple,l,!1)}}}var Lc=!1;function Z0(a,l,m){if(Lc)return a(l,m);Lc=!0;try{var w=a(l);return w}finally{if(Lc=!1,(Xi!==null||Zi!==null)&&(xc(),Xi&&(l=Xi,a=Zi,Zi=Xi=null,X0(l),a)))for(l=0;l<a.length;l++)X0(a[l])}}function Fo(a,l){var m=a.stateNode;if(m===null)return null;var w=m[fn]||null;if(w===null)return null;m=w[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(a=a.type,w=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!w;break e;default:a=!1}if(a)return null;if(m&&typeof m!="function")throw Error(n(231,l,typeof m));return m}var Ms=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Hc=!1;if(Ms)try{var To={};Object.defineProperty(To,"passive",{get:function(){Hc=!0}}),window.addEventListener("test",To,To),window.removeEventListener("test",To,To)}catch{Hc=!1}var ei=null,qc=null,Ba=null;function Q0(){if(Ba)return Ba;var a,l=qc,m=l.length,w,Se="value"in ei?ei.value:ei.textContent,Ge=Se.length;for(a=0;a<m&&l[a]===Se[a];a++);var Ot=m-a;for(w=1;w<=Ot&&l[m-w]===Se[Ge-w];w++);return Ba=Se.slice(a,1<w?1-w:void 0)}function Ca(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function Sa(){return!0}function J0(){return!1}function Zn(a){function l(m,w,Se,Ge,Ot){this._reactName=m,this._targetInst=Se,this.type=w,this.nativeEvent=Ge,this.target=Ot,this.currentTarget=null;for(var gr in a)a.hasOwnProperty(gr)&&(m=a[gr],this[gr]=m?m(Ge):Ge[gr]);return this.isDefaultPrevented=(Ge.defaultPrevented!=null?Ge.defaultPrevented:Ge.returnValue===!1)?Sa:J0,this.isPropagationStopped=J0,this}return g(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=Sa)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=Sa)},persist:function(){},isPersistent:Sa}),l}var Si={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ra=Zn(Si),$o=g({},Si,{view:0,detail:0}),ph=Zn($o),Kc,zc,Io,ka=g({},$o,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gc,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Io&&(Io&&a.type==="mousemove"?(Kc=a.screenX-Io.screenX,zc=a.screenY-Io.screenY):zc=Kc=0,Io=a),Kc)},movementY:function(a){return"movementY"in a?a.movementY:zc}}),eu=Zn(ka),mh=g({},ka,{dataTransfer:0}),gh=Zn(mh),yh=g({},$o,{relatedTarget:0}),Vc=Zn(yh),Eh=g({},Si,{animationName:0,elapsedTime:0,pseudoElement:0}),bh=Zn(Eh),wh=g({},Si,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),vh=Zn(wh),Ah=g({},Si,{data:0}),tu=Zn(Ah),Bh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ch={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _h(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=Sh[a])?!!l[a]:!1}function Gc(){return _h}var Rh=g({},$o,{key:function(a){if(a.key){var l=Bh[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=Ca(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Ch[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gc,charCode:function(a){return a.type==="keypress"?Ca(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Ca(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),kh=Zn(Rh),jh=g({},ka,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ru=Zn(jh),Nh=g({},$o,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gc}),Dh=Zn(Nh),Fh=g({},Si,{propertyName:0,elapsedTime:0,pseudoElement:0}),Th=Zn(Fh),$h=g({},ka,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Ih=Zn($h),Ph=g({},Si,{newState:0,oldState:0}),Mh=Zn(Ph),Uh=[9,13,27,32],Wc=Ms&&"CompositionEvent"in window,Po=null;Ms&&"documentMode"in document&&(Po=document.documentMode);var Oh=Ms&&"TextEvent"in window&&!Po,nu=Ms&&(!Wc||Po&&8<Po&&11>=Po),su=" ",iu=!1;function ou(a,l){switch(a){case"keyup":return Uh.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function au(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Qi=!1;function Lh(a,l){switch(a){case"compositionend":return au(l);case"keypress":return l.which!==32?null:(iu=!0,su);case"textInput":return a=l.data,a===su&&iu?null:a;default:return null}}function Hh(a,l){if(Qi)return a==="compositionend"||!Wc&&ou(a,l)?(a=Q0(),Ba=qc=ei=null,Qi=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return nu&&l.locale!=="ko"?null:l.data;default:return null}}var qh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cu(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!qh[a.type]:l==="textarea"}function lu(a,l,m,w){Xi?Zi?Zi.push(w):Zi=[w]:Xi=w,l=yc(l,"onChange"),0<l.length&&(m=new Ra("onChange","change",null,m,w),a.push({event:m,listeners:l}))}var Mo=null,Uo=null;function Kh(a){zd(a,0)}function ja(a){var l=$s(a);if(K0(l))return a}function uu(a,l){if(a==="change")return l}var xu=!1;if(Ms){var Yc;if(Ms){var Xc="oninput"in document;if(!Xc){var du=document.createElement("div");du.setAttribute("oninput","return;"),Xc=typeof du.oninput=="function"}Yc=Xc}else Yc=!1;xu=Yc&&(!document.documentMode||9<document.documentMode)}function fu(){Mo&&(Mo.detachEvent("onpropertychange",hu),Uo=Mo=null)}function hu(a){if(a.propertyName==="value"&&ja(Uo)){var l=[];lu(l,Uo,a,Oc(a)),Z0(Kh,l)}}function zh(a,l,m){a==="focusin"?(fu(),Mo=l,Uo=m,Mo.attachEvent("onpropertychange",hu)):a==="focusout"&&fu()}function Vh(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return ja(Uo)}function Gh(a,l){if(a==="click")return ja(l)}function Wh(a,l){if(a==="input"||a==="change")return ja(l)}function Yh(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var ns=typeof Object.is=="function"?Object.is:Yh;function Oo(a,l){if(ns(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var m=Object.keys(a),w=Object.keys(l);if(m.length!==w.length)return!1;for(w=0;w<m.length;w++){var Se=m[w];if(!hr.call(l,Se)||!ns(a[Se],l[Se]))return!1}return!0}function pu(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function mu(a,l){var m=pu(a);a=0;for(var w;m;){if(m.nodeType===3){if(w=a+m.textContent.length,a<=l&&w>=l)return{node:m,offset:l-a};a=w}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=pu(m)}}function gu(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?gu(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function yu(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var l=va(a.document);l instanceof a.HTMLIFrameElement;){try{var m=typeof l.contentWindow.location.href=="string"}catch{m=!1}if(m)a=l.contentWindow;else break;l=va(a.document)}return l}function Zc(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}var Xh=Ms&&"documentMode"in document&&11>=document.documentMode,Ji=null,Qc=null,Lo=null,Jc=!1;function Eu(a,l,m){var w=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;Jc||Ji==null||Ji!==va(w)||(w=Ji,"selectionStart"in w&&Zc(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),Lo&&Oo(Lo,w)||(Lo=w,w=yc(Qc,"onSelect"),0<w.length&&(l=new Ra("onSelect","select",null,l,m),a.push({event:l,listeners:w}),l.target=Ji)))}function _i(a,l){var m={};return m[a.toLowerCase()]=l.toLowerCase(),m["Webkit"+a]="webkit"+l,m["Moz"+a]="moz"+l,m}var eo={animationend:_i("Animation","AnimationEnd"),animationiteration:_i("Animation","AnimationIteration"),animationstart:_i("Animation","AnimationStart"),transitionrun:_i("Transition","TransitionRun"),transitionstart:_i("Transition","TransitionStart"),transitioncancel:_i("Transition","TransitionCancel"),transitionend:_i("Transition","TransitionEnd")},el={},bu={};Ms&&(bu=document.createElement("div").style,"AnimationEvent"in window||(delete eo.animationend.animation,delete eo.animationiteration.animation,delete eo.animationstart.animation),"TransitionEvent"in window||delete eo.transitionend.transition);function Ri(a){if(el[a])return el[a];if(!eo[a])return a;var l=eo[a],m;for(m in l)if(l.hasOwnProperty(m)&&m in bu)return el[a]=l[m];return a}var wu=Ri("animationend"),vu=Ri("animationiteration"),Au=Ri("animationstart"),Zh=Ri("transitionrun"),Qh=Ri("transitionstart"),Jh=Ri("transitioncancel"),Bu=Ri("transitionend"),Cu=new Map,tl="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");tl.push("scrollEnd");function As(a,l){Cu.set(a,l),vs(l,[a])}var Na=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(l))return}else if(typeof process$1=="object"&&typeof process$1.emit=="function"){process$1.emit("uncaughtException",a);return}console.error(a)},fs=[],to=0,rl=0;function Da(){for(var a=to,l=rl=to=0;l<a;){var m=fs[l];fs[l++]=null;var w=fs[l];fs[l++]=null;var Se=fs[l];fs[l++]=null;var Ge=fs[l];if(fs[l++]=null,w!==null&&Se!==null){var Ot=w.pending;Ot===null?Se.next=Se:(Se.next=Ot.next,Ot.next=Se),w.pending=Se}Ge!==0&&Su(m,Se,Ge)}}function Fa(a,l,m,w){fs[to++]=a,fs[to++]=l,fs[to++]=m,fs[to++]=w,rl|=w,a.lanes|=w,a=a.alternate,a!==null&&(a.lanes|=w)}function nl(a,l,m,w){return Fa(a,l,m,w),Ta(a)}function ki(a,l){return Fa(a,null,null,l),Ta(a)}function Su(a,l,m){a.lanes|=m;var w=a.alternate;w!==null&&(w.lanes|=m);for(var Se=!1,Ge=a.return;Ge!==null;)Ge.childLanes|=m,w=Ge.alternate,w!==null&&(w.childLanes|=m),Ge.tag===22&&(a=Ge.stateNode,a===null||a._visibility&1||(Se=!0)),a=Ge,Ge=Ge.return;return a.tag===3?(Ge=a.stateNode,Se&&l!==null&&(Se=31-Rr(m),a=Ge.hiddenUpdates,w=a[Se],w===null?a[Se]=[l]:w.push(l),l.lane=m|536870912),Ge):null}function Ta(a){if(50<la)throw la=0,d0=null,Error(n(185));for(var l=a.return;l!==null;)a=l,l=a.return;return a.tag===3?a.stateNode:null}var ro={};function ep(a,l,m,w){this.tag=a,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ss(a,l,m,w){return new ep(a,l,m,w)}function sl(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Us(a,l){var m=a.alternate;return m===null?(m=ss(a.tag,l,a.key,a.mode),m.elementType=a.elementType,m.type=a.type,m.stateNode=a.stateNode,m.alternate=a,a.alternate=m):(m.pendingProps=l,m.type=a.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=a.flags&65011712,m.childLanes=a.childLanes,m.lanes=a.lanes,m.child=a.child,m.memoizedProps=a.memoizedProps,m.memoizedState=a.memoizedState,m.updateQueue=a.updateQueue,l=a.dependencies,m.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},m.sibling=a.sibling,m.index=a.index,m.ref=a.ref,m.refCleanup=a.refCleanup,m}function _u(a,l){a.flags&=65011714;var m=a.alternate;return m===null?(a.childLanes=0,a.lanes=l,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=m.childLanes,a.lanes=m.lanes,a.child=m.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=m.memoizedProps,a.memoizedState=m.memoizedState,a.updateQueue=m.updateQueue,a.type=m.type,l=m.dependencies,a.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),a}function $a(a,l,m,w,Se,Ge){var Ot=0;if(w=a,typeof a=="function")sl(a)&&(Ot=1);else if(typeof a=="string")Ot=om(a,m,Je.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case Xe:return a=ss(31,m,l,Se),a.elementType=Xe,a.lanes=Ge,a;case D:return ji(m.children,Se,Ge,l);case k:Ot=8,Se|=24;break;case Re:return a=ss(12,m,l,Se|2),a.elementType=Re,a.lanes=Ge,a;case ze:return a=ss(13,m,l,Se),a.elementType=ze,a.lanes=Ge,a;case q:return a=ss(19,m,l,Se),a.elementType=q,a.lanes=Ge,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case O:Ot=10;break e;case Fe:Ot=9;break e;case $e:Ot=11;break e;case W:Ot=14;break e;case We:Ot=16,w=null;break e}Ot=29,m=Error(n(130,a===null?"null":typeof a,"")),w=null}return l=ss(Ot,m,l,Se),l.elementType=a,l.type=w,l.lanes=Ge,l}function ji(a,l,m,w){return a=ss(7,a,w,l),a.lanes=m,a}function il(a,l,m){return a=ss(6,a,null,l),a.lanes=m,a}function Ru(a){var l=ss(18,null,null,0);return l.stateNode=a,l}function ol(a,l,m){return l=ss(4,a.children!==null?a.children:[],a.key,l),l.lanes=m,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}var ku=new WeakMap;function hs(a,l){if(typeof a=="object"&&a!==null){var m=ku.get(a);return m!==void 0?m:(l={value:a,source:l,stack:Br(l)},ku.set(a,l),l)}return{value:a,source:l,stack:Br(l)}}var no=[],so=0,Ia=null,Ho=0,ps=[],gs=0,ti=null,js=1,Ns="";function Os(a,l){no[so++]=Ho,no[so++]=Ia,Ia=a,Ho=l}function ju(a,l,m){ps[gs++]=js,ps[gs++]=Ns,ps[gs++]=ti,ti=a;var w=js;a=Ns;var Se=32-Rr(w)-1;w&=~(1<<Se),m+=1;var Ge=32-Rr(l)+Se;if(30<Ge){var Ot=Se-Se%5;Ge=(w&(1<<Ot)-1).toString(32),w>>=Ot,Se-=Ot,js=1<<32-Rr(l)+Se|m<<Se|w,Ns=Ge+a}else js=1<<Ge|m<<Se|w,Ns=a}function al(a){a.return!==null&&(Os(a,1),ju(a,1,0))}function cl(a){for(;a===Ia;)Ia=no[--so],no[so]=null,Ho=no[--so],no[so]=null;for(;a===ti;)ti=ps[--gs],ps[gs]=null,Ns=ps[--gs],ps[gs]=null,js=ps[--gs],ps[gs]=null}function Nu(a,l){ps[gs++]=js,ps[gs++]=Ns,ps[gs++]=ti,js=l.id,Ns=l.overflow,ti=a}var zn=null,kn=null,hn=!1,ri=null,ys=!1,ll=Error(n(519));function ni(a){var l=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw qo(hs(l,a)),ll}function Du(a){var l=a.stateNode,m=a.type,w=a.memoizedProps;switch(l[rn]=a,l[fn]=w,m){case"dialog":ln("cancel",l),ln("close",l);break;case"iframe":case"object":case"embed":ln("load",l);break;case"video":case"audio":for(m=0;m<xa.length;m++)ln(xa[m],l);break;case"source":ln("error",l);break;case"img":case"image":case"link":ln("error",l),ln("load",l);break;case"details":ln("toggle",l);break;case"input":ln("invalid",l),z0(l,w.value,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name,!0);break;case"select":ln("invalid",l);break;case"textarea":ln("invalid",l),G0(l,w.value,w.defaultValue,w.children)}m=w.children,typeof m!="string"&&typeof m!="number"&&typeof m!="bigint"||l.textContent===""+m||w.suppressHydrationWarning===!0||Yd(l.textContent,m)?(w.popover!=null&&(ln("beforetoggle",l),ln("toggle",l)),w.onScroll!=null&&ln("scroll",l),w.onScrollEnd!=null&&ln("scrollend",l),w.onClick!=null&&(l.onclick=Ps),l=!0):l=!1,l||ni(a,!0)}function Fu(a){for(zn=a.return;zn;)switch(zn.tag){case 5:case 31:case 13:ys=!1;return;case 27:case 3:ys=!0;return;default:zn=zn.return}}function io(a){if(a!==zn)return!1;if(!hn)return Fu(a),hn=!0,!1;var l=a.tag,m;if((m=l!==3&&l!==27)&&((m=l===5)&&(m=a.type,m=!(m!=="form"&&m!=="button")||_0(a.type,a.memoizedProps)),m=!m),m&&kn&&ni(a),Fu(a),l===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));kn=sf(a)}else if(l===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));kn=sf(a)}else l===27?(l=kn,gi(a.type)?(a=D0,D0=null,kn=a):kn=l):kn=zn?bs(a.stateNode.nextSibling):null;return!0}function Ni(){kn=zn=null,hn=!1}function ul(){var a=ri;return a!==null&&(ts===null?ts=a:ts.push.apply(ts,a),ri=null),a}function qo(a){ri===null?ri=[a]:ri.push(a)}var xl=L(null),Di=null,Ls=null;function si(a,l,m){dt(xl,l._currentValue),l._currentValue=m}function Hs(a){a._currentValue=xl.current,st(xl)}function dl(a,l,m){for(;a!==null;){var w=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,w!==null&&(w.childLanes|=l)):w!==null&&(w.childLanes&l)!==l&&(w.childLanes|=l),a===m)break;a=a.return}}function fl(a,l,m,w){var Se=a.child;for(Se!==null&&(Se.return=a);Se!==null;){var Ge=Se.dependencies;if(Ge!==null){var Ot=Se.child;Ge=Ge.firstContext;e:for(;Ge!==null;){var gr=Ge;Ge=Se;for(var kr=0;kr<l.length;kr++)if(gr.context===l[kr]){Ge.lanes|=m,gr=Ge.alternate,gr!==null&&(gr.lanes|=m),dl(Ge.return,m,a),w||(Ot=null);break e}Ge=gr.next}}else if(Se.tag===18){if(Ot=Se.return,Ot===null)throw Error(n(341));Ot.lanes|=m,Ge=Ot.alternate,Ge!==null&&(Ge.lanes|=m),dl(Ot,m,a),Ot=null}else Ot=Se.child;if(Ot!==null)Ot.return=Se;else for(Ot=Se;Ot!==null;){if(Ot===a){Ot=null;break}if(Se=Ot.sibling,Se!==null){Se.return=Ot.return,Ot=Se;break}Ot=Ot.return}Se=Ot}}function oo(a,l,m,w){a=null;for(var Se=l,Ge=!1;Se!==null;){if(!Ge){if((Se.flags&524288)!==0)Ge=!0;else if((Se.flags&262144)!==0)break}if(Se.tag===10){var Ot=Se.alternate;if(Ot===null)throw Error(n(387));if(Ot=Ot.memoizedProps,Ot!==null){var gr=Se.type;ns(Se.pendingProps.value,Ot.value)||(a!==null?a.push(gr):a=[gr])}}else if(Se===cr.current){if(Ot=Se.alternate,Ot===null)throw Error(n(387));Ot.memoizedState.memoizedState!==Se.memoizedState.memoizedState&&(a!==null?a.push(ma):a=[ma])}Se=Se.return}a!==null&&fl(l,a,m,w),l.flags|=262144}function Pa(a){for(a=a.firstContext;a!==null;){if(!ns(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Fi(a){Di=a,Ls=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Vn(a){return Tu(Di,a)}function Ma(a,l){return Di===null&&Fi(a),Tu(a,l)}function Tu(a,l){var m=l._currentValue;if(l={context:l,memoizedValue:m,next:null},Ls===null){if(a===null)throw Error(n(308));Ls=l,a.dependencies={lanes:0,firstContext:l},a.flags|=524288}else Ls=Ls.next=l;return m}var tp=typeof AbortController<"u"?AbortController:function(){var a=[],l=this.signal={aborted:!1,addEventListener:function(m,w){a.push(w)}};this.abort=function(){l.aborted=!0,a.forEach(function(m){return m()})}},rp=t.unstable_scheduleCallback,np=t.unstable_NormalPriority,Un={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function hl(){return{controller:new tp,data:new Map,refCount:0}}function Ko(a){a.refCount--,a.refCount===0&&rp(np,function(){a.controller.abort()})}var zo=null,pl=0,ao=0,co=null;function sp(a,l){if(zo===null){var m=zo=[];pl=0,ao=y0(),co={status:"pending",value:void 0,then:function(w){m.push(w)}}}return pl++,l.then($u,$u),l}function $u(){if(--pl===0&&zo!==null){co!==null&&(co.status="fulfilled");var a=zo;zo=null,ao=0,co=null;for(var l=0;l<a.length;l++)(0,a[l])()}}function ip(a,l){var m=[],w={status:"pending",value:null,reason:null,then:function(Se){m.push(Se)}};return a.then(function(){w.status="fulfilled",w.value=l;for(var Se=0;Se<m.length;Se++)(0,m[Se])(l)},function(Se){for(w.status="rejected",w.reason=Se,Se=0;Se<m.length;Se++)(0,m[Se])(void 0)}),w}var Iu=_e.S;_e.S=function(a,l){Ed=or(),typeof l=="object"&&l!==null&&typeof l.then=="function"&&sp(a,l),Iu!==null&&Iu(a,l)};var Ti=L(null);function ml(){var a=Ti.current;return a!==null?a:Rn.pooledCache}function Ua(a,l){l===null?dt(Ti,Ti.current):dt(Ti,l.pool)}function Pu(){var a=ml();return a===null?null:{parent:Un._currentValue,pool:a}}var lo=Error(n(460)),gl=Error(n(474)),Oa=Error(n(542)),La={then:function(){}};function Mu(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Uu(a,l,m){switch(m=a[m],m===void 0?a.push(l):m!==l&&(l.then(Ps,Ps),l=m),l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,Lu(a),a;default:if(typeof l.status=="string")l.then(Ps,Ps);else{if(a=Rn,a!==null&&100<a.shellSuspendCounter)throw Error(n(482));a=l,a.status="pending",a.then(function(w){if(l.status==="pending"){var Se=l;Se.status="fulfilled",Se.value=w}},function(w){if(l.status==="pending"){var Se=l;Se.status="rejected",Se.reason=w}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,Lu(a),a}throw Ii=l,lo}}function $i(a){try{var l=a._init;return l(a._payload)}catch(m){throw m!==null&&typeof m=="object"&&typeof m.then=="function"?(Ii=m,lo):m}}var Ii=null;function Ou(){if(Ii===null)throw Error(n(459));var a=Ii;return Ii=null,a}function Lu(a){if(a===lo||a===Oa)throw Error(n(483))}var uo=null,Vo=0;function Ha(a){var l=Vo;return Vo+=1,uo===null&&(uo=[]),Uu(uo,a,l)}function Go(a,l){l=l.props.ref,a.ref=l!==void 0?l:null}function qa(a,l){throw l.$$typeof===y?Error(n(525)):(a=Object.prototype.toString.call(l),Error(n(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a)))}function Hu(a){function l(Fr,Dr){if(a){var $r=Fr.deletions;$r===null?(Fr.deletions=[Dr],Fr.flags|=16):$r.push(Dr)}}function m(Fr,Dr){if(!a)return null;for(;Dr!==null;)l(Fr,Dr),Dr=Dr.sibling;return null}function w(Fr){for(var Dr=new Map;Fr!==null;)Fr.key!==null?Dr.set(Fr.key,Fr):Dr.set(Fr.index,Fr),Fr=Fr.sibling;return Dr}function Se(Fr,Dr){return Fr=Us(Fr,Dr),Fr.index=0,Fr.sibling=null,Fr}function Ge(Fr,Dr,$r){return Fr.index=$r,a?($r=Fr.alternate,$r!==null?($r=$r.index,$r<Dr?(Fr.flags|=67108866,Dr):$r):(Fr.flags|=67108866,Dr)):(Fr.flags|=1048576,Dr)}function Ot(Fr){return a&&Fr.alternate===null&&(Fr.flags|=67108866),Fr}function gr(Fr,Dr,$r,qr){return Dr===null||Dr.tag!==6?(Dr=il($r,Fr.mode,qr),Dr.return=Fr,Dr):(Dr=Se(Dr,$r),Dr.return=Fr,Dr)}function kr(Fr,Dr,$r,qr){var Qr=$r.type;return Qr===D?Hr(Fr,Dr,$r.props.children,qr,$r.key):Dr!==null&&(Dr.elementType===Qr||typeof Qr=="object"&&Qr!==null&&Qr.$$typeof===We&&$i(Qr)===Dr.type)?(Dr=Se(Dr,$r.props),Go(Dr,$r),Dr.return=Fr,Dr):(Dr=$a($r.type,$r.key,$r.props,null,Fr.mode,qr),Go(Dr,$r),Dr.return=Fr,Dr)}function Ir(Fr,Dr,$r,qr){return Dr===null||Dr.tag!==4||Dr.stateNode.containerInfo!==$r.containerInfo||Dr.stateNode.implementation!==$r.implementation?(Dr=ol($r,Fr.mode,qr),Dr.return=Fr,Dr):(Dr=Se(Dr,$r.children||[]),Dr.return=Fr,Dr)}function Hr(Fr,Dr,$r,qr,Qr){return Dr===null||Dr.tag!==7?(Dr=ji($r,Fr.mode,qr,Qr),Dr.return=Fr,Dr):(Dr=Se(Dr,$r),Dr.return=Fr,Dr)}function Kr(Fr,Dr,$r){if(typeof Dr=="string"&&Dr!==""||typeof Dr=="number"||typeof Dr=="bigint")return Dr=il(""+Dr,Fr.mode,$r),Dr.return=Fr,Dr;if(typeof Dr=="object"&&Dr!==null){switch(Dr.$$typeof){case b:return $r=$a(Dr.type,Dr.key,Dr.props,null,Fr.mode,$r),Go($r,Dr),$r.return=Fr,$r;case R:return Dr=ol(Dr,Fr.mode,$r),Dr.return=Fr,Dr;case We:return Dr=$i(Dr),Kr(Fr,Dr,$r)}if(P(Dr)||v(Dr))return Dr=ji(Dr,Fr.mode,$r,null),Dr.return=Fr,Dr;if(typeof Dr.then=="function")return Kr(Fr,Ha(Dr),$r);if(Dr.$$typeof===O)return Kr(Fr,Ma(Fr,Dr),$r);qa(Fr,Dr)}return null}function Pr(Fr,Dr,$r,qr){var Qr=Dr!==null?Dr.key:null;if(typeof $r=="string"&&$r!==""||typeof $r=="number"||typeof $r=="bigint")return Qr!==null?null:gr(Fr,Dr,""+$r,qr);if(typeof $r=="object"&&$r!==null){switch($r.$$typeof){case b:return $r.key===Qr?kr(Fr,Dr,$r,qr):null;case R:return $r.key===Qr?Ir(Fr,Dr,$r,qr):null;case We:return $r=$i($r),Pr(Fr,Dr,$r,qr)}if(P($r)||v($r))return Qr!==null?null:Hr(Fr,Dr,$r,qr,null);if(typeof $r.then=="function")return Pr(Fr,Dr,Ha($r),qr);if($r.$$typeof===O)return Pr(Fr,Dr,Ma(Fr,$r),qr);qa(Fr,$r)}return null}function Ur(Fr,Dr,$r,qr,Qr){if(typeof qr=="string"&&qr!==""||typeof qr=="number"||typeof qr=="bigint")return Fr=Fr.get($r)||null,gr(Dr,Fr,""+qr,Qr);if(typeof qr=="object"&&qr!==null){switch(qr.$$typeof){case b:return Fr=Fr.get(qr.key===null?$r:qr.key)||null,kr(Dr,Fr,qr,Qr);case R:return Fr=Fr.get(qr.key===null?$r:qr.key)||null,Ir(Dr,Fr,qr,Qr);case We:return qr=$i(qr),Ur(Fr,Dr,$r,qr,Qr)}if(P(qr)||v(qr))return Fr=Fr.get($r)||null,Hr(Dr,Fr,qr,Qr,null);if(typeof qr.then=="function")return Ur(Fr,Dr,$r,Ha(qr),Qr);if(qr.$$typeof===O)return Ur(Fr,Dr,$r,Ma(Dr,qr),Qr);qa(Dr,qr)}return null}function Wr(Fr,Dr,$r,qr){for(var Qr=null,pn=null,Xr=Dr,on=Dr=0,dn=null;Xr!==null&&on<$r.length;on++){Xr.index>on?(dn=Xr,Xr=null):dn=Xr.sibling;var mn=Pr(Fr,Xr,$r[on],qr);if(mn===null){Xr===null&&(Xr=dn);break}a&&Xr&&mn.alternate===null&&l(Fr,Xr),Dr=Ge(mn,Dr,on),pn===null?Qr=mn:pn.sibling=mn,pn=mn,Xr=dn}if(on===$r.length)return m(Fr,Xr),hn&&Os(Fr,on),Qr;if(Xr===null){for(;on<$r.length;on++)Xr=Kr(Fr,$r[on],qr),Xr!==null&&(Dr=Ge(Xr,Dr,on),pn===null?Qr=Xr:pn.sibling=Xr,pn=Xr);return hn&&Os(Fr,on),Qr}for(Xr=w(Xr);on<$r.length;on++)dn=Ur(Xr,Fr,on,$r[on],qr),dn!==null&&(a&&dn.alternate!==null&&Xr.delete(dn.key===null?on:dn.key),Dr=Ge(dn,Dr,on),pn===null?Qr=dn:pn.sibling=dn,pn=dn);return a&&Xr.forEach(function(vi){return l(Fr,vi)}),hn&&Os(Fr,on),Qr}function en(Fr,Dr,$r,qr){if($r==null)throw Error(n(151));for(var Qr=null,pn=null,Xr=Dr,on=Dr=0,dn=null,mn=$r.next();Xr!==null&&!mn.done;on++,mn=$r.next()){Xr.index>on?(dn=Xr,Xr=null):dn=Xr.sibling;var vi=Pr(Fr,Xr,mn.value,qr);if(vi===null){Xr===null&&(Xr=dn);break}a&&Xr&&vi.alternate===null&&l(Fr,Xr),Dr=Ge(vi,Dr,on),pn===null?Qr=vi:pn.sibling=vi,pn=vi,Xr=dn}if(mn.done)return m(Fr,Xr),hn&&Os(Fr,on),Qr;if(Xr===null){for(;!mn.done;on++,mn=$r.next())mn=Kr(Fr,mn.value,qr),mn!==null&&(Dr=Ge(mn,Dr,on),pn===null?Qr=mn:pn.sibling=mn,pn=mn);return hn&&Os(Fr,on),Qr}for(Xr=w(Xr);!mn.done;on++,mn=$r.next())mn=Ur(Xr,Fr,on,mn.value,qr),mn!==null&&(a&&mn.alternate!==null&&Xr.delete(mn.key===null?on:mn.key),Dr=Ge(mn,Dr,on),pn===null?Qr=mn:pn.sibling=mn,pn=mn);return a&&Xr.forEach(function(gm){return l(Fr,gm)}),hn&&Os(Fr,on),Qr}function Sn(Fr,Dr,$r,qr){if(typeof $r=="object"&&$r!==null&&$r.type===D&&$r.key===null&&($r=$r.props.children),typeof $r=="object"&&$r!==null){switch($r.$$typeof){case b:e:{for(var Qr=$r.key;Dr!==null;){if(Dr.key===Qr){if(Qr=$r.type,Qr===D){if(Dr.tag===7){m(Fr,Dr.sibling),qr=Se(Dr,$r.props.children),qr.return=Fr,Fr=qr;break e}}else if(Dr.elementType===Qr||typeof Qr=="object"&&Qr!==null&&Qr.$$typeof===We&&$i(Qr)===Dr.type){m(Fr,Dr.sibling),qr=Se(Dr,$r.props),Go(qr,$r),qr.return=Fr,Fr=qr;break e}m(Fr,Dr);break}else l(Fr,Dr);Dr=Dr.sibling}$r.type===D?(qr=ji($r.props.children,Fr.mode,qr,$r.key),qr.return=Fr,Fr=qr):(qr=$a($r.type,$r.key,$r.props,null,Fr.mode,qr),Go(qr,$r),qr.return=Fr,Fr=qr)}return Ot(Fr);case R:e:{for(Qr=$r.key;Dr!==null;){if(Dr.key===Qr)if(Dr.tag===4&&Dr.stateNode.containerInfo===$r.containerInfo&&Dr.stateNode.implementation===$r.implementation){m(Fr,Dr.sibling),qr=Se(Dr,$r.children||[]),qr.return=Fr,Fr=qr;break e}else{m(Fr,Dr);break}else l(Fr,Dr);Dr=Dr.sibling}qr=ol($r,Fr.mode,qr),qr.return=Fr,Fr=qr}return Ot(Fr);case We:return $r=$i($r),Sn(Fr,Dr,$r,qr)}if(P($r))return Wr(Fr,Dr,$r,qr);if(v($r)){if(Qr=v($r),typeof Qr!="function")throw Error(n(150));return $r=Qr.call($r),en(Fr,Dr,$r,qr)}if(typeof $r.then=="function")return Sn(Fr,Dr,Ha($r),qr);if($r.$$typeof===O)return Sn(Fr,Dr,Ma(Fr,$r),qr);qa(Fr,$r)}return typeof $r=="string"&&$r!==""||typeof $r=="number"||typeof $r=="bigint"?($r=""+$r,Dr!==null&&Dr.tag===6?(m(Fr,Dr.sibling),qr=Se(Dr,$r),qr.return=Fr,Fr=qr):(m(Fr,Dr),qr=il($r,Fr.mode,qr),qr.return=Fr,Fr=qr),Ot(Fr)):m(Fr,Dr)}return function(Fr,Dr,$r,qr){try{Vo=0;var Qr=Sn(Fr,Dr,$r,qr);return uo=null,Qr}catch(Xr){if(Xr===lo||Xr===Oa)throw Xr;var pn=ss(29,Xr,null,Fr.mode);return pn.lanes=qr,pn.return=Fr,pn}finally{}}}var Pi=Hu(!0),qu=Hu(!1),ii=!1;function yl(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function El(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function oi(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function ai(a,l,m){var w=a.updateQueue;if(w===null)return null;if(w=w.shared,(yn&2)!==0){var Se=w.pending;return Se===null?l.next=l:(l.next=Se.next,Se.next=l),w.pending=l,l=Ta(a),Su(a,null,m),l}return Fa(a,w,l,m),Ta(a)}function Wo(a,l,m){if(l=l.updateQueue,l!==null&&(l=l.shared,(m&4194048)!==0)){var w=l.lanes;w&=a.pendingLanes,m|=w,l.lanes=m,jr(a,m)}}function bl(a,l){var m=a.updateQueue,w=a.alternate;if(w!==null&&(w=w.updateQueue,m===w)){var Se=null,Ge=null;if(m=m.firstBaseUpdate,m!==null){do{var Ot={lane:m.lane,tag:m.tag,payload:m.payload,callback:null,next:null};Ge===null?Se=Ge=Ot:Ge=Ge.next=Ot,m=m.next}while(m!==null);Ge===null?Se=Ge=l:Ge=Ge.next=l}else Se=Ge=l;m={baseState:w.baseState,firstBaseUpdate:Se,lastBaseUpdate:Ge,shared:w.shared,callbacks:w.callbacks},a.updateQueue=m;return}a=m.lastBaseUpdate,a===null?m.firstBaseUpdate=l:a.next=l,m.lastBaseUpdate=l}var wl=!1;function Yo(){if(wl){var a=co;if(a!==null)throw a}}function Xo(a,l,m,w){wl=!1;var Se=a.updateQueue;ii=!1;var Ge=Se.firstBaseUpdate,Ot=Se.lastBaseUpdate,gr=Se.shared.pending;if(gr!==null){Se.shared.pending=null;var kr=gr,Ir=kr.next;kr.next=null,Ot===null?Ge=Ir:Ot.next=Ir,Ot=kr;var Hr=a.alternate;Hr!==null&&(Hr=Hr.updateQueue,gr=Hr.lastBaseUpdate,gr!==Ot&&(gr===null?Hr.firstBaseUpdate=Ir:gr.next=Ir,Hr.lastBaseUpdate=kr))}if(Ge!==null){var Kr=Se.baseState;Ot=0,Hr=Ir=kr=null,gr=Ge;do{var Pr=gr.lane&-536870913,Ur=Pr!==gr.lane;if(Ur?(xn&Pr)===Pr:(w&Pr)===Pr){Pr!==0&&Pr===ao&&(wl=!0),Hr!==null&&(Hr=Hr.next={lane:0,tag:gr.tag,payload:gr.payload,callback:null,next:null});e:{var Wr=a,en=gr;Pr=l;var Sn=m;switch(en.tag){case 1:if(Wr=en.payload,typeof Wr=="function"){Kr=Wr.call(Sn,Kr,Pr);break e}Kr=Wr;break e;case 3:Wr.flags=Wr.flags&-65537|128;case 0:if(Wr=en.payload,Pr=typeof Wr=="function"?Wr.call(Sn,Kr,Pr):Wr,Pr==null)break e;Kr=g({},Kr,Pr);break e;case 2:ii=!0}}Pr=gr.callback,Pr!==null&&(a.flags|=64,Ur&&(a.flags|=8192),Ur=Se.callbacks,Ur===null?Se.callbacks=[Pr]:Ur.push(Pr))}else Ur={lane:Pr,tag:gr.tag,payload:gr.payload,callback:gr.callback,next:null},Hr===null?(Ir=Hr=Ur,kr=Kr):Hr=Hr.next=Ur,Ot|=Pr;if(gr=gr.next,gr===null){if(gr=Se.shared.pending,gr===null)break;Ur=gr,gr=Ur.next,Ur.next=null,Se.lastBaseUpdate=Ur,Se.shared.pending=null}}while(!0);Hr===null&&(kr=Kr),Se.baseState=kr,Se.firstBaseUpdate=Ir,Se.lastBaseUpdate=Hr,Ge===null&&(Se.shared.lanes=0),di|=Ot,a.lanes=Ot,a.memoizedState=Kr}}function Ku(a,l){if(typeof a!="function")throw Error(n(191,a));a.call(l)}function zu(a,l){var m=a.callbacks;if(m!==null)for(a.callbacks=null,a=0;a<m.length;a++)Ku(m[a],l)}var xo=L(null),Ka=L(0);function Vu(a,l){a=Zs,dt(Ka,a),dt(xo,l),Zs=a|l.baseLanes}function vl(){dt(Ka,Zs),dt(xo,xo.current)}function Al(){Zs=Ka.current,st(xo),st(Ka)}var os=L(null),Es=null;function ci(a){var l=a.alternate;dt(Pn,Pn.current&1),dt(os,a),Es===null&&(l===null||xo.current!==null||l.memoizedState!==null)&&(Es=a)}function Bl(a){dt(Pn,Pn.current),dt(os,a),Es===null&&(Es=a)}function Gu(a){a.tag===22?(dt(Pn,Pn.current),dt(os,a),Es===null&&(Es=a)):li()}function li(){dt(Pn,Pn.current),dt(os,os.current)}function as(a){st(os),Es===a&&(Es=null),st(Pn)}var Pn=L(0);function za(a){for(var l=a;l!==null;){if(l.tag===13){var m=l.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||j0(m)||N0(m)))return l}else if(l.tag===19&&(l.memoizedProps.revealOrder==="forwards"||l.memoizedProps.revealOrder==="backwards"||l.memoizedProps.revealOrder==="unstable_legacy-backwards"||l.memoizedProps.revealOrder==="together")){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var qs=0,sn=null,Bn=null,On=null,Va=!1,fo=!1,Mi=!1,Ga=0,Zo=0,ho=null,op=0;function Tn(){throw Error(n(321))}function Cl(a,l){if(l===null)return!1;for(var m=0;m<l.length&&m<a.length;m++)if(!ns(a[m],l[m]))return!1;return!0}function Sl(a,l,m,w,Se,Ge){return qs=Ge,sn=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,_e.H=a===null||a.memoizedState===null?jx:Ll,Mi=!1,Ge=m(w,Se),Mi=!1,fo&&(Ge=Yu(l,m,w,Se)),Wu(a),Ge}function Wu(a){_e.H=ea;var l=Bn!==null&&Bn.next!==null;if(qs=0,On=Bn=sn=null,Va=!1,Zo=0,ho=null,l)throw Error(n(300));a===null||Ln||(a=a.dependencies,a!==null&&Pa(a)&&(Ln=!0))}function Yu(a,l,m,w){sn=a;var Se=0;do{if(fo&&(ho=null),Zo=0,fo=!1,25<=Se)throw Error(n(301));if(Se+=1,On=Bn=null,a.updateQueue!=null){var Ge=a.updateQueue;Ge.lastEffect=null,Ge.events=null,Ge.stores=null,Ge.memoCache!=null&&(Ge.memoCache.index=0)}_e.H=Nx,Ge=l(m,w)}while(fo);return Ge}function ap(){var a=_e.H,l=a.useState()[0];return l=typeof l.then=="function"?Qo(l):l,a=a.useState()[0],(Bn!==null?Bn.memoizedState:null)!==a&&(sn.flags|=1024),l}function _l(){var a=Ga!==0;return Ga=0,a}function Rl(a,l,m){l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~m}function kl(a){if(Va){for(a=a.memoizedState;a!==null;){var l=a.queue;l!==null&&(l.pending=null),a=a.next}Va=!1}qs=0,On=Bn=sn=null,fo=!1,Zo=Ga=0,ho=null}function Yn(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return On===null?sn.memoizedState=On=a:On=On.next=a,On}function Mn(){if(Bn===null){var a=sn.alternate;a=a!==null?a.memoizedState:null}else a=Bn.next;var l=On===null?sn.memoizedState:On.next;if(l!==null)On=l,Bn=a;else{if(a===null)throw sn.alternate===null?Error(n(467)):Error(n(310));Bn=a,a={memoizedState:Bn.memoizedState,baseState:Bn.baseState,baseQueue:Bn.baseQueue,queue:Bn.queue,next:null},On===null?sn.memoizedState=On=a:On=On.next=a}return On}function Wa(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Qo(a){var l=Zo;return Zo+=1,ho===null&&(ho=[]),a=Uu(ho,a,l),l=sn,(On===null?l.memoizedState:On.next)===null&&(l=l.alternate,_e.H=l===null||l.memoizedState===null?jx:Ll),a}function Ya(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Qo(a);if(a.$$typeof===O)return Vn(a)}throw Error(n(438,String(a)))}function jl(a){var l=null,m=sn.updateQueue;if(m!==null&&(l=m.memoCache),l==null){var w=sn.alternate;w!==null&&(w=w.updateQueue,w!==null&&(w=w.memoCache,w!=null&&(l={data:w.data.map(function(Se){return Se.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),m===null&&(m=Wa(),sn.updateQueue=m),m.memoCache=l,m=l.data[l.index],m===void 0)for(m=l.data[l.index]=Array(a),w=0;w<a;w++)m[w]=it;return l.index++,m}function Ks(a,l){return typeof l=="function"?l(a):l}function Xa(a){var l=Mn();return Nl(l,Bn,a)}function Nl(a,l,m){var w=a.queue;if(w===null)throw Error(n(311));w.lastRenderedReducer=m;var Se=a.baseQueue,Ge=w.pending;if(Ge!==null){if(Se!==null){var Ot=Se.next;Se.next=Ge.next,Ge.next=Ot}l.baseQueue=Se=Ge,w.pending=null}if(Ge=a.baseState,Se===null)a.memoizedState=Ge;else{l=Se.next;var gr=Ot=null,kr=null,Ir=l,Hr=!1;do{var Kr=Ir.lane&-536870913;if(Kr!==Ir.lane?(xn&Kr)===Kr:(qs&Kr)===Kr){var Pr=Ir.revertLane;if(Pr===0)kr!==null&&(kr=kr.next={lane:0,revertLane:0,gesture:null,action:Ir.action,hasEagerState:Ir.hasEagerState,eagerState:Ir.eagerState,next:null}),Kr===ao&&(Hr=!0);else if((qs&Pr)===Pr){Ir=Ir.next,Pr===ao&&(Hr=!0);continue}else Kr={lane:0,revertLane:Ir.revertLane,gesture:null,action:Ir.action,hasEagerState:Ir.hasEagerState,eagerState:Ir.eagerState,next:null},kr===null?(gr=kr=Kr,Ot=Ge):kr=kr.next=Kr,sn.lanes|=Pr,di|=Pr;Kr=Ir.action,Mi&&m(Ge,Kr),Ge=Ir.hasEagerState?Ir.eagerState:m(Ge,Kr)}else Pr={lane:Kr,revertLane:Ir.revertLane,gesture:Ir.gesture,action:Ir.action,hasEagerState:Ir.hasEagerState,eagerState:Ir.eagerState,next:null},kr===null?(gr=kr=Pr,Ot=Ge):kr=kr.next=Pr,sn.lanes|=Kr,di|=Kr;Ir=Ir.next}while(Ir!==null&&Ir!==l);if(kr===null?Ot=Ge:kr.next=gr,!ns(Ge,a.memoizedState)&&(Ln=!0,Hr&&(m=co,m!==null)))throw m;a.memoizedState=Ge,a.baseState=Ot,a.baseQueue=kr,w.lastRenderedState=Ge}return Se===null&&(w.lanes=0),[a.memoizedState,w.dispatch]}function Dl(a){var l=Mn(),m=l.queue;if(m===null)throw Error(n(311));m.lastRenderedReducer=a;var w=m.dispatch,Se=m.pending,Ge=l.memoizedState;if(Se!==null){m.pending=null;var Ot=Se=Se.next;do Ge=a(Ge,Ot.action),Ot=Ot.next;while(Ot!==Se);ns(Ge,l.memoizedState)||(Ln=!0),l.memoizedState=Ge,l.baseQueue===null&&(l.baseState=Ge),m.lastRenderedState=Ge}return[Ge,w]}function Xu(a,l,m){var w=sn,Se=Mn(),Ge=hn;if(Ge){if(m===void 0)throw Error(n(407));m=m()}else m=l();var Ot=!ns((Bn||Se).memoizedState,m);if(Ot&&(Se.memoizedState=m,Ln=!0),Se=Se.queue,$l(Ju.bind(null,w,Se,a),[a]),Se.getSnapshot!==l||Ot||On!==null&&On.memoizedState.tag&1){if(w.flags|=2048,po(9,{destroy:void 0},Qu.bind(null,w,Se,m,l),null),Rn===null)throw Error(n(349));Ge||(qs&127)!==0||Zu(w,l,m)}return m}function Zu(a,l,m){a.flags|=16384,a={getSnapshot:l,value:m},l=sn.updateQueue,l===null?(l=Wa(),sn.updateQueue=l,l.stores=[a]):(m=l.stores,m===null?l.stores=[a]:m.push(a))}function Qu(a,l,m,w){l.value=m,l.getSnapshot=w,ex(l)&&tx(a)}function Ju(a,l,m){return m(function(){ex(l)&&tx(a)})}function ex(a){var l=a.getSnapshot;a=a.value;try{var m=l();return!ns(a,m)}catch{return!0}}function tx(a){var l=ki(a,2);l!==null&&rs(l,a,2)}function Fl(a){var l=Yn();if(typeof a=="function"){var m=a;if(a=m(),Mi){Sr(!0);try{m()}finally{Sr(!1)}}}return l.memoizedState=l.baseState=a,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:a},l}function rx(a,l,m,w){return a.baseState=m,Nl(a,Bn,typeof w=="function"?w:Ks)}function cp(a,l,m,w,Se){if(Ja(a))throw Error(n(485));if(a=l.action,a!==null){var Ge={payload:Se,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Ot){Ge.listeners.push(Ot)}};_e.T!==null?m(!0):Ge.isTransition=!1,w(Ge),m=l.pending,m===null?(Ge.next=l.pending=Ge,nx(l,Ge)):(Ge.next=m.next,l.pending=m.next=Ge)}}function nx(a,l){var m=l.action,w=l.payload,Se=a.state;if(l.isTransition){var Ge=_e.T,Ot={};_e.T=Ot;try{var gr=m(Se,w),kr=_e.S;kr!==null&&kr(Ot,gr),sx(a,l,gr)}catch(Ir){Tl(a,l,Ir)}finally{Ge!==null&&Ot.types!==null&&(Ge.types=Ot.types),_e.T=Ge}}else try{Ge=m(Se,w),sx(a,l,Ge)}catch(Ir){Tl(a,l,Ir)}}function sx(a,l,m){m!==null&&typeof m=="object"&&typeof m.then=="function"?m.then(function(w){ix(a,l,w)},function(w){return Tl(a,l,w)}):ix(a,l,m)}function ix(a,l,m){l.status="fulfilled",l.value=m,ox(l),a.state=m,l=a.pending,l!==null&&(m=l.next,m===l?a.pending=null:(m=m.next,l.next=m,nx(a,m)))}function Tl(a,l,m){var w=a.pending;if(a.pending=null,w!==null){w=w.next;do l.status="rejected",l.reason=m,ox(l),l=l.next;while(l!==w)}a.action=null}function ox(a){a=a.listeners;for(var l=0;l<a.length;l++)(0,a[l])()}function ax(a,l){return l}function cx(a,l){if(hn){var m=Rn.formState;if(m!==null){e:{var w=sn;if(hn){if(kn){t:{for(var Se=kn,Ge=ys;Se.nodeType!==8;){if(!Ge){Se=null;break t}if(Se=bs(Se.nextSibling),Se===null){Se=null;break t}}Ge=Se.data,Se=Ge==="F!"||Ge==="F"?Se:null}if(Se){kn=bs(Se.nextSibling),w=Se.data==="F!";break e}}ni(w)}w=!1}w&&(l=m[0])}}return m=Yn(),m.memoizedState=m.baseState=l,w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ax,lastRenderedState:l},m.queue=w,m=_x.bind(null,sn,w),w.dispatch=m,w=Fl(!1),Ge=Ol.bind(null,sn,!1,w.queue),w=Yn(),Se={state:l,dispatch:null,action:a,pending:null},w.queue=Se,m=cp.bind(null,sn,Se,Ge,m),Se.dispatch=m,w.memoizedState=a,[l,m,!1]}function lx(a){var l=Mn();return ux(l,Bn,a)}function ux(a,l,m){if(l=Nl(a,l,ax)[0],a=Xa(Ks)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var w=Qo(l)}catch(Ot){throw Ot===lo?Oa:Ot}else w=l;l=Mn();var Se=l.queue,Ge=Se.dispatch;return m!==l.memoizedState&&(sn.flags|=2048,po(9,{destroy:void 0},lp.bind(null,Se,m),null)),[w,Ge,a]}function lp(a,l){a.action=l}function xx(a){var l=Mn(),m=Bn;if(m!==null)return ux(l,m,a);Mn(),l=l.memoizedState,m=Mn();var w=m.queue.dispatch;return m.memoizedState=a,[l,w,!1]}function po(a,l,m,w){return a={tag:a,create:m,deps:w,inst:l,next:null},l=sn.updateQueue,l===null&&(l=Wa(),sn.updateQueue=l),m=l.lastEffect,m===null?l.lastEffect=a.next=a:(w=m.next,m.next=a,a.next=w,l.lastEffect=a),a}function dx(){return Mn().memoizedState}function Za(a,l,m,w){var Se=Yn();sn.flags|=a,Se.memoizedState=po(1|l,{destroy:void 0},m,w===void 0?null:w)}function Qa(a,l,m,w){var Se=Mn();w=w===void 0?null:w;var Ge=Se.memoizedState.inst;Bn!==null&&w!==null&&Cl(w,Bn.memoizedState.deps)?Se.memoizedState=po(l,Ge,m,w):(sn.flags|=a,Se.memoizedState=po(1|l,Ge,m,w))}function fx(a,l){Za(8390656,8,a,l)}function $l(a,l){Qa(2048,8,a,l)}function up(a){sn.flags|=4;var l=sn.updateQueue;if(l===null)l=Wa(),sn.updateQueue=l,l.events=[a];else{var m=l.events;m===null?l.events=[a]:m.push(a)}}function hx(a){var l=Mn().memoizedState;return up({ref:l,nextImpl:a}),function(){if((yn&2)!==0)throw Error(n(440));return l.impl.apply(void 0,arguments)}}function px(a,l){return Qa(4,2,a,l)}function mx(a,l){return Qa(4,4,a,l)}function gx(a,l){if(typeof l=="function"){a=a();var m=l(a);return function(){typeof m=="function"?m():l(null)}}if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function yx(a,l,m){m=m!=null?m.concat([a]):null,Qa(4,4,gx.bind(null,l,a),m)}function Il(){}function Ex(a,l){var m=Mn();l=l===void 0?null:l;var w=m.memoizedState;return l!==null&&Cl(l,w[1])?w[0]:(m.memoizedState=[a,l],a)}function bx(a,l){var m=Mn();l=l===void 0?null:l;var w=m.memoizedState;if(l!==null&&Cl(l,w[1]))return w[0];if(w=a(),Mi){Sr(!0);try{a()}finally{Sr(!1)}}return m.memoizedState=[w,l],w}function Pl(a,l,m){return m===void 0||(qs&1073741824)!==0&&(xn&261930)===0?a.memoizedState=l:(a.memoizedState=m,a=wd(),sn.lanes|=a,di|=a,m)}function wx(a,l,m,w){return ns(m,l)?m:xo.current!==null?(a=Pl(a,m,w),ns(a,l)||(Ln=!0),a):(qs&42)===0||(qs&1073741824)!==0&&(xn&261930)===0?(Ln=!0,a.memoizedState=m):(a=wd(),sn.lanes|=a,di|=a,l)}function vx(a,l,m,w,Se){var Ge=Le.p;Le.p=Ge!==0&&8>Ge?Ge:8;var Ot=_e.T,gr={};_e.T=gr,Ol(a,!1,l,m);try{var kr=Se(),Ir=_e.S;if(Ir!==null&&Ir(gr,kr),kr!==null&&typeof kr=="object"&&typeof kr.then=="function"){var Hr=ip(kr,w);Jo(a,l,Hr,us(a))}else Jo(a,l,w,us(a))}catch(Kr){Jo(a,l,{then:function(){},status:"rejected",reason:Kr},us())}finally{Le.p=Ge,Ot!==null&&gr.types!==null&&(Ot.types=gr.types),_e.T=Ot}}function xp(){}function Ml(a,l,m,w){if(a.tag!==5)throw Error(n(476));var Se=Ax(a).queue;vx(a,Se,l,Ye,m===null?xp:function(){return Bx(a),m(w)})}function Ax(a){var l=a.memoizedState;if(l!==null)return l;l={memoizedState:Ye,baseState:Ye,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:Ye},next:null};var m={};return l.next={memoizedState:m,baseState:m,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:m},next:null},a.memoizedState=l,a=a.alternate,a!==null&&(a.memoizedState=l),l}function Bx(a){var l=Ax(a);l.next===null&&(l=a.alternate.memoizedState),Jo(a,l.next.queue,{},us())}function Ul(){return Vn(ma)}function Cx(){return Mn().memoizedState}function Sx(){return Mn().memoizedState}function dp(a){for(var l=a.return;l!==null;){switch(l.tag){case 24:case 3:var m=us();a=oi(m);var w=ai(l,a,m);w!==null&&(rs(w,l,m),Wo(w,l,m)),l={cache:hl()},a.payload=l;return}l=l.return}}function fp(a,l,m){var w=us();m={lane:w,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},Ja(a)?Rx(l,m):(m=nl(a,l,m,w),m!==null&&(rs(m,a,w),kx(m,l,w)))}function _x(a,l,m){var w=us();Jo(a,l,m,w)}function Jo(a,l,m,w){var Se={lane:w,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null};if(Ja(a))Rx(l,Se);else{var Ge=a.alternate;if(a.lanes===0&&(Ge===null||Ge.lanes===0)&&(Ge=l.lastRenderedReducer,Ge!==null))try{var Ot=l.lastRenderedState,gr=Ge(Ot,m);if(Se.hasEagerState=!0,Se.eagerState=gr,ns(gr,Ot))return Fa(a,l,Se,0),Rn===null&&Da(),!1}catch{}finally{}if(m=nl(a,l,Se,w),m!==null)return rs(m,a,w),kx(m,l,w),!0}return!1}function Ol(a,l,m,w){if(w={lane:2,revertLane:y0(),gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null},Ja(a)){if(l)throw Error(n(479))}else l=nl(a,m,w,2),l!==null&&rs(l,a,2)}function Ja(a){var l=a.alternate;return a===sn||l!==null&&l===sn}function Rx(a,l){fo=Va=!0;var m=a.pending;m===null?l.next=l:(l.next=m.next,m.next=l),a.pending=l}function kx(a,l,m){if((m&4194048)!==0){var w=l.lanes;w&=a.pendingLanes,m|=w,l.lanes=m,jr(a,m)}}var ea={readContext:Vn,use:Ya,useCallback:Tn,useContext:Tn,useEffect:Tn,useImperativeHandle:Tn,useLayoutEffect:Tn,useInsertionEffect:Tn,useMemo:Tn,useReducer:Tn,useRef:Tn,useState:Tn,useDebugValue:Tn,useDeferredValue:Tn,useTransition:Tn,useSyncExternalStore:Tn,useId:Tn,useHostTransitionStatus:Tn,useFormState:Tn,useActionState:Tn,useOptimistic:Tn,useMemoCache:Tn,useCacheRefresh:Tn};ea.useEffectEvent=Tn;var jx={readContext:Vn,use:Ya,useCallback:function(a,l){return Yn().memoizedState=[a,l===void 0?null:l],a},useContext:Vn,useEffect:fx,useImperativeHandle:function(a,l,m){m=m!=null?m.concat([a]):null,Za(4194308,4,gx.bind(null,l,a),m)},useLayoutEffect:function(a,l){return Za(4194308,4,a,l)},useInsertionEffect:function(a,l){Za(4,2,a,l)},useMemo:function(a,l){var m=Yn();l=l===void 0?null:l;var w=a();if(Mi){Sr(!0);try{a()}finally{Sr(!1)}}return m.memoizedState=[w,l],w},useReducer:function(a,l,m){var w=Yn();if(m!==void 0){var Se=m(l);if(Mi){Sr(!0);try{m(l)}finally{Sr(!1)}}}else Se=l;return w.memoizedState=w.baseState=Se,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:Se},w.queue=a,a=a.dispatch=fp.bind(null,sn,a),[w.memoizedState,a]},useRef:function(a){var l=Yn();return a={current:a},l.memoizedState=a},useState:function(a){a=Fl(a);var l=a.queue,m=_x.bind(null,sn,l);return l.dispatch=m,[a.memoizedState,m]},useDebugValue:Il,useDeferredValue:function(a,l){var m=Yn();return Pl(m,a,l)},useTransition:function(){var a=Fl(!1);return a=vx.bind(null,sn,a.queue,!0,!1),Yn().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,l,m){var w=sn,Se=Yn();if(hn){if(m===void 0)throw Error(n(407));m=m()}else{if(m=l(),Rn===null)throw Error(n(349));(xn&127)!==0||Zu(w,l,m)}Se.memoizedState=m;var Ge={value:m,getSnapshot:l};return Se.queue=Ge,fx(Ju.bind(null,w,Ge,a),[a]),w.flags|=2048,po(9,{destroy:void 0},Qu.bind(null,w,Ge,m,l),null),m},useId:function(){var a=Yn(),l=Rn.identifierPrefix;if(hn){var m=Ns,w=js;m=(w&~(1<<32-Rr(w)-1)).toString(32)+m,l="_"+l+"R_"+m,m=Ga++,0<m&&(l+="H"+m.toString(32)),l+="_"}else m=op++,l="_"+l+"r_"+m.toString(32)+"_";return a.memoizedState=l},useHostTransitionStatus:Ul,useFormState:cx,useActionState:cx,useOptimistic:function(a){var l=Yn();l.memoizedState=l.baseState=a;var m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=m,l=Ol.bind(null,sn,!0,m),m.dispatch=l,[a,l]},useMemoCache:jl,useCacheRefresh:function(){return Yn().memoizedState=dp.bind(null,sn)},useEffectEvent:function(a){var l=Yn(),m={impl:a};return l.memoizedState=m,function(){if((yn&2)!==0)throw Error(n(440));return m.impl.apply(void 0,arguments)}}},Ll={readContext:Vn,use:Ya,useCallback:Ex,useContext:Vn,useEffect:$l,useImperativeHandle:yx,useInsertionEffect:px,useLayoutEffect:mx,useMemo:bx,useReducer:Xa,useRef:dx,useState:function(){return Xa(Ks)},useDebugValue:Il,useDeferredValue:function(a,l){var m=Mn();return wx(m,Bn.memoizedState,a,l)},useTransition:function(){var a=Xa(Ks)[0],l=Mn().memoizedState;return[typeof a=="boolean"?a:Qo(a),l]},useSyncExternalStore:Xu,useId:Cx,useHostTransitionStatus:Ul,useFormState:lx,useActionState:lx,useOptimistic:function(a,l){var m=Mn();return rx(m,Bn,a,l)},useMemoCache:jl,useCacheRefresh:Sx};Ll.useEffectEvent=hx;var Nx={readContext:Vn,use:Ya,useCallback:Ex,useContext:Vn,useEffect:$l,useImperativeHandle:yx,useInsertionEffect:px,useLayoutEffect:mx,useMemo:bx,useReducer:Dl,useRef:dx,useState:function(){return Dl(Ks)},useDebugValue:Il,useDeferredValue:function(a,l){var m=Mn();return Bn===null?Pl(m,a,l):wx(m,Bn.memoizedState,a,l)},useTransition:function(){var a=Dl(Ks)[0],l=Mn().memoizedState;return[typeof a=="boolean"?a:Qo(a),l]},useSyncExternalStore:Xu,useId:Cx,useHostTransitionStatus:Ul,useFormState:xx,useActionState:xx,useOptimistic:function(a,l){var m=Mn();return Bn!==null?rx(m,Bn,a,l):(m.baseState=a,[a,m.queue.dispatch])},useMemoCache:jl,useCacheRefresh:Sx};Nx.useEffectEvent=hx;function Hl(a,l,m,w){l=a.memoizedState,m=m(w,l),m=m==null?l:g({},l,m),a.memoizedState=m,a.lanes===0&&(a.updateQueue.baseState=m)}var ql={enqueueSetState:function(a,l,m){a=a._reactInternals;var w=us(),Se=oi(w);Se.payload=l,m!=null&&(Se.callback=m),l=ai(a,Se,w),l!==null&&(rs(l,a,w),Wo(l,a,w))},enqueueReplaceState:function(a,l,m){a=a._reactInternals;var w=us(),Se=oi(w);Se.tag=1,Se.payload=l,m!=null&&(Se.callback=m),l=ai(a,Se,w),l!==null&&(rs(l,a,w),Wo(l,a,w))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var m=us(),w=oi(m);w.tag=2,l!=null&&(w.callback=l),l=ai(a,w,m),l!==null&&(rs(l,a,m),Wo(l,a,m))}};function Dx(a,l,m,w,Se,Ge,Ot){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(w,Ge,Ot):l.prototype&&l.prototype.isPureReactComponent?!Oo(m,w)||!Oo(Se,Ge):!0}function Fx(a,l,m,w){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(m,w),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(m,w),l.state!==a&&ql.enqueueReplaceState(l,l.state,null)}function Ui(a,l){var m=l;if("ref"in l){m={};for(var w in l)w!=="ref"&&(m[w]=l[w])}if(a=a.defaultProps){m===l&&(m=g({},m));for(var Se in a)m[Se]===void 0&&(m[Se]=a[Se])}return m}function Tx(a){Na(a)}function $x(a){console.error(a)}function Ix(a){Na(a)}function ec(a,l){try{var m=a.onUncaughtError;m(l.value,{componentStack:l.stack})}catch(w){setTimeout(function(){throw w})}}function Px(a,l,m){try{var w=a.onCaughtError;w(m.value,{componentStack:m.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(Se){setTimeout(function(){throw Se})}}function Kl(a,l,m){return m=oi(m),m.tag=3,m.payload={element:null},m.callback=function(){ec(a,l)},m}function Mx(a){return a=oi(a),a.tag=3,a}function Ux(a,l,m,w){var Se=m.type.getDerivedStateFromError;if(typeof Se=="function"){var Ge=w.value;a.payload=function(){return Se(Ge)},a.callback=function(){Px(l,m,w)}}var Ot=m.stateNode;Ot!==null&&typeof Ot.componentDidCatch=="function"&&(a.callback=function(){Px(l,m,w),typeof Se!="function"&&(fi===null?fi=new Set([this]):fi.add(this));var gr=w.stack;this.componentDidCatch(w.value,{componentStack:gr!==null?gr:""})})}function hp(a,l,m,w,Se){if(m.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){if(l=m.alternate,l!==null&&oo(l,m,Se,!0),m=os.current,m!==null){switch(m.tag){case 31:case 13:return Es===null?dc():m.alternate===null&&$n===0&&($n=3),m.flags&=-257,m.flags|=65536,m.lanes=Se,w===La?m.flags|=16384:(l=m.updateQueue,l===null?m.updateQueue=new Set([w]):l.add(w),p0(a,w,Se)),!1;case 22:return m.flags|=65536,w===La?m.flags|=16384:(l=m.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([w])},m.updateQueue=l):(m=l.retryQueue,m===null?l.retryQueue=new Set([w]):m.add(w)),p0(a,w,Se)),!1}throw Error(n(435,m.tag))}return p0(a,w,Se),dc(),!1}if(hn)return l=os.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=Se,w!==ll&&(a=Error(n(422),{cause:w}),qo(hs(a,m)))):(w!==ll&&(l=Error(n(423),{cause:w}),qo(hs(l,m))),a=a.current.alternate,a.flags|=65536,Se&=-Se,a.lanes|=Se,w=hs(w,m),Se=Kl(a.stateNode,w,Se),bl(a,Se),$n!==4&&($n=2)),!1;var Ge=Error(n(520),{cause:w});if(Ge=hs(Ge,m),ca===null?ca=[Ge]:ca.push(Ge),$n!==4&&($n=2),l===null)return!0;w=hs(w,m),m=l;do{switch(m.tag){case 3:return m.flags|=65536,a=Se&-Se,m.lanes|=a,a=Kl(m.stateNode,w,a),bl(m,a),!1;case 1:if(l=m.type,Ge=m.stateNode,(m.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||Ge!==null&&typeof Ge.componentDidCatch=="function"&&(fi===null||!fi.has(Ge))))return m.flags|=65536,Se&=-Se,m.lanes|=Se,Se=Mx(Se),Ux(Se,a,m,w),bl(m,Se),!1}m=m.return}while(m!==null);return!1}var zl=Error(n(461)),Ln=!1;function Gn(a,l,m,w){l.child=a===null?qu(l,null,m,w):Pi(l,a.child,m,w)}function Ox(a,l,m,w,Se){m=m.render;var Ge=l.ref;if("ref"in w){var Ot={};for(var gr in w)gr!=="ref"&&(Ot[gr]=w[gr])}else Ot=w;return Fi(l),w=Sl(a,l,m,Ot,Ge,Se),gr=_l(),a!==null&&!Ln?(Rl(a,l,Se),zs(a,l,Se)):(hn&&gr&&al(l),l.flags|=1,Gn(a,l,w,Se),l.child)}function Lx(a,l,m,w,Se){if(a===null){var Ge=m.type;return typeof Ge=="function"&&!sl(Ge)&&Ge.defaultProps===void 0&&m.compare===null?(l.tag=15,l.type=Ge,Hx(a,l,Ge,w,Se)):(a=$a(m.type,null,w,l,l.mode,Se),a.ref=l.ref,a.return=l,l.child=a)}if(Ge=a.child,!Jl(a,Se)){var Ot=Ge.memoizedProps;if(m=m.compare,m=m!==null?m:Oo,m(Ot,w)&&a.ref===l.ref)return zs(a,l,Se)}return l.flags|=1,a=Us(Ge,w),a.ref=l.ref,a.return=l,l.child=a}function Hx(a,l,m,w,Se){if(a!==null){var Ge=a.memoizedProps;if(Oo(Ge,w)&&a.ref===l.ref)if(Ln=!1,l.pendingProps=w=Ge,Jl(a,Se))(a.flags&131072)!==0&&(Ln=!0);else return l.lanes=a.lanes,zs(a,l,Se)}return Vl(a,l,m,w,Se)}function qx(a,l,m,w){var Se=w.children,Ge=a!==null?a.memoizedState:null;if(a===null&&l.stateNode===null&&(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),w.mode==="hidden"){if((l.flags&128)!==0){if(Ge=Ge!==null?Ge.baseLanes|m:m,a!==null){for(w=l.child=a.child,Se=0;w!==null;)Se=Se|w.lanes|w.childLanes,w=w.sibling;w=Se&~Ge}else w=0,l.child=null;return Kx(a,l,Ge,m,w)}if((m&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},a!==null&&Ua(l,Ge!==null?Ge.cachePool:null),Ge!==null?Vu(l,Ge):vl(),Gu(l);else return w=l.lanes=536870912,Kx(a,l,Ge!==null?Ge.baseLanes|m:m,m,w)}else Ge!==null?(Ua(l,Ge.cachePool),Vu(l,Ge),li(),l.memoizedState=null):(a!==null&&Ua(l,null),vl(),li());return Gn(a,l,Se,m),l.child}function ta(a,l){return a!==null&&a.tag===22||l.stateNode!==null||(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.sibling}function Kx(a,l,m,w,Se){var Ge=ml();return Ge=Ge===null?null:{parent:Un._currentValue,pool:Ge},l.memoizedState={baseLanes:m,cachePool:Ge},a!==null&&Ua(l,null),vl(),Gu(l),a!==null&&oo(a,l,w,!0),l.childLanes=Se,null}function tc(a,l){return l=nc({mode:l.mode,children:l.children},a.mode),l.ref=a.ref,a.child=l,l.return=a,l}function zx(a,l,m){return Pi(l,a.child,null,m),a=tc(l,l.pendingProps),a.flags|=2,as(l),l.memoizedState=null,a}function pp(a,l,m){var w=l.pendingProps,Se=(l.flags&128)!==0;if(l.flags&=-129,a===null){if(hn){if(w.mode==="hidden")return a=tc(l,w),l.lanes=536870912,ta(null,a);if(Bl(l),(a=kn)?(a=nf(a,ys),a=a!==null&&a.data==="&"?a:null,a!==null&&(l.memoizedState={dehydrated:a,treeContext:ti!==null?{id:js,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},m=Ru(a),m.return=l,l.child=m,zn=l,kn=null)):a=null,a===null)throw ni(l);return l.lanes=536870912,null}return tc(l,w)}var Ge=a.memoizedState;if(Ge!==null){var Ot=Ge.dehydrated;if(Bl(l),Se)if(l.flags&256)l.flags&=-257,l=zx(a,l,m);else if(l.memoizedState!==null)l.child=a.child,l.flags|=128,l=null;else throw Error(n(558));else if(Ln||oo(a,l,m,!1),Se=(m&a.childLanes)!==0,Ln||Se){if(w=Rn,w!==null&&(Ot=Mr(w,m),Ot!==0&&Ot!==Ge.retryLane))throw Ge.retryLane=Ot,ki(a,Ot),rs(w,a,Ot),zl;dc(),l=zx(a,l,m)}else a=Ge.treeContext,kn=bs(Ot.nextSibling),zn=l,hn=!0,ri=null,ys=!1,a!==null&&Nu(l,a),l=tc(l,w),l.flags|=4096;return l}return a=Us(a.child,{mode:w.mode,children:w.children}),a.ref=l.ref,l.child=a,a.return=l,a}function rc(a,l){var m=l.ref;if(m===null)a!==null&&a.ref!==null&&(l.flags|=4194816);else{if(typeof m!="function"&&typeof m!="object")throw Error(n(284));(a===null||a.ref!==m)&&(l.flags|=4194816)}}function Vl(a,l,m,w,Se){return Fi(l),m=Sl(a,l,m,w,void 0,Se),w=_l(),a!==null&&!Ln?(Rl(a,l,Se),zs(a,l,Se)):(hn&&w&&al(l),l.flags|=1,Gn(a,l,m,Se),l.child)}function Vx(a,l,m,w,Se,Ge){return Fi(l),l.updateQueue=null,m=Yu(l,w,m,Se),Wu(a),w=_l(),a!==null&&!Ln?(Rl(a,l,Ge),zs(a,l,Ge)):(hn&&w&&al(l),l.flags|=1,Gn(a,l,m,Ge),l.child)}function Gx(a,l,m,w,Se){if(Fi(l),l.stateNode===null){var Ge=ro,Ot=m.contextType;typeof Ot=="object"&&Ot!==null&&(Ge=Vn(Ot)),Ge=new m(w,Ge),l.memoizedState=Ge.state!==null&&Ge.state!==void 0?Ge.state:null,Ge.updater=ql,l.stateNode=Ge,Ge._reactInternals=l,Ge=l.stateNode,Ge.props=w,Ge.state=l.memoizedState,Ge.refs={},yl(l),Ot=m.contextType,Ge.context=typeof Ot=="object"&&Ot!==null?Vn(Ot):ro,Ge.state=l.memoizedState,Ot=m.getDerivedStateFromProps,typeof Ot=="function"&&(Hl(l,m,Ot,w),Ge.state=l.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof Ge.getSnapshotBeforeUpdate=="function"||typeof Ge.UNSAFE_componentWillMount!="function"&&typeof Ge.componentWillMount!="function"||(Ot=Ge.state,typeof Ge.componentWillMount=="function"&&Ge.componentWillMount(),typeof Ge.UNSAFE_componentWillMount=="function"&&Ge.UNSAFE_componentWillMount(),Ot!==Ge.state&&ql.enqueueReplaceState(Ge,Ge.state,null),Xo(l,w,Ge,Se),Yo(),Ge.state=l.memoizedState),typeof Ge.componentDidMount=="function"&&(l.flags|=4194308),w=!0}else if(a===null){Ge=l.stateNode;var gr=l.memoizedProps,kr=Ui(m,gr);Ge.props=kr;var Ir=Ge.context,Hr=m.contextType;Ot=ro,typeof Hr=="object"&&Hr!==null&&(Ot=Vn(Hr));var Kr=m.getDerivedStateFromProps;Hr=typeof Kr=="function"||typeof Ge.getSnapshotBeforeUpdate=="function",gr=l.pendingProps!==gr,Hr||typeof Ge.UNSAFE_componentWillReceiveProps!="function"&&typeof Ge.componentWillReceiveProps!="function"||(gr||Ir!==Ot)&&Fx(l,Ge,w,Ot),ii=!1;var Pr=l.memoizedState;Ge.state=Pr,Xo(l,w,Ge,Se),Yo(),Ir=l.memoizedState,gr||Pr!==Ir||ii?(typeof Kr=="function"&&(Hl(l,m,Kr,w),Ir=l.memoizedState),(kr=ii||Dx(l,m,kr,w,Pr,Ir,Ot))?(Hr||typeof Ge.UNSAFE_componentWillMount!="function"&&typeof Ge.componentWillMount!="function"||(typeof Ge.componentWillMount=="function"&&Ge.componentWillMount(),typeof Ge.UNSAFE_componentWillMount=="function"&&Ge.UNSAFE_componentWillMount()),typeof Ge.componentDidMount=="function"&&(l.flags|=4194308)):(typeof Ge.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=w,l.memoizedState=Ir),Ge.props=w,Ge.state=Ir,Ge.context=Ot,w=kr):(typeof Ge.componentDidMount=="function"&&(l.flags|=4194308),w=!1)}else{Ge=l.stateNode,El(a,l),Ot=l.memoizedProps,Hr=Ui(m,Ot),Ge.props=Hr,Kr=l.pendingProps,Pr=Ge.context,Ir=m.contextType,kr=ro,typeof Ir=="object"&&Ir!==null&&(kr=Vn(Ir)),gr=m.getDerivedStateFromProps,(Ir=typeof gr=="function"||typeof Ge.getSnapshotBeforeUpdate=="function")||typeof Ge.UNSAFE_componentWillReceiveProps!="function"&&typeof Ge.componentWillReceiveProps!="function"||(Ot!==Kr||Pr!==kr)&&Fx(l,Ge,w,kr),ii=!1,Pr=l.memoizedState,Ge.state=Pr,Xo(l,w,Ge,Se),Yo();var Ur=l.memoizedState;Ot!==Kr||Pr!==Ur||ii||a!==null&&a.dependencies!==null&&Pa(a.dependencies)?(typeof gr=="function"&&(Hl(l,m,gr,w),Ur=l.memoizedState),(Hr=ii||Dx(l,m,Hr,w,Pr,Ur,kr)||a!==null&&a.dependencies!==null&&Pa(a.dependencies))?(Ir||typeof Ge.UNSAFE_componentWillUpdate!="function"&&typeof Ge.componentWillUpdate!="function"||(typeof Ge.componentWillUpdate=="function"&&Ge.componentWillUpdate(w,Ur,kr),typeof Ge.UNSAFE_componentWillUpdate=="function"&&Ge.UNSAFE_componentWillUpdate(w,Ur,kr)),typeof Ge.componentDidUpdate=="function"&&(l.flags|=4),typeof Ge.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof Ge.componentDidUpdate!="function"||Ot===a.memoizedProps&&Pr===a.memoizedState||(l.flags|=4),typeof Ge.getSnapshotBeforeUpdate!="function"||Ot===a.memoizedProps&&Pr===a.memoizedState||(l.flags|=1024),l.memoizedProps=w,l.memoizedState=Ur),Ge.props=w,Ge.state=Ur,Ge.context=kr,w=Hr):(typeof Ge.componentDidUpdate!="function"||Ot===a.memoizedProps&&Pr===a.memoizedState||(l.flags|=4),typeof Ge.getSnapshotBeforeUpdate!="function"||Ot===a.memoizedProps&&Pr===a.memoizedState||(l.flags|=1024),w=!1)}return Ge=w,rc(a,l),w=(l.flags&128)!==0,Ge||w?(Ge=l.stateNode,m=w&&typeof m.getDerivedStateFromError!="function"?null:Ge.render(),l.flags|=1,a!==null&&w?(l.child=Pi(l,a.child,null,Se),l.child=Pi(l,null,m,Se)):Gn(a,l,m,Se),l.memoizedState=Ge.state,a=l.child):a=zs(a,l,Se),a}function Wx(a,l,m,w){return Ni(),l.flags|=256,Gn(a,l,m,w),l.child}var Gl={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Wl(a){return{baseLanes:a,cachePool:Pu()}}function Yl(a,l,m){return a=a!==null?a.childLanes&~m:0,l&&(a|=ls),a}function Yx(a,l,m){var w=l.pendingProps,Se=!1,Ge=(l.flags&128)!==0,Ot;if((Ot=Ge)||(Ot=a!==null&&a.memoizedState===null?!1:(Pn.current&2)!==0),Ot&&(Se=!0,l.flags&=-129),Ot=(l.flags&32)!==0,l.flags&=-33,a===null){if(hn){if(Se?ci(l):li(),(a=kn)?(a=nf(a,ys),a=a!==null&&a.data!=="&"?a:null,a!==null&&(l.memoizedState={dehydrated:a,treeContext:ti!==null?{id:js,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},m=Ru(a),m.return=l,l.child=m,zn=l,kn=null)):a=null,a===null)throw ni(l);return N0(a)?l.lanes=32:l.lanes=536870912,null}var gr=w.children;return w=w.fallback,Se?(li(),Se=l.mode,gr=nc({mode:"hidden",children:gr},Se),w=ji(w,Se,m,null),gr.return=l,w.return=l,gr.sibling=w,l.child=gr,w=l.child,w.memoizedState=Wl(m),w.childLanes=Yl(a,Ot,m),l.memoizedState=Gl,ta(null,w)):(ci(l),Xl(l,gr))}var kr=a.memoizedState;if(kr!==null&&(gr=kr.dehydrated,gr!==null)){if(Ge)l.flags&256?(ci(l),l.flags&=-257,l=Zl(a,l,m)):l.memoizedState!==null?(li(),l.child=a.child,l.flags|=128,l=null):(li(),gr=w.fallback,Se=l.mode,w=nc({mode:"visible",children:w.children},Se),gr=ji(gr,Se,m,null),gr.flags|=2,w.return=l,gr.return=l,w.sibling=gr,l.child=w,Pi(l,a.child,null,m),w=l.child,w.memoizedState=Wl(m),w.childLanes=Yl(a,Ot,m),l.memoizedState=Gl,l=ta(null,w));else if(ci(l),N0(gr)){if(Ot=gr.nextSibling&&gr.nextSibling.dataset,Ot)var Ir=Ot.dgst;Ot=Ir,w=Error(n(419)),w.stack="",w.digest=Ot,qo({value:w,source:null,stack:null}),l=Zl(a,l,m)}else if(Ln||oo(a,l,m,!1),Ot=(m&a.childLanes)!==0,Ln||Ot){if(Ot=Rn,Ot!==null&&(w=Mr(Ot,m),w!==0&&w!==kr.retryLane))throw kr.retryLane=w,ki(a,w),rs(Ot,a,w),zl;j0(gr)||dc(),l=Zl(a,l,m)}else j0(gr)?(l.flags|=192,l.child=a.child,l=null):(a=kr.treeContext,kn=bs(gr.nextSibling),zn=l,hn=!0,ri=null,ys=!1,a!==null&&Nu(l,a),l=Xl(l,w.children),l.flags|=4096);return l}return Se?(li(),gr=w.fallback,Se=l.mode,kr=a.child,Ir=kr.sibling,w=Us(kr,{mode:"hidden",children:w.children}),w.subtreeFlags=kr.subtreeFlags&65011712,Ir!==null?gr=Us(Ir,gr):(gr=ji(gr,Se,m,null),gr.flags|=2),gr.return=l,w.return=l,w.sibling=gr,l.child=w,ta(null,w),w=l.child,gr=a.child.memoizedState,gr===null?gr=Wl(m):(Se=gr.cachePool,Se!==null?(kr=Un._currentValue,Se=Se.parent!==kr?{parent:kr,pool:kr}:Se):Se=Pu(),gr={baseLanes:gr.baseLanes|m,cachePool:Se}),w.memoizedState=gr,w.childLanes=Yl(a,Ot,m),l.memoizedState=Gl,ta(a.child,w)):(ci(l),m=a.child,a=m.sibling,m=Us(m,{mode:"visible",children:w.children}),m.return=l,m.sibling=null,a!==null&&(Ot=l.deletions,Ot===null?(l.deletions=[a],l.flags|=16):Ot.push(a)),l.child=m,l.memoizedState=null,m)}function Xl(a,l){return l=nc({mode:"visible",children:l},a.mode),l.return=a,a.child=l}function nc(a,l){return a=ss(22,a,null,l),a.lanes=0,a}function Zl(a,l,m){return Pi(l,a.child,null,m),a=Xl(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function Xx(a,l,m){a.lanes|=l;var w=a.alternate;w!==null&&(w.lanes|=l),dl(a.return,l,m)}function Ql(a,l,m,w,Se,Ge){var Ot=a.memoizedState;Ot===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:w,tail:m,tailMode:Se,treeForkCount:Ge}:(Ot.isBackwards=l,Ot.rendering=null,Ot.renderingStartTime=0,Ot.last=w,Ot.tail=m,Ot.tailMode=Se,Ot.treeForkCount=Ge)}function Zx(a,l,m){var w=l.pendingProps,Se=w.revealOrder,Ge=w.tail;w=w.children;var Ot=Pn.current,gr=(Ot&2)!==0;if(gr?(Ot=Ot&1|2,l.flags|=128):Ot&=1,dt(Pn,Ot),Gn(a,l,w,m),w=hn?Ho:0,!gr&&a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Xx(a,m,l);else if(a.tag===19)Xx(a,m,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(Se){case"forwards":for(m=l.child,Se=null;m!==null;)a=m.alternate,a!==null&&za(a)===null&&(Se=m),m=m.sibling;m=Se,m===null?(Se=l.child,l.child=null):(Se=m.sibling,m.sibling=null),Ql(l,!1,Se,m,Ge,w);break;case"backwards":case"unstable_legacy-backwards":for(m=null,Se=l.child,l.child=null;Se!==null;){if(a=Se.alternate,a!==null&&za(a)===null){l.child=Se;break}a=Se.sibling,Se.sibling=m,m=Se,Se=a}Ql(l,!0,m,null,Ge,w);break;case"together":Ql(l,!1,null,null,void 0,w);break;default:l.memoizedState=null}return l.child}function zs(a,l,m){if(a!==null&&(l.dependencies=a.dependencies),di|=l.lanes,(m&l.childLanes)===0)if(a!==null){if(oo(a,l,m,!1),(m&l.childLanes)===0)return null}else return null;if(a!==null&&l.child!==a.child)throw Error(n(153));if(l.child!==null){for(a=l.child,m=Us(a,a.pendingProps),l.child=m,m.return=l;a.sibling!==null;)a=a.sibling,m=m.sibling=Us(a,a.pendingProps),m.return=l;m.sibling=null}return l.child}function Jl(a,l){return(a.lanes&l)!==0?!0:(a=a.dependencies,!!(a!==null&&Pa(a)))}function mp(a,l,m){switch(l.tag){case 3:fr(l,l.stateNode.containerInfo),si(l,Un,a.memoizedState.cache),Ni();break;case 27:case 5:ft(l);break;case 4:fr(l,l.stateNode.containerInfo);break;case 10:si(l,l.type,l.memoizedProps.value);break;case 31:if(l.memoizedState!==null)return l.flags|=128,Bl(l),null;break;case 13:var w=l.memoizedState;if(w!==null)return w.dehydrated!==null?(ci(l),l.flags|=128,null):(m&l.child.childLanes)!==0?Yx(a,l,m):(ci(l),a=zs(a,l,m),a!==null?a.sibling:null);ci(l);break;case 19:var Se=(a.flags&128)!==0;if(w=(m&l.childLanes)!==0,w||(oo(a,l,m,!1),w=(m&l.childLanes)!==0),Se){if(w)return Zx(a,l,m);l.flags|=128}if(Se=l.memoizedState,Se!==null&&(Se.rendering=null,Se.tail=null,Se.lastEffect=null),dt(Pn,Pn.current),w)break;return null;case 22:return l.lanes=0,qx(a,l,m,l.pendingProps);case 24:si(l,Un,a.memoizedState.cache)}return zs(a,l,m)}function Qx(a,l,m){if(a!==null)if(a.memoizedProps!==l.pendingProps)Ln=!0;else{if(!Jl(a,m)&&(l.flags&128)===0)return Ln=!1,mp(a,l,m);Ln=(a.flags&131072)!==0}else Ln=!1,hn&&(l.flags&1048576)!==0&&ju(l,Ho,l.index);switch(l.lanes=0,l.tag){case 16:e:{var w=l.pendingProps;if(a=$i(l.elementType),l.type=a,typeof a=="function")sl(a)?(w=Ui(a,w),l.tag=1,l=Gx(null,l,a,w,m)):(l.tag=0,l=Vl(null,l,a,w,m));else{if(a!=null){var Se=a.$$typeof;if(Se===$e){l.tag=11,l=Ox(null,l,a,w,m);break e}else if(Se===W){l.tag=14,l=Lx(null,l,a,w,m);break e}}throw l=Ce(a)||a,Error(n(306,l,""))}}return l;case 0:return Vl(a,l,l.type,l.pendingProps,m);case 1:return w=l.type,Se=Ui(w,l.pendingProps),Gx(a,l,w,Se,m);case 3:e:{if(fr(l,l.stateNode.containerInfo),a===null)throw Error(n(387));w=l.pendingProps;var Ge=l.memoizedState;Se=Ge.element,El(a,l),Xo(l,w,null,m);var Ot=l.memoizedState;if(w=Ot.cache,si(l,Un,w),w!==Ge.cache&&fl(l,[Un],m,!0),Yo(),w=Ot.element,Ge.isDehydrated)if(Ge={element:w,isDehydrated:!1,cache:Ot.cache},l.updateQueue.baseState=Ge,l.memoizedState=Ge,l.flags&256){l=Wx(a,l,w,m);break e}else if(w!==Se){Se=hs(Error(n(424)),l),qo(Se),l=Wx(a,l,w,m);break e}else{switch(a=l.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(kn=bs(a.firstChild),zn=l,hn=!0,ri=null,ys=!0,m=qu(l,null,w,m),l.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling}else{if(Ni(),w===Se){l=zs(a,l,m);break e}Gn(a,l,w,m)}l=l.child}return l;case 26:return rc(a,l),a===null?(m=uf(l.type,null,l.pendingProps,null))?l.memoizedState=m:hn||(m=l.type,a=l.pendingProps,w=Ec(rr.current).createElement(m),w[rn]=l,w[fn]=a,Wn(w,m,a),Dn(w),l.stateNode=w):l.memoizedState=uf(l.type,a.memoizedProps,l.pendingProps,a.memoizedState),null;case 27:return ft(l),a===null&&hn&&(w=l.stateNode=af(l.type,l.pendingProps,rr.current),zn=l,ys=!0,Se=kn,gi(l.type)?(D0=Se,kn=bs(w.firstChild)):kn=Se),Gn(a,l,l.pendingProps.children,m),rc(a,l),a===null&&(l.flags|=4194304),l.child;case 5:return a===null&&hn&&((Se=w=kn)&&(w=Gp(w,l.type,l.pendingProps,ys),w!==null?(l.stateNode=w,zn=l,kn=bs(w.firstChild),ys=!1,Se=!0):Se=!1),Se||ni(l)),ft(l),Se=l.type,Ge=l.pendingProps,Ot=a!==null?a.memoizedProps:null,w=Ge.children,_0(Se,Ge)?w=null:Ot!==null&&_0(Se,Ot)&&(l.flags|=32),l.memoizedState!==null&&(Se=Sl(a,l,ap,null,null,m),ma._currentValue=Se),rc(a,l),Gn(a,l,w,m),l.child;case 6:return a===null&&hn&&((a=m=kn)&&(m=Wp(m,l.pendingProps,ys),m!==null?(l.stateNode=m,zn=l,kn=null,a=!0):a=!1),a||ni(l)),null;case 13:return Yx(a,l,m);case 4:return fr(l,l.stateNode.containerInfo),w=l.pendingProps,a===null?l.child=Pi(l,null,w,m):Gn(a,l,w,m),l.child;case 11:return Ox(a,l,l.type,l.pendingProps,m);case 7:return Gn(a,l,l.pendingProps,m),l.child;case 8:return Gn(a,l,l.pendingProps.children,m),l.child;case 12:return Gn(a,l,l.pendingProps.children,m),l.child;case 10:return w=l.pendingProps,si(l,l.type,w.value),Gn(a,l,w.children,m),l.child;case 9:return Se=l.type._context,w=l.pendingProps.children,Fi(l),Se=Vn(Se),w=w(Se),l.flags|=1,Gn(a,l,w,m),l.child;case 14:return Lx(a,l,l.type,l.pendingProps,m);case 15:return Hx(a,l,l.type,l.pendingProps,m);case 19:return Zx(a,l,m);case 31:return pp(a,l,m);case 22:return qx(a,l,m,l.pendingProps);case 24:return Fi(l),w=Vn(Un),a===null?(Se=ml(),Se===null&&(Se=Rn,Ge=hl(),Se.pooledCache=Ge,Ge.refCount++,Ge!==null&&(Se.pooledCacheLanes|=m),Se=Ge),l.memoizedState={parent:w,cache:Se},yl(l),si(l,Un,Se)):((a.lanes&m)!==0&&(El(a,l),Xo(l,null,null,m),Yo()),Se=a.memoizedState,Ge=l.memoizedState,Se.parent!==w?(Se={parent:w,cache:w},l.memoizedState=Se,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=Se),si(l,Un,w)):(w=Ge.cache,si(l,Un,w),w!==Se.cache&&fl(l,[Un],m,!0))),Gn(a,l,l.pendingProps.children,m),l.child;case 29:throw l.pendingProps}throw Error(n(156,l.tag))}function Vs(a){a.flags|=4}function e0(a,l,m,w,Se){if((l=(a.mode&32)!==0)&&(l=!1),l){if(a.flags|=16777216,(Se&335544128)===Se)if(a.stateNode.complete)a.flags|=8192;else if(Cd())a.flags|=8192;else throw Ii=La,gl}else a.flags&=-16777217}function Jx(a,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!pf(l))if(Cd())a.flags|=8192;else throw Ii=La,gl}function sc(a,l){l!==null&&(a.flags|=4),a.flags&16384&&(l=a.tag!==22?Ai():536870912,a.lanes|=l,Eo|=l)}function ra(a,l){if(!hn)switch(a.tailMode){case"hidden":l=a.tail;for(var m=null;l!==null;)l.alternate!==null&&(m=l),l=l.sibling;m===null?a.tail=null:m.sibling=null;break;case"collapsed":m=a.tail;for(var w=null;m!==null;)m.alternate!==null&&(w=m),m=m.sibling;w===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:w.sibling=null}}function jn(a){var l=a.alternate!==null&&a.alternate.child===a.child,m=0,w=0;if(l)for(var Se=a.child;Se!==null;)m|=Se.lanes|Se.childLanes,w|=Se.subtreeFlags&65011712,w|=Se.flags&65011712,Se.return=a,Se=Se.sibling;else for(Se=a.child;Se!==null;)m|=Se.lanes|Se.childLanes,w|=Se.subtreeFlags,w|=Se.flags,Se.return=a,Se=Se.sibling;return a.subtreeFlags|=w,a.childLanes=m,l}function gp(a,l,m){var w=l.pendingProps;switch(cl(l),l.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return jn(l),null;case 1:return jn(l),null;case 3:return m=l.stateNode,w=null,a!==null&&(w=a.memoizedState.cache),l.memoizedState.cache!==w&&(l.flags|=2048),Hs(Un),ir(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(a===null||a.child===null)&&(io(l)?Vs(l):a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,ul())),jn(l),null;case 26:var Se=l.type,Ge=l.memoizedState;return a===null?(Vs(l),Ge!==null?(jn(l),Jx(l,Ge)):(jn(l),e0(l,Se,null,w,m))):Ge?Ge!==a.memoizedState?(Vs(l),jn(l),Jx(l,Ge)):(jn(l),l.flags&=-16777217):(a=a.memoizedProps,a!==w&&Vs(l),jn(l),e0(l,Se,a,w,m)),null;case 27:if(nr(l),m=rr.current,Se=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==w&&Vs(l);else{if(!w){if(l.stateNode===null)throw Error(n(166));return jn(l),null}a=Je.current,io(l)?Du(l):(a=af(Se,w,m),l.stateNode=a,Vs(l))}return jn(l),null;case 5:if(nr(l),Se=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==w&&Vs(l);else{if(!w){if(l.stateNode===null)throw Error(n(166));return jn(l),null}if(Ge=Je.current,io(l))Du(l);else{var Ot=Ec(rr.current);switch(Ge){case 1:Ge=Ot.createElementNS("http://www.w3.org/2000/svg",Se);break;case 2:Ge=Ot.createElementNS("http://www.w3.org/1998/Math/MathML",Se);break;default:switch(Se){case"svg":Ge=Ot.createElementNS("http://www.w3.org/2000/svg",Se);break;case"math":Ge=Ot.createElementNS("http://www.w3.org/1998/Math/MathML",Se);break;case"script":Ge=Ot.createElement("div"),Ge.innerHTML="<script><\/script>",Ge=Ge.removeChild(Ge.firstChild);break;case"select":Ge=typeof w.is=="string"?Ot.createElement("select",{is:w.is}):Ot.createElement("select"),w.multiple?Ge.multiple=!0:w.size&&(Ge.size=w.size);break;default:Ge=typeof w.is=="string"?Ot.createElement(Se,{is:w.is}):Ot.createElement(Se)}}Ge[rn]=l,Ge[fn]=w;e:for(Ot=l.child;Ot!==null;){if(Ot.tag===5||Ot.tag===6)Ge.appendChild(Ot.stateNode);else if(Ot.tag!==4&&Ot.tag!==27&&Ot.child!==null){Ot.child.return=Ot,Ot=Ot.child;continue}if(Ot===l)break e;for(;Ot.sibling===null;){if(Ot.return===null||Ot.return===l)break e;Ot=Ot.return}Ot.sibling.return=Ot.return,Ot=Ot.sibling}l.stateNode=Ge;e:switch(Wn(Ge,Se,w),Se){case"button":case"input":case"select":case"textarea":w=!!w.autoFocus;break e;case"img":w=!0;break e;default:w=!1}w&&Vs(l)}}return jn(l),e0(l,l.type,a===null?null:a.memoizedProps,l.pendingProps,m),null;case 6:if(a&&l.stateNode!=null)a.memoizedProps!==w&&Vs(l);else{if(typeof w!="string"&&l.stateNode===null)throw Error(n(166));if(a=rr.current,io(l)){if(a=l.stateNode,m=l.memoizedProps,w=null,Se=zn,Se!==null)switch(Se.tag){case 27:case 5:w=Se.memoizedProps}a[rn]=l,a=!!(a.nodeValue===m||w!==null&&w.suppressHydrationWarning===!0||Yd(a.nodeValue,m)),a||ni(l,!0)}else a=Ec(a).createTextNode(w),a[rn]=l,l.stateNode=a}return jn(l),null;case 31:if(m=l.memoizedState,a===null||a.memoizedState!==null){if(w=io(l),m!==null){if(a===null){if(!w)throw Error(n(318));if(a=l.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(557));a[rn]=l}else Ni(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;jn(l),a=!1}else m=ul(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=m),a=!0;if(!a)return l.flags&256?(as(l),l):(as(l),null);if((l.flags&128)!==0)throw Error(n(558))}return jn(l),null;case 13:if(w=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(Se=io(l),w!==null&&w.dehydrated!==null){if(a===null){if(!Se)throw Error(n(318));if(Se=l.memoizedState,Se=Se!==null?Se.dehydrated:null,!Se)throw Error(n(317));Se[rn]=l}else Ni(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;jn(l),Se=!1}else Se=ul(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=Se),Se=!0;if(!Se)return l.flags&256?(as(l),l):(as(l),null)}return as(l),(l.flags&128)!==0?(l.lanes=m,l):(m=w!==null,a=a!==null&&a.memoizedState!==null,m&&(w=l.child,Se=null,w.alternate!==null&&w.alternate.memoizedState!==null&&w.alternate.memoizedState.cachePool!==null&&(Se=w.alternate.memoizedState.cachePool.pool),Ge=null,w.memoizedState!==null&&w.memoizedState.cachePool!==null&&(Ge=w.memoizedState.cachePool.pool),Ge!==Se&&(w.flags|=2048)),m!==a&&m&&(l.child.flags|=8192),sc(l,l.updateQueue),jn(l),null);case 4:return ir(),a===null&&v0(l.stateNode.containerInfo),jn(l),null;case 10:return Hs(l.type),jn(l),null;case 19:if(st(Pn),w=l.memoizedState,w===null)return jn(l),null;if(Se=(l.flags&128)!==0,Ge=w.rendering,Ge===null)if(Se)ra(w,!1);else{if($n!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(Ge=za(a),Ge!==null){for(l.flags|=128,ra(w,!1),a=Ge.updateQueue,l.updateQueue=a,sc(l,a),l.subtreeFlags=0,a=m,m=l.child;m!==null;)_u(m,a),m=m.sibling;return dt(Pn,Pn.current&1|2),hn&&Os(l,w.treeForkCount),l.child}a=a.sibling}w.tail!==null&&or()>lc&&(l.flags|=128,Se=!0,ra(w,!1),l.lanes=4194304)}else{if(!Se)if(a=za(Ge),a!==null){if(l.flags|=128,Se=!0,a=a.updateQueue,l.updateQueue=a,sc(l,a),ra(w,!0),w.tail===null&&w.tailMode==="hidden"&&!Ge.alternate&&!hn)return jn(l),null}else 2*or()-w.renderingStartTime>lc&&m!==536870912&&(l.flags|=128,Se=!0,ra(w,!1),l.lanes=4194304);w.isBackwards?(Ge.sibling=l.child,l.child=Ge):(a=w.last,a!==null?a.sibling=Ge:l.child=Ge,w.last=Ge)}return w.tail!==null?(a=w.tail,w.rendering=a,w.tail=a.sibling,w.renderingStartTime=or(),a.sibling=null,m=Pn.current,dt(Pn,Se?m&1|2:m&1),hn&&Os(l,w.treeForkCount),a):(jn(l),null);case 22:case 23:return as(l),Al(),w=l.memoizedState!==null,a!==null?a.memoizedState!==null!==w&&(l.flags|=8192):w&&(l.flags|=8192),w?(m&536870912)!==0&&(l.flags&128)===0&&(jn(l),l.subtreeFlags&6&&(l.flags|=8192)):jn(l),m=l.updateQueue,m!==null&&sc(l,m.retryQueue),m=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),w=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(w=l.memoizedState.cachePool.pool),w!==m&&(l.flags|=2048),a!==null&&st(Ti),null;case 24:return m=null,a!==null&&(m=a.memoizedState.cache),l.memoizedState.cache!==m&&(l.flags|=2048),Hs(Un),jn(l),null;case 25:return null;case 30:return null}throw Error(n(156,l.tag))}function yp(a,l){switch(cl(l),l.tag){case 1:return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return Hs(Un),ir(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 26:case 27:case 5:return nr(l),null;case 31:if(l.memoizedState!==null){if(as(l),l.alternate===null)throw Error(n(340));Ni()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 13:if(as(l),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(n(340));Ni()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return st(Pn),null;case 4:return ir(),null;case 10:return Hs(l.type),null;case 22:case 23:return as(l),Al(),a!==null&&st(Ti),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 24:return Hs(Un),null;case 25:return null;default:return null}}function ed(a,l){switch(cl(l),l.tag){case 3:Hs(Un),ir();break;case 26:case 27:case 5:nr(l);break;case 4:ir();break;case 31:l.memoizedState!==null&&as(l);break;case 13:as(l);break;case 19:st(Pn);break;case 10:Hs(l.type);break;case 22:case 23:as(l),Al(),a!==null&&st(Ti);break;case 24:Hs(Un)}}function na(a,l){try{var m=l.updateQueue,w=m!==null?m.lastEffect:null;if(w!==null){var Se=w.next;m=Se;do{if((m.tag&a)===a){w=void 0;var Ge=m.create,Ot=m.inst;w=Ge(),Ot.destroy=w}m=m.next}while(m!==Se)}}catch(gr){wn(l,l.return,gr)}}function ui(a,l,m){try{var w=l.updateQueue,Se=w!==null?w.lastEffect:null;if(Se!==null){var Ge=Se.next;w=Ge;do{if((w.tag&a)===a){var Ot=w.inst,gr=Ot.destroy;if(gr!==void 0){Ot.destroy=void 0,Se=l;var kr=m,Ir=gr;try{Ir()}catch(Hr){wn(Se,kr,Hr)}}}w=w.next}while(w!==Ge)}}catch(Hr){wn(l,l.return,Hr)}}function td(a){var l=a.updateQueue;if(l!==null){var m=a.stateNode;try{zu(l,m)}catch(w){wn(a,a.return,w)}}}function rd(a,l,m){m.props=Ui(a.type,a.memoizedProps),m.state=a.memoizedState;try{m.componentWillUnmount()}catch(w){wn(a,l,w)}}function sa(a,l){try{var m=a.ref;if(m!==null){switch(a.tag){case 26:case 27:case 5:var w=a.stateNode;break;case 30:w=a.stateNode;break;default:w=a.stateNode}typeof m=="function"?a.refCleanup=m(w):m.current=w}}catch(Se){wn(a,l,Se)}}function Ds(a,l){var m=a.ref,w=a.refCleanup;if(m!==null)if(typeof w=="function")try{w()}catch(Se){wn(a,l,Se)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof m=="function")try{m(null)}catch(Se){wn(a,l,Se)}else m.current=null}function nd(a){var l=a.type,m=a.memoizedProps,w=a.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":m.autoFocus&&w.focus();break e;case"img":m.src?w.src=m.src:m.srcSet&&(w.srcset=m.srcSet)}}catch(Se){wn(a,a.return,Se)}}function t0(a,l,m){try{var w=a.stateNode;Lp(w,a.type,m,l),w[fn]=l}catch(Se){wn(a,a.return,Se)}}function sd(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&gi(a.type)||a.tag===4}function r0(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||sd(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&gi(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function n0(a,l,m){var w=a.tag;if(w===5||w===6)a=a.stateNode,l?(m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m).insertBefore(a,l):(l=m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m,l.appendChild(a),m=m._reactRootContainer,m!=null||l.onclick!==null||(l.onclick=Ps));else if(w!==4&&(w===27&&gi(a.type)&&(m=a.stateNode,l=null),a=a.child,a!==null))for(n0(a,l,m),a=a.sibling;a!==null;)n0(a,l,m),a=a.sibling}function ic(a,l,m){var w=a.tag;if(w===5||w===6)a=a.stateNode,l?m.insertBefore(a,l):m.appendChild(a);else if(w!==4&&(w===27&&gi(a.type)&&(m=a.stateNode),a=a.child,a!==null))for(ic(a,l,m),a=a.sibling;a!==null;)ic(a,l,m),a=a.sibling}function id(a){var l=a.stateNode,m=a.memoizedProps;try{for(var w=a.type,Se=l.attributes;Se.length;)l.removeAttributeNode(Se[0]);Wn(l,w,m),l[rn]=a,l[fn]=m}catch(Ge){wn(a,a.return,Ge)}}var Gs=!1,Hn=!1,s0=!1,od=typeof WeakSet=="function"?WeakSet:Set,Kn=null;function Ep(a,l){if(a=a.containerInfo,C0=Sc,a=yu(a),Zc(a)){if("selectionStart"in a)var m={start:a.selectionStart,end:a.selectionEnd};else e:{m=(m=a.ownerDocument)&&m.defaultView||window;var w=m.getSelection&&m.getSelection();if(w&&w.rangeCount!==0){m=w.anchorNode;var Se=w.anchorOffset,Ge=w.focusNode;w=w.focusOffset;try{m.nodeType,Ge.nodeType}catch{m=null;break e}var Ot=0,gr=-1,kr=-1,Ir=0,Hr=0,Kr=a,Pr=null;t:for(;;){for(var Ur;Kr!==m||Se!==0&&Kr.nodeType!==3||(gr=Ot+Se),Kr!==Ge||w!==0&&Kr.nodeType!==3||(kr=Ot+w),Kr.nodeType===3&&(Ot+=Kr.nodeValue.length),(Ur=Kr.firstChild)!==null;)Pr=Kr,Kr=Ur;for(;;){if(Kr===a)break t;if(Pr===m&&++Ir===Se&&(gr=Ot),Pr===Ge&&++Hr===w&&(kr=Ot),(Ur=Kr.nextSibling)!==null)break;Kr=Pr,Pr=Kr.parentNode}Kr=Ur}m=gr===-1||kr===-1?null:{start:gr,end:kr}}else m=null}m=m||{start:0,end:0}}else m=null;for(S0={focusedElem:a,selectionRange:m},Sc=!1,Kn=l;Kn!==null;)if(l=Kn,a=l.child,(l.subtreeFlags&1028)!==0&&a!==null)a.return=l,Kn=a;else for(;Kn!==null;){switch(l=Kn,Ge=l.alternate,a=l.flags,l.tag){case 0:if((a&4)!==0&&(a=l.updateQueue,a=a!==null?a.events:null,a!==null))for(m=0;m<a.length;m++)Se=a[m],Se.ref.impl=Se.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&Ge!==null){a=void 0,m=l,Se=Ge.memoizedProps,Ge=Ge.memoizedState,w=m.stateNode;try{var Wr=Ui(m.type,Se);a=w.getSnapshotBeforeUpdate(Wr,Ge),w.__reactInternalSnapshotBeforeUpdate=a}catch(en){wn(m,m.return,en)}}break;case 3:if((a&1024)!==0){if(a=l.stateNode.containerInfo,m=a.nodeType,m===9)k0(a);else if(m===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":k0(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(n(163))}if(a=l.sibling,a!==null){a.return=l.return,Kn=a;break}Kn=l.return}}function ad(a,l,m){var w=m.flags;switch(m.tag){case 0:case 11:case 15:Ys(a,m),w&4&&na(5,m);break;case 1:if(Ys(a,m),w&4)if(a=m.stateNode,l===null)try{a.componentDidMount()}catch(Ot){wn(m,m.return,Ot)}else{var Se=Ui(m.type,l.memoizedProps);l=l.memoizedState;try{a.componentDidUpdate(Se,l,a.__reactInternalSnapshotBeforeUpdate)}catch(Ot){wn(m,m.return,Ot)}}w&64&&td(m),w&512&&sa(m,m.return);break;case 3:if(Ys(a,m),w&64&&(a=m.updateQueue,a!==null)){if(l=null,m.child!==null)switch(m.child.tag){case 27:case 5:l=m.child.stateNode;break;case 1:l=m.child.stateNode}try{zu(a,l)}catch(Ot){wn(m,m.return,Ot)}}break;case 27:l===null&&w&4&&id(m);case 26:case 5:Ys(a,m),l===null&&w&4&&nd(m),w&512&&sa(m,m.return);break;case 12:Ys(a,m);break;case 31:Ys(a,m),w&4&&ud(a,m);break;case 13:Ys(a,m),w&4&&xd(a,m),w&64&&(a=m.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(m=Rp.bind(null,m),Yp(a,m))));break;case 22:if(w=m.memoizedState!==null||Gs,!w){l=l!==null&&l.memoizedState!==null||Hn,Se=Gs;var Ge=Hn;Gs=w,(Hn=l)&&!Ge?Xs(a,m,(m.subtreeFlags&8772)!==0):Ys(a,m),Gs=Se,Hn=Ge}break;case 30:break;default:Ys(a,m)}}function cd(a){var l=a.alternate;l!==null&&(a.alternate=null,cd(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&Ci(l)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Nn=null,Qn=!1;function Ws(a,l,m){for(m=m.child;m!==null;)ld(a,l,m),m=m.sibling}function ld(a,l,m){if(br&&typeof br.onCommitFiberUnmount=="function")try{br.onCommitFiberUnmount(ar,m)}catch{}switch(m.tag){case 26:Hn||Ds(m,l),Ws(a,l,m),m.memoizedState?m.memoizedState.count--:m.stateNode&&(m=m.stateNode,m.parentNode.removeChild(m));break;case 27:Hn||Ds(m,l);var w=Nn,Se=Qn;gi(m.type)&&(Nn=m.stateNode,Qn=!1),Ws(a,l,m),fa(m.stateNode),Nn=w,Qn=Se;break;case 5:Hn||Ds(m,l);case 6:if(w=Nn,Se=Qn,Nn=null,Ws(a,l,m),Nn=w,Qn=Se,Nn!==null)if(Qn)try{(Nn.nodeType===9?Nn.body:Nn.nodeName==="HTML"?Nn.ownerDocument.body:Nn).removeChild(m.stateNode)}catch(Ge){wn(m,l,Ge)}else try{Nn.removeChild(m.stateNode)}catch(Ge){wn(m,l,Ge)}break;case 18:Nn!==null&&(Qn?(a=Nn,tf(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,m.stateNode),_o(a)):tf(Nn,m.stateNode));break;case 4:w=Nn,Se=Qn,Nn=m.stateNode.containerInfo,Qn=!0,Ws(a,l,m),Nn=w,Qn=Se;break;case 0:case 11:case 14:case 15:ui(2,m,l),Hn||ui(4,m,l),Ws(a,l,m);break;case 1:Hn||(Ds(m,l),w=m.stateNode,typeof w.componentWillUnmount=="function"&&rd(m,l,w)),Ws(a,l,m);break;case 21:Ws(a,l,m);break;case 22:Hn=(w=Hn)||m.memoizedState!==null,Ws(a,l,m),Hn=w;break;default:Ws(a,l,m)}}function ud(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{_o(a)}catch(m){wn(l,l.return,m)}}}function xd(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{_o(a)}catch(m){wn(l,l.return,m)}}function bp(a){switch(a.tag){case 31:case 13:case 19:var l=a.stateNode;return l===null&&(l=a.stateNode=new od),l;case 22:return a=a.stateNode,l=a._retryCache,l===null&&(l=a._retryCache=new od),l;default:throw Error(n(435,a.tag))}}function oc(a,l){var m=bp(a);l.forEach(function(w){if(!m.has(w)){m.add(w);var Se=kp.bind(null,a,w);w.then(Se,Se)}})}function Jn(a,l){var m=l.deletions;if(m!==null)for(var w=0;w<m.length;w++){var Se=m[w],Ge=a,Ot=l,gr=Ot;e:for(;gr!==null;){switch(gr.tag){case 27:if(gi(gr.type)){Nn=gr.stateNode,Qn=!1;break e}break;case 5:Nn=gr.stateNode,Qn=!1;break e;case 3:case 4:Nn=gr.stateNode.containerInfo,Qn=!0;break e}gr=gr.return}if(Nn===null)throw Error(n(160));ld(Ge,Ot,Se),Nn=null,Qn=!1,Ge=Se.alternate,Ge!==null&&(Ge.return=null),Se.return=null}if(l.subtreeFlags&13886)for(l=l.child;l!==null;)dd(l,a),l=l.sibling}var Bs=null;function dd(a,l){var m=a.alternate,w=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Jn(l,a),es(a),w&4&&(ui(3,a,a.return),na(3,a),ui(5,a,a.return));break;case 1:Jn(l,a),es(a),w&512&&(Hn||m===null||Ds(m,m.return)),w&64&&Gs&&(a=a.updateQueue,a!==null&&(w=a.callbacks,w!==null&&(m=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=m===null?w:m.concat(w))));break;case 26:var Se=Bs;if(Jn(l,a),es(a),w&512&&(Hn||m===null||Ds(m,m.return)),w&4){var Ge=m!==null?m.memoizedState:null;if(w=a.memoizedState,m===null)if(w===null)if(a.stateNode===null){e:{w=a.type,m=a.memoizedProps,Se=Se.ownerDocument||Se;t:switch(w){case"title":Ge=Se.getElementsByTagName("title")[0],(!Ge||Ge[Ts]||Ge[rn]||Ge.namespaceURI==="http://www.w3.org/2000/svg"||Ge.hasAttribute("itemprop"))&&(Ge=Se.createElement(w),Se.head.insertBefore(Ge,Se.querySelector("head > title"))),Wn(Ge,w,m),Ge[rn]=a,Dn(Ge),w=Ge;break e;case"link":var Ot=ff("link","href",Se).get(w+(m.href||""));if(Ot){for(var gr=0;gr<Ot.length;gr++)if(Ge=Ot[gr],Ge.getAttribute("href")===(m.href==null||m.href===""?null:m.href)&&Ge.getAttribute("rel")===(m.rel==null?null:m.rel)&&Ge.getAttribute("title")===(m.title==null?null:m.title)&&Ge.getAttribute("crossorigin")===(m.crossOrigin==null?null:m.crossOrigin)){Ot.splice(gr,1);break t}}Ge=Se.createElement(w),Wn(Ge,w,m),Se.head.appendChild(Ge);break;case"meta":if(Ot=ff("meta","content",Se).get(w+(m.content||""))){for(gr=0;gr<Ot.length;gr++)if(Ge=Ot[gr],Ge.getAttribute("content")===(m.content==null?null:""+m.content)&&Ge.getAttribute("name")===(m.name==null?null:m.name)&&Ge.getAttribute("property")===(m.property==null?null:m.property)&&Ge.getAttribute("http-equiv")===(m.httpEquiv==null?null:m.httpEquiv)&&Ge.getAttribute("charset")===(m.charSet==null?null:m.charSet)){Ot.splice(gr,1);break t}}Ge=Se.createElement(w),Wn(Ge,w,m),Se.head.appendChild(Ge);break;default:throw Error(n(468,w))}Ge[rn]=a,Dn(Ge),w=Ge}a.stateNode=w}else hf(Se,a.type,a.stateNode);else a.stateNode=df(Se,w,a.memoizedProps);else Ge!==w?(Ge===null?m.stateNode!==null&&(m=m.stateNode,m.parentNode.removeChild(m)):Ge.count--,w===null?hf(Se,a.type,a.stateNode):df(Se,w,a.memoizedProps)):w===null&&a.stateNode!==null&&t0(a,a.memoizedProps,m.memoizedProps)}break;case 27:Jn(l,a),es(a),w&512&&(Hn||m===null||Ds(m,m.return)),m!==null&&w&4&&t0(a,a.memoizedProps,m.memoizedProps);break;case 5:if(Jn(l,a),es(a),w&512&&(Hn||m===null||Ds(m,m.return)),a.flags&32){Se=a.stateNode;try{Yi(Se,"")}catch(Wr){wn(a,a.return,Wr)}}w&4&&a.stateNode!=null&&(Se=a.memoizedProps,t0(a,Se,m!==null?m.memoizedProps:Se)),w&1024&&(s0=!0);break;case 6:if(Jn(l,a),es(a),w&4){if(a.stateNode===null)throw Error(n(162));w=a.memoizedProps,m=a.stateNode;try{m.nodeValue=w}catch(Wr){wn(a,a.return,Wr)}}break;case 3:if(vc=null,Se=Bs,Bs=bc(l.containerInfo),Jn(l,a),Bs=Se,es(a),w&4&&m!==null&&m.memoizedState.isDehydrated)try{_o(l.containerInfo)}catch(Wr){wn(a,a.return,Wr)}s0&&(s0=!1,fd(a));break;case 4:w=Bs,Bs=bc(a.stateNode.containerInfo),Jn(l,a),es(a),Bs=w;break;case 12:Jn(l,a),es(a);break;case 31:Jn(l,a),es(a),w&4&&(w=a.updateQueue,w!==null&&(a.updateQueue=null,oc(a,w)));break;case 13:Jn(l,a),es(a),a.child.flags&8192&&a.memoizedState!==null!=(m!==null&&m.memoizedState!==null)&&(cc=or()),w&4&&(w=a.updateQueue,w!==null&&(a.updateQueue=null,oc(a,w)));break;case 22:Se=a.memoizedState!==null;var kr=m!==null&&m.memoizedState!==null,Ir=Gs,Hr=Hn;if(Gs=Ir||Se,Hn=Hr||kr,Jn(l,a),Hn=Hr,Gs=Ir,es(a),w&8192)e:for(l=a.stateNode,l._visibility=Se?l._visibility&-2:l._visibility|1,Se&&(m===null||kr||Gs||Hn||Oi(a)),m=null,l=a;;){if(l.tag===5||l.tag===26){if(m===null){kr=m=l;try{if(Ge=kr.stateNode,Se)Ot=Ge.style,typeof Ot.setProperty=="function"?Ot.setProperty("display","none","important"):Ot.display="none";else{gr=kr.stateNode;var Kr=kr.memoizedProps.style,Pr=Kr!=null&&Kr.hasOwnProperty("display")?Kr.display:null;gr.style.display=Pr==null||typeof Pr=="boolean"?"":(""+Pr).trim()}}catch(Wr){wn(kr,kr.return,Wr)}}}else if(l.tag===6){if(m===null){kr=l;try{kr.stateNode.nodeValue=Se?"":kr.memoizedProps}catch(Wr){wn(kr,kr.return,Wr)}}}else if(l.tag===18){if(m===null){kr=l;try{var Ur=kr.stateNode;Se?rf(Ur,!0):rf(kr.stateNode,!1)}catch(Wr){wn(kr,kr.return,Wr)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===a)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break e;for(;l.sibling===null;){if(l.return===null||l.return===a)break e;m===l&&(m=null),l=l.return}m===l&&(m=null),l.sibling.return=l.return,l=l.sibling}w&4&&(w=a.updateQueue,w!==null&&(m=w.retryQueue,m!==null&&(w.retryQueue=null,oc(a,m))));break;case 19:Jn(l,a),es(a),w&4&&(w=a.updateQueue,w!==null&&(a.updateQueue=null,oc(a,w)));break;case 30:break;case 21:break;default:Jn(l,a),es(a)}}function es(a){var l=a.flags;if(l&2){try{for(var m,w=a.return;w!==null;){if(sd(w)){m=w;break}w=w.return}if(m==null)throw Error(n(160));switch(m.tag){case 27:var Se=m.stateNode,Ge=r0(a);ic(a,Ge,Se);break;case 5:var Ot=m.stateNode;m.flags&32&&(Yi(Ot,""),m.flags&=-33);var gr=r0(a);ic(a,gr,Ot);break;case 3:case 4:var kr=m.stateNode.containerInfo,Ir=r0(a);n0(a,Ir,kr);break;default:throw Error(n(161))}}catch(Hr){wn(a,a.return,Hr)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function fd(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var l=a;fd(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),a=a.sibling}}function Ys(a,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)ad(a,l.alternate,l),l=l.sibling}function Oi(a){for(a=a.child;a!==null;){var l=a;switch(l.tag){case 0:case 11:case 14:case 15:ui(4,l,l.return),Oi(l);break;case 1:Ds(l,l.return);var m=l.stateNode;typeof m.componentWillUnmount=="function"&&rd(l,l.return,m),Oi(l);break;case 27:fa(l.stateNode);case 26:case 5:Ds(l,l.return),Oi(l);break;case 22:l.memoizedState===null&&Oi(l);break;case 30:Oi(l);break;default:Oi(l)}a=a.sibling}}function Xs(a,l,m){for(m=m&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var w=l.alternate,Se=a,Ge=l,Ot=Ge.flags;switch(Ge.tag){case 0:case 11:case 15:Xs(Se,Ge,m),na(4,Ge);break;case 1:if(Xs(Se,Ge,m),w=Ge,Se=w.stateNode,typeof Se.componentDidMount=="function")try{Se.componentDidMount()}catch(Ir){wn(w,w.return,Ir)}if(w=Ge,Se=w.updateQueue,Se!==null){var gr=w.stateNode;try{var kr=Se.shared.hiddenCallbacks;if(kr!==null)for(Se.shared.hiddenCallbacks=null,Se=0;Se<kr.length;Se++)Ku(kr[Se],gr)}catch(Ir){wn(w,w.return,Ir)}}m&&Ot&64&&td(Ge),sa(Ge,Ge.return);break;case 27:id(Ge);case 26:case 5:Xs(Se,Ge,m),m&&w===null&&Ot&4&&nd(Ge),sa(Ge,Ge.return);break;case 12:Xs(Se,Ge,m);break;case 31:Xs(Se,Ge,m),m&&Ot&4&&ud(Se,Ge);break;case 13:Xs(Se,Ge,m),m&&Ot&4&&xd(Se,Ge);break;case 22:Ge.memoizedState===null&&Xs(Se,Ge,m),sa(Ge,Ge.return);break;case 30:break;default:Xs(Se,Ge,m)}l=l.sibling}}function i0(a,l){var m=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),a=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(a=l.memoizedState.cachePool.pool),a!==m&&(a!=null&&a.refCount++,m!=null&&Ko(m))}function o0(a,l){a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&Ko(a))}function Cs(a,l,m,w){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)hd(a,l,m,w),l=l.sibling}function hd(a,l,m,w){var Se=l.flags;switch(l.tag){case 0:case 11:case 15:Cs(a,l,m,w),Se&2048&&na(9,l);break;case 1:Cs(a,l,m,w);break;case 3:Cs(a,l,m,w),Se&2048&&(a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&Ko(a)));break;case 12:if(Se&2048){Cs(a,l,m,w),a=l.stateNode;try{var Ge=l.memoizedProps,Ot=Ge.id,gr=Ge.onPostCommit;typeof gr=="function"&&gr(Ot,l.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(kr){wn(l,l.return,kr)}}else Cs(a,l,m,w);break;case 31:Cs(a,l,m,w);break;case 13:Cs(a,l,m,w);break;case 23:break;case 22:Ge=l.stateNode,Ot=l.alternate,l.memoizedState!==null?Ge._visibility&2?Cs(a,l,m,w):ia(a,l):Ge._visibility&2?Cs(a,l,m,w):(Ge._visibility|=2,mo(a,l,m,w,(l.subtreeFlags&10256)!==0||!1)),Se&2048&&i0(Ot,l);break;case 24:Cs(a,l,m,w),Se&2048&&o0(l.alternate,l);break;default:Cs(a,l,m,w)}}function mo(a,l,m,w,Se){for(Se=Se&&((l.subtreeFlags&10256)!==0||!1),l=l.child;l!==null;){var Ge=a,Ot=l,gr=m,kr=w,Ir=Ot.flags;switch(Ot.tag){case 0:case 11:case 15:mo(Ge,Ot,gr,kr,Se),na(8,Ot);break;case 23:break;case 22:var Hr=Ot.stateNode;Ot.memoizedState!==null?Hr._visibility&2?mo(Ge,Ot,gr,kr,Se):ia(Ge,Ot):(Hr._visibility|=2,mo(Ge,Ot,gr,kr,Se)),Se&&Ir&2048&&i0(Ot.alternate,Ot);break;case 24:mo(Ge,Ot,gr,kr,Se),Se&&Ir&2048&&o0(Ot.alternate,Ot);break;default:mo(Ge,Ot,gr,kr,Se)}l=l.sibling}}function ia(a,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var m=a,w=l,Se=w.flags;switch(w.tag){case 22:ia(m,w),Se&2048&&i0(w.alternate,w);break;case 24:ia(m,w),Se&2048&&o0(w.alternate,w);break;default:ia(m,w)}l=l.sibling}}var oa=8192;function go(a,l,m){if(a.subtreeFlags&oa)for(a=a.child;a!==null;)pd(a,l,m),a=a.sibling}function pd(a,l,m){switch(a.tag){case 26:go(a,l,m),a.flags&oa&&a.memoizedState!==null&&am(m,Bs,a.memoizedState,a.memoizedProps);break;case 5:go(a,l,m);break;case 3:case 4:var w=Bs;Bs=bc(a.stateNode.containerInfo),go(a,l,m),Bs=w;break;case 22:a.memoizedState===null&&(w=a.alternate,w!==null&&w.memoizedState!==null?(w=oa,oa=16777216,go(a,l,m),oa=w):go(a,l,m));break;default:go(a,l,m)}}function md(a){var l=a.alternate;if(l!==null&&(a=l.child,a!==null)){l.child=null;do l=a.sibling,a.sibling=null,a=l;while(a!==null)}}function aa(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var m=0;m<l.length;m++){var w=l[m];Kn=w,yd(w,a)}md(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)gd(a),a=a.sibling}function gd(a){switch(a.tag){case 0:case 11:case 15:aa(a),a.flags&2048&&ui(9,a,a.return);break;case 3:aa(a);break;case 12:aa(a);break;case 22:var l=a.stateNode;a.memoizedState!==null&&l._visibility&2&&(a.return===null||a.return.tag!==13)?(l._visibility&=-3,ac(a)):aa(a);break;default:aa(a)}}function ac(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var m=0;m<l.length;m++){var w=l[m];Kn=w,yd(w,a)}md(a)}for(a=a.child;a!==null;){switch(l=a,l.tag){case 0:case 11:case 15:ui(8,l,l.return),ac(l);break;case 22:m=l.stateNode,m._visibility&2&&(m._visibility&=-3,ac(l));break;default:ac(l)}a=a.sibling}}function yd(a,l){for(;Kn!==null;){var m=Kn;switch(m.tag){case 0:case 11:case 15:ui(8,m,l);break;case 23:case 22:if(m.memoizedState!==null&&m.memoizedState.cachePool!==null){var w=m.memoizedState.cachePool.pool;w!=null&&w.refCount++}break;case 24:Ko(m.memoizedState.cache)}if(w=m.child,w!==null)w.return=m,Kn=w;else e:for(m=a;Kn!==null;){w=Kn;var Se=w.sibling,Ge=w.return;if(cd(w),w===m){Kn=null;break e}if(Se!==null){Se.return=Ge,Kn=Se;break e}Kn=Ge}}}var wp={getCacheForType:function(a){var l=Vn(Un),m=l.data.get(a);return m===void 0&&(m=a(),l.data.set(a,m)),m},cacheSignal:function(){return Vn(Un).controller.signal}},vp=typeof WeakMap=="function"?WeakMap:Map,yn=0,Rn=null,cn=null,xn=0,En=0,cs=null,xi=!1,yo=!1,a0=!1,Zs=0,$n=0,di=0,Li=0,c0=0,ls=0,Eo=0,ca=null,ts=null,l0=!1,cc=0,Ed=0,lc=1/0,uc=null,fi=null,qn=0,hi=null,bo=null,Qs=0,u0=0,x0=null,bd=null,la=0,d0=null;function us(){return(yn&2)!==0&&xn!==0?xn&-xn:_e.T!==null?y0():An()}function wd(){if(ls===0)if((xn&536870912)===0||hn){var a=Zr;Zr<<=1,(Zr&3932160)===0&&(Zr=262144),ls=a}else ls=536870912;return a=os.current,a!==null&&(a.flags|=32),ls}function rs(a,l,m){(a===Rn&&(En===2||En===9)||a.cancelPendingCommit!==null)&&(wo(a,0),pi(a,xn,ls,!1)),yt(a,m),((yn&2)===0||a!==Rn)&&(a===Rn&&((yn&2)===0&&(Li|=m),$n===4&&pi(a,xn,ls,!1)),Fs(a))}function vd(a,l,m){if((yn&6)!==0)throw Error(n(327));var w=!m&&(l&127)===0&&(l&a.expiredLanes)===0||vn(a,l),Se=w?Cp(a,l):h0(a,l,!0),Ge=w;do{if(Se===0){yo&&!w&&pi(a,l,0,!1);break}else{if(m=a.current.alternate,Ge&&!Ap(m)){Se=h0(a,l,!1),Ge=!1;continue}if(Se===2){if(Ge=l,a.errorRecoveryDisabledLanes&Ge)var Ot=0;else Ot=a.pendingLanes&-536870913,Ot=Ot!==0?Ot:Ot&536870912?536870912:0;if(Ot!==0){l=Ot;e:{var gr=a;Se=ca;var kr=gr.current.memoizedState.isDehydrated;if(kr&&(wo(gr,Ot).flags|=256),Ot=h0(gr,Ot,!1),Ot!==2){if(a0&&!kr){gr.errorRecoveryDisabledLanes|=Ge,Li|=Ge,Se=4;break e}Ge=ts,ts=Se,Ge!==null&&(ts===null?ts=Ge:ts.push.apply(ts,Ge))}Se=Ot}if(Ge=!1,Se!==2)continue}}if(Se===1){wo(a,0),pi(a,l,0,!0);break}e:{switch(w=a,Ge=Se,Ge){case 0:case 1:throw Error(n(345));case 4:if((l&4194048)!==l)break;case 6:pi(w,l,ls,!xi);break e;case 2:ts=null;break;case 3:case 5:break;default:throw Error(n(329))}if((l&62914560)===l&&(Se=cc+300-or(),10<Se)){if(pi(w,l,ls,!xi),Xn(w,0,!0)!==0)break e;Qs=l,w.timeoutHandle=Jd(Ad.bind(null,w,m,ts,uc,l0,l,ls,Li,Eo,xi,Ge,"Throttled",-0,0),Se);break e}Ad(w,m,ts,uc,l0,l,ls,Li,Eo,xi,Ge,null,-0,0)}}break}while(!0);Fs(a)}function Ad(a,l,m,w,Se,Ge,Ot,gr,kr,Ir,Hr,Kr,Pr,Ur){if(a.timeoutHandle=-1,Kr=l.subtreeFlags,Kr&8192||(Kr&16785408)===16785408){Kr={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ps},pd(l,Ge,Kr);var Wr=(Ge&62914560)===Ge?cc-or():(Ge&4194048)===Ge?Ed-or():0;if(Wr=cm(Kr,Wr),Wr!==null){Qs=Ge,a.cancelPendingCommit=Wr(Nd.bind(null,a,l,Ge,m,w,Se,Ot,gr,kr,Hr,Kr,null,Pr,Ur)),pi(a,Ge,Ot,!Ir);return}}Nd(a,l,Ge,m,w,Se,Ot,gr,kr)}function Ap(a){for(var l=a;;){var m=l.tag;if((m===0||m===11||m===15)&&l.flags&16384&&(m=l.updateQueue,m!==null&&(m=m.stores,m!==null)))for(var w=0;w<m.length;w++){var Se=m[w],Ge=Se.getSnapshot;Se=Se.value;try{if(!ns(Ge(),Se))return!1}catch{return!1}}if(m=l.child,l.subtreeFlags&16384&&m!==null)m.return=l,l=m;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function pi(a,l,m,w){l&=~c0,l&=~Li,a.suspendedLanes|=l,a.pingedLanes&=~l,w&&(a.warmLanes|=l),w=a.expirationTimes;for(var Se=l;0<Se;){var Ge=31-Rr(Se),Ot=1<<Ge;w[Ge]=-1,Se&=~Ot}m!==0&&vr(a,m,l)}function xc(){return(yn&6)===0?(ua(0),!1):!0}function f0(){if(cn!==null){if(En===0)var a=cn.return;else a=cn,Ls=Di=null,kl(a),uo=null,Vo=0,a=cn;for(;a!==null;)ed(a.alternate,a),a=a.return;cn=null}}function wo(a,l){var m=a.timeoutHandle;m!==-1&&(a.timeoutHandle=-1,Kp(m)),m=a.cancelPendingCommit,m!==null&&(a.cancelPendingCommit=null,m()),Qs=0,f0(),Rn=a,cn=m=Us(a.current,null),xn=l,En=0,cs=null,xi=!1,yo=vn(a,l),a0=!1,Eo=ls=c0=Li=di=$n=0,ts=ca=null,l0=!1,(l&8)!==0&&(l|=l&32);var w=a.entangledLanes;if(w!==0)for(a=a.entanglements,w&=l;0<w;){var Se=31-Rr(w),Ge=1<<Se;l|=a[Se],w&=~Ge}return Zs=l,Da(),m}function Bd(a,l){sn=null,_e.H=ea,l===lo||l===Oa?(l=Ou(),En=3):l===gl?(l=Ou(),En=4):En=l===zl?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,cs=l,cn===null&&($n=1,ec(a,hs(l,a.current)))}function Cd(){var a=os.current;return a===null?!0:(xn&4194048)===xn?Es===null:(xn&62914560)===xn||(xn&536870912)!==0?a===Es:!1}function Sd(){var a=_e.H;return _e.H=ea,a===null?ea:a}function _d(){var a=_e.A;return _e.A=wp,a}function dc(){$n=4,xi||(xn&4194048)!==xn&&os.current!==null||(yo=!0),(di&134217727)===0&&(Li&134217727)===0||Rn===null||pi(Rn,xn,ls,!1)}function h0(a,l,m){var w=yn;yn|=2;var Se=Sd(),Ge=_d();(Rn!==a||xn!==l)&&(uc=null,wo(a,l)),l=!1;var Ot=$n;e:do try{if(En!==0&&cn!==null){var gr=cn,kr=cs;switch(En){case 8:f0(),Ot=6;break e;case 3:case 2:case 9:case 6:os.current===null&&(l=!0);var Ir=En;if(En=0,cs=null,vo(a,gr,kr,Ir),m&&yo){Ot=0;break e}break;default:Ir=En,En=0,cs=null,vo(a,gr,kr,Ir)}}Bp(),Ot=$n;break}catch(Hr){Bd(a,Hr)}while(!0);return l&&a.shellSuspendCounter++,Ls=Di=null,yn=w,_e.H=Se,_e.A=Ge,cn===null&&(Rn=null,xn=0,Da()),Ot}function Bp(){for(;cn!==null;)Rd(cn)}function Cp(a,l){var m=yn;yn|=2;var w=Sd(),Se=_d();Rn!==a||xn!==l?(uc=null,lc=or()+500,wo(a,l)):yo=vn(a,l);e:do try{if(En!==0&&cn!==null){l=cn;var Ge=cs;t:switch(En){case 1:En=0,cs=null,vo(a,l,Ge,1);break;case 2:case 9:if(Mu(Ge)){En=0,cs=null,kd(l);break}l=function(){En!==2&&En!==9||Rn!==a||(En=7),Fs(a)},Ge.then(l,l);break e;case 3:En=7;break e;case 4:En=5;break e;case 7:Mu(Ge)?(En=0,cs=null,kd(l)):(En=0,cs=null,vo(a,l,Ge,7));break;case 5:var Ot=null;switch(cn.tag){case 26:Ot=cn.memoizedState;case 5:case 27:var gr=cn;if(Ot?pf(Ot):gr.stateNode.complete){En=0,cs=null;var kr=gr.sibling;if(kr!==null)cn=kr;else{var Ir=gr.return;Ir!==null?(cn=Ir,fc(Ir)):cn=null}break t}}En=0,cs=null,vo(a,l,Ge,5);break;case 6:En=0,cs=null,vo(a,l,Ge,6);break;case 8:f0(),$n=6;break e;default:throw Error(n(462))}}Sp();break}catch(Hr){Bd(a,Hr)}while(!0);return Ls=Di=null,_e.H=w,_e.A=Se,yn=m,cn!==null?0:(Rn=null,xn=0,Da(),$n)}function Sp(){for(;cn!==null&&!Tr();)Rd(cn)}function Rd(a){var l=Qx(a.alternate,a,Zs);a.memoizedProps=a.pendingProps,l===null?fc(a):cn=l}function kd(a){var l=a,m=l.alternate;switch(l.tag){case 15:case 0:l=Vx(m,l,l.pendingProps,l.type,void 0,xn);break;case 11:l=Vx(m,l,l.pendingProps,l.type.render,l.ref,xn);break;case 5:kl(l);default:ed(m,l),l=cn=_u(l,Zs),l=Qx(m,l,Zs)}a.memoizedProps=a.pendingProps,l===null?fc(a):cn=l}function vo(a,l,m,w){Ls=Di=null,kl(l),uo=null,Vo=0;var Se=l.return;try{if(hp(a,Se,l,m,xn)){$n=1,ec(a,hs(m,a.current)),cn=null;return}}catch(Ge){if(Se!==null)throw cn=Se,Ge;$n=1,ec(a,hs(m,a.current)),cn=null;return}l.flags&32768?(hn||w===1?a=!0:yo||(xn&536870912)!==0?a=!1:(xi=a=!0,(w===2||w===9||w===3||w===6)&&(w=os.current,w!==null&&w.tag===13&&(w.flags|=16384))),jd(l,a)):fc(l)}function fc(a){var l=a;do{if((l.flags&32768)!==0){jd(l,xi);return}a=l.return;var m=gp(l.alternate,l,Zs);if(m!==null){cn=m;return}if(l=l.sibling,l!==null){cn=l;return}cn=l=a}while(l!==null);$n===0&&($n=5)}function jd(a,l){do{var m=yp(a.alternate,a);if(m!==null){m.flags&=32767,cn=m;return}if(m=a.return,m!==null&&(m.flags|=32768,m.subtreeFlags=0,m.deletions=null),!l&&(a=a.sibling,a!==null)){cn=a;return}cn=a=m}while(a!==null);$n=6,cn=null}function Nd(a,l,m,w,Se,Ge,Ot,gr,kr){a.cancelPendingCommit=null;do hc();while(qn!==0);if((yn&6)!==0)throw Error(n(327));if(l!==null){if(l===a.current)throw Error(n(177));if(Ge=l.lanes|l.childLanes,Ge|=rl,Ft(a,m,Ge,Ot,gr,kr),a===Rn&&(cn=Rn=null,xn=0),bo=l,hi=a,Qs=m,u0=Ge,x0=Se,bd=w,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,jp(sr,function(){return Id(),null})):(a.callbackNode=null,a.callbackPriority=0),w=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||w){w=_e.T,_e.T=null,Se=Le.p,Le.p=2,Ot=yn,yn|=4;try{Ep(a,l,m)}finally{yn=Ot,Le.p=Se,_e.T=w}}qn=1,Dd(),Fd(),Td()}}function Dd(){if(qn===1){qn=0;var a=hi,l=bo,m=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||m){m=_e.T,_e.T=null;var w=Le.p;Le.p=2;var Se=yn;yn|=4;try{dd(l,a);var Ge=S0,Ot=yu(a.containerInfo),gr=Ge.focusedElem,kr=Ge.selectionRange;if(Ot!==gr&&gr&&gr.ownerDocument&&gu(gr.ownerDocument.documentElement,gr)){if(kr!==null&&Zc(gr)){var Ir=kr.start,Hr=kr.end;if(Hr===void 0&&(Hr=Ir),"selectionStart"in gr)gr.selectionStart=Ir,gr.selectionEnd=Math.min(Hr,gr.value.length);else{var Kr=gr.ownerDocument||document,Pr=Kr&&Kr.defaultView||window;if(Pr.getSelection){var Ur=Pr.getSelection(),Wr=gr.textContent.length,en=Math.min(kr.start,Wr),Sn=kr.end===void 0?en:Math.min(kr.end,Wr);!Ur.extend&&en>Sn&&(Ot=Sn,Sn=en,en=Ot);var Fr=mu(gr,en),Dr=mu(gr,Sn);if(Fr&&Dr&&(Ur.rangeCount!==1||Ur.anchorNode!==Fr.node||Ur.anchorOffset!==Fr.offset||Ur.focusNode!==Dr.node||Ur.focusOffset!==Dr.offset)){var $r=Kr.createRange();$r.setStart(Fr.node,Fr.offset),Ur.removeAllRanges(),en>Sn?(Ur.addRange($r),Ur.extend(Dr.node,Dr.offset)):($r.setEnd(Dr.node,Dr.offset),Ur.addRange($r))}}}}for(Kr=[],Ur=gr;Ur=Ur.parentNode;)Ur.nodeType===1&&Kr.push({element:Ur,left:Ur.scrollLeft,top:Ur.scrollTop});for(typeof gr.focus=="function"&&gr.focus(),gr=0;gr<Kr.length;gr++){var qr=Kr[gr];qr.element.scrollLeft=qr.left,qr.element.scrollTop=qr.top}}Sc=!!C0,S0=C0=null}finally{yn=Se,Le.p=w,_e.T=m}}a.current=l,qn=2}}function Fd(){if(qn===2){qn=0;var a=hi,l=bo,m=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||m){m=_e.T,_e.T=null;var w=Le.p;Le.p=2;var Se=yn;yn|=4;try{ad(a,l.alternate,l)}finally{yn=Se,Le.p=w,_e.T=m}}qn=3}}function Td(){if(qn===4||qn===3){qn=0,Nr();var a=hi,l=bo,m=Qs,w=bd;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?qn=5:(qn=0,bo=hi=null,$d(a,a.pendingLanes));var Se=a.pendingLanes;if(Se===0&&(fi=null),Yr(m),l=l.stateNode,br&&typeof br.onCommitFiberRoot=="function")try{br.onCommitFiberRoot(ar,l,void 0,(l.current.flags&128)===128)}catch{}if(w!==null){l=_e.T,Se=Le.p,Le.p=2,_e.T=null;try{for(var Ge=a.onRecoverableError,Ot=0;Ot<w.length;Ot++){var gr=w[Ot];Ge(gr.value,{componentStack:gr.stack})}}finally{_e.T=l,Le.p=Se}}(Qs&3)!==0&&hc(),Fs(a),Se=a.pendingLanes,(m&261930)!==0&&(Se&42)!==0?a===d0?la++:(la=0,d0=a):la=0,ua(0)}}function $d(a,l){(a.pooledCacheLanes&=l)===0&&(l=a.pooledCache,l!=null&&(a.pooledCache=null,Ko(l)))}function hc(){return Dd(),Fd(),Td(),Id()}function Id(){if(qn!==5)return!1;var a=hi,l=u0;u0=0;var m=Yr(Qs),w=_e.T,Se=Le.p;try{Le.p=32>m?32:m,_e.T=null,m=x0,x0=null;var Ge=hi,Ot=Qs;if(qn=0,bo=hi=null,Qs=0,(yn&6)!==0)throw Error(n(331));var gr=yn;if(yn|=4,gd(Ge.current),hd(Ge,Ge.current,Ot,m),yn=gr,ua(0,!1),br&&typeof br.onPostCommitFiberRoot=="function")try{br.onPostCommitFiberRoot(ar,Ge)}catch{}return!0}finally{Le.p=Se,_e.T=w,$d(a,l)}}function Pd(a,l,m){l=hs(m,l),l=Kl(a.stateNode,l,2),a=ai(a,l,2),a!==null&&(yt(a,2),Fs(a))}function wn(a,l,m){if(a.tag===3)Pd(a,a,m);else for(;l!==null;){if(l.tag===3){Pd(l,a,m);break}else if(l.tag===1){var w=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(fi===null||!fi.has(w))){a=hs(m,a),m=Mx(2),w=ai(l,m,2),w!==null&&(Ux(m,w,l,a),yt(w,2),Fs(w));break}}l=l.return}}function p0(a,l,m){var w=a.pingCache;if(w===null){w=a.pingCache=new vp;var Se=new Set;w.set(l,Se)}else Se=w.get(l),Se===void 0&&(Se=new Set,w.set(l,Se));Se.has(m)||(a0=!0,Se.add(m),a=_p.bind(null,a,l,m),l.then(a,a))}function _p(a,l,m){var w=a.pingCache;w!==null&&w.delete(l),a.pingedLanes|=a.suspendedLanes&m,a.warmLanes&=~m,Rn===a&&(xn&m)===m&&($n===4||$n===3&&(xn&62914560)===xn&&300>or()-cc?(yn&2)===0&&wo(a,0):c0|=m,Eo===xn&&(Eo=0)),Fs(a)}function Md(a,l){l===0&&(l=Ai()),a=ki(a,l),a!==null&&(yt(a,l),Fs(a))}function Rp(a){var l=a.memoizedState,m=0;l!==null&&(m=l.retryLane),Md(a,m)}function kp(a,l){var m=0;switch(a.tag){case 31:case 13:var w=a.stateNode,Se=a.memoizedState;Se!==null&&(m=Se.retryLane);break;case 19:w=a.stateNode;break;case 22:w=a.stateNode._retryCache;break;default:throw Error(n(314))}w!==null&&w.delete(l),Md(a,m)}function jp(a,l){return Cr(a,l)}var pc=null,Ao=null,m0=!1,mc=!1,g0=!1,mi=0;function Fs(a){a!==Ao&&a.next===null&&(Ao===null?pc=Ao=a:Ao=Ao.next=a),mc=!0,m0||(m0=!0,Dp())}function ua(a,l){if(!g0&&mc){g0=!0;do for(var m=!1,w=pc;w!==null;){if(a!==0){var Se=w.pendingLanes;if(Se===0)var Ge=0;else{var Ot=w.suspendedLanes,gr=w.pingedLanes;Ge=(1<<31-Rr(42|a)+1)-1,Ge&=Se&~(Ot&~gr),Ge=Ge&201326741?Ge&201326741|1:Ge?Ge|2:0}Ge!==0&&(m=!0,Hd(w,Ge))}else Ge=xn,Ge=Xn(w,w===Rn?Ge:0,w.cancelPendingCommit!==null||w.timeoutHandle!==-1),(Ge&3)===0||vn(w,Ge)||(m=!0,Hd(w,Ge));w=w.next}while(m);g0=!1}}function Np(){Ud()}function Ud(){mc=m0=!1;var a=0;mi!==0&&qp()&&(a=mi);for(var l=or(),m=null,w=pc;w!==null;){var Se=w.next,Ge=Od(w,l);Ge===0?(w.next=null,m===null?pc=Se:m.next=Se,Se===null&&(Ao=m)):(m=w,(a!==0||(Ge&3)!==0)&&(mc=!0)),w=Se}qn!==0&&qn!==5||ua(a),mi!==0&&(mi=0)}function Od(a,l){for(var m=a.suspendedLanes,w=a.pingedLanes,Se=a.expirationTimes,Ge=a.pendingLanes&-62914561;0<Ge;){var Ot=31-Rr(Ge),gr=1<<Ot,kr=Se[Ot];kr===-1?((gr&m)===0||(gr&w)!==0)&&(Se[Ot]=gn(gr,l)):kr<=l&&(a.expiredLanes|=gr),Ge&=~gr}if(l=Rn,m=xn,m=Xn(a,a===l?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),w=a.callbackNode,m===0||a===l&&(En===2||En===9)||a.cancelPendingCommit!==null)return w!==null&&w!==null&&_r(w),a.callbackNode=null,a.callbackPriority=0;if((m&3)===0||vn(a,m)){if(l=m&-m,l===a.callbackPriority)return l;switch(w!==null&&_r(w),Yr(m)){case 2:case 8:m=mr;break;case 32:m=sr;break;case 268435456:m=ht;break;default:m=sr}return w=Ld.bind(null,a),m=Cr(m,w),a.callbackPriority=l,a.callbackNode=m,l}return w!==null&&w!==null&&_r(w),a.callbackPriority=2,a.callbackNode=null,2}function Ld(a,l){if(qn!==0&&qn!==5)return a.callbackNode=null,a.callbackPriority=0,null;var m=a.callbackNode;if(hc()&&a.callbackNode!==m)return null;var w=xn;return w=Xn(a,a===Rn?w:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),w===0?null:(vd(a,w,l),Od(a,or()),a.callbackNode!=null&&a.callbackNode===m?Ld.bind(null,a):null)}function Hd(a,l){if(hc())return null;vd(a,l,!0)}function Dp(){zp(function(){(yn&6)!==0?Cr(yr,Np):Ud()})}function y0(){if(mi===0){var a=ao;a===0&&(a=Vr,Vr<<=1,(Vr&261888)===0&&(Vr=256)),mi=a}return mi}function qd(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Aa(""+a)}function Kd(a,l){var m=l.ownerDocument.createElement("input");return m.name=l.name,m.value=l.value,a.id&&m.setAttribute("form",a.id),l.parentNode.insertBefore(m,l),a=new FormData(a),m.parentNode.removeChild(m),a}function Tp(a,l,m,w,Se){if(l==="submit"&&m&&m.stateNode===Se){var Ge=qd((Se[fn]||null).action),Ot=w.submitter;Ot&&(l=(l=Ot[fn]||null)?qd(l.formAction):Ot.getAttribute("formAction"),l!==null&&(Ge=l,Ot=null));var gr=new Ra("action","action",null,w,Se);a.push({event:gr,listeners:[{instance:null,listener:function(){if(w.defaultPrevented){if(mi!==0){var kr=Ot?Kd(Se,Ot):new FormData(Se);Ml(m,{pending:!0,data:kr,method:Se.method,action:Ge},null,kr)}}else typeof Ge=="function"&&(gr.preventDefault(),kr=Ot?Kd(Se,Ot):new FormData(Se),Ml(m,{pending:!0,data:kr,method:Se.method,action:Ge},Ge,kr))},currentTarget:Se}]})}}for(var E0=0;E0<tl.length;E0++){var b0=tl[E0],$p=b0.toLowerCase(),Ip=b0[0].toUpperCase()+b0.slice(1);As($p,"on"+Ip)}As(wu,"onAnimationEnd"),As(vu,"onAnimationIteration"),As(Au,"onAnimationStart"),As("dblclick","onDoubleClick"),As("focusin","onFocus"),As("focusout","onBlur"),As(Zh,"onTransitionRun"),As(Qh,"onTransitionStart"),As(Jh,"onTransitionCancel"),As(Bu,"onTransitionEnd"),ks("onMouseEnter",["mouseout","mouseover"]),ks("onMouseLeave",["mouseout","mouseover"]),ks("onPointerEnter",["pointerout","pointerover"]),ks("onPointerLeave",["pointerout","pointerover"]),vs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vs("onBeforeInput",["compositionend","keypress","textInput","paste"]),vs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pp=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(xa));function zd(a,l){l=(l&4)!==0;for(var m=0;m<a.length;m++){var w=a[m],Se=w.event;w=w.listeners;e:{var Ge=void 0;if(l)for(var Ot=w.length-1;0<=Ot;Ot--){var gr=w[Ot],kr=gr.instance,Ir=gr.currentTarget;if(gr=gr.listener,kr!==Ge&&Se.isPropagationStopped())break e;Ge=gr,Se.currentTarget=Ir;try{Ge(Se)}catch(Hr){Na(Hr)}Se.currentTarget=null,Ge=kr}else for(Ot=0;Ot<w.length;Ot++){if(gr=w[Ot],kr=gr.instance,Ir=gr.currentTarget,gr=gr.listener,kr!==Ge&&Se.isPropagationStopped())break e;Ge=gr,Se.currentTarget=Ir;try{Ge(Se)}catch(Hr){Na(Hr)}Se.currentTarget=null,Ge=kr}}}}function ln(a,l){var m=l[Bi];m===void 0&&(m=l[Bi]=new Set);var w=a+"__bubble";m.has(w)||(Vd(l,a,2,!1),m.add(w))}function w0(a,l,m){var w=0;l&&(w|=4),Vd(m,a,w,l)}var gc="_reactListening"+Math.random().toString(36).slice(2);function v0(a){if(!a[gc]){a[gc]=!0,Ki.forEach(function(m){m!=="selectionchange"&&(Pp.has(m)||w0(m,!1,a),w0(m,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[gc]||(l[gc]=!0,w0("selectionchange",!1,l))}}function Vd(a,l,m,w){switch(vf(l)){case 2:var Se=xm;break;case 8:Se=dm;break;default:Se=P0}m=Se.bind(null,l,m,a),Se=void 0,!Hc||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(Se=!0),w?Se!==void 0?a.addEventListener(l,m,{capture:!0,passive:Se}):a.addEventListener(l,m,!0):Se!==void 0?a.addEventListener(l,m,{passive:Se}):a.addEventListener(l,m,!1)}function A0(a,l,m,w,Se){var Ge=w;if((l&1)===0&&(l&2)===0&&w!==null)e:for(;;){if(w===null)return;var Ot=w.tag;if(Ot===3||Ot===4){var gr=w.stateNode.containerInfo;if(gr===Se)break;if(Ot===4)for(Ot=w.return;Ot!==null;){var kr=Ot.tag;if((kr===3||kr===4)&&Ot.stateNode.containerInfo===Se)return;Ot=Ot.return}for(;gr!==null;){if(Ot=Ss(gr),Ot===null)return;if(kr=Ot.tag,kr===5||kr===6||kr===26||kr===27){w=Ge=Ot;continue e}gr=gr.parentNode}}w=w.return}Z0(function(){var Ir=Ge,Hr=Oc(m),Kr=[];e:{var Pr=Cu.get(a);if(Pr!==void 0){var Ur=Ra,Wr=a;switch(a){case"keypress":if(Ca(m)===0)break e;case"keydown":case"keyup":Ur=kh;break;case"focusin":Wr="focus",Ur=Vc;break;case"focusout":Wr="blur",Ur=Vc;break;case"beforeblur":case"afterblur":Ur=Vc;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ur=eu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ur=gh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ur=Dh;break;case wu:case vu:case Au:Ur=bh;break;case Bu:Ur=Th;break;case"scroll":case"scrollend":Ur=ph;break;case"wheel":Ur=Ih;break;case"copy":case"cut":case"paste":Ur=vh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ur=ru;break;case"toggle":case"beforetoggle":Ur=Mh}var en=(l&4)!==0,Sn=!en&&(a==="scroll"||a==="scrollend"),Fr=en?Pr!==null?Pr+"Capture":null:Pr;en=[];for(var Dr=Ir,$r;Dr!==null;){var qr=Dr;if($r=qr.stateNode,qr=qr.tag,qr!==5&&qr!==26&&qr!==27||$r===null||Fr===null||(qr=Fo(Dr,Fr),qr!=null&&en.push(da(Dr,qr,$r))),Sn)break;Dr=Dr.return}0<en.length&&(Pr=new Ur(Pr,Wr,null,m,Hr),Kr.push({event:Pr,listeners:en}))}}if((l&7)===0){e:{if(Pr=a==="mouseover"||a==="pointerover",Ur=a==="mouseout"||a==="pointerout",Pr&&m!==Uc&&(Wr=m.relatedTarget||m.fromElement)&&(Ss(Wr)||Wr[_n]))break e;if((Ur||Pr)&&(Pr=Hr.window===Hr?Hr:(Pr=Hr.ownerDocument)?Pr.defaultView||Pr.parentWindow:window,Ur?(Wr=m.relatedTarget||m.toElement,Ur=Ir,Wr=Wr?Ss(Wr):null,Wr!==null&&(Sn=o(Wr),en=Wr.tag,Wr!==Sn||en!==5&&en!==27&&en!==6)&&(Wr=null)):(Ur=null,Wr=Ir),Ur!==Wr)){if(en=eu,qr="onMouseLeave",Fr="onMouseEnter",Dr="mouse",(a==="pointerout"||a==="pointerover")&&(en=ru,qr="onPointerLeave",Fr="onPointerEnter",Dr="pointer"),Sn=Ur==null?Pr:$s(Ur),$r=Wr==null?Pr:$s(Wr),Pr=new en(qr,Dr+"leave",Ur,m,Hr),Pr.target=Sn,Pr.relatedTarget=$r,qr=null,Ss(Hr)===Ir&&(en=new en(Fr,Dr+"enter",Wr,m,Hr),en.target=$r,en.relatedTarget=Sn,qr=en),Sn=qr,Ur&&Wr)t:{for(en=Mp,Fr=Ur,Dr=Wr,$r=0,qr=Fr;qr;qr=en(qr))$r++;qr=0;for(var Qr=Dr;Qr;Qr=en(Qr))qr++;for(;0<$r-qr;)Fr=en(Fr),$r--;for(;0<qr-$r;)Dr=en(Dr),qr--;for(;$r--;){if(Fr===Dr||Dr!==null&&Fr===Dr.alternate){en=Fr;break t}Fr=en(Fr),Dr=en(Dr)}en=null}else en=null;Ur!==null&&Gd(Kr,Pr,Ur,en,!1),Wr!==null&&Sn!==null&&Gd(Kr,Sn,Wr,en,!0)}}e:{if(Pr=Ir?$s(Ir):window,Ur=Pr.nodeName&&Pr.nodeName.toLowerCase(),Ur==="select"||Ur==="input"&&Pr.type==="file")var pn=uu;else if(cu(Pr))if(xu)pn=Wh;else{pn=Vh;var Xr=zh}else Ur=Pr.nodeName,!Ur||Ur.toLowerCase()!=="input"||Pr.type!=="checkbox"&&Pr.type!=="radio"?Ir&&Mc(Ir.elementType)&&(pn=uu):pn=Gh;if(pn&&(pn=pn(a,Ir))){lu(Kr,pn,m,Hr);break e}Xr&&Xr(a,Pr,Ir),a==="focusout"&&Ir&&Pr.type==="number"&&Ir.memoizedProps.value!=null&&Pc(Pr,"number",Pr.value)}switch(Xr=Ir?$s(Ir):window,a){case"focusin":(cu(Xr)||Xr.contentEditable==="true")&&(Ji=Xr,Qc=Ir,Lo=null);break;case"focusout":Lo=Qc=Ji=null;break;case"mousedown":Jc=!0;break;case"contextmenu":case"mouseup":case"dragend":Jc=!1,Eu(Kr,m,Hr);break;case"selectionchange":if(Xh)break;case"keydown":case"keyup":Eu(Kr,m,Hr)}var on;if(Wc)e:{switch(a){case"compositionstart":var dn="onCompositionStart";break e;case"compositionend":dn="onCompositionEnd";break e;case"compositionupdate":dn="onCompositionUpdate";break e}dn=void 0}else Qi?ou(a,m)&&(dn="onCompositionEnd"):a==="keydown"&&m.keyCode===229&&(dn="onCompositionStart");dn&&(nu&&m.locale!=="ko"&&(Qi||dn!=="onCompositionStart"?dn==="onCompositionEnd"&&Qi&&(on=Q0()):(ei=Hr,qc="value"in ei?ei.value:ei.textContent,Qi=!0)),Xr=yc(Ir,dn),0<Xr.length&&(dn=new tu(dn,a,null,m,Hr),Kr.push({event:dn,listeners:Xr}),on?dn.data=on:(on=au(m),on!==null&&(dn.data=on)))),(on=Oh?Lh(a,m):Hh(a,m))&&(dn=yc(Ir,"onBeforeInput"),0<dn.length&&(Xr=new tu("onBeforeInput","beforeinput",null,m,Hr),Kr.push({event:Xr,listeners:dn}),Xr.data=on)),Tp(Kr,a,Ir,m,Hr)}zd(Kr,l)})}function da(a,l,m){return{instance:a,listener:l,currentTarget:m}}function yc(a,l){for(var m=l+"Capture",w=[];a!==null;){var Se=a,Ge=Se.stateNode;if(Se=Se.tag,Se!==5&&Se!==26&&Se!==27||Ge===null||(Se=Fo(a,m),Se!=null&&w.unshift(da(a,Se,Ge)),Se=Fo(a,l),Se!=null&&w.push(da(a,Se,Ge))),a.tag===3)return w;a=a.return}return[]}function Mp(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Gd(a,l,m,w,Se){for(var Ge=l._reactName,Ot=[];m!==null&&m!==w;){var gr=m,kr=gr.alternate,Ir=gr.stateNode;if(gr=gr.tag,kr!==null&&kr===w)break;gr!==5&&gr!==26&&gr!==27||Ir===null||(kr=Ir,Se?(Ir=Fo(m,Ge),Ir!=null&&Ot.unshift(da(m,Ir,kr))):Se||(Ir=Fo(m,Ge),Ir!=null&&Ot.push(da(m,Ir,kr)))),m=m.return}Ot.length!==0&&a.push({event:l,listeners:Ot})}var Up=/\r\n?/g,Op=/\u0000|\uFFFD/g;function Wd(a){return(typeof a=="string"?a:""+a).replace(Up,`
`).replace(Op,"")}function Yd(a,l){return l=Wd(l),Wd(a)===l}function Cn(a,l,m,w,Se,Ge){switch(m){case"children":typeof w=="string"?l==="body"||l==="textarea"&&w===""||Yi(a,w):(typeof w=="number"||typeof w=="bigint")&&l!=="body"&&Yi(a,""+w);break;case"className":wa(a,"class",w);break;case"tabIndex":wa(a,"tabindex",w);break;case"dir":case"role":case"viewBox":case"width":case"height":wa(a,m,w);break;case"style":Y0(a,w,Ge);break;case"data":if(l!=="object"){wa(a,"data",w);break}case"src":case"href":if(w===""&&(l!=="a"||m!=="href")){a.removeAttribute(m);break}if(w==null||typeof w=="function"||typeof w=="symbol"||typeof w=="boolean"){a.removeAttribute(m);break}w=Aa(""+w),a.setAttribute(m,w);break;case"action":case"formAction":if(typeof w=="function"){a.setAttribute(m,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof Ge=="function"&&(m==="formAction"?(l!=="input"&&Cn(a,l,"name",Se.name,Se,null),Cn(a,l,"formEncType",Se.formEncType,Se,null),Cn(a,l,"formMethod",Se.formMethod,Se,null),Cn(a,l,"formTarget",Se.formTarget,Se,null)):(Cn(a,l,"encType",Se.encType,Se,null),Cn(a,l,"method",Se.method,Se,null),Cn(a,l,"target",Se.target,Se,null)));if(w==null||typeof w=="symbol"||typeof w=="boolean"){a.removeAttribute(m);break}w=Aa(""+w),a.setAttribute(m,w);break;case"onClick":w!=null&&(a.onclick=Ps);break;case"onScroll":w!=null&&ln("scroll",a);break;case"onScrollEnd":w!=null&&ln("scrollend",a);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(n(61));if(m=w.__html,m!=null){if(Se.children!=null)throw Error(n(60));a.innerHTML=m}}break;case"multiple":a.multiple=w&&typeof w!="function"&&typeof w!="symbol";break;case"muted":a.muted=w&&typeof w!="function"&&typeof w!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(w==null||typeof w=="function"||typeof w=="boolean"||typeof w=="symbol"){a.removeAttribute("xlink:href");break}m=Aa(""+w),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":w!=null&&typeof w!="function"&&typeof w!="symbol"?a.setAttribute(m,""+w):a.removeAttribute(m);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":w&&typeof w!="function"&&typeof w!="symbol"?a.setAttribute(m,""):a.removeAttribute(m);break;case"capture":case"download":w===!0?a.setAttribute(m,""):w!==!1&&w!=null&&typeof w!="function"&&typeof w!="symbol"?a.setAttribute(m,w):a.removeAttribute(m);break;case"cols":case"rows":case"size":case"span":w!=null&&typeof w!="function"&&typeof w!="symbol"&&!isNaN(w)&&1<=w?a.setAttribute(m,w):a.removeAttribute(m);break;case"rowSpan":case"start":w==null||typeof w=="function"||typeof w=="symbol"||isNaN(w)?a.removeAttribute(m):a.setAttribute(m,w);break;case"popover":ln("beforetoggle",a),ln("toggle",a),ba(a,"popover",w);break;case"xlinkActuate":Is(a,"http://www.w3.org/1999/xlink","xlink:actuate",w);break;case"xlinkArcrole":Is(a,"http://www.w3.org/1999/xlink","xlink:arcrole",w);break;case"xlinkRole":Is(a,"http://www.w3.org/1999/xlink","xlink:role",w);break;case"xlinkShow":Is(a,"http://www.w3.org/1999/xlink","xlink:show",w);break;case"xlinkTitle":Is(a,"http://www.w3.org/1999/xlink","xlink:title",w);break;case"xlinkType":Is(a,"http://www.w3.org/1999/xlink","xlink:type",w);break;case"xmlBase":Is(a,"http://www.w3.org/XML/1998/namespace","xml:base",w);break;case"xmlLang":Is(a,"http://www.w3.org/XML/1998/namespace","xml:lang",w);break;case"xmlSpace":Is(a,"http://www.w3.org/XML/1998/namespace","xml:space",w);break;case"is":ba(a,"is",w);break;case"innerText":case"textContent":break;default:(!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(m=fh.get(m)||m,ba(a,m,w))}}function B0(a,l,m,w,Se,Ge){switch(m){case"style":Y0(a,w,Ge);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(n(61));if(m=w.__html,m!=null){if(Se.children!=null)throw Error(n(60));a.innerHTML=m}}break;case"children":typeof w=="string"?Yi(a,w):(typeof w=="number"||typeof w=="bigint")&&Yi(a,""+w);break;case"onScroll":w!=null&&ln("scroll",a);break;case"onScrollEnd":w!=null&&ln("scrollend",a);break;case"onClick":w!=null&&(a.onclick=Ps);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!zi.hasOwnProperty(m))e:{if(m[0]==="o"&&m[1]==="n"&&(Se=m.endsWith("Capture"),l=m.slice(2,Se?m.length-7:void 0),Ge=a[fn]||null,Ge=Ge!=null?Ge[m]:null,typeof Ge=="function"&&a.removeEventListener(l,Ge,Se),typeof w=="function")){typeof Ge!="function"&&Ge!==null&&(m in a?a[m]=null:a.hasAttribute(m)&&a.removeAttribute(m)),a.addEventListener(l,w,Se);break e}m in a?a[m]=w:w===!0?a.setAttribute(m,""):ba(a,m,w)}}}function Wn(a,l,m){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ln("error",a),ln("load",a);var w=!1,Se=!1,Ge;for(Ge in m)if(m.hasOwnProperty(Ge)){var Ot=m[Ge];if(Ot!=null)switch(Ge){case"src":w=!0;break;case"srcSet":Se=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:Cn(a,l,Ge,Ot,m,null)}}Se&&Cn(a,l,"srcSet",m.srcSet,m,null),w&&Cn(a,l,"src",m.src,m,null);return;case"input":ln("invalid",a);var gr=Ge=Ot=Se=null,kr=null,Ir=null;for(w in m)if(m.hasOwnProperty(w)){var Hr=m[w];if(Hr!=null)switch(w){case"name":Se=Hr;break;case"type":Ot=Hr;break;case"checked":kr=Hr;break;case"defaultChecked":Ir=Hr;break;case"value":Ge=Hr;break;case"defaultValue":gr=Hr;break;case"children":case"dangerouslySetInnerHTML":if(Hr!=null)throw Error(n(137,l));break;default:Cn(a,l,w,Hr,m,null)}}z0(a,Ge,gr,kr,Ir,Ot,Se,!1);return;case"select":ln("invalid",a),w=Ot=Ge=null;for(Se in m)if(m.hasOwnProperty(Se)&&(gr=m[Se],gr!=null))switch(Se){case"value":Ge=gr;break;case"defaultValue":Ot=gr;break;case"multiple":w=gr;default:Cn(a,l,Se,gr,m,null)}l=Ge,m=Ot,a.multiple=!!w,l!=null?Wi(a,!!w,l,!1):m!=null&&Wi(a,!!w,m,!0);return;case"textarea":ln("invalid",a),Ge=Se=w=null;for(Ot in m)if(m.hasOwnProperty(Ot)&&(gr=m[Ot],gr!=null))switch(Ot){case"value":w=gr;break;case"defaultValue":Se=gr;break;case"children":Ge=gr;break;case"dangerouslySetInnerHTML":if(gr!=null)throw Error(n(91));break;default:Cn(a,l,Ot,gr,m,null)}G0(a,w,Se,Ge);return;case"option":for(kr in m)if(m.hasOwnProperty(kr)&&(w=m[kr],w!=null))switch(kr){case"selected":a.selected=w&&typeof w!="function"&&typeof w!="symbol";break;default:Cn(a,l,kr,w,m,null)}return;case"dialog":ln("beforetoggle",a),ln("toggle",a),ln("cancel",a),ln("close",a);break;case"iframe":case"object":ln("load",a);break;case"video":case"audio":for(w=0;w<xa.length;w++)ln(xa[w],a);break;case"image":ln("error",a),ln("load",a);break;case"details":ln("toggle",a);break;case"embed":case"source":case"link":ln("error",a),ln("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ir in m)if(m.hasOwnProperty(Ir)&&(w=m[Ir],w!=null))switch(Ir){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:Cn(a,l,Ir,w,m,null)}return;default:if(Mc(l)){for(Hr in m)m.hasOwnProperty(Hr)&&(w=m[Hr],w!==void 0&&B0(a,l,Hr,w,m,void 0));return}}for(gr in m)m.hasOwnProperty(gr)&&(w=m[gr],w!=null&&Cn(a,l,gr,w,m,null))}function Lp(a,l,m,w){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var Se=null,Ge=null,Ot=null,gr=null,kr=null,Ir=null,Hr=null;for(Ur in m){var Kr=m[Ur];if(m.hasOwnProperty(Ur)&&Kr!=null)switch(Ur){case"checked":break;case"value":break;case"defaultValue":kr=Kr;default:w.hasOwnProperty(Ur)||Cn(a,l,Ur,null,w,Kr)}}for(var Pr in w){var Ur=w[Pr];if(Kr=m[Pr],w.hasOwnProperty(Pr)&&(Ur!=null||Kr!=null))switch(Pr){case"type":Ge=Ur;break;case"name":Se=Ur;break;case"checked":Ir=Ur;break;case"defaultChecked":Hr=Ur;break;case"value":Ot=Ur;break;case"defaultValue":gr=Ur;break;case"children":case"dangerouslySetInnerHTML":if(Ur!=null)throw Error(n(137,l));break;default:Ur!==Kr&&Cn(a,l,Pr,Ur,w,Kr)}}Ic(a,Ot,gr,kr,Ir,Hr,Ge,Se);return;case"select":Ur=Ot=gr=Pr=null;for(Ge in m)if(kr=m[Ge],m.hasOwnProperty(Ge)&&kr!=null)switch(Ge){case"value":break;case"multiple":Ur=kr;default:w.hasOwnProperty(Ge)||Cn(a,l,Ge,null,w,kr)}for(Se in w)if(Ge=w[Se],kr=m[Se],w.hasOwnProperty(Se)&&(Ge!=null||kr!=null))switch(Se){case"value":Pr=Ge;break;case"defaultValue":gr=Ge;break;case"multiple":Ot=Ge;default:Ge!==kr&&Cn(a,l,Se,Ge,w,kr)}l=gr,m=Ot,w=Ur,Pr!=null?Wi(a,!!m,Pr,!1):!!w!=!!m&&(l!=null?Wi(a,!!m,l,!0):Wi(a,!!m,m?[]:"",!1));return;case"textarea":Ur=Pr=null;for(gr in m)if(Se=m[gr],m.hasOwnProperty(gr)&&Se!=null&&!w.hasOwnProperty(gr))switch(gr){case"value":break;case"children":break;default:Cn(a,l,gr,null,w,Se)}for(Ot in w)if(Se=w[Ot],Ge=m[Ot],w.hasOwnProperty(Ot)&&(Se!=null||Ge!=null))switch(Ot){case"value":Pr=Se;break;case"defaultValue":Ur=Se;break;case"children":break;case"dangerouslySetInnerHTML":if(Se!=null)throw Error(n(91));break;default:Se!==Ge&&Cn(a,l,Ot,Se,w,Ge)}V0(a,Pr,Ur);return;case"option":for(var Wr in m)if(Pr=m[Wr],m.hasOwnProperty(Wr)&&Pr!=null&&!w.hasOwnProperty(Wr))switch(Wr){case"selected":a.selected=!1;break;default:Cn(a,l,Wr,null,w,Pr)}for(kr in w)if(Pr=w[kr],Ur=m[kr],w.hasOwnProperty(kr)&&Pr!==Ur&&(Pr!=null||Ur!=null))switch(kr){case"selected":a.selected=Pr&&typeof Pr!="function"&&typeof Pr!="symbol";break;default:Cn(a,l,kr,Pr,w,Ur)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var en in m)Pr=m[en],m.hasOwnProperty(en)&&Pr!=null&&!w.hasOwnProperty(en)&&Cn(a,l,en,null,w,Pr);for(Ir in w)if(Pr=w[Ir],Ur=m[Ir],w.hasOwnProperty(Ir)&&Pr!==Ur&&(Pr!=null||Ur!=null))switch(Ir){case"children":case"dangerouslySetInnerHTML":if(Pr!=null)throw Error(n(137,l));break;default:Cn(a,l,Ir,Pr,w,Ur)}return;default:if(Mc(l)){for(var Sn in m)Pr=m[Sn],m.hasOwnProperty(Sn)&&Pr!==void 0&&!w.hasOwnProperty(Sn)&&B0(a,l,Sn,void 0,w,Pr);for(Hr in w)Pr=w[Hr],Ur=m[Hr],!w.hasOwnProperty(Hr)||Pr===Ur||Pr===void 0&&Ur===void 0||B0(a,l,Hr,Pr,w,Ur);return}}for(var Fr in m)Pr=m[Fr],m.hasOwnProperty(Fr)&&Pr!=null&&!w.hasOwnProperty(Fr)&&Cn(a,l,Fr,null,w,Pr);for(Kr in w)Pr=w[Kr],Ur=m[Kr],!w.hasOwnProperty(Kr)||Pr===Ur||Pr==null&&Ur==null||Cn(a,l,Kr,Pr,w,Ur)}function Xd(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Hp(){if(typeof performance.getEntriesByType=="function"){for(var a=0,l=0,m=performance.getEntriesByType("resource"),w=0;w<m.length;w++){var Se=m[w],Ge=Se.transferSize,Ot=Se.initiatorType,gr=Se.duration;if(Ge&&gr&&Xd(Ot)){for(Ot=0,gr=Se.responseEnd,w+=1;w<m.length;w++){var kr=m[w],Ir=kr.startTime;if(Ir>gr)break;var Hr=kr.transferSize,Kr=kr.initiatorType;Hr&&Xd(Kr)&&(kr=kr.responseEnd,Ot+=Hr*(kr<gr?1:(gr-Ir)/(kr-Ir)))}if(--w,l+=8*(Ge+Ot)/(Se.duration/1e3),a++,10<a)break}}if(0<a)return l/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var C0=null,S0=null;function Ec(a){return a.nodeType===9?a:a.ownerDocument}function Zd(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Qd(a,l){if(a===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&l==="foreignObject"?0:a}function _0(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var R0=null;function qp(){var a=window.event;return a&&a.type==="popstate"?a===R0?!1:(R0=a,!0):(R0=null,!1)}var Jd=typeof setTimeout=="function"?setTimeout:void 0,Kp=typeof clearTimeout=="function"?clearTimeout:void 0,ef=typeof Promise=="function"?Promise:void 0,zp=typeof queueMicrotask=="function"?queueMicrotask:typeof ef<"u"?function(a){return ef.resolve(null).then(a).catch(Vp)}:Jd;function Vp(a){setTimeout(function(){throw a})}function gi(a){return a==="head"}function tf(a,l){var m=l,w=0;do{var Se=m.nextSibling;if(a.removeChild(m),Se&&Se.nodeType===8)if(m=Se.data,m==="/$"||m==="/&"){if(w===0){a.removeChild(Se),_o(l);return}w--}else if(m==="$"||m==="$?"||m==="$~"||m==="$!"||m==="&")w++;else if(m==="html")fa(a.ownerDocument.documentElement);else if(m==="head"){m=a.ownerDocument.head,fa(m);for(var Ge=m.firstChild;Ge;){var Ot=Ge.nextSibling,gr=Ge.nodeName;Ge[Ts]||gr==="SCRIPT"||gr==="STYLE"||gr==="LINK"&&Ge.rel.toLowerCase()==="stylesheet"||m.removeChild(Ge),Ge=Ot}}else m==="body"&&fa(a.ownerDocument.body);m=Se}while(m);_o(l)}function rf(a,l){var m=a;a=0;do{var w=m.nextSibling;if(m.nodeType===1?l?(m._stashedDisplay=m.style.display,m.style.display="none"):(m.style.display=m._stashedDisplay||"",m.getAttribute("style")===""&&m.removeAttribute("style")):m.nodeType===3&&(l?(m._stashedText=m.nodeValue,m.nodeValue=""):m.nodeValue=m._stashedText||""),w&&w.nodeType===8)if(m=w.data,m==="/$"){if(a===0)break;a--}else m!=="$"&&m!=="$?"&&m!=="$~"&&m!=="$!"||a++;m=w}while(m)}function k0(a){var l=a.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var m=l;switch(l=l.nextSibling,m.nodeName){case"HTML":case"HEAD":case"BODY":k0(m),Ci(m);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(m.rel.toLowerCase()==="stylesheet")continue}a.removeChild(m)}}function Gp(a,l,m,w){for(;a.nodeType===1;){var Se=m;if(a.nodeName.toLowerCase()!==l.toLowerCase()){if(!w&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(w){if(!a[Ts])switch(l){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(Ge=a.getAttribute("rel"),Ge==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(Ge!==Se.rel||a.getAttribute("href")!==(Se.href==null||Se.href===""?null:Se.href)||a.getAttribute("crossorigin")!==(Se.crossOrigin==null?null:Se.crossOrigin)||a.getAttribute("title")!==(Se.title==null?null:Se.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(Ge=a.getAttribute("src"),(Ge!==(Se.src==null?null:Se.src)||a.getAttribute("type")!==(Se.type==null?null:Se.type)||a.getAttribute("crossorigin")!==(Se.crossOrigin==null?null:Se.crossOrigin))&&Ge&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(l==="input"&&a.type==="hidden"){var Ge=Se.name==null?null:""+Se.name;if(Se.type==="hidden"&&a.getAttribute("name")===Ge)return a}else return a;if(a=bs(a.nextSibling),a===null)break}return null}function Wp(a,l,m){if(l==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!m||(a=bs(a.nextSibling),a===null))return null;return a}function nf(a,l){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!l||(a=bs(a.nextSibling),a===null))return null;return a}function j0(a){return a.data==="$?"||a.data==="$~"}function N0(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function Yp(a,l){var m=a.ownerDocument;if(a.data==="$~")a._reactRetry=l;else if(a.data!=="$?"||m.readyState!=="loading")l();else{var w=function(){l(),m.removeEventListener("DOMContentLoaded",w)};m.addEventListener("DOMContentLoaded",w),a._reactRetry=w}}function bs(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"||l==="F!"||l==="F")break;if(l==="/$"||l==="/&")return null}}return a}var D0=null;function sf(a){a=a.nextSibling;for(var l=0;a;){if(a.nodeType===8){var m=a.data;if(m==="/$"||m==="/&"){if(l===0)return bs(a.nextSibling);l--}else m!=="$"&&m!=="$!"&&m!=="$?"&&m!=="$~"&&m!=="&"||l++}a=a.nextSibling}return null}function of(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var m=a.data;if(m==="$"||m==="$!"||m==="$?"||m==="$~"||m==="&"){if(l===0)return a;l--}else m!=="/$"&&m!=="/&"||l++}a=a.previousSibling}return null}function af(a,l,m){switch(l=Ec(m),a){case"html":if(a=l.documentElement,!a)throw Error(n(452));return a;case"head":if(a=l.head,!a)throw Error(n(453));return a;case"body":if(a=l.body,!a)throw Error(n(454));return a;default:throw Error(n(451))}}function fa(a){for(var l=a.attributes;l.length;)a.removeAttributeNode(l[0]);Ci(a)}var ws=new Map,cf=new Set;function bc(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Js=Le.d;Le.d={f:Xp,r:Zp,D:Qp,C:Jp,L:em,m:tm,X:nm,S:rm,M:sm};function Xp(){var a=Js.f(),l=xc();return a||l}function Zp(a){var l=_s(a);l!==null&&l.tag===5&&l.type==="form"?Bx(l):Js.r(a)}var Bo=typeof document>"u"?null:document;function lf(a,l,m){var w=Bo;if(w&&typeof l=="string"&&l){var Se=ds(l);Se='link[rel="'+a+'"][href="'+Se+'"]',typeof m=="string"&&(Se+='[crossorigin="'+m+'"]'),cf.has(Se)||(cf.add(Se),a={rel:a,crossOrigin:m,href:l},w.querySelector(Se)===null&&(l=w.createElement("link"),Wn(l,"link",a),Dn(l),w.head.appendChild(l)))}}function Qp(a){Js.D(a),lf("dns-prefetch",a,null)}function Jp(a,l){Js.C(a,l),lf("preconnect",a,l)}function em(a,l,m){Js.L(a,l,m);var w=Bo;if(w&&a&&l){var Se='link[rel="preload"][as="'+ds(l)+'"]';l==="image"&&m&&m.imageSrcSet?(Se+='[imagesrcset="'+ds(m.imageSrcSet)+'"]',typeof m.imageSizes=="string"&&(Se+='[imagesizes="'+ds(m.imageSizes)+'"]')):Se+='[href="'+ds(a)+'"]';var Ge=Se;switch(l){case"style":Ge=Co(a);break;case"script":Ge=So(a)}ws.has(Ge)||(a=g({rel:"preload",href:l==="image"&&m&&m.imageSrcSet?void 0:a,as:l},m),ws.set(Ge,a),w.querySelector(Se)!==null||l==="style"&&w.querySelector(ha(Ge))||l==="script"&&w.querySelector(pa(Ge))||(l=w.createElement("link"),Wn(l,"link",a),Dn(l),w.head.appendChild(l)))}}function tm(a,l){Js.m(a,l);var m=Bo;if(m&&a){var w=l&&typeof l.as=="string"?l.as:"script",Se='link[rel="modulepreload"][as="'+ds(w)+'"][href="'+ds(a)+'"]',Ge=Se;switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":Ge=So(a)}if(!ws.has(Ge)&&(a=g({rel:"modulepreload",href:a},l),ws.set(Ge,a),m.querySelector(Se)===null)){switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(m.querySelector(pa(Ge)))return}w=m.createElement("link"),Wn(w,"link",a),Dn(w),m.head.appendChild(w)}}}function rm(a,l,m){Js.S(a,l,m);var w=Bo;if(w&&a){var Se=Rs(w).hoistableStyles,Ge=Co(a);l=l||"default";var Ot=Se.get(Ge);if(!Ot){var gr={loading:0,preload:null};if(Ot=w.querySelector(ha(Ge)))gr.loading=5;else{a=g({rel:"stylesheet",href:a,"data-precedence":l},m),(m=ws.get(Ge))&&F0(a,m);var kr=Ot=w.createElement("link");Dn(kr),Wn(kr,"link",a),kr._p=new Promise(function(Ir,Hr){kr.onload=Ir,kr.onerror=Hr}),kr.addEventListener("load",function(){gr.loading|=1}),kr.addEventListener("error",function(){gr.loading|=2}),gr.loading|=4,wc(Ot,l,w)}Ot={type:"stylesheet",instance:Ot,count:1,state:gr},Se.set(Ge,Ot)}}}function nm(a,l){Js.X(a,l);var m=Bo;if(m&&a){var w=Rs(m).hoistableScripts,Se=So(a),Ge=w.get(Se);Ge||(Ge=m.querySelector(pa(Se)),Ge||(a=g({src:a,async:!0},l),(l=ws.get(Se))&&T0(a,l),Ge=m.createElement("script"),Dn(Ge),Wn(Ge,"link",a),m.head.appendChild(Ge)),Ge={type:"script",instance:Ge,count:1,state:null},w.set(Se,Ge))}}function sm(a,l){Js.M(a,l);var m=Bo;if(m&&a){var w=Rs(m).hoistableScripts,Se=So(a),Ge=w.get(Se);Ge||(Ge=m.querySelector(pa(Se)),Ge||(a=g({src:a,async:!0,type:"module"},l),(l=ws.get(Se))&&T0(a,l),Ge=m.createElement("script"),Dn(Ge),Wn(Ge,"link",a),m.head.appendChild(Ge)),Ge={type:"script",instance:Ge,count:1,state:null},w.set(Se,Ge))}}function uf(a,l,m,w){var Se=(Se=rr.current)?bc(Se):null;if(!Se)throw Error(n(446));switch(a){case"meta":case"title":return null;case"style":return typeof m.precedence=="string"&&typeof m.href=="string"?(l=Co(m.href),m=Rs(Se).hoistableStyles,w=m.get(l),w||(w={type:"style",instance:null,count:0,state:null},m.set(l,w)),w):{type:"void",instance:null,count:0,state:null};case"link":if(m.rel==="stylesheet"&&typeof m.href=="string"&&typeof m.precedence=="string"){a=Co(m.href);var Ge=Rs(Se).hoistableStyles,Ot=Ge.get(a);if(Ot||(Se=Se.ownerDocument||Se,Ot={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},Ge.set(a,Ot),(Ge=Se.querySelector(ha(a)))&&!Ge._p&&(Ot.instance=Ge,Ot.state.loading=5),ws.has(a)||(m={rel:"preload",as:"style",href:m.href,crossOrigin:m.crossOrigin,integrity:m.integrity,media:m.media,hrefLang:m.hrefLang,referrerPolicy:m.referrerPolicy},ws.set(a,m),Ge||im(Se,a,m,Ot.state))),l&&w===null)throw Error(n(528,""));return Ot}if(l&&w!==null)throw Error(n(529,""));return null;case"script":return l=m.async,m=m.src,typeof m=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=So(m),m=Rs(Se).hoistableScripts,w=m.get(l),w||(w={type:"script",instance:null,count:0,state:null},m.set(l,w)),w):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,a))}}function Co(a){return'href="'+ds(a)+'"'}function ha(a){return'link[rel="stylesheet"]['+a+"]"}function xf(a){return g({},a,{"data-precedence":a.precedence,precedence:null})}function im(a,l,m,w){a.querySelector('link[rel="preload"][as="style"]['+l+"]")?w.loading=1:(l=a.createElement("link"),w.preload=l,l.addEventListener("load",function(){return w.loading|=1}),l.addEventListener("error",function(){return w.loading|=2}),Wn(l,"link",m),Dn(l),a.head.appendChild(l))}function So(a){return'[src="'+ds(a)+'"]'}function pa(a){return"script[async]"+a}function df(a,l,m){if(l.count++,l.instance===null)switch(l.type){case"style":var w=a.querySelector('style[data-href~="'+ds(m.href)+'"]');if(w)return l.instance=w,Dn(w),w;var Se=g({},m,{"data-href":m.href,"data-precedence":m.precedence,href:null,precedence:null});return w=(a.ownerDocument||a).createElement("style"),Dn(w),Wn(w,"style",Se),wc(w,m.precedence,a),l.instance=w;case"stylesheet":Se=Co(m.href);var Ge=a.querySelector(ha(Se));if(Ge)return l.state.loading|=4,l.instance=Ge,Dn(Ge),Ge;w=xf(m),(Se=ws.get(Se))&&F0(w,Se),Ge=(a.ownerDocument||a).createElement("link"),Dn(Ge);var Ot=Ge;return Ot._p=new Promise(function(gr,kr){Ot.onload=gr,Ot.onerror=kr}),Wn(Ge,"link",w),l.state.loading|=4,wc(Ge,m.precedence,a),l.instance=Ge;case"script":return Ge=So(m.src),(Se=a.querySelector(pa(Ge)))?(l.instance=Se,Dn(Se),Se):(w=m,(Se=ws.get(Ge))&&(w=g({},m),T0(w,Se)),a=a.ownerDocument||a,Se=a.createElement("script"),Dn(Se),Wn(Se,"link",w),a.head.appendChild(Se),l.instance=Se);case"void":return null;default:throw Error(n(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(w=l.instance,l.state.loading|=4,wc(w,m.precedence,a));return l.instance}function wc(a,l,m){for(var w=m.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),Se=w.length?w[w.length-1]:null,Ge=Se,Ot=0;Ot<w.length;Ot++){var gr=w[Ot];if(gr.dataset.precedence===l)Ge=gr;else if(Ge!==Se)break}Ge?Ge.parentNode.insertBefore(a,Ge.nextSibling):(l=m.nodeType===9?m.head:m,l.insertBefore(a,l.firstChild))}function F0(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.title==null&&(a.title=l.title)}function T0(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.integrity==null&&(a.integrity=l.integrity)}var vc=null;function ff(a,l,m){if(vc===null){var w=new Map,Se=vc=new Map;Se.set(m,w)}else Se=vc,w=Se.get(m),w||(w=new Map,Se.set(m,w));if(w.has(a))return w;for(w.set(a,null),m=m.getElementsByTagName(a),Se=0;Se<m.length;Se++){var Ge=m[Se];if(!(Ge[Ts]||Ge[rn]||a==="link"&&Ge.getAttribute("rel")==="stylesheet")&&Ge.namespaceURI!=="http://www.w3.org/2000/svg"){var Ot=Ge.getAttribute(l)||"";Ot=a+Ot;var gr=w.get(Ot);gr?gr.push(Ge):w.set(Ot,[Ge])}}return w}function hf(a,l,m){a=a.ownerDocument||a,a.head.insertBefore(m,l==="title"?a.querySelector("head > title"):null)}function om(a,l,m){if(m===1||l.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;switch(l.rel){case"stylesheet":return a=l.disabled,typeof l.precedence=="string"&&a==null;default:return!0}case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function pf(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function am(a,l,m,w){if(m.type==="stylesheet"&&(typeof w.media!="string"||matchMedia(w.media).matches!==!1)&&(m.state.loading&4)===0){if(m.instance===null){var Se=Co(w.href),Ge=l.querySelector(ha(Se));if(Ge){l=Ge._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(a.count++,a=Ac.bind(a),l.then(a,a)),m.state.loading|=4,m.instance=Ge,Dn(Ge);return}Ge=l.ownerDocument||l,w=xf(w),(Se=ws.get(Se))&&F0(w,Se),Ge=Ge.createElement("link"),Dn(Ge);var Ot=Ge;Ot._p=new Promise(function(gr,kr){Ot.onload=gr,Ot.onerror=kr}),Wn(Ge,"link",w),m.instance=Ge}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(m,l),(l=m.state.preload)&&(m.state.loading&3)===0&&(a.count++,m=Ac.bind(a),l.addEventListener("load",m),l.addEventListener("error",m))}}var $0=0;function cm(a,l){return a.stylesheets&&a.count===0&&Cc(a,a.stylesheets),0<a.count||0<a.imgCount?function(m){var w=setTimeout(function(){if(a.stylesheets&&Cc(a,a.stylesheets),a.unsuspend){var Ge=a.unsuspend;a.unsuspend=null,Ge()}},6e4+l);0<a.imgBytes&&$0===0&&($0=62500*Hp());var Se=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&Cc(a,a.stylesheets),a.unsuspend)){var Ge=a.unsuspend;a.unsuspend=null,Ge()}},(a.imgBytes>$0?50:800)+l);return a.unsuspend=m,function(){a.unsuspend=null,clearTimeout(w),clearTimeout(Se)}}:null}function Ac(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Cc(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Bc=null;function Cc(a,l){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Bc=new Map,l.forEach(lm,a),Bc=null,Ac.call(a))}function lm(a,l){if(!(l.state.loading&4)){var m=Bc.get(a);if(m)var w=m.get(null);else{m=new Map,Bc.set(a,m);for(var Se=a.querySelectorAll("link[data-precedence],style[data-precedence]"),Ge=0;Ge<Se.length;Ge++){var Ot=Se[Ge];(Ot.nodeName==="LINK"||Ot.getAttribute("media")!=="not all")&&(m.set(Ot.dataset.precedence,Ot),w=Ot)}w&&m.set(null,w)}Se=l.instance,Ot=Se.getAttribute("data-precedence"),Ge=m.get(Ot)||w,Ge===w&&m.set(null,Se),m.set(Ot,Se),this.count++,w=Ac.bind(this),Se.addEventListener("load",w),Se.addEventListener("error",w),Ge?Ge.parentNode.insertBefore(Se,Ge.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(Se,a.firstChild)),l.state.loading|=4}}var ma={$$typeof:O,Provider:null,Consumer:null,_currentValue:Ye,_currentValue2:Ye,_threadCount:0};function um(a,l,m,w,Se,Ge,Ot,gr,kr){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=dr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=dr(0),this.hiddenUpdates=dr(null),this.identifierPrefix=w,this.onUncaughtError=Se,this.onCaughtError=Ge,this.onRecoverableError=Ot,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=kr,this.incompleteTransitions=new Map}function mf(a,l,m,w,Se,Ge,Ot,gr,kr,Ir,Hr,Kr){return a=new um(a,l,m,Ot,kr,Ir,Hr,Kr,gr),l=1,Ge===!0&&(l|=24),Ge=ss(3,null,null,l),a.current=Ge,Ge.stateNode=a,l=hl(),l.refCount++,a.pooledCache=l,l.refCount++,Ge.memoizedState={element:w,isDehydrated:m,cache:l},yl(Ge),a}function gf(a){return a?(a=ro,a):ro}function yf(a,l,m,w,Se,Ge){Se=gf(Se),w.context===null?w.context=Se:w.pendingContext=Se,w=oi(l),w.payload={element:m},Ge=Ge===void 0?null:Ge,Ge!==null&&(w.callback=Ge),m=ai(a,w,l),m!==null&&(rs(m,a,l),Wo(m,a,l))}function Ef(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var m=a.retryLane;a.retryLane=m!==0&&m<l?m:l}}function I0(a,l){Ef(a,l),(a=a.alternate)&&Ef(a,l)}function bf(a){if(a.tag===13||a.tag===31){var l=ki(a,67108864);l!==null&&rs(l,a,67108864),I0(a,67108864)}}function wf(a){if(a.tag===13||a.tag===31){var l=us();l=Or(l);var m=ki(a,l);m!==null&&rs(m,a,l),I0(a,l)}}var Sc=!0;function xm(a,l,m,w){var Se=_e.T;_e.T=null;var Ge=Le.p;try{Le.p=2,P0(a,l,m,w)}finally{Le.p=Ge,_e.T=Se}}function dm(a,l,m,w){var Se=_e.T;_e.T=null;var Ge=Le.p;try{Le.p=8,P0(a,l,m,w)}finally{Le.p=Ge,_e.T=Se}}function P0(a,l,m,w){if(Sc){var Se=M0(w);if(Se===null)A0(a,l,w,_c,m),Af(a,w);else if(hm(Se,a,l,m,w))w.stopPropagation();else if(Af(a,w),l&4&&-1<fm.indexOf(a)){for(;Se!==null;){var Ge=_s(Se);if(Ge!==null)switch(Ge.tag){case 3:if(Ge=Ge.stateNode,Ge.current.memoizedState.isDehydrated){var Ot=nn(Ge.pendingLanes);if(Ot!==0){var gr=Ge;for(gr.pendingLanes|=2,gr.entangledLanes|=2;Ot;){var kr=1<<31-Rr(Ot);gr.entanglements[1]|=kr,Ot&=~kr}Fs(Ge),(yn&6)===0&&(lc=or()+500,ua(0))}}break;case 31:case 13:gr=ki(Ge,2),gr!==null&&rs(gr,Ge,2),xc(),I0(Ge,2)}if(Ge=M0(w),Ge===null&&A0(a,l,w,_c,m),Ge===Se)break;Se=Ge}Se!==null&&w.stopPropagation()}else A0(a,l,w,null,m)}}function M0(a){return a=Oc(a),U0(a)}var _c=null;function U0(a){if(_c=null,a=Ss(a),a!==null){var l=o(a);if(l===null)a=null;else{var m=l.tag;if(m===13){if(a=c(l),a!==null)return a;a=null}else if(m===31){if(a=u(l),a!==null)return a;a=null}else if(m===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null)}}return _c=a,null}function vf(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(tr()){case yr:return 2;case mr:return 8;case sr:case Ar:return 32;case ht:return 268435456;default:return 32}default:return 32}}var O0=!1,yi=null,Ei=null,bi=null,ga=new Map,ya=new Map,wi=[],fm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Af(a,l){switch(a){case"focusin":case"focusout":yi=null;break;case"dragenter":case"dragleave":Ei=null;break;case"mouseover":case"mouseout":bi=null;break;case"pointerover":case"pointerout":ga.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":ya.delete(l.pointerId)}}function Ea(a,l,m,w,Se,Ge){return a===null||a.nativeEvent!==Ge?(a={blockedOn:l,domEventName:m,eventSystemFlags:w,nativeEvent:Ge,targetContainers:[Se]},l!==null&&(l=_s(l),l!==null&&bf(l)),a):(a.eventSystemFlags|=w,l=a.targetContainers,Se!==null&&l.indexOf(Se)===-1&&l.push(Se),a)}function hm(a,l,m,w,Se){switch(l){case"focusin":return yi=Ea(yi,a,l,m,w,Se),!0;case"dragenter":return Ei=Ea(Ei,a,l,m,w,Se),!0;case"mouseover":return bi=Ea(bi,a,l,m,w,Se),!0;case"pointerover":var Ge=Se.pointerId;return ga.set(Ge,Ea(ga.get(Ge)||null,a,l,m,w,Se)),!0;case"gotpointercapture":return Ge=Se.pointerId,ya.set(Ge,Ea(ya.get(Ge)||null,a,l,m,w,Se)),!0}return!1}function Bf(a){var l=Ss(a.target);if(l!==null){var m=o(l);if(m!==null){if(l=m.tag,l===13){if(l=c(m),l!==null){a.blockedOn=l,tn(a.priority,function(){wf(m)});return}}else if(l===31){if(l=u(m),l!==null){a.blockedOn=l,tn(a.priority,function(){wf(m)});return}}else if(l===3&&m.stateNode.current.memoizedState.isDehydrated){a.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Rc(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var m=M0(a.nativeEvent);if(m===null){m=a.nativeEvent;var w=new m.constructor(m.type,m);Uc=w,m.target.dispatchEvent(w),Uc=null}else return l=_s(m),l!==null&&bf(l),a.blockedOn=m,!1;l.shift()}return!0}function Cf(a,l,m){Rc(a)&&m.delete(l)}function pm(){O0=!1,yi!==null&&Rc(yi)&&(yi=null),Ei!==null&&Rc(Ei)&&(Ei=null),bi!==null&&Rc(bi)&&(bi=null),ga.forEach(Cf),ya.forEach(Cf)}function kc(a,l){a.blockedOn===l&&(a.blockedOn=null,O0||(O0=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,pm)))}var jc=null;function Sf(a){jc!==a&&(jc=a,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){jc===a&&(jc=null);for(var l=0;l<a.length;l+=3){var m=a[l],w=a[l+1],Se=a[l+2];if(typeof w!="function"){if(U0(w||m)===null)continue;break}var Ge=_s(m);Ge!==null&&(a.splice(l,3),l-=3,Ml(Ge,{pending:!0,data:Se,method:m.method,action:w},w,Se))}}))}function _o(a){function l(kr){return kc(kr,a)}yi!==null&&kc(yi,a),Ei!==null&&kc(Ei,a),bi!==null&&kc(bi,a),ga.forEach(l),ya.forEach(l);for(var m=0;m<wi.length;m++){var w=wi[m];w.blockedOn===a&&(w.blockedOn=null)}for(;0<wi.length&&(m=wi[0],m.blockedOn===null);)Bf(m),m.blockedOn===null&&wi.shift();if(m=(a.ownerDocument||a).$$reactFormReplay,m!=null)for(w=0;w<m.length;w+=3){var Se=m[w],Ge=m[w+1],Ot=Se[fn]||null;if(typeof Ge=="function")Ot||Sf(m);else if(Ot){var gr=null;if(Ge&&Ge.hasAttribute("formAction")){if(Se=Ge,Ot=Ge[fn]||null)gr=Ot.formAction;else if(U0(Se)!==null)continue}else gr=Ot.action;typeof gr=="function"?m[w+1]=gr:(m.splice(w,3),w-=3),Sf(m)}}}function _f(){function a(Ge){Ge.canIntercept&&Ge.info==="react-transition"&&Ge.intercept({handler:function(){return new Promise(function(Ot){return Se=Ot})},focusReset:"manual",scroll:"manual"})}function l(){Se!==null&&(Se(),Se=null),w||setTimeout(m,20)}function m(){if(!w&&!navigation.transition){var Ge=navigation.currentEntry;Ge&&Ge.url!=null&&navigation.navigate(Ge.url,{state:Ge.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var w=!1,Se=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",l),navigation.addEventListener("navigateerror",l),setTimeout(m,100),function(){w=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",l),navigation.removeEventListener("navigateerror",l),Se!==null&&(Se(),Se=null)}}}function L0(a){this._internalRoot=a}Nc.prototype.render=L0.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(n(409));var m=l.current,w=us();yf(m,w,a,l,null,null)},Nc.prototype.unmount=L0.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;yf(a.current,2,null,a,null,null),xc(),l[_n]=null}};function Nc(a){this._internalRoot=a}Nc.prototype.unstable_scheduleHydration=function(a){if(a){var l=An();a={blockedOn:null,target:a,priority:l};for(var m=0;m<wi.length&&l!==0&&l<wi[m].priority;m++);wi.splice(m,0,a),m===0&&Bf(a)}};var Rf=e.version;if(Rf!=="19.2.3")throw Error(n(527,Rf,"19.2.3"));Le.findDOMNode=function(a){var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(n(188)):(a=Object.keys(a).join(","),Error(n(268,a)));return a=x(l),a=a!==null?p(a):null,a=a===null?null:a.stateNode,a};var mm={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:_e,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Dc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dc.isDisabled&&Dc.supportsFiber)try{ar=Dc.inject(mm),br=Dc}catch{}}return reactDomClient_production.createRoot=function(a,l){if(!s(a))throw Error(n(299));var m=!1,w="",Se=Tx,Ge=$x,Ot=Ix;return l!=null&&(l.unstable_strictMode===!0&&(m=!0),l.identifierPrefix!==void 0&&(w=l.identifierPrefix),l.onUncaughtError!==void 0&&(Se=l.onUncaughtError),l.onCaughtError!==void 0&&(Ge=l.onCaughtError),l.onRecoverableError!==void 0&&(Ot=l.onRecoverableError)),l=mf(a,1,!1,null,null,m,w,null,Se,Ge,Ot,_f),a[_n]=l.current,v0(a),new L0(l)},reactDomClient_production.hydrateRoot=function(a,l,m){if(!s(a))throw Error(n(299));var w=!1,Se="",Ge=Tx,Ot=$x,gr=Ix,kr=null;return m!=null&&(m.unstable_strictMode===!0&&(w=!0),m.identifierPrefix!==void 0&&(Se=m.identifierPrefix),m.onUncaughtError!==void 0&&(Ge=m.onUncaughtError),m.onCaughtError!==void 0&&(Ot=m.onCaughtError),m.onRecoverableError!==void 0&&(gr=m.onRecoverableError),m.formState!==void 0&&(kr=m.formState)),l=mf(a,1,!0,l,m??null,w,Se,kr,Ge,Ot,gr,_f),l.context=gf(null),m=l.current,w=us(),w=Or(w),Se=oi(w),Se.callback=null,ai(m,Se,w),m=w,l.current.lanes=m,yt(l,m),Fs(l),a[_n]=l.current,v0(a),new Nc(l)},reactDomClient_production.version="19.2.3",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient(),reactExports=requireReact();const React=getDefaultExportFromCjs$1(reactExports),createStoreImpl=t=>{let e;const r=new Set,n=(x,p)=>{const g=typeof x=="function"?x(e):x;if(!Object.is(g,e)){const y=e;e=p??(typeof g!="object"||g===null)?g:Object.assign({},e,g),r.forEach(b=>b(e,y))}},s=()=>e,u={setState:n,getState:s,getInitialState:()=>f,subscribe:x=>(r.add(x),()=>r.delete(x))},f=e=t(n,s,u);return u},createStore$1=(t=>t?createStoreImpl(t):createStoreImpl),identity=t=>t;function useStore(t,e=identity){const r=React.useSyncExternalStore(t.subscribe,React.useCallback(()=>e(t.getState()),[t,e]),React.useCallback(()=>e(t.getInitialState()),[t,e]));return React.useDebugValue(r),r}const createImpl=t=>{const e=createStore$1(t),r=n=>useStore(e,n);return Object.assign(r,e),r},create=(t=>t?createImpl(t):createImpl);function createJSONStorage(t,e){let r;try{r=t()}catch{return}return{getItem:s=>{var o;const c=f=>f===null?null:JSON.parse(f,void 0),u=(o=r.getItem(s))!=null?o:null;return u instanceof Promise?u.then(c):c(u)},setItem:(s,o)=>r.setItem(s,JSON.stringify(o,void 0)),removeItem:s=>r.removeItem(s)}}const toThenable=t=>e=>{try{const r=t(e);return r instanceof Promise?r:{then(n){return toThenable(n)(r)},catch(n){return this}}}catch(r){return{then(n){return this},catch(n){return toThenable(n)(r)}}}},persistImpl=(t,e)=>(r,n,s)=>{let o={storage:createJSONStorage(()=>localStorage),partialize:D=>D,version:0,merge:(D,k)=>({...k,...D}),...e},c=!1;const u=new Set,f=new Set;let x=o.storage;if(!x)return t((...D)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...D)},n,s);const p=()=>{const D=o.partialize({...n()});return x.setItem(o.name,{state:D,version:o.version})},g=s.setState;s.setState=(D,k)=>(g(D,k),p());const y=t((...D)=>(r(...D),p()),n,s);s.getInitialState=()=>y;let b;const R=()=>{var D,k;if(!x)return;c=!1,u.forEach(Fe=>{var O;return Fe((O=n())!=null?O:y)});const Re=((k=o.onRehydrateStorage)==null?void 0:k.call(o,(D=n())!=null?D:y))||void 0;return toThenable(x.getItem.bind(x))(o.name).then(Fe=>{if(Fe)if(typeof Fe.version=="number"&&Fe.version!==o.version){if(o.migrate){const O=o.migrate(Fe.state,Fe.version);return O instanceof Promise?O.then($e=>[!0,$e]):[!0,O]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,Fe.state];return[!1,void 0]}).then(Fe=>{var O;const[$e,ze]=Fe;if(b=o.merge(ze,(O=n())!=null?O:y),r(b,!0),$e)return p()}).then(()=>{Re?.(b,void 0),b=n(),c=!0,f.forEach(Fe=>Fe(b))}).catch(Fe=>{Re?.(void 0,Fe)})};return s.persist={setOptions:D=>{o={...o,...D},D.storage&&(x=D.storage)},clearStorage:()=>{x?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>R(),hasHydrated:()=>c,onHydrate:D=>(u.add(D),()=>{u.delete(D)}),onFinishHydration:D=>(f.add(D),()=>{f.delete(D)})},o.skipHydration||R(),b||y},persist=persistImpl,crypto$5=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function isBytes$6(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function anumber$5(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function abytes$2(t,...e){if(!isBytes$6(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function ahash$2(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");anumber$5(t.outputLen),anumber$5(t.blockLen)}function aexists$2(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function aoutput$2(t,e){abytes$2(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function clean$2(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function createView$5(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function rotr$4(t,e){return t<<32-e|t>>>e}function rotl$3(t,e){return t<<e|t>>>32-e>>>0}const hasHexBuiltin$1=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes$4=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$5(t){if(abytes$2(t),hasHexBuiltin$1)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=hexes$4[t[r]];return e}const asciis$2={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16$2(t){if(t>=asciis$2._0&&t<=asciis$2._9)return t-asciis$2._0;if(t>=asciis$2.A&&t<=asciis$2.F)return t-(asciis$2.A-10);if(t>=asciis$2.a&&t<=asciis$2.f)return t-(asciis$2.a-10)}function hexToBytes$7(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(hasHexBuiltin$1)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,o=0;s<r;s++,o+=2){const c=asciiToBase16$2(t.charCodeAt(o)),u=asciiToBase16$2(t.charCodeAt(o+1));if(c===void 0||u===void 0){const f=t[o]+t[o+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+o)}n[s]=c*16+u}return n}function utf8ToBytes$5(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function toBytes$3(t){return typeof t=="string"&&(t=utf8ToBytes$5(t)),abytes$2(t),t}function concatBytes$4(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];abytes$2(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const o=t[n];r.set(o,s),s+=o.length}return r}let Hash$3=class{};function createHasher$2(t){const e=n=>t().update(toBytes$3(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function randomBytes$4(t=32){if(crypto$5&&typeof crypto$5.getRandomValues=="function")return crypto$5.getRandomValues(new Uint8Array(t));if(crypto$5&&typeof crypto$5.randomBytes=="function")return Uint8Array.from(crypto$5.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$3(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),o=BigInt(4294967295),c=Number(r>>s&o),u=Number(r&o),f=n?4:0,x=n?0:4;t.setUint32(e+f,c,n),t.setUint32(e+x,u,n)}function Chi$4(t,e,r){return t&e^~t&r}function Maj$4(t,e,r){return t&e^t&r^e&r}let HashMD$2=class extends Hash$3{constructor(e,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=createView$5(this.buffer)}update(e){aexists$2(this),e=toBytes$3(e),abytes$2(e);const{view:r,buffer:n,blockLen:s}=this,o=e.length;for(let c=0;c<o;){const u=Math.min(s-this.pos,o-c);if(u===s){const f=createView$5(e);for(;s<=o-c;c+=s)this.process(f,c);continue}n.set(e.subarray(c,c+u),this.pos),this.pos+=u,c+=u,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){aexists$2(this),aoutput$2(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:o}=this;let{pos:c}=this;r[c++]=128,clean$2(this.buffer.subarray(c)),this.padOffset>s-c&&(this.process(n,0),c=0);for(let g=c;g<s;g++)r[g]=0;setBigUint64$3(n,s-8,BigInt(this.length*8),o),this.process(n,0);const u=createView$5(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const x=f/4,p=this.get();if(x>p.length)throw new Error("_sha2: outputLen bigger than state");for(let g=0;g<x;g++)u.setUint32(4*g,p[g],o)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:o,destroyed:c,pos:u}=this;return e.destroyed=c,e.finished=o,e.length=s,e.pos=u,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const SHA256_IV$2=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA512_IV$2=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),U32_MASK64$2=BigInt(2**32-1),_32n$2=BigInt(32);function fromBig$2(t,e=!1){return e?{h:Number(t&U32_MASK64$2),l:Number(t>>_32n$2&U32_MASK64$2)}:{h:Number(t>>_32n$2&U32_MASK64$2)|0,l:Number(t&U32_MASK64$2)|0}}function split$2(t,e=!1){const r=t.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let o=0;o<r;o++){const{h:c,l:u}=fromBig$2(t[o],e);[n[o],s[o]]=[c,u]}return[n,s]}const shrSH$2=(t,e,r)=>t>>>r,shrSL$2=(t,e,r)=>t<<32-r|e>>>r,rotrSH$2=(t,e,r)=>t>>>r|e<<32-r,rotrSL$2=(t,e,r)=>t<<32-r|e>>>r,rotrBH$2=(t,e,r)=>t<<64-r|e>>>r-32,rotrBL$2=(t,e,r)=>t>>>r-32|e<<64-r;function add$2(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const add3L$2=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),add3H$2=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,add4L$2=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),add4H$2=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,add5L$2=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),add5H$2=(t,e,r,n,s,o)=>e+r+n+s+o+(t/2**32|0)|0,SHA256_K$4=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W$4=new Uint32Array(64);let SHA256$2=class extends HashMD$2{constructor(e=32){super(64,e,8,!1),this.A=SHA256_IV$2[0]|0,this.B=SHA256_IV$2[1]|0,this.C=SHA256_IV$2[2]|0,this.D=SHA256_IV$2[3]|0,this.E=SHA256_IV$2[4]|0,this.F=SHA256_IV$2[5]|0,this.G=SHA256_IV$2[6]|0,this.H=SHA256_IV$2[7]|0}get(){const{A:e,B:r,C:n,D:s,E:o,F:c,G:u,H:f}=this;return[e,r,n,s,o,c,u,f]}set(e,r,n,s,o,c,u,f){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=o|0,this.F=c|0,this.G=u|0,this.H=f|0}process(e,r){for(let g=0;g<16;g++,r+=4)SHA256_W$4[g]=e.getUint32(r,!1);for(let g=16;g<64;g++){const y=SHA256_W$4[g-15],b=SHA256_W$4[g-2],R=rotr$4(y,7)^rotr$4(y,18)^y>>>3,D=rotr$4(b,17)^rotr$4(b,19)^b>>>10;SHA256_W$4[g]=D+SHA256_W$4[g-7]+R+SHA256_W$4[g-16]|0}let{A:n,B:s,C:o,D:c,E:u,F:f,G:x,H:p}=this;for(let g=0;g<64;g++){const y=rotr$4(u,6)^rotr$4(u,11)^rotr$4(u,25),b=p+y+Chi$4(u,f,x)+SHA256_K$4[g]+SHA256_W$4[g]|0,D=(rotr$4(n,2)^rotr$4(n,13)^rotr$4(n,22))+Maj$4(n,s,o)|0;p=x,x=f,f=u,u=c+b|0,c=o,o=s,s=n,n=b+D|0}n=n+this.A|0,s=s+this.B|0,o=o+this.C|0,c=c+this.D|0,u=u+this.E|0,f=f+this.F|0,x=x+this.G|0,p=p+this.H|0,this.set(n,s,o,c,u,f,x,p)}roundClean(){clean$2(SHA256_W$4)}destroy(){this.set(0,0,0,0,0,0,0,0),clean$2(this.buffer)}};const K512$2=split$2(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),SHA512_Kh$2=K512$2[0],SHA512_Kl$2=K512$2[1],SHA512_W_H$2=new Uint32Array(80),SHA512_W_L$2=new Uint32Array(80);class SHA512 extends HashMD$2{constructor(e=64){super(128,e,16,!1),this.Ah=SHA512_IV$2[0]|0,this.Al=SHA512_IV$2[1]|0,this.Bh=SHA512_IV$2[2]|0,this.Bl=SHA512_IV$2[3]|0,this.Ch=SHA512_IV$2[4]|0,this.Cl=SHA512_IV$2[5]|0,this.Dh=SHA512_IV$2[6]|0,this.Dl=SHA512_IV$2[7]|0,this.Eh=SHA512_IV$2[8]|0,this.El=SHA512_IV$2[9]|0,this.Fh=SHA512_IV$2[10]|0,this.Fl=SHA512_IV$2[11]|0,this.Gh=SHA512_IV$2[12]|0,this.Gl=SHA512_IV$2[13]|0,this.Hh=SHA512_IV$2[14]|0,this.Hl=SHA512_IV$2[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:o,Cl:c,Dh:u,Dl:f,Eh:x,El:p,Fh:g,Fl:y,Gh:b,Gl:R,Hh:D,Hl:k}=this;return[e,r,n,s,o,c,u,f,x,p,g,y,b,R,D,k]}set(e,r,n,s,o,c,u,f,x,p,g,y,b,R,D,k){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=o|0,this.Cl=c|0,this.Dh=u|0,this.Dl=f|0,this.Eh=x|0,this.El=p|0,this.Fh=g|0,this.Fl=y|0,this.Gh=b|0,this.Gl=R|0,this.Hh=D|0,this.Hl=k|0}process(e,r){for(let O=0;O<16;O++,r+=4)SHA512_W_H$2[O]=e.getUint32(r),SHA512_W_L$2[O]=e.getUint32(r+=4);for(let O=16;O<80;O++){const $e=SHA512_W_H$2[O-15]|0,ze=SHA512_W_L$2[O-15]|0,q=rotrSH$2($e,ze,1)^rotrSH$2($e,ze,8)^shrSH$2($e,ze,7),W=rotrSL$2($e,ze,1)^rotrSL$2($e,ze,8)^shrSL$2($e,ze,7),We=SHA512_W_H$2[O-2]|0,Xe=SHA512_W_L$2[O-2]|0,it=rotrSH$2(We,Xe,19)^rotrBH$2(We,Xe,61)^shrSH$2(We,Xe,6),Ve=rotrSL$2(We,Xe,19)^rotrBL$2(We,Xe,61)^shrSL$2(We,Xe,6),v=add4L$2(W,Ve,SHA512_W_L$2[O-7],SHA512_W_L$2[O-16]),I=add4H$2(v,q,it,SHA512_W_H$2[O-7],SHA512_W_H$2[O-16]);SHA512_W_H$2[O]=I|0,SHA512_W_L$2[O]=v|0}let{Ah:n,Al:s,Bh:o,Bl:c,Ch:u,Cl:f,Dh:x,Dl:p,Eh:g,El:y,Fh:b,Fl:R,Gh:D,Gl:k,Hh:Re,Hl:Fe}=this;for(let O=0;O<80;O++){const $e=rotrSH$2(g,y,14)^rotrSH$2(g,y,18)^rotrBH$2(g,y,41),ze=rotrSL$2(g,y,14)^rotrSL$2(g,y,18)^rotrBL$2(g,y,41),q=g&b^~g&D,W=y&R^~y&k,We=add5L$2(Fe,ze,W,SHA512_Kl$2[O],SHA512_W_L$2[O]),Xe=add5H$2(We,Re,$e,q,SHA512_Kh$2[O],SHA512_W_H$2[O]),it=We|0,Ve=rotrSH$2(n,s,28)^rotrBH$2(n,s,34)^rotrBH$2(n,s,39),v=rotrSL$2(n,s,28)^rotrBL$2(n,s,34)^rotrBL$2(n,s,39),I=n&o^n&u^o&u,Ce=s&c^s&f^c&f;Re=D|0,Fe=k|0,D=b|0,k=R|0,b=g|0,R=y|0,{h:g,l:y}=add$2(x|0,p|0,Xe|0,it|0),x=u|0,p=f|0,u=o|0,f=c|0,o=n|0,c=s|0;const P=add3L$2(it,v,Ce);n=add3H$2(P,Xe,Ve,I),s=P|0}({h:n,l:s}=add$2(this.Ah|0,this.Al|0,n|0,s|0)),{h:o,l:c}=add$2(this.Bh|0,this.Bl|0,o|0,c|0),{h:u,l:f}=add$2(this.Ch|0,this.Cl|0,u|0,f|0),{h:x,l:p}=add$2(this.Dh|0,this.Dl|0,x|0,p|0),{h:g,l:y}=add$2(this.Eh|0,this.El|0,g|0,y|0),{h:b,l:R}=add$2(this.Fh|0,this.Fl|0,b|0,R|0),{h:D,l:k}=add$2(this.Gh|0,this.Gl|0,D|0,k|0),{h:Re,l:Fe}=add$2(this.Hh|0,this.Hl|0,Re|0,Fe|0),this.set(n,s,o,c,u,f,x,p,g,y,b,R,D,k,Re,Fe)}roundClean(){clean$2(SHA512_W_H$2,SHA512_W_L$2)}destroy(){clean$2(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const sha256$6=createHasher$2(()=>new SHA256$2),sha512$3=createHasher$2(()=>new SHA512);let HMAC$2=class extends Hash$3{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,ahash$2(e);const n=toBytes$3(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(n.length>s?e.create().update(n).digest():n);for(let c=0;c<o.length;c++)o[c]^=54;this.iHash.update(o),this.oHash=e.create();for(let c=0;c<o.length;c++)o[c]^=106;this.oHash.update(o),clean$2(o)}update(e){return aexists$2(this),this.iHash.update(e),this}digestInto(e){aexists$2(this),abytes$2(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:s,destroyed:o,blockLen:c,outputLen:u}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=c,e.outputLen=u,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$5=(t,e,r)=>new HMAC$2(t,e).update(r).digest();hmac$5.create=(t,e)=>new HMAC$2(t,e);const _0n$d=BigInt(0),_1n$d=BigInt(1);function _abool2(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function _abytes2(t,e,r=""){const n=isBytes$6(t),s=t?.length,o=e!==void 0;if(!n||o&&s!==e){const c=r&&`"${r}" `,u=o?` of length ${e}`:"",f=n?`length=${s}`:`type=${typeof t}`;throw new Error(c+"expected Uint8Array"+u+", got "+f)}return t}function numberToHexUnpadded$2(t){const e=t.toString(16);return e.length&1?"0"+e:e}function hexToNumber$2(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?_0n$d:BigInt("0x"+t)}function bytesToNumberBE$2(t){return hexToNumber$2(bytesToHex$5(t))}function bytesToNumberLE$2(t){return abytes$2(t),hexToNumber$2(bytesToHex$5(Uint8Array.from(t).reverse()))}function numberToBytesBE$2(t,e){return hexToBytes$7(t.toString(16).padStart(e*2,"0"))}function numberToBytesLE$2(t,e){return numberToBytesBE$2(t,e).reverse()}function ensureBytes$1(t,e,r){let n;if(typeof e=="string")try{n=hexToBytes$7(e)}catch(o){throw new Error(t+" must be hex string or Uint8Array, cause: "+o)}else if(isBytes$6(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}const isPosBig$1=t=>typeof t=="bigint"&&_0n$d<=t;function inRange$1(t,e,r){return isPosBig$1(t)&&isPosBig$1(e)&&isPosBig$1(r)&&e<=t&&t<r}function aInRange$1(t,e,r,n){if(!inRange$1(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function bitLen$2(t){let e;for(e=0;t>_0n$d;t>>=_1n$d,e+=1);return e}const bitMask$2=t=>(_1n$d<<BigInt(t))-_1n$d;function createHmacDrbg$2(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=b=>new Uint8Array(b),s=b=>Uint8Array.of(b);let o=n(t),c=n(t),u=0;const f=()=>{o.fill(1),c.fill(0),u=0},x=(...b)=>r(c,o,...b),p=(b=n(0))=>{c=x(s(0),b),o=x(),b.length!==0&&(c=x(s(1),b),o=x())},g=()=>{if(u++>=1e3)throw new Error("drbg: tried 1000 values");let b=0;const R=[];for(;b<e;){o=x();const D=o.slice();R.push(D),b+=o.length}return concatBytes$4(...R)};return(b,R)=>{f(),p(b);let D;for(;!(D=R(g()));)p();return f(),D}}function _validateObject(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(s,o,c){const u=t[s];if(c&&u===void 0)return;const f=typeof u;if(f!==o||u===null)throw new Error(`param "${s}" is invalid: expected ${o}, got ${f}`)}Object.entries(e).forEach(([s,o])=>n(s,o,!1)),Object.entries(r).forEach(([s,o])=>n(s,o,!0))}function memoized$1(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const o=t(r,...n);return e.set(r,o),o}}const _0n$c=BigInt(0),_1n$c=BigInt(1),_2n$8=BigInt(2),_3n$5=BigInt(3),_4n$4=BigInt(4),_5n$2=BigInt(5),_7n$1=BigInt(7),_8n$2=BigInt(8),_9n$1=BigInt(9),_16n$1=BigInt(16);function mod$2(t,e){const r=t%e;return r>=_0n$c?r:e+r}function pow2$2(t,e,r){let n=t;for(;e-- >_0n$c;)n*=n,n%=r;return n}function invert$2(t,e){if(t===_0n$c)throw new Error("invert: expected non-zero number");if(e<=_0n$c)throw new Error("invert: expected positive modulus, got "+e);let r=mod$2(t,e),n=e,s=_0n$c,o=_1n$c;for(;r!==_0n$c;){const u=n/r,f=n%r,x=s-o*u;n=r,r=f,s=o,o=x}if(n!==_1n$c)throw new Error("invert: does not exist");return mod$2(s,e)}function assertIsSquare$1(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function sqrt3mod4$1(t,e){const r=(t.ORDER+_1n$c)/_4n$4,n=t.pow(e,r);return assertIsSquare$1(t,n,e),n}function sqrt5mod8$1(t,e){const r=(t.ORDER-_5n$2)/_8n$2,n=t.mul(e,_2n$8),s=t.pow(n,r),o=t.mul(e,s),c=t.mul(t.mul(o,_2n$8),s),u=t.mul(o,t.sub(c,t.ONE));return assertIsSquare$1(t,u,e),u}function sqrt9mod16$1(t){const e=Field$2(t),r=tonelliShanks$2(t),n=r(e,e.neg(e.ONE)),s=r(e,n),o=r(e,e.neg(n)),c=(t+_7n$1)/_16n$1;return(u,f)=>{let x=u.pow(f,c),p=u.mul(x,n);const g=u.mul(x,s),y=u.mul(x,o),b=u.eql(u.sqr(p),f),R=u.eql(u.sqr(g),f);x=u.cmov(x,p,b),p=u.cmov(y,g,R);const D=u.eql(u.sqr(p),f),k=u.cmov(x,p,D);return assertIsSquare$1(u,k,f),k}}function tonelliShanks$2(t){if(t<_3n$5)throw new Error("sqrt is not defined for small field");let e=t-_1n$c,r=0;for(;e%_2n$8===_0n$c;)e/=_2n$8,r++;let n=_2n$8;const s=Field$2(t);for(;FpLegendre$1(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return sqrt3mod4$1;let o=s.pow(n,e);const c=(e+_1n$c)/_2n$8;return function(f,x){if(f.is0(x))return x;if(FpLegendre$1(f,x)!==1)throw new Error("Cannot find square root");let p=r,g=f.mul(f.ONE,o),y=f.pow(x,e),b=f.pow(x,c);for(;!f.eql(y,f.ONE);){if(f.is0(y))return f.ZERO;let R=1,D=f.sqr(y);for(;!f.eql(D,f.ONE);)if(R++,D=f.sqr(D),R===p)throw new Error("Cannot find square root");const k=_1n$c<<BigInt(p-R-1),Re=f.pow(g,k);p=R,g=f.sqr(Re),y=f.mul(y,g),b=f.mul(b,Re)}return b}}function FpSqrt$2(t){return t%_4n$4===_3n$5?sqrt3mod4$1:t%_8n$2===_5n$2?sqrt5mod8$1:t%_16n$1===_9n$1?sqrt9mod16$1(t):tonelliShanks$2(t)}const FIELD_FIELDS$2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$2(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=FIELD_FIELDS$2.reduce((n,s)=>(n[s]="function",n),e);return _validateObject(t,r),t}function FpPow$2(t,e,r){if(r<_0n$c)throw new Error("invalid exponent, negatives unsupported");if(r===_0n$c)return t.ONE;if(r===_1n$c)return e;let n=t.ONE,s=e;for(;r>_0n$c;)r&_1n$c&&(n=t.mul(n,s)),s=t.sqr(s),r>>=_1n$c;return n}function FpInvertBatch$2(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((c,u,f)=>t.is0(u)?c:(n[f]=c,t.mul(c,u)),t.ONE),o=t.inv(s);return e.reduceRight((c,u,f)=>t.is0(u)?c:(n[f]=t.mul(c,n[f]),t.mul(c,u)),o),n}function FpLegendre$1(t,e){const r=(t.ORDER-_1n$c)/_2n$8,n=t.pow(e,r),s=t.eql(n,t.ONE),o=t.eql(n,t.ZERO),c=t.eql(n,t.neg(t.ONE));if(!s&&!o&&!c)throw new Error("invalid Legendre symbol result");return s?1:o?0:-1}function nLength$2(t,e){e!==void 0&&anumber$5(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Field$2(t,e,r=!1,n={}){if(t<=_0n$c)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,o,c=!1,u;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const y=e;y.BITS&&(s=y.BITS),y.sqrt&&(o=y.sqrt),typeof y.isLE=="boolean"&&(r=y.isLE),typeof y.modFromBytes=="boolean"&&(c=y.modFromBytes),u=y.allowedLengths}else typeof e=="number"&&(s=e),n.sqrt&&(o=n.sqrt);const{nBitLength:f,nByteLength:x}=nLength$2(t,s);if(x>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let p;const g=Object.freeze({ORDER:t,isLE:r,BITS:f,BYTES:x,MASK:bitMask$2(f),ZERO:_0n$c,ONE:_1n$c,allowedLengths:u,create:y=>mod$2(y,t),isValid:y=>{if(typeof y!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof y);return _0n$c<=y&&y<t},is0:y=>y===_0n$c,isValidNot0:y=>!g.is0(y)&&g.isValid(y),isOdd:y=>(y&_1n$c)===_1n$c,neg:y=>mod$2(-y,t),eql:(y,b)=>y===b,sqr:y=>mod$2(y*y,t),add:(y,b)=>mod$2(y+b,t),sub:(y,b)=>mod$2(y-b,t),mul:(y,b)=>mod$2(y*b,t),pow:(y,b)=>FpPow$2(g,y,b),div:(y,b)=>mod$2(y*invert$2(b,t),t),sqrN:y=>y*y,addN:(y,b)=>y+b,subN:(y,b)=>y-b,mulN:(y,b)=>y*b,inv:y=>invert$2(y,t),sqrt:o||(y=>(p||(p=FpSqrt$2(t)),p(g,y))),toBytes:y=>r?numberToBytesLE$2(y,x):numberToBytesBE$2(y,x),fromBytes:(y,b=!0)=>{if(u){if(!u.includes(y.length)||y.length>x)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+y.length);const D=new Uint8Array(x);D.set(y,r?0:D.length-y.length),y=D}if(y.length!==x)throw new Error("Field.fromBytes: expected "+x+" bytes, got "+y.length);let R=r?bytesToNumberLE$2(y):bytesToNumberBE$2(y);if(c&&(R=mod$2(R,t)),!b&&!g.isValid(R))throw new Error("invalid field element: outside of range 0..ORDER");return R},invertBatch:y=>FpInvertBatch$2(g,y),cmov:(y,b,R)=>R?b:y});return Object.freeze(g)}function getFieldBytesLength$2(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function getMinHashLength$2(t){const e=getFieldBytesLength$2(t);return e+Math.ceil(e/2)}function mapHashToField$2(t,e,r=!1){const n=t.length,s=getFieldBytesLength$2(e),o=getMinHashLength$2(e);if(n<16||n<o||n>1024)throw new Error("expected "+o+"-1024 bytes of input, got "+n);const c=r?bytesToNumberLE$2(t):bytesToNumberBE$2(t),u=mod$2(c,e-_1n$c)+_1n$c;return r?numberToBytesLE$2(u,s):numberToBytesBE$2(u,s)}const _0n$b=BigInt(0),_1n$b=BigInt(1);function negateCt$1(t,e){const r=e.negate();return t?r:e}function normalizeZ$1(t,e){const r=FpInvertBatch$2(t.Fp,e.map(n=>n.Z));return e.map((n,s)=>t.fromAffine(n.toAffine(r[s])))}function validateW$1(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function calcWOpts$1(t,e){validateW$1(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,o=bitMask$2(t),c=BigInt(t);return{windows:r,windowSize:n,mask:o,maxNumber:s,shiftBy:c}}function calcOffsets$1(t,e,r){const{windowSize:n,mask:s,maxNumber:o,shiftBy:c}=r;let u=Number(t&s),f=t>>c;u>n&&(u-=o,f+=_1n$b);const x=e*n,p=x+Math.abs(u)-1,g=u===0,y=u<0,b=e%2!==0;return{nextN:f,offset:p,isZero:g,isNeg:y,isNegF:b,offsetF:x}}function validateMSMPoints(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function validateMSMScalars(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const pointPrecomputes$1=new WeakMap,pointWindowSizes$1=new WeakMap;function getW$1(t){return pointWindowSizes$1.get(t)||1}function assert0$1(t){if(t!==_0n$b)throw new Error("invalid wNAF")}let wNAF$2=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let s=e;for(;r>_0n$b;)r&_1n$b&&(n=n.add(s)),s=s.double(),r>>=_1n$b;return n}precomputeWindow(e,r){const{windows:n,windowSize:s}=calcWOpts$1(r,this.bits),o=[];let c=e,u=c;for(let f=0;f<n;f++){u=c,o.push(u);for(let x=1;x<s;x++)u=u.add(c),o.push(u);c=u.double()}return o}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,o=this.BASE;const c=calcWOpts$1(e,this.bits);for(let u=0;u<c.windows;u++){const{nextN:f,offset:x,isZero:p,isNeg:g,isNegF:y,offsetF:b}=calcOffsets$1(n,u,c);n=f,p?o=o.add(negateCt$1(y,r[b])):s=s.add(negateCt$1(g,r[x]))}return assert0$1(n),{p:s,f:o}}wNAFUnsafe(e,r,n,s=this.ZERO){const o=calcWOpts$1(e,this.bits);for(let c=0;c<o.windows&&n!==_0n$b;c++){const{nextN:u,offset:f,isZero:x,isNeg:p}=calcOffsets$1(n,c,o);if(n=u,!x){const g=r[f];s=s.add(p?g.negate():g)}}return assert0$1(n),s}getPrecomputes(e,r,n){let s=pointPrecomputes$1.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(s=n(s)),pointPrecomputes$1.set(r,s))),s}cached(e,r,n){const s=getW$1(e);return this.wNAF(s,this.getPrecomputes(s,e,n),r)}unsafe(e,r,n,s){const o=getW$1(e);return o===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,e,n),r,s)}createCache(e,r){validateW$1(r,this.bits),pointWindowSizes$1.set(e,r),pointPrecomputes$1.delete(e)}hasCache(e){return getW$1(e)!==1}};function mulEndoUnsafe$1(t,e,r,n){let s=e,o=t.ZERO,c=t.ZERO;for(;r>_0n$b||n>_0n$b;)r&_1n$b&&(o=o.add(s)),n&_1n$b&&(c=c.add(s)),s=s.double(),r>>=_1n$b,n>>=_1n$b;return{p1:o,p2:c}}function pippenger(t,e,r,n){validateMSMPoints(r,t),validateMSMScalars(n,e);const s=r.length,o=n.length;if(s!==o)throw new Error("arrays of points and scalars must have equal length");const c=t.ZERO,u=bitLen$2(BigInt(s));let f=1;u>12?f=u-3:u>4?f=u-2:u>0&&(f=2);const x=bitMask$2(f),p=new Array(Number(x)+1).fill(c),g=Math.floor((e.BITS-1)/f)*f;let y=c;for(let b=g;b>=0;b-=f){p.fill(c);for(let D=0;D<o;D++){const k=n[D],Re=Number(k>>BigInt(b)&x);p[Re]=p[Re].add(r[D])}let R=c;for(let D=p.length-1,k=c;D>0;D--)k=k.add(p[D]),R=R.add(k);if(y=y.add(R),b!==0)for(let D=0;D<f;D++)y=y.double()}return y}function createField$1(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return validateField$2(e),e}else return Field$2(t,{isLE:r})}function _createCurveFields(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const f of["p","n","h"]){const x=e[f];if(!(typeof x=="bigint"&&x>_0n$b))throw new Error(`CURVE.${f} must be positive bigint`)}const s=createField$1(e.p,r.Fp,n),o=createField$1(e.n,r.Fn,n),u=["Gx","Gy","a","b"];for(const f of u)if(!s.isValid(e[f]))throw new Error(`CURVE.${f} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:o}}const divNearest$2=(t,e)=>(t+(t>=0?e:-e)/_2n$7)/e;function _splitEndoScalar$1(t,e,r){const[[n,s],[o,c]]=e,u=divNearest$2(c*t,r),f=divNearest$2(-s*t,r);let x=t-u*n-f*o,p=-u*s-f*c;const g=x<_0n$a,y=p<_0n$a;g&&(x=-x),y&&(p=-p);const b=bitMask$2(Math.ceil(bitLen$2(r)/2))+_1n$a;if(x<_0n$a||x>=b||p<_0n$a||p>=b)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:g,k1:x,k2neg:y,k2:p}}function validateSigFormat$1(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function validateSigOpts$1(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return _abool2(r.lowS,"lowS"),_abool2(r.prehash,"prehash"),r.format!==void 0&&validateSigFormat$1(r.format),r}let DERErr$1=class extends Error{constructor(e=""){super(e)}};const DER$2={Err:DERErr$1,_tlv:{encode:(t,e)=>{const{Err:r}=DER$2;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,s=numberToHexUnpadded$2(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const o=n>127?numberToHexUnpadded$2(s.length/2|128):"";return numberToHexUnpadded$2(t)+o+s+e},decode(t,e){const{Err:r}=DER$2;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[n++],o=!!(s&128);let c=0;if(!o)c=s;else{const f=s&127;if(!f)throw new r("tlv.decode(long): indefinite length not supported");if(f>4)throw new r("tlv.decode(long): byte length is too big");const x=e.subarray(n,n+f);if(x.length!==f)throw new r("tlv.decode: length bytes not complete");if(x[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const p of x)c=c<<8|p;if(n+=f,c<128)throw new r("tlv.decode(long): not minimal encoding")}const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: wrong value length");return{v:u,l:e.subarray(n+c)}}},_int:{encode(t){const{Err:e}=DER$2;if(t<_0n$a)throw new e("integer: negative integers are not allowed");let r=numberToHexUnpadded$2(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=DER$2;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return bytesToNumberBE$2(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=DER$2,s=ensureBytes$1("signature",t),{v:o,l:c}=n.decode(48,s);if(c.length)throw new e("invalid signature: left bytes after parsing");const{v:u,l:f}=n.decode(2,o),{v:x,l:p}=n.decode(2,f);if(p.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(u),s:r.decode(x)}},hexFromSig(t){const{_tlv:e,_int:r}=DER$2,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),o=n+s;return e.encode(48,o)}},_0n$a=BigInt(0),_1n$a=BigInt(1),_2n$7=BigInt(2),_3n$4=BigInt(3),_4n$3=BigInt(4);function _normFnElement(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let s=ensureBytes$1("private key",e);try{n=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function weierstrassN(t,e={}){const r=_createCurveFields("weierstrass",t,e),{Fp:n,Fn:s}=r;let o=r.CURVE;const{h:c,n:u}=o;_validateObject(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:f}=e;if(f&&(!n.is0(o.a)||typeof f.beta!="bigint"||!Array.isArray(f.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const x=getWLengths$1(n,s);function p(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function g(v,I,Ce){const{x:P,y:_e}=I.toAffine(),Le=n.toBytes(P);if(_abool2(Ce,"isCompressed"),Ce){p();const Ye=!n.isOdd(_e);return concatBytes$4(pprefix$1(Ye),Le)}else return concatBytes$4(Uint8Array.of(4),Le,n.toBytes(_e))}function y(v){_abytes2(v,void 0,"Point");const{publicKey:I,publicKeyUncompressed:Ce}=x,P=v.length,_e=v[0],Le=v.subarray(1);if(P===I&&(_e===2||_e===3)){const Ye=n.fromBytes(Le);if(!n.isValid(Ye))throw new Error("bad point: is not on curve, wrong x");const je=D(Ye);let K;try{K=n.sqrt(je)}catch(dt){const Je=dt instanceof Error?": "+dt.message:"";throw new Error("bad point: is not on curve, sqrt error"+Je)}p();const L=n.isOdd(K);return(_e&1)===1!==L&&(K=n.neg(K)),{x:Ye,y:K}}else if(P===Ce&&_e===4){const Ye=n.BYTES,je=n.fromBytes(Le.subarray(0,Ye)),K=n.fromBytes(Le.subarray(Ye,Ye*2));if(!k(je,K))throw new Error("bad point: is not on curve");return{x:je,y:K}}else throw new Error(`bad point: got length ${P}, expected compressed=${I} or uncompressed=${Ce}`)}const b=e.toBytes||g,R=e.fromBytes||y;function D(v){const I=n.sqr(v),Ce=n.mul(I,v);return n.add(n.add(Ce,n.mul(v,o.a)),o.b)}function k(v,I){const Ce=n.sqr(I),P=D(v);return n.eql(Ce,P)}if(!k(o.Gx,o.Gy))throw new Error("bad curve params: generator point");const Re=n.mul(n.pow(o.a,_3n$4),_4n$3),Fe=n.mul(n.sqr(o.b),BigInt(27));if(n.is0(n.add(Re,Fe)))throw new Error("bad curve params: a or b");function O(v,I,Ce=!1){if(!n.isValid(I)||Ce&&n.is0(I))throw new Error(`bad point coordinate ${v}`);return I}function $e(v){if(!(v instanceof Xe))throw new Error("ProjectivePoint expected")}function ze(v){if(!f||!f.basises)throw new Error("no endo");return _splitEndoScalar$1(v,f.basises,s.ORDER)}const q=memoized$1((v,I)=>{const{X:Ce,Y:P,Z:_e}=v;if(n.eql(_e,n.ONE))return{x:Ce,y:P};const Le=v.is0();I==null&&(I=Le?n.ONE:n.inv(_e));const Ye=n.mul(Ce,I),je=n.mul(P,I),K=n.mul(_e,I);if(Le)return{x:n.ZERO,y:n.ZERO};if(!n.eql(K,n.ONE))throw new Error("invZ was invalid");return{x:Ye,y:je}}),W=memoized$1(v=>{if(v.is0()){if(e.allowInfinityPoint&&!n.is0(v.Y))return;throw new Error("bad point: ZERO")}const{x:I,y:Ce}=v.toAffine();if(!n.isValid(I)||!n.isValid(Ce))throw new Error("bad point: x or y not field elements");if(!k(I,Ce))throw new Error("bad point: equation left != right");if(!v.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function We(v,I,Ce,P,_e){return Ce=new Xe(n.mul(Ce.X,v),Ce.Y,Ce.Z),I=negateCt$1(P,I),Ce=negateCt$1(_e,Ce),I.add(Ce)}class Xe{constructor(I,Ce,P){this.X=O("x",I),this.Y=O("y",Ce,!0),this.Z=O("z",P),Object.freeze(this)}static CURVE(){return o}static fromAffine(I){const{x:Ce,y:P}=I||{};if(!I||!n.isValid(Ce)||!n.isValid(P))throw new Error("invalid affine point");if(I instanceof Xe)throw new Error("projective point not allowed");return n.is0(Ce)&&n.is0(P)?Xe.ZERO:new Xe(Ce,P,n.ONE)}static fromBytes(I){const Ce=Xe.fromAffine(R(_abytes2(I,void 0,"point")));return Ce.assertValidity(),Ce}static fromHex(I){return Xe.fromBytes(ensureBytes$1("pointHex",I))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(I=8,Ce=!0){return Ve.createCache(this,I),Ce||this.multiply(_3n$4),this}assertValidity(){W(this)}hasEvenY(){const{y:I}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(I)}equals(I){$e(I);const{X:Ce,Y:P,Z:_e}=this,{X:Le,Y:Ye,Z:je}=I,K=n.eql(n.mul(Ce,je),n.mul(Le,_e)),L=n.eql(n.mul(P,je),n.mul(Ye,_e));return K&&L}negate(){return new Xe(this.X,n.neg(this.Y),this.Z)}double(){const{a:I,b:Ce}=o,P=n.mul(Ce,_3n$4),{X:_e,Y:Le,Z:Ye}=this;let je=n.ZERO,K=n.ZERO,L=n.ZERO,st=n.mul(_e,_e),dt=n.mul(Le,Le),Je=n.mul(Ye,Ye),pt=n.mul(_e,Le);return pt=n.add(pt,pt),L=n.mul(_e,Ye),L=n.add(L,L),je=n.mul(I,L),K=n.mul(P,Je),K=n.add(je,K),je=n.sub(dt,K),K=n.add(dt,K),K=n.mul(je,K),je=n.mul(pt,je),L=n.mul(P,L),Je=n.mul(I,Je),pt=n.sub(st,Je),pt=n.mul(I,pt),pt=n.add(pt,L),L=n.add(st,st),st=n.add(L,st),st=n.add(st,Je),st=n.mul(st,pt),K=n.add(K,st),Je=n.mul(Le,Ye),Je=n.add(Je,Je),st=n.mul(Je,pt),je=n.sub(je,st),L=n.mul(Je,dt),L=n.add(L,L),L=n.add(L,L),new Xe(je,K,L)}add(I){$e(I);const{X:Ce,Y:P,Z:_e}=this,{X:Le,Y:Ye,Z:je}=I;let K=n.ZERO,L=n.ZERO,st=n.ZERO;const dt=o.a,Je=n.mul(o.b,_3n$4);let pt=n.mul(Ce,Le),rr=n.mul(P,Ye),cr=n.mul(_e,je),fr=n.add(Ce,P),ir=n.add(Le,Ye);fr=n.mul(fr,ir),ir=n.add(pt,rr),fr=n.sub(fr,ir),ir=n.add(Ce,_e);let ft=n.add(Le,je);return ir=n.mul(ir,ft),ft=n.add(pt,cr),ir=n.sub(ir,ft),ft=n.add(P,_e),K=n.add(Ye,je),ft=n.mul(ft,K),K=n.add(rr,cr),ft=n.sub(ft,K),st=n.mul(dt,ir),K=n.mul(Je,cr),st=n.add(K,st),K=n.sub(rr,st),st=n.add(rr,st),L=n.mul(K,st),rr=n.add(pt,pt),rr=n.add(rr,pt),cr=n.mul(dt,cr),ir=n.mul(Je,ir),rr=n.add(rr,cr),cr=n.sub(pt,cr),cr=n.mul(dt,cr),ir=n.add(ir,cr),pt=n.mul(rr,ir),L=n.add(L,pt),pt=n.mul(ft,ir),K=n.mul(fr,K),K=n.sub(K,pt),pt=n.mul(fr,rr),st=n.mul(ft,st),st=n.add(st,pt),new Xe(K,L,st)}subtract(I){return this.add(I.negate())}is0(){return this.equals(Xe.ZERO)}multiply(I){const{endo:Ce}=e;if(!s.isValidNot0(I))throw new Error("invalid scalar: out of range");let P,_e;const Le=Ye=>Ve.cached(this,Ye,je=>normalizeZ$1(Xe,je));if(Ce){const{k1neg:Ye,k1:je,k2neg:K,k2:L}=ze(I),{p:st,f:dt}=Le(je),{p:Je,f:pt}=Le(L);_e=dt.add(pt),P=We(Ce.beta,st,Je,Ye,K)}else{const{p:Ye,f:je}=Le(I);P=Ye,_e=je}return normalizeZ$1(Xe,[P,_e])[0]}multiplyUnsafe(I){const{endo:Ce}=e,P=this;if(!s.isValid(I))throw new Error("invalid scalar: out of range");if(I===_0n$a||P.is0())return Xe.ZERO;if(I===_1n$a)return P;if(Ve.hasCache(this))return this.multiply(I);if(Ce){const{k1neg:_e,k1:Le,k2neg:Ye,k2:je}=ze(I),{p1:K,p2:L}=mulEndoUnsafe$1(Xe,P,Le,je);return We(Ce.beta,K,L,_e,Ye)}else return Ve.unsafe(P,I)}multiplyAndAddUnsafe(I,Ce,P){const _e=this.multiplyUnsafe(Ce).add(I.multiplyUnsafe(P));return _e.is0()?void 0:_e}toAffine(I){return q(this,I)}isTorsionFree(){const{isTorsionFree:I}=e;return c===_1n$a?!0:I?I(Xe,this):Ve.unsafe(this,u).is0()}clearCofactor(){const{clearCofactor:I}=e;return c===_1n$a?this:I?I(Xe,this):this.multiplyUnsafe(c)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}toBytes(I=!0){return _abool2(I,"isCompressed"),this.assertValidity(),b(Xe,this,I)}toHex(I=!0){return bytesToHex$5(this.toBytes(I))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(I=!0){return this.toBytes(I)}_setWindowSize(I){this.precompute(I)}static normalizeZ(I){return normalizeZ$1(Xe,I)}static msm(I,Ce){return pippenger(Xe,s,I,Ce)}static fromPrivateKey(I){return Xe.BASE.multiply(_normFnElement(s,I))}}Xe.BASE=new Xe(o.Gx,o.Gy,n.ONE),Xe.ZERO=new Xe(n.ZERO,n.ONE,n.ZERO),Xe.Fp=n,Xe.Fn=s;const it=s.BITS,Ve=new wNAF$2(Xe,e.endo?Math.ceil(it/2):it);return Xe.BASE.precompute(8),Xe}function pprefix$1(t){return Uint8Array.of(t?2:3)}function getWLengths$1(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function ecdh$1(t,e={}){const{Fn:r}=t,n=e.randomBytes||randomBytes$4,s=Object.assign(getWLengths$1(t.Fp,r),{seed:getMinHashLength$2(r.ORDER)});function o(b){try{return!!_normFnElement(r,b)}catch{return!1}}function c(b,R){const{publicKey:D,publicKeyUncompressed:k}=s;try{const Re=b.length;return R===!0&&Re!==D||R===!1&&Re!==k?!1:!!t.fromBytes(b)}catch{return!1}}function u(b=n(s.seed)){return mapHashToField$2(_abytes2(b,s.seed,"seed"),r.ORDER)}function f(b,R=!0){return t.BASE.multiply(_normFnElement(r,b)).toBytes(R)}function x(b){const R=u(b);return{secretKey:R,publicKey:f(R)}}function p(b){if(typeof b=="bigint")return!1;if(b instanceof t)return!0;const{secretKey:R,publicKey:D,publicKeyUncompressed:k}=s;if(r.allowedLengths||R===D)return;const Re=ensureBytes$1("key",b).length;return Re===D||Re===k}function g(b,R,D=!0){if(p(b)===!0)throw new Error("first arg must be private key");if(p(R)===!1)throw new Error("second arg must be public key");const k=_normFnElement(r,b);return t.fromHex(R).multiply(k).toBytes(D)}return Object.freeze({getPublicKey:f,getSharedSecret:g,keygen:x,Point:t,utils:{isValidSecretKey:o,isValidPublicKey:c,randomSecretKey:u,isValidPrivateKey:o,randomPrivateKey:u,normPrivateKeyToScalar:b=>_normFnElement(r,b),precompute(b=8,R=t.BASE){return R.precompute(b,!1)}},lengths:s})}function ecdsa$1(t,e,r={}){ahash$2(e),_validateObject(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||randomBytes$4,s=r.hmac||((Ce,...P)=>hmac$5(e,Ce,concatBytes$4(...P))),{Fp:o,Fn:c}=t,{ORDER:u,BITS:f}=c,{keygen:x,getPublicKey:p,getSharedSecret:g,utils:y,lengths:b}=ecdh$1(t,r),R={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},D="compact";function k(Ce){const P=u>>_1n$a;return Ce>P}function Re(Ce,P){if(!c.isValidNot0(P))throw new Error(`invalid signature ${Ce}: out of range 1..Point.Fn.ORDER`);return P}function Fe(Ce,P){validateSigFormat$1(P);const _e=b.signature,Le=P==="compact"?_e:P==="recovered"?_e+1:void 0;return _abytes2(Ce,Le,`${P} signature`)}class O{constructor(P,_e,Le){this.r=Re("r",P),this.s=Re("s",_e),Le!=null&&(this.recovery=Le),Object.freeze(this)}static fromBytes(P,_e=D){Fe(P,_e);let Le;if(_e==="der"){const{r:L,s:st}=DER$2.toSig(_abytes2(P));return new O(L,st)}_e==="recovered"&&(Le=P[0],_e="compact",P=P.subarray(1));const Ye=c.BYTES,je=P.subarray(0,Ye),K=P.subarray(Ye,Ye*2);return new O(c.fromBytes(je),c.fromBytes(K),Le)}static fromHex(P,_e){return this.fromBytes(hexToBytes$7(P),_e)}addRecoveryBit(P){return new O(this.r,this.s,P)}recoverPublicKey(P){const _e=o.ORDER,{r:Le,s:Ye,recovery:je}=this;if(je==null||![0,1,2,3].includes(je))throw new Error("recovery id invalid");if(u*_2n$7<_e&&je>1)throw new Error("recovery id is ambiguous for h>1 curve");const L=je===2||je===3?Le+u:Le;if(!o.isValid(L))throw new Error("recovery id 2 or 3 invalid");const st=o.toBytes(L),dt=t.fromBytes(concatBytes$4(pprefix$1((je&1)===0),st)),Je=c.inv(L),pt=ze(ensureBytes$1("msgHash",P)),rr=c.create(-pt*Je),cr=c.create(Ye*Je),fr=t.BASE.multiplyUnsafe(rr).add(dt.multiplyUnsafe(cr));if(fr.is0())throw new Error("point at infinify");return fr.assertValidity(),fr}hasHighS(){return k(this.s)}toBytes(P=D){if(validateSigFormat$1(P),P==="der")return hexToBytes$7(DER$2.hexFromSig(this));const _e=c.toBytes(this.r),Le=c.toBytes(this.s);if(P==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return concatBytes$4(Uint8Array.of(this.recovery),_e,Le)}return concatBytes$4(_e,Le)}toHex(P){return bytesToHex$5(this.toBytes(P))}assertValidity(){}static fromCompact(P){return O.fromBytes(ensureBytes$1("sig",P),"compact")}static fromDER(P){return O.fromBytes(ensureBytes$1("sig",P),"der")}normalizeS(){return this.hasHighS()?new O(this.r,c.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return bytesToHex$5(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return bytesToHex$5(this.toBytes("compact"))}}const $e=r.bits2int||function(P){if(P.length>8192)throw new Error("input is too large");const _e=bytesToNumberBE$2(P),Le=P.length*8-f;return Le>0?_e>>BigInt(Le):_e},ze=r.bits2int_modN||function(P){return c.create($e(P))},q=bitMask$2(f);function W(Ce){return aInRange$1("num < 2^"+f,Ce,_0n$a,q),c.toBytes(Ce)}function We(Ce,P){return _abytes2(Ce,void 0,"message"),P?_abytes2(e(Ce),void 0,"prehashed message"):Ce}function Xe(Ce,P,_e){if(["recovered","canonical"].some(rr=>rr in _e))throw new Error("sign() legacy options not supported");const{lowS:Le,prehash:Ye,extraEntropy:je}=validateSigOpts$1(_e,R);Ce=We(Ce,Ye);const K=ze(Ce),L=_normFnElement(c,P),st=[W(L),W(K)];if(je!=null&&je!==!1){const rr=je===!0?n(b.secretKey):je;st.push(ensureBytes$1("extraEntropy",rr))}const dt=concatBytes$4(...st),Je=K;function pt(rr){const cr=$e(rr);if(!c.isValidNot0(cr))return;const fr=c.inv(cr),ir=t.BASE.multiply(cr).toAffine(),ft=c.create(ir.x);if(ft===_0n$a)return;const nr=c.create(fr*c.create(Je+ft*L));if(nr===_0n$a)return;let lr=(ir.x===ft?0:2)|Number(ir.y&_1n$a),er=nr;return Le&&k(nr)&&(er=c.neg(nr),lr^=1),new O(ft,er,lr)}return{seed:dt,k2sig:pt}}function it(Ce,P,_e={}){Ce=ensureBytes$1("message",Ce);const{seed:Le,k2sig:Ye}=Xe(Ce,P,_e);return createHmacDrbg$2(e.outputLen,c.BYTES,s)(Le,Ye)}function Ve(Ce){let P;const _e=typeof Ce=="string"||isBytes$6(Ce),Le=!_e&&Ce!==null&&typeof Ce=="object"&&typeof Ce.r=="bigint"&&typeof Ce.s=="bigint";if(!_e&&!Le)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(Le)P=new O(Ce.r,Ce.s);else if(_e){try{P=O.fromBytes(ensureBytes$1("sig",Ce),"der")}catch(Ye){if(!(Ye instanceof DER$2.Err))throw Ye}if(!P)try{P=O.fromBytes(ensureBytes$1("sig",Ce),"compact")}catch{return!1}}return P||!1}function v(Ce,P,_e,Le={}){const{lowS:Ye,prehash:je,format:K}=validateSigOpts$1(Le,R);if(_e=ensureBytes$1("publicKey",_e),P=We(ensureBytes$1("message",P),je),"strict"in Le)throw new Error("options.strict was renamed to lowS");const L=K===void 0?Ve(Ce):O.fromBytes(ensureBytes$1("sig",Ce),K);if(L===!1)return!1;try{const st=t.fromBytes(_e);if(Ye&&L.hasHighS())return!1;const{r:dt,s:Je}=L,pt=ze(P),rr=c.inv(Je),cr=c.create(pt*rr),fr=c.create(dt*rr),ir=t.BASE.multiplyUnsafe(cr).add(st.multiplyUnsafe(fr));return ir.is0()?!1:c.create(ir.x)===dt}catch{return!1}}function I(Ce,P,_e={}){const{prehash:Le}=validateSigOpts$1(_e,R);return P=We(P,Le),O.fromBytes(Ce,"recovered").recoverPublicKey(P).toBytes()}return Object.freeze({keygen:x,getPublicKey:p,getSharedSecret:g,utils:y,lengths:b,Point:t,sign:it,verify:v,recoverPublicKey:I,Signature:O,hash:e})}function _weierstrass_legacy_opts_to_new(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(c=>Math.ceil(c/2)))):void 0;const s=Field$2(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),o={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:o}}function _ecdsa_legacy_opts_to_new(t){const{CURVE:e,curveOpts:r}=_weierstrass_legacy_opts_to_new(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function _ecdsa_new_output_to_legacy(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,nLength$2(r.Fn.ORDER,r.Fn.BITS))})}function weierstrass$3(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:s}=_ecdsa_legacy_opts_to_new(t),o=weierstrassN(e,r),c=ecdsa$1(o,n,s);return _ecdsa_new_output_to_legacy(t,c)}function createCurve$1(t,e){const r=n=>weierstrass$3({...t,hash:n});return{...r(e),create:r}}const secp256k1_CURVE$1={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},secp256k1_ENDO$1={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},_0n$9=BigInt(0),_1n$9=BigInt(1),_2n$6=BigInt(2);function sqrtMod$2(t){const e=secp256k1_CURVE$1.p,r=BigInt(3),n=BigInt(6),s=BigInt(11),o=BigInt(22),c=BigInt(23),u=BigInt(44),f=BigInt(88),x=t*t*t%e,p=x*x*t%e,g=pow2$2(p,r,e)*p%e,y=pow2$2(g,r,e)*p%e,b=pow2$2(y,_2n$6,e)*x%e,R=pow2$2(b,s,e)*b%e,D=pow2$2(R,o,e)*R%e,k=pow2$2(D,u,e)*D%e,Re=pow2$2(k,f,e)*k%e,Fe=pow2$2(Re,u,e)*D%e,O=pow2$2(Fe,r,e)*p%e,$e=pow2$2(O,c,e)*R%e,ze=pow2$2($e,n,e)*x%e,q=pow2$2(ze,_2n$6,e);if(!Fpk1$1.eql(Fpk1$1.sqr(q),t))throw new Error("Cannot find square root");return q}const Fpk1$1=Field$2(secp256k1_CURVE$1.p,{sqrt:sqrtMod$2}),secp256k1$3=createCurve$1({...secp256k1_CURVE$1,Fp:Fpk1$1,lowS:!0,endo:secp256k1_ENDO$1},sha256$6),TAGGED_HASH_PREFIXES$2={};function taggedHash$2(t,...e){let r=TAGGED_HASH_PREFIXES$2[t];if(r===void 0){const n=sha256$6(utf8ToBytes$5(t));r=concatBytes$4(n,n),TAGGED_HASH_PREFIXES$2[t]=r}return sha256$6(concatBytes$4(r,...e))}const pointToBytes$1=t=>t.toBytes(!0).slice(1),Pointk1$1=secp256k1$3.Point,hasEven=t=>t%_2n$6===_0n$9;function schnorrGetExtPubKey$1(t){const{Fn:e,BASE:r}=Pointk1$1,n=_normFnElement(e,t),s=r.multiply(n);return{scalar:hasEven(s.y)?n:e.neg(n),bytes:pointToBytes$1(s)}}function lift_x$1(t){const e=Fpk1$1;if(!e.isValidNot0(t))throw new Error("invalid x: Fail if x  p");const r=e.create(t*t),n=e.create(r*t+BigInt(7));let s=e.sqrt(n);hasEven(s)||(s=e.neg(s));const o=Pointk1$1.fromAffine({x:t,y:s});return o.assertValidity(),o}const num=bytesToNumberBE$2;function challenge$1(...t){return Pointk1$1.Fn.create(num(taggedHash$2("BIP0340/challenge",...t)))}function schnorrGetPublicKey$1(t){return schnorrGetExtPubKey$1(t).bytes}function schnorrSign$1(t,e,r=randomBytes$4(32)){const{Fn:n}=Pointk1$1,s=ensureBytes$1("message",t),{bytes:o,scalar:c}=schnorrGetExtPubKey$1(e),u=ensureBytes$1("auxRand",r,32),f=n.toBytes(c^num(taggedHash$2("BIP0340/aux",u))),x=taggedHash$2("BIP0340/nonce",f,o,s),{bytes:p,scalar:g}=schnorrGetExtPubKey$1(x),y=challenge$1(p,o,s),b=new Uint8Array(64);if(b.set(p,0),b.set(n.toBytes(n.create(g+y*c)),32),!schnorrVerify$1(b,s,o))throw new Error("sign: Invalid signature produced");return b}function schnorrVerify$1(t,e,r){const{Fn:n,BASE:s}=Pointk1$1,o=ensureBytes$1("signature",t,64),c=ensureBytes$1("message",e),u=ensureBytes$1("publicKey",r,32);try{const f=lift_x$1(num(u)),x=num(o.subarray(0,32));if(!inRange$1(x,_1n$9,secp256k1_CURVE$1.p))return!1;const p=num(o.subarray(32,64));if(!inRange$1(p,_1n$9,secp256k1_CURVE$1.n))return!1;const g=challenge$1(n.toBytes(x),pointToBytes$1(f),c),y=s.multiplyUnsafe(p).add(f.multiplyUnsafe(n.neg(g))),{x:b,y:R}=y.toAffine();return!(y.is0()||!hasEven(R)||b!==x)}catch{return!1}}const schnorr$1=(()=>{const r=(s=randomBytes$4(48))=>mapHashToField$2(s,secp256k1_CURVE$1.n);secp256k1$3.utils.randomSecretKey;function n(s){const o=r(s);return{secretKey:o,publicKey:schnorrGetPublicKey$1(o)}}return{keygen:n,getPublicKey:schnorrGetPublicKey$1,sign:schnorrSign$1,verify:schnorrVerify$1,Point:Pointk1$1,utils:{randomSecretKey:r,randomPrivateKey:r,taggedHash:taggedHash$2,lift_x:lift_x$1,pointToBytes:pointToBytes$1,numberToBytesBE:numberToBytesBE$2,bytesToNumberBE:bytesToNumberBE$2,mod:mod$2},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})(),sha256$5=sha256$6,bytesToHex$4=bytesToHex$5,hexToBytes$6=hexToBytes$7,Rho160$1=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Id160$1=Uint8Array.from(new Array(16).fill(0).map((t,e)=>e)),Pi160$1=Id160$1.map(t=>(9*t+5)%16),idxLR$1=(()=>{const r=[[Id160$1],[Pi160$1]];for(let n=0;n<4;n++)for(let s of r)s.push(s[n].map(o=>Rho160$1[o]));return r})(),idxL$1=idxLR$1[0],idxR$1=idxLR$1[1],shifts160$1=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(t=>Uint8Array.from(t)),shiftsL160$1=idxL$1.map((t,e)=>t.map(r=>shifts160$1[e][r])),shiftsR160$1=idxR$1.map((t,e)=>t.map(r=>shifts160$1[e][r])),Kl160$1=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),Kr160$1=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function ripemd_f$1(t,e,r,n){return t===0?e^r^n:t===1?e&r|~e&n:t===2?(e|~r)^n:t===3?e&n|r&~n:e^(r|~n)}const BUF_160$1=new Uint32Array(16);class RIPEMD160 extends HashMD$2{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:r,h2:n,h3:s,h4:o}=this;return[e,r,n,s,o]}set(e,r,n,s,o){this.h0=e|0,this.h1=r|0,this.h2=n|0,this.h3=s|0,this.h4=o|0}process(e,r){for(let b=0;b<16;b++,r+=4)BUF_160$1[b]=e.getUint32(r,!0);let n=this.h0|0,s=n,o=this.h1|0,c=o,u=this.h2|0,f=u,x=this.h3|0,p=x,g=this.h4|0,y=g;for(let b=0;b<5;b++){const R=4-b,D=Kl160$1[b],k=Kr160$1[b],Re=idxL$1[b],Fe=idxR$1[b],O=shiftsL160$1[b],$e=shiftsR160$1[b];for(let ze=0;ze<16;ze++){const q=rotl$3(n+ripemd_f$1(b,o,u,x)+BUF_160$1[Re[ze]]+D,O[ze])+g|0;n=g,g=x,x=rotl$3(u,10)|0,u=o,o=q}for(let ze=0;ze<16;ze++){const q=rotl$3(s+ripemd_f$1(R,c,f,p)+BUF_160$1[Fe[ze]]+k,$e[ze])+y|0;s=y,y=p,p=rotl$3(f,10)|0,f=c,c=q}}this.set(this.h1+u+p|0,this.h2+x+y|0,this.h3+g+s|0,this.h4+n+c|0,this.h0+o+f|0)}roundClean(){clean$2(BUF_160$1)}destroy(){this.destroyed=!0,clean$2(this.buffer),this.set(0,0,0,0,0)}}const ripemd160$2=createHasher$2(()=>new RIPEMD160);function isBytes$5(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function isArrayOf$2(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function afn$2(t){if(typeof t!="function")throw new Error("function expected");return!0}function astr$2(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function anumber$4(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function aArr$2(t){if(!Array.isArray(t))throw new Error("array expected")}function astrArr$2(t,e){if(!isArrayOf$2(!0,e))throw new Error(`${t}: array of strings expected`)}function anumArr$2(t,e){if(!isArrayOf$2(!1,e))throw new Error(`${t}: array of numbers expected`)}function chain$3(...t){const e=o=>o,r=(o,c)=>u=>o(c(u)),n=t.map(o=>o.encode).reduceRight(r,e),s=t.map(o=>o.decode).reduce(r,e);return{encode:n,decode:s}}function alphabet$3(t){const e=typeof t=="string"?t.split(""):t,r=e.length;astrArr$2("alphabet",e);const n=new Map(e.map((s,o)=>[s,o]));return{encode:s=>(aArr$2(s),s.map(o=>{if(!Number.isSafeInteger(o)||o<0||o>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${o}". Allowed: ${t}`);return e[o]})),decode:s=>(aArr$2(s),s.map(o=>{astr$2("alphabet.decode",o);const c=n.get(o);if(c===void 0)throw new Error(`Unknown letter: "${o}". Allowed: ${t}`);return c}))}}function join$3(t=""){return astr$2("join",t),{encode:e=>(astrArr$2("join.decode",e),e.join(t)),decode:e=>(astr$2("join.decode",e),e.split(t))}}function convertRadix$3(t,e,r){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(aArr$2(t),!t.length)return[];let n=0;const s=[],o=Array.from(t,u=>{if(anumber$4(u),u<0||u>=e)throw new Error(`invalid integer: ${u}`);return u}),c=o.length;for(;;){let u=0,f=!0;for(let x=n;x<c;x++){const p=o[x],g=e*u,y=g+p;if(!Number.isSafeInteger(y)||g/e!==u||y-p!==g)throw new Error("convertRadix: carry overflow");const b=y/r;u=y%r;const R=Math.floor(b);if(o[x]=R,!Number.isSafeInteger(R)||R*r+u!==y)throw new Error("convertRadix: carry overflow");if(f)R?f=!1:n=x;else continue}if(s.push(u),f)break}for(let u=0;u<t.length-1&&t[u]===0;u++)s.push(0);return s.reverse()}function radix$3(t){anumber$4(t);const e=2**8;return{encode:r=>{if(!isBytes$5(r))throw new Error("radix.encode input should be Uint8Array");return convertRadix$3(Array.from(r),e,t)},decode:r=>(anumArr$2("radix.decode",r),Uint8Array.from(convertRadix$3(r,t,e)))}}function checksum$2(t,e){return anumber$4(t),afn$2(e),{encode(r){if(!isBytes$5(r))throw new Error("checksum.encode: input should be Uint8Array");const n=e(r).slice(0,t),s=new Uint8Array(r.length+t);return s.set(r),s.set(n,r.length),s},decode(r){if(!isBytes$5(r))throw new Error("checksum.decode: input should be Uint8Array");const n=r.slice(0,-t),s=r.slice(-t),o=e(n).slice(0,t);for(let c=0;c<t;c++)if(o[c]!==s[c])throw new Error("Invalid checksum");return n}}}const genBase58$2=t=>chain$3(radix$3(58),alphabet$3(t),join$3("")),base58$3=genBase58$2("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),createBase58check$1=t=>chain$3(checksum$2(4,e=>t(t(e))),base58$3);const Point$2=secp256k1$3.ProjectivePoint,base58check$1=createBase58check$1(sha256$6);function bytesToNumber(t){abytes$2(t);const e=t.length===0?"0":bytesToHex$5(t);return BigInt("0x"+e)}function numberToBytes(t){if(typeof t!="bigint")throw new Error("bigint expected");return hexToBytes$7(t.toString(16).padStart(64,"0"))}const MASTER_SECRET$1=utf8ToBytes$5("Bitcoin seed"),BITCOIN_VERSIONS$1={private:76066276,public:76067358},HARDENED_OFFSET$1=2147483648,hash160$2=t=>ripemd160$2(sha256$6(t)),fromU32$1=t=>createView$5(t).getUint32(0,!1),toU32$1=t=>{if(!Number.isSafeInteger(t)||t<0||t>2**32-1)throw new Error("invalid number, should be from 0 to 2**32-1, got "+t);const e=new Uint8Array(4);return createView$5(e).setUint32(0,t,!1),e};let HDKey$1=class Ro{get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return fromU32$1(this.pubHash)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){const e=this.privateKey;if(!e)throw new Error("No private key");return base58check$1.encode(this.serialize(this.versions.private,concatBytes$4(new Uint8Array([0]),e)))}get publicExtendedKey(){if(!this.pubKey)throw new Error("No public key");return base58check$1.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(e,r=BITCOIN_VERSIONS$1){if(abytes$2(e),8*e.length<128||8*e.length>512)throw new Error("HDKey: seed length must be between 128 and 512 bits; 256 bits is advised, got "+e.length);const n=hmac$5(sha512$3,MASTER_SECRET$1,e);return new Ro({versions:r,chainCode:n.slice(32),privateKey:n.slice(0,32)})}static fromExtendedKey(e,r=BITCOIN_VERSIONS$1){const n=base58check$1.decode(e),s=createView$5(n),o=s.getUint32(0,!1),c={versions:r,depth:n[4],parentFingerprint:s.getUint32(5,!1),index:s.getUint32(9,!1),chainCode:n.slice(13,45)},u=n.slice(45),f=u[0]===0;if(o!==r[f?"private":"public"])throw new Error("Version mismatch");return f?new Ro({...c,privateKey:u.slice(1)}):new Ro({...c,publicKey:u})}static fromJSON(e){return Ro.fromExtendedKey(e.xpriv)}constructor(e){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!e||typeof e!="object")throw new Error("HDKey.constructor must not be called directly");if(this.versions=e.versions||BITCOIN_VERSIONS$1,this.depth=e.depth||0,this.chainCode=e.chainCode||null,this.index=e.index||0,this.parentFingerprint=e.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(e.publicKey&&e.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(e.privateKey){if(!secp256k1$3.utils.isValidPrivateKey(e.privateKey))throw new Error("Invalid private key");this.privKey=typeof e.privateKey=="bigint"?e.privateKey:bytesToNumber(e.privateKey),this.privKeyBytes=numberToBytes(this.privKey),this.pubKey=secp256k1$3.getPublicKey(e.privateKey,!0)}else if(e.publicKey)this.pubKey=Point$2.fromHex(e.publicKey).toRawBytes(!0);else throw new Error("HDKey: no public or private key provided");this.pubHash=hash160$2(this.pubKey)}derive(e){if(!/^[mM]'?/.test(e))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(e))return this;const r=e.replace(/^[mM]'?\//,"").split("/");let n=this;for(const s of r){const o=/^(\d+)('?)$/.exec(s),c=o&&o[1];if(!o||o.length!==3||typeof c!="string")throw new Error("invalid child index: "+s);let u=+c;if(!Number.isSafeInteger(u)||u>=HARDENED_OFFSET$1)throw new Error("Invalid index");o[2]==="'"&&(u+=HARDENED_OFFSET$1),n=n.deriveChild(u)}return n}deriveChild(e){if(!this.pubKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let r=toU32$1(e);if(e>=HARDENED_OFFSET$1){const u=this.privateKey;if(!u)throw new Error("Could not derive hardened child key");r=concatBytes$4(new Uint8Array([0]),u,r)}else r=concatBytes$4(this.pubKey,r);const n=hmac$5(sha512$3,this.chainCode,r),s=bytesToNumber(n.slice(0,32)),o=n.slice(32);if(!secp256k1$3.utils.isValidPrivateKey(s))throw new Error("Tweak bigger than curve order");const c={versions:this.versions,chainCode:o,depth:this.depth+1,parentFingerprint:this.fingerprint,index:e};try{if(this.privateKey){const u=mod$2(this.privKey+s,secp256k1$3.CURVE.n);if(!secp256k1$3.utils.isValidPrivateKey(u))throw new Error("The tweak was out of range or the resulted private key is invalid");c.privateKey=u}else{const u=Point$2.fromHex(this.pubKey).add(Point$2.fromPrivateKey(s));if(u.equals(Point$2.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");c.publicKey=u.toRawBytes(!0)}return new Ro(c)}catch{return this.deriveChild(e+1)}}sign(e){if(!this.privateKey)throw new Error("No privateKey set!");return abytes$2(e,32),secp256k1$3.sign(e,this.privKey).toCompactRawBytes()}verify(e,r){if(abytes$2(e,32),abytes$2(r,64),!this.publicKey)throw new Error("No publicKey set!");let n;try{n=secp256k1$3.Signature.fromCompact(r)}catch{return!1}return secp256k1$3.verify(n,e,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(e,r){if(!this.chainCode)throw new Error("No chainCode set");return abytes$2(r,33),concatBytes$4(toU32$1(e),new Uint8Array([this.depth]),toU32$1(this.parentFingerprint),toU32$1(this.index),this.chainCode,r)}};function Q(t){return Et(bytesToHex$4(t))}function Et(t){return BigInt(`0x${t}`)}function Rt(t){return Buffer$1.from(t,"base64")}const Qt=hexToBytes$6("536563703235366b315f48617368546f43757276655f43617368755f");function H(t){const e=sha256$5(Buffer$1.concat([Qt,t])),r=new Uint32Array(1),n=2**16;for(let s=0;s<n;s++){const o=new Uint8Array(r.buffer),c=sha256$5(Buffer$1.concat([e,o]));try{return B(bytesToHex$4(Buffer$1.concat([new Uint8Array([2]),c])))}catch{r[0]++}}throw new Error("No valid point found")}function Lt(t){const e=t.map(r=>r.toHex(!1)).join("");return sha256$5(new TextEncoder().encode(e))}function B(t){return secp256k1$3.ProjectivePoint.fromHex(t)}const Wt=t=>{let e;return/^[a-fA-F0-9]+$/.test(t)?e=Et(t)%BigInt(2**31-1):e=Q(Rt(t))%BigInt(2**31-1),e};function Ct(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}const $t=(t,e,r,n)=>{const s=secp256k1$3.ProjectivePoint.fromPrivateKey(bytesToHex$4(t.s)),o=n.multiply(Q(t.e)),c=e.multiply(Q(t.s)),u=r.multiply(Q(t.e)),f=s.subtract(o),x=c.subtract(u),p=Lt([f,x,n,r]);return Ct(p,t.e)},jt=(t,e,r,n)=>{if(e.r===void 0)throw new Error("verifyDLEQProof_reblind: Undefined blinding factor");const s=H(t),o=r.add(n.multiply(e.r)),c=secp256k1$3.ProjectivePoint.fromPrivateKey(e.r),u=s.add(c);return $t(e,u,o,n)};function Ht(t){return Buffer$1.from(t).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function St(t){return Buffer$1.from(t,"base64")}function Pt(t){const e=JSON.stringify(t);return Vt(Buffer$1.from(e).toString("base64"))}function zt(t){const e=Buffer$1.from(Gt(t),"base64").toString();return JSON.parse(e)}function Gt(t){return t.replace(/-/g,"+").replace(/_/g,"/").split("=")[0]}function Vt(t){return t.replace(/\+/g,"-").replace(/\//g,"_").split("=")[0]}function Jt(t){return typeof t=="number"||typeof t=="string"}function nt(t){const e=[];return rt(t,e),new Uint8Array(e)}function rt(t,e){if(t===null)e.push(246);else if(t===void 0)e.push(247);else if(typeof t=="boolean")e.push(t?245:244);else if(typeof t=="number")At(t,e);else if(typeof t=="string")vt(t,e);else if(Array.isArray(t))Xt(t,e);else if(t instanceof Uint8Array)Yt(t,e);else if(typeof t=="object")Zt(t,e);else throw new Error("Unsupported type")}function At(t,e){if(t<24)e.push(t);else if(t<256)e.push(24,t);else if(t<65536)e.push(25,t>>8,t&255);else if(t<4294967296)e.push(26,t>>24,t>>16&255,t>>8&255,t&255);else throw new Error("Unsupported integer size")}function Yt(t,e){const r=t.length;if(r<24)e.push(64+r);else if(r<256)e.push(88,r);else if(r<65536)e.push(89,r>>8&255,r&255);else if(r<4294967296)e.push(90,r>>24&255,r>>16&255,r>>8&255,r&255);else throw new Error("Byte string too long to encode");for(let n=0;n<t.length;n++)e.push(t[n])}function vt(t,e){const r=new TextEncoder().encode(t),n=r.length;if(n<24)e.push(96+n);else if(n<256)e.push(120,n);else if(n<65536)e.push(121,n>>8&255,n&255);else if(n<4294967296)e.push(122,n>>24&255,n>>16&255,n>>8&255,n&255);else throw new Error("String too long to encode");for(let s=0;s<r.length;s++)e.push(r[s])}function Xt(t,e){const r=t.length;if(r<24)e.push(128|r);else if(r<256)e.push(152,r);else if(r<65536)e.push(153,r>>8,r&255);else throw new Error("Unsupported array length");for(const n of t)rt(n,e)}function Zt(t,e){const r=Object.keys(t);At(r.length,e),e[e.length-1]|=160;for(const n of r)vt(n,e),rt(t[n],e)}function ot(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);return z(e,0).value}function z(t,e){if(e>=t.byteLength)throw new Error("Unexpected end of data");const r=t.getUint8(e++),n=r>>5,s=r&31;switch(n){case 0:return te(t,e,s);case 1:return ee$1(t,e,s);case 2:return se(t,e,s);case 3:return ne(t,e,s);case 4:return re(t,e,s);case 5:return oe(t,e,s);case 7:return ce(t,e,s);default:throw new Error(`Unsupported major type: ${n}`)}}function F(t,e,r){if(r<24)return{value:r,offset:e};if(r===24)return{value:t.getUint8(e++),offset:e};if(r===25){const n=t.getUint16(e,!1);return e+=2,{value:n,offset:e}}if(r===26){const n=t.getUint32(e,!1);return e+=4,{value:n,offset:e}}if(r===27){const n=t.getUint32(e,!1),s=t.getUint32(e+4,!1);return e+=8,{value:n*2**32+s,offset:e}}throw new Error(`Unsupported length: ${r}`)}function te(t,e,r){const{value:n,offset:s}=F(t,e,r);return{value:n,offset:s}}function ee$1(t,e,r){const{value:n,offset:s}=F(t,e,r);return{value:-1-n,offset:s}}function se(t,e,r){const{value:n,offset:s}=F(t,e,r);if(s+n>t.byteLength)throw new Error("Byte string length exceeds data length");return{value:new Uint8Array(t.buffer,t.byteOffset+s,n),offset:s+n}}function ne(t,e,r){const{value:n,offset:s}=F(t,e,r);if(s+n>t.byteLength)throw new Error("String length exceeds data length");const o=new Uint8Array(t.buffer,t.byteOffset+s,n);return{value:new TextDecoder().decode(o),offset:s+n}}function re(t,e,r){const{value:n,offset:s}=F(t,e,r),o=[];let c=s;for(let u=0;u<n;u++){const f=z(t,c);o.push(f.value),c=f.offset}return{value:o,offset:c}}function oe(t,e,r){const{value:n,offset:s}=F(t,e,r),o={};let c=s;for(let u=0;u<n;u++){const f=z(t,c);if(!Jt(f.value))throw new Error("Invalid key type");const x=z(t,f.offset);o[f.value]=x.value,c=x.offset}return{value:o,offset:c}}function ie(t){const e=(t&31744)>>10,r=t&1023,n=t&32768?-1:1;return e===0?n*2**-14*(r/1024):e===31?r?NaN:n*(1/0):n*2**(e-15)*(1+r/1024)}function ce(t,e,r){if(r<24)switch(r){case 20:return{value:!1,offset:e};case 21:return{value:!0,offset:e};case 22:return{value:null,offset:e};case 23:return{value:void 0,offset:e};default:throw new Error(`Unknown simple value: ${r}`)}if(r===24)return{value:t.getUint8(e++),offset:e};if(r===25){const n=ie(t.getUint16(e,!1));return e+=2,{value:n,offset:e}}if(r===26){const n=t.getFloat32(e,!1);return e+=4,{value:n,offset:e}}if(r===27){const n=t.getFloat64(e,!1);return e+=8,{value:n,offset:e}}throw new Error(`Unknown simple or float value: ${r}`)}const ae="A",ue="cashu";function A(t,e,r,n){if(r){const s=kt(r);if(s>t)throw new Error(`Split is greater than total amount: ${s} > ${t}`);if(r.some(o=>!Tt(o,e)))throw new Error("Provided amount preferences do not match the amounts of the mint keyset.");t=t-kt(r)}else r=[];return It(e,"desc").forEach(s=>{const o=Math.floor(t/s);for(let c=0;c<o;++c)r?.push(s);t%=s}),r.sort((s,o)=>s-o)}function mt(t,e,r,n){const s=[],o=t.map(u=>u.amount);It(r,"asc").forEach(u=>{const f=o.filter(p=>p===u).length,x=Math.max(n-f,0);for(let p=0;p<x&&!(s.reduce((g,y)=>g+y,0)+u>e);++p)s.push(u)});const c=e-s.reduce((u,f)=>u+f,0);return c&&A(c,r).forEach(u=>{s.push(u)}),s.sort((u,f)=>u-f)}function It(t,e="desc"){return e=="desc"?Object.keys(t).map(r=>parseInt(r)).sort((r,n)=>n-r):Object.keys(t).map(r=>parseInt(r)).sort((r,n)=>r-n)}function Tt(t,e){return t in e}function he(t){return Kt(bytesToHex$4(t))}function Kt(t){return BigInt(`0x${t}`)}function de(t){return t.toString(16).padStart(64,"0")}function gt(t){return/^[a-f0-9]*$/i.test(t)}function Mt(t){return Array.isArray(t)?t.some(e=>!gt(e.id)):gt(t.id)}function le(t){const e={token:[{mint:t.mint,proofs:t.proofs}]};return t.unit&&(e.unit=t.unit),t.memo&&(e.memo=t.memo),ue+ae+Pt(e)}function He(t,e){if(Mt(t.proofs)||e?.version===3){if(e?.version===4)throw new Error("can not encode to v4 token if proofs contain non-hex keyset id");return le(t)}return fe$1(t)}function fe$1(t){if(t.proofs.forEach(c=>{if(c.dleq&&c.dleq.r==null)throw new Error("Missing blinding factor in included DLEQ proof")}),Mt(t.proofs))throw new Error("can not encode to v4 token if proofs contain non-hex keyset id");const e=qt(t),r=nt(e),n="cashu",s="B",o=Ht(r);return n+s+o}function qt(t){const e={},r=t.mint;for(let s=0;s<t.proofs.length;s++){const o=t.proofs[s];e[o.id]?e[o.id].push(o):e[o.id]=[o]}const n={m:r,u:t.unit||"sat",t:Object.keys(e).map(s=>({i:hexToBytes$6(s),p:e[s].map(o=>({a:o.amount,s:o.secret,c:hexToBytes$6(o.C),...o.dleq&&{d:{e:hexToBytes$6(o.dleq.e),s:hexToBytes$6(o.dleq.s),r:hexToBytes$6(o.dleq.r??"00")}},...o.witness&&{w:JSON.stringify(o.witness)}}))}))};return t.memo&&(n.d=t.memo),n}function Dt(t){const e=[];t.t.forEach(n=>n.p.forEach(s=>{e.push({secret:s.s,C:bytesToHex$4(s.c),amount:s.a,id:bytesToHex$4(n.i),...s.d&&{dleq:{r:bytesToHex$4(s.d.r),s:bytesToHex$4(s.d.s),e:bytesToHex$4(s.d.e)}},...s.w&&{witness:s.w}})}));const r={mint:t.m,proofs:e,unit:t.u||"sat"};return t.d&&(r.memo=t.d),r}function pe(t){return["web+cashu://","cashu://","cashu:","cashu"].forEach(e=>{t.startsWith(e)&&(t=t.slice(e.length))}),ye(t)}function ye(t){const e=t.slice(0,1),r=t.slice(1);if(e==="A"){const n=zt(r);if(n.token.length>1)throw new Error("Multi entry token are not supported");const s=n.token[0],o={mint:s.mint,proofs:s.proofs,unit:n.unit||"sat"};return n.memo&&(o.memo=n.memo),o}else if(e==="B"){const n=St(r),s=ot(n);return Dt(s)}throw new Error("Token version is not supported")}function wt(t){return me(t.keys)===t.id}function me(t){const e=Object.entries(t).sort((n,s)=>+n[0]-+s[0]).map(([,n])=>hexToBytes$6(n)).reduce((n,s)=>ge$1(n,s),new Uint8Array),r=sha256$5(e);return"00"+Buffer.from(r).toString("hex").slice(0,14)}function ge$1(t,e){const r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}function T(t){return typeof t=="object"}function _(...t){return t.map(e=>e.replace(/(^\/+|\/+$)/g,"")).join("/")}function Ut(t){return t.replace(/\/$/,"")}function U(t){return t.reduce((e,r)=>e+r.amount,0)}class we{get value(){return this._value}set value(e){this._value=e}get next(){return this._next}set next(e){this._next=e}constructor(e){this._value=e,this._next=null}}class ke{get first(){return this._first}set first(e){this._first=e}get last(){return this._last}set last(e){this._last=e}get size(){return this._size}set size(e){this._size=e}constructor(){this._first=null,this._last=null,this._size=0}enqueue(e){const r=new we(e);return this._size===0||!this._last?(this._first=r,this._last=r):(this._last.next=r,this._last=r),this._size++,!0}dequeue(){if(this._size===0||!this._first)return null;const e=this._first;return this._first=e.next,e.next=null,this._size--,e.value}}function j(t){return t.map(e=>{const r={...e};return delete r.dleq,r})}function Bt(t,e){if(t.dleq==null)return!1;const r={e:hexToBytes$6(t.dleq.e),s:hexToBytes$6(t.dleq.s),r:Kt(t.dleq.r??"00")};if(!Tt(t.amount,e.keys))throw new Error(`undefined key for amount ${t.amount}`);const n=e.keys[t.amount];return!!jt(new TextEncoder().encode(t.secret),r,B(t.C),B(n))}function kt(t){return t.reduce((e,r)=>e+r,0)}let ct;typeof WebSocket<"u"&&(ct=WebSocket);function be(){return ct}class N{constructor(){this.connectionMap=new Map}static getInstance(){return N.instace||(N.instace=new N),N.instace}getConnection(e){if(this.connectionMap.has(e))return this.connectionMap.get(e);const r=new Ee(e);return this.connectionMap.set(e,r),r}}class Ee{constructor(e){this.subListeners={},this.rpcListeners={},this.rpcId=0,this._WS=be(),this.url=new URL(e),this.messageQueue=new ke}connect(){return this.connectionPromise||(this.connectionPromise=new Promise((e,r)=>{try{this.ws=new this._WS(this.url.toString())}catch(n){r(n);return}this.ws.onopen=()=>{e()},this.ws.onerror=()=>{r(new Error("Failed to open WebSocket"))},this.ws.onmessage=n=>{this.messageQueue.enqueue(n.data),this.handlingInterval||(this.handlingInterval=setInterval(this.handleNextMesage.bind(this),0))},this.ws.onclose=()=>{this.connectionPromise=void 0}})),this.connectionPromise}sendRequest(e,r){if(this.ws?.readyState!==1)throw new Error("Socket not open...");const n=this.rpcId;this.rpcId++;const s=JSON.stringify({jsonrpc:"2.0",method:e,params:r,id:n});this.ws?.send(s)}closeSubscription(e){this.ws?.send(JSON.stringify(["CLOSE",e]))}addSubListener(e,r){(this.subListeners[e]=this.subListeners[e]||[]).push(r)}addRpcListener(e,r,n){this.rpcListeners[n]={callback:e,errorCallback:r}}removeRpcListener(e){delete this.rpcListeners[e]}removeListener(e,r){if(this.subListeners[e]){if(this.subListeners[e].length===1){delete this.subListeners[e];return}this.subListeners[e]=this.subListeners[e].filter(n=>n!==r)}}async ensureConnection(){this.ws?.readyState!==1&&await this.connect()}handleNextMesage(){if(this.messageQueue.size===0){clearInterval(this.handlingInterval),this.handlingInterval=void 0;return}const e=this.messageQueue.dequeue();let r;try{if(r=JSON.parse(e),"result"in r&&r.id!=null)this.rpcListeners[r.id]&&(this.rpcListeners[r.id].callback(),this.removeRpcListener(r.id));else if("error"in r&&r.id!=null)this.rpcListeners[r.id]&&(this.rpcListeners[r.id].errorCallback(r.error),this.removeRpcListener(r.id));else if("method"in r&&!("id"in r)){const n=r.params.subId;if(!n)return;if(this.subListeners[n]?.length>0){const s=r;this.subListeners[n].forEach(o=>o(s.params.payload))}}}catch(n){console.error(n);return}}createSubscription(e,r,n){if(this.ws?.readyState!==1)return n(new Error("Socket is not open"));const s=(Math.random()+1).toString(36).substring(7);return this.addRpcListener(()=>{this.addSubListener(s,r)},o=>{n(new Error(o.message))},this.rpcId),this.sendRequest("subscribe",{...e,subId:s}),this.rpcId++,s}cancelSubscription(e,r){this.removeRpcListener(e),this.removeListener(e,r),this.rpcId++,this.sendRequest("unsubscribe",{subId:e})}get activeSubscriptions(){return Object.keys(this.subListeners)}close(){this.ws&&this.ws?.close()}}const C={UNPAID:"UNPAID",PENDING:"PENDING",PAID:"PAID"},Z={UNPAID:"UNPAID",PAID:"PAID"};class $ extends Error{constructor(e,r){super(e),this.status=r,this.name="HttpResponseError",Object.setPrototypeOf(this,$.prototype)}}class at extends Error{constructor(e){super(e),this.name="NetworkError",Object.setPrototypeOf(this,at.prototype)}}let ut$1=class kf extends ${constructor(e,r){super(r||"Unknown mint operation error",400),this.code=e,this.name="MintOperationError",Object.setPrototypeOf(this,kf.prototype)}},xt={};async function Pe({endpoint:t,requestBody:e,headers:r,...n}){const s=e?JSON.stringify(e):void 0,o={Accept:"application/json, text/plain, */*",...s?{"Content-Type":"application/json"}:void 0,...r};let c;try{c=await fetch(t,{body:s,headers:o,...n})}catch(u){throw new at(u instanceof Error?u.message:"Network request failed")}if(!c.ok){const u=await c.json().catch(()=>({error:"bad response"}));throw c.status===400&&"code"in u&&"detail"in u?new ut$1(u.code,u.detail):new $("error"in u?u.error:u.detail||"HTTP request failed",c.status)}try{return await c.json()}catch(u){throw console.error("Failed to parse HTTP response",u),new $("bad response",c.status)}}async function E(t){return await Pe({...t,...xt})}function G(t){return t.state||(console.warn("Field 'state' not found in MeltQuoteResponse. Update NUT-05 of mint: https://github.com/cashubtc/nuts/pull/136)"),typeof t.paid=="boolean"&&(t.state=t.paid?C.PAID:C.UNPAID)),t}function _t(t){return t.state||(console.warn("Field 'state' not found in MintQuoteResponse. Update NUT-04 of mint: https://github.com/cashubtc/nuts/pull/141)"),typeof t.paid=="boolean"&&(t.state=t.paid?Z.PAID:Z.UNPAID)),t}function Ae(t){return Array.isArray(t?.contact)&&t?.contact.length>0&&(t.contact=t.contact.map(e=>Array.isArray(e)&&e.length===2&&typeof e[0]=="string"&&typeof e[1]=="string"?(console.warn("Mint returned deprecated 'contact' field: Update NUT-06: https://github.com/cashubtc/nuts/pull/117"),{method:e[0],info:e[1]}):e)),t}class tt{constructor(e){this._mintInfo=e,e.nuts[22]&&(this._protectedEnpoints={cache:{},apiReturn:e.nuts[22].protected_endpoints.map(r=>({method:r.method,regex:new RegExp(r.path)}))})}isSupported(e){switch(e){case 4:case 5:return this.checkMintMelt(e);case 7:case 8:case 9:case 10:case 11:case 12:case 14:case 20:return this.checkGenericNut(e);case 17:return this.checkNut17();case 15:return this.checkNut15();default:throw new Error("nut is not supported by cashu-ts")}}requiresBlindAuthToken(e){if(!this._protectedEnpoints)return!1;if(typeof this._protectedEnpoints.cache[e]=="boolean")return this._protectedEnpoints.cache[e];const r=this._protectedEnpoints.apiReturn.some(n=>n.regex.test(e));return this._protectedEnpoints.cache[e]=r,r}checkGenericNut(e){return this._mintInfo.nuts[e]?.supported?{supported:!0}:{supported:!1}}checkMintMelt(e){const r=this._mintInfo.nuts[e];return r&&r.methods.length>0&&!r.disabled?{disabled:!1,params:r.methods}:{disabled:!0,params:r.methods}}checkNut17(){return this._mintInfo.nuts[17]&&this._mintInfo.nuts[17].supported.length>0?{supported:!0,params:this._mintInfo.nuts[17].supported}:{supported:!1}}checkNut15(){return this._mintInfo.nuts[15]&&this._mintInfo.nuts[15].methods.length>0?{supported:!0,params:this._mintInfo.nuts[15].methods}:{supported:!1}}get contact(){return this._mintInfo.contact}get description(){return this._mintInfo.description}get description_long(){return this._mintInfo.description_long}get name(){return this._mintInfo.name}get pubkey(){return this._mintInfo.pubkey}get nuts(){return this._mintInfo.nuts}get version(){return this._mintInfo.version}get motd(){return this._mintInfo.motd}}class S{constructor(e,r,n){this._mintUrl=e,this._customRequest=r,this._checkNut22=!1,this._mintUrl=Ut(e),this._customRequest=r,n&&(this._checkNut22=!0,this._authTokenGetter=n)}get mintUrl(){return this._mintUrl}static async getInfo(e,r){const n=await(r||E)({endpoint:_(e,"/v1/info")});return Ae(n)}async getInfo(){return S.getInfo(this._mintUrl,this._customRequest)}async getLazyMintInfo(){if(this._mintInfo)return this._mintInfo;const e=await S.getInfo(this._mintUrl,this._customRequest);return this._mintInfo=new tt(e),this._mintInfo}static async swap(e,r,n,s){const o=n||E,c=s?{"Blind-auth":s}:{},u=await o({endpoint:_(e,"/v1/swap"),method:"POST",requestBody:r,headers:c});if(!T(u)||!Array.isArray(u?.signatures))throw new Error(u.detail??"bad response");return u}async swap(e){const r=await this.handleBlindAuth("/v1/swap");return S.swap(this._mintUrl,e,this._customRequest,r)}static async createMintQuote(e,r,n,s){const o=n||E,c=s?{"Blind-auth":s}:{},u=await o({endpoint:_(e,"/v1/mint/quote/bolt11"),method:"POST",requestBody:r,headers:c});return _t(u)}async createMintQuote(e){const r=await this.handleBlindAuth("/v1/mint/quote/bolt11");return S.createMintQuote(this._mintUrl,e,this._customRequest,r)}static async checkMintQuote(e,r,n,s){const o=n||E,c=s?{"Blind-auth":s}:{},u=await o({endpoint:_(e,"/v1/mint/quote/bolt11",r),method:"GET",headers:c});return _t(u)}async checkMintQuote(e){const r=await this.handleBlindAuth(`/v1/mint/quote/bolt11/${e}`);return S.checkMintQuote(this._mintUrl,e,this._customRequest,r)}static async mint(e,r,n,s){const o=n||E,c=s?{"Blind-auth":s}:{},u=await o({endpoint:_(e,"/v1/mint/bolt11"),method:"POST",requestBody:r,headers:c});if(!T(u)||!Array.isArray(u?.signatures))throw new Error("bad response");return u}async mint(e){const r=await this.handleBlindAuth("/v1/mint/bolt11");return S.mint(this._mintUrl,e,this._customRequest,r)}static async createMeltQuote(e,r,n,s){const o=n||E,c=s?{"Blind-auth":s}:{},u=await o({endpoint:_(e,"/v1/melt/quote/bolt11"),method:"POST",requestBody:r,headers:c}),f=G(u);if(!T(f)||typeof f?.amount!="number"||typeof f?.fee_reserve!="number"||typeof f?.quote!="string")throw new Error("bad response");return f}async createMeltQuote(e){const r=await this.handleBlindAuth("/v1/melt/quote/bolt11");return S.createMeltQuote(this._mintUrl,e,this._customRequest,r)}static async checkMeltQuote(e,r,n,s){const o=n||E,c=s?{"Blind-auth":s}:{},u=await o({endpoint:_(e,"/v1/melt/quote/bolt11",r),method:"GET",headers:c}),f=G(u);if(!T(f)||typeof f?.amount!="number"||typeof f?.fee_reserve!="number"||typeof f?.quote!="string"||typeof f?.state!="string"||!Object.values(C).includes(f.state))throw new Error("bad response");return f}async checkMeltQuote(e){const r=await this.handleBlindAuth(`/v1/melt/quote/bolt11/${e}`);return S.checkMeltQuote(this._mintUrl,e,this._customRequest,r)}static async melt(e,r,n,s){const o=n||E,c=s?{"Blind-auth":s}:{},u=await o({endpoint:_(e,"/v1/melt/bolt11"),method:"POST",requestBody:r,headers:c}),f=G(u);if(!T(f)||typeof f?.state!="string"||!Object.values(C).includes(f.state))throw new Error("bad response");return f}async melt(e){const r=await this.handleBlindAuth("/v1/melt/bolt11");return S.melt(this._mintUrl,e,this._customRequest,r)}static async check(e,r,n){const s=await(n||E)({endpoint:_(e,"/v1/checkstate"),method:"POST",requestBody:r});if(!T(s)||!Array.isArray(s?.states))throw new Error("bad response");return s}static async getKeys(e,r,n){r&&(r=r.replace(/\//g,"_").replace(/\+/g,"-"));const s=await(n||E)({endpoint:r?_(e,"/v1/keys",r):_(e,"/v1/keys")});if(!T(s)||!Array.isArray(s.keysets))throw new Error("bad response");return s}async getKeys(e,r){return await S.getKeys(r||this._mintUrl,e,this._customRequest)}static async getKeySets(e,r){return(r||E)({endpoint:_(e,"/v1/keysets")})}async getKeySets(){return S.getKeySets(this._mintUrl,this._customRequest)}async check(e){return S.check(this._mintUrl,e,this._customRequest)}static async restore(e,r,n){const s=await(n||E)({endpoint:_(e,"/v1/restore"),method:"POST",requestBody:r});if(!T(s)||!Array.isArray(s?.outputs)||!Array.isArray(s?.signatures))throw new Error("bad response");return s}async restore(e){return S.restore(this._mintUrl,e,this._customRequest)}async connectWebSocket(){if(this.ws)await this.ws.ensureConnection();else{const e=new URL(this._mintUrl),r="v1/ws";e.pathname&&(e.pathname.endsWith("/")?e.pathname+=r:e.pathname+="/"+r),this.ws=N.getInstance().getConnection(`${e.protocol==="https:"?"wss":"ws"}://${e.host}${e.pathname}`);try{await this.ws.connect()}catch(n){throw console.log(n),new Error("Failed to connect to WebSocket...")}}}disconnectWebSocket(){this.ws&&this.ws.close()}get webSocketConnection(){return this.ws}async handleBlindAuth(e){if(this._checkNut22&&(await this.getLazyMintInfo()).requiresBlindAuthToken(e)){if(!this._authTokenGetter)throw new Error("Can not call a protected endpoint without authProofGetter");return this._authTokenGetter()}}}const ve=t=>{try{return t instanceof Uint8Array&&(t=new TextDecoder().decode(t)),JSON.parse(t)}catch{throw new Error("can't parse secret")}},Ie=(t,e)=>{const r=sha256$5(new TextDecoder().decode(t));return schnorr$1.sign(r,e)},bt=(t,e)=>{let r=[],n="";if(e instanceof Array)for(const s of e)r.push({priv:s,pub:bytesToHex$4(schnorr$1.getPublicKey(s))});else n=e;return t.map(s=>{try{const o=ve(s.secret);if(o[0]!=="P2PK")throw new Error("unknown secret type");if(r.length){const c=r.find(u=>o[1].data===u.pub)?.priv;if(c)n=c;else throw new Error("no matching key found")}return Te(s,hexToBytes$6(n))}catch{return s}})},Te=(t,e)=>(t.witness||(t.witness={signatures:[bytesToHex$4(Ie(t.secret,e))]}),t);function V(t,e,r){const n=H(t);e||(e=Q(secp256k1$3.utils.randomPrivateKey()));const s=secp256k1$3.ProjectivePoint.BASE.multiply(e);return{B_:n.add(s),r:e,secret:t}}function Ke(t,e,r){return t.subtract(r.multiply(e))}function Me(t,e,r,n){const s=n,o=Ke(t.C_,e,s);return{id:t.id,amount:t.amount,secret:r,C:o}}const et=t=>({amount:t.amount,C:t.C.toHex(!0),id:t.id,secret:new TextDecoder().decode(t.secret),witness:JSON.stringify(t.witness)});function qe(t,e){let r=t;for(const s of e)r+=s.B_;const n=new TextEncoder().encode(r);return sha256$5(n)}function De(t,e,r){const n=qe(e,r),s=hexToBytes$7(t),o=schnorr$1.sign(n,s);return bytesToHex$5(o)}class J{constructor(e,r,n){this.amount=e,this.B_=r,this.id=n}getSerializedBlindedMessage(){return{amount:this.amount,B_:this.B_.toHex(!0),id:this.id}}}const Ue="m/129372'/0'",Be=(t,e,r)=>Nt(t,e,r,0),xe=(t,e,r)=>Nt(t,e,r,1),Nt=(t,e,r,n)=>{const s=HDKey$1.fromMasterSeed(t),o=Wt(e),c=`${Ue}/${o}'/${r}'/${n}`,u=s.derive(c);if(u.privateKey===null)throw new Error("Could not derive private key");return u.privateKey};function Y(t){return typeof t=="function"}class M{constructor(e,r,n){this.secret=n,this.blindingFactor=r,this.blindedMessage=e}toProof(e,r){let n;e.dleq&&(n={s:hexToBytes$7(e.dleq.s),e:hexToBytes$7(e.dleq.e),r:this.blindingFactor});const s={id:e.id,amount:e.amount,C_:B(e.C_)},o=B(r.keys[e.amount]),c=Me(s,this.blindingFactor,this.secret,o);return{...et(c),...n&&{dleq:{s:bytesToHex$5(n.s),e:bytesToHex$5(n.e),r:de(n.r??BigInt(0))}}}}static createP2PKData(e,r,n,s){return A(r,n.keys,s).map(o=>this.createSingleP2PKData(e,o,n.id))}static createSingleP2PKData(e,r,n){const s=["P2PK",{nonce:bytesToHex$5(randomBytes$4(32)),data:e.pubkey,tags:[]}];e.locktime&&s[1].tags.push(["locktime",e.locktime]),e.refundKeys&&s[1].tags.push(["refund",...e.refundKeys]);const o=JSON.stringify(s),c=new TextEncoder().encode(o),{r:u,B_:f}=V(c);return new M(new J(r,f,n).getSerializedBlindedMessage(),u,c)}static createRandomData(e,r,n){return A(e,r.keys,n).map(s=>this.createSingleRandomData(s,r.id))}static createSingleRandomData(e,r){const n=bytesToHex$5(randomBytes$4(32)),s=new TextEncoder().encode(n),{r:o,B_:c}=V(s);return new M(new J(e,c,r).getSerializedBlindedMessage(),o,s)}static createDeterministicData(e,r,n,s,o){return A(e,s.keys,o).map((c,u)=>this.createSingleDeterministicData(c,r,n+u,s.id))}static createSingleDeterministicData(e,r,n,s){const o=Be(r,s,n),c=bytesToHex$5(o),u=new TextEncoder().encode(c),f=he(xe(r,s,n)),{r:x,B_:p}=V(u,f);return new M(new J(e,p,s).getSerializedBlindedMessage(),x,u)}}const Ne=3,Oe="sat";class Ze{constructor(e,r){this._keys=new Map,this._keysets=[],this._seed=void 0,this._unit=Oe,this._mintInfo=void 0,this._denominationTarget=Ne,this.mint=e;let n=[];if(r?.keys&&!Array.isArray(r.keys)?n=[r.keys]:r?.keys&&Array.isArray(r?.keys)&&(n=r?.keys),n&&n.forEach(s=>this._keys.set(s.id,s)),r?.unit&&(this._unit=r?.unit),r?.keysets&&(this._keysets=r.keysets),r?.mintInfo&&(this._mintInfo=new tt(r.mintInfo)),r?.denominationTarget&&(this._denominationTarget=r.denominationTarget),r?.bip39seed){if(r.bip39seed instanceof Uint8Array){this._seed=r.bip39seed;return}throw new Error("bip39seed must be a valid UInt8Array")}r?.keepFactory&&(this._keepFactory=r.keepFactory)}get unit(){return this._unit}get keys(){return this._keys}get keysetId(){if(!this._keysetId)throw new Error("No keysetId set");return this._keysetId}set keysetId(e){this._keysetId=e}get keysets(){return this._keysets}get mintInfo(){if(!this._mintInfo)throw new Error("Mint info not loaded");return this._mintInfo}async getMintInfo(){const e=await this.mint.getInfo();return this._mintInfo=new tt(e),this._mintInfo}async lazyGetMintInfo(){return this._mintInfo?this._mintInfo:await this.getMintInfo()}async loadMint(){await this.getMintInfo(),await this.getKeySets(),await this.getKeys()}getActiveKeyset(e){let r=e.filter(s=>s.active);r=r.filter(s=>s.id.startsWith("00"));const n=r.sort((s,o)=>(s.input_fee_ppk??0)-(o.input_fee_ppk??0))[0];if(!n)throw new Error("No active keyset found");return n}async getKeySets(){const e=(await this.mint.getKeySets()).keysets.filter(r=>r.unit===this._unit);return this._keysets=e,this._keysets}async getAllKeys(){const e=await this.mint.getKeys();return e.keysets.forEach(r=>{if(!wt(r))throw new Error(`Couldn't verify keyset ID ${r.id}`)}),this._keys=new Map(e.keysets.map(r=>[r.id,r])),this.keysetId=this.getActiveKeyset(this._keysets).id,e.keysets}async getKeys(e,r){if((!(this._keysets.length>0)||r)&&await this.getKeySets(),e||(e=this.getActiveKeyset(this._keysets).id),!this._keysets.find(n=>n.id===e)&&(await this.getKeySets(),!this._keysets.find(n=>n.id===e)))throw new Error(`could not initialize keys. No keyset with id '${e}' found`);if(!this._keys.get(e)){const n=await this.mint.getKeys(e);if(!wt(n.keysets[0]))throw new Error(`Couldn't verify keyset ID ${n.keysets[0].id}`);this._keys.set(e,n.keysets[0])}return this.keysetId=e,this._keys.get(e)}async receive(e,r){const{requireDleq:n,keysetId:s,outputAmounts:o,counter:c,pubkey:u,privkey:f,outputData:x,p2pk:p}=r||{};typeof e=="string"&&(e=pe(e));const g=await this.getKeys(s);if(n&&e.proofs.some(Fe=>!Bt(Fe,g)))throw new Error("Token contains proofs with invalid DLEQ");const y=U(e.proofs)-this.getFeesForProofs(e.proofs);let b;x?b={send:x}:this._keepFactory&&(b={send:this._keepFactory});const R=this.createSwapPayload(y,e.proofs,g,o,c,u,f,b,p),{signatures:D}=await this.mint.swap(R.payload),k=R.outputData.map((Fe,O)=>Fe.toProof(D[O],g)),Re=[];return R.sortedIndices.forEach((Fe,O)=>{Re[Fe]=k[O]}),Re}async send(e,r,n){const{proofsWeHave:s,offline:o,includeFees:c,includeDleq:u,keysetId:f,outputAmounts:x,pubkey:p,privkey:g,outputData:y}=n||{};if(u&&(r=r.filter(k=>k.dleq!=null)),U(r)<e)throw new Error("Not enough funds available to send");const{keep:b,send:R}=this.selectProofsToSend(r,e,n?.includeFees),D=c?this.getFeesForProofs(R):0;if(!o&&(U(R)!=e+D||x||p||g||f||y)){const{keep:k,send:Re}=this.selectProofsToSend(r,e,!0);s?.push(...k);const Fe=await this.swap(e,Re,n);let{keep:O,send:$e}=Fe;const ze=Fe.serialized;return O=k.concat(O),u||($e=j($e)),{keep:O,send:$e,serialized:ze}}if(U(R)<e+D)throw new Error("Not enough funds available to send");return u?{keep:b,send:R}:{keep:b,send:j(R)}}selectProofsToSend(e,r,n){const s=e.sort((y,b)=>y.amount-b.amount),o=s.filter(y=>y.amount<=r).sort((y,b)=>b.amount-y.amount),c=s.filter(y=>y.amount>r).sort((y,b)=>y.amount-b.amount)[0];if(!o.length&&c)return{keep:e.filter(y=>y.secret!==c.secret),send:[c]};if(!o.length&&!c)return{keep:e,send:[]};let u=r,f=[o[0]];const x=[],p=n?this.getFeesForProofs(f):0;if(u-=f[0].amount-p/1e3,u>0){const{keep:y,send:b}=this.selectProofsToSend(o.slice(1),u,n);f.push(...b),x.push(...y)}const g=n?this.getFeesForProofs(f):0;return U(f)<r+g&&c&&(f=[c]),{keep:e.filter(y=>!f.includes(y)),send:f}}getFeesForProofs(e){if(!this._keysets.length)throw new Error("Could not calculate fees. No keysets found");return new Set(e.map(r=>r.id)).forEach(r=>{if(!this._keysets.find(n=>n.id===r))throw new Error(`Could not calculate fees. No keyset found with id: ${r}`)}),Math.floor(Math.max((e.reduce((r,n)=>r+(this._keysets.find(s=>s.id===n.id)?.input_fee_ppk||0),0)+999)/1e3,0))}getFeesForKeyset(e,r){return Math.floor(Math.max((e*(this._keysets.find(n=>n.id===r)?.input_fee_ppk||0)+999)/1e3,0))}async swap(e,r,n){let{outputAmounts:s}=n||{};const{includeFees:o,keysetId:c,counter:u,pubkey:f,privkey:x,proofsWeHave:p,outputData:g,p2pk:y}=n||{},b=await this.getKeys(c),R=r;let D=e;const k=U(r);let Re=k-D-this.getFeesForProofs(R),Fe=s?.sendAmounts||A(D,b.keys);if(o){let I=this.getFeesForKeyset(Fe.length,b.id),Ce=A(I,b.keys);for(;this.getFeesForKeyset(Fe.concat(Ce).length,b.id)>I;)I++,Ce=A(I,b.keys);Fe=Fe.concat(Ce),D+=I,Re-=I}let O;if(!s?.keepAmounts&&p)O=mt(p,Re,b.keys,this._denominationTarget);else if(s){if(s.keepAmounts?.reduce((I,Ce)=>I+Ce,0)!=Re)throw new Error("Keep amounts do not match amount to keep");O=s.keepAmounts}if(D+this.getFeesForProofs(R)>k)throw console.error(`Not enough funds available (${k}) for swap amountToSend: ${D} + fee: ${this.getFeesForProofs(R)} | length: ${R.length}`),new Error("Not enough funds available for swap");if(D+this.getFeesForProofs(R)+Re!=k)throw new Error("Amounts do not match for swap");s={keepAmounts:O,sendAmounts:Fe};const $e=g?.keep||this._keepFactory,ze=g?.send,q=this.createSwapPayload(D,R,b,s,u,f,x,{keep:$e,send:ze},y),{signatures:W}=await this.mint.swap(q.payload),We=q.outputData.map((I,Ce)=>I.toProof(W[Ce],b)),Xe=[],it=[],Ve=Array(q.keepVector.length),v=Array(We.length);return q.sortedIndices.forEach((I,Ce)=>{Ve[I]=q.keepVector[Ce],v[I]=We[Ce]}),v.forEach((I,Ce)=>{Ve[Ce]?Xe.push(I):it.push(I)}),{keep:Xe,send:it}}async batchRestore(e=300,r=100,n=0,s){const o=Math.ceil(e/r),c=[];let u,f=0;for(;f<o;){const x=await this.restore(n,r,{keysetId:s});x.proofs.length>0?(f=0,c.push(...x.proofs),u=x.lastCounterWithSignature):f++,n+=r}return{proofs:c,lastCounterWithSignature:u}}async restore(e,r,n){const{keysetId:s}=n||{},o=await this.getKeys(s);if(!this._seed)throw new Error("CashuWallet must be initialized with a seed to use restore");const c=Array(r).fill(1),u=M.createDeterministicData(c.length,this._seed,e,o,c),{outputs:f,signatures:x}=await this.mint.restore({outputs:u.map(b=>b.blindedMessage)}),p={};f.forEach((b,R)=>p[b.B_]=x[R]);const g=[];let y;for(let b=0;b<u.length;b++){const R=p[u[b].blindedMessage.B_];R&&(y=e+b,u[b].blindedMessage.amount=R.amount,g.push(u[b].toProof(R,o)))}return{proofs:g,lastCounterWithSignature:y}}async createMintQuote(e,r){const n={unit:this._unit,amount:e,description:r},s=await this.mint.createMintQuote(n);return{...s,amount:s.amount||e,unit:s.unit||this.unit}}async createLockedMintQuote(e,r,n){const{supported:s}=(await this.getMintInfo()).isSupported(20);if(!s)throw new Error("Mint does not support NUT-20");const o={unit:this._unit,amount:e,description:n,pubkey:r},c=await this.mint.createMintQuote(o);if(typeof c.pubkey!="string")throw new Error("Mint returned unlocked mint quote");{const u=c.pubkey;return{...c,pubkey:u,amount:c.amount||e,unit:c.unit||this.unit}}}async checkMintQuote(e){const r=typeof e=="string"?e:e.quote,n=await this.mint.checkMintQuote(r);return typeof e=="string"?n:{...n,amount:n.amount||e.amount,unit:n.unit||e.unit}}async mintProofs(e,r,n){let{outputAmounts:s}=n||{};const{counter:o,pubkey:c,p2pk:u,keysetId:f,proofsWeHave:x,outputData:p,privateKey:g}=n||{},y=await this.getKeys(f);!s&&x&&(s={keepAmounts:mt(x,e,y.keys,this._denominationTarget),sendAmounts:[]});let b=[];if(p)if(Y(p)){const k=A(e,y.keys,s?.keepAmounts);for(let Re=0;Re<k.length;Re++)b.push(p(k[Re],y))}else b=p;else if(this._keepFactory){const k=A(e,y.keys,s?.keepAmounts);for(let Re=0;Re<k.length;Re++)b.push(this._keepFactory(k[Re],y))}else b=this.createOutputData(e,y,o,c,s?.keepAmounts,u);let R;if(typeof r!="string"){if(!g)throw new Error("Can not sign locked quote without private key");const k=b.map(Fe=>Fe.blindedMessage),Re=De(g,r.quote,k);R={outputs:k,quote:r.quote,signature:Re}}else R={outputs:b.map(k=>k.blindedMessage),quote:r};const{signatures:D}=await this.mint.mint(R);return b.map((k,Re)=>k.toProof(D[Re],y))}async createMeltQuote(e){const r={unit:this._unit,request:e},n=await this.mint.createMeltQuote(r);return{...n,unit:n.unit||this.unit,request:n.request||e}}async createMultiPathMeltQuote(e,r){const{supported:n,params:s}=(await this.lazyGetMintInfo()).isSupported(15);if(!n)throw new Error("Mint does not support NUT-15");if(!s?.some(u=>u.method==="bolt11"&&u.unit===this.unit))throw new Error(`Mint does not support MPP for bolt11 and ${this.unit}`);const o={mpp:{amount:r}},c={unit:this._unit,request:e,options:o};return{...await this.mint.createMeltQuote(c),request:e,unit:this._unit}}async checkMeltQuote(e){const r=typeof e=="string"?e:e.quote,n=await this.mint.checkMeltQuote(r);return typeof e=="string"?n:{...n,request:e.request,unit:e.unit}}async meltProofs(e,r,n){const{keysetId:s,counter:o,privkey:c}=n||{},u=await this.getKeys(s),f=this.createBlankOutputs(U(r)-e.amount,u,o,this._keepFactory);c!=null&&(r=bt(r.map(g=>({amount:g.amount,C:B(g.C),id:g.id,secret:new TextEncoder().encode(g.secret)})),c).map(g=>et(g))),r=j(r);const x={quote:e.quote,inputs:r,outputs:f.map(g=>g.blindedMessage)},p=await this.mint.melt(x);return{quote:{...p,unit:e.unit,request:e.request},change:p.change?.map((g,y)=>f[y].toProof(g,u))??[]}}createSwapPayload(e,r,n,s,o,c,u,f,x){const p=r.reduce((O,$e)=>O+$e.amount,0);s&&s.sendAmounts&&!s.keepAmounts&&(s.keepAmounts=A(p-e-this.getFeesForProofs(r),n.keys));const g=p-e-this.getFeesForProofs(r);let y=[],b=[];if(f?.keep)if(Y(f.keep)){const O=f.keep;A(g,n.keys).forEach($e=>{y.push(O($e,n))})}else y=f.keep;else y=this.createOutputData(g,n,o,void 0,s?.keepAmounts,void 0,this._keepFactory);if(f?.send)if(Y(f.send)){const O=f.send;A(e,n.keys).forEach($e=>{b.push(O($e,n))})}else b=f.send;else b=this.createOutputData(e,n,o?o+y.length:void 0,c,s?.sendAmounts,x);u&&(r=bt(r.map(O=>({amount:O.amount,C:B(O.C),id:O.id,secret:new TextEncoder().encode(O.secret)})),u).map(O=>et(O))),r=j(r);const R=[...y,...b],D=R.map((O,$e)=>$e).sort((O,$e)=>R[O].blindedMessage.amount-R[$e].blindedMessage.amount),k=[...Array(y.length).fill(!0),...Array(b.length).fill(!1)],Re=D.map(O=>R[O]),Fe=D.map(O=>k[O]);return{payload:{inputs:r,outputs:Re.map(O=>O.blindedMessage)},outputData:Re,keepVector:Fe,sortedIndices:D}}async checkProofsStates(e){const r=new TextEncoder,n=e.map(c=>H(r.encode(c.secret)).toHex(!0)),s=100,o=[];for(let c=0;c<n.length;c+=s){const u=n.slice(c,c+s),{states:f}=await this.mint.check({Ys:u}),x={};f.forEach(p=>{x[p.Y]=p});for(let p=0;p<u.length;p++){const g=x[u[p]];if(!g)throw new Error("Could not find state for proof with Y: "+u[p]);o.push(g)}}return o}async onMintQuoteUpdates(e,r,n){if(await this.mint.connectWebSocket(),!this.mint.webSocketConnection)throw new Error("failed to establish WebSocket connection.");const s=this.mint.webSocketConnection.createSubscription({kind:"bolt11_mint_quote",filters:e},r,n);return()=>{this.mint.webSocketConnection?.cancelSubscription(s,r)}}async onMeltQuotePaid(e,r,n){return this.onMeltQuoteUpdates([e],s=>{s.state===C.PAID&&r(s)},n)}async onMintQuotePaid(e,r,n){return this.onMintQuoteUpdates([e],s=>{s.state===Z.PAID&&r(s)},n)}async onMeltQuoteUpdates(e,r,n){if(await this.mint.connectWebSocket(),!this.mint.webSocketConnection)throw new Error("failed to establish WebSocket connection.");const s=this.mint.webSocketConnection.createSubscription({kind:"bolt11_melt_quote",filters:e},r,n);return()=>{this.mint.webSocketConnection?.cancelSubscription(s,r)}}async onProofStateUpdates(e,r,n){if(await this.mint.connectWebSocket(),!this.mint.webSocketConnection)throw new Error("failed to establish WebSocket connection.");const s=new TextEncoder,o={};for(let f=0;f<e.length;f++){const x=H(s.encode(e[f].secret)).toHex(!0);o[x]=e[f]}const c=Object.keys(o),u=this.mint.webSocketConnection.createSubscription({kind:"proof_state",filters:c},f=>{r({...f,proof:o[f.Y]})},n);return()=>{this.mint.webSocketConnection?.cancelSubscription(u,r)}}createOutputData(e,r,n,s,o,c,u){let f;if(s)f=M.createP2PKData({pubkey:s},e,r,o);else if(n||n===0){if(!this._seed)throw new Error("cannot create deterministic messages without seed");f=M.createDeterministicData(e,this._seed,n,r,o)}else c?f=M.createP2PKData(c,e,r,o):u?f=A(e,r.keys).map(x=>u(x,r)):f=M.createRandomData(e,r,o);return f}createBlankOutputs(e,r,n,s){let o=Math.ceil(Math.log2(e))||1;o<0&&(o=0);const c=o?Array(o).fill(1):[];return this.createOutputData(c.length,r,n,void 0,c,void 0,s)}}let publishTimer=null;const useEcashStore=create()((t,e)=>({mints:{},proofs:[],history:[],discoveredMints:{},pendingSends:[],addMint:(r,n)=>t(s=>({mints:{...s.mints,[r]:{url:r,keys:n,active:!0}}})),removeMint:r=>t(n=>{const{[r]:s,...o}=n.mints;return{mints:o}}),addProofs:(r,n=!1)=>{t(s=>{const o=new Set(s.proofs.map(u=>u.secret)),c=r.filter(u=>!o.has(u.secret));return{proofs:[...s.proofs,...c]}}),n||e().publishProofsToNostr()},removeProofs:(r,n=!1)=>{t(s=>{const o=new Set(r.map(c=>c.secret));return{proofs:s.proofs.filter(c=>!o.has(c.secret))}}),n||e().publishProofsToNostr()},mergeWalletState:r=>{const n=new Set(e().proofs.map(u=>u.secret)),s=r.proofs.filter(u=>!n.has(u.secret)),o=new Set(e().history.map(u=>u.id)),c=r.history.filter(u=>!o.has(u.id));s.length>0||c.length>0?(console.log(` Merging ${s.length} new proofs + ${c.length} new history entries from NIP-60`),t(u=>({proofs:[...u.proofs,...s],history:[...c,...u.history]}))):console.log(" All NIP-60 wallet state already present")},addHistoryItem:r=>t(n=>n.history.some(s=>s.id===r.id)?(console.log(` Skipping duplicate history entry: ${r.id}`),n):{history:[r,...n.history]}),addPendingSend:r=>t(n=>({pendingSends:[...n.pendingSends,r]})),removePendingSend:r=>t(n=>({pendingSends:n.pendingSends.filter(s=>s.id!==r)})),updatePendingSendAttempt:(r,n)=>t(s=>({pendingSends:s.pendingSends.map(o=>o.id===r?{...o,attempts:o.attempts+1,lastError:n}:o)})),addDiscoveredMint:r=>t(n=>n.discoveredMints[r.url]?n:{discoveredMints:{...n.discoveredMints,[r.url]:r}}),updateMintStatus:(r,n)=>t(s=>{const o=s.discoveredMints[r];return o?{discoveredMints:{...s.discoveredMints,[r]:{...o,status:n}}}:s}),updateMintTrust:(r,n)=>t(s=>{const o=s.discoveredMints[r];return o?{discoveredMints:{...s.discoveredMints,[r]:{...o,trustScore:o.trustScore+n,reviews:o.reviews+1}}}:s}),getBalance:()=>{const{proofs:r}=e();return r.reduce((n,s)=>n+s.amount,0)},getMintBalance:r=>{const{proofs:n}=e();return n.reduce((s,o)=>s+o.amount,0)},publishProofsToNostr:async(r=!1)=>{publishTimer&&clearTimeout(publishTimer),publishTimer=setTimeout(async()=>{try{const{useAuthStore:n}=await __vitePreload(async()=>{const{useAuthStore:R}=await Promise.resolve().then(()=>auth);return{useAuthStore:R}},void 0,import.meta.url),{Nip60Service:s}=await __vitePreload(async()=>{const{Nip60Service:R}=await Promise.resolve().then(()=>nip61);return{Nip60Service:R}},void 0,import.meta.url),o=(await __vitePreload(async()=>{const{default:R}=await Promise.resolve().then(()=>index$1);return{default:R}},void 0,import.meta.url)).default,{NDKPrivateKeySigner:c}=await __vitePreload(async()=>{const{NDKPrivateKeySigner:R}=await Promise.resolve().then(()=>index$1);return{NDKPrivateKeySigner:R}},void 0,import.meta.url),{decryptedKey:u,publicKey:f}=n.getState(),{proofs:x,history:p}=e();if(!u||!f){console.log(" Skipping NIP-60 publish (wallet locked)");return}console.log(` Publishing ${x.length} proofs + ${p.length} history entries to Nostr...`);const g=new o({explicitRelayUrls:["wss://relay.damus.io","wss://nos.lol","wss://relay.nostr.band","wss://relay.primal.net","wss://relay.snort.social","wss://purplepag.es"],signer:new c(u)});await g.connect(2e3);let y=[...x],b=[...p];if(r)console.log(" Skipping merge, publishing current state directly (consolidation mode)");else{console.log(" Fetching existing NIP-60 state from Nostr...");const R=await g.fetchEvents({kinds:[30078],authors:[f],"#d":["proofs"]});if(R.size>0){console.log(` Found ${R.size} existing NIP-60 event(s), merging all...`);for(const Re of R)try{const Fe=await s.decryptWalletState(Re.content,u,f),O=new Set(y.map(W=>W.secret)),$e=Fe.proofs.filter(W=>!O.has(W.secret));y=[...y,...$e];const ze=new Set(b.map(W=>W.id)),q=Fe.history.filter(W=>!ze.has(W.id));b=[...b,...q],($e.length>0||q.length>0)&&console.log(`   Event ${Re.id.substring(0,8)}: +${$e.length} proofs, +${q.length} history`)}catch(Fe){console.error(` Failed to decrypt event ${Re.id.substring(0,8)}:`,Fe)}const D=y.length-x.length,k=b.length-p.length;console.log(` Total merged: ${y.length} proofs (+${D} from Nostr), ${b.length} history (+${k} from Nostr)`)}else console.log(" No existing NIP-60 event found, publishing fresh state")}await s.publishWalletState(g,{proofs:y,history:b},u,f),!r&&y.length>x.length&&(console.log(` Updating local state with ${y.length-x.length} proofs from Nostr`),t({proofs:y,history:b}))}catch(n){console.error("Failed to publish wallet state to Nostr:",n)}},2e3)},reset:()=>t({mints:{},proofs:[],history:[],discoveredMints:{}}),saveSession:r=>{const n=e(),s={mints:n.mints,proofs:n.proofs,history:n.history,discoveredMints:n.discoveredMints,pendingSends:n.pendingSends};localStorage.setItem(`ecash-backup-${r}`,JSON.stringify(s)),console.log(` Saved eCash session for ${r.slice(0,8)}`)},loadSession:r=>{const n=localStorage.getItem(`ecash-backup-${r}`);if(n)try{const s=JSON.parse(n);t({mints:s.mints||{},proofs:s.proofs||[],history:s.history||[],discoveredMints:s.discoveredMints||{},pendingSends:s.pendingSends||[]}),console.log(` Loaded eCash session for ${r.slice(0,8)}`)}catch(s){console.error("Failed to load session:",s),e().reset()}else console.log(` New session for ${r.slice(0,8)}`),e().reset()}})),useAuthStore=create()(persist((t,e)=>({encryptedKey:null,publicKey:null,isUnlocked:!1,decryptedKey:null,password:null,setEncryptedKey:(r,n)=>t({encryptedKey:r,publicKey:n}),unlock:(r,n,s)=>t({isUnlocked:!0,decryptedKey:r,publicKey:n,password:s||null}),lock:()=>t({isUnlocked:!1,decryptedKey:null,password:null}),logout:()=>{const{publicKey:r}=e();r&&useEcashStore.getState().saveSession(r),useEcashStore.getState().reset(),t({encryptedKey:null,publicKey:null,isUnlocked:!1,decryptedKey:null,password:null})}}),{name:"amber-auth-storage",partialize:t=>({encryptedKey:t.encryptedKey,publicKey:t.publicKey})})),auth=Object.freeze(Object.defineProperty({__proto__:null,useAuthStore},Symbol.toStringTag,{value:"Module"})),useWalletStore=create()(persist((t,e)=>({wallets:[],currentWalletId:null,currentKeypairId:null,addWallet:r=>t(n=>({wallets:[...n.wallets,r]})),removeWallet:r=>t(n=>({wallets:n.wallets.filter(s=>s.id!==r),currentWalletId:n.currentWalletId===r?null:n.currentWalletId})),updateWallet:(r,n)=>t(s=>({wallets:s.wallets.map(o=>o.id===r?{...o,...n}:o)})),getWallet:r=>e().wallets.find(n=>n.id===r),setCurrentWallet:r=>t(n=>{const o=n.wallets.find(c=>c.id===r)?.keypairs[0]?.id||null;return{currentWalletId:r,currentKeypairId:o}}),setCurrentKeypair:r=>t({currentKeypairId:r}),addKeypair:(r,n)=>t(s=>({wallets:s.wallets.map(o=>o.id===r?{...o,keypairs:[...o.keypairs,n]}:o)})),removeKeypair:(r,n)=>t(s=>({wallets:s.wallets.map(o=>o.id===r?{...o,keypairs:o.keypairs.filter(c=>c.id!==n)}:o),currentKeypairId:s.currentKeypairId===n?null:s.currentKeypairId})),updateKeypair:(r,n,s)=>t(o=>({wallets:o.wallets.map(c=>c.id===r?{...c,keypairs:c.keypairs.map(u=>u.id===n?{...u,...s}:u)}:c)})),getKeypair:r=>{for(const n of e().wallets){const s=n.keypairs.find(o=>o.id===r);if(s)return s}},getCurrentKeypair:()=>{const{currentKeypairId:r}=e();if(r)return e().getKeypair(r)}}),{name:"wallet-storage",storage:createJSONStorage(()=>({getItem:async t=>{const{storage:e}=await __vitePreload(async()=>{const{storage:r}=await import("./storage-D7x1dBXQ.js");return{storage:r}},[],import.meta.url);return e.getItem(t)},setItem:async(t,e)=>{const{storage:r}=await __vitePreload(async()=>{const{storage:n}=await import("./storage-D7x1dBXQ.js");return{storage:n}},[],import.meta.url);return r.setItem(t,e)},removeItem:async t=>{const{storage:e}=await __vitePreload(async()=>{const{storage:r}=await import("./storage-D7x1dBXQ.js");return{storage:r}},[],import.meta.url);return e.removeItem(t)}}))}));function isBytes$4(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function anumber$3(t,e=""){if(!Number.isSafeInteger(t)||t<0){const r=e&&`"${e}" `;throw new Error(`${r}expected integer >= 0, got ${t}`)}}function abytes$1(t,e,r=""){const n=isBytes$4(t),s=t?.length,o=e!==void 0;if(!n||o&&s!==e){const c=r&&`"${r}" `,u=o?` of length ${e}`:"",f=n?`length=${s}`:`type=${typeof t}`;throw new Error(c+"expected Uint8Array"+u+", got "+f)}return t}function ahash$1(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash must wrapped by utils.createHasher");anumber$3(t.outputLen),anumber$3(t.blockLen)}function aexists$1(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function aoutput$1(t,e){abytes$1(t,void 0,"digestInto() output");const r=e.outputLen;if(t.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}function clean$1(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function createView$4(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function rotr$3(t,e){return t<<32-e|t>>>e}function utf8ToBytes$4(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function kdfInputToBytes(t,e=""){return typeof t=="string"?utf8ToBytes$4(t):abytes$1(t,void 0,e)}function checkOpts$2(t,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options must be object or undefined");return Object.assign(t,e)}function createHasher$1(t,e={}){const r=(s,o)=>t(o).update(s).digest(),n=t(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=s=>t(s),Object.assign(r,e),Object.freeze(r)}function randomBytes$3(t=32){const e=typeof globalThis=="object"?globalThis.crypto:null;if(typeof e?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return e.getRandomValues(new Uint8Array(t))}const oidNist$1=t=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,t])});let _HMAC$1=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(e,r){if(ahash$1(e),abytes$1(r,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(r.length>n?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),clean$1(s)}update(e){return aexists$1(this),this.iHash.update(e),this}digestInto(e){aexists$1(this),abytes$1(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});const{oHash:r,iHash:n,finished:s,destroyed:o,blockLen:c,outputLen:u}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=c,e.outputLen=u,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$4=(t,e,r)=>new _HMAC$1(t,e).update(r).digest();hmac$4.create=(t,e)=>new _HMAC$1(t,e);function pbkdf2Init$1(t,e,r,n){ahash$1(t);const s=checkOpts$2({dkLen:32,asyncTick:10},n),{c:o,dkLen:c,asyncTick:u}=s;if(anumber$3(o,"c"),anumber$3(c,"dkLen"),anumber$3(u,"asyncTick"),o<1)throw new Error("iterations (c) must be >= 1");const f=kdfInputToBytes(e,"password"),x=kdfInputToBytes(r,"salt"),p=new Uint8Array(c),g=hmac$4.create(t,f),y=g._cloneInto().update(x);return{c:o,dkLen:c,asyncTick:u,DK:p,PRF:g,PRFSalt:y}}function pbkdf2Output$1(t,e,r,n,s){return t.destroy(),e.destroy(),n&&n.destroy(),clean$1(s),r}function pbkdf2$1(t,e,r,n){const{c:s,dkLen:o,DK:c,PRF:u,PRFSalt:f}=pbkdf2Init$1(t,e,r,n);let x;const p=new Uint8Array(4),g=createView$4(p),y=new Uint8Array(u.outputLen);for(let b=1,R=0;R<o;b++,R+=u.outputLen){const D=c.subarray(R,R+u.outputLen);g.setInt32(0,b,!1),(x=f._cloneInto(x)).update(p).digestInto(y),D.set(y.subarray(0,D.length));for(let k=1;k<s;k++){u._cloneInto(x).update(y).digestInto(y);for(let Re=0;Re<D.length;Re++)D[Re]^=y[Re]}}return pbkdf2Output$1(u,f,c,x,y)}function Chi$3(t,e,r){return t&e^~t&r}function Maj$3(t,e,r){return t&e^t&r^e&r}let HashMD$1=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(e,r,n,s){this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=createView$4(this.buffer)}update(e){aexists$1(this),abytes$1(e);const{view:r,buffer:n,blockLen:s}=this,o=e.length;for(let c=0;c<o;){const u=Math.min(s-this.pos,o-c);if(u===s){const f=createView$4(e);for(;s<=o-c;c+=s)this.process(f,c);continue}n.set(e.subarray(c,c+u),this.pos),this.pos+=u,c+=u,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){aexists$1(this),aoutput$1(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:o}=this;let{pos:c}=this;r[c++]=128,clean$1(this.buffer.subarray(c)),this.padOffset>s-c&&(this.process(n,0),c=0);for(let g=c;g<s;g++)r[g]=0;n.setBigUint64(s-8,BigInt(this.length*8),o),this.process(n,0);const u=createView$4(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const x=f/4,p=this.get();if(x>p.length)throw new Error("_sha2: outputLen bigger than state");for(let g=0;g<x;g++)u.setUint32(4*g,p[g],o)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||=new this.constructor,e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:o,destroyed:c,pos:u}=this;return e.destroyed=c,e.finished=o,e.length=s,e.pos=u,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const SHA256_IV$1=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA512_IV$1=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),U32_MASK64$1=BigInt(2**32-1),_32n$1=BigInt(32);function fromBig$1(t,e=!1){return e?{h:Number(t&U32_MASK64$1),l:Number(t>>_32n$1&U32_MASK64$1)}:{h:Number(t>>_32n$1&U32_MASK64$1)|0,l:Number(t&U32_MASK64$1)|0}}function split$1(t,e=!1){const r=t.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let o=0;o<r;o++){const{h:c,l:u}=fromBig$1(t[o],e);[n[o],s[o]]=[c,u]}return[n,s]}const shrSH$1=(t,e,r)=>t>>>r,shrSL$1=(t,e,r)=>t<<32-r|e>>>r,rotrSH$1=(t,e,r)=>t>>>r|e<<32-r,rotrSL$1=(t,e,r)=>t<<32-r|e>>>r,rotrBH$1=(t,e,r)=>t<<64-r|e>>>r-32,rotrBL$1=(t,e,r)=>t>>>r-32|e<<64-r;function add$1(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const add3L$1=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),add3H$1=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,add4L$1=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),add4H$1=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,add5L$1=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),add5H$1=(t,e,r,n,s,o)=>e+r+n+s+o+(t/2**32|0)|0,SHA256_K$3=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W$3=new Uint32Array(64);let SHA2_32B$1=class extends HashMD$1{constructor(e){super(64,e,8,!1)}get(){const{A:e,B:r,C:n,D:s,E:o,F:c,G:u,H:f}=this;return[e,r,n,s,o,c,u,f]}set(e,r,n,s,o,c,u,f){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=o|0,this.F=c|0,this.G=u|0,this.H=f|0}process(e,r){for(let g=0;g<16;g++,r+=4)SHA256_W$3[g]=e.getUint32(r,!1);for(let g=16;g<64;g++){const y=SHA256_W$3[g-15],b=SHA256_W$3[g-2],R=rotr$3(y,7)^rotr$3(y,18)^y>>>3,D=rotr$3(b,17)^rotr$3(b,19)^b>>>10;SHA256_W$3[g]=D+SHA256_W$3[g-7]+R+SHA256_W$3[g-16]|0}let{A:n,B:s,C:o,D:c,E:u,F:f,G:x,H:p}=this;for(let g=0;g<64;g++){const y=rotr$3(u,6)^rotr$3(u,11)^rotr$3(u,25),b=p+y+Chi$3(u,f,x)+SHA256_K$3[g]+SHA256_W$3[g]|0,D=(rotr$3(n,2)^rotr$3(n,13)^rotr$3(n,22))+Maj$3(n,s,o)|0;p=x,x=f,f=u,u=c+b|0,c=o,o=s,s=n,n=b+D|0}n=n+this.A|0,s=s+this.B|0,o=o+this.C|0,c=c+this.D|0,u=u+this.E|0,f=f+this.F|0,x=x+this.G|0,p=p+this.H|0,this.set(n,s,o,c,u,f,x,p)}roundClean(){clean$1(SHA256_W$3)}destroy(){this.set(0,0,0,0,0,0,0,0),clean$1(this.buffer)}},_SHA256$1=class extends SHA2_32B$1{A=SHA256_IV$1[0]|0;B=SHA256_IV$1[1]|0;C=SHA256_IV$1[2]|0;D=SHA256_IV$1[3]|0;E=SHA256_IV$1[4]|0;F=SHA256_IV$1[5]|0;G=SHA256_IV$1[6]|0;H=SHA256_IV$1[7]|0;constructor(){super(32)}};const K512$1=split$1(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),SHA512_Kh$1=K512$1[0],SHA512_Kl$1=K512$1[1],SHA512_W_H$1=new Uint32Array(80),SHA512_W_L$1=new Uint32Array(80);let SHA2_64B$1=class extends HashMD$1{constructor(e){super(128,e,16,!1)}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:o,Cl:c,Dh:u,Dl:f,Eh:x,El:p,Fh:g,Fl:y,Gh:b,Gl:R,Hh:D,Hl:k}=this;return[e,r,n,s,o,c,u,f,x,p,g,y,b,R,D,k]}set(e,r,n,s,o,c,u,f,x,p,g,y,b,R,D,k){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=o|0,this.Cl=c|0,this.Dh=u|0,this.Dl=f|0,this.Eh=x|0,this.El=p|0,this.Fh=g|0,this.Fl=y|0,this.Gh=b|0,this.Gl=R|0,this.Hh=D|0,this.Hl=k|0}process(e,r){for(let O=0;O<16;O++,r+=4)SHA512_W_H$1[O]=e.getUint32(r),SHA512_W_L$1[O]=e.getUint32(r+=4);for(let O=16;O<80;O++){const $e=SHA512_W_H$1[O-15]|0,ze=SHA512_W_L$1[O-15]|0,q=rotrSH$1($e,ze,1)^rotrSH$1($e,ze,8)^shrSH$1($e,ze,7),W=rotrSL$1($e,ze,1)^rotrSL$1($e,ze,8)^shrSL$1($e,ze,7),We=SHA512_W_H$1[O-2]|0,Xe=SHA512_W_L$1[O-2]|0,it=rotrSH$1(We,Xe,19)^rotrBH$1(We,Xe,61)^shrSH$1(We,Xe,6),Ve=rotrSL$1(We,Xe,19)^rotrBL$1(We,Xe,61)^shrSL$1(We,Xe,6),v=add4L$1(W,Ve,SHA512_W_L$1[O-7],SHA512_W_L$1[O-16]),I=add4H$1(v,q,it,SHA512_W_H$1[O-7],SHA512_W_H$1[O-16]);SHA512_W_H$1[O]=I|0,SHA512_W_L$1[O]=v|0}let{Ah:n,Al:s,Bh:o,Bl:c,Ch:u,Cl:f,Dh:x,Dl:p,Eh:g,El:y,Fh:b,Fl:R,Gh:D,Gl:k,Hh:Re,Hl:Fe}=this;for(let O=0;O<80;O++){const $e=rotrSH$1(g,y,14)^rotrSH$1(g,y,18)^rotrBH$1(g,y,41),ze=rotrSL$1(g,y,14)^rotrSL$1(g,y,18)^rotrBL$1(g,y,41),q=g&b^~g&D,W=y&R^~y&k,We=add5L$1(Fe,ze,W,SHA512_Kl$1[O],SHA512_W_L$1[O]),Xe=add5H$1(We,Re,$e,q,SHA512_Kh$1[O],SHA512_W_H$1[O]),it=We|0,Ve=rotrSH$1(n,s,28)^rotrBH$1(n,s,34)^rotrBH$1(n,s,39),v=rotrSL$1(n,s,28)^rotrBL$1(n,s,34)^rotrBL$1(n,s,39),I=n&o^n&u^o&u,Ce=s&c^s&f^c&f;Re=D|0,Fe=k|0,D=b|0,k=R|0,b=g|0,R=y|0,{h:g,l:y}=add$1(x|0,p|0,Xe|0,it|0),x=u|0,p=f|0,u=o|0,f=c|0,o=n|0,c=s|0;const P=add3L$1(it,v,Ce);n=add3H$1(P,Xe,Ve,I),s=P|0}({h:n,l:s}=add$1(this.Ah|0,this.Al|0,n|0,s|0)),{h:o,l:c}=add$1(this.Bh|0,this.Bl|0,o|0,c|0),{h:u,l:f}=add$1(this.Ch|0,this.Cl|0,u|0,f|0),{h:x,l:p}=add$1(this.Dh|0,this.Dl|0,x|0,p|0),{h:g,l:y}=add$1(this.Eh|0,this.El|0,g|0,y|0),{h:b,l:R}=add$1(this.Fh|0,this.Fl|0,b|0,R|0),{h:D,l:k}=add$1(this.Gh|0,this.Gl|0,D|0,k|0),{h:Re,l:Fe}=add$1(this.Hh|0,this.Hl|0,Re|0,Fe|0),this.set(n,s,o,c,u,f,x,p,g,y,b,R,D,k,Re,Fe)}roundClean(){clean$1(SHA512_W_H$1,SHA512_W_L$1)}destroy(){clean$1(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},_SHA512$1=class extends SHA2_64B$1{Ah=SHA512_IV$1[0]|0;Al=SHA512_IV$1[1]|0;Bh=SHA512_IV$1[2]|0;Bl=SHA512_IV$1[3]|0;Ch=SHA512_IV$1[4]|0;Cl=SHA512_IV$1[5]|0;Dh=SHA512_IV$1[6]|0;Dl=SHA512_IV$1[7]|0;Eh=SHA512_IV$1[8]|0;El=SHA512_IV$1[9]|0;Fh=SHA512_IV$1[10]|0;Fl=SHA512_IV$1[11]|0;Gh=SHA512_IV$1[12]|0;Gl=SHA512_IV$1[13]|0;Hh=SHA512_IV$1[14]|0;Hl=SHA512_IV$1[15]|0;constructor(){super(64)}};const sha256$4=createHasher$1(()=>new _SHA256$1,oidNist$1(1)),sha512$2=createHasher$1(()=>new _SHA512$1,oidNist$1(3));function isBytes$3(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function isArrayOf$1(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function afn$1(t){if(typeof t!="function")throw new Error("function expected");return!0}function astr$1(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function anumber$2(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function aArr$1(t){if(!Array.isArray(t))throw new Error("array expected")}function astrArr$1(t,e){if(!isArrayOf$1(!0,e))throw new Error(`${t}: array of strings expected`)}function anumArr$1(t,e){if(!isArrayOf$1(!1,e))throw new Error(`${t}: array of numbers expected`)}function chain$2(...t){const e=o=>o,r=(o,c)=>u=>o(c(u)),n=t.map(o=>o.encode).reduceRight(r,e),s=t.map(o=>o.decode).reduce(r,e);return{encode:n,decode:s}}function alphabet$2(t){const e=typeof t=="string"?t.split(""):t,r=e.length;astrArr$1("alphabet",e);const n=new Map(e.map((s,o)=>[s,o]));return{encode:s=>(aArr$1(s),s.map(o=>{if(!Number.isSafeInteger(o)||o<0||o>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${o}". Allowed: ${t}`);return e[o]})),decode:s=>(aArr$1(s),s.map(o=>{astr$1("alphabet.decode",o);const c=n.get(o);if(c===void 0)throw new Error(`Unknown letter: "${o}". Allowed: ${t}`);return c}))}}function join$2(t=""){return astr$1("join",t),{encode:e=>(astrArr$1("join.decode",e),e.join(t)),decode:e=>(astr$1("join.decode",e),e.split(t))}}function padding$1(t,e="="){return anumber$2(t),astr$1("padding",e),{encode(r){for(astrArr$1("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){astrArr$1("padding.decode",r);let n=r.length;if(n*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if((n-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}function convertRadix$2(t,e,r){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(aArr$1(t),!t.length)return[];let n=0;const s=[],o=Array.from(t,u=>{if(anumber$2(u),u<0||u>=e)throw new Error(`invalid integer: ${u}`);return u}),c=o.length;for(;;){let u=0,f=!0;for(let x=n;x<c;x++){const p=o[x],g=e*u,y=g+p;if(!Number.isSafeInteger(y)||g/e!==u||y-p!==g)throw new Error("convertRadix: carry overflow");const b=y/r;u=y%r;const R=Math.floor(b);if(o[x]=R,!Number.isSafeInteger(R)||R*r+u!==y)throw new Error("convertRadix: carry overflow");if(f)R?f=!1:n=x;else continue}if(s.push(u),f)break}for(let u=0;u<t.length-1&&t[u]===0;u++)s.push(0);return s.reverse()}const gcd$1=(t,e)=>e===0?t:gcd$1(e,t%e),radix2carry$1=(t,e)=>t+(e-gcd$1(t,e)),powers=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function convertRadix2$1(t,e,r,n){if(aArr$1(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(radix2carry$1(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${radix2carry$1(e,r)}`);let s=0,o=0;const c=powers[e],u=powers[r]-1,f=[];for(const x of t){if(anumber$2(x),x>=c)throw new Error(`convertRadix2: invalid data word=${x} from=${e}`);if(s=s<<e|x,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=r;o-=r)f.push((s>>o-r&u)>>>0);const p=powers[o];if(p===void 0)throw new Error("invalid carry");s&=p-1}if(s=s<<r-o&u,!n&&o>=e)throw new Error("Excess padding");if(!n&&s>0)throw new Error(`Non-zero padding: ${s}`);return n&&o>0&&f.push(s>>>0),f}function radix$2(t){anumber$2(t);const e=2**8;return{encode:r=>{if(!isBytes$3(r))throw new Error("radix.encode input should be Uint8Array");return convertRadix$2(Array.from(r),e,t)},decode:r=>(anumArr$1("radix.decode",r),Uint8Array.from(convertRadix$2(r,t,e)))}}function radix2$1(t,e=!1){if(anumber$2(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry$1(8,t)>32||radix2carry$1(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!isBytes$3(r))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2$1(Array.from(r),8,t,!e)},decode:r=>(anumArr$1("radix2.decode",r),Uint8Array.from(convertRadix2$1(r,t,8,e)))}}function checksum$1(t,e){return anumber$2(t),afn$1(e),{encode(r){if(!isBytes$3(r))throw new Error("checksum.encode: input should be Uint8Array");const n=e(r).slice(0,t),s=new Uint8Array(r.length+t);return s.set(r),s.set(n,r.length),s},decode(r){if(!isBytes$3(r))throw new Error("checksum.decode: input should be Uint8Array");const n=r.slice(0,-t),s=r.slice(-t),o=e(n).slice(0,t);for(let c=0;c<t;c++)if(o[c]!==s[c])throw new Error("Invalid checksum");return n}}}const utils$8={alphabet:alphabet$2,chain:chain$2,checksum:checksum$1,convertRadix:convertRadix$2,convertRadix2:convertRadix2$1,radix:radix$2,radix2:radix2$1,join:join$2,padding:padding$1};const isJapanese=t=>t[0]==="";function nfkd(t){if(typeof t!="string")throw new TypeError("invalid mnemonic type: "+typeof t);return t.normalize("NFKD")}function normalize$2(t){const e=nfkd(t),r=e.split(" ");if(![12,15,18,21,24].includes(r.length))throw new Error("Invalid mnemonic");return{nfkd:e,words:r}}function aentropy(t){if(abytes$1(t),![16,20,24,28,32].includes(t.length))throw new Error("invalid entropy length")}function generateMnemonic(t,e=128){if(anumber$3(e),e%32!==0||e>256)throw new TypeError("Invalid entropy");return entropyToMnemonic(randomBytes$3(e/8),t)}const calcChecksum=t=>{const e=8-t.length/4;return new Uint8Array([sha256$4(t)[0]>>e<<e])};function getCoder(t){if(!Array.isArray(t)||t.length!==2048||typeof t[0]!="string")throw new Error("Wordlist: expected array of 2048 strings");return t.forEach(e=>{if(typeof e!="string")throw new Error("wordlist: non-string element: "+e)}),utils$8.chain(utils$8.checksum(1,calcChecksum),utils$8.radix2(11,!0),utils$8.alphabet(t))}function mnemonicToEntropy(t,e){const{words:r}=normalize$2(t),n=getCoder(e).decode(r);return aentropy(n),n}function entropyToMnemonic(t,e){return aentropy(t),getCoder(e).encode(t).join(isJapanese(e)?"":" ")}function validateMnemonic(t,e){try{mnemonicToEntropy(t,e)}catch{return!1}return!0}const psalt=t=>nfkd("mnemonic"+t);function mnemonicToSeedSync(t,e=""){return pbkdf2$1(sha512$2,normalize$2(t).nfkd,psalt(e),{c:2048,dkLen:64})}const wordlist=`abandon
ability
able
about
above
absent
absorb
abstract
absurd
abuse
access
accident
account
accuse
achieve
acid
acoustic
acquire
across
act
action
actor
actress
actual
adapt
add
addict
address
adjust
admit
adult
advance
advice
aerobic
affair
afford
afraid
again
age
agent
agree
ahead
aim
air
airport
aisle
alarm
album
alcohol
alert
alien
all
alley
allow
almost
alone
alpha
already
also
alter
always
amateur
amazing
among
amount
amused
analyst
anchor
ancient
anger
angle
angry
animal
ankle
announce
annual
another
answer
antenna
antique
anxiety
any
apart
apology
appear
apple
approve
april
arch
arctic
area
arena
argue
arm
armed
armor
army
around
arrange
arrest
arrive
arrow
art
artefact
artist
artwork
ask
aspect
assault
asset
assist
assume
asthma
athlete
atom
attack
attend
attitude
attract
auction
audit
august
aunt
author
auto
autumn
average
avocado
avoid
awake
aware
away
awesome
awful
awkward
axis
baby
bachelor
bacon
badge
bag
balance
balcony
ball
bamboo
banana
banner
bar
barely
bargain
barrel
base
basic
basket
battle
beach
bean
beauty
because
become
beef
before
begin
behave
behind
believe
below
belt
bench
benefit
best
betray
better
between
beyond
bicycle
bid
bike
bind
biology
bird
birth
bitter
black
blade
blame
blanket
blast
bleak
bless
blind
blood
blossom
blouse
blue
blur
blush
board
boat
body
boil
bomb
bone
bonus
book
boost
border
boring
borrow
boss
bottom
bounce
box
boy
bracket
brain
brand
brass
brave
bread
breeze
brick
bridge
brief
bright
bring
brisk
broccoli
broken
bronze
broom
brother
brown
brush
bubble
buddy
budget
buffalo
build
bulb
bulk
bullet
bundle
bunker
burden
burger
burst
bus
business
busy
butter
buyer
buzz
cabbage
cabin
cable
cactus
cage
cake
call
calm
camera
camp
can
canal
cancel
candy
cannon
canoe
canvas
canyon
capable
capital
captain
car
carbon
card
cargo
carpet
carry
cart
case
cash
casino
castle
casual
cat
catalog
catch
category
cattle
caught
cause
caution
cave
ceiling
celery
cement
census
century
cereal
certain
chair
chalk
champion
change
chaos
chapter
charge
chase
chat
cheap
check
cheese
chef
cherry
chest
chicken
chief
child
chimney
choice
choose
chronic
chuckle
chunk
churn
cigar
cinnamon
circle
citizen
city
civil
claim
clap
clarify
claw
clay
clean
clerk
clever
click
client
cliff
climb
clinic
clip
clock
clog
close
cloth
cloud
clown
club
clump
cluster
clutch
coach
coast
coconut
code
coffee
coil
coin
collect
color
column
combine
come
comfort
comic
common
company
concert
conduct
confirm
congress
connect
consider
control
convince
cook
cool
copper
copy
coral
core
corn
correct
cost
cotton
couch
country
couple
course
cousin
cover
coyote
crack
cradle
craft
cram
crane
crash
crater
crawl
crazy
cream
credit
creek
crew
cricket
crime
crisp
critic
crop
cross
crouch
crowd
crucial
cruel
cruise
crumble
crunch
crush
cry
crystal
cube
culture
cup
cupboard
curious
current
curtain
curve
cushion
custom
cute
cycle
dad
damage
damp
dance
danger
daring
dash
daughter
dawn
day
deal
debate
debris
decade
december
decide
decline
decorate
decrease
deer
defense
define
defy
degree
delay
deliver
demand
demise
denial
dentist
deny
depart
depend
deposit
depth
deputy
derive
describe
desert
design
desk
despair
destroy
detail
detect
develop
device
devote
diagram
dial
diamond
diary
dice
diesel
diet
differ
digital
dignity
dilemma
dinner
dinosaur
direct
dirt
disagree
discover
disease
dish
dismiss
disorder
display
distance
divert
divide
divorce
dizzy
doctor
document
dog
doll
dolphin
domain
donate
donkey
donor
door
dose
double
dove
draft
dragon
drama
drastic
draw
dream
dress
drift
drill
drink
drip
drive
drop
drum
dry
duck
dumb
dune
during
dust
dutch
duty
dwarf
dynamic
eager
eagle
early
earn
earth
easily
east
easy
echo
ecology
economy
edge
edit
educate
effort
egg
eight
either
elbow
elder
electric
elegant
element
elephant
elevator
elite
else
embark
embody
embrace
emerge
emotion
employ
empower
empty
enable
enact
end
endless
endorse
enemy
energy
enforce
engage
engine
enhance
enjoy
enlist
enough
enrich
enroll
ensure
enter
entire
entry
envelope
episode
equal
equip
era
erase
erode
erosion
error
erupt
escape
essay
essence
estate
eternal
ethics
evidence
evil
evoke
evolve
exact
example
excess
exchange
excite
exclude
excuse
execute
exercise
exhaust
exhibit
exile
exist
exit
exotic
expand
expect
expire
explain
expose
express
extend
extra
eye
eyebrow
fabric
face
faculty
fade
faint
faith
fall
false
fame
family
famous
fan
fancy
fantasy
farm
fashion
fat
fatal
father
fatigue
fault
favorite
feature
february
federal
fee
feed
feel
female
fence
festival
fetch
fever
few
fiber
fiction
field
figure
file
film
filter
final
find
fine
finger
finish
fire
firm
first
fiscal
fish
fit
fitness
fix
flag
flame
flash
flat
flavor
flee
flight
flip
float
flock
floor
flower
fluid
flush
fly
foam
focus
fog
foil
fold
follow
food
foot
force
forest
forget
fork
fortune
forum
forward
fossil
foster
found
fox
fragile
frame
frequent
fresh
friend
fringe
frog
front
frost
frown
frozen
fruit
fuel
fun
funny
furnace
fury
future
gadget
gain
galaxy
gallery
game
gap
garage
garbage
garden
garlic
garment
gas
gasp
gate
gather
gauge
gaze
general
genius
genre
gentle
genuine
gesture
ghost
giant
gift
giggle
ginger
giraffe
girl
give
glad
glance
glare
glass
glide
glimpse
globe
gloom
glory
glove
glow
glue
goat
goddess
gold
good
goose
gorilla
gospel
gossip
govern
gown
grab
grace
grain
grant
grape
grass
gravity
great
green
grid
grief
grit
grocery
group
grow
grunt
guard
guess
guide
guilt
guitar
gun
gym
habit
hair
half
hammer
hamster
hand
happy
harbor
hard
harsh
harvest
hat
have
hawk
hazard
head
health
heart
heavy
hedgehog
height
hello
helmet
help
hen
hero
hidden
high
hill
hint
hip
hire
history
hobby
hockey
hold
hole
holiday
hollow
home
honey
hood
hope
horn
horror
horse
hospital
host
hotel
hour
hover
hub
huge
human
humble
humor
hundred
hungry
hunt
hurdle
hurry
hurt
husband
hybrid
ice
icon
idea
identify
idle
ignore
ill
illegal
illness
image
imitate
immense
immune
impact
impose
improve
impulse
inch
include
income
increase
index
indicate
indoor
industry
infant
inflict
inform
inhale
inherit
initial
inject
injury
inmate
inner
innocent
input
inquiry
insane
insect
inside
inspire
install
intact
interest
into
invest
invite
involve
iron
island
isolate
issue
item
ivory
jacket
jaguar
jar
jazz
jealous
jeans
jelly
jewel
job
join
joke
journey
joy
judge
juice
jump
jungle
junior
junk
just
kangaroo
keen
keep
ketchup
key
kick
kid
kidney
kind
kingdom
kiss
kit
kitchen
kite
kitten
kiwi
knee
knife
knock
know
lab
label
labor
ladder
lady
lake
lamp
language
laptop
large
later
latin
laugh
laundry
lava
law
lawn
lawsuit
layer
lazy
leader
leaf
learn
leave
lecture
left
leg
legal
legend
leisure
lemon
lend
length
lens
leopard
lesson
letter
level
liar
liberty
library
license
life
lift
light
like
limb
limit
link
lion
liquid
list
little
live
lizard
load
loan
lobster
local
lock
logic
lonely
long
loop
lottery
loud
lounge
love
loyal
lucky
luggage
lumber
lunar
lunch
luxury
lyrics
machine
mad
magic
magnet
maid
mail
main
major
make
mammal
man
manage
mandate
mango
mansion
manual
maple
marble
march
margin
marine
market
marriage
mask
mass
master
match
material
math
matrix
matter
maximum
maze
meadow
mean
measure
meat
mechanic
medal
media
melody
melt
member
memory
mention
menu
mercy
merge
merit
merry
mesh
message
metal
method
middle
midnight
milk
million
mimic
mind
minimum
minor
minute
miracle
mirror
misery
miss
mistake
mix
mixed
mixture
mobile
model
modify
mom
moment
monitor
monkey
monster
month
moon
moral
more
morning
mosquito
mother
motion
motor
mountain
mouse
move
movie
much
muffin
mule
multiply
muscle
museum
mushroom
music
must
mutual
myself
mystery
myth
naive
name
napkin
narrow
nasty
nation
nature
near
neck
need
negative
neglect
neither
nephew
nerve
nest
net
network
neutral
never
news
next
nice
night
noble
noise
nominee
noodle
normal
north
nose
notable
note
nothing
notice
novel
now
nuclear
number
nurse
nut
oak
obey
object
oblige
obscure
observe
obtain
obvious
occur
ocean
october
odor
off
offer
office
often
oil
okay
old
olive
olympic
omit
once
one
onion
online
only
open
opera
opinion
oppose
option
orange
orbit
orchard
order
ordinary
organ
orient
original
orphan
ostrich
other
outdoor
outer
output
outside
oval
oven
over
own
owner
oxygen
oyster
ozone
pact
paddle
page
pair
palace
palm
panda
panel
panic
panther
paper
parade
parent
park
parrot
party
pass
patch
path
patient
patrol
pattern
pause
pave
payment
peace
peanut
pear
peasant
pelican
pen
penalty
pencil
people
pepper
perfect
permit
person
pet
phone
photo
phrase
physical
piano
picnic
picture
piece
pig
pigeon
pill
pilot
pink
pioneer
pipe
pistol
pitch
pizza
place
planet
plastic
plate
play
please
pledge
pluck
plug
plunge
poem
poet
point
polar
pole
police
pond
pony
pool
popular
portion
position
possible
post
potato
pottery
poverty
powder
power
practice
praise
predict
prefer
prepare
present
pretty
prevent
price
pride
primary
print
priority
prison
private
prize
problem
process
produce
profit
program
project
promote
proof
property
prosper
protect
proud
provide
public
pudding
pull
pulp
pulse
pumpkin
punch
pupil
puppy
purchase
purity
purpose
purse
push
put
puzzle
pyramid
quality
quantum
quarter
question
quick
quit
quiz
quote
rabbit
raccoon
race
rack
radar
radio
rail
rain
raise
rally
ramp
ranch
random
range
rapid
rare
rate
rather
raven
raw
razor
ready
real
reason
rebel
rebuild
recall
receive
recipe
record
recycle
reduce
reflect
reform
refuse
region
regret
regular
reject
relax
release
relief
rely
remain
remember
remind
remove
render
renew
rent
reopen
repair
repeat
replace
report
require
rescue
resemble
resist
resource
response
result
retire
retreat
return
reunion
reveal
review
reward
rhythm
rib
ribbon
rice
rich
ride
ridge
rifle
right
rigid
ring
riot
ripple
risk
ritual
rival
river
road
roast
robot
robust
rocket
romance
roof
rookie
room
rose
rotate
rough
round
route
royal
rubber
rude
rug
rule
run
runway
rural
sad
saddle
sadness
safe
sail
salad
salmon
salon
salt
salute
same
sample
sand
satisfy
satoshi
sauce
sausage
save
say
scale
scan
scare
scatter
scene
scheme
school
science
scissors
scorpion
scout
scrap
screen
script
scrub
sea
search
season
seat
second
secret
section
security
seed
seek
segment
select
sell
seminar
senior
sense
sentence
series
service
session
settle
setup
seven
shadow
shaft
shallow
share
shed
shell
sheriff
shield
shift
shine
ship
shiver
shock
shoe
shoot
shop
short
shoulder
shove
shrimp
shrug
shuffle
shy
sibling
sick
side
siege
sight
sign
silent
silk
silly
silver
similar
simple
since
sing
siren
sister
situate
six
size
skate
sketch
ski
skill
skin
skirt
skull
slab
slam
sleep
slender
slice
slide
slight
slim
slogan
slot
slow
slush
small
smart
smile
smoke
smooth
snack
snake
snap
sniff
snow
soap
soccer
social
sock
soda
soft
solar
soldier
solid
solution
solve
someone
song
soon
sorry
sort
soul
sound
soup
source
south
space
spare
spatial
spawn
speak
special
speed
spell
spend
sphere
spice
spider
spike
spin
spirit
split
spoil
sponsor
spoon
sport
spot
spray
spread
spring
spy
square
squeeze
squirrel
stable
stadium
staff
stage
stairs
stamp
stand
start
state
stay
steak
steel
stem
step
stereo
stick
still
sting
stock
stomach
stone
stool
story
stove
strategy
street
strike
strong
struggle
student
stuff
stumble
style
subject
submit
subway
success
such
sudden
suffer
sugar
suggest
suit
summer
sun
sunny
sunset
super
supply
supreme
sure
surface
surge
surprise
surround
survey
suspect
sustain
swallow
swamp
swap
swarm
swear
sweet
swift
swim
swing
switch
sword
symbol
symptom
syrup
system
table
tackle
tag
tail
talent
talk
tank
tape
target
task
taste
tattoo
taxi
teach
team
tell
ten
tenant
tennis
tent
term
test
text
thank
that
theme
then
theory
there
they
thing
this
thought
three
thrive
throw
thumb
thunder
ticket
tide
tiger
tilt
timber
time
tiny
tip
tired
tissue
title
toast
tobacco
today
toddler
toe
together
toilet
token
tomato
tomorrow
tone
tongue
tonight
tool
tooth
top
topic
topple
torch
tornado
tortoise
toss
total
tourist
toward
tower
town
toy
track
trade
traffic
tragic
train
transfer
trap
trash
travel
tray
treat
tree
trend
trial
tribe
trick
trigger
trim
trip
trophy
trouble
truck
true
truly
trumpet
trust
truth
try
tube
tuition
tumble
tuna
tunnel
turkey
turn
turtle
twelve
twenty
twice
twin
twist
two
type
typical
ugly
umbrella
unable
unaware
uncle
uncover
under
undo
unfair
unfold
unhappy
uniform
unique
unit
universe
unknown
unlock
until
unusual
unveil
update
upgrade
uphold
upon
upper
upset
urban
urge
usage
use
used
useful
useless
usual
utility
vacant
vacuum
vague
valid
valley
valve
van
vanish
vapor
various
vast
vault
vehicle
velvet
vendor
venture
venue
verb
verify
version
very
vessel
veteran
viable
vibrant
vicious
victory
video
view
village
vintage
violin
virtual
virus
visa
visit
visual
vital
vivid
vocal
voice
void
volcano
volume
vote
voyage
wage
wagon
wait
walk
wall
walnut
want
warfare
warm
warrior
wash
wasp
waste
water
wave
way
wealth
weapon
wear
weasel
weather
web
wedding
weekend
weird
welcome
west
wet
whale
what
wheat
wheel
when
where
whip
whisper
wide
width
wife
wild
will
win
window
wine
wing
wink
winner
winter
wire
wisdom
wise
wish
witness
wolf
woman
wonder
wood
wool
word
work
world
worry
worth
wrap
wreck
wrestle
wrist
write
wrong
yard
year
yellow
you
young
youth
zebra
zero
zone
zoo`.split(`
`);function isBytes$2(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function anumber$1(t,e=""){if(!Number.isSafeInteger(t)||t<0){const r=e&&`"${e}" `;throw new Error(`${r}expected integer >= 0, got ${t}`)}}function abytes(t,e,r=""){const n=isBytes$2(t),s=t?.length,o=e!==void 0;if(!n||o&&s!==e){const c=r&&`"${r}" `,u=o?` of length ${e}`:"",f=n?`length=${s}`:`type=${typeof t}`;throw new Error(c+"expected Uint8Array"+u+", got "+f)}return t}function ahash(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash must wrapped by utils.createHasher");anumber$1(t.outputLen),anumber$1(t.blockLen)}function aexists(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function aoutput(t,e){abytes(t,void 0,"digestInto() output");const r=e.outputLen;if(t.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}function clean(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function createView$3(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function rotr$2(t,e){return t<<32-e|t>>>e}function rotl$2(t,e){return t<<e|t>>>32-e>>>0}const hasHexBuiltin=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes$3=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$3(t){if(abytes(t),hasHexBuiltin)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=hexes$3[t[r]];return e}const asciis$1={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16$1(t){if(t>=asciis$1._0&&t<=asciis$1._9)return t-asciis$1._0;if(t>=asciis$1.A&&t<=asciis$1.F)return t-(asciis$1.A-10);if(t>=asciis$1.a&&t<=asciis$1.f)return t-(asciis$1.a-10)}function hexToBytes$5(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(hasHexBuiltin)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,o=0;s<r;s++,o+=2){const c=asciiToBase16$1(t.charCodeAt(o)),u=asciiToBase16$1(t.charCodeAt(o+1));if(c===void 0||u===void 0){const f=t[o]+t[o+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+o)}n[s]=c*16+u}return n}function concatBytes$3(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];abytes(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const o=t[n];r.set(o,s),s+=o.length}return r}function createHasher(t,e={}){const r=(s,o)=>t(o).update(s).digest(),n=t(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=s=>t(s),Object.assign(r,e),Object.freeze(r)}function randomBytes$2(t=32){const e=typeof globalThis=="object"?globalThis.crypto:null;if(typeof e?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return e.getRandomValues(new Uint8Array(t))}const oidNist=t=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,t])});function Chi$2(t,e,r){return t&e^~t&r}function Maj$2(t,e,r){return t&e^t&r^e&r}class HashMD{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(e,r,n,s){this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=createView$3(this.buffer)}update(e){aexists(this),abytes(e);const{view:r,buffer:n,blockLen:s}=this,o=e.length;for(let c=0;c<o;){const u=Math.min(s-this.pos,o-c);if(u===s){const f=createView$3(e);for(;s<=o-c;c+=s)this.process(f,c);continue}n.set(e.subarray(c,c+u),this.pos),this.pos+=u,c+=u,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){aexists(this),aoutput(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:o}=this;let{pos:c}=this;r[c++]=128,clean(this.buffer.subarray(c)),this.padOffset>s-c&&(this.process(n,0),c=0);for(let g=c;g<s;g++)r[g]=0;n.setBigUint64(s-8,BigInt(this.length*8),o),this.process(n,0);const u=createView$3(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const x=f/4,p=this.get();if(x>p.length)throw new Error("_sha2: outputLen bigger than state");for(let g=0;g<x;g++)u.setUint32(4*g,p[g],o)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||=new this.constructor,e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:o,destroyed:c,pos:u}=this;return e.destroyed=c,e.finished=o,e.length=s,e.pos=u,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),U32_MASK64=BigInt(2**32-1),_32n=BigInt(32);function fromBig(t,e=!1){return e?{h:Number(t&U32_MASK64),l:Number(t>>_32n&U32_MASK64)}:{h:Number(t>>_32n&U32_MASK64)|0,l:Number(t&U32_MASK64)|0}}function split(t,e=!1){const r=t.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let o=0;o<r;o++){const{h:c,l:u}=fromBig(t[o],e);[n[o],s[o]]=[c,u]}return[n,s]}const shrSH=(t,e,r)=>t>>>r,shrSL=(t,e,r)=>t<<32-r|e>>>r,rotrSH=(t,e,r)=>t>>>r|e<<32-r,rotrSL=(t,e,r)=>t<<32-r|e>>>r,rotrBH=(t,e,r)=>t<<64-r|e>>>r-32,rotrBL=(t,e,r)=>t>>>r-32|e<<64-r;function add(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const add3L=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),add3H=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,add4L=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),add4H=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,add5L=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),add5H=(t,e,r,n,s,o)=>e+r+n+s+o+(t/2**32|0)|0,SHA256_K$2=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W$2=new Uint32Array(64);class SHA2_32B extends HashMD{constructor(e){super(64,e,8,!1)}get(){const{A:e,B:r,C:n,D:s,E:o,F:c,G:u,H:f}=this;return[e,r,n,s,o,c,u,f]}set(e,r,n,s,o,c,u,f){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=o|0,this.F=c|0,this.G=u|0,this.H=f|0}process(e,r){for(let g=0;g<16;g++,r+=4)SHA256_W$2[g]=e.getUint32(r,!1);for(let g=16;g<64;g++){const y=SHA256_W$2[g-15],b=SHA256_W$2[g-2],R=rotr$2(y,7)^rotr$2(y,18)^y>>>3,D=rotr$2(b,17)^rotr$2(b,19)^b>>>10;SHA256_W$2[g]=D+SHA256_W$2[g-7]+R+SHA256_W$2[g-16]|0}let{A:n,B:s,C:o,D:c,E:u,F:f,G:x,H:p}=this;for(let g=0;g<64;g++){const y=rotr$2(u,6)^rotr$2(u,11)^rotr$2(u,25),b=p+y+Chi$2(u,f,x)+SHA256_K$2[g]+SHA256_W$2[g]|0,D=(rotr$2(n,2)^rotr$2(n,13)^rotr$2(n,22))+Maj$2(n,s,o)|0;p=x,x=f,f=u,u=c+b|0,c=o,o=s,s=n,n=b+D|0}n=n+this.A|0,s=s+this.B|0,o=o+this.C|0,c=c+this.D|0,u=u+this.E|0,f=f+this.F|0,x=x+this.G|0,p=p+this.H|0,this.set(n,s,o,c,u,f,x,p)}roundClean(){clean(SHA256_W$2)}destroy(){this.set(0,0,0,0,0,0,0,0),clean(this.buffer)}}class _SHA256 extends SHA2_32B{A=SHA256_IV[0]|0;B=SHA256_IV[1]|0;C=SHA256_IV[2]|0;D=SHA256_IV[3]|0;E=SHA256_IV[4]|0;F=SHA256_IV[5]|0;G=SHA256_IV[6]|0;H=SHA256_IV[7]|0;constructor(){super(32)}}const K512=split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),SHA512_Kh=K512[0],SHA512_Kl=K512[1],SHA512_W_H=new Uint32Array(80),SHA512_W_L=new Uint32Array(80);class SHA2_64B extends HashMD{constructor(e){super(128,e,16,!1)}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:o,Cl:c,Dh:u,Dl:f,Eh:x,El:p,Fh:g,Fl:y,Gh:b,Gl:R,Hh:D,Hl:k}=this;return[e,r,n,s,o,c,u,f,x,p,g,y,b,R,D,k]}set(e,r,n,s,o,c,u,f,x,p,g,y,b,R,D,k){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=o|0,this.Cl=c|0,this.Dh=u|0,this.Dl=f|0,this.Eh=x|0,this.El=p|0,this.Fh=g|0,this.Fl=y|0,this.Gh=b|0,this.Gl=R|0,this.Hh=D|0,this.Hl=k|0}process(e,r){for(let O=0;O<16;O++,r+=4)SHA512_W_H[O]=e.getUint32(r),SHA512_W_L[O]=e.getUint32(r+=4);for(let O=16;O<80;O++){const $e=SHA512_W_H[O-15]|0,ze=SHA512_W_L[O-15]|0,q=rotrSH($e,ze,1)^rotrSH($e,ze,8)^shrSH($e,ze,7),W=rotrSL($e,ze,1)^rotrSL($e,ze,8)^shrSL($e,ze,7),We=SHA512_W_H[O-2]|0,Xe=SHA512_W_L[O-2]|0,it=rotrSH(We,Xe,19)^rotrBH(We,Xe,61)^shrSH(We,Xe,6),Ve=rotrSL(We,Xe,19)^rotrBL(We,Xe,61)^shrSL(We,Xe,6),v=add4L(W,Ve,SHA512_W_L[O-7],SHA512_W_L[O-16]),I=add4H(v,q,it,SHA512_W_H[O-7],SHA512_W_H[O-16]);SHA512_W_H[O]=I|0,SHA512_W_L[O]=v|0}let{Ah:n,Al:s,Bh:o,Bl:c,Ch:u,Cl:f,Dh:x,Dl:p,Eh:g,El:y,Fh:b,Fl:R,Gh:D,Gl:k,Hh:Re,Hl:Fe}=this;for(let O=0;O<80;O++){const $e=rotrSH(g,y,14)^rotrSH(g,y,18)^rotrBH(g,y,41),ze=rotrSL(g,y,14)^rotrSL(g,y,18)^rotrBL(g,y,41),q=g&b^~g&D,W=y&R^~y&k,We=add5L(Fe,ze,W,SHA512_Kl[O],SHA512_W_L[O]),Xe=add5H(We,Re,$e,q,SHA512_Kh[O],SHA512_W_H[O]),it=We|0,Ve=rotrSH(n,s,28)^rotrBH(n,s,34)^rotrBH(n,s,39),v=rotrSL(n,s,28)^rotrBL(n,s,34)^rotrBL(n,s,39),I=n&o^n&u^o&u,Ce=s&c^s&f^c&f;Re=D|0,Fe=k|0,D=b|0,k=R|0,b=g|0,R=y|0,{h:g,l:y}=add(x|0,p|0,Xe|0,it|0),x=u|0,p=f|0,u=o|0,f=c|0,o=n|0,c=s|0;const P=add3L(it,v,Ce);n=add3H(P,Xe,Ve,I),s=P|0}({h:n,l:s}=add(this.Ah|0,this.Al|0,n|0,s|0)),{h:o,l:c}=add(this.Bh|0,this.Bl|0,o|0,c|0),{h:u,l:f}=add(this.Ch|0,this.Cl|0,u|0,f|0),{h:x,l:p}=add(this.Dh|0,this.Dl|0,x|0,p|0),{h:g,l:y}=add(this.Eh|0,this.El|0,g|0,y|0),{h:b,l:R}=add(this.Fh|0,this.Fl|0,b|0,R|0),{h:D,l:k}=add(this.Gh|0,this.Gl|0,D|0,k|0),{h:Re,l:Fe}=add(this.Hh|0,this.Hl|0,Re|0,Fe|0),this.set(n,s,o,c,u,f,x,p,g,y,b,R,D,k,Re,Fe)}roundClean(){clean(SHA512_W_H,SHA512_W_L)}destroy(){clean(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class _SHA512 extends SHA2_64B{Ah=SHA512_IV[0]|0;Al=SHA512_IV[1]|0;Bh=SHA512_IV[2]|0;Bl=SHA512_IV[3]|0;Ch=SHA512_IV[4]|0;Cl=SHA512_IV[5]|0;Dh=SHA512_IV[6]|0;Dl=SHA512_IV[7]|0;Eh=SHA512_IV[8]|0;El=SHA512_IV[9]|0;Fh=SHA512_IV[10]|0;Fl=SHA512_IV[11]|0;Gh=SHA512_IV[12]|0;Gl=SHA512_IV[13]|0;Hh=SHA512_IV[14]|0;Hl=SHA512_IV[15]|0;constructor(){super(64)}}const sha256$3=createHasher(()=>new _SHA256,oidNist(1)),sha512$1=createHasher(()=>new _SHA512,oidNist(3));const _0n$8=BigInt(0),_1n$8=BigInt(1);function abool(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}" `;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function abignumber(t){if(typeof t=="bigint"){if(!isPosBig(t))throw new Error("positive bigint expected, got "+t)}else anumber$1(t);return t}function numberToHexUnpadded$1(t){const e=abignumber(t).toString(16);return e.length&1?"0"+e:e}function hexToNumber$1(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?_0n$8:BigInt("0x"+t)}function bytesToNumberBE$1(t){return hexToNumber$1(bytesToHex$3(t))}function bytesToNumberLE$1(t){return hexToNumber$1(bytesToHex$3(copyBytes(abytes(t)).reverse()))}function numberToBytesBE$1(t,e){anumber$1(e),t=abignumber(t);const r=hexToBytes$5(t.toString(16).padStart(e*2,"0"));if(r.length!==e)throw new Error("number too large");return r}function numberToBytesLE$1(t,e){return numberToBytesBE$1(t,e).reverse()}function copyBytes(t){return Uint8Array.from(t)}const isPosBig=t=>typeof t=="bigint"&&_0n$8<=t;function inRange(t,e,r){return isPosBig(t)&&isPosBig(e)&&isPosBig(r)&&e<=t&&t<r}function aInRange(t,e,r,n){if(!inRange(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function bitLen$1(t){let e;for(e=0;t>_0n$8;t>>=_1n$8,e+=1);return e}const bitMask$1=t=>(_1n$8<<BigInt(t))-_1n$8;function createHmacDrbg$1(t,e,r){if(anumber$1(t,"hashLen"),anumber$1(e,"qByteLen"),typeof r!="function")throw new Error("hmacFn must be a function");const n=k=>new Uint8Array(k),s=Uint8Array.of(),o=Uint8Array.of(0),c=Uint8Array.of(1),u=1e3;let f=n(t),x=n(t),p=0;const g=()=>{f.fill(1),x.fill(0),p=0},y=(...k)=>r(x,concatBytes$3(f,...k)),b=(k=s)=>{x=y(o,k),f=y(),k.length!==0&&(x=y(c,k),f=y())},R=()=>{if(p++>=u)throw new Error("drbg: tried max amount of iterations");let k=0;const Re=[];for(;k<e;){f=y();const Fe=f.slice();Re.push(Fe),k+=f.length}return concatBytes$3(...Re)};return(k,Re)=>{g(),b(k);let Fe;for(;!(Fe=Re(R()));)b();return g(),Fe}}function validateObject$1(t,e={},r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(o,c,u){const f=t[o];if(u&&f===void 0)return;const x=typeof f;if(x!==c||f===null)throw new Error(`param "${o}" is invalid: expected ${c}, got ${x}`)}const s=(o,c)=>Object.entries(o).forEach(([u,f])=>n(u,f,c));s(e,!1),s(r,!0)}function memoized(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const o=t(r,...n);return e.set(r,o),o}}const _0n$7=BigInt(0),_1n$7=BigInt(1),_2n$5=BigInt(2),_3n$3=BigInt(3),_4n$2=BigInt(4),_5n$1=BigInt(5),_7n=BigInt(7),_8n$1=BigInt(8),_9n=BigInt(9),_16n=BigInt(16);function mod$1(t,e){const r=t%e;return r>=_0n$7?r:e+r}function pow2$1(t,e,r){let n=t;for(;e-- >_0n$7;)n*=n,n%=r;return n}function invert$1(t,e){if(t===_0n$7)throw new Error("invert: expected non-zero number");if(e<=_0n$7)throw new Error("invert: expected positive modulus, got "+e);let r=mod$1(t,e),n=e,s=_0n$7,o=_1n$7;for(;r!==_0n$7;){const u=n/r,f=n%r,x=s-o*u;n=r,r=f,s=o,o=x}if(n!==_1n$7)throw new Error("invert: does not exist");return mod$1(s,e)}function assertIsSquare(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function sqrt3mod4(t,e){const r=(t.ORDER+_1n$7)/_4n$2,n=t.pow(e,r);return assertIsSquare(t,n,e),n}function sqrt5mod8(t,e){const r=(t.ORDER-_5n$1)/_8n$1,n=t.mul(e,_2n$5),s=t.pow(n,r),o=t.mul(e,s),c=t.mul(t.mul(o,_2n$5),s),u=t.mul(o,t.sub(c,t.ONE));return assertIsSquare(t,u,e),u}function sqrt9mod16(t){const e=Field$1(t),r=tonelliShanks$1(t),n=r(e,e.neg(e.ONE)),s=r(e,n),o=r(e,e.neg(n)),c=(t+_7n)/_16n;return(u,f)=>{let x=u.pow(f,c),p=u.mul(x,n);const g=u.mul(x,s),y=u.mul(x,o),b=u.eql(u.sqr(p),f),R=u.eql(u.sqr(g),f);x=u.cmov(x,p,b),p=u.cmov(y,g,R);const D=u.eql(u.sqr(p),f),k=u.cmov(x,p,D);return assertIsSquare(u,k,f),k}}function tonelliShanks$1(t){if(t<_3n$3)throw new Error("sqrt is not defined for small field");let e=t-_1n$7,r=0;for(;e%_2n$5===_0n$7;)e/=_2n$5,r++;let n=_2n$5;const s=Field$1(t);for(;FpLegendre(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return sqrt3mod4;let o=s.pow(n,e);const c=(e+_1n$7)/_2n$5;return function(f,x){if(f.is0(x))return x;if(FpLegendre(f,x)!==1)throw new Error("Cannot find square root");let p=r,g=f.mul(f.ONE,o),y=f.pow(x,e),b=f.pow(x,c);for(;!f.eql(y,f.ONE);){if(f.is0(y))return f.ZERO;let R=1,D=f.sqr(y);for(;!f.eql(D,f.ONE);)if(R++,D=f.sqr(D),R===p)throw new Error("Cannot find square root");const k=_1n$7<<BigInt(p-R-1),Re=f.pow(g,k);p=R,g=f.sqr(Re),y=f.mul(y,g),b=f.mul(b,Re)}return b}}function FpSqrt$1(t){return t%_4n$2===_3n$3?sqrt3mod4:t%_8n$1===_5n$1?sqrt5mod8:t%_16n===_9n?sqrt9mod16(t):tonelliShanks$1(t)}const FIELD_FIELDS$1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$1(t){const e={ORDER:"bigint",BYTES:"number",BITS:"number"},r=FIELD_FIELDS$1.reduce((n,s)=>(n[s]="function",n),e);return validateObject$1(t,r),t}function FpPow$1(t,e,r){if(r<_0n$7)throw new Error("invalid exponent, negatives unsupported");if(r===_0n$7)return t.ONE;if(r===_1n$7)return e;let n=t.ONE,s=e;for(;r>_0n$7;)r&_1n$7&&(n=t.mul(n,s)),s=t.sqr(s),r>>=_1n$7;return n}function FpInvertBatch$1(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((c,u,f)=>t.is0(u)?c:(n[f]=c,t.mul(c,u)),t.ONE),o=t.inv(s);return e.reduceRight((c,u,f)=>t.is0(u)?c:(n[f]=t.mul(c,n[f]),t.mul(c,u)),o),n}function FpLegendre(t,e){const r=(t.ORDER-_1n$7)/_2n$5,n=t.pow(e,r),s=t.eql(n,t.ONE),o=t.eql(n,t.ZERO),c=t.eql(n,t.neg(t.ONE));if(!s&&!o&&!c)throw new Error("invalid Legendre symbol result");return s?1:o?0:-1}function nLength$1(t,e){e!==void 0&&anumber$1(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}class _Field{ORDER;BITS;BYTES;isLE;ZERO=_0n$7;ONE=_1n$7;_lengths;_sqrt;_mod;constructor(e,r={}){if(e<=_0n$7)throw new Error("invalid field: expected ORDER > 0, got "+e);let n;this.isLE=!1,r!=null&&typeof r=="object"&&(typeof r.BITS=="number"&&(n=r.BITS),typeof r.sqrt=="function"&&(this.sqrt=r.sqrt),typeof r.isLE=="boolean"&&(this.isLE=r.isLE),r.allowedLengths&&(this._lengths=r.allowedLengths?.slice()),typeof r.modFromBytes=="boolean"&&(this._mod=r.modFromBytes));const{nBitLength:s,nByteLength:o}=nLength$1(e,n);if(o>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=e,this.BITS=s,this.BYTES=o,this._sqrt=void 0,Object.preventExtensions(this)}create(e){return mod$1(e,this.ORDER)}isValid(e){if(typeof e!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof e);return _0n$7<=e&&e<this.ORDER}is0(e){return e===_0n$7}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}isOdd(e){return(e&_1n$7)===_1n$7}neg(e){return mod$1(-e,this.ORDER)}eql(e,r){return e===r}sqr(e){return mod$1(e*e,this.ORDER)}add(e,r){return mod$1(e+r,this.ORDER)}sub(e,r){return mod$1(e-r,this.ORDER)}mul(e,r){return mod$1(e*r,this.ORDER)}pow(e,r){return FpPow$1(this,e,r)}div(e,r){return mod$1(e*invert$1(r,this.ORDER),this.ORDER)}sqrN(e){return e*e}addN(e,r){return e+r}subN(e,r){return e-r}mulN(e,r){return e*r}inv(e){return invert$1(e,this.ORDER)}sqrt(e){return this._sqrt||(this._sqrt=FpSqrt$1(this.ORDER)),this._sqrt(this,e)}toBytes(e){return this.isLE?numberToBytesLE$1(e,this.BYTES):numberToBytesBE$1(e,this.BYTES)}fromBytes(e,r=!1){abytes(e);const{_lengths:n,BYTES:s,isLE:o,ORDER:c,_mod:u}=this;if(n){if(!n.includes(e.length)||e.length>s)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+e.length);const x=new Uint8Array(s);x.set(e,o?0:x.length-e.length),e=x}if(e.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+e.length);let f=o?bytesToNumberLE$1(e):bytesToNumberBE$1(e);if(u&&(f=mod$1(f,c)),!r&&!this.isValid(f))throw new Error("invalid field element: outside of range 0..ORDER");return f}invertBatch(e){return FpInvertBatch$1(this,e)}cmov(e,r,n){return n?r:e}}function Field$1(t,e={}){return new _Field(t,e)}function getFieldBytesLength$1(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function getMinHashLength$1(t){const e=getFieldBytesLength$1(t);return e+Math.ceil(e/2)}function mapHashToField$1(t,e,r=!1){abytes(t);const n=t.length,s=getFieldBytesLength$1(e),o=getMinHashLength$1(e);if(n<16||n<o||n>1024)throw new Error("expected "+o+"-1024 bytes of input, got "+n);const c=r?bytesToNumberLE$1(t):bytesToNumberBE$1(t),u=mod$1(c,e-_1n$7)+_1n$7;return r?numberToBytesLE$1(u,s):numberToBytesBE$1(u,s)}const _0n$6=BigInt(0),_1n$6=BigInt(1);function negateCt(t,e){const r=e.negate();return t?r:e}function normalizeZ(t,e){const r=FpInvertBatch$1(t.Fp,e.map(n=>n.Z));return e.map((n,s)=>t.fromAffine(n.toAffine(r[s])))}function validateW(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function calcWOpts(t,e){validateW(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,o=bitMask$1(t),c=BigInt(t);return{windows:r,windowSize:n,mask:o,maxNumber:s,shiftBy:c}}function calcOffsets(t,e,r){const{windowSize:n,mask:s,maxNumber:o,shiftBy:c}=r;let u=Number(t&s),f=t>>c;u>n&&(u-=o,f+=_1n$6);const x=e*n,p=x+Math.abs(u)-1,g=u===0,y=u<0,b=e%2!==0;return{nextN:f,offset:p,isZero:g,isNeg:y,isNegF:b,offsetF:x}}const pointPrecomputes=new WeakMap,pointWindowSizes=new WeakMap;function getW(t){return pointWindowSizes.get(t)||1}function assert0(t){if(t!==_0n$6)throw new Error("invalid wNAF")}let wNAF$1=class{BASE;ZERO;Fn;bits;constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let s=e;for(;r>_0n$6;)r&_1n$6&&(n=n.add(s)),s=s.double(),r>>=_1n$6;return n}precomputeWindow(e,r){const{windows:n,windowSize:s}=calcWOpts(r,this.bits),o=[];let c=e,u=c;for(let f=0;f<n;f++){u=c,o.push(u);for(let x=1;x<s;x++)u=u.add(c),o.push(u);c=u.double()}return o}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,o=this.BASE;const c=calcWOpts(e,this.bits);for(let u=0;u<c.windows;u++){const{nextN:f,offset:x,isZero:p,isNeg:g,isNegF:y,offsetF:b}=calcOffsets(n,u,c);n=f,p?o=o.add(negateCt(y,r[b])):s=s.add(negateCt(g,r[x]))}return assert0(n),{p:s,f:o}}wNAFUnsafe(e,r,n,s=this.ZERO){const o=calcWOpts(e,this.bits);for(let c=0;c<o.windows&&n!==_0n$6;c++){const{nextN:u,offset:f,isZero:x,isNeg:p}=calcOffsets(n,c,o);if(n=u,!x){const g=r[f];s=s.add(p?g.negate():g)}}return assert0(n),s}getPrecomputes(e,r,n){let s=pointPrecomputes.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(s=n(s)),pointPrecomputes.set(r,s))),s}cached(e,r,n){const s=getW(e);return this.wNAF(s,this.getPrecomputes(s,e,n),r)}unsafe(e,r,n,s){const o=getW(e);return o===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,e,n),r,s)}createCache(e,r){validateW(r,this.bits),pointWindowSizes.set(e,r),pointPrecomputes.delete(e)}hasCache(e){return getW(e)!==1}};function mulEndoUnsafe(t,e,r,n){let s=e,o=t.ZERO,c=t.ZERO;for(;r>_0n$6||n>_0n$6;)r&_1n$6&&(o=o.add(s)),n&_1n$6&&(c=c.add(s)),s=s.double(),r>>=_1n$6,n>>=_1n$6;return{p1:o,p2:c}}function createField(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return validateField$1(e),e}else return Field$1(t,{isLE:r})}function createCurveFields(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const f of["p","n","h"]){const x=e[f];if(!(typeof x=="bigint"&&x>_0n$6))throw new Error(`CURVE.${f} must be positive bigint`)}const s=createField(e.p,r.Fp,n),o=createField(e.n,r.Fn,n),u=["Gx","Gy","a","b"];for(const f of u)if(!s.isValid(e[f]))throw new Error(`CURVE.${f} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:o}}function createKeygen(t,e){return function(n){const s=t(n);return{secretKey:s,publicKey:e(s)}}}class _HMAC{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(e,r){if(ahash(e),abytes(r,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(r.length>n?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),clean(s)}update(e){return aexists(this),this.iHash.update(e),this}digestInto(e){aexists(this),abytes(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});const{oHash:r,iHash:n,finished:s,destroyed:o,blockLen:c,outputLen:u}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=c,e.outputLen=u,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac$3=(t,e,r)=>new _HMAC(t,e).update(r).digest();hmac$3.create=(t,e)=>new _HMAC(t,e);const divNearest$1=(t,e)=>(t+(t>=0?e:-e)/_2n$4)/e;function _splitEndoScalar(t,e,r){const[[n,s],[o,c]]=e,u=divNearest$1(c*t,r),f=divNearest$1(-s*t,r);let x=t-u*n-f*o,p=-u*s-f*c;const g=x<_0n$5,y=p<_0n$5;g&&(x=-x),y&&(p=-p);const b=bitMask$1(Math.ceil(bitLen$1(r)/2))+_1n$5;if(x<_0n$5||x>=b||p<_0n$5||p>=b)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:g,k1:x,k2neg:y,k2:p}}function validateSigFormat(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function validateSigOpts(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return abool(r.lowS,"lowS"),abool(r.prehash,"prehash"),r.format!==void 0&&validateSigFormat(r.format),r}class DERErr extends Error{constructor(e=""){super(e)}}const DER$1={Err:DERErr,_tlv:{encode:(t,e)=>{const{Err:r}=DER$1;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,s=numberToHexUnpadded$1(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const o=n>127?numberToHexUnpadded$1(s.length/2|128):"";return numberToHexUnpadded$1(t)+o+s+e},decode(t,e){const{Err:r}=DER$1;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[n++],o=!!(s&128);let c=0;if(!o)c=s;else{const f=s&127;if(!f)throw new r("tlv.decode(long): indefinite length not supported");if(f>4)throw new r("tlv.decode(long): byte length is too big");const x=e.subarray(n,n+f);if(x.length!==f)throw new r("tlv.decode: length bytes not complete");if(x[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const p of x)c=c<<8|p;if(n+=f,c<128)throw new r("tlv.decode(long): not minimal encoding")}const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: wrong value length");return{v:u,l:e.subarray(n+c)}}},_int:{encode(t){const{Err:e}=DER$1;if(t<_0n$5)throw new e("integer: negative integers are not allowed");let r=numberToHexUnpadded$1(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=DER$1;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return bytesToNumberBE$1(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=DER$1,s=abytes(t,void 0,"signature"),{v:o,l:c}=n.decode(48,s);if(c.length)throw new e("invalid signature: left bytes after parsing");const{v:u,l:f}=n.decode(2,o),{v:x,l:p}=n.decode(2,f);if(p.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(u),s:r.decode(x)}},hexFromSig(t){const{_tlv:e,_int:r}=DER$1,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),o=n+s;return e.encode(48,o)}},_0n$5=BigInt(0),_1n$5=BigInt(1),_2n$4=BigInt(2),_3n$2=BigInt(3),_4n$1=BigInt(4);function weierstrass$2(t,e={}){const r=createCurveFields("weierstrass",t,e),{Fp:n,Fn:s}=r;let o=r.CURVE;const{h:c,n:u}=o;validateObject$1(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});const{endo:f}=e;if(f&&(!n.is0(o.a)||typeof f.beta!="bigint"||!Array.isArray(f.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const x=getWLengths(n,s);function p(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function g(v,I,Ce){const{x:P,y:_e}=I.toAffine(),Le=n.toBytes(P);if(abool(Ce,"isCompressed"),Ce){p();const Ye=!n.isOdd(_e);return concatBytes$3(pprefix(Ye),Le)}else return concatBytes$3(Uint8Array.of(4),Le,n.toBytes(_e))}function y(v){abytes(v,void 0,"Point");const{publicKey:I,publicKeyUncompressed:Ce}=x,P=v.length,_e=v[0],Le=v.subarray(1);if(P===I&&(_e===2||_e===3)){const Ye=n.fromBytes(Le);if(!n.isValid(Ye))throw new Error("bad point: is not on curve, wrong x");const je=D(Ye);let K;try{K=n.sqrt(je)}catch(dt){const Je=dt instanceof Error?": "+dt.message:"";throw new Error("bad point: is not on curve, sqrt error"+Je)}p();const L=n.isOdd(K);return(_e&1)===1!==L&&(K=n.neg(K)),{x:Ye,y:K}}else if(P===Ce&&_e===4){const Ye=n.BYTES,je=n.fromBytes(Le.subarray(0,Ye)),K=n.fromBytes(Le.subarray(Ye,Ye*2));if(!k(je,K))throw new Error("bad point: is not on curve");return{x:je,y:K}}else throw new Error(`bad point: got length ${P}, expected compressed=${I} or uncompressed=${Ce}`)}const b=e.toBytes||g,R=e.fromBytes||y;function D(v){const I=n.sqr(v),Ce=n.mul(I,v);return n.add(n.add(Ce,n.mul(v,o.a)),o.b)}function k(v,I){const Ce=n.sqr(I),P=D(v);return n.eql(Ce,P)}if(!k(o.Gx,o.Gy))throw new Error("bad curve params: generator point");const Re=n.mul(n.pow(o.a,_3n$2),_4n$1),Fe=n.mul(n.sqr(o.b),BigInt(27));if(n.is0(n.add(Re,Fe)))throw new Error("bad curve params: a or b");function O(v,I,Ce=!1){if(!n.isValid(I)||Ce&&n.is0(I))throw new Error(`bad point coordinate ${v}`);return I}function $e(v){if(!(v instanceof Xe))throw new Error("Weierstrass Point expected")}function ze(v){if(!f||!f.basises)throw new Error("no endo");return _splitEndoScalar(v,f.basises,s.ORDER)}const q=memoized((v,I)=>{const{X:Ce,Y:P,Z:_e}=v;if(n.eql(_e,n.ONE))return{x:Ce,y:P};const Le=v.is0();I==null&&(I=Le?n.ONE:n.inv(_e));const Ye=n.mul(Ce,I),je=n.mul(P,I),K=n.mul(_e,I);if(Le)return{x:n.ZERO,y:n.ZERO};if(!n.eql(K,n.ONE))throw new Error("invZ was invalid");return{x:Ye,y:je}}),W=memoized(v=>{if(v.is0()){if(e.allowInfinityPoint&&!n.is0(v.Y))return;throw new Error("bad point: ZERO")}const{x:I,y:Ce}=v.toAffine();if(!n.isValid(I)||!n.isValid(Ce))throw new Error("bad point: x or y not field elements");if(!k(I,Ce))throw new Error("bad point: equation left != right");if(!v.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function We(v,I,Ce,P,_e){return Ce=new Xe(n.mul(Ce.X,v),Ce.Y,Ce.Z),I=negateCt(P,I),Ce=negateCt(_e,Ce),I.add(Ce)}class Xe{static BASE=new Xe(o.Gx,o.Gy,n.ONE);static ZERO=new Xe(n.ZERO,n.ONE,n.ZERO);static Fp=n;static Fn=s;X;Y;Z;constructor(I,Ce,P){this.X=O("x",I),this.Y=O("y",Ce,!0),this.Z=O("z",P),Object.freeze(this)}static CURVE(){return o}static fromAffine(I){const{x:Ce,y:P}=I||{};if(!I||!n.isValid(Ce)||!n.isValid(P))throw new Error("invalid affine point");if(I instanceof Xe)throw new Error("projective point not allowed");return n.is0(Ce)&&n.is0(P)?Xe.ZERO:new Xe(Ce,P,n.ONE)}static fromBytes(I){const Ce=Xe.fromAffine(R(abytes(I,void 0,"point")));return Ce.assertValidity(),Ce}static fromHex(I){return Xe.fromBytes(hexToBytes$5(I))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(I=8,Ce=!0){return Ve.createCache(this,I),Ce||this.multiply(_3n$2),this}assertValidity(){W(this)}hasEvenY(){const{y:I}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(I)}equals(I){$e(I);const{X:Ce,Y:P,Z:_e}=this,{X:Le,Y:Ye,Z:je}=I,K=n.eql(n.mul(Ce,je),n.mul(Le,_e)),L=n.eql(n.mul(P,je),n.mul(Ye,_e));return K&&L}negate(){return new Xe(this.X,n.neg(this.Y),this.Z)}double(){const{a:I,b:Ce}=o,P=n.mul(Ce,_3n$2),{X:_e,Y:Le,Z:Ye}=this;let je=n.ZERO,K=n.ZERO,L=n.ZERO,st=n.mul(_e,_e),dt=n.mul(Le,Le),Je=n.mul(Ye,Ye),pt=n.mul(_e,Le);return pt=n.add(pt,pt),L=n.mul(_e,Ye),L=n.add(L,L),je=n.mul(I,L),K=n.mul(P,Je),K=n.add(je,K),je=n.sub(dt,K),K=n.add(dt,K),K=n.mul(je,K),je=n.mul(pt,je),L=n.mul(P,L),Je=n.mul(I,Je),pt=n.sub(st,Je),pt=n.mul(I,pt),pt=n.add(pt,L),L=n.add(st,st),st=n.add(L,st),st=n.add(st,Je),st=n.mul(st,pt),K=n.add(K,st),Je=n.mul(Le,Ye),Je=n.add(Je,Je),st=n.mul(Je,pt),je=n.sub(je,st),L=n.mul(Je,dt),L=n.add(L,L),L=n.add(L,L),new Xe(je,K,L)}add(I){$e(I);const{X:Ce,Y:P,Z:_e}=this,{X:Le,Y:Ye,Z:je}=I;let K=n.ZERO,L=n.ZERO,st=n.ZERO;const dt=o.a,Je=n.mul(o.b,_3n$2);let pt=n.mul(Ce,Le),rr=n.mul(P,Ye),cr=n.mul(_e,je),fr=n.add(Ce,P),ir=n.add(Le,Ye);fr=n.mul(fr,ir),ir=n.add(pt,rr),fr=n.sub(fr,ir),ir=n.add(Ce,_e);let ft=n.add(Le,je);return ir=n.mul(ir,ft),ft=n.add(pt,cr),ir=n.sub(ir,ft),ft=n.add(P,_e),K=n.add(Ye,je),ft=n.mul(ft,K),K=n.add(rr,cr),ft=n.sub(ft,K),st=n.mul(dt,ir),K=n.mul(Je,cr),st=n.add(K,st),K=n.sub(rr,st),st=n.add(rr,st),L=n.mul(K,st),rr=n.add(pt,pt),rr=n.add(rr,pt),cr=n.mul(dt,cr),ir=n.mul(Je,ir),rr=n.add(rr,cr),cr=n.sub(pt,cr),cr=n.mul(dt,cr),ir=n.add(ir,cr),pt=n.mul(rr,ir),L=n.add(L,pt),pt=n.mul(ft,ir),K=n.mul(fr,K),K=n.sub(K,pt),pt=n.mul(fr,rr),st=n.mul(ft,st),st=n.add(st,pt),new Xe(K,L,st)}subtract(I){return this.add(I.negate())}is0(){return this.equals(Xe.ZERO)}multiply(I){const{endo:Ce}=e;if(!s.isValidNot0(I))throw new Error("invalid scalar: out of range");let P,_e;const Le=Ye=>Ve.cached(this,Ye,je=>normalizeZ(Xe,je));if(Ce){const{k1neg:Ye,k1:je,k2neg:K,k2:L}=ze(I),{p:st,f:dt}=Le(je),{p:Je,f:pt}=Le(L);_e=dt.add(pt),P=We(Ce.beta,st,Je,Ye,K)}else{const{p:Ye,f:je}=Le(I);P=Ye,_e=je}return normalizeZ(Xe,[P,_e])[0]}multiplyUnsafe(I){const{endo:Ce}=e,P=this;if(!s.isValid(I))throw new Error("invalid scalar: out of range");if(I===_0n$5||P.is0())return Xe.ZERO;if(I===_1n$5)return P;if(Ve.hasCache(this))return this.multiply(I);if(Ce){const{k1neg:_e,k1:Le,k2neg:Ye,k2:je}=ze(I),{p1:K,p2:L}=mulEndoUnsafe(Xe,P,Le,je);return We(Ce.beta,K,L,_e,Ye)}else return Ve.unsafe(P,I)}toAffine(I){return q(this,I)}isTorsionFree(){const{isTorsionFree:I}=e;return c===_1n$5?!0:I?I(Xe,this):Ve.unsafe(this,u).is0()}clearCofactor(){const{clearCofactor:I}=e;return c===_1n$5?this:I?I(Xe,this):this.multiplyUnsafe(c)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}toBytes(I=!0){return abool(I,"isCompressed"),this.assertValidity(),b(Xe,this,I)}toHex(I=!0){return bytesToHex$3(this.toBytes(I))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}const it=s.BITS,Ve=new wNAF$1(Xe,e.endo?Math.ceil(it/2):it);return Xe.BASE.precompute(8),Xe}function pprefix(t){return Uint8Array.of(t?2:3)}function getWLengths(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function ecdh(t,e={}){const{Fn:r}=t,n=e.randomBytes||randomBytes$2,s=Object.assign(getWLengths(t.Fp,r),{seed:getMinHashLength$1(r.ORDER)});function o(b){try{const R=r.fromBytes(b);return r.isValidNot0(R)}catch{return!1}}function c(b,R){const{publicKey:D,publicKeyUncompressed:k}=s;try{const Re=b.length;return R===!0&&Re!==D||R===!1&&Re!==k?!1:!!t.fromBytes(b)}catch{return!1}}function u(b=n(s.seed)){return mapHashToField$1(abytes(b,s.seed,"seed"),r.ORDER)}function f(b,R=!0){return t.BASE.multiply(r.fromBytes(b)).toBytes(R)}function x(b){const{secretKey:R,publicKey:D,publicKeyUncompressed:k}=s;if(!isBytes$2(b)||"_lengths"in r&&r._lengths||R===D)return;const Re=abytes(b,void 0,"key").length;return Re===D||Re===k}function p(b,R,D=!0){if(x(b)===!0)throw new Error("first arg must be private key");if(x(R)===!1)throw new Error("second arg must be public key");const k=r.fromBytes(b);return t.fromBytes(R).multiply(k).toBytes(D)}const g={isValidSecretKey:o,isValidPublicKey:c,randomSecretKey:u},y=createKeygen(u,f);return Object.freeze({getPublicKey:f,getSharedSecret:p,keygen:y,Point:t,utils:g,lengths:s})}function ecdsa(t,e,r={}){ahash(e),validateObject$1(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),r=Object.assign({},r);const n=r.randomBytes||randomBytes$2,s=r.hmac||((Ce,P)=>hmac$3(e,Ce,P)),{Fp:o,Fn:c}=t,{ORDER:u,BITS:f}=c,{keygen:x,getPublicKey:p,getSharedSecret:g,utils:y,lengths:b}=ecdh(t,r),R={prehash:!0,lowS:typeof r.lowS=="boolean"?r.lowS:!0,format:"compact",extraEntropy:!1},D=u*_2n$4<o.ORDER;function k(Ce){const P=u>>_1n$5;return Ce>P}function Re(Ce,P){if(!c.isValidNot0(P))throw new Error(`invalid signature ${Ce}: out of range 1..Point.Fn.ORDER`);return P}function Fe(){if(D)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function O(Ce,P){validateSigFormat(P);const _e=b.signature,Le=P==="compact"?_e:P==="recovered"?_e+1:void 0;return abytes(Ce,Le)}class $e{r;s;recovery;constructor(P,_e,Le){if(this.r=Re("r",P),this.s=Re("s",_e),Le!=null){if(Fe(),![0,1,2,3].includes(Le))throw new Error("invalid recovery id");this.recovery=Le}Object.freeze(this)}static fromBytes(P,_e=R.format){O(P,_e);let Le;if(_e==="der"){const{r:L,s:st}=DER$1.toSig(abytes(P));return new $e(L,st)}_e==="recovered"&&(Le=P[0],_e="compact",P=P.subarray(1));const Ye=b.signature/2,je=P.subarray(0,Ye),K=P.subarray(Ye,Ye*2);return new $e(c.fromBytes(je),c.fromBytes(K),Le)}static fromHex(P,_e){return this.fromBytes(hexToBytes$5(P),_e)}assertRecovery(){const{recovery:P}=this;if(P==null)throw new Error("invalid recovery id: must be present");return P}addRecoveryBit(P){return new $e(this.r,this.s,P)}recoverPublicKey(P){const{r:_e,s:Le}=this,Ye=this.assertRecovery(),je=Ye===2||Ye===3?_e+u:_e;if(!o.isValid(je))throw new Error("invalid recovery id: sig.r+curve.n != R.x");const K=o.toBytes(je),L=t.fromBytes(concatBytes$3(pprefix((Ye&1)===0),K)),st=c.inv(je),dt=q(abytes(P,void 0,"msgHash")),Je=c.create(-dt*st),pt=c.create(Le*st),rr=t.BASE.multiplyUnsafe(Je).add(L.multiplyUnsafe(pt));if(rr.is0())throw new Error("invalid recovery: point at infinify");return rr.assertValidity(),rr}hasHighS(){return k(this.s)}toBytes(P=R.format){if(validateSigFormat(P),P==="der")return hexToBytes$5(DER$1.hexFromSig(this));const{r:_e,s:Le}=this,Ye=c.toBytes(_e),je=c.toBytes(Le);return P==="recovered"?(Fe(),concatBytes$3(Uint8Array.of(this.assertRecovery()),Ye,je)):concatBytes$3(Ye,je)}toHex(P){return bytesToHex$3(this.toBytes(P))}}const ze=r.bits2int||function(P){if(P.length>8192)throw new Error("input is too large");const _e=bytesToNumberBE$1(P),Le=P.length*8-f;return Le>0?_e>>BigInt(Le):_e},q=r.bits2int_modN||function(P){return c.create(ze(P))},W=bitMask$1(f);function We(Ce){return aInRange("num < 2^"+f,Ce,_0n$5,W),c.toBytes(Ce)}function Xe(Ce,P){return abytes(Ce,void 0,"message"),P?abytes(e(Ce),void 0,"prehashed message"):Ce}function it(Ce,P,_e){const{lowS:Le,prehash:Ye,extraEntropy:je}=validateSigOpts(_e,R);Ce=Xe(Ce,Ye);const K=q(Ce),L=c.fromBytes(P);if(!c.isValidNot0(L))throw new Error("invalid private key");const st=[We(L),We(K)];if(je!=null&&je!==!1){const rr=je===!0?n(b.secretKey):je;st.push(abytes(rr,void 0,"extraEntropy"))}const dt=concatBytes$3(...st),Je=K;function pt(rr){const cr=ze(rr);if(!c.isValidNot0(cr))return;const fr=c.inv(cr),ir=t.BASE.multiply(cr).toAffine(),ft=c.create(ir.x);if(ft===_0n$5)return;const nr=c.create(fr*c.create(Je+ft*L));if(nr===_0n$5)return;let lr=(ir.x===ft?0:2)|Number(ir.y&_1n$5),er=nr;return Le&&k(nr)&&(er=c.neg(nr),lr^=1),new $e(ft,er,D?void 0:lr)}return{seed:dt,k2sig:pt}}function Ve(Ce,P,_e={}){const{seed:Le,k2sig:Ye}=it(Ce,P,_e);return createHmacDrbg$1(e.outputLen,c.BYTES,s)(Le,Ye).toBytes(_e.format)}function v(Ce,P,_e,Le={}){const{lowS:Ye,prehash:je,format:K}=validateSigOpts(Le,R);if(_e=abytes(_e,void 0,"publicKey"),P=Xe(P,je),!isBytes$2(Ce)){const L=Ce instanceof $e?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+L)}O(Ce,K);try{const L=$e.fromBytes(Ce,K),st=t.fromBytes(_e);if(Ye&&L.hasHighS())return!1;const{r:dt,s:Je}=L,pt=q(P),rr=c.inv(Je),cr=c.create(pt*rr),fr=c.create(dt*rr),ir=t.BASE.multiplyUnsafe(cr).add(st.multiplyUnsafe(fr));return ir.is0()?!1:c.create(ir.x)===dt}catch{return!1}}function I(Ce,P,_e={}){const{prehash:Le}=validateSigOpts(_e,R);return P=Xe(P,Le),$e.fromBytes(Ce,"recovered").recoverPublicKey(P).toBytes()}return Object.freeze({keygen:x,getPublicKey:p,getSharedSecret:g,utils:y,lengths:b,Point:t,sign:Ve,verify:v,recoverPublicKey:I,Signature:$e,hash:e})}const secp256k1_CURVE={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},secp256k1_ENDO={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},_2n$3=BigInt(2);function sqrtMod$1(t){const e=secp256k1_CURVE.p,r=BigInt(3),n=BigInt(6),s=BigInt(11),o=BigInt(22),c=BigInt(23),u=BigInt(44),f=BigInt(88),x=t*t*t%e,p=x*x*t%e,g=pow2$1(p,r,e)*p%e,y=pow2$1(g,r,e)*p%e,b=pow2$1(y,_2n$3,e)*x%e,R=pow2$1(b,s,e)*b%e,D=pow2$1(R,o,e)*R%e,k=pow2$1(D,u,e)*D%e,Re=pow2$1(k,f,e)*k%e,Fe=pow2$1(Re,u,e)*D%e,O=pow2$1(Fe,r,e)*p%e,$e=pow2$1(O,c,e)*R%e,ze=pow2$1($e,n,e)*x%e,q=pow2$1(ze,_2n$3,e);if(!Fpk1.eql(Fpk1.sqr(q),t))throw new Error("Cannot find square root");return q}const Fpk1=Field$1(secp256k1_CURVE.p,{sqrt:sqrtMod$1}),Pointk1=weierstrass$2(secp256k1_CURVE,{Fp:Fpk1,endo:secp256k1_ENDO}),secp256k1$2=ecdsa(Pointk1,sha256$3),Rho160=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Id160=Uint8Array.from(new Array(16).fill(0).map((t,e)=>e)),Pi160=Id160.map(t=>(9*t+5)%16),idxLR=(()=>{const r=[[Id160],[Pi160]];for(let n=0;n<4;n++)for(let s of r)s.push(s[n].map(o=>Rho160[o]));return r})(),idxL=idxLR[0],idxR=idxLR[1],shifts160=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(t=>Uint8Array.from(t)),shiftsL160=idxL.map((t,e)=>t.map(r=>shifts160[e][r])),shiftsR160=idxR.map((t,e)=>t.map(r=>shifts160[e][r])),Kl160=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),Kr160=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function ripemd_f(t,e,r,n){return t===0?e^r^n:t===1?e&r|~e&n:t===2?(e|~r)^n:t===3?e&n|r&~n:e^(r|~n)}const BUF_160=new Uint32Array(16);class _RIPEMD160 extends HashMD{h0=1732584193;h1=-271733879;h2=-1732584194;h3=271733878;h4=-1009589776;constructor(){super(64,20,8,!0)}get(){const{h0:e,h1:r,h2:n,h3:s,h4:o}=this;return[e,r,n,s,o]}set(e,r,n,s,o){this.h0=e|0,this.h1=r|0,this.h2=n|0,this.h3=s|0,this.h4=o|0}process(e,r){for(let b=0;b<16;b++,r+=4)BUF_160[b]=e.getUint32(r,!0);let n=this.h0|0,s=n,o=this.h1|0,c=o,u=this.h2|0,f=u,x=this.h3|0,p=x,g=this.h4|0,y=g;for(let b=0;b<5;b++){const R=4-b,D=Kl160[b],k=Kr160[b],Re=idxL[b],Fe=idxR[b],O=shiftsL160[b],$e=shiftsR160[b];for(let ze=0;ze<16;ze++){const q=rotl$2(n+ripemd_f(b,o,u,x)+BUF_160[Re[ze]]+D,O[ze])+g|0;n=g,g=x,x=rotl$2(u,10)|0,u=o,o=q}for(let ze=0;ze<16;ze++){const q=rotl$2(s+ripemd_f(R,c,f,p)+BUF_160[Fe[ze]]+k,$e[ze])+y|0;s=y,y=p,p=rotl$2(f,10)|0,f=c,c=q}}this.set(this.h1+u+p|0,this.h2+x+y|0,this.h3+g+s|0,this.h4+n+c|0,this.h0+o+f|0)}roundClean(){clean(BUF_160)}destroy(){this.destroyed=!0,clean(this.buffer),this.set(0,0,0,0,0)}}const ripemd160$1=createHasher(()=>new _RIPEMD160);function isBytes$1(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function isArrayOf(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function afn(t){if(typeof t!="function")throw new Error("function expected");return!0}function astr(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function anumber(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function aArr(t){if(!Array.isArray(t))throw new Error("array expected")}function astrArr(t,e){if(!isArrayOf(!0,e))throw new Error(`${t}: array of strings expected`)}function anumArr(t,e){if(!isArrayOf(!1,e))throw new Error(`${t}: array of numbers expected`)}function chain$1(...t){const e=o=>o,r=(o,c)=>u=>o(c(u)),n=t.map(o=>o.encode).reduceRight(r,e),s=t.map(o=>o.decode).reduce(r,e);return{encode:n,decode:s}}function alphabet$1(t){const e=typeof t=="string"?t.split(""):t,r=e.length;astrArr("alphabet",e);const n=new Map(e.map((s,o)=>[s,o]));return{encode:s=>(aArr(s),s.map(o=>{if(!Number.isSafeInteger(o)||o<0||o>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${o}". Allowed: ${t}`);return e[o]})),decode:s=>(aArr(s),s.map(o=>{astr("alphabet.decode",o);const c=n.get(o);if(c===void 0)throw new Error(`Unknown letter: "${o}". Allowed: ${t}`);return c}))}}function join$1(t=""){return astr("join",t),{encode:e=>(astrArr("join.decode",e),e.join(t)),decode:e=>(astr("join.decode",e),e.split(t))}}function convertRadix$1(t,e,r){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(aArr(t),!t.length)return[];let n=0;const s=[],o=Array.from(t,u=>{if(anumber(u),u<0||u>=e)throw new Error(`invalid integer: ${u}`);return u}),c=o.length;for(;;){let u=0,f=!0;for(let x=n;x<c;x++){const p=o[x],g=e*u,y=g+p;if(!Number.isSafeInteger(y)||g/e!==u||y-p!==g)throw new Error("convertRadix: carry overflow");const b=y/r;u=y%r;const R=Math.floor(b);if(o[x]=R,!Number.isSafeInteger(R)||R*r+u!==y)throw new Error("convertRadix: carry overflow");if(f)R?f=!1:n=x;else continue}if(s.push(u),f)break}for(let u=0;u<t.length-1&&t[u]===0;u++)s.push(0);return s.reverse()}function radix$1(t){anumber(t);const e=2**8;return{encode:r=>{if(!isBytes$1(r))throw new Error("radix.encode input should be Uint8Array");return convertRadix$1(Array.from(r),e,t)},decode:r=>(anumArr("radix.decode",r),Uint8Array.from(convertRadix$1(r,t,e)))}}function checksum(t,e){return anumber(t),afn(e),{encode(r){if(!isBytes$1(r))throw new Error("checksum.encode: input should be Uint8Array");const n=e(r).slice(0,t),s=new Uint8Array(r.length+t);return s.set(r),s.set(n,r.length),s},decode(r){if(!isBytes$1(r))throw new Error("checksum.decode: input should be Uint8Array");const n=r.slice(0,-t),s=r.slice(-t),o=e(n).slice(0,t);for(let c=0;c<t;c++)if(o[c]!==s[c])throw new Error("Invalid checksum");return n}}}const genBase58$1=t=>chain$1(radix$1(58),alphabet$1(t),join$1("")),base58$2=genBase58$1("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),createBase58check=t=>chain$1(checksum(4,e=>t(t(e))),base58$2);const Point$1=secp256k1$2.Point,{Fn}=Point$1,base58check=createBase58check(sha256$3),MASTER_SECRET=Uint8Array.from("Bitcoin seed".split(""),t=>t.charCodeAt(0)),BITCOIN_VERSIONS={private:76066276,public:76067358},HARDENED_OFFSET=2147483648,hash160$1=t=>ripemd160$1(sha256$3(t)),fromU32=t=>createView$3(t).getUint32(0,!1),toU32=t=>{if(!Number.isSafeInteger(t)||t<0||t>2**32-1)throw new Error("invalid number, should be from 0 to 2**32-1, got "+t);const e=new Uint8Array(4);return createView$3(e).setUint32(0,t,!1),e};class HDKey{get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return fromU32(this.pubHash)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this._privateKey||null}get publicKey(){return this._publicKey||null}get privateExtendedKey(){const e=this._privateKey;if(!e)throw new Error("No private key");return base58check.encode(this.serialize(this.versions.private,concatBytes$3(Uint8Array.of(0),e)))}get publicExtendedKey(){if(!this._publicKey)throw new Error("No public key");return base58check.encode(this.serialize(this.versions.public,this._publicKey))}static fromMasterSeed(e,r=BITCOIN_VERSIONS){if(abytes(e),8*e.length<128||8*e.length>512)throw new Error("HDKey: seed length must be between 128 and 512 bits; 256 bits is advised, got "+e.length);const n=hmac$3(sha512$1,MASTER_SECRET,e),s=n.slice(0,32),o=n.slice(32);return new HDKey({versions:r,chainCode:o,privateKey:s})}static fromExtendedKey(e,r=BITCOIN_VERSIONS){const n=base58check.decode(e),s=createView$3(n),o=s.getUint32(0,!1),c={versions:r,depth:n[4],parentFingerprint:s.getUint32(5,!1),index:s.getUint32(9,!1),chainCode:n.slice(13,45)},u=n.slice(45),f=u[0]===0;if(o!==r[f?"private":"public"])throw new Error("Version mismatch");return f?new HDKey({...c,privateKey:u.slice(1)}):new HDKey({...c,publicKey:u})}static fromJSON(e){return HDKey.fromExtendedKey(e.xpriv)}versions;depth=0;index=0;chainCode=null;parentFingerprint=0;_privateKey;_publicKey;pubHash;constructor(e){if(!e||typeof e!="object")throw new Error("HDKey.constructor must not be called directly");if(this.versions=e.versions||BITCOIN_VERSIONS,this.depth=e.depth||0,this.chainCode=e.chainCode||null,this.index=e.index||0,this.parentFingerprint=e.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(this.depth>255)throw new Error("HDKey: depth exceeds the serializable value 255");if(e.publicKey&&e.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(e.privateKey){if(!secp256k1$2.utils.isValidSecretKey(e.privateKey))throw new Error("Invalid private key");this._privateKey=e.privateKey,this._publicKey=secp256k1$2.getPublicKey(e.privateKey,!0)}else if(e.publicKey)this._publicKey=Point$1.fromBytes(e.publicKey).toBytes(!0);else throw new Error("HDKey: no public or private key provided");this.pubHash=hash160$1(this._publicKey)}derive(e){if(!/^[mM]'?/.test(e))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(e))return this;const r=e.replace(/^[mM]'?\//,"").split("/");let n=this;for(const s of r){const o=/^(\d+)('?)$/.exec(s),c=o&&o[1];if(!o||o.length!==3||typeof c!="string")throw new Error("invalid child index: "+s);let u=+c;if(!Number.isSafeInteger(u)||u>=HARDENED_OFFSET)throw new Error("Invalid index");o[2]==="'"&&(u+=HARDENED_OFFSET),n=n.deriveChild(u)}return n}deriveChild(e){if(!this._publicKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let r=toU32(e);if(e>=HARDENED_OFFSET){const f=this._privateKey;if(!f)throw new Error("Could not derive hardened child key");r=concatBytes$3(Uint8Array.of(0),f,r)}else r=concatBytes$3(this._publicKey,r);const n=hmac$3(sha512$1,this.chainCode,r),s=n.slice(0,32),o=n.slice(32);if(!secp256k1$2.utils.isValidSecretKey(s))throw new Error("Tweak bigger than curve order");const c={versions:this.versions,chainCode:o,depth:this.depth+1,parentFingerprint:this.fingerprint,index:e},u=Fn.fromBytes(s);try{if(this._privateKey){const f=Fn.create(Fn.fromBytes(this._privateKey)+u);if(!Fn.isValidNot0(f))throw new Error("The tweak was out of range or the resulted private key is invalid");c.privateKey=Fn.toBytes(f)}else{const f=Point$1.fromBytes(this._publicKey).add(Point$1.BASE.multiply(u));if(f.equals(Point$1.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");c.publicKey=f.toBytes(!0)}return new HDKey(c)}catch{return this.deriveChild(e+1)}}sign(e){if(!this._privateKey)throw new Error("No privateKey set!");return abytes(e,32),secp256k1$2.sign(e,this._privateKey,{prehash:!1})}verify(e,r){if(abytes(e,32),abytes(r,64),!this._publicKey)throw new Error("No publicKey set!");return secp256k1$2.verify(r,e,this._publicKey,{prehash:!1})}wipePrivateData(){return this._privateKey&&(this._privateKey.fill(0),this._privateKey=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(e,r){if(!this.chainCode)throw new Error("No chainCode set");return abytes(r,33),concatBytes$3(toU32(e),new Uint8Array([this.depth]),toU32(this.parentFingerprint),toU32(this.index),this.chainCode,r)}}function number$4(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function bytes$2(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function hash$2(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$4(t.outputLen),number$4(t.blockLen)}function exists$2(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function output$2(t,e){bytes$2(t);const r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const crypto$4=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const u8a$2=t=>t instanceof Uint8Array,createView$2=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),rotr$1=(t,e)=>t<<32-e|t>>>e,isLE$2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$2)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$3(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function toBytes$2(t){if(typeof t=="string"&&(t=utf8ToBytes$3(t)),!u8a$2(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function concatBytes$2(...t){const e=new Uint8Array(t.reduce((n,s)=>n+s.length,0));let r=0;return t.forEach(n=>{if(!u8a$2(n))throw new Error("Uint8Array expected");e.set(n,r),r+=n.length}),e}let Hash$2=class{clone(){return this._cloneInto()}};function wrapConstructor$1(t){const e=n=>t().update(toBytes$2(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function randomBytes$1(t=32){if(crypto$4&&typeof crypto$4.getRandomValues=="function")return crypto$4.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$2(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),o=BigInt(4294967295),c=Number(r>>s&o),u=Number(r&o),f=n?4:0,x=n?0:4;t.setUint32(e+f,c,n),t.setUint32(e+x,u,n)}let SHA2$1=class extends Hash$2{constructor(e,r,n,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$2(this.buffer)}update(e){exists$2(this);const{view:r,buffer:n,blockLen:s}=this;e=toBytes$2(e);const o=e.length;for(let c=0;c<o;){const u=Math.min(s-this.pos,o-c);if(u===s){const f=createView$2(e);for(;s<=o-c;c+=s)this.process(f,c);continue}n.set(e.subarray(c,c+u),this.pos),this.pos+=u,c+=u,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){exists$2(this),output$2(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:o}=this;let{pos:c}=this;r[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>s-c&&(this.process(n,0),c=0);for(let g=c;g<s;g++)r[g]=0;setBigUint64$2(n,s-8,BigInt(this.length*8),o),this.process(n,0);const u=createView$2(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const x=f/4,p=this.get();if(x>p.length)throw new Error("_sha2: outputLen bigger than state");for(let g=0;g<x;g++)u.setUint32(4*g,p[g],o)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:o,destroyed:c,pos:u}=this;return e.length=s,e.pos=u,e.finished=o,e.destroyed=c,s%r&&e.buffer.set(n),e}};const Chi$1=(t,e,r)=>t&e^~t&r,Maj$1=(t,e,r)=>t&e^t&r^e&r,SHA256_K$1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV$1=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$1=new Uint32Array(64);let SHA256$1=class extends SHA2$1{constructor(){super(64,32,8,!1),this.A=IV$1[0]|0,this.B=IV$1[1]|0,this.C=IV$1[2]|0,this.D=IV$1[3]|0,this.E=IV$1[4]|0,this.F=IV$1[5]|0,this.G=IV$1[6]|0,this.H=IV$1[7]|0}get(){const{A:e,B:r,C:n,D:s,E:o,F:c,G:u,H:f}=this;return[e,r,n,s,o,c,u,f]}set(e,r,n,s,o,c,u,f){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=o|0,this.F=c|0,this.G=u|0,this.H=f|0}process(e,r){for(let g=0;g<16;g++,r+=4)SHA256_W$1[g]=e.getUint32(r,!1);for(let g=16;g<64;g++){const y=SHA256_W$1[g-15],b=SHA256_W$1[g-2],R=rotr$1(y,7)^rotr$1(y,18)^y>>>3,D=rotr$1(b,17)^rotr$1(b,19)^b>>>10;SHA256_W$1[g]=D+SHA256_W$1[g-7]+R+SHA256_W$1[g-16]|0}let{A:n,B:s,C:o,D:c,E:u,F:f,G:x,H:p}=this;for(let g=0;g<64;g++){const y=rotr$1(u,6)^rotr$1(u,11)^rotr$1(u,25),b=p+y+Chi$1(u,f,x)+SHA256_K$1[g]+SHA256_W$1[g]|0,D=(rotr$1(n,2)^rotr$1(n,13)^rotr$1(n,22))+Maj$1(n,s,o)|0;p=x,x=f,f=u,u=c+b|0,c=o,o=s,s=n,n=b+D|0}n=n+this.A|0,s=s+this.B|0,o=o+this.C|0,c=c+this.D|0,u=u+this.E|0,f=f+this.F|0,x=x+this.G|0,p=p+this.H|0,this.set(n,s,o,c,u,f,x,p)}roundClean(){SHA256_W$1.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const sha256$2=wrapConstructor$1(()=>new SHA256$1);const _0n$4=BigInt(0),_1n$4=BigInt(1),_2n$2=BigInt(2),u8a$1=t=>t instanceof Uint8Array,hexes$2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$2(t){if(!u8a$1(t))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=hexes$2[t[r]];return e}function numberToHexUnpadded(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function hexToNumber(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function hexToBytes$4(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(e/2);for(let n=0;n<r.length;n++){const s=n*2,o=t.slice(s,s+2),c=Number.parseInt(o,16);if(Number.isNaN(c)||c<0)throw new Error("Invalid byte sequence");r[n]=c}return r}function bytesToNumberBE(t){return hexToNumber(bytesToHex$2(t))}function bytesToNumberLE(t){if(!u8a$1(t))throw new Error("Uint8Array expected");return hexToNumber(bytesToHex$2(Uint8Array.from(t).reverse()))}function numberToBytesBE(t,e){return hexToBytes$4(t.toString(16).padStart(e*2,"0"))}function numberToBytesLE(t,e){return numberToBytesBE(t,e).reverse()}function numberToVarBytesBE(t){return hexToBytes$4(numberToHexUnpadded(t))}function ensureBytes(t,e,r){let n;if(typeof e=="string")try{n=hexToBytes$4(e)}catch(o){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${o}`)}else if(u8a$1(e))n=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(`${t} expected ${r} bytes, got ${s}`);return n}function concatBytes$1(...t){const e=new Uint8Array(t.reduce((n,s)=>n+s.length,0));let r=0;return t.forEach(n=>{if(!u8a$1(n))throw new Error("Uint8Array expected");e.set(n,r),r+=n.length}),e}function equalBytes$1(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function utf8ToBytes$2(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function bitLen(t){let e;for(e=0;t>_0n$4;t>>=_1n$4,e+=1);return e}function bitGet(t,e){return t>>BigInt(e)&_1n$4}const bitSet=(t,e,r)=>t|(r?_1n$4:_0n$4)<<BigInt(e),bitMask=t=>(_2n$2<<BigInt(t-1))-_1n$4,u8n=t=>new Uint8Array(t),u8fr=t=>Uint8Array.from(t);function createHmacDrbg(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=u8n(t),s=u8n(t),o=0;const c=()=>{n.fill(1),s.fill(0),o=0},u=(...g)=>r(s,n,...g),f=(g=u8n())=>{s=u(u8fr([0]),g),n=u(),g.length!==0&&(s=u(u8fr([1]),g),n=u())},x=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let g=0;const y=[];for(;g<e;){n=u();const b=n.slice();y.push(b),g+=n.length}return concatBytes$1(...y)};return(g,y)=>{c(),f(g);let b;for(;!(b=y(x()));)f();return c(),b}}const validatorFns={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function validateObject(t,e,r={}){const n=(s,o,c)=>{const u=validatorFns[o];if(typeof u!="function")throw new Error(`Invalid validator "${o}", expected function`);const f=t[s];if(!(c&&f===void 0)&&!u(f,t))throw new Error(`Invalid param ${String(s)}=${f} (${typeof f}), expected ${o}`)};for(const[s,o]of Object.entries(e))n(s,o,!1);for(const[s,o]of Object.entries(r))n(s,o,!0);return t}const ut=Object.freeze(Object.defineProperty({__proto__:null,bitGet,bitLen,bitMask,bitSet,bytesToHex:bytesToHex$2,bytesToNumberBE,bytesToNumberLE,concatBytes:concatBytes$1,createHmacDrbg,ensureBytes,equalBytes:equalBytes$1,hexToBytes:hexToBytes$4,hexToNumber,numberToBytesBE,numberToBytesLE,numberToHexUnpadded,numberToVarBytesBE,utf8ToBytes:utf8ToBytes$2,validateObject},Symbol.toStringTag,{value:"Module"}));const _0n$3=BigInt(0),_1n$3=BigInt(1),_2n$1=BigInt(2),_3n$1=BigInt(3),_4n=BigInt(4),_5n=BigInt(5),_8n=BigInt(8);BigInt(9);BigInt(16);function mod(t,e){const r=t%e;return r>=_0n$3?r:e+r}function pow$1(t,e,r){if(r<=_0n$3||e<_0n$3)throw new Error("Expected power/modulo > 0");if(r===_1n$3)return _0n$3;let n=_1n$3;for(;e>_0n$3;)e&_1n$3&&(n=n*t%r),t=t*t%r,e>>=_1n$3;return n}function pow2(t,e,r){let n=t;for(;e-- >_0n$3;)n*=n,n%=r;return n}function invert(t,e){if(t===_0n$3||e<=_0n$3)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=mod(t,e),n=e,s=_0n$3,o=_1n$3;for(;r!==_0n$3;){const u=n/r,f=n%r,x=s-o*u;n=r,r=f,s=o,o=x}if(n!==_1n$3)throw new Error("invert: does not exist");return mod(s,e)}function tonelliShanks(t){const e=(t-_1n$3)/_2n$1;let r,n,s;for(r=t-_1n$3,n=0;r%_2n$1===_0n$3;r/=_2n$1,n++);for(s=_2n$1;s<t&&pow$1(s,e,t)!==t-_1n$3;s++);if(n===1){const c=(t+_1n$3)/_4n;return function(f,x){const p=f.pow(x,c);if(!f.eql(f.sqr(p),x))throw new Error("Cannot find square root");return p}}const o=(r+_1n$3)/_2n$1;return function(u,f){if(u.pow(f,e)===u.neg(u.ONE))throw new Error("Cannot find square root");let x=n,p=u.pow(u.mul(u.ONE,s),r),g=u.pow(f,o),y=u.pow(f,r);for(;!u.eql(y,u.ONE);){if(u.eql(y,u.ZERO))return u.ZERO;let b=1;for(let D=u.sqr(y);b<x&&!u.eql(D,u.ONE);b++)D=u.sqr(D);const R=u.pow(p,_1n$3<<BigInt(x-b-1));p=u.sqr(R),g=u.mul(g,R),y=u.mul(y,p),x=b}return g}}function FpSqrt(t){if(t%_4n===_3n$1){const e=(t+_1n$3)/_4n;return function(n,s){const o=n.pow(s,e);if(!n.eql(n.sqr(o),s))throw new Error("Cannot find square root");return o}}if(t%_8n===_5n){const e=(t-_5n)/_8n;return function(n,s){const o=n.mul(s,_2n$1),c=n.pow(o,e),u=n.mul(s,c),f=n.mul(n.mul(u,_2n$1),c),x=n.mul(u,n.sub(f,n.ONE));if(!n.eql(n.sqr(x),s))throw new Error("Cannot find square root");return x}}return tonelliShanks(t)}const FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=FIELD_FIELDS.reduce((n,s)=>(n[s]="function",n),e);return validateObject(t,r)}function FpPow(t,e,r){if(r<_0n$3)throw new Error("Expected power > 0");if(r===_0n$3)return t.ONE;if(r===_1n$3)return e;let n=t.ONE,s=e;for(;r>_0n$3;)r&_1n$3&&(n=t.mul(n,s)),s=t.sqr(s),r>>=_1n$3;return n}function FpInvertBatch(t,e){const r=new Array(e.length),n=e.reduce((o,c,u)=>t.is0(c)?o:(r[u]=o,t.mul(o,c)),t.ONE),s=t.inv(n);return e.reduceRight((o,c,u)=>t.is0(c)?o:(r[u]=t.mul(o,r[u]),t.mul(o,c)),s),r}function nLength(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Field(t,e,r=!1,n={}){if(t<=_0n$3)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:s,nByteLength:o}=nLength(t,e);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const c=FpSqrt(t),u=Object.freeze({ORDER:t,BITS:s,BYTES:o,MASK:bitMask(s),ZERO:_0n$3,ONE:_1n$3,create:f=>mod(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof f}`);return _0n$3<=f&&f<t},is0:f=>f===_0n$3,isOdd:f=>(f&_1n$3)===_1n$3,neg:f=>mod(-f,t),eql:(f,x)=>f===x,sqr:f=>mod(f*f,t),add:(f,x)=>mod(f+x,t),sub:(f,x)=>mod(f-x,t),mul:(f,x)=>mod(f*x,t),pow:(f,x)=>FpPow(u,f,x),div:(f,x)=>mod(f*invert(x,t),t),sqrN:f=>f*f,addN:(f,x)=>f+x,subN:(f,x)=>f-x,mulN:(f,x)=>f*x,inv:f=>invert(f,t),sqrt:n.sqrt||(f=>c(u,f)),invertBatch:f=>FpInvertBatch(u,f),cmov:(f,x,p)=>p?x:f,toBytes:f=>r?numberToBytesLE(f,o):numberToBytesBE(f,o),fromBytes:f=>{if(f.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${f.length}`);return r?bytesToNumberLE(f):bytesToNumberBE(f)}});return Object.freeze(u)}function getFieldBytesLength(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function getMinHashLength(t){const e=getFieldBytesLength(t);return e+Math.ceil(e/2)}function mapHashToField(t,e,r=!1){const n=t.length,s=getFieldBytesLength(e),o=getMinHashLength(e);if(n<16||n<o||n>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${n}`);const c=r?bytesToNumberBE(t):bytesToNumberLE(t),u=mod(c,e-_1n$3)+_1n$3;return r?numberToBytesLE(u,s):numberToBytesBE(u,s)}const _0n$2=BigInt(0),_1n$2=BigInt(1);function wNAF(t,e){const r=(s,o)=>{const c=o.negate();return s?c:o},n=s=>{const o=Math.ceil(e/s)+1,c=2**(s-1);return{windows:o,windowSize:c}};return{constTimeNegate:r,unsafeLadder(s,o){let c=t.ZERO,u=s;for(;o>_0n$2;)o&_1n$2&&(c=c.add(u)),u=u.double(),o>>=_1n$2;return c},precomputeWindow(s,o){const{windows:c,windowSize:u}=n(o),f=[];let x=s,p=x;for(let g=0;g<c;g++){p=x,f.push(p);for(let y=1;y<u;y++)p=p.add(x),f.push(p);x=p.double()}return f},wNAF(s,o,c){const{windows:u,windowSize:f}=n(s);let x=t.ZERO,p=t.BASE;const g=BigInt(2**s-1),y=2**s,b=BigInt(s);for(let R=0;R<u;R++){const D=R*f;let k=Number(c&g);c>>=b,k>f&&(k-=y,c+=_1n$2);const Re=D,Fe=D+Math.abs(k)-1,O=R%2!==0,$e=k<0;k===0?p=p.add(r(O,o[Re])):x=x.add(r($e,o[Fe]))}return{p:x,f:p}},wNAFCached(s,o,c,u){const f=s._WINDOW_SIZE||1;let x=o.get(s);return x||(x=this.precomputeWindow(s,f),f!==1&&o.set(s,u(x))),this.wNAF(f,x,c)}}}function validateBasic(t){return validateField(t.Fp),validateObject(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function validatePointOpts(t){const e=validateBasic(t);validateObject(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:s}=e;if(r){if(!n.eql(s,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut,DER={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){const{Err:e}=DER;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const r=t[1],n=t.subarray(2,r+2);if(!r||n.length!==r)throw new e("Invalid signature integer: wrong length");if(n[0]&128)throw new e("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:b2n(n),l:t.subarray(r+2)}},toSig(t){const{Err:e}=DER,r=typeof t=="string"?h2b(t):t;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let n=r.length;if(n<2||r[0]!=48)throw new e("Invalid signature tag");if(r[1]!==n-2)throw new e("Invalid signature: incorrect length");const{d:s,l:o}=DER._parseInt(r.subarray(2)),{d:c,l:u}=DER._parseInt(o);if(u.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:c}},hexFromSig(t){const e=x=>Number.parseInt(x[0],16)&8?"00"+x:x,r=x=>{const p=x.toString(16);return p.length&1?`0${p}`:p},n=e(r(t.s)),s=e(r(t.r)),o=n.length/2,c=s.length/2,u=r(o),f=r(c);return`30${r(c+o+4)}02${f}${s}02${u}${n}`}},_0n$1=BigInt(0),_1n$1=BigInt(1);BigInt(2);const _3n=BigInt(3);BigInt(4);function weierstrassPoints(t){const e=validatePointOpts(t),{Fp:r}=e,n=e.toBytes||((R,D,k)=>{const Re=D.toAffine();return concatBytes$1(Uint8Array.from([4]),r.toBytes(Re.x),r.toBytes(Re.y))}),s=e.fromBytes||(R=>{const D=R.subarray(1),k=r.fromBytes(D.subarray(0,r.BYTES)),Re=r.fromBytes(D.subarray(r.BYTES,2*r.BYTES));return{x:k,y:Re}});function o(R){const{a:D,b:k}=e,Re=r.sqr(R),Fe=r.mul(Re,R);return r.add(r.add(Fe,r.mul(R,D)),k)}if(!r.eql(r.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function c(R){return typeof R=="bigint"&&_0n$1<R&&R<e.n}function u(R){if(!c(R))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function f(R){const{allowedPrivateKeyLengths:D,nByteLength:k,wrapPrivateKey:Re,n:Fe}=e;if(D&&typeof R!="bigint"){if(R instanceof Uint8Array&&(R=bytesToHex$2(R)),typeof R!="string"||!D.includes(R.length))throw new Error("Invalid key");R=R.padStart(k*2,"0")}let O;try{O=typeof R=="bigint"?R:bytesToNumberBE(ensureBytes("private key",R,k))}catch{throw new Error(`private key must be ${k} bytes, hex or bigint, not ${typeof R}`)}return Re&&(O=mod(O,Fe)),u(O),O}const x=new Map;function p(R){if(!(R instanceof g))throw new Error("ProjectivePoint expected")}class g{constructor(D,k,Re){if(this.px=D,this.py=k,this.pz=Re,D==null||!r.isValid(D))throw new Error("x required");if(k==null||!r.isValid(k))throw new Error("y required");if(Re==null||!r.isValid(Re))throw new Error("z required")}static fromAffine(D){const{x:k,y:Re}=D||{};if(!D||!r.isValid(k)||!r.isValid(Re))throw new Error("invalid affine point");if(D instanceof g)throw new Error("projective point not allowed");const Fe=O=>r.eql(O,r.ZERO);return Fe(k)&&Fe(Re)?g.ZERO:new g(k,Re,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(D){const k=r.invertBatch(D.map(Re=>Re.pz));return D.map((Re,Fe)=>Re.toAffine(k[Fe])).map(g.fromAffine)}static fromHex(D){const k=g.fromAffine(s(ensureBytes("pointHex",D)));return k.assertValidity(),k}static fromPrivateKey(D){return g.BASE.multiply(f(D))}_setWindowSize(D){this._WINDOW_SIZE=D,x.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:D,y:k}=this.toAffine();if(!r.isValid(D)||!r.isValid(k))throw new Error("bad point: x or y not FE");const Re=r.sqr(k),Fe=o(D);if(!r.eql(Re,Fe))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:D}=this.toAffine();if(r.isOdd)return!r.isOdd(D);throw new Error("Field doesn't support isOdd")}equals(D){p(D);const{px:k,py:Re,pz:Fe}=this,{px:O,py:$e,pz:ze}=D,q=r.eql(r.mul(k,ze),r.mul(O,Fe)),W=r.eql(r.mul(Re,ze),r.mul($e,Fe));return q&&W}negate(){return new g(this.px,r.neg(this.py),this.pz)}double(){const{a:D,b:k}=e,Re=r.mul(k,_3n),{px:Fe,py:O,pz:$e}=this;let ze=r.ZERO,q=r.ZERO,W=r.ZERO,We=r.mul(Fe,Fe),Xe=r.mul(O,O),it=r.mul($e,$e),Ve=r.mul(Fe,O);return Ve=r.add(Ve,Ve),W=r.mul(Fe,$e),W=r.add(W,W),ze=r.mul(D,W),q=r.mul(Re,it),q=r.add(ze,q),ze=r.sub(Xe,q),q=r.add(Xe,q),q=r.mul(ze,q),ze=r.mul(Ve,ze),W=r.mul(Re,W),it=r.mul(D,it),Ve=r.sub(We,it),Ve=r.mul(D,Ve),Ve=r.add(Ve,W),W=r.add(We,We),We=r.add(W,We),We=r.add(We,it),We=r.mul(We,Ve),q=r.add(q,We),it=r.mul(O,$e),it=r.add(it,it),We=r.mul(it,Ve),ze=r.sub(ze,We),W=r.mul(it,Xe),W=r.add(W,W),W=r.add(W,W),new g(ze,q,W)}add(D){p(D);const{px:k,py:Re,pz:Fe}=this,{px:O,py:$e,pz:ze}=D;let q=r.ZERO,W=r.ZERO,We=r.ZERO;const Xe=e.a,it=r.mul(e.b,_3n);let Ve=r.mul(k,O),v=r.mul(Re,$e),I=r.mul(Fe,ze),Ce=r.add(k,Re),P=r.add(O,$e);Ce=r.mul(Ce,P),P=r.add(Ve,v),Ce=r.sub(Ce,P),P=r.add(k,Fe);let _e=r.add(O,ze);return P=r.mul(P,_e),_e=r.add(Ve,I),P=r.sub(P,_e),_e=r.add(Re,Fe),q=r.add($e,ze),_e=r.mul(_e,q),q=r.add(v,I),_e=r.sub(_e,q),We=r.mul(Xe,P),q=r.mul(it,I),We=r.add(q,We),q=r.sub(v,We),We=r.add(v,We),W=r.mul(q,We),v=r.add(Ve,Ve),v=r.add(v,Ve),I=r.mul(Xe,I),P=r.mul(it,P),v=r.add(v,I),I=r.sub(Ve,I),I=r.mul(Xe,I),P=r.add(P,I),Ve=r.mul(v,P),W=r.add(W,Ve),Ve=r.mul(_e,P),q=r.mul(Ce,q),q=r.sub(q,Ve),Ve=r.mul(Ce,v),We=r.mul(_e,We),We=r.add(We,Ve),new g(q,W,We)}subtract(D){return this.add(D.negate())}is0(){return this.equals(g.ZERO)}wNAF(D){return b.wNAFCached(this,x,D,k=>{const Re=r.invertBatch(k.map(Fe=>Fe.pz));return k.map((Fe,O)=>Fe.toAffine(Re[O])).map(g.fromAffine)})}multiplyUnsafe(D){const k=g.ZERO;if(D===_0n$1)return k;if(u(D),D===_1n$1)return this;const{endo:Re}=e;if(!Re)return b.unsafeLadder(this,D);let{k1neg:Fe,k1:O,k2neg:$e,k2:ze}=Re.splitScalar(D),q=k,W=k,We=this;for(;O>_0n$1||ze>_0n$1;)O&_1n$1&&(q=q.add(We)),ze&_1n$1&&(W=W.add(We)),We=We.double(),O>>=_1n$1,ze>>=_1n$1;return Fe&&(q=q.negate()),$e&&(W=W.negate()),W=new g(r.mul(W.px,Re.beta),W.py,W.pz),q.add(W)}multiply(D){u(D);let k=D,Re,Fe;const{endo:O}=e;if(O){const{k1neg:$e,k1:ze,k2neg:q,k2:W}=O.splitScalar(k);let{p:We,f:Xe}=this.wNAF(ze),{p:it,f:Ve}=this.wNAF(W);We=b.constTimeNegate($e,We),it=b.constTimeNegate(q,it),it=new g(r.mul(it.px,O.beta),it.py,it.pz),Re=We.add(it),Fe=Xe.add(Ve)}else{const{p:$e,f:ze}=this.wNAF(k);Re=$e,Fe=ze}return g.normalizeZ([Re,Fe])[0]}multiplyAndAddUnsafe(D,k,Re){const Fe=g.BASE,O=(ze,q)=>q===_0n$1||q===_1n$1||!ze.equals(Fe)?ze.multiplyUnsafe(q):ze.multiply(q),$e=O(this,k).add(O(D,Re));return $e.is0()?void 0:$e}toAffine(D){const{px:k,py:Re,pz:Fe}=this,O=this.is0();D==null&&(D=O?r.ONE:r.inv(Fe));const $e=r.mul(k,D),ze=r.mul(Re,D),q=r.mul(Fe,D);if(O)return{x:r.ZERO,y:r.ZERO};if(!r.eql(q,r.ONE))throw new Error("invZ was invalid");return{x:$e,y:ze}}isTorsionFree(){const{h:D,isTorsionFree:k}=e;if(D===_1n$1)return!0;if(k)return k(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:D,clearCofactor:k}=e;return D===_1n$1?this:k?k(g,this):this.multiplyUnsafe(e.h)}toRawBytes(D=!0){return this.assertValidity(),n(g,this,D)}toHex(D=!0){return bytesToHex$2(this.toRawBytes(D))}}g.BASE=new g(e.Gx,e.Gy,r.ONE),g.ZERO=new g(r.ZERO,r.ONE,r.ZERO);const y=e.nBitLength,b=wNAF(g,e.endo?Math.ceil(y/2):y);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:f,weierstrassEquation:o,isWithinCurveOrder:c}}function validateOpts(t){const e=validateBasic(t);return validateObject(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass$1(t){const e=validateOpts(t),{Fp:r,n}=e,s=r.BYTES+1,o=2*r.BYTES+1;function c(P){return _0n$1<P&&P<r.ORDER}function u(P){return mod(P,n)}function f(P){return invert(P,n)}const{ProjectivePoint:x,normPrivateKeyToScalar:p,weierstrassEquation:g,isWithinCurveOrder:y}=weierstrassPoints({...e,toBytes(P,_e,Le){const Ye=_e.toAffine(),je=r.toBytes(Ye.x),K=concatBytes$1;return Le?K(Uint8Array.from([_e.hasEvenY()?2:3]),je):K(Uint8Array.from([4]),je,r.toBytes(Ye.y))},fromBytes(P){const _e=P.length,Le=P[0],Ye=P.subarray(1);if(_e===s&&(Le===2||Le===3)){const je=bytesToNumberBE(Ye);if(!c(je))throw new Error("Point is not on curve");const K=g(je);let L=r.sqrt(K);const st=(L&_1n$1)===_1n$1;return(Le&1)===1!==st&&(L=r.neg(L)),{x:je,y:L}}else if(_e===o&&Le===4){const je=r.fromBytes(Ye.subarray(0,r.BYTES)),K=r.fromBytes(Ye.subarray(r.BYTES,2*r.BYTES));return{x:je,y:K}}else throw new Error(`Point of length ${_e} was invalid. Expected ${s} compressed bytes or ${o} uncompressed bytes`)}}),b=P=>bytesToHex$2(numberToBytesBE(P,e.nByteLength));function R(P){const _e=n>>_1n$1;return P>_e}function D(P){return R(P)?u(-P):P}const k=(P,_e,Le)=>bytesToNumberBE(P.slice(_e,Le));class Re{constructor(_e,Le,Ye){this.r=_e,this.s=Le,this.recovery=Ye,this.assertValidity()}static fromCompact(_e){const Le=e.nByteLength;return _e=ensureBytes("compactSignature",_e,Le*2),new Re(k(_e,0,Le),k(_e,Le,2*Le))}static fromDER(_e){const{r:Le,s:Ye}=DER.toSig(ensureBytes("DER",_e));return new Re(Le,Ye)}assertValidity(){if(!y(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!y(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(_e){return new Re(this.r,this.s,_e)}recoverPublicKey(_e){const{r:Le,s:Ye,recovery:je}=this,K=W(ensureBytes("msgHash",_e));if(je==null||![0,1,2,3].includes(je))throw new Error("recovery id invalid");const L=je===2||je===3?Le+e.n:Le;if(L>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const st=(je&1)===0?"02":"03",dt=x.fromHex(st+b(L)),Je=f(L),pt=u(-K*Je),rr=u(Ye*Je),cr=x.BASE.multiplyAndAddUnsafe(dt,pt,rr);if(!cr)throw new Error("point at infinify");return cr.assertValidity(),cr}hasHighS(){return R(this.s)}normalizeS(){return this.hasHighS()?new Re(this.r,u(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$4(this.toDERHex())}toDERHex(){return DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$4(this.toCompactHex())}toCompactHex(){return b(this.r)+b(this.s)}}const Fe={isValidPrivateKey(P){try{return p(P),!0}catch{return!1}},normPrivateKeyToScalar:p,randomPrivateKey:()=>{const P=getMinHashLength(e.n);return mapHashToField(e.randomBytes(P),e.n)},precompute(P=8,_e=x.BASE){return _e._setWindowSize(P),_e.multiply(BigInt(3)),_e}};function O(P,_e=!0){return x.fromPrivateKey(P).toRawBytes(_e)}function $e(P){const _e=P instanceof Uint8Array,Le=typeof P=="string",Ye=(_e||Le)&&P.length;return _e?Ye===s||Ye===o:Le?Ye===2*s||Ye===2*o:P instanceof x}function ze(P,_e,Le=!0){if($e(P))throw new Error("first arg must be private key");if(!$e(_e))throw new Error("second arg must be public key");return x.fromHex(_e).multiply(p(P)).toRawBytes(Le)}const q=e.bits2int||function(P){const _e=bytesToNumberBE(P),Le=P.length*8-e.nBitLength;return Le>0?_e>>BigInt(Le):_e},W=e.bits2int_modN||function(P){return u(q(P))},We=bitMask(e.nBitLength);function Xe(P){if(typeof P!="bigint")throw new Error("bigint expected");if(!(_0n$1<=P&&P<We))throw new Error(`bigint expected < 2^${e.nBitLength}`);return numberToBytesBE(P,e.nByteLength)}function it(P,_e,Le=Ve){if(["recovered","canonical"].some(ir=>ir in Le))throw new Error("sign() legacy options not supported");const{hash:Ye,randomBytes:je}=e;let{lowS:K,prehash:L,extraEntropy:st}=Le;K==null&&(K=!0),P=ensureBytes("msgHash",P),L&&(P=ensureBytes("prehashed msgHash",Ye(P)));const dt=W(P),Je=p(_e),pt=[Xe(Je),Xe(dt)];if(st!=null){const ir=st===!0?je(r.BYTES):st;pt.push(ensureBytes("extraEntropy",ir))}const rr=concatBytes$1(...pt),cr=dt;function fr(ir){const ft=q(ir);if(!y(ft))return;const nr=f(ft),lr=x.BASE.multiply(ft).toAffine(),er=u(lr.x);if(er===_0n$1)return;const pr=u(nr*u(cr+er*Je));if(pr===_0n$1)return;let Er=(lr.x===er?0:2)|Number(lr.y&_1n$1),xr=pr;return K&&R(pr)&&(xr=D(pr),Er^=1),new Re(er,xr,Er)}return{seed:rr,k2sig:fr}}const Ve={lowS:e.lowS,prehash:!1},v={lowS:e.lowS,prehash:!1};function I(P,_e,Le=Ve){const{seed:Ye,k2sig:je}=it(P,_e,Le),K=e;return createHmacDrbg(K.hash.outputLen,K.nByteLength,K.hmac)(Ye,je)}x.BASE._setWindowSize(8);function Ce(P,_e,Le,Ye=v){const je=P;if(_e=ensureBytes("msgHash",_e),Le=ensureBytes("publicKey",Le),"strict"in Ye)throw new Error("options.strict was renamed to lowS");const{lowS:K,prehash:L}=Ye;let st,dt;try{if(typeof je=="string"||je instanceof Uint8Array)try{st=Re.fromDER(je)}catch(lr){if(!(lr instanceof DER.Err))throw lr;st=Re.fromCompact(je)}else if(typeof je=="object"&&typeof je.r=="bigint"&&typeof je.s=="bigint"){const{r:lr,s:er}=je;st=new Re(lr,er)}else throw new Error("PARSE");dt=x.fromHex(Le)}catch(lr){if(lr.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(K&&st.hasHighS())return!1;L&&(_e=e.hash(_e));const{r:Je,s:pt}=st,rr=W(_e),cr=f(pt),fr=u(rr*cr),ir=u(Je*cr),ft=x.BASE.multiplyAndAddUnsafe(dt,fr,ir)?.toAffine();return ft?u(ft.x)===Je:!1}return{CURVE:e,getPublicKey:O,getSharedSecret:ze,sign:I,verify:Ce,ProjectivePoint:x,Signature:Re,utils:Fe}}let HMAC$1=class extends Hash$2{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,hash$2(e);const n=toBytes$2(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(n.length>s?e.create().update(n).digest():n);for(let c=0;c<o.length;c++)o[c]^=54;this.iHash.update(o),this.oHash=e.create();for(let c=0;c<o.length;c++)o[c]^=106;this.oHash.update(o),o.fill(0)}update(e){return exists$2(this),this.iHash.update(e),this}digestInto(e){exists$2(this),bytes$2(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:s,destroyed:o,blockLen:c,outputLen:u}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=c,e.outputLen=u,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$2=(t,e,r)=>new HMAC$1(t,e).update(r).digest();hmac$2.create=(t,e)=>new HMAC$1(t,e);function getHash(t){return{hash:t,hmac:(e,...r)=>hmac$2(t,e,concatBytes$2(...r)),randomBytes:randomBytes$1}}function createCurve(t,e){const r=n=>weierstrass$1({...t,...getHash(n)});return Object.freeze({...r(e),create:r})}const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n=BigInt(1),_2n=BigInt(2),divNearest=(t,e)=>(t+e/_2n)/e;function sqrtMod(t){const e=secp256k1P,r=BigInt(3),n=BigInt(6),s=BigInt(11),o=BigInt(22),c=BigInt(23),u=BigInt(44),f=BigInt(88),x=t*t*t%e,p=x*x*t%e,g=pow2(p,r,e)*p%e,y=pow2(g,r,e)*p%e,b=pow2(y,_2n,e)*x%e,R=pow2(b,s,e)*b%e,D=pow2(R,o,e)*R%e,k=pow2(D,u,e)*D%e,Re=pow2(k,f,e)*k%e,Fe=pow2(Re,u,e)*D%e,O=pow2(Fe,r,e)*p%e,$e=pow2(O,c,e)*R%e,ze=pow2($e,n,e)*x%e,q=pow2(ze,_2n,e);if(!Fp.eql(Fp.sqr(q),t))throw new Error("Cannot find square root");return q}const Fp=Field(secp256k1P,void 0,void 0,{sqrt:sqrtMod}),secp256k1$1=createCurve({a:BigInt(0),b:BigInt(7),Fp,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=secp256k1N,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-_1n*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=r,c=BigInt("0x100000000000000000000000000000000"),u=divNearest(o*t,e),f=divNearest(-n*t,e);let x=mod(t-u*r-f*s,e),p=mod(-u*n-f*o,e);const g=x>c,y=p>c;if(g&&(x=e-x),y&&(p=e-p),x>c||p>c)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:g,k1:x,k2neg:y,k2:p}}}},sha256$2),_0n=BigInt(0),fe=t=>typeof t=="bigint"&&_0n<t&&t<secp256k1P,ge=t=>typeof t=="bigint"&&_0n<t&&t<secp256k1N,TAGGED_HASH_PREFIXES$1={};function taggedHash$1(t,...e){let r=TAGGED_HASH_PREFIXES$1[t];if(r===void 0){const n=sha256$2(Uint8Array.from(t,s=>s.charCodeAt(0)));r=concatBytes$1(n,n),TAGGED_HASH_PREFIXES$1[t]=r}return sha256$2(concatBytes$1(r,...e))}const pointToBytes=t=>t.toRawBytes(!0).slice(1),numTo32b=t=>numberToBytesBE(t,32),modP=t=>mod(t,secp256k1P),modN=t=>mod(t,secp256k1N),Point=secp256k1$1.ProjectivePoint,GmulAdd=(t,e,r)=>Point.BASE.multiplyAndAddUnsafe(t,e,r);function schnorrGetExtPubKey(t){let e=secp256k1$1.utils.normPrivateKeyToScalar(t),r=Point.fromPrivateKey(e);return{scalar:r.hasEvenY()?e:modN(-e),bytes:pointToBytes(r)}}function lift_x(t){if(!fe(t))throw new Error("bad x: need 0 < x < p");const e=modP(t*t),r=modP(e*t+BigInt(7));let n=sqrtMod(r);n%_2n!==_0n&&(n=modP(-n));const s=new Point(t,n,_1n);return s.assertValidity(),s}function challenge(...t){return modN(bytesToNumberBE(taggedHash$1("BIP0340/challenge",...t)))}function schnorrGetPublicKey(t){return schnorrGetExtPubKey(t).bytes}function schnorrSign(t,e,r=randomBytes$1(32)){const n=ensureBytes("message",t),{bytes:s,scalar:o}=schnorrGetExtPubKey(e),c=ensureBytes("auxRand",r,32),u=numTo32b(o^bytesToNumberBE(taggedHash$1("BIP0340/aux",c))),f=taggedHash$1("BIP0340/nonce",u,s,n),x=modN(bytesToNumberBE(f));if(x===_0n)throw new Error("sign failed: k is zero");const{bytes:p,scalar:g}=schnorrGetExtPubKey(x),y=challenge(p,s,n),b=new Uint8Array(64);if(b.set(p,0),b.set(numTo32b(modN(g+y*o)),32),!schnorrVerify(b,n,s))throw new Error("sign: Invalid signature produced");return b}function schnorrVerify(t,e,r){const n=ensureBytes("signature",t,64),s=ensureBytes("message",e),o=ensureBytes("publicKey",r,32);try{const c=lift_x(bytesToNumberBE(o)),u=bytesToNumberBE(n.subarray(0,32));if(!fe(u))return!1;const f=bytesToNumberBE(n.subarray(32,64));if(!ge(f))return!1;const x=challenge(numTo32b(u),pointToBytes(c),s),p=GmulAdd(c,f,modN(-x));return!(!p||!p.hasEvenY()||p.toAffine().x!==u)}catch{return!1}}const schnorr={getPublicKey:schnorrGetPublicKey,sign:schnorrSign,verify:schnorrVerify,utils:{randomPrivateKey:secp256k1$1.utils.randomPrivateKey,lift_x,pointToBytes,numberToBytesBE,bytesToNumberBE,taggedHash:taggedHash$1,mod}},crypto$3=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const u8a=t=>t instanceof Uint8Array,u32$1=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),createView$1=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),rotr=(t,e)=>t<<32-e|t>>>e,isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$1)throw new Error("Non little-endian hardware is not supported");const hexes$1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$1(t){if(!u8a(t))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=hexes$1[t[r]];return e}function hexToBytes$3(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(e/2);for(let n=0;n<r.length;n++){const s=n*2,o=t.slice(s,s+2),c=Number.parseInt(o,16);if(Number.isNaN(c)||c<0)throw new Error("Invalid byte sequence");r[n]=c}return r}function utf8ToBytes$1(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function toBytes$1(t){if(typeof t=="string"&&(t=utf8ToBytes$1(t)),!u8a(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function concatBytes(...t){const e=new Uint8Array(t.reduce((n,s)=>n+s.length,0));let r=0;return t.forEach(n=>{if(!u8a(n))throw new Error("Uint8Array expected");e.set(n,r),r+=n.length}),e}let Hash$1=class{clone(){return this._cloneInto()}};const isPlainObject=t=>Object.prototype.toString.call(t)==="[object Object]"&&t.constructor===Object;function checkOpts$1(t,e){if(e!==void 0&&(typeof e!="object"||!isPlainObject(e)))throw new Error("Options should be object or undefined");return Object.assign(t,e)}function wrapConstructor(t){const e=n=>t().update(toBytes$1(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function randomBytes(t=32){if(crypto$3&&typeof crypto$3.getRandomValues=="function")return crypto$3.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function number$3(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function bool$1(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function bytes$1(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function hash$1(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$3(t.outputLen),number$3(t.blockLen)}function exists$1(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function output$1(t,e){bytes$1(t);const r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const assert$3={number:number$3,bool:bool$1,bytes:bytes$1,hash:hash$1,exists:exists$1,output:output$1};function setBigUint64$1(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),o=BigInt(4294967295),c=Number(r>>s&o),u=Number(r&o),f=n?4:0,x=n?0:4;t.setUint32(e+f,c,n),t.setUint32(e+x,u,n)}class SHA2 extends Hash$1{constructor(e,r,n,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$1(this.buffer)}update(e){assert$3.exists(this);const{view:r,buffer:n,blockLen:s}=this;e=toBytes$1(e);const o=e.length;for(let c=0;c<o;){const u=Math.min(s-this.pos,o-c);if(u===s){const f=createView$1(e);for(;s<=o-c;c+=s)this.process(f,c);continue}n.set(e.subarray(c,c+u),this.pos),this.pos+=u,c+=u,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){assert$3.exists(this),assert$3.output(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:o}=this;let{pos:c}=this;r[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>s-c&&(this.process(n,0),c=0);for(let g=c;g<s;g++)r[g]=0;setBigUint64$1(n,s-8,BigInt(this.length*8),o),this.process(n,0);const u=createView$1(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const x=f/4,p=this.get();if(x>p.length)throw new Error("_sha2: outputLen bigger than state");for(let g=0;g<x;g++)u.setUint32(4*g,p[g],o)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:o,destroyed:c,pos:u}=this;return e.length=s,e.pos=u,e.finished=o,e.destroyed=c,s%r&&e.buffer.set(n),e}}const Chi=(t,e,r)=>t&e^~t&r,Maj=(t,e,r)=>t&e^t&r^e&r,SHA256_K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W=new Uint32Array(64);class SHA256 extends SHA2{constructor(){super(64,32,8,!1),this.A=IV[0]|0,this.B=IV[1]|0,this.C=IV[2]|0,this.D=IV[3]|0,this.E=IV[4]|0,this.F=IV[5]|0,this.G=IV[6]|0,this.H=IV[7]|0}get(){const{A:e,B:r,C:n,D:s,E:o,F:c,G:u,H:f}=this;return[e,r,n,s,o,c,u,f]}set(e,r,n,s,o,c,u,f){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=o|0,this.F=c|0,this.G=u|0,this.H=f|0}process(e,r){for(let g=0;g<16;g++,r+=4)SHA256_W[g]=e.getUint32(r,!1);for(let g=16;g<64;g++){const y=SHA256_W[g-15],b=SHA256_W[g-2],R=rotr(y,7)^rotr(y,18)^y>>>3,D=rotr(b,17)^rotr(b,19)^b>>>10;SHA256_W[g]=D+SHA256_W[g-7]+R+SHA256_W[g-16]|0}let{A:n,B:s,C:o,D:c,E:u,F:f,G:x,H:p}=this;for(let g=0;g<64;g++){const y=rotr(u,6)^rotr(u,11)^rotr(u,25),b=p+y+Chi(u,f,x)+SHA256_K[g]+SHA256_W[g]|0,D=(rotr(n,2)^rotr(n,13)^rotr(n,22))+Maj(n,s,o)|0;p=x,x=f,f=u,u=c+b|0,c=o,o=s,s=n,n=b+D|0}n=n+this.A|0,s=s+this.B|0,o=o+this.C|0,c=c+this.D|0,u=u+this.E|0,f=f+this.F|0,x=x+this.G|0,p=p+this.H|0,this.set(n,s,o,c,u,f,x,p)}roundClean(){SHA256_W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class SHA224 extends SHA256{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const sha256$1=wrapConstructor(()=>new SHA256);wrapConstructor(()=>new SHA224);function assertNumber(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function chain(...t){const e=(s,o)=>c=>s(o(c)),r=Array.from(t).reverse().reduce((s,o)=>s?e(s,o.encode):o.encode,void 0),n=t.reduce((s,o)=>s?e(s,o.decode):o.decode,void 0);return{encode:r,decode:n}}function alphabet(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(r=>{if(assertNumber(r),r<0||r>=t.length)throw new Error(`Digit index outside alphabet: ${r} (alphabet: ${t.length})`);return t[r]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(r=>{if(typeof r!="string")throw new Error(`alphabet.decode: not string element=${r}`);const n=t.indexOf(r);if(n===-1)throw new Error(`Unknown letter: "${r}". Allowed: ${t}`);return n})}}}function join(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let r of e)if(typeof r!="string")throw new Error(`join.encode: non-string input=${r}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function padding(t,e="="){if(assertNumber(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let n of r)if(typeof n!="string")throw new Error(`padding.encode: non-string input=${n}`);for(;r.length*t%8;)r.push(e);return r},decode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of r)if(typeof s!="string")throw new Error(`padding.decode: non-string input=${s}`);let n=r.length;if(n*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if(!((n-1)*t%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,n)}}}function normalize$1(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function convertRadix(t,e,r){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let n=0;const s=[],o=Array.from(t);for(o.forEach(c=>{if(assertNumber(c),c<0||c>=e)throw new Error(`Wrong integer: ${c}`)});;){let c=0,u=!0;for(let f=n;f<o.length;f++){const x=o[f],p=e*c+x;if(!Number.isSafeInteger(p)||e*c/e!==c||p-x!==e*c)throw new Error("convertRadix: carry overflow");if(c=p%r,o[f]=Math.floor(p/r),!Number.isSafeInteger(o[f])||o[f]*r+c!==p)throw new Error("convertRadix: carry overflow");if(u)o[f]?u=!1:n=f;else continue}if(s.push(c),u)break}for(let c=0;c<t.length-1&&t[c]===0;c++)s.push(0);return s.reverse()}const gcd=(t,e)=>e?gcd(e,t%e):t,radix2carry=(t,e)=>t+(e-gcd(t,e));function convertRadix2(t,e,r,n){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(radix2carry(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${radix2carry(e,r)}`);let s=0,o=0;const c=2**r-1,u=[];for(const f of t){if(assertNumber(f),f>=2**e)throw new Error(`convertRadix2: invalid data word=${f} from=${e}`);if(s=s<<e|f,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=r;o-=r)u.push((s>>o-r&c)>>>0);s&=2**o-1}if(s=s<<r-o&c,!n&&o>=e)throw new Error("Excess padding");if(!n&&s)throw new Error(`Non-zero padding: ${s}`);return n&&o>0&&u.push(s>>>0),u}function radix(t){return assertNumber(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return convertRadix(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(convertRadix(e,t,2**8))}}}function radix2(t,e=!1){if(assertNumber(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,t)>32||radix2carry(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(r),8,t,!e)},decode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(convertRadix2(r,t,8,e))}}}function unsafeWrapper(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const base16=chain(radix2(4),alphabet("0123456789ABCDEF"),join("")),base32=chain(radix2(5),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),padding(5),join(""));chain(radix2(5),alphabet("0123456789ABCDEFGHIJKLMNOPQRSTUV"),padding(5),join(""));chain(radix2(5),alphabet("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),join(""),normalize$1(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const base64=chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),padding(6),join("")),base64url=chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),padding(6),join("")),genBase58=t=>chain(radix(58),alphabet(t),join("")),base58$1=genBase58("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");genBase58("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");genBase58("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const XMR_BLOCK_LEN=[0,2,3,5,6,7,9,10,11],base58xmr={encode(t){let e="";for(let r=0;r<t.length;r+=8){const n=t.subarray(r,r+8);e+=base58$1.encode(n).padStart(XMR_BLOCK_LEN[n.length],"1")}return e},decode(t){let e=[];for(let r=0;r<t.length;r+=11){const n=t.slice(r,r+11),s=XMR_BLOCK_LEN.indexOf(n.length),o=base58$1.decode(n);for(let c=0;c<o.length-s;c++)if(o[c]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(o.slice(o.length-s)))}return Uint8Array.from(e)}},BECH_ALPHABET=chain(alphabet("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join("")),POLYMOD_GENERATORS=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod(t){const e=t>>25;let r=(t&33554431)<<5;for(let n=0;n<POLYMOD_GENERATORS.length;n++)(e>>n&1)===1&&(r^=POLYMOD_GENERATORS[n]);return r}function bechChecksum(t,e,r=1){const n=t.length;let s=1;for(let o=0;o<n;o++){const c=t.charCodeAt(o);if(c<33||c>126)throw new Error(`Invalid prefix (${t})`);s=bech32Polymod(s)^c>>5}s=bech32Polymod(s);for(let o=0;o<n;o++)s=bech32Polymod(s)^t.charCodeAt(o)&31;for(let o of e)s=bech32Polymod(s)^o;for(let o=0;o<6;o++)s=bech32Polymod(s);return s^=r,BECH_ALPHABET.encode(convertRadix2([s%2**30],30,5,!1))}function genBech32(t){const e=t==="bech32"?1:734539939,r=radix2(5),n=r.decode,s=r.encode,o=unsafeWrapper(n);function c(p,g,y=90){if(typeof p!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof p}`);if(!Array.isArray(g)||g.length&&typeof g[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof g}`);const b=p.length+7+g.length;if(y!==!1&&b>y)throw new TypeError(`Length ${b} exceeds limit ${y}`);return p=p.toLowerCase(),`${p}1${BECH_ALPHABET.encode(g)}${bechChecksum(p,g,e)}`}function u(p,g=90){if(typeof p!="string")throw new Error(`bech32.decode input should be string, not ${typeof p}`);if(p.length<8||g!==!1&&p.length>g)throw new TypeError(`Wrong string length: ${p.length} (${p}). Expected (8..${g})`);const y=p.toLowerCase();if(p!==y&&p!==p.toUpperCase())throw new Error("String must be lowercase or uppercase");p=y;const b=p.lastIndexOf("1");if(b===0||b===-1)throw new Error('Letter "1" must be present between prefix and data only');const R=p.slice(0,b),D=p.slice(b+1);if(D.length<6)throw new Error("Data must be at least 6 characters long");const k=BECH_ALPHABET.decode(D).slice(0,-6),Re=bechChecksum(R,k,e);if(!D.endsWith(Re))throw new Error(`Invalid checksum in ${p}: expected "${Re}"`);return{prefix:R,words:k}}const f=unsafeWrapper(u);function x(p){const{prefix:g,words:y}=u(p,!1);return{prefix:g,words:y,bytes:n(y)}}return{encode:c,decode:u,decodeToBytes:x,decodeUnsafe:f,fromWords:n,fromWordsUnsafe:o,toWords:s}}const bech32$1=genBech32("bech32");genBech32("bech32m");const utf8={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},hex=chain(radix2(4),alphabet("0123456789abcdef"),join(""),normalize$1(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),CODERS={utf8,hex,base16,base32,base64,base64url,base58:base58$1,base58xmr};`${Object.keys(CODERS).join(", ")}`;function number$2(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function bool(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function isBytes(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function bytes(t,...e){if(!isBytes(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function exists(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function output(t,e){bytes(t);const r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const u32=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),createView=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");const hexes=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex(t){bytes(t);let e="";for(let r=0;r<t.length;r++)e+=hexes[t[r]];return e}const asciis={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16(t){if(t>=asciis._0&&t<=asciis._9)return t-asciis._0;if(t>=asciis._A&&t<=asciis._F)return t-(asciis._A-10);if(t>=asciis._a&&t<=asciis._f)return t-(asciis._a-10)}function hexToBytes$2(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,o=0;s<r;s++,o+=2){const c=asciiToBase16(t.charCodeAt(o)),u=asciiToBase16(t.charCodeAt(o+1));if(c===void 0||u===void 0){const f=t[o]+t[o+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+o)}n[s]=c*16+u}return n}function utf8ToBytes(t){if(typeof t!="string")throw new Error(`string expected, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function toBytes(t){if(typeof t=="string")t=utf8ToBytes(t);else if(isBytes(t))t=t.slice();else throw new Error(`Uint8Array expected, got ${typeof t}`);return t}function checkOpts(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function equalBytes(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const wrapCipher=(t,e)=>(Object.assign(e,t),e);function setBigUint64(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),o=BigInt(4294967295),c=Number(r>>s&o),u=Number(r&o),f=4,x=0;t.setUint32(e+f,c,n),t.setUint32(e+x,u,n)}const BLOCK_SIZE=16,POLY=283;function mul2(t){return t<<1^POLY&-(t>>7)}function mul(t,e){let r=0;for(;e>0;e>>=1)r^=t&-(e&1),t=mul2(t);return r}const sbox=(()=>{let t=new Uint8Array(256);for(let r=0,n=1;r<256;r++,n^=mul2(n))t[r]=n;const e=new Uint8Array(256);e[0]=99;for(let r=0;r<255;r++){let n=t[255-r];n|=n<<8,e[t[r]]=(n^n>>4^n>>5^n>>6^n>>7^99)&255}return e})(),invSbox=sbox.map((t,e)=>sbox.indexOf(e)),rotr32_8=t=>t<<24|t>>>8,rotl32_8=t=>t<<8|t>>>24;function genTtable(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const r=new Uint32Array(256).map((x,p)=>e(t[p])),n=r.map(rotl32_8),s=n.map(rotl32_8),o=s.map(rotl32_8),c=new Uint32Array(256*256),u=new Uint32Array(256*256),f=new Uint16Array(256*256);for(let x=0;x<256;x++)for(let p=0;p<256;p++){const g=x*256+p;c[g]=r[x]^n[p],u[g]=s[x]^o[p],f[g]=t[x]<<8|t[p]}return{sbox:t,sbox2:f,T0:r,T1:n,T2:s,T3:o,T01:c,T23:u}}const tableEncoding=genTtable(sbox,t=>mul(t,3)<<24|t<<16|t<<8|mul(t,2)),tableDecoding=genTtable(invSbox,t=>mul(t,11)<<24|mul(t,13)<<16|mul(t,9)<<8|mul(t,14)),xPowers=(()=>{const t=new Uint8Array(16);for(let e=0,r=1;e<16;e++,r=mul2(r))t[e]=r;return t})();function expandKeyLE(t){bytes(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:r}=tableEncoding,n=u32(t),s=n.length,o=u=>applySbox(r,u,u,u,u),c=new Uint32Array(e+28);c.set(n);for(let u=s;u<c.length;u++){let f=c[u-1];u%s===0?f=o(rotr32_8(f))^xPowers[u/s-1]:s>6&&u%s===4&&(f=o(f)),c[u]=c[u-s]^f}return c}function expandKeyDecLE(t){const e=expandKeyLE(t),r=e.slice(),n=e.length,{sbox2:s}=tableEncoding,{T0:o,T1:c,T2:u,T3:f}=tableDecoding;for(let x=0;x<n;x+=4)for(let p=0;p<4;p++)r[x+p]=e[n-x-4+p];e.fill(0);for(let x=4;x<n-4;x++){const p=r[x],g=applySbox(s,p,p,p,p);r[x]=o[g&255]^c[g>>>8&255]^u[g>>>16&255]^f[g>>>24]}return r}function apply0123(t,e,r,n,s,o){return t[r<<8&65280|n>>>8&255]^e[s>>>8&65280|o>>>24&255]}function applySbox(t,e,r,n,s){return t[e&255|r&65280]|t[n>>>16&255|s>>>16&65280]<<16}function encrypt$3(t,e,r,n,s){const{sbox2:o,T01:c,T23:u}=tableEncoding;let f=0;e^=t[f++],r^=t[f++],n^=t[f++],s^=t[f++];const x=t.length/4-2;for(let R=0;R<x;R++){const D=t[f++]^apply0123(c,u,e,r,n,s),k=t[f++]^apply0123(c,u,r,n,s,e),Re=t[f++]^apply0123(c,u,n,s,e,r),Fe=t[f++]^apply0123(c,u,s,e,r,n);e=D,r=k,n=Re,s=Fe}const p=t[f++]^applySbox(o,e,r,n,s),g=t[f++]^applySbox(o,r,n,s,e),y=t[f++]^applySbox(o,n,s,e,r),b=t[f++]^applySbox(o,s,e,r,n);return{s0:p,s1:g,s2:y,s3:b}}function decrypt$3(t,e,r,n,s){const{sbox2:o,T01:c,T23:u}=tableDecoding;let f=0;e^=t[f++],r^=t[f++],n^=t[f++],s^=t[f++];const x=t.length/4-2;for(let R=0;R<x;R++){const D=t[f++]^apply0123(c,u,e,s,n,r),k=t[f++]^apply0123(c,u,r,e,s,n),Re=t[f++]^apply0123(c,u,n,r,e,s),Fe=t[f++]^apply0123(c,u,s,n,r,e);e=D,r=k,n=Re,s=Fe}const p=t[f++]^applySbox(o,e,s,n,r),g=t[f++]^applySbox(o,r,e,s,n),y=t[f++]^applySbox(o,n,r,e,s),b=t[f++]^applySbox(o,s,n,r,e);return{s0:p,s1:g,s2:y,s3:b}}function getDst(t,e){if(!e)return new Uint8Array(t);if(bytes(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function validateBlockDecrypt(t){if(bytes(t),t.length%BLOCK_SIZE!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${BLOCK_SIZE}`)}function validateBlockEncrypt(t,e,r){let n=t.length;const s=n%BLOCK_SIZE;if(!e&&s!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const o=u32(t);if(e){let f=BLOCK_SIZE-s;f||(f=BLOCK_SIZE),n=n+f}const c=getDst(n,r),u=u32(c);return{b:o,o:u,out:c}}function validatePCKS(t,e){if(!e)return t;const r=t.length;if(!r)throw new Error("aes/pcks5: empty ciphertext not allowed");const n=t[r-1];if(n<=0||n>16)throw new Error(`aes/pcks5: wrong padding byte: ${n}`);const s=t.subarray(0,-n);for(let o=0;o<n;o++)if(t[r-o-1]!==n)throw new Error("aes/pcks5: wrong padding");return s}function padPCKS(t){const e=new Uint8Array(16),r=u32(e);e.set(t);const n=BLOCK_SIZE-t.length;for(let s=BLOCK_SIZE-n;s<BLOCK_SIZE;s++)e[s]=n;return r}const cbc=wrapCipher({blockSize:16,nonceLength:16},function(e,r,n={}){bytes(e),bytes(r,16);const s=!n.disablePadding;return{encrypt:(o,c)=>{const u=expandKeyLE(e),{b:f,o:x,out:p}=validateBlockEncrypt(o,s,c),g=u32(r);let y=g[0],b=g[1],R=g[2],D=g[3],k=0;for(;k+4<=f.length;)y^=f[k+0],b^=f[k+1],R^=f[k+2],D^=f[k+3],{s0:y,s1:b,s2:R,s3:D}=encrypt$3(u,y,b,R,D),x[k++]=y,x[k++]=b,x[k++]=R,x[k++]=D;if(s){const Re=padPCKS(o.subarray(k*4));y^=Re[0],b^=Re[1],R^=Re[2],D^=Re[3],{s0:y,s1:b,s2:R,s3:D}=encrypt$3(u,y,b,R,D),x[k++]=y,x[k++]=b,x[k++]=R,x[k++]=D}return u.fill(0),p},decrypt:(o,c)=>{validateBlockDecrypt(o);const u=expandKeyDecLE(e),f=u32(r),x=getDst(o.length,c),p=u32(o),g=u32(x);let y=f[0],b=f[1],R=f[2],D=f[3];for(let k=0;k+4<=p.length;){const Re=y,Fe=b,O=R,$e=D;y=p[k+0],b=p[k+1],R=p[k+2],D=p[k+3];const{s0:ze,s1:q,s2:W,s3:We}=decrypt$3(u,y,b,R,D);g[k++]=ze^Re,g[k++]=q^Fe,g[k++]=W^O,g[k++]=We^$e}return u.fill(0),validatePCKS(x,s)}}}),u8to16=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class Poly1305{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=toBytes(e),bytes(e,32);const r=u8to16(e,0),n=u8to16(e,2),s=u8to16(e,4),o=u8to16(e,6),c=u8to16(e,8),u=u8to16(e,10),f=u8to16(e,12),x=u8to16(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|o<<9)&8191,this.r[4]=(o>>>4|c<<12)&255,this.r[5]=c>>>1&8190,this.r[6]=(c>>>14|u<<2)&8191,this.r[7]=(u>>>11|f<<5)&8065,this.r[8]=(f>>>8|x<<8)&8191,this.r[9]=x>>>5&127;for(let p=0;p<8;p++)this.pad[p]=u8to16(e,16+2*p)}process(e,r,n=!1){const s=n?0:2048,{h:o,r:c}=this,u=c[0],f=c[1],x=c[2],p=c[3],g=c[4],y=c[5],b=c[6],R=c[7],D=c[8],k=c[9],Re=u8to16(e,r+0),Fe=u8to16(e,r+2),O=u8to16(e,r+4),$e=u8to16(e,r+6),ze=u8to16(e,r+8),q=u8to16(e,r+10),W=u8to16(e,r+12),We=u8to16(e,r+14);let Xe=o[0]+(Re&8191),it=o[1]+((Re>>>13|Fe<<3)&8191),Ve=o[2]+((Fe>>>10|O<<6)&8191),v=o[3]+((O>>>7|$e<<9)&8191),I=o[4]+(($e>>>4|ze<<12)&8191),Ce=o[5]+(ze>>>1&8191),P=o[6]+((ze>>>14|q<<2)&8191),_e=o[7]+((q>>>11|W<<5)&8191),Le=o[8]+((W>>>8|We<<8)&8191),Ye=o[9]+(We>>>5|s),je=0,K=je+Xe*u+it*(5*k)+Ve*(5*D)+v*(5*R)+I*(5*b);je=K>>>13,K&=8191,K+=Ce*(5*y)+P*(5*g)+_e*(5*p)+Le*(5*x)+Ye*(5*f),je+=K>>>13,K&=8191;let L=je+Xe*f+it*u+Ve*(5*k)+v*(5*D)+I*(5*R);je=L>>>13,L&=8191,L+=Ce*(5*b)+P*(5*y)+_e*(5*g)+Le*(5*p)+Ye*(5*x),je+=L>>>13,L&=8191;let st=je+Xe*x+it*f+Ve*u+v*(5*k)+I*(5*D);je=st>>>13,st&=8191,st+=Ce*(5*R)+P*(5*b)+_e*(5*y)+Le*(5*g)+Ye*(5*p),je+=st>>>13,st&=8191;let dt=je+Xe*p+it*x+Ve*f+v*u+I*(5*k);je=dt>>>13,dt&=8191,dt+=Ce*(5*D)+P*(5*R)+_e*(5*b)+Le*(5*y)+Ye*(5*g),je+=dt>>>13,dt&=8191;let Je=je+Xe*g+it*p+Ve*x+v*f+I*u;je=Je>>>13,Je&=8191,Je+=Ce*(5*k)+P*(5*D)+_e*(5*R)+Le*(5*b)+Ye*(5*y),je+=Je>>>13,Je&=8191;let pt=je+Xe*y+it*g+Ve*p+v*x+I*f;je=pt>>>13,pt&=8191,pt+=Ce*u+P*(5*k)+_e*(5*D)+Le*(5*R)+Ye*(5*b),je+=pt>>>13,pt&=8191;let rr=je+Xe*b+it*y+Ve*g+v*p+I*x;je=rr>>>13,rr&=8191,rr+=Ce*f+P*u+_e*(5*k)+Le*(5*D)+Ye*(5*R),je+=rr>>>13,rr&=8191;let cr=je+Xe*R+it*b+Ve*y+v*g+I*p;je=cr>>>13,cr&=8191,cr+=Ce*x+P*f+_e*u+Le*(5*k)+Ye*(5*D),je+=cr>>>13,cr&=8191;let fr=je+Xe*D+it*R+Ve*b+v*y+I*g;je=fr>>>13,fr&=8191,fr+=Ce*p+P*x+_e*f+Le*u+Ye*(5*k),je+=fr>>>13,fr&=8191;let ir=je+Xe*k+it*D+Ve*R+v*b+I*y;je=ir>>>13,ir&=8191,ir+=Ce*g+P*p+_e*x+Le*f+Ye*u,je+=ir>>>13,ir&=8191,je=(je<<2)+je|0,je=je+K|0,K=je&8191,je=je>>>13,L+=je,o[0]=K,o[1]=L,o[2]=st,o[3]=dt,o[4]=Je,o[5]=pt,o[6]=rr,o[7]=cr,o[8]=fr,o[9]=ir}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let u=2;u<10;u++)e[u]+=s,s=e[u]>>>13,e[u]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let u=1;u<10;u++)n[u]=e[u]+s,s=n[u]>>>13,n[u]&=8191;n[9]-=8192;let o=(s^1)-1;for(let u=0;u<10;u++)n[u]&=o;o=~o;for(let u=0;u<10;u++)e[u]=e[u]&o|n[u];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let c=e[0]+r[0];e[0]=c&65535;for(let u=1;u<8;u++)c=(e[u]+r[u]|0)+(c>>>16)|0,e[u]=c&65535}update(e){exists(this);const{buffer:r,blockLen:n}=this;e=toBytes(e);const s=e.length;for(let o=0;o<s;){const c=Math.min(n-this.pos,s-o);if(c===n){for(;n<=s-o;o+=n)this.process(e,o);continue}r.set(e.subarray(o,o+c),this.pos),this.pos+=c,o+=c,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){exists(this),output(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let o=0;for(let c=0;c<8;c++)e[o++]=n[c]>>>0,e[o++]=n[c]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}}function wrapConstructorWithKey(t){const e=(n,s)=>t(s).update(toBytes(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const poly1305=wrapConstructorWithKey(t=>new Poly1305(t)),_utf8ToBytes=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),sigma16=_utf8ToBytes("expand 16-byte k"),sigma32=_utf8ToBytes("expand 32-byte k"),sigma16_32=u32(sigma16),sigma32_32=u32(sigma32);sigma32_32.slice();function rotl$1(t,e){return t<<e|t>>>32-e}function isAligned32(t){return t.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(t,e,r,n,s,o,c,u){const f=s.length,x=new Uint8Array(BLOCK_LEN),p=u32(x),g=isAligned32(s)&&isAligned32(o),y=g?u32(s):U32_EMPTY,b=g?u32(o):U32_EMPTY;for(let R=0;R<f;c++){if(t(e,r,n,p,c,u),c>=MAX_COUNTER)throw new Error("arx: counter overflow");const D=Math.min(BLOCK_LEN,f-R);if(g&&D===BLOCK_LEN){const k=R/4;if(R%4!==0)throw new Error("arx: invalid block position");for(let Re=0,Fe;Re<BLOCK_LEN32;Re++)Fe=k+Re,b[Fe]=y[Fe]^p[Re];R+=BLOCK_LEN;continue}for(let k=0,Re;k<D;k++)Re=R+k,o[Re]=s[Re]^x[k];R+=D}}function createCipher(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:s,counterRight:o,rounds:c}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return number$2(s),number$2(c),bool(o),bool(r),(u,f,x,p,g=0)=>{bytes(u),bytes(f),bytes(x);const y=x.length;if(p||(p=new Uint8Array(y)),bytes(p),number$2(g),g<0||g>=MAX_COUNTER)throw new Error("arx: counter overflow");if(p.length<y)throw new Error(`arx: output (${p.length}) is shorter than data (${y})`);const b=[];let R=u.length,D,k;if(R===32)D=u.slice(),b.push(D),k=sigma32_32;else if(R===16&&r)D=new Uint8Array(32),D.set(u),D.set(u,16),k=sigma16_32,b.push(D);else throw new Error(`arx: invalid 32-byte key, got length=${R}`);isAligned32(f)||(f=f.slice(),b.push(f));const Re=u32(D);if(n){if(f.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(k,Re,u32(f.subarray(0,16)),Re),f=f.subarray(16)}const Fe=16-s;if(Fe!==f.length)throw new Error(`arx: nonce must be ${Fe} or 16 bytes`);if(Fe!==12){const $e=new Uint8Array(12);$e.set(f,o?0:12-f.length),f=$e,b.push(f)}const O=u32(f);for(runCipher(t,k,Re,O,x,p,g,c);b.length>0;)b.pop().fill(0);return p}}function chachaCore(t,e,r,n,s,o=20){let c=t[0],u=t[1],f=t[2],x=t[3],p=e[0],g=e[1],y=e[2],b=e[3],R=e[4],D=e[5],k=e[6],Re=e[7],Fe=s,O=r[0],$e=r[1],ze=r[2],q=c,W=u,We=f,Xe=x,it=p,Ve=g,v=y,I=b,Ce=R,P=D,_e=k,Le=Re,Ye=Fe,je=O,K=$e,L=ze;for(let dt=0;dt<o;dt+=2)q=q+it|0,Ye=rotl$1(Ye^q,16),Ce=Ce+Ye|0,it=rotl$1(it^Ce,12),q=q+it|0,Ye=rotl$1(Ye^q,8),Ce=Ce+Ye|0,it=rotl$1(it^Ce,7),W=W+Ve|0,je=rotl$1(je^W,16),P=P+je|0,Ve=rotl$1(Ve^P,12),W=W+Ve|0,je=rotl$1(je^W,8),P=P+je|0,Ve=rotl$1(Ve^P,7),We=We+v|0,K=rotl$1(K^We,16),_e=_e+K|0,v=rotl$1(v^_e,12),We=We+v|0,K=rotl$1(K^We,8),_e=_e+K|0,v=rotl$1(v^_e,7),Xe=Xe+I|0,L=rotl$1(L^Xe,16),Le=Le+L|0,I=rotl$1(I^Le,12),Xe=Xe+I|0,L=rotl$1(L^Xe,8),Le=Le+L|0,I=rotl$1(I^Le,7),q=q+Ve|0,L=rotl$1(L^q,16),_e=_e+L|0,Ve=rotl$1(Ve^_e,12),q=q+Ve|0,L=rotl$1(L^q,8),_e=_e+L|0,Ve=rotl$1(Ve^_e,7),W=W+v|0,Ye=rotl$1(Ye^W,16),Le=Le+Ye|0,v=rotl$1(v^Le,12),W=W+v|0,Ye=rotl$1(Ye^W,8),Le=Le+Ye|0,v=rotl$1(v^Le,7),We=We+I|0,je=rotl$1(je^We,16),Ce=Ce+je|0,I=rotl$1(I^Ce,12),We=We+I|0,je=rotl$1(je^We,8),Ce=Ce+je|0,I=rotl$1(I^Ce,7),Xe=Xe+it|0,K=rotl$1(K^Xe,16),P=P+K|0,it=rotl$1(it^P,12),Xe=Xe+it|0,K=rotl$1(K^Xe,8),P=P+K|0,it=rotl$1(it^P,7);let st=0;n[st++]=c+q|0,n[st++]=u+W|0,n[st++]=f+We|0,n[st++]=x+Xe|0,n[st++]=p+it|0,n[st++]=g+Ve|0,n[st++]=y+v|0,n[st++]=b+I|0,n[st++]=R+Ce|0,n[st++]=D+P|0,n[st++]=k+_e|0,n[st++]=Re+Le|0,n[st++]=Fe+Ye|0,n[st++]=O+je|0,n[st++]=$e+K|0,n[st++]=ze+L|0}function hchacha(t,e,r,n){let s=t[0],o=t[1],c=t[2],u=t[3],f=e[0],x=e[1],p=e[2],g=e[3],y=e[4],b=e[5],R=e[6],D=e[7],k=r[0],Re=r[1],Fe=r[2],O=r[3];for(let ze=0;ze<20;ze+=2)s=s+f|0,k=rotl$1(k^s,16),y=y+k|0,f=rotl$1(f^y,12),s=s+f|0,k=rotl$1(k^s,8),y=y+k|0,f=rotl$1(f^y,7),o=o+x|0,Re=rotl$1(Re^o,16),b=b+Re|0,x=rotl$1(x^b,12),o=o+x|0,Re=rotl$1(Re^o,8),b=b+Re|0,x=rotl$1(x^b,7),c=c+p|0,Fe=rotl$1(Fe^c,16),R=R+Fe|0,p=rotl$1(p^R,12),c=c+p|0,Fe=rotl$1(Fe^c,8),R=R+Fe|0,p=rotl$1(p^R,7),u=u+g|0,O=rotl$1(O^u,16),D=D+O|0,g=rotl$1(g^D,12),u=u+g|0,O=rotl$1(O^u,8),D=D+O|0,g=rotl$1(g^D,7),s=s+x|0,O=rotl$1(O^s,16),R=R+O|0,x=rotl$1(x^R,12),s=s+x|0,O=rotl$1(O^s,8),R=R+O|0,x=rotl$1(x^R,7),o=o+p|0,k=rotl$1(k^o,16),D=D+k|0,p=rotl$1(p^D,12),o=o+p|0,k=rotl$1(k^o,8),D=D+k|0,p=rotl$1(p^D,7),c=c+g|0,Re=rotl$1(Re^c,16),y=y+Re|0,g=rotl$1(g^y,12),c=c+g|0,Re=rotl$1(Re^c,8),y=y+Re|0,g=rotl$1(g^y,7),u=u+f|0,Fe=rotl$1(Fe^u,16),b=b+Fe|0,f=rotl$1(f^b,12),u=u+f|0,Fe=rotl$1(Fe^u,8),b=b+Fe|0,f=rotl$1(f^b,7);let $e=0;n[$e++]=s,n[$e++]=o,n[$e++]=c,n[$e++]=u,n[$e++]=k,n[$e++]=Re,n[$e++]=Fe,n[$e++]=O}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1}),xchacha20=createCipher(chachaCore,{counterRight:!1,counterLength:8,extendNonceFn:hchacha,allowShortKeys:!1}),ZEROS16=new Uint8Array(16),updatePadded=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(ZEROS16.subarray(r))},ZEROS32=new Uint8Array(32);function computeTag(t,e,r,n,s){const o=t(e,r,ZEROS32),c=poly1305.create(o);s&&updatePadded(c,s),updatePadded(c,n);const u=new Uint8Array(16),f=createView(u);setBigUint64(f,0,BigInt(s?s.length:0),!0),setBigUint64(f,8,BigInt(n.length),!0),c.update(u);const x=c.digest();return o.fill(0),x}const _poly1305_aead=t=>(e,r,n)=>(bytes(e,32),bytes(r),{encrypt:(o,c)=>{const u=o.length,f=u+16;c?bytes(c,f):c=new Uint8Array(f),t(e,r,o,c,1);const x=computeTag(t,e,r,c.subarray(0,-16),n);return c.set(x,u),c},decrypt:(o,c)=>{const u=o.length,f=u-16;if(u<16)throw new Error("encrypted data must be at least 16 bytes");c?bytes(c,f):c=new Uint8Array(f);const x=o.subarray(0,-16),p=o.subarray(-16),g=computeTag(t,e,r,x,n);if(!equalBytes(p,g))throw new Error("invalid tag");return t(e,r,x,c,1),c}}),xchacha20poly1305=wrapCipher({blockSize:64,nonceLength:24,tagLength:16},_poly1305_aead(xchacha20));class HMAC extends Hash$1{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,assert$3.hash(e);const n=toBytes$1(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(n.length>s?e.create().update(n).digest():n);for(let c=0;c<o.length;c++)o[c]^=54;this.iHash.update(o),this.oHash=e.create();for(let c=0;c<o.length;c++)o[c]^=106;this.oHash.update(o),o.fill(0)}update(e){return assert$3.exists(this),this.iHash.update(e),this}digestInto(e){assert$3.exists(this),assert$3.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:s,destroyed:o,blockLen:c,outputLen:u}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=c,e.outputLen=u,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac$1=(t,e,r)=>new HMAC(t,e).update(r).digest();hmac$1.create=(t,e)=>new HMAC(t,e);function extract$1(t,e,r){return assert$3.hash(t),hmac$1(t,toBytes$1(r),toBytes$1(e))}const HKDF_COUNTER$1=new Uint8Array([0]),EMPTY_BUFFER$4=new Uint8Array;function expand$1(t,e,r,n=32){if(assert$3.hash(t),assert$3.number(n),n>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/t.outputLen);r===void 0&&(r=EMPTY_BUFFER$4);const o=new Uint8Array(s*t.outputLen),c=hmac$1.create(t,e),u=c._cloneInto(),f=new Uint8Array(c.outputLen);for(let x=0;x<s;x++)HKDF_COUNTER$1[0]=x+1,u.update(x===0?EMPTY_BUFFER$4:f).update(r).update(HKDF_COUNTER$1).digestInto(f),o.set(f,t.outputLen*x),c._cloneInto(u);return c.destroy(),u.destroy(),f.fill(0),HKDF_COUNTER$1.fill(0),o.slice(0,n)}var __defProp$2=Object.defineProperty,__export=(t,e)=>{for(var r in e)__defProp$2(t,r,{get:e[r],enumerable:!0})},verifiedSymbol=Symbol("verified"),isRecord=t=>t instanceof Object;function validateEvent(t){if(!isRecord(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let r=t.tags[e];if(!Array.isArray(r))return!1;for(let n=0;n<r.length;n++)if(typeof r[n]!="string")return!1}return!0}var utils_exports={};__export(utils_exports,{Queue:()=>Queue$1,QueueNode:()=>QueueNode,binarySearch:()=>binarySearch,bytesToHex:()=>bytesToHex$1,hexToBytes:()=>hexToBytes$3,insertEventIntoAscendingList:()=>insertEventIntoAscendingList,insertEventIntoDescendingList:()=>insertEventIntoDescendingList,normalizeURL:()=>normalizeURL,utf8Decoder:()=>utf8Decoder$1,utf8Encoder:()=>utf8Encoder$1});var utf8Decoder$1=new TextDecoder("utf-8"),utf8Encoder$1=new TextEncoder;function normalizeURL(t){try{t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.protocol==="http:"?e.protocol="ws:":e.protocol==="https:"&&(e.protocol="wss:"),e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${t}`)}}function insertEventIntoDescendingList(t,e){const[r,n]=binarySearch(t,s=>e.id===s.id?0:e.created_at===s.created_at?-1:s.created_at-e.created_at);return n||t.splice(r,0,e),t}function insertEventIntoAscendingList(t,e){const[r,n]=binarySearch(t,s=>e.id===s.id?0:e.created_at===s.created_at?-1:e.created_at-s.created_at);return n||t.splice(r,0,e),t}function binarySearch(t,e){let r=0,n=t.length-1;for(;r<=n;){const s=Math.floor((r+n)/2),o=e(t[s]);if(o===0)return[s,!0];o<0?n=s-1:r=s+1}return[r,!1]}var QueueNode=class{value;next=null;prev=null;constructor(t){this.value=t}},Queue$1=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){const r=new QueueNode(e);return this.last?this.last===this.first?(this.last=r,this.last.prev=this.first,this.first.next=r):(r.prev=this.last,this.last.next=r,this.last=r):(this.first=r,this.last=r),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const r=this.first;return this.first=null,this.last=null,r.value}const e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},JS=class{generateSecretKey(){return schnorr.utils.randomPrivateKey()}getPublicKey(t){return bytesToHex$1(schnorr.getPublicKey(t))}finalizeEvent(t,e){const r=t;return r.pubkey=bytesToHex$1(schnorr.getPublicKey(e)),r.id=getEventHash$1(r),r.sig=bytesToHex$1(schnorr.sign(getEventHash$1(r),e)),r[verifiedSymbol]=!0,r}verifyEvent(t){if(typeof t[verifiedSymbol]=="boolean")return t[verifiedSymbol];const e=getEventHash$1(t);if(e!==t.id)return t[verifiedSymbol]=!1,!1;try{const r=schnorr.verify(t.sig,e,t.pubkey);return t[verifiedSymbol]=r,r}catch{return t[verifiedSymbol]=!1,!1}}};function serializeEvent(t){if(!validateEvent(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function getEventHash$1(t){let e=sha256$1(utf8Encoder$1.encode(serializeEvent(t)));return bytesToHex$1(e)}var i$1=new JS,generateSecretKey=i$1.generateSecretKey,getPublicKey=i$1.getPublicKey,finalizeEvent=i$1.finalizeEvent,verifyEvent=i$1.verifyEvent,kinds_exports={};__export(kinds_exports,{Application:()=>Application,BadgeAward:()=>BadgeAward,BadgeDefinition:()=>BadgeDefinition,BlockedRelaysList:()=>BlockedRelaysList,BlossomServerList:()=>BlossomServerList,BookmarkList:()=>BookmarkList,Bookmarksets:()=>Bookmarksets,Calendar:()=>Calendar,CalendarEventRSVP:()=>CalendarEventRSVP,ChannelCreation:()=>ChannelCreation,ChannelHideMessage:()=>ChannelHideMessage,ChannelMessage:()=>ChannelMessage,ChannelMetadata:()=>ChannelMetadata,ChannelMuteUser:()=>ChannelMuteUser,ChatMessage:()=>ChatMessage,ClassifiedListing:()=>ClassifiedListing,ClientAuth:()=>ClientAuth,Comment:()=>Comment,CommunitiesList:()=>CommunitiesList,CommunityDefinition:()=>CommunityDefinition,CommunityPostApproval:()=>CommunityPostApproval,Contacts:()=>Contacts,CreateOrUpdateProduct:()=>CreateOrUpdateProduct,CreateOrUpdateStall:()=>CreateOrUpdateStall,Curationsets:()=>Curationsets,Date:()=>Date2,DirectMessageRelaysList:()=>DirectMessageRelaysList,DraftClassifiedListing:()=>DraftClassifiedListing,DraftLong:()=>DraftLong,Emojisets:()=>Emojisets,EncryptedDirectMessage:()=>EncryptedDirectMessage,EventDeletion:()=>EventDeletion,FavoriteRelays:()=>FavoriteRelays,FileMessage:()=>FileMessage,FileMetadata:()=>FileMetadata,FileServerPreference:()=>FileServerPreference,Followsets:()=>Followsets,ForumThread:()=>ForumThread,GenericRepost:()=>GenericRepost,Genericlists:()=>Genericlists,GiftWrap:()=>GiftWrap,GroupMetadata:()=>GroupMetadata,HTTPAuth:()=>HTTPAuth,Handlerinformation:()=>Handlerinformation,Handlerrecommendation:()=>Handlerrecommendation,Highlights:()=>Highlights,InterestsList:()=>InterestsList,Interestsets:()=>Interestsets,JobFeedback:()=>JobFeedback,JobRequest:()=>JobRequest,JobResult:()=>JobResult,Label:()=>Label,LightningPubRPC:()=>LightningPubRPC,LiveChatMessage:()=>LiveChatMessage,LiveEvent:()=>LiveEvent,LongFormArticle:()=>LongFormArticle,Metadata:()=>Metadata,Mutelist:()=>Mutelist,NWCWalletInfo:()=>NWCWalletInfo,NWCWalletRequest:()=>NWCWalletRequest,NWCWalletResponse:()=>NWCWalletResponse,NormalVideo:()=>NormalVideo,NostrConnect:()=>NostrConnect,OpenTimestamps:()=>OpenTimestamps,Photo:()=>Photo,Pinlist:()=>Pinlist,Poll:()=>Poll,PollResponse:()=>PollResponse,PrivateDirectMessage:()=>PrivateDirectMessage,ProblemTracker:()=>ProblemTracker,ProfileBadges:()=>ProfileBadges,PublicChatsList:()=>PublicChatsList,Reaction:()=>Reaction,RecommendRelay:()=>RecommendRelay,RelayList:()=>RelayList,RelayReview:()=>RelayReview,Relaysets:()=>Relaysets,Report:()=>Report,Reporting:()=>Reporting,Repost:()=>Repost,Seal:()=>Seal,SearchRelaysList:()=>SearchRelaysList,ShortTextNote:()=>ShortTextNote,ShortVideo:()=>ShortVideo,Time:()=>Time,UserEmojiList:()=>UserEmojiList,UserStatuses:()=>UserStatuses,Voice:()=>Voice,VoiceComment:()=>VoiceComment,Zap:()=>Zap$1,ZapGoal:()=>ZapGoal,ZapRequest:()=>ZapRequest,classifyKind:()=>classifyKind,isAddressableKind:()=>isAddressableKind,isEphemeralKind:()=>isEphemeralKind,isKind:()=>isKind,isRegularKind:()=>isRegularKind,isReplaceableKind:()=>isReplaceableKind});function isRegularKind(t){return t<1e4&&t!==0&&t!==3}function isReplaceableKind(t){return t===0||t===3||1e4<=t&&t<2e4}function isEphemeralKind(t){return 2e4<=t&&t<3e4}function isAddressableKind(t){return 3e4<=t&&t<4e4}function classifyKind(t){return isRegularKind(t)?"regular":isReplaceableKind(t)?"replaceable":isEphemeralKind(t)?"ephemeral":isAddressableKind(t)?"parameterized":"unknown"}function isKind(t,e){const r=e instanceof Array?e:[e];return validateEvent(t)&&r.includes(t.kind)||!1}var Metadata=0,ShortTextNote=1,RecommendRelay=2,Contacts=3,EncryptedDirectMessage=4,EventDeletion=5,Repost=6,Reaction=7,BadgeAward=8,ChatMessage=9,ForumThread=11,Seal=13,PrivateDirectMessage=14,FileMessage=15,GenericRepost=16,Photo=20,NormalVideo=21,ShortVideo=22,ChannelCreation=40,ChannelMetadata=41,ChannelMessage=42,ChannelHideMessage=43,ChannelMuteUser=44,OpenTimestamps=1040,GiftWrap=1059,Poll=1068,FileMetadata=1063,Comment=1111,LiveChatMessage=1311,Voice=1222,VoiceComment=1244,ProblemTracker=1971,Report=1984,Reporting=1984,Label=1985,CommunityPostApproval=4550,JobRequest=5999,JobResult=6999,JobFeedback=7e3,ZapGoal=9041,ZapRequest=9734,Zap$1=9735,Highlights=9802,PollResponse=1018,Mutelist=1e4,Pinlist=10001,RelayList=10002,BookmarkList=10003,CommunitiesList=10004,PublicChatsList=10005,BlockedRelaysList=10006,SearchRelaysList=10007,FavoriteRelays=10012,InterestsList=10015,UserEmojiList=10030,DirectMessageRelaysList=10050,FileServerPreference=10096,BlossomServerList=10063,NWCWalletInfo=13194,LightningPubRPC=21e3,ClientAuth=22242,NWCWalletRequest=23194,NWCWalletResponse=23195,NostrConnect=24133,HTTPAuth=27235,Followsets=3e4,Genericlists=30001,Relaysets=30002,Bookmarksets=30003,Curationsets=30004,ProfileBadges=30008,BadgeDefinition=30009,Interestsets=30015,CreateOrUpdateStall=30017,CreateOrUpdateProduct=30018,LongFormArticle=30023,DraftLong=30024,Emojisets=30030,Application=30078,LiveEvent=30311,UserStatuses=30315,ClassifiedListing=30402,DraftClassifiedListing=30403,Date2=31922,Time=31923,Calendar=31924,CalendarEventRSVP=31925,RelayReview=31987,Handlerrecommendation=31989,Handlerinformation=31990,CommunityDefinition=34550,GroupMetadata=39e3;function matchFilter(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let r in t)if(r[0]==="#"){let n=r.slice(1),s=t[`#${n}`];if(s&&!e.tags.find(([o,c])=>o===r.slice(1)&&s.indexOf(c)!==-1))return!1}return!(t.since&&e.created_at<t.since||t.until&&e.created_at>t.until)}function matchFilters(t,e){for(let r=0;r<t.length;r++)if(matchFilter(t[r],e))return!0;return!1}var fakejson_exports={};__export(fakejson_exports,{getHex64:()=>getHex64,getInt:()=>getInt,getSubscriptionId:()=>getSubscriptionId,matchEventId:()=>matchEventId,matchEventKind:()=>matchEventKind,matchEventPubkey:()=>matchEventPubkey});function getHex64(t,e){let r=e.length+3,n=t.indexOf(`"${e}":`)+r,s=t.slice(n).indexOf('"')+n+1;return t.slice(s,s+64)}function getInt(t,e){let r=e.length,n=t.indexOf(`"${e}":`)+r+3,s=t.slice(n),o=Math.min(s.indexOf(","),s.indexOf("}"));return parseInt(s.slice(0,o),10)}function getSubscriptionId(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let r=t.slice(e+7+1).indexOf('"');if(r===-1)return null;let n=e+7+1+r,s=t.slice(n+1,80).indexOf('"');if(s===-1)return null;let o=n+1+s;return t.slice(n+1,o)}function matchEventId(t,e){return e===getHex64(t,"id")}function matchEventPubkey(t,e){return e===getHex64(t,"pubkey")}function matchEventKind(t,e){return e===getInt(t,"kind")}var nip42_exports={};__export(nip42_exports,{makeAuthEvent:()=>makeAuthEvent});function makeAuthEvent(t,e){return{kind:ClientAuth,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}var _WebSocket;try{_WebSocket=WebSocket}catch{}var _WebSocket2;try{_WebSocket2=WebSocket}catch{}var nip19_exports$1={};__export(nip19_exports$1,{BECH32_REGEX:()=>BECH32_REGEX$2,Bech32MaxSize:()=>Bech32MaxSize$2,NostrTypeGuard:()=>NostrTypeGuard$1,decode:()=>decode$l,decodeNostrURI:()=>decodeNostrURI$1,encodeBytes:()=>encodeBytes$2,naddrEncode:()=>naddrEncode$1,neventEncode:()=>neventEncode$1,noteEncode:()=>noteEncode$1,nprofileEncode:()=>nprofileEncode$1,npubEncode:()=>npubEncode$1,nsecEncode:()=>nsecEncode$1});var NostrTypeGuard$1={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},Bech32MaxSize$2=5e3,BECH32_REGEX$2=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array$1(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function decodeNostrURI$1(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),decode$l(t)}catch{return{type:"invalid",data:null}}}function decode$l(t){let{prefix:e,words:r}=bech32$1.decode(t,Bech32MaxSize$2),n=new Uint8Array(bech32$1.fromWords(r));switch(e){case"nprofile":{let s=parseTLV$1(n);if(!s[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(s[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex$1(s[0][0]),relays:s[1]?s[1].map(o=>utf8Decoder$1.decode(o)):[]}}}case"nevent":{let s=parseTLV$1(n);if(!s[0]?.[0])throw new Error("missing TLV 0 for nevent");if(s[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(s[2]&&s[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(s[3]&&s[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex$1(s[0][0]),relays:s[1]?s[1].map(o=>utf8Decoder$1.decode(o)):[],author:s[2]?.[0]?bytesToHex$1(s[2][0]):void 0,kind:s[3]?.[0]?parseInt(bytesToHex$1(s[3][0]),16):void 0}}}case"naddr":{let s=parseTLV$1(n);if(!s[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!s[2]?.[0])throw new Error("missing TLV 2 for naddr");if(s[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!s[3]?.[0])throw new Error("missing TLV 3 for naddr");if(s[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder$1.decode(s[0][0]),pubkey:bytesToHex$1(s[2][0]),kind:parseInt(bytesToHex$1(s[3][0]),16),relays:s[1]?s[1].map(o=>utf8Decoder$1.decode(o)):[]}}}case"nsec":return{type:e,data:n};case"npub":case"note":return{type:e,data:bytesToHex$1(n)};default:throw new Error(`unknown prefix ${e}`)}}function parseTLV$1(t){let e={},r=t;for(;r.length>0;){let n=r[0],s=r[1],o=r.slice(2,2+s);if(r=r.slice(2+s),o.length<s)throw new Error(`not enough data to read on TLV ${n}`);e[n]=e[n]||[],e[n].push(o)}return e}function nsecEncode$1(t){return encodeBytes$2("nsec",t)}function npubEncode$1(t){return encodeBytes$2("npub",hexToBytes$3(t))}function noteEncode$1(t){return encodeBytes$2("note",hexToBytes$3(t))}function encodeBech32$2(t,e){let r=bech32$1.toWords(e);return bech32$1.encode(t,r,Bech32MaxSize$2)}function encodeBytes$2(t,e){return encodeBech32$2(t,e)}function nprofileEncode$1(t){let e=encodeTLV$1({0:[hexToBytes$3(t.pubkey)],1:(t.relays||[]).map(r=>utf8Encoder$1.encode(r))});return encodeBech32$2("nprofile",e)}function neventEncode$1(t){let e;t.kind!==void 0&&(e=integerToUint8Array$1(t.kind));let r=encodeTLV$1({0:[hexToBytes$3(t.id)],1:(t.relays||[]).map(n=>utf8Encoder$1.encode(n)),2:t.author?[hexToBytes$3(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return encodeBech32$2("nevent",r)}function naddrEncode$1(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let r=encodeTLV$1({0:[utf8Encoder$1.encode(t.identifier)],1:(t.relays||[]).map(n=>utf8Encoder$1.encode(n)),2:[hexToBytes$3(t.pubkey)],3:[new Uint8Array(e)]});return encodeBech32$2("naddr",r)}function encodeTLV$1(t){let e=[];return Object.entries(t).reverse().forEach(([r,n])=>{n.forEach(s=>{let o=new Uint8Array(s.length+2);o.set([parseInt(r)],0),o.set([s.length],1),o.set(s,2),e.push(o)})}),concatBytes(...e)}var nip04_exports={};__export(nip04_exports,{decrypt:()=>decrypt$2,encrypt:()=>encrypt$2});function encrypt$2(t,e,r){const n=t instanceof Uint8Array?bytesToHex$1(t):t,s=secp256k1$1.getSharedSecret(n,"02"+e),o=getNormalizedX(s);let c=Uint8Array.from(randomBytes(16)),u=utf8Encoder$1.encode(r),f=cbc(o,c).encrypt(u),x=base64.encode(new Uint8Array(f)),p=base64.encode(new Uint8Array(c.buffer));return`${x}?iv=${p}`}function decrypt$2(t,e,r){const n=t instanceof Uint8Array?bytesToHex$1(t):t;let[s,o]=r.split("?iv="),c=secp256k1$1.getSharedSecret(n,"02"+e),u=getNormalizedX(c),f=base64.decode(o),x=base64.decode(s),p=cbc(u,f).decrypt(x);return utf8Decoder$1.decode(p)}function getNormalizedX(t){return t.slice(1,33)}var nip05_exports={};__export(nip05_exports,{NIP05_REGEX:()=>NIP05_REGEX$1,isNip05:()=>isNip05,isValid:()=>isValid,queryProfile:()=>queryProfile,searchDomain:()=>searchDomain,useFetchImplementation:()=>useFetchImplementation});var NIP05_REGEX$1=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,isNip05=t=>NIP05_REGEX$1.test(t||""),_fetch;try{_fetch=fetch}catch{}function useFetchImplementation(t){_fetch=t}async function searchDomain(t,e=""){try{const r=`https://${t}/.well-known/nostr.json?name=${e}`,n=await _fetch(r,{redirect:"manual"});if(n.status!==200)throw Error("Wrong response code");return(await n.json()).names}catch{return{}}}async function queryProfile(t){const e=t.match(NIP05_REGEX$1);if(!e)return null;const[,r="_",n]=e;try{const s=`https://${n}/.well-known/nostr.json?name=${r}`,o=await _fetch(s,{redirect:"manual"});if(o.status!==200)throw Error("Wrong response code");const c=await o.json(),u=c.names[r];return u?{pubkey:u,relays:c.relays?.[u]}:null}catch{return null}}async function isValid(t,e){const r=await queryProfile(e);return r?r.pubkey===t:!1}var nip10_exports={};__export(nip10_exports,{parse:()=>parse$2});function parse$2(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let r,n;for(let s=t.tags.length-1;s>=0;s--){const o=t.tags[s];if(o[0]==="e"&&o[1]){const[c,u,f,x,p]=o,g={id:u,relays:f?[f]:[],author:p};if(x==="root"){e.root=g;continue}if(x==="reply"){e.reply=g;continue}if(x==="mention"){e.mentions.push(g);continue}r?n=g:r=g,e.mentions.push(g);continue}if(o[0]==="q"&&o[1]){const[c,u,f]=o;e.quotes.push({id:u,relays:f?[f]:[]})}if(o[0]==="p"&&o[1]){e.profiles.push({pubkey:o[1],relays:o[2]?[o[2]]:[]});continue}}return e.root||(e.root=n||r||e.reply),e.reply||(e.reply=r||e.root),[e.reply,e.root].forEach(s=>{if(!s)return;let o=e.mentions.indexOf(s);if(o!==-1&&e.mentions.splice(o,1),s.author){let c=e.profiles.find(u=>u.pubkey===s.author);c&&c.relays&&(s.relays||(s.relays=[]),c.relays.forEach(u=>{s.relays?.indexOf(u)===-1&&s.relays.push(u)}),c.relays=s.relays)}}),e.mentions.forEach(s=>{if(s.author){let o=e.profiles.find(c=>c.pubkey===s.author);o&&o.relays&&(s.relays||(s.relays=[]),o.relays.forEach(c=>{s.relays.indexOf(c)===-1&&s.relays.push(c)}),o.relays=s.relays)}}),e}var nip11_exports={};__export(nip11_exports,{fetchRelayInformation:()=>fetchRelayInformation$1,useFetchImplementation:()=>useFetchImplementation2});var _fetch2;try{_fetch2=fetch}catch{}function useFetchImplementation2(t){_fetch2=t}async function fetchRelayInformation$1(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var nip13_exports={};__export(nip13_exports,{fastEventHash:()=>fastEventHash,getPow:()=>getPow,minePow:()=>minePow});function getPow(t){let e=0;for(let r=0;r<64;r+=8){const n=parseInt(t.substring(r,r+8),16);if(n===0)e+=32;else{e+=Math.clz32(n);break}}return e}function minePow(t,e){let r=0;const n=t,s=["nonce",r.toString(),e.toString()];for(n.tags.push(s);;){const o=Math.floor(new Date().getTime()/1e3);if(o!==n.created_at&&(r=0,n.created_at=o),s[1]=(++r).toString(),n.id=fastEventHash(n),getPow(n.id)>=e)break}return n}function fastEventHash(t){return bytesToHex$1(sha256$1(utf8Encoder$1.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var nip17_exports={};__export(nip17_exports,{unwrapEvent:()=>unwrapEvent2,unwrapManyEvents:()=>unwrapManyEvents2,wrapEvent:()=>wrapEvent2,wrapManyEvents:()=>wrapManyEvents2});var nip59_exports={};__export(nip59_exports,{createRumor:()=>createRumor,createSeal:()=>createSeal,createWrap:()=>createWrap,unwrapEvent:()=>unwrapEvent,unwrapManyEvents:()=>unwrapManyEvents,wrapEvent:()=>wrapEvent$1,wrapManyEvents:()=>wrapManyEvents});var nip44_exports={};__export(nip44_exports,{decrypt:()=>decrypt2,encrypt:()=>encrypt2,getConversationKey:()=>getConversationKey,v2:()=>v2});var minPlaintextSize=1,maxPlaintextSize=65535;function getConversationKey(t,e){const r=secp256k1$1.getSharedSecret(t,"02"+e).subarray(1,33);return extract$1(sha256$1,r,"nip44-v2")}function getMessageKeys(t,e){const r=expand$1(sha256$1,t,e,76);return{chacha_key:r.subarray(0,32),chacha_nonce:r.subarray(32,44),hmac_key:r.subarray(44,76)}}function calcPaddedLen(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,r=e<=256?32:e/8;return r*(Math.floor((t-1)/r)+1)}function writeU16BE(t){if(!Number.isSafeInteger(t)||t<minPlaintextSize||t>maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function pad(t){const e=utf8Encoder$1.encode(t),r=e.length,n=writeU16BE(r),s=new Uint8Array(calcPaddedLen(r)-r);return concatBytes(n,e,s)}function unpad(t){const e=new DataView(t.buffer).getUint16(0),r=t.subarray(2,2+e);if(e<minPlaintextSize||e>maxPlaintextSize||r.length!==e||t.length!==2+calcPaddedLen(e))throw new Error("invalid padding");return utf8Decoder$1.decode(r)}function hmacAad(t,e,r){if(r.length!==32)throw new Error("AAD associated data must be 32 bytes");const n=concatBytes(r,e);return hmac$1(sha256$1,t,n)}function decodePayload(t){if(typeof t!="string")throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let r;try{r=base64.decode(t)}catch(o){throw new Error("invalid base64: "+o.message)}const n=r.length;if(n<99||n>65603)throw new Error("invalid data length: "+n);const s=r[0];if(s!==2)throw new Error("unknown encryption version "+s);return{nonce:r.subarray(1,33),ciphertext:r.subarray(33,-32),mac:r.subarray(-32)}}function encrypt2(t,e,r=randomBytes(32)){const{chacha_key:n,chacha_nonce:s,hmac_key:o}=getMessageKeys(e,r),c=pad(t),u=chacha20(n,s,c),f=hmacAad(o,u,r);return base64.encode(concatBytes(new Uint8Array([2]),r,u,f))}function decrypt2(t,e){const{nonce:r,ciphertext:n,mac:s}=decodePayload(t),{chacha_key:o,chacha_nonce:c,hmac_key:u}=getMessageKeys(e,r),f=hmacAad(u,n,r);if(!equalBytes(f,s))throw new Error("invalid MAC");const x=chacha20(o,c,n);return unpad(x)}var v2={utils:{getConversationKey,calcPaddedLen},encrypt:encrypt2,decrypt:decrypt2},TWO_DAYS=2880*60,now=()=>Math.round(Date.now()/1e3),randomNow=()=>Math.round(now()-Math.random()*TWO_DAYS),nip44ConversationKey=(t,e)=>getConversationKey(t,e),nip44Encrypt=(t,e,r)=>encrypt2(JSON.stringify(t),nip44ConversationKey(e,r)),nip44Decrypt=(t,e)=>JSON.parse(decrypt2(t.content,nip44ConversationKey(e,t.pubkey)));function createRumor(t,e){const r={created_at:now(),content:"",tags:[],...t,pubkey:getPublicKey(e)};return r.id=getEventHash$1(r),r}function createSeal(t,e,r){return finalizeEvent({kind:Seal,content:nip44Encrypt(t,e,r),created_at:randomNow(),tags:[]},e)}function createWrap(t,e){const r=generateSecretKey();return finalizeEvent({kind:GiftWrap,content:nip44Encrypt(t,r,e),created_at:randomNow(),tags:[["p",e]]},r)}function wrapEvent$1(t,e,r){const n=createRumor(t,e),s=createSeal(n,e,r);return createWrap(s,r)}function wrapManyEvents(t,e,r){if(!r||r.length===0)throw new Error("At least one recipient is required.");const n=getPublicKey(e),s=[wrapEvent$1(t,e,n)];return r.forEach(o=>{s.push(wrapEvent$1(t,e,o))}),s}function unwrapEvent(t,e){const r=nip44Decrypt(t,e);return nip44Decrypt(r,e)}function unwrapManyEvents(t,e){let r=[];return t.forEach(n=>{r.push(unwrapEvent(n,e))}),r.sort((n,s)=>n.created_at-s.created_at),r}function createEvent(t,e,r,n){const s={created_at:Math.ceil(Date.now()/1e3),kind:PrivateDirectMessage,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach(({publicKey:c,relayUrl:u})=>{s.tags.push(u?["p",c,u]:["p",c])}),n&&s.tags.push(["e",n.eventId,n.relayUrl||"","reply"]),r&&s.tags.push(["subject",r]),s}function wrapEvent2(t,e,r,n,s){const o=createEvent(e,r,n,s);return wrapEvent$1(o,t,e.publicKey)}function wrapManyEvents2(t,e,r,n,s){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:getPublicKey(t)},...e].map(c=>wrapEvent2(t,c,r,n,s))}var unwrapEvent2=unwrapEvent,unwrapManyEvents2=unwrapManyEvents,nip18_exports={};__export(nip18_exports,{finishRepostEvent:()=>finishRepostEvent,getRepostedEvent:()=>getRepostedEvent,getRepostedEventPointer:()=>getRepostedEventPointer});function finishRepostEvent(t,e,r,n){let s;const o=[...t.tags??[],["e",e.id,r],["p",e.pubkey]];return e.kind===ShortTextNote?s=Repost:(s=GenericRepost,o.push(["k",String(e.kind)])),finalizeEvent({kind:s,tags:o,content:t.content===""||e.tags?.find(c=>c[0]==="-")?"":JSON.stringify(e),created_at:t.created_at},n)}function getRepostedEventPointer(t){if(![Repost,GenericRepost].includes(t.kind))return;let e,r;for(let n=t.tags.length-1;n>=0&&(e===void 0||r===void 0);n--){const s=t.tags[n];s.length>=2&&(s[0]==="e"&&e===void 0?e=s:s[0]==="p"&&r===void 0&&(r=s))}if(e!==void 0)return{id:e[1],relays:[e[2],r?.[2]].filter(n=>typeof n=="string"),author:r?.[1]}}function getRepostedEvent(t,{skipVerification:e}={}){const r=getRepostedEventPointer(t);if(r===void 0||t.content==="")return;let n;try{n=JSON.parse(t.content)}catch{return}if(n.id===r.id&&!(!e&&!verifyEvent(n)))return n}var nip21_exports={};__export(nip21_exports,{NOSTR_URI_REGEX:()=>NOSTR_URI_REGEX,parse:()=>parse2,test:()=>test});var NOSTR_URI_REGEX=new RegExp(`nostr:(${BECH32_REGEX$2.source})`);function test(t){return typeof t=="string"&&new RegExp(`^${NOSTR_URI_REGEX.source}$`).test(t)}function parse2(t){const e=t.match(new RegExp(`^${NOSTR_URI_REGEX.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:decode$l(e[1])}}var nip25_exports={};__export(nip25_exports,{finishReactionEvent:()=>finishReactionEvent,getReactedEventPointer:()=>getReactedEventPointer});function finishReactionEvent(t,e,r){const n=e.tags.filter(s=>s.length>=2&&(s[0]==="e"||s[0]==="p"));return finalizeEvent({...t,kind:Reaction,tags:[...t.tags??[],...n,["e",e.id],["p",e.pubkey]],content:t.content??"+"},r)}function getReactedEventPointer(t){if(t.kind!==Reaction)return;let e,r;for(let n=t.tags.length-1;n>=0&&(e===void 0||r===void 0);n--){const s=t.tags[n];s.length>=2&&(s[0]==="e"&&e===void 0?e=s:s[0]==="p"&&r===void 0&&(r=s))}if(!(e===void 0||r===void 0))return{id:e[1],relays:[e[2],r[2]].filter(n=>n!==void 0),author:r[1]}}var nip27_exports={};__export(nip27_exports,{parse:()=>parse3});var noCharacter=/\W/m,noURLCharacter=/\W |\W$|$|,| /m,MAX_HASHTAG_LENGTH=42;function*parse3(t){let e=[];if(typeof t!="string"){for(let o=0;o<t.tags.length;o++){const c=t.tags[o];c[0]==="emoji"&&c.length>=3&&e.push({type:"emoji",shortcode:c[1],url:c[2]})}t=t.content}const r=t.length;let n=0,s=0;e:for(;s<r;){const o=t.indexOf(":",s),c=t.indexOf("#",s);if(o===-1&&c===-1)break e;if(o===-1||c>=0&&c<o){if(c===0||t[c-1]===" "){const u=t.slice(c+1,c+MAX_HASHTAG_LENGTH).match(noCharacter),f=u?c+1+u.index:r;yield{type:"text",text:t.slice(n,c)},yield{type:"hashtag",value:t.slice(c+1,f)},s=f,n=s;continue e}s=c+1;continue e}if(t.slice(o-5,o)==="nostr"){const u=t.slice(o+60).match(noCharacter),f=u?o+60+u.index:r;try{let x,{data:p,type:g}=decode$l(t.slice(o+1,f));switch(g){case"npub":x={pubkey:p};break;case"nsec":case"note":s=f+1;continue;default:x=p}n!==o-5&&(yield{type:"text",text:t.slice(n,o-5)}),yield{type:"reference",pointer:x},s=f,n=s;continue e}catch{s=o+1;continue e}}else if(t.slice(o-5,o)==="https"||t.slice(o-4,o)==="http"){const u=t.slice(o+4).match(noURLCharacter),f=u?o+4+u.index:r,x=t[o-1]==="s"?5:4;try{let p=new URL(t.slice(o-x,f));if(p.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==o-x&&(yield{type:"text",text:t.slice(n,o-x)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(p.pathname)){yield{type:"image",url:p.toString()},s=f,n=s;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(p.pathname)){yield{type:"video",url:p.toString()},s=f,n=s;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(p.pathname)){yield{type:"audio",url:p.toString()},s=f,n=s;continue e}yield{type:"url",url:p.toString()},s=f,n=s;continue e}catch{s=f+1;continue e}}else if(t.slice(o-3,o)==="wss"||t.slice(o-2,o)==="ws"){const u=t.slice(o+4).match(noURLCharacter),f=u?o+4+u.index:r,x=t[o-1]==="s"?3:2;try{let p=new URL(t.slice(o-x,f));if(p.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==o-x&&(yield{type:"text",text:t.slice(n,o-x)}),yield{type:"relay",url:p.toString()},s=f,n=s;continue e}catch{s=f+1;continue e}}else{for(let u=0;u<e.length;u++){const f=e[u];if(t[o+f.shortcode.length+1]===":"&&t.slice(o+1,o+f.shortcode.length+1)===f.shortcode){n!==o&&(yield{type:"text",text:t.slice(n,o)}),yield f,s=o+f.shortcode.length+2,n=s;continue e}}s=o+1;continue e}}n!==r&&(yield{type:"text",text:t.slice(n)})}var nip28_exports={};__export(nip28_exports,{channelCreateEvent:()=>channelCreateEvent,channelHideMessageEvent:()=>channelHideMessageEvent,channelMessageEvent:()=>channelMessageEvent,channelMetadataEvent:()=>channelMetadataEvent,channelMuteUserEvent:()=>channelMuteUserEvent});var channelCreateEvent=(t,e)=>{let r;if(typeof t.content=="object")r=JSON.stringify(t.content);else if(typeof t.content=="string")r=t.content;else return;return finalizeEvent({kind:ChannelCreation,tags:[...t.tags??[]],content:r,created_at:t.created_at},e)},channelMetadataEvent=(t,e)=>{let r;if(typeof t.content=="object")r=JSON.stringify(t.content);else if(typeof t.content=="string")r=t.content;else return;return finalizeEvent({kind:ChannelMetadata,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:r,created_at:t.created_at},e)},channelMessageEvent=(t,e)=>{const r=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&r.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),finalizeEvent({kind:ChannelMessage,tags:[...r,...t.tags??[]],content:t.content,created_at:t.created_at},e)},channelHideMessageEvent=(t,e)=>{let r;if(typeof t.content=="object")r=JSON.stringify(t.content);else if(typeof t.content=="string")r=t.content;else return;return finalizeEvent({kind:ChannelHideMessage,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:r,created_at:t.created_at},e)},channelMuteUserEvent=(t,e)=>{let r;if(typeof t.content=="object")r=JSON.stringify(t.content);else if(typeof t.content=="string")r=t.content;else return;return finalizeEvent({kind:ChannelMuteUser,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:r,created_at:t.created_at},e)},nip30_exports={};__export(nip30_exports,{EMOJI_SHORTCODE_REGEX:()=>EMOJI_SHORTCODE_REGEX,matchAll:()=>matchAll,regex:()=>regex$2,replaceAll:()=>replaceAll});var EMOJI_SHORTCODE_REGEX=/:(\w+):/,regex$2=()=>new RegExp(`\\B${EMOJI_SHORTCODE_REGEX.source}\\B`,"g");function*matchAll(t){const e=t.matchAll(regex$2());for(const r of e)try{const[n,s]=r;yield{shortcode:n,name:s,start:r.index,end:r.index+n.length}}catch{}}function replaceAll(t,e){return t.replaceAll(regex$2(),(r,n)=>e({shortcode:r,name:n}))}var nip39_exports={};__export(nip39_exports,{useFetchImplementation:()=>useFetchImplementation3,validateGithub:()=>validateGithub});var _fetch3;try{_fetch3=fetch}catch{}function useFetchImplementation3(t){_fetch3=t}async function validateGithub(t,e,r){try{return await(await _fetch3(`https://gist.github.com/${e}/${r}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var nip47_exports={};__export(nip47_exports,{makeNwcRequestEvent:()=>makeNwcRequestEvent,parseConnectionString:()=>parseConnectionString});function parseConnectionString(t){const{host:e,pathname:r,searchParams:n}=new URL(t),s=r||e,o=n.get("relay"),c=n.get("secret");if(!s||!o||!c)throw new Error("invalid connection string");return{pubkey:s,relay:o,secret:c}}async function makeNwcRequestEvent(t,e,r){const s=encrypt$2(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:r}})),o={kind:NWCWalletRequest,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",t]]};return finalizeEvent(o,e)}var nip54_exports={};__export(nip54_exports,{normalizeIdentifier:()=>normalizeIdentifier});function normalizeIdentifier(t){return t=t.trim().toLowerCase(),t=t.normalize("NFKC"),Array.from(t).map(e=>new RegExp("\\p{Letter}","u").test(e)||new RegExp("\\p{Number}","u").test(e)?e:"-").join("")}var nip57_exports={};__export(nip57_exports,{getSatoshisAmountFromBolt11:()=>getSatoshisAmountFromBolt11,getZapEndpoint:()=>getZapEndpoint,makeZapReceipt:()=>makeZapReceipt,makeZapRequest:()=>makeZapRequest,useFetchImplementation:()=>useFetchImplementation4,validateZapRequest:()=>validateZapRequest});var _fetch4;try{_fetch4=fetch}catch{}function useFetchImplementation4(t){_fetch4=t}async function getZapEndpoint(t){try{let e="",{lud06:r,lud16:n}=JSON.parse(t.content);if(n){let[c,u]=n.split("@");e=new URL(`/.well-known/lnurlp/${c}`,`https://${u}`).toString()}else if(r){let{words:c}=bech32$1.decode(r,1e3),u=bech32$1.fromWords(c);e=utf8Decoder$1.decode(u)}else return null;let o=await(await _fetch4(e)).json();if(o.allowsNostr&&o.nostrPubkey)return o.callback}catch{}return null}function makeZapRequest(t){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:t.comment||"",tags:[["p","pubkey"in t?t.pubkey:t.event.pubkey],["amount",t.amount.toString()],["relays",...t.relays]]};if("event"in t){if(e.tags.push(["e",t.event.id]),isReplaceableKind(t.event.kind)){const r=["a",`${t.event.kind}:${t.event.pubkey}:`];e.tags.push(r)}else if(isAddressableKind(t.event.kind)){let r=t.event.tags.find(([s,o])=>s==="d"&&o);if(!r)throw new Error("d tag not found or is empty");const n=["a",`${t.event.kind}:${t.event.pubkey}:${r[1]}`];e.tags.push(n)}e.tags.push(["k",t.event.kind.toString()])}return e}function validateZapRequest(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!validateEvent(e))return"Zap request is not a valid Nostr event.";if(!verifyEvent(e))return"Invalid signature on zap request.";let r=e.tags.find(([o,c])=>o==="p"&&c);if(!r)return"Zap request doesn't have a 'p' tag.";if(!r[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let n=e.tags.find(([o,c])=>o==="e"&&c);return n&&!n[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([o,c])=>o==="relays"&&c)?null:"Zap request doesn't have a 'relays' tag."}function makeZapReceipt({zapRequest:t,preimage:e,bolt11:r,paidAt:n}){let s=JSON.parse(t),o=s.tags.filter(([u])=>u==="e"||u==="p"||u==="a"),c={kind:9735,created_at:Math.round(n.getTime()/1e3),content:"",tags:[...o,["P",s.pubkey],["bolt11",r],["description",t]]};return e&&c.tags.push(["preimage",e]),c}function getSatoshisAmountFromBolt11(t){if(t.length<50)return 0;t=t.substring(0,50);const e=t.lastIndexOf("1");if(e===-1)return 0;const r=t.substring(0,e);if(!r.startsWith("lnbc"))return 0;const n=r.substring(4);if(n.length<1)return 0;const s=n[n.length-1],o=s.charCodeAt(0)-48,c=o>=0&&o<=9;let u=n.length-1;if(c&&u++,u<1)return 0;const f=parseInt(n.substring(0,u));switch(s){case"m":return f*1e5;case"u":return f*100;case"n":return f/10;case"p":return f/1e4;default:return f*1e8}}var nip77_exports={};__export(nip77_exports,{Negentropy:()=>Negentropy,NegentropyStorageVector:()=>NegentropyStorageVector,NegentropySync:()=>NegentropySync});var PROTOCOL_VERSION=97,ID_SIZE=32,FINGERPRINT_SIZE=16,Mode={Skip:0,Fingerprint:1,IdList:2},WrappedBuffer=class{_raw;length;constructor(t){typeof t=="number"?(this._raw=new Uint8Array(t),this.length=0):t instanceof Uint8Array?(this._raw=new Uint8Array(t),this.length=t.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(t){if(t instanceof WrappedBuffer&&(t=t.unwrap()),typeof t.length!="number")throw Error("bad length");const e=t.length+this.length;if(this.capacity<e){const r=this._raw,n=Math.max(this.capacity*2,e);this._raw=new Uint8Array(n),this._raw.set(r)}this._raw.set(t,this.length),this.length+=t.length}shift(){const t=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,t}shiftN(t=1){const e=this._raw.subarray(0,t);return this._raw=this._raw.subarray(t),this.length-=t,e}};function decodeVarInt(t){let e=0;for(;;){if(t.length===0)throw Error("parse ends prematurely");let r=t.shift();if(e=e<<7|r&127,(r&128)===0)break}return e}function encodeVarInt(t){if(t===0)return new WrappedBuffer(new Uint8Array([0]));let e=[];for(;t!==0;)e.push(t&127),t>>>=7;e.reverse();for(let r=0;r<e.length-1;r++)e[r]|=128;return new WrappedBuffer(new Uint8Array(e))}function getByte(t){return getBytes(t,1)[0]}function getBytes(t,e){if(t.length<e)throw Error("parse ends prematurely");return t.shiftN(e)}var Accumulator=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(ID_SIZE)}add(t){let e=0,r=0,n=new DataView(this.buf.buffer),s=new DataView(t.buffer);for(let o=0;o<8;o++){let c=o*4,u=n.getUint32(c,!0),f=s.getUint32(c,!0),x=u;x+=e,x+=f,x>4294967295&&(r=1),n.setUint32(c,x&4294967295,!0),e=r,r=0}}negate(){let t=new DataView(this.buf.buffer);for(let r=0;r<8;r++){let n=r*4;t.setUint32(n,~t.getUint32(n,!0))}let e=new Uint8Array(ID_SIZE);e[0]=1,this.add(e)}getFingerprint(t){let e=new WrappedBuffer;return e.extend(this.buf),e.extend(encodeVarInt(t)),sha256$1(e.unwrap()).subarray(0,FINGERPRINT_SIZE)}},NegentropyStorageVector=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(t,e){if(this.sealed)throw Error("already sealed");const r=hexToBytes$2(e);if(r.byteLength!==ID_SIZE)throw Error("bad id size for added item");this.items.push({timestamp:t,id:r})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(itemCompare);for(let t=1;t<this.items.length;t++)if(itemCompare(this.items[t-1],this.items[t])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(t){if(this._checkSealed(),t>=this.items.length)throw Error("out of range");return this.items[t]}iterate(t,e,r){this._checkSealed(),this._checkBounds(t,e);for(let n=t;n<e&&r(this.items[n],n);++n);}findLowerBound(t,e,r){return this._checkSealed(),this._checkBounds(t,e),this._binarySearch(this.items,t,e,n=>itemCompare(n,r)<0)}fingerprint(t,e){let r=new Accumulator;return r.setToZero(),this.iterate(t,e,n=>(r.add(n.id),!0)),r.getFingerprint(e-t)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(t,e){if(t>e||e>this.items.length)throw Error("bad range")}_binarySearch(t,e,r,n){let s=r-e;for(;s>0;){let o=e,c=Math.floor(s/2);o+=c,n(t[o])?(e=++o,s-=c+1):s=c}return e}},Negentropy=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(t,e=6e4){if(e<4096)throw Error("frameSizeLimit too small");this.storage=t,this.frameSizeLimit=e,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(t,e){return{timestamp:t,id:e||new Uint8Array(0)}}initiate(){let t=new WrappedBuffer;return t.extend(new Uint8Array([PROTOCOL_VERSION])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),t),bytesToHex(t.unwrap())}reconcile(t,e,r){const n=new WrappedBuffer(hexToBytes$2(t));this.lastTimestampIn=this.lastTimestampOut=0;let s=new WrappedBuffer;s.extend(new Uint8Array([PROTOCOL_VERSION]));let o=getByte(n);if(o<96||o>111)throw Error("invalid negentropy protocol version byte");if(o!==PROTOCOL_VERSION)throw Error("unsupported negentropy protocol version requested: "+(o-96));let c=this.storage.size(),u=this._bound(0),f=0,x=!1;for(;n.length!==0;){let p=new WrappedBuffer,g=()=>{x&&(x=!1,p.extend(this.encodeBound(u)),p.extend(encodeVarInt(Mode.Skip)))},y=this.decodeBound(n),b=decodeVarInt(n),R=f,D=this.storage.findLowerBound(f,c,y);if(b===Mode.Skip)x=!0;else if(b===Mode.Fingerprint){let k=getBytes(n,FINGERPRINT_SIZE),Re=this.storage.fingerprint(R,D);compareUint8Array(k,Re)!==0?(g(),this.splitRange(R,D,y,p)):x=!0}else if(b===Mode.IdList){let k=decodeVarInt(n),Re={};for(let Fe=0;Fe<k;Fe++){let O=getBytes(n,ID_SIZE);Re[bytesToHex(O)]=O}if(x=!0,this.storage.iterate(R,D,Fe=>{let O=Fe.id;const $e=bytesToHex(O);return Re[$e]?delete Re[bytesToHex(O)]:e?.($e),!0}),r)for(let Fe of Object.values(Re))r(bytesToHex(Fe))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(s.length+p.length)){let k=this.storage.fingerprint(D,c);s.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),s.extend(encodeVarInt(Mode.Fingerprint)),s.extend(k);break}else s.extend(p);f=D,u=y}return s.length===1?null:bytesToHex(s.unwrap())}splitRange(t,e,r,n){let s=e-t,o=16;if(s<o*2)n.extend(this.encodeBound(r)),n.extend(encodeVarInt(Mode.IdList)),n.extend(encodeVarInt(s)),this.storage.iterate(t,e,c=>(n.extend(c.id),!0));else{let c=Math.floor(s/o),u=s%o,f=t;for(let x=0;x<o;x++){let p=c+(x<u?1:0),g=this.storage.fingerprint(f,f+p);f+=p;let y;if(f===e)y=r;else{let b,R;this.storage.iterate(f-1,f+1,(D,k)=>(k===f-1?b=D:R=D,!0)),y=this.getMinimalBound(b,R)}n.extend(this.encodeBound(y)),n.extend(encodeVarInt(Mode.Fingerprint)),n.extend(g)}}}exceededFrameSizeLimit(t){return t>this.frameSizeLimit-200}decodeTimestampIn(t){let e=decodeVarInt(t);return e=e===0?Number.MAX_VALUE:e-1,this.lastTimestampIn===Number.MAX_VALUE||e===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(e+=this.lastTimestampIn,this.lastTimestampIn=e,e)}decodeBound(t){let e=this.decodeTimestampIn(t),r=decodeVarInt(t);if(r>ID_SIZE)throw Error("bound key too long");let n=getBytes(t,r);return{timestamp:e,id:n}}encodeTimestampOut(t){if(t===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,encodeVarInt(0);let e=t;return t-=this.lastTimestampOut,this.lastTimestampOut=e,encodeVarInt(t+1)}encodeBound(t){let e=new WrappedBuffer;return e.extend(this.encodeTimestampOut(t.timestamp)),e.extend(encodeVarInt(t.id.length)),e.extend(t.id),e}getMinimalBound(t,e){if(e.timestamp!==t.timestamp)return this._bound(e.timestamp);{let r=0,n=e.id,s=t.id;for(let o=0;o<ID_SIZE&&n[o]===s[o];o++)r++;return this._bound(e.timestamp,e.id.subarray(0,r+1))}}};function compareUint8Array(t,e){for(let r=0;r<t.byteLength;r++){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0}function itemCompare(t,e){return t.timestamp===e.timestamp?compareUint8Array(t.id,e.id):t.timestamp-e.timestamp}var NegentropySync=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(t,e,r,n={}){this.relay=t,this.storage=e,this.neg=new Negentropy(e),this.onhave=n.onhave,this.onneed=n.onneed,this.filter=r,this.subscription=this.relay.prepareSubscription([{}],{label:n.label||"negentropy"}),this.subscription.oncustom=s=>{switch(s[0]){case"NEG-MSG":{s.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${s}`);try{const o=this.neg.reconcile(s[2],this.onhave,this.onneed);o?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${o}"]`):(this.close(),n.onclose?.())}catch(o){console.error("negentropy reconcile error:",o),n?.onclose?.(`reconcile error: ${o}`)}break}case"NEG-CLOSE":{const o=s[2];console.warn("negentropy error:",o),n.onclose?.(o);break}case"NEG-ERR":n.onclose?.()}}}async start(){const t=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${t}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},nip98_exports={};__export(nip98_exports,{getToken:()=>getToken,hashPayload:()=>hashPayload,unpackEventFromToken:()=>unpackEventFromToken,validateEvent:()=>validateEvent2,validateEventKind:()=>validateEventKind,validateEventMethodTag:()=>validateEventMethodTag,validateEventPayloadTag:()=>validateEventPayloadTag,validateEventTimestamp:()=>validateEventTimestamp,validateEventUrlTag:()=>validateEventUrlTag,validateToken:()=>validateToken});var _authorizationScheme="Nostr ";async function getToken(t,e,r,n=!1,s){const o={kind:HTTPAuth,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};s&&o.tags.push(["payload",hashPayload(s)]);const c=await r(o);return(n?_authorizationScheme:"")+base64.encode(utf8Encoder$1.encode(JSON.stringify(c)))}async function validateToken(t,e,r){const n=await unpackEventFromToken(t).catch(o=>{throw o});return await validateEvent2(n,e,r).catch(o=>{throw o})}async function unpackEventFromToken(t){if(!t)throw new Error("Missing token");t=t.replace(_authorizationScheme,"");const e=utf8Decoder$1.decode(base64.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function validateEventTimestamp(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function validateEventKind(t){return t.kind===HTTPAuth}function validateEventUrlTag(t,e){const r=t.tags.find(n=>n[0]==="u");return r?r.length>0&&r[1]===e:!1}function validateEventMethodTag(t,e){const r=t.tags.find(n=>n[0]==="method");return r?r.length>0&&r[1].toLowerCase()===e.toLowerCase():!1}function hashPayload(t){const e=sha256$1(utf8Encoder$1.encode(JSON.stringify(t)));return bytesToHex$1(e)}function validateEventPayloadTag(t,e){const r=t.tags.find(s=>s[0]==="payload");if(!r)return!1;const n=hashPayload(e);return r.length>0&&r[1]===n}async function validateEvent2(t,e,r,n){if(!verifyEvent(t))throw new Error("Invalid nostr event, signature invalid");if(!validateEventKind(t))throw new Error("Invalid nostr event, kind invalid");if(!validateEventTimestamp(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!validateEventUrlTag(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!validateEventMethodTag(t,r))throw new Error("Invalid nostr event, method tag invalid");if(n&&typeof n=="object"&&Object.keys(n).length>0&&!validateEventPayloadTag(t,n))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const index$3=Object.freeze(Object.defineProperty({__proto__:null,finalizeEvent,fj:fakejson_exports,generateSecretKey,getEventHash:getEventHash$1,getPublicKey,kinds:kinds_exports,matchFilter,matchFilters,nip04:nip04_exports,nip05:nip05_exports,nip10:nip10_exports,nip11:nip11_exports,nip13:nip13_exports,nip17:nip17_exports,nip18:nip18_exports,nip19:nip19_exports$1,nip21:nip21_exports,nip25:nip25_exports,nip27:nip27_exports,nip28:nip28_exports,nip30:nip30_exports,nip39:nip39_exports,nip42:nip42_exports,nip44:nip44_exports,nip47:nip47_exports,nip54:nip54_exports,nip57:nip57_exports,nip59:nip59_exports,nip77:nip77_exports,nip98:nip98_exports,serializeEvent,utils:utils_exports,validateEvent,verifiedSymbol,verifyEvent},Symbol.toStringTag,{value:"Module"}));class CryptoService{static isWebCryptoAvailable(){return!!(window.crypto&&window.crypto.subtle)}static simpleFallbackEncrypt(e,r){const n=this.hashPassword(r),s=[];for(let o=0;o<e.length;o++)s.push(e.charCodeAt(o)^n.charCodeAt(o%n.length));return btoa(JSON.stringify(s))}static simpleFallbackDecrypt(e,r){const n=this.hashPassword(r),s=JSON.parse(atob(e));let o="";for(let c=0;c<s.length;c++)o+=String.fromCharCode(s[c]^n.charCodeAt(c%n.length));return o}static hashPassword(e){let r=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);r=(r<<5)-r+s,r=r&r}return r.toString(36)+e}static async getPasswordKey(e){const r=new TextEncoder;return window.crypto.subtle.importKey("raw",r.encode(e),"PBKDF2",!1,["deriveKey"])}static async deriveKey(e,r){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}static async encrypt(e,r){if(!this.isWebCryptoAvailable())return console.warn("[Crypto] Using fallback encryption"),"FALLBACK:"+this.simpleFallbackEncrypt(e,r);const n=window.crypto.getRandomValues(new Uint8Array(16)),s=window.crypto.getRandomValues(new Uint8Array(12)),o=await this.getPasswordKey(r),c=await this.deriveKey(o,n),u=new TextEncoder,f=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},c,u.encode(e)),x=new Uint8Array(f),p=new Uint8Array(n.length+s.length+x.length);return p.set(n,0),p.set(s,n.length),p.set(x,n.length+s.length),btoa(String.fromCharCode(...p))}static async decrypt(e,r){if(e.startsWith("FALLBACK:"))return this.simpleFallbackDecrypt(e.substring(9),r);const n=atob(e),s=new Uint8Array(n.length);for(let y=0;y<n.length;y++)s[y]=n.charCodeAt(y);const o=s.slice(0,16),c=s.slice(16,28),u=s.slice(28),f=await this.getPasswordKey(r),x=await this.deriveKey(f,o),p=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:c},x,u);return new TextDecoder().decode(p)}static generateMnemonic(e=12){return generateMnemonic(wordlist,e===12?128:256)}static validateMnemonic(e){return validateMnemonic(e,wordlist)}static deriveKeypair(e,r){const n=mnemonicToSeedSync(e),s=`m/44'/1237'/0'/0/${r}`,o=HDKey.fromMasterSeed(n).derive(s);if(!o.privateKey)throw new Error("Failed to derive private key");const c=Array.from(o.privateKey).map(f=>f.toString(16).padStart(2,"0")).join(""),u=getPublicKey(o.privateKey);return{nsec:nip19_exports$1.nsecEncode(o.privateKey),npub:nip19_exports$1.npubEncode(u),path:s,privateKeyHex:c}}static nsecToHex(e){const r=nip19_exports$1.decode(e);if(r.type!=="nsec")throw new Error("Invalid nsec format");const n=r.data;return Array.from(n).map(s=>s.toString(16).padStart(2,"0")).join("")}static nsecToNpub(e){const r=nip19_exports$1.decode(e);if(r.type!=="nsec")throw new Error("Invalid nsec format");const n=r.data,s=getPublicKey(n);return nip19_exports$1.npubEncode(s)}static getPublicKeyHex(e){const r=nip19_exports$1.decode(e);if(r.type!=="nsec")throw new Error("Invalid nsec format");const n=r.data,s=getPublicKey(n);return typeof s=="string"?s:Array.from(s).map(o=>o.toString(16).padStart(2,"0")).join("")}}const crypto$2=Object.freeze(Object.defineProperty({__proto__:null,CryptoService},Symbol.toStringTag,{value:"Module"}));const toKebabCase=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),toCamelCase$1=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,n)=>n?n.toUpperCase():r.toLowerCase()),toPascalCase=t=>{const e=toCamelCase$1(t);return e.charAt(0).toUpperCase()+e.slice(1)},mergeClasses=(...t)=>t.filter((e,r,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===r).join(" ").trim(),hasA11yProp=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Icon=reactExports.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:s="",children:o,iconNode:c,...u},f)=>reactExports.createElement("svg",{ref:f,...defaultAttributes,width:e,height:e,stroke:t,strokeWidth:n?Number(r)*24/Number(e):r,className:mergeClasses("lucide",s),...!o&&!hasA11yProp(u)&&{"aria-hidden":"true"},...u},[...c.map(([x,p])=>reactExports.createElement(x,p)),...Array.isArray(o)?o:[o]]));const createLucideIcon=(t,e)=>{const r=reactExports.forwardRef(({className:n,...s},o)=>reactExports.createElement(Icon,{ref:o,iconNode:e,className:mergeClasses(`lucide-${toKebabCase(toPascalCase(t))}`,`lucide-${t}`,n),...s}));return r.displayName=toPascalCase(t),r};const __iconNode$17=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Activity=createLucideIcon("activity",__iconNode$17);const __iconNode$16=[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]],ArrowDownLeft=createLucideIcon("arrow-down-left",__iconNode$16);const __iconNode$15=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ArrowLeft=createLucideIcon("arrow-left",__iconNode$15);const __iconNode$14=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],ArrowRightLeft=createLucideIcon("arrow-right-left",__iconNode$14);const __iconNode$13=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],ArrowRight=createLucideIcon("arrow-right",__iconNode$13);const __iconNode$12=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],ArrowUpDown=createLucideIcon("arrow-up-down",__iconNode$12);const __iconNode$11=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],ArrowUpRight=createLucideIcon("arrow-up-right",__iconNode$11);const __iconNode$10=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]],AtSign=createLucideIcon("at-sign",__iconNode$10);const __iconNode$$=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ban=createLucideIcon("ban",__iconNode$$);const __iconNode$_=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],Banknote=createLucideIcon("banknote",__iconNode$_);const __iconNode$Z=[["path",{d:"M 22 14 L 22 10",key:"nqc4tb"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2",key:"13zb55"}]],Battery=createLucideIcon("battery",__iconNode$Z);const __iconNode$Y=[["path",{d:"M11.767 19.089c4.924.868 6.14-6.025 1.216-6.894m-1.216 6.894L5.86 18.047m5.908 1.042-.347 1.97m1.563-8.864c4.924.869 6.14-6.025 1.215-6.893m-1.215 6.893-3.94-.694m5.155-6.2L8.29 4.26m5.908 1.042.348-1.97M7.48 20.364l3.126-17.727",key:"yr8idg"}]],Bitcoin=createLucideIcon("bitcoin",__iconNode$Y);const __iconNode$X=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Check=createLucideIcon("check",__iconNode$X);const __iconNode$W=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ChevronDown=createLucideIcon("chevron-down",__iconNode$W);const __iconNode$V=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ChevronRight=createLucideIcon("chevron-right",__iconNode$V);const __iconNode$U=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ChevronUp=createLucideIcon("chevron-up",__iconNode$U);const __iconNode$T=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],CircleAlert=createLucideIcon("circle-alert",__iconNode$T);const __iconNode$S=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],CircleCheckBig=createLucideIcon("circle-check-big",__iconNode$S);const __iconNode$R=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],CircleX=createLucideIcon("circle-x",__iconNode$R);const __iconNode$Q=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Clock=createLucideIcon("clock",__iconNode$Q);const __iconNode$P=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],Code=createLucideIcon("code",__iconNode$P);const __iconNode$O=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],Coins=createLucideIcon("coins",__iconNode$O);const __iconNode$N=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Copy=createLucideIcon("copy",__iconNode$N);const __iconNode$M=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Database=createLucideIcon("database",__iconNode$M);const __iconNode$L=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Download=createLucideIcon("download",__iconNode$L);const __iconNode$K=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],ExternalLink=createLucideIcon("external-link",__iconNode$K);const __iconNode$J=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],EyeOff=createLucideIcon("eye-off",__iconNode$J);const __iconNode$I=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Eye=createLucideIcon("eye",__iconNode$I);const __iconNode$H=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],FileBraces=createLucideIcon("file-braces",__iconNode$H);const __iconNode$G=[["path",{d:"m18.226 5.226-2.52-2.52A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-.351",key:"1k2beg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]],FilePenLine=createLucideIcon("file-pen-line",__iconNode$G);const __iconNode$F=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],FileText=createLucideIcon("file-text",__iconNode$F);const __iconNode$E=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Globe=createLucideIcon("globe",__iconNode$E);const __iconNode$D=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Hash=createLucideIcon("hash",__iconNode$D);const __iconNode$C=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Heart=createLucideIcon("heart",__iconNode$C);const __iconNode$B=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Info=createLucideIcon("info",__iconNode$B);const __iconNode$A=[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]],KeyRound=createLucideIcon("key-round",__iconNode$A);const __iconNode$z=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Key=createLucideIcon("key",__iconNode$z);const __iconNode$y=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Link=createLucideIcon("link",__iconNode$y);const __iconNode$x=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],LoaderCircle=createLucideIcon("loader-circle",__iconNode$x);const __iconNode$w=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],Loader=createLucideIcon("loader",__iconNode$w);const __iconNode$v=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Lock=createLucideIcon("lock",__iconNode$v);const __iconNode$u=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],LogIn=createLucideIcon("log-in",__iconNode$u);const __iconNode$t=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],LogOut=createLucideIcon("log-out",__iconNode$t);const __iconNode$s=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],MessageSquare=createLucideIcon("message-square",__iconNode$s);const __iconNode$r=[["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["path",{d:"M16 2v20",key:"rotuqe"}]],Notebook=createLucideIcon("notebook",__iconNode$r);const __iconNode$q=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Pen=createLucideIcon("pen",__iconNode$q);const __iconNode$p=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Plus=createLucideIcon("plus",__iconNode$p);const __iconNode$o=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],QrCode=createLucideIcon("qr-code",__iconNode$o);const __iconNode$n=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Radio=createLucideIcon("radio",__iconNode$n);const __iconNode$m=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],RefreshCw=createLucideIcon("refresh-cw",__iconNode$m);const __iconNode$l=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],Repeat=createLucideIcon("repeat",__iconNode$l);const __iconNode$k=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Save=createLucideIcon("save",__iconNode$k);const __iconNode$j=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],ScanLine=createLucideIcon("scan-line",__iconNode$j);const __iconNode$i=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Search=createLucideIcon("search",__iconNode$i);const __iconNode$h=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Send=createLucideIcon("send",__iconNode$h);const __iconNode$g=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],Server=createLucideIcon("server",__iconNode$g);const __iconNode$f=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Settings$1=createLucideIcon("settings",__iconNode$f);const __iconNode$e=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ShieldCheck=createLucideIcon("shield-check",__iconNode$e);const __iconNode$d=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]],ShieldOff=createLucideIcon("shield-off",__iconNode$d);const __iconNode$c=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Shield=createLucideIcon("shield",__iconNode$c);const __iconNode$b=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],Smartphone=createLucideIcon("smartphone",__iconNode$b);const __iconNode$a=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Trash2=createLucideIcon("trash-2",__iconNode$a);const __iconNode$9=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],TriangleAlert=createLucideIcon("triangle-alert",__iconNode$9);const __iconNode$8=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],Type=createLucideIcon("type",__iconNode$8);const __iconNode$7=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Upload=createLucideIcon("upload",__iconNode$7);const __iconNode$6=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],User=createLucideIcon("user",__iconNode$6);const __iconNode$5=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Volume2=createLucideIcon("volume-2",__iconNode$5);const __iconNode$4=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],Wallet=createLucideIcon("wallet",__iconNode$4);const __iconNode$3=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],WifiOff=createLucideIcon("wifi-off",__iconNode$3);const __iconNode$2=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Wifi=createLucideIcon("wifi",__iconNode$2);const __iconNode$1=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],X=createLucideIcon("x",__iconNode$1);const __iconNode=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Zap=createLucideIcon("zap",__iconNode),Toast=({message:t,type:e="success",isOpen:r=!0,onClose:n,duration:s=3e3})=>{if(reactExports.useEffect(()=>{if(!r)return;const u=setTimeout(n,s);return()=>clearTimeout(u)},[s,n,r]),!r)return null;const o={success:"bg-green-600 text-white",error:"bg-red-600 text-white",info:"bg-blue-600 text-white"},c={success:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-5 h-5"}),error:jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5"}),info:jsxRuntimeExports.jsx(Info,{className:"w-5 h-5"})};return jsxRuntimeExports.jsxs("div",{className:`fixed bottom-24 left-1/2 -translate-x-1/2 px-5 py-3 rounded-full shadow-lg flex items-center gap-3 z-[100] animate-in slide-in-from-bottom-5 fade-in duration-300 pointer-events-none ${o[e]}`,children:[c[e],jsxRuntimeExports.jsx("span",{className:"font-bold text-sm tracking-wide",children:t})]})},CreateWallet=({onBack:t,onComplete:e})=>{const[r,n]=reactExports.useState("type"),[s,o]=reactExports.useState(""),[c,u]=reactExports.useState(""),[f,x]=reactExports.useState(""),[p,g]=reactExports.useState(""),[y,b]=reactExports.useState(!1),[R,D]=reactExports.useState(null),[k,Re]=reactExports.useState(!1),[Fe,O]=reactExports.useState(!1),[$e,ze]=reactExports.useState(null),{addWallet:q,setCurrentWallet:W,setCurrentKeypair:We}=useWalletStore(),{unlock:Xe}=useAuthStore(),it=I=>{const Ce=CryptoService.generateMnemonic(I);o(Ce),n("mnemonic")},Ve=()=>{navigator.clipboard.writeText(s),b(!0),setTimeout(()=>b(!1),2e3)},v=async I=>{if(I.preventDefault(),D(null),f!==p){D("Passwords do not match");return}if(f.length<8){D("Password must be at least 8 characters");return}Re(!0);try{const Ce=await CryptoService.encrypt(s,f),{nsec:P,npub:_e,path:Le,privateKeyHex:Ye}=CryptoService.deriveKeypair(s,0),je=await CryptoService.encrypt(P,f),K=crypto.randomUUID(),L=crypto.randomUUID(),st={id:L,walletId:K,name:"Main Account",derivationPath:Le,encryptedNsec:je,npub:_e,createdAt:Date.now(),connections:[]},dt={id:K,name:c||"My Address Book",type:"mnemonic",encryptedSeed:Ce,createdAt:Date.now(),keypairs:[st]};q(dt),W(K),We(L);const Je=CryptoService.getPublicKeyHex(P);Xe(Ye,Je,f),useEcashStore.getState().loadSession(Je),e()}catch(Ce){console.error(Ce),D("Failed to create wallet")}finally{Re(!1)}};return jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md mx-auto p-6",children:[jsxRuntimeExports.jsxs("button",{onClick:t,className:"flex items-center text-slate-400 hover:text-white mb-6 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]}),r==="type"&&jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Create New Address Book"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400",children:"Choose the security level for your new address book."})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-4",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>it(12),className:"p-4 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-700 transition-all text-left group",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-lg",children:"12 Words"}),jsxRuntimeExports.jsx(Shield,{className:"w-5 h-5 text-amber-500"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-400",children:"Standard security. Easier to write down and remember."})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>it(24),className:"p-4 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-700 transition-all text-left group",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-lg",children:"24 Words"}),jsxRuntimeExports.jsx(Shield,{className:"w-5 h-5 text-green-500"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-400",children:"Maximum security. Recommended for large amounts."})]})]})]}),r==="mnemonic"&&jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Backup Your Seed"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-sm",children:"Write down these words in order. This is the ONLY way to recover your address book."})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800 relative group",children:[jsxRuntimeExports.jsx("div",{className:`grid grid-cols-3 gap-2 ${Fe?"":"blur-sm select-none"}`,children:s.split(" ").map((I,Ce)=>jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 p-1",children:[jsxRuntimeExports.jsxs("span",{className:"text-slate-500 text-xs w-4",children:[Ce+1,"."]}),jsxRuntimeExports.jsx("span",{className:"font-mono font-medium text-amber-50",children:I})]},Ce))}),jsxRuntimeExports.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>O(!Fe),className:"p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors",title:Fe?"Hide seed phrase":"Show seed phrase",children:Fe?jsxRuntimeExports.jsx(EyeOff,{className:"w-4 h-4 text-slate-400"}):jsxRuntimeExports.jsx(Eye,{className:"w-4 h-4 text-slate-400"})}),jsxRuntimeExports.jsx("button",{onClick:Ve,className:"p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors",title:"Copy to clipboard",children:y?jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 text-green-500"}):jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4 text-slate-400"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/20 rounded-lg p-4 flex items-start gap-3",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-200/80",children:"Do not share these words with anyone. Anyone with these words can steal your funds and identity."})]}),jsxRuntimeExports.jsx("button",{onClick:()=>n("encrypt"),className:"w-full py-3 px-4 bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold rounded-xl transition-colors",children:"Continue "})]}),r==="encrypt"&&jsxRuntimeExports.jsxs("form",{onSubmit:v,className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Secure Your Address Book"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400",children:"Set a name and password for this device."})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Address Book Name"}),jsxRuntimeExports.jsx("input",{type:"text",value:c,onChange:I=>u(I.target.value),placeholder:"e.g. Main Address Book",className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Password"}),jsxRuntimeExports.jsx("input",{type:"password",value:f,onChange:I=>x(I.target.value),placeholder:"At least 8 characters",inputMode:"numeric",className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",required:!0,minLength:8})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Confirm Password"}),jsxRuntimeExports.jsx("input",{type:"password",value:p,onChange:I=>g(I.target.value),placeholder:"Repeat password",inputMode:"numeric",className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",required:!0})]})]}),R&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm text-center",children:R}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:async()=>{if(!f||f.length<8){ze({message:"Please enter a valid password (at least 8 characters)",type:"error"});return}if(f!==p){ze({message:"Passwords do not match",type:"error"});return}try{const I=await CryptoService.encrypt(s,f),Ce=JSON.stringify({wallet:c||"My Wallet",encrypted:I,timestamp:Date.now()},null,2),P=new Blob([Ce],{type:"application/json"}),_e=URL.createObjectURL(P),Le=document.createElement("a");Le.href=_e,Le.download=`${(c||"wallet").toLowerCase().replace(/\s+/g,"-")}-backup-encrypted.json`,document.body.appendChild(Le),Le.click(),document.body.removeChild(Le),URL.revokeObjectURL(_e),ze({message:"Encrypted backup downloaded successfully!",type:"success"})}catch(I){console.error("Failed to create backup:",I),ze({message:"Failed to create encrypted backup",type:"error"})}},className:"w-full py-3 px-4 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition-colors border border-slate-700 flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4"}),"Download Encrypted Backup"]}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:k,className:"w-full py-3 px-4 bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:k?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(RefreshCw,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating Address Book..."]}):"Create Address Book"})]})]}),$e&&jsxRuntimeExports.jsx(Toast,{message:$e.message,type:$e.type,isOpen:!!$e,onClose:()=>ze(null)})]})},ImportWallet=({onBack:t,onComplete:e})=>{const[r,n]=reactExports.useState("method"),[s,o]=reactExports.useState(""),[c,u]=reactExports.useState(null),[f,x]=reactExports.useState(null),[p,g]=reactExports.useState(""),[y,b]=reactExports.useState(""),[R,D]=reactExports.useState(""),[k,Re]=reactExports.useState(null),[Fe,O]=reactExports.useState(!1),{addWallet:$e,setCurrentWallet:ze,setCurrentKeypair:q,updateKeypair:W,wallets:We}=useWalletStore(),{unlock:Xe}=useAuthStore(),it=()=>{const I=s.trim();if(I.includes(" "))if(CryptoService.validateMnemonic(I)){u("mnemonic"),n("encrypt"),Re(null);return}else{Re("Invalid mnemonic phrase");return}if(I.startsWith("nsec"))try{const{type:Ce}=nip19_exports$1.decode(I);if(Ce==="nsec"){u("nsec"),n("encrypt"),Re(null);return}}catch{}Re("Invalid input. Please enter a valid mnemonic phrase or nsec.")},Ve=async I=>{const Ce=I.target.files?.[0];if(Ce)try{const P=await Ce.text(),_e=JSON.parse(P);if(!_e.wallet||!_e.encrypted||!_e.timestamp){Re("Invalid backup file format");return}x(_e),g(_e.wallet),u("encrypted"),n("encrypt"),Re(null)}catch(P){console.error("Failed to read backup file:",P),Re("Failed to read backup file. Make sure it's a valid encrypted backup.")}},v=async I=>{if(I.preventDefault(),Re(null),c!=="encrypted"){if(y!==R){Re("Passwords do not match");return}if(y.length<8){Re("Password must be at least 8 characters");return}}O(!0);try{const Ce=crypto.randomUUID(),P=crypto.randomUUID();let _e,Le,Ye;if(c==="encrypted"&&f){const je=await CryptoService.decrypt(f.encrypted,y);if(je.includes(" ")){const L=je,{nsec:st,npub:dt,path:Je,privateKeyHex:pt}=CryptoService.deriveKeypair(L,0);if(We.some(fr=>fr.keypairs.some(ir=>ir.npub===dt))){Re("Wallet already exists"),O(!1);return}const rr=await CryptoService.encrypt(st,y);Le=pt,Ye=CryptoService.getPublicKeyHex(st);const cr={id:P,walletId:Ce,name:"Main Account",derivationPath:Je,encryptedNsec:rr,npub:dt,createdAt:Date.now(),connections:[]};_e={id:Ce,name:p||f.wallet,type:"mnemonic",encryptedSeed:f.encrypted,createdAt:f.timestamp,keypairs:[cr]}}else{const L=je,st=CryptoService.nsecToNpub(L);if(We.some(pt=>pt.keypairs.some(rr=>rr.npub===st))){Re("Wallet already exists"),O(!1);return}const dt=await CryptoService.encrypt(L,y);Le=CryptoService.nsecToHex(L),Ye=CryptoService.getPublicKeyHex(L);const Je={id:P,walletId:Ce,name:"Main Account",encryptedNsec:dt,npub:st,createdAt:Date.now(),connections:[]};_e={id:Ce,name:p||f.wallet,type:"imported",createdAt:f.timestamp,keypairs:[Je]}}}else if(c==="mnemonic"){const je=s.trim(),K=await CryptoService.encrypt(je,y),{nsec:L,npub:st,path:dt,privateKeyHex:Je}=CryptoService.deriveKeypair(je,0);if(We.some(cr=>cr.keypairs.some(fr=>fr.npub===st))){Re("Wallet already exists"),O(!1);return}const pt=await CryptoService.encrypt(L,y);Le=Je,Ye=CryptoService.getPublicKeyHex(L);const rr={id:P,walletId:Ce,name:"Main Account",derivationPath:dt,encryptedNsec:pt,npub:st,createdAt:Date.now(),connections:[]};_e={id:Ce,name:p||"Imported Wallet",type:"mnemonic",encryptedSeed:K,createdAt:Date.now(),keypairs:[rr]}}else{const je=s.trim(),K=CryptoService.nsecToNpub(je);if(We.some(dt=>dt.keypairs.some(Je=>Je.npub===K))){Re("Wallet already exists"),O(!1);return}const L=await CryptoService.encrypt(je,y);Le=CryptoService.nsecToHex(je),Ye=CryptoService.getPublicKeyHex(je);const st={id:P,walletId:Ce,name:"Main Account",encryptedNsec:L,npub:K,createdAt:Date.now(),connections:[]};_e={id:Ce,name:p||"Imported Wallet",type:"imported",createdAt:Date.now(),keypairs:[st]}}$e(_e),ze(Ce),q(P),setTimeout(async()=>{try{const{ProfileService:je}=await __vitePreload(async()=>{const{ProfileService:L}=await Promise.resolve().then(()=>profile);return{ProfileService:L}},void 0,import.meta.url),K=await je.fetchProfile(_e.keypairs[0].npub);K&&W(Ce,P,{profile:{...K,lastFetched:Date.now()}})}catch(je){console.error("Failed to fetch profile for imported wallet:",je)}},100),Xe(Le,Ye,y),useEcashStore.getState().loadSession(Ye),e()}catch(Ce){console.error(Ce),Re(c==="encrypted"?"Incorrect password. Failed to decrypt backup.":"Failed to import wallet")}finally{O(!1)}};return jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md mx-auto p-6",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>{r==="method"?t():n(r==="encrypt"?c==="encrypted"?"method":"input":"method")},className:"flex items-center text-slate-400 hover:text-white mb-6 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]}),r==="method"&&jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Import Wallet"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400",children:"Choose how you want to import your wallet."})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-4",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>n("input"),className:"p-4 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-700 transition-all text-left group",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-lg",children:"Recovery Phrase / Private Key"}),jsxRuntimeExports.jsx(KeyRound,{className:"w-5 h-5 text-amber-500"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-400",children:"Import using your 12/24 word seed phrase or nsec."})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{document.getElementById("backup-file-input")?.click()},className:"p-4 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-700 transition-all text-left group relative",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-lg",children:"Encrypted Backup File"}),jsxRuntimeExports.jsx(FileBraces,{className:"w-5 h-5 text-blue-500"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-400",children:"Import from a previously exported JSON backup file."}),jsxRuntimeExports.jsx("input",{id:"backup-file-input",type:"file",accept:".json",onChange:Ve,className:"hidden"})]})]}),k&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm text-center",children:k})]}),r==="input"&&jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Enter Credentials"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400",children:"Enter your recovery phrase or private key (nsec)."})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("textarea",{value:s,onChange:I=>o(I.target.value),placeholder:"word1 word2 word3... OR nsec1...",className:"w-full h-32 bg-slate-900 border border-slate-800 rounded-xl p-4 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all font-mono text-sm resize-none"}),k&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded-lg border border-red-500/20",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 flex-shrink-0"}),k]}),jsxRuntimeExports.jsx("button",{onClick:it,disabled:!s.trim(),className:"w-full py-3 px-4 bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Continue"})]})]}),r==="encrypt"&&jsxRuntimeExports.jsxs("form",{onSubmit:v,className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold mb-2",children:c==="encrypted"?"Decrypt Backup":"Secure Your Wallet"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400",children:c==="encrypted"?"Enter the password used to encrypt this backup.":"Set a name and password for this device."})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Wallet Name"}),jsxRuntimeExports.jsx("input",{type:"text",value:p,onChange:I=>g(I.target.value),placeholder:"e.g. Main Wallet",className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:c==="encrypted"?"Backup Password":"Password"}),jsxRuntimeExports.jsx("input",{type:"password",value:y,onChange:I=>b(I.target.value),placeholder:c==="encrypted"?"Enter backup password":"At least 8 characters",inputMode:"numeric",className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",required:!0,minLength:c==="encrypted"?1:8})]}),c!=="encrypted"&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Confirm Password"}),jsxRuntimeExports.jsx("input",{type:"password",value:R,onChange:I=>D(I.target.value),placeholder:"Repeat password",inputMode:"numeric",className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",required:!0})]})]}),k&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm text-center",children:k}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:Fe,className:"w-full py-3 px-4 bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:Fe?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(RefreshCw,{className:"w-4 h-4 mr-2 animate-spin"}),c==="encrypted"?"Decrypting...":"Importing..."]}):c==="encrypted"?"Decrypt & Import":"Import Wallet"})]})]})},Login=()=>{const{unlock:t}=useAuthStore(),{wallets:e,currentWalletId:r,setCurrentWallet:n}=useWalletStore(),[s,o]=reactExports.useState("login"),[c,u]=reactExports.useState(""),[f,x]=reactExports.useState(null),[p,g]=reactExports.useState(!1),[y,b]=reactExports.useState(""),[R,D]=reactExports.useState(!1);reactExports.useEffect(()=>{e.length===0||(r&&e.find(Re=>Re.id===r)?b(r):e.length>0&&b(e[0].id))},[e,r]);const k=async Re=>{Re.preventDefault(),x(null),g(!0);try{const Fe=e.find(W=>W.id===y);if(!Fe)throw new Error("Wallet not found");const O=Fe.keypairs[0];if(!O)throw new Error("No keypairs in wallet");const $e=await CryptoService.decrypt(O.encryptedNsec,c),ze=CryptoService.nsecToHex($e),q=CryptoService.getPublicKeyHex($e);n(Fe.id),t(ze,q,c),useEcashStore.getState().loadSession(q)}catch(Fe){console.error(Fe),x("Invalid password")}finally{g(!1)}};return s==="create"?jsxRuntimeExports.jsx(CreateWallet,{onBack:()=>o("login"),onComplete:()=>{}}):s==="import"?jsxRuntimeExports.jsx(ImportWallet,{onBack:()=>o("login"),onComplete:()=>{}}):e.length===0?jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-950 p-4",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-slate-900 rounded-2xl p-8 shadow-xl border border-slate-800 text-center",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center mb-6",children:jsxRuntimeExports.jsx("img",{src:"./pwa-192x192.png",alt:"PWANS Logo",className:"w-24 h-24 rounded-full"})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Welcome to PWANS"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 mb-8",children:"Your secure Nostr signer. Create a new address book or import an existing one to get started."}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>o("create"),className:"w-full py-4 px-6 bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold rounded-xl transition-colors flex items-center justify-center gap-3",children:[jsxRuntimeExports.jsx(Plus,{className:"w-5 h-5"}),"Create New Address Book"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>o("import"),className:"w-full py-4 px-6 bg-slate-800 hover:bg-slate-700 text-white font-medium rounded-xl transition-colors flex items-center justify-center gap-3",children:[jsxRuntimeExports.jsx(Download,{className:"w-5 h-5"}),"Import Address Book"]})]})]})}):jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-950 p-4",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-slate-900 rounded-2xl p-8 shadow-xl border border-slate-800",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center mb-6",children:jsxRuntimeExports.jsx("div",{className:"p-4 bg-amber-500/10 rounded-full",children:jsxRuntimeExports.jsx(Lock,{className:"w-8 h-8 text-amber-500"})})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-center mb-2",children:"Unlock Address Book"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-center mb-8",children:"Enter your password to access your keys"}),jsxRuntimeExports.jsxs("form",{onSubmit:k,className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Select Address Book"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>D(!R),className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all text-left flex items-center justify-between",children:[jsxRuntimeExports.jsx("span",{children:e.find(Re=>Re.id===y)?.name||"Select..."}),jsxRuntimeExports.jsx("svg",{className:`w-5 h-5 transition-transform ${R?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),R&&jsxRuntimeExports.jsx("div",{className:"absolute z-10 w-full mt-2 bg-slate-900 border border-slate-800 rounded-lg shadow-xl max-h-60 overflow-y-auto",children:e.map(Re=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{b(Re.id),D(!1)},className:`w-full px-4 py-3 text-left hover:bg-slate-800 transition-colors ${y===Re.id?"bg-amber-500/10 text-amber-500":"text-white"}`,children:Re.name},Re.id))})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Password"}),jsxRuntimeExports.jsx("input",{type:"password",value:c,onChange:Re=>u(Re.target.value),inputMode:"numeric",className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",placeholder:"",required:!0})]}),f&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm bg-red-400/10 p-3 rounded-lg",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-4 h-4"}),f]}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:p,className:"w-full bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:p?"Unlocking...":jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LogIn,{className:"w-4 h-4"}),"Unlock"]})}),jsxRuntimeExports.jsxs("div",{className:"pt-4 border-t border-slate-800 flex justify-center gap-4 text-sm",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>o("create"),className:"text-slate-400 hover:text-amber-500 transition-colors",children:"Create New"}),jsxRuntimeExports.jsx("span",{className:"text-slate-600",children:"|"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>o("import"),className:"text-slate-400 hover:text-amber-500 transition-colors",children:"Import"})]})]})]})})},useSettingsStore=create()(persist(t=>({eventCreatorMode:!1,toggleEventCreatorMode:()=>t(e=>({eventCreatorMode:!e.eventCreatorMode}))}),{name:"amber-settings",storage:createJSONStorage(()=>localStorage)}));var __defProp$1=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp$1=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(t,e,r)=>e in t?__defProp$1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,__spreadValues=(t,e)=>{for(var r in e||(e={}))__hasOwnProp$1.call(e,r)&&__defNormalProp(t,r,e[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(e))__propIsEnum.call(e,r)&&__defNormalProp(t,r,e[r]);return t},__objRest=(t,e)=>{var r={};for(var n in t)__hasOwnProp$1.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&__getOwnPropSymbols)for(var n of __getOwnPropSymbols(t))e.indexOf(n)<0&&__propIsEnum.call(t,n)&&(r[n]=t[n]);return r};var qrcodegen;(t=>{const e=class un{constructor(f,x,p,g){if(this.version=f,this.errorCorrectionLevel=x,this.modules=[],this.isFunction=[],f<un.MIN_VERSION||f>un.MAX_VERSION)throw new RangeError("Version value out of range");if(g<-1||g>7)throw new RangeError("Mask value out of range");this.size=f*4+17;let y=[];for(let R=0;R<this.size;R++)y.push(!1);for(let R=0;R<this.size;R++)this.modules.push(y.slice()),this.isFunction.push(y.slice());this.drawFunctionPatterns();const b=this.addEccAndInterleave(p);if(this.drawCodewords(b),g==-1){let R=1e9;for(let D=0;D<8;D++){this.applyMask(D),this.drawFormatBits(D);const k=this.getPenaltyScore();k<R&&(g=D,R=k),this.applyMask(D)}}s(0<=g&&g<=7),this.mask=g,this.applyMask(g),this.drawFormatBits(g),this.isFunction=[]}static encodeText(f,x){const p=t.QrSegment.makeSegments(f);return un.encodeSegments(p,x)}static encodeBinary(f,x){const p=t.QrSegment.makeBytes(f);return un.encodeSegments([p],x)}static encodeSegments(f,x,p=1,g=40,y=-1,b=!0){if(!(un.MIN_VERSION<=p&&p<=g&&g<=un.MAX_VERSION)||y<-1||y>7)throw new RangeError("Invalid value");let R,D;for(R=p;;R++){const O=un.getNumDataCodewords(R,x)*8,$e=c.getTotalBits(f,R);if($e<=O){D=$e;break}if(R>=g)throw new RangeError("Data too long")}for(const O of[un.Ecc.MEDIUM,un.Ecc.QUARTILE,un.Ecc.HIGH])b&&D<=un.getNumDataCodewords(R,O)*8&&(x=O);let k=[];for(const O of f){r(O.mode.modeBits,4,k),r(O.numChars,O.mode.numCharCountBits(R),k);for(const $e of O.getData())k.push($e)}s(k.length==D);const Re=un.getNumDataCodewords(R,x)*8;s(k.length<=Re),r(0,Math.min(4,Re-k.length),k),r(0,(8-k.length%8)%8,k),s(k.length%8==0);for(let O=236;k.length<Re;O^=253)r(O,8,k);let Fe=[];for(;Fe.length*8<k.length;)Fe.push(0);return k.forEach((O,$e)=>Fe[$e>>>3]|=O<<7-($e&7)),new un(R,x,Fe,y)}getModule(f,x){return 0<=f&&f<this.size&&0<=x&&x<this.size&&this.modules[x][f]}getModules(){return this.modules}drawFunctionPatterns(){for(let p=0;p<this.size;p++)this.setFunctionModule(6,p,p%2==0),this.setFunctionModule(p,6,p%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const f=this.getAlignmentPatternPositions(),x=f.length;for(let p=0;p<x;p++)for(let g=0;g<x;g++)p==0&&g==0||p==0&&g==x-1||p==x-1&&g==0||this.drawAlignmentPattern(f[p],f[g]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(f){const x=this.errorCorrectionLevel.formatBits<<3|f;let p=x;for(let y=0;y<10;y++)p=p<<1^(p>>>9)*1335;const g=(x<<10|p)^21522;s(g>>>15==0);for(let y=0;y<=5;y++)this.setFunctionModule(8,y,n(g,y));this.setFunctionModule(8,7,n(g,6)),this.setFunctionModule(8,8,n(g,7)),this.setFunctionModule(7,8,n(g,8));for(let y=9;y<15;y++)this.setFunctionModule(14-y,8,n(g,y));for(let y=0;y<8;y++)this.setFunctionModule(this.size-1-y,8,n(g,y));for(let y=8;y<15;y++)this.setFunctionModule(8,this.size-15+y,n(g,y));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let f=this.version;for(let p=0;p<12;p++)f=f<<1^(f>>>11)*7973;const x=this.version<<12|f;s(x>>>18==0);for(let p=0;p<18;p++){const g=n(x,p),y=this.size-11+p%3,b=Math.floor(p/3);this.setFunctionModule(y,b,g),this.setFunctionModule(b,y,g)}}drawFinderPattern(f,x){for(let p=-4;p<=4;p++)for(let g=-4;g<=4;g++){const y=Math.max(Math.abs(g),Math.abs(p)),b=f+g,R=x+p;0<=b&&b<this.size&&0<=R&&R<this.size&&this.setFunctionModule(b,R,y!=2&&y!=4)}}drawAlignmentPattern(f,x){for(let p=-2;p<=2;p++)for(let g=-2;g<=2;g++)this.setFunctionModule(f+g,x+p,Math.max(Math.abs(g),Math.abs(p))!=1)}setFunctionModule(f,x,p){this.modules[x][f]=p,this.isFunction[x][f]=!0}addEccAndInterleave(f){const x=this.version,p=this.errorCorrectionLevel;if(f.length!=un.getNumDataCodewords(x,p))throw new RangeError("Invalid argument");const g=un.NUM_ERROR_CORRECTION_BLOCKS[p.ordinal][x],y=un.ECC_CODEWORDS_PER_BLOCK[p.ordinal][x],b=Math.floor(un.getNumRawDataModules(x)/8),R=g-b%g,D=Math.floor(b/g);let k=[];const Re=un.reedSolomonComputeDivisor(y);for(let O=0,$e=0;O<g;O++){let ze=f.slice($e,$e+D-y+(O<R?0:1));$e+=ze.length;const q=un.reedSolomonComputeRemainder(ze,Re);O<R&&ze.push(0),k.push(ze.concat(q))}let Fe=[];for(let O=0;O<k[0].length;O++)k.forEach(($e,ze)=>{(O!=D-y||ze>=R)&&Fe.push($e[O])});return s(Fe.length==b),Fe}drawCodewords(f){if(f.length!=Math.floor(un.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let x=0;for(let p=this.size-1;p>=1;p-=2){p==6&&(p=5);for(let g=0;g<this.size;g++)for(let y=0;y<2;y++){const b=p-y,D=(p+1&2)==0?this.size-1-g:g;!this.isFunction[D][b]&&x<f.length*8&&(this.modules[D][b]=n(f[x>>>3],7-(x&7)),x++)}}s(x==f.length*8)}applyMask(f){if(f<0||f>7)throw new RangeError("Mask value out of range");for(let x=0;x<this.size;x++)for(let p=0;p<this.size;p++){let g;switch(f){case 0:g=(p+x)%2==0;break;case 1:g=x%2==0;break;case 2:g=p%3==0;break;case 3:g=(p+x)%3==0;break;case 4:g=(Math.floor(p/3)+Math.floor(x/2))%2==0;break;case 5:g=p*x%2+p*x%3==0;break;case 6:g=(p*x%2+p*x%3)%2==0;break;case 7:g=((p+x)%2+p*x%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[x][p]&&g&&(this.modules[x][p]=!this.modules[x][p])}}getPenaltyScore(){let f=0;for(let y=0;y<this.size;y++){let b=!1,R=0,D=[0,0,0,0,0,0,0];for(let k=0;k<this.size;k++)this.modules[y][k]==b?(R++,R==5?f+=un.PENALTY_N1:R>5&&f++):(this.finderPenaltyAddHistory(R,D),b||(f+=this.finderPenaltyCountPatterns(D)*un.PENALTY_N3),b=this.modules[y][k],R=1);f+=this.finderPenaltyTerminateAndCount(b,R,D)*un.PENALTY_N3}for(let y=0;y<this.size;y++){let b=!1,R=0,D=[0,0,0,0,0,0,0];for(let k=0;k<this.size;k++)this.modules[k][y]==b?(R++,R==5?f+=un.PENALTY_N1:R>5&&f++):(this.finderPenaltyAddHistory(R,D),b||(f+=this.finderPenaltyCountPatterns(D)*un.PENALTY_N3),b=this.modules[k][y],R=1);f+=this.finderPenaltyTerminateAndCount(b,R,D)*un.PENALTY_N3}for(let y=0;y<this.size-1;y++)for(let b=0;b<this.size-1;b++){const R=this.modules[y][b];R==this.modules[y][b+1]&&R==this.modules[y+1][b]&&R==this.modules[y+1][b+1]&&(f+=un.PENALTY_N2)}let x=0;for(const y of this.modules)x=y.reduce((b,R)=>b+(R?1:0),x);const p=this.size*this.size,g=Math.ceil(Math.abs(x*20-p*10)/p)-1;return s(0<=g&&g<=9),f+=g*un.PENALTY_N4,s(0<=f&&f<=2568888),f}getAlignmentPatternPositions(){if(this.version==1)return[];{const f=Math.floor(this.version/7)+2,x=this.version==32?26:Math.ceil((this.version*4+4)/(f*2-2))*2;let p=[6];for(let g=this.size-7;p.length<f;g-=x)p.splice(1,0,g);return p}}static getNumRawDataModules(f){if(f<un.MIN_VERSION||f>un.MAX_VERSION)throw new RangeError("Version number out of range");let x=(16*f+128)*f+64;if(f>=2){const p=Math.floor(f/7)+2;x-=(25*p-10)*p-55,f>=7&&(x-=36)}return s(208<=x&&x<=29648),x}static getNumDataCodewords(f,x){return Math.floor(un.getNumRawDataModules(f)/8)-un.ECC_CODEWORDS_PER_BLOCK[x.ordinal][f]*un.NUM_ERROR_CORRECTION_BLOCKS[x.ordinal][f]}static reedSolomonComputeDivisor(f){if(f<1||f>255)throw new RangeError("Degree out of range");let x=[];for(let g=0;g<f-1;g++)x.push(0);x.push(1);let p=1;for(let g=0;g<f;g++){for(let y=0;y<x.length;y++)x[y]=un.reedSolomonMultiply(x[y],p),y+1<x.length&&(x[y]^=x[y+1]);p=un.reedSolomonMultiply(p,2)}return x}static reedSolomonComputeRemainder(f,x){let p=x.map(g=>0);for(const g of f){const y=g^p.shift();p.push(0),x.forEach((b,R)=>p[R]^=un.reedSolomonMultiply(b,y))}return p}static reedSolomonMultiply(f,x){if(f>>>8||x>>>8)throw new RangeError("Byte out of range");let p=0;for(let g=7;g>=0;g--)p=p<<1^(p>>>7)*285,p^=(x>>>g&1)*f;return s(p>>>8==0),p}finderPenaltyCountPatterns(f){const x=f[1];s(x<=this.size*3);const p=x>0&&f[2]==x&&f[3]==x*3&&f[4]==x&&f[5]==x;return(p&&f[0]>=x*4&&f[6]>=x?1:0)+(p&&f[6]>=x*4&&f[0]>=x?1:0)}finderPenaltyTerminateAndCount(f,x,p){return f&&(this.finderPenaltyAddHistory(x,p),x=0),x+=this.size,this.finderPenaltyAddHistory(x,p),this.finderPenaltyCountPatterns(p)}finderPenaltyAddHistory(f,x){x[0]==0&&(f+=this.size),x.pop(),x.unshift(f)}};e.MIN_VERSION=1,e.MAX_VERSION=40,e.PENALTY_N1=3,e.PENALTY_N2=3,e.PENALTY_N3=40,e.PENALTY_N4=10,e.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],e.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],t.QrCode=e;function r(u,f,x){if(f<0||f>31||u>>>f)throw new RangeError("Value out of range");for(let p=f-1;p>=0;p--)x.push(u>>>p&1)}function n(u,f){return(u>>>f&1)!=0}function s(u){if(!u)throw new Error("Assertion error")}const o=class In{constructor(f,x,p){if(this.mode=f,this.numChars=x,this.bitData=p,x<0)throw new RangeError("Invalid argument");this.bitData=p.slice()}static makeBytes(f){let x=[];for(const p of f)r(p,8,x);return new In(In.Mode.BYTE,f.length,x)}static makeNumeric(f){if(!In.isNumeric(f))throw new RangeError("String contains non-numeric characters");let x=[];for(let p=0;p<f.length;){const g=Math.min(f.length-p,3);r(parseInt(f.substring(p,p+g),10),g*3+1,x),p+=g}return new In(In.Mode.NUMERIC,f.length,x)}static makeAlphanumeric(f){if(!In.isAlphanumeric(f))throw new RangeError("String contains unencodable characters in alphanumeric mode");let x=[],p;for(p=0;p+2<=f.length;p+=2){let g=In.ALPHANUMERIC_CHARSET.indexOf(f.charAt(p))*45;g+=In.ALPHANUMERIC_CHARSET.indexOf(f.charAt(p+1)),r(g,11,x)}return p<f.length&&r(In.ALPHANUMERIC_CHARSET.indexOf(f.charAt(p)),6,x),new In(In.Mode.ALPHANUMERIC,f.length,x)}static makeSegments(f){return f==""?[]:In.isNumeric(f)?[In.makeNumeric(f)]:In.isAlphanumeric(f)?[In.makeAlphanumeric(f)]:[In.makeBytes(In.toUtf8ByteArray(f))]}static makeEci(f){let x=[];if(f<0)throw new RangeError("ECI assignment value out of range");if(f<128)r(f,8,x);else if(f<16384)r(2,2,x),r(f,14,x);else if(f<1e6)r(6,3,x),r(f,21,x);else throw new RangeError("ECI assignment value out of range");return new In(In.Mode.ECI,0,x)}static isNumeric(f){return In.NUMERIC_REGEX.test(f)}static isAlphanumeric(f){return In.ALPHANUMERIC_REGEX.test(f)}getData(){return this.bitData.slice()}static getTotalBits(f,x){let p=0;for(const g of f){const y=g.mode.numCharCountBits(x);if(g.numChars>=1<<y)return 1/0;p+=4+y+g.bitData.length}return p}static toUtf8ByteArray(f){f=encodeURI(f);let x=[];for(let p=0;p<f.length;p++)f.charAt(p)!="%"?x.push(f.charCodeAt(p)):(x.push(parseInt(f.substring(p+1,p+3),16)),p+=2);return x}};o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let c=o;t.QrSegment=o})(qrcodegen||(qrcodegen={}));(t=>{(e=>{const r=class{constructor(s,o){this.ordinal=s,this.formatBits=o}};r.LOW=new r(0,1),r.MEDIUM=new r(1,0),r.QUARTILE=new r(2,3),r.HIGH=new r(3,2),e.Ecc=r})(t.QrCode||(t.QrCode={}))})(qrcodegen||(qrcodegen={}));(t=>{(e=>{const r=class{constructor(s,o){this.modeBits=s,this.numBitsCharCount=o}numCharCountBits(s){return this.numBitsCharCount[Math.floor((s+7)/17)]}};r.NUMERIC=new r(1,[10,12,14]),r.ALPHANUMERIC=new r(2,[9,11,13]),r.BYTE=new r(4,[8,16,16]),r.KANJI=new r(8,[8,10,12]),r.ECI=new r(7,[0,0,0]),e.Mode=r})(t.QrSegment||(t.QrSegment={}))})(qrcodegen||(qrcodegen={}));var qrcodegen_default=qrcodegen;var ERROR_LEVEL_MAP={L:qrcodegen_default.QrCode.Ecc.LOW,M:qrcodegen_default.QrCode.Ecc.MEDIUM,Q:qrcodegen_default.QrCode.Ecc.QUARTILE,H:qrcodegen_default.QrCode.Ecc.HIGH},DEFAULT_SIZE=128,DEFAULT_LEVEL="L",DEFAULT_BGCOLOR="#FFFFFF",DEFAULT_FGCOLOR="#000000",DEFAULT_INCLUDEMARGIN=!1,DEFAULT_MINVERSION=1,SPEC_MARGIN_SIZE=4,DEFAULT_MARGIN_SIZE=0,DEFAULT_IMG_SCALE=.1;function generatePath(t,e=0){const r=[];return t.forEach(function(n,s){let o=null;n.forEach(function(c,u){if(!c&&o!==null){r.push(`M${o+e} ${s+e}h${u-o}v1H${o+e}z`),o=null;return}if(u===n.length-1){if(!c)return;o===null?r.push(`M${u+e},${s+e} h1v1H${u+e}z`):r.push(`M${o+e},${s+e} h${u+1-o}v1H${o+e}z`);return}c&&o===null&&(o=u)})}),r.join("")}function excavateModules(t,e){return t.slice().map((r,n)=>n<e.y||n>=e.y+e.h?r:r.map((s,o)=>o<e.x||o>=e.x+e.w?s:!1))}function getImageSettings(t,e,r,n){if(n==null)return null;const s=t.length+r*2,o=Math.floor(e*DEFAULT_IMG_SCALE),c=s/e,u=(n.width||o)*c,f=(n.height||o)*c,x=n.x==null?t.length/2-u/2:n.x*c,p=n.y==null?t.length/2-f/2:n.y*c,g=n.opacity==null?1:n.opacity;let y=null;if(n.excavate){let R=Math.floor(x),D=Math.floor(p),k=Math.ceil(u+x-R),Re=Math.ceil(f+p-D);y={x:R,y:D,w:k,h:Re}}const b=n.crossOrigin;return{x,y:p,h:f,w:u,excavation:y,opacity:g,crossOrigin:b}}function getMarginSize(t,e){return e!=null?Math.max(Math.floor(e),0):t?SPEC_MARGIN_SIZE:DEFAULT_MARGIN_SIZE}function useQRCode({value:t,level:e,minVersion:r,includeMargin:n,marginSize:s,imageSettings:o,size:c,boostLevel:u}){let f=React.useMemo(()=>{const R=(Array.isArray(t)?t:[t]).reduce((D,k)=>(D.push(...qrcodegen_default.QrSegment.makeSegments(k)),D),[]);return qrcodegen_default.QrCode.encodeSegments(R,ERROR_LEVEL_MAP[e],r,void 0,void 0,u)},[t,e,r,u]);const{cells:x,margin:p,numCells:g,calculatedImageSettings:y}=React.useMemo(()=>{let b=f.getModules();const R=getMarginSize(n,s),D=b.length+R*2,k=getImageSettings(b,c,R,o);return{cells:b,margin:R,numCells:D,calculatedImageSettings:k}},[f,c,o,n,s]);return{qrcode:f,margin:p,cells:x,numCells:g,calculatedImageSettings:y}}var SUPPORTS_PATH2D=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),QRCodeCanvas=React.forwardRef(function(e,r){const n=e,{value:s,size:o=DEFAULT_SIZE,level:c=DEFAULT_LEVEL,bgColor:u=DEFAULT_BGCOLOR,fgColor:f=DEFAULT_FGCOLOR,includeMargin:x=DEFAULT_INCLUDEMARGIN,minVersion:p=DEFAULT_MINVERSION,boostLevel:g,marginSize:y,imageSettings:b}=n,D=__objRest(n,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:k}=D,Re=__objRest(D,["style"]),Fe=b?.src,O=React.useRef(null),$e=React.useRef(null),ze=React.useCallback(Ce=>{O.current=Ce,typeof r=="function"?r(Ce):r&&(r.current=Ce)},[r]),[q,W]=React.useState(!1),{margin:We,cells:Xe,numCells:it,calculatedImageSettings:Ve}=useQRCode({value:s,level:c,minVersion:p,boostLevel:g,includeMargin:x,marginSize:y,imageSettings:b,size:o});React.useEffect(()=>{if(O.current!=null){const Ce=O.current,P=Ce.getContext("2d");if(!P)return;let _e=Xe;const Le=$e.current,Ye=Ve!=null&&Le!==null&&Le.complete&&Le.naturalHeight!==0&&Le.naturalWidth!==0;Ye&&Ve.excavation!=null&&(_e=excavateModules(Xe,Ve.excavation));const je=window.devicePixelRatio||1;Ce.height=Ce.width=o*je;const K=o/it*je;P.scale(K,K),P.fillStyle=u,P.fillRect(0,0,it,it),P.fillStyle=f,SUPPORTS_PATH2D?P.fill(new Path2D(generatePath(_e,We))):Xe.forEach(function(L,st){L.forEach(function(dt,Je){dt&&P.fillRect(Je+We,st+We,1,1)})}),Ve&&(P.globalAlpha=Ve.opacity),Ye&&P.drawImage(Le,Ve.x+We,Ve.y+We,Ve.w,Ve.h)}}),React.useEffect(()=>{W(!1)},[Fe]);const v=__spreadValues({height:o,width:o},k);let I=null;return Fe!=null&&(I=React.createElement("img",{src:Fe,key:Fe,style:{display:"none"},onLoad:()=>{W(!0)},ref:$e,crossOrigin:Ve?.crossOrigin})),React.createElement(React.Fragment,null,React.createElement("canvas",__spreadValues({style:v,height:o,width:o,ref:ze,role:"img"},Re)),I)});QRCodeCanvas.displayName="QRCodeCanvas";var QRCodeSVG=React.forwardRef(function(e,r){const n=e,{value:s,size:o=DEFAULT_SIZE,level:c=DEFAULT_LEVEL,bgColor:u=DEFAULT_BGCOLOR,fgColor:f=DEFAULT_FGCOLOR,includeMargin:x=DEFAULT_INCLUDEMARGIN,minVersion:p=DEFAULT_MINVERSION,boostLevel:g,title:y,marginSize:b,imageSettings:R}=n,D=__objRest(n,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:k,cells:Re,numCells:Fe,calculatedImageSettings:O}=useQRCode({value:s,level:c,minVersion:p,boostLevel:g,includeMargin:x,marginSize:b,imageSettings:R,size:o});let $e=Re,ze=null;R!=null&&O!=null&&(O.excavation!=null&&($e=excavateModules(Re,O.excavation)),ze=React.createElement("image",{href:R.src,height:O.h,width:O.w,x:O.x+k,y:O.y+k,preserveAspectRatio:"none",opacity:O.opacity,crossOrigin:O.crossOrigin}));const q=generatePath($e,k);return React.createElement("svg",__spreadValues({height:o,width:o,viewBox:`0 0 ${Fe} ${Fe}`,ref:r,role:"img"},D),!!y&&React.createElement("title",null,y),React.createElement("path",{fill:u,d:`M0,0 h${Fe}v${Fe}H0z`,shapeRendering:"crispEdges"}),React.createElement("path",{fill:f,d:q,shapeRendering:"crispEdges"}),ze)});QRCodeSVG.displayName="QRCodeSVG";var dist$4={},ur={},errors$1={},hasRequiredErrors$1;function requireErrors$1(){if(hasRequiredErrors$1)return errors$1;hasRequiredErrors$1=1,Object.defineProperty(errors$1,"__esModule",{value:!0}),errors$1.InvalidChecksumError=errors$1.InvalidSequenceComponentError=errors$1.InvalidTypeError=errors$1.InvalidPathLengthError=errors$1.InvalidSchemeError=void 0;class t extends Error{constructor(){super("Invalid Scheme"),this.name="InvalidSchemeError"}}errors$1.InvalidSchemeError=t;class e extends Error{constructor(){super("Invalid Path"),this.name="InvalidPathLengthError"}}errors$1.InvalidPathLengthError=e;class r extends Error{constructor(){super("Invalid Type"),this.name="InvalidTypeError"}}errors$1.InvalidTypeError=r;class n extends Error{constructor(){super("Invalid Sequence Component"),this.name="InvalidSequenceComponentError"}}errors$1.InvalidSequenceComponentError=n;class s extends Error{constructor(){super("Invalid Checksum"),this.name="InvalidChecksumError"}}return errors$1.InvalidChecksumError=s,errors$1}var utils$7={},sha_js={exports:{}},inherits_browser={exports:{}},hasRequiredInherits_browser;function requireInherits_browser(){return hasRequiredInherits_browser||(hasRequiredInherits_browser=1,typeof Object.create=="function"?inherits_browser.exports=function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(e,r){if(r){e.super_=r;var n=function(){};n.prototype=r.prototype,e.prototype=new n,e.prototype.constructor=e}}),inherits_browser.exports}var safeBuffer={exports:{}},dist$3={},hasRequiredDist$4;function requireDist$4(){return hasRequiredDist$4||(hasRequiredDist$4=1,(function(t){Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var e={},r={};r.byteLength=p,r.toByteArray=y,r.fromByteArray=D;for(var n=[],s=[],o=typeof Uint8Array<"u"?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,f=c.length;u<f;++u)n[u]=c[u],s[c.charCodeAt(u)]=u;s[45]=62,s[95]=63;function x(Fe){var O=Fe.length;if(O%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var $e=Fe.indexOf("=");$e===-1&&($e=O);var ze=$e===O?0:4-$e%4;return[$e,ze]}function p(Fe){var O=x(Fe),$e=O[0],ze=O[1];return($e+ze)*3/4-ze}function g(Fe,O,$e){return(O+$e)*3/4-$e}function y(Fe){var O,$e=x(Fe),ze=$e[0],q=$e[1],W=new o(g(Fe,ze,q)),We=0,Xe=q>0?ze-4:ze,it;for(it=0;it<Xe;it+=4)O=s[Fe.charCodeAt(it)]<<18|s[Fe.charCodeAt(it+1)]<<12|s[Fe.charCodeAt(it+2)]<<6|s[Fe.charCodeAt(it+3)],W[We++]=O>>16&255,W[We++]=O>>8&255,W[We++]=O&255;return q===2&&(O=s[Fe.charCodeAt(it)]<<2|s[Fe.charCodeAt(it+1)]>>4,W[We++]=O&255),q===1&&(O=s[Fe.charCodeAt(it)]<<10|s[Fe.charCodeAt(it+1)]<<4|s[Fe.charCodeAt(it+2)]>>2,W[We++]=O>>8&255,W[We++]=O&255),W}function b(Fe){return n[Fe>>18&63]+n[Fe>>12&63]+n[Fe>>6&63]+n[Fe&63]}function R(Fe,O,$e){for(var ze,q=[],W=O;W<$e;W+=3)ze=(Fe[W]<<16&16711680)+(Fe[W+1]<<8&65280)+(Fe[W+2]&255),q.push(b(ze));return q.join("")}function D(Fe){for(var O,$e=Fe.length,ze=$e%3,q=[],W=16383,We=0,Xe=$e-ze;We<Xe;We+=W)q.push(R(Fe,We,We+W>Xe?Xe:We+W));return ze===1?(O=Fe[$e-1],q.push(n[O>>2]+n[O<<4&63]+"==")):ze===2&&(O=(Fe[$e-2]<<8)+Fe[$e-1],q.push(n[O>>10]+n[O>>4&63]+n[O<<2&63]+"=")),q.join("")}var k={};k.read=function(Fe,O,$e,ze,q){var W,We,Xe=q*8-ze-1,it=(1<<Xe)-1,Ve=it>>1,v=-7,I=$e?q-1:0,Ce=$e?-1:1,P=Fe[O+I];for(I+=Ce,W=P&(1<<-v)-1,P>>=-v,v+=Xe;v>0;W=W*256+Fe[O+I],I+=Ce,v-=8);for(We=W&(1<<-v)-1,W>>=-v,v+=ze;v>0;We=We*256+Fe[O+I],I+=Ce,v-=8);if(W===0)W=1-Ve;else{if(W===it)return We?NaN:(P?-1:1)*(1/0);We=We+Math.pow(2,ze),W=W-Ve}return(P?-1:1)*We*Math.pow(2,W-ze)},k.write=function(Fe,O,$e,ze,q,W){var We,Xe,it,Ve=W*8-q-1,v=(1<<Ve)-1,I=v>>1,Ce=q===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=ze?0:W-1,_e=ze?1:-1,Le=O<0||O===0&&1/O<0?1:0;for(O=Math.abs(O),isNaN(O)||O===1/0?(Xe=isNaN(O)?1:0,We=v):(We=Math.floor(Math.log(O)/Math.LN2),O*(it=Math.pow(2,-We))<1&&(We--,it*=2),We+I>=1?O+=Ce/it:O+=Ce*Math.pow(2,1-I),O*it>=2&&(We++,it/=2),We+I>=v?(Xe=0,We=v):We+I>=1?(Xe=(O*it-1)*Math.pow(2,q),We=We+I):(Xe=O*Math.pow(2,I-1)*Math.pow(2,q),We=0));q>=8;Fe[$e+P]=Xe&255,P+=_e,Xe/=256,q-=8);for(We=We<<q|Xe,Ve+=q;Ve>0;Fe[$e+P]=We&255,P+=_e,We/=256,Ve-=8);Fe[$e+P-_e]|=Le*128};(function(Fe){const O=r,$e=k,ze=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Fe.Buffer=v,Fe.SlowBuffer=dt,Fe.INSPECT_MAX_BYTES=50;const q=2147483647;Fe.kMaxLength=q;const{Uint8Array:W,ArrayBuffer:We,SharedArrayBuffer:Xe}=globalThis;v.TYPED_ARRAY_SUPPORT=it(),!v.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function it(){try{const dr=new W(1),yt={foo:function(){return 42}};return Object.setPrototypeOf(yt,W.prototype),Object.setPrototypeOf(dr,yt),dr.foo()===42}catch{return!1}}Object.defineProperty(v.prototype,"parent",{enumerable:!0,get:function(){if(v.isBuffer(this))return this.buffer}}),Object.defineProperty(v.prototype,"offset",{enumerable:!0,get:function(){if(v.isBuffer(this))return this.byteOffset}});function Ve(dr){if(dr>q)throw new RangeError('The value "'+dr+'" is invalid for option "size"');const yt=new W(dr);return Object.setPrototypeOf(yt,v.prototype),yt}function v(dr,yt,Ft){if(typeof dr=="number"){if(typeof yt=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return _e(dr)}return I(dr,yt,Ft)}v.poolSize=8192;function I(dr,yt,Ft){if(typeof dr=="string")return Le(dr,yt);if(We.isView(dr))return je(dr);if(dr==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof dr);if(nn(dr,We)||dr&&nn(dr.buffer,We)||typeof Xe<"u"&&(nn(dr,Xe)||dr&&nn(dr.buffer,Xe)))return K(dr,yt,Ft);if(typeof dr=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const vr=dr.valueOf&&dr.valueOf();if(vr!=null&&vr!==dr)return v.from(vr,yt,Ft);const jr=L(dr);if(jr)return jr;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof dr[Symbol.toPrimitive]=="function")return v.from(dr[Symbol.toPrimitive]("string"),yt,Ft);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof dr)}v.from=function(dr,yt,Ft){return I(dr,yt,Ft)},Object.setPrototypeOf(v.prototype,W.prototype),Object.setPrototypeOf(v,W);function Ce(dr){if(typeof dr!="number")throw new TypeError('"size" argument must be of type number');if(dr<0)throw new RangeError('The value "'+dr+'" is invalid for option "size"')}function P(dr,yt,Ft){return Ce(dr),dr<=0?Ve(dr):yt!==void 0?typeof Ft=="string"?Ve(dr).fill(yt,Ft):Ve(dr).fill(yt):Ve(dr)}v.alloc=function(dr,yt,Ft){return P(dr,yt,Ft)};function _e(dr){return Ce(dr),Ve(dr<0?0:st(dr)|0)}v.allocUnsafe=function(dr){return _e(dr)},v.allocUnsafeSlow=function(dr){return _e(dr)};function Le(dr,yt){if((typeof yt!="string"||yt==="")&&(yt="utf8"),!v.isEncoding(yt))throw new TypeError("Unknown encoding: "+yt);const Ft=Je(dr,yt)|0;let vr=Ve(Ft);const jr=vr.write(dr,yt);return jr!==Ft&&(vr=vr.slice(0,jr)),vr}function Ye(dr){const yt=dr.length<0?0:st(dr.length)|0,Ft=Ve(yt);for(let vr=0;vr<yt;vr+=1)Ft[vr]=dr[vr]&255;return Ft}function je(dr){if(nn(dr,W)){const yt=new W(dr);return K(yt.buffer,yt.byteOffset,yt.byteLength)}return Ye(dr)}function K(dr,yt,Ft){if(yt<0||dr.byteLength<yt)throw new RangeError('"offset" is outside of buffer bounds');if(dr.byteLength<yt+(Ft||0))throw new RangeError('"length" is outside of buffer bounds');let vr;return yt===void 0&&Ft===void 0?vr=new W(dr):Ft===void 0?vr=new W(dr,yt):vr=new W(dr,yt,Ft),Object.setPrototypeOf(vr,v.prototype),vr}function L(dr){if(v.isBuffer(dr)){const yt=st(dr.length)|0,Ft=Ve(yt);return Ft.length===0||dr.copy(Ft,0,0,yt),Ft}if(dr.length!==void 0)return typeof dr.length!="number"||Xn(dr.length)?Ve(0):Ye(dr);if(dr.type==="Buffer"&&Array.isArray(dr.data))return Ye(dr.data)}function st(dr){if(dr>=q)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+q.toString(16)+" bytes");return dr|0}function dt(dr){return+dr!=dr&&(dr=0),v.alloc(+dr)}v.isBuffer=function(yt){return yt!=null&&yt._isBuffer===!0&&yt!==v.prototype},v.compare=function(yt,Ft){if(nn(yt,W)&&(yt=v.from(yt,yt.offset,yt.byteLength)),nn(Ft,W)&&(Ft=v.from(Ft,Ft.offset,Ft.byteLength)),!v.isBuffer(yt)||!v.isBuffer(Ft))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(yt===Ft)return 0;let vr=yt.length,jr=Ft.length;for(let Mr=0,Or=Math.min(vr,jr);Mr<Or;++Mr)if(yt[Mr]!==Ft[Mr]){vr=yt[Mr],jr=Ft[Mr];break}return vr<jr?-1:jr<vr?1:0},v.isEncoding=function(yt){switch(String(yt).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},v.concat=function(yt,Ft){if(!Array.isArray(yt))throw new TypeError('"list" argument must be an Array of Buffers');if(yt.length===0)return v.alloc(0);let vr;if(Ft===void 0)for(Ft=0,vr=0;vr<yt.length;++vr)Ft+=yt[vr].length;const jr=v.allocUnsafe(Ft);let Mr=0;for(vr=0;vr<yt.length;++vr){let Or=yt[vr];if(nn(Or,W))Mr+Or.length>jr.length?(v.isBuffer(Or)||(Or=v.from(Or)),Or.copy(jr,Mr)):W.prototype.set.call(jr,Or,Mr);else if(v.isBuffer(Or))Or.copy(jr,Mr);else throw new TypeError('"list" argument must be an Array of Buffers');Mr+=Or.length}return jr};function Je(dr,yt){if(v.isBuffer(dr))return dr.length;if(We.isView(dr)||nn(dr,We))return dr.byteLength;if(typeof dr!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof dr);const Ft=dr.length,vr=arguments.length>2&&arguments[2]===!0;if(!vr&&Ft===0)return 0;let jr=!1;for(;;)switch(yt){case"ascii":case"latin1":case"binary":return Ft;case"utf8":case"utf-8":return Gr(dr).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ft*2;case"hex":return Ft>>>1;case"base64":return Zr(dr).length;default:if(jr)return vr?-1:Gr(dr).length;yt=(""+yt).toLowerCase(),jr=!0}}v.byteLength=Je;function pt(dr,yt,Ft){let vr=!1;if((yt===void 0||yt<0)&&(yt=0),yt>this.length||((Ft===void 0||Ft>this.length)&&(Ft=this.length),Ft<=0)||(Ft>>>=0,yt>>>=0,Ft<=yt))return"";for(dr||(dr="utf8");;)switch(dr){case"hex":return Cr(this,yt,Ft);case"utf8":case"utf-8":return Er(this,yt,Ft);case"ascii":return Br(this,yt,Ft);case"latin1":case"binary":return hr(this,yt,Ft);case"base64":return pr(this,yt,Ft);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _r(this,yt,Ft);default:if(vr)throw new TypeError("Unknown encoding: "+dr);dr=(dr+"").toLowerCase(),vr=!0}}v.prototype._isBuffer=!0;function rr(dr,yt,Ft){const vr=dr[yt];dr[yt]=dr[Ft],dr[Ft]=vr}v.prototype.swap16=function(){const yt=this.length;if(yt%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let Ft=0;Ft<yt;Ft+=2)rr(this,Ft,Ft+1);return this},v.prototype.swap32=function(){const yt=this.length;if(yt%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let Ft=0;Ft<yt;Ft+=4)rr(this,Ft,Ft+3),rr(this,Ft+1,Ft+2);return this},v.prototype.swap64=function(){const yt=this.length;if(yt%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let Ft=0;Ft<yt;Ft+=8)rr(this,Ft,Ft+7),rr(this,Ft+1,Ft+6),rr(this,Ft+2,Ft+5),rr(this,Ft+3,Ft+4);return this},v.prototype.toString=function(){const yt=this.length;return yt===0?"":arguments.length===0?Er(this,0,yt):pt.apply(this,arguments)},v.prototype.toLocaleString=v.prototype.toString,v.prototype.equals=function(yt){if(!v.isBuffer(yt))throw new TypeError("Argument must be a Buffer");return this===yt?!0:v.compare(this,yt)===0},v.prototype.inspect=function(){let yt="";const Ft=Fe.INSPECT_MAX_BYTES;return yt=this.toString("hex",0,Ft).replace(/(.{2})/g,"$1 ").trim(),this.length>Ft&&(yt+=" ... "),"<Buffer "+yt+">"},ze&&(v.prototype[ze]=v.prototype.inspect),v.prototype.compare=function(yt,Ft,vr,jr,Mr){if(nn(yt,W)&&(yt=v.from(yt,yt.offset,yt.byteLength)),!v.isBuffer(yt))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof yt);if(Ft===void 0&&(Ft=0),vr===void 0&&(vr=yt?yt.length:0),jr===void 0&&(jr=0),Mr===void 0&&(Mr=this.length),Ft<0||vr>yt.length||jr<0||Mr>this.length)throw new RangeError("out of range index");if(jr>=Mr&&Ft>=vr)return 0;if(jr>=Mr)return-1;if(Ft>=vr)return 1;if(Ft>>>=0,vr>>>=0,jr>>>=0,Mr>>>=0,this===yt)return 0;let Or=Mr-jr,Yr=vr-Ft;const An=Math.min(Or,Yr),tn=this.slice(jr,Mr),Jr=yt.slice(Ft,vr);for(let rn=0;rn<An;++rn)if(tn[rn]!==Jr[rn]){Or=tn[rn],Yr=Jr[rn];break}return Or<Yr?-1:Yr<Or?1:0};function cr(dr,yt,Ft,vr,jr){if(dr.length===0)return-1;if(typeof Ft=="string"?(vr=Ft,Ft=0):Ft>2147483647?Ft=2147483647:Ft<-2147483648&&(Ft=-2147483648),Ft=+Ft,Xn(Ft)&&(Ft=jr?0:dr.length-1),Ft<0&&(Ft=dr.length+Ft),Ft>=dr.length){if(jr)return-1;Ft=dr.length-1}else if(Ft<0)if(jr)Ft=0;else return-1;if(typeof yt=="string"&&(yt=v.from(yt,vr)),v.isBuffer(yt))return yt.length===0?-1:fr(dr,yt,Ft,vr,jr);if(typeof yt=="number")return yt=yt&255,typeof W.prototype.indexOf=="function"?jr?W.prototype.indexOf.call(dr,yt,Ft):W.prototype.lastIndexOf.call(dr,yt,Ft):fr(dr,[yt],Ft,vr,jr);throw new TypeError("val must be string, number or Buffer")}function fr(dr,yt,Ft,vr,jr){let Mr=1,Or=dr.length,Yr=yt.length;if(vr!==void 0&&(vr=String(vr).toLowerCase(),vr==="ucs2"||vr==="ucs-2"||vr==="utf16le"||vr==="utf-16le")){if(dr.length<2||yt.length<2)return-1;Mr=2,Or/=2,Yr/=2,Ft/=2}function An(Jr,rn){return Mr===1?Jr[rn]:Jr.readUInt16BE(rn*Mr)}let tn;if(jr){let Jr=-1;for(tn=Ft;tn<Or;tn++)if(An(dr,tn)===An(yt,Jr===-1?0:tn-Jr)){if(Jr===-1&&(Jr=tn),tn-Jr+1===Yr)return Jr*Mr}else Jr!==-1&&(tn-=tn-Jr),Jr=-1}else for(Ft+Yr>Or&&(Ft=Or-Yr),tn=Ft;tn>=0;tn--){let Jr=!0;for(let rn=0;rn<Yr;rn++)if(An(dr,tn+rn)!==An(yt,rn)){Jr=!1;break}if(Jr)return tn}return-1}v.prototype.includes=function(yt,Ft,vr){return this.indexOf(yt,Ft,vr)!==-1},v.prototype.indexOf=function(yt,Ft,vr){return cr(this,yt,Ft,vr,!0)},v.prototype.lastIndexOf=function(yt,Ft,vr){return cr(this,yt,Ft,vr,!1)};function ir(dr,yt,Ft,vr){Ft=Number(Ft)||0;const jr=dr.length-Ft;vr?(vr=Number(vr),vr>jr&&(vr=jr)):vr=jr;const Mr=yt.length;vr>Mr/2&&(vr=Mr/2);let Or;for(Or=0;Or<vr;++Or){const Yr=parseInt(yt.substr(Or*2,2),16);if(Xn(Yr))return Or;dr[Ft+Or]=Yr}return Or}function ft(dr,yt,Ft,vr){return an(Gr(yt,dr.length-Ft),dr,Ft,vr)}function nr(dr,yt,Ft,vr){return an(zr(yt),dr,Ft,vr)}function lr(dr,yt,Ft,vr){return an(Zr(yt),dr,Ft,vr)}function er(dr,yt,Ft,vr){return an(Vr(yt,dr.length-Ft),dr,Ft,vr)}v.prototype.write=function(yt,Ft,vr,jr){if(Ft===void 0)jr="utf8",vr=this.length,Ft=0;else if(vr===void 0&&typeof Ft=="string")jr=Ft,vr=this.length,Ft=0;else if(isFinite(Ft))Ft=Ft>>>0,isFinite(vr)?(vr=vr>>>0,jr===void 0&&(jr="utf8")):(jr=vr,vr=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Mr=this.length-Ft;if((vr===void 0||vr>Mr)&&(vr=Mr),yt.length>0&&(vr<0||Ft<0)||Ft>this.length)throw new RangeError("Attempt to write outside buffer bounds");jr||(jr="utf8");let Or=!1;for(;;)switch(jr){case"hex":return ir(this,yt,Ft,vr);case"utf8":case"utf-8":return ft(this,yt,Ft,vr);case"ascii":case"latin1":case"binary":return nr(this,yt,Ft,vr);case"base64":return lr(this,yt,Ft,vr);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return er(this,yt,Ft,vr);default:if(Or)throw new TypeError("Unknown encoding: "+jr);jr=(""+jr).toLowerCase(),Or=!0}},v.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function pr(dr,yt,Ft){return yt===0&&Ft===dr.length?O.fromByteArray(dr):O.fromByteArray(dr.slice(yt,Ft))}function Er(dr,yt,Ft){Ft=Math.min(dr.length,Ft);const vr=[];let jr=yt;for(;jr<Ft;){const Mr=dr[jr];let Or=null,Yr=Mr>239?4:Mr>223?3:Mr>191?2:1;if(jr+Yr<=Ft){let An,tn,Jr,rn;switch(Yr){case 1:Mr<128&&(Or=Mr);break;case 2:An=dr[jr+1],(An&192)===128&&(rn=(Mr&31)<<6|An&63,rn>127&&(Or=rn));break;case 3:An=dr[jr+1],tn=dr[jr+2],(An&192)===128&&(tn&192)===128&&(rn=(Mr&15)<<12|(An&63)<<6|tn&63,rn>2047&&(rn<55296||rn>57343)&&(Or=rn));break;case 4:An=dr[jr+1],tn=dr[jr+2],Jr=dr[jr+3],(An&192)===128&&(tn&192)===128&&(Jr&192)===128&&(rn=(Mr&15)<<18|(An&63)<<12|(tn&63)<<6|Jr&63,rn>65535&&rn<1114112&&(Or=rn))}}Or===null?(Or=65533,Yr=1):Or>65535&&(Or-=65536,vr.push(Or>>>10&1023|55296),Or=56320|Or&1023),vr.push(Or),jr+=Yr}return wr(vr)}const xr=4096;function wr(dr){const yt=dr.length;if(yt<=xr)return String.fromCharCode.apply(String,dr);let Ft="",vr=0;for(;vr<yt;)Ft+=String.fromCharCode.apply(String,dr.slice(vr,vr+=xr));return Ft}function Br(dr,yt,Ft){let vr="";Ft=Math.min(dr.length,Ft);for(let jr=yt;jr<Ft;++jr)vr+=String.fromCharCode(dr[jr]&127);return vr}function hr(dr,yt,Ft){let vr="";Ft=Math.min(dr.length,Ft);for(let jr=yt;jr<Ft;++jr)vr+=String.fromCharCode(dr[jr]);return vr}function Cr(dr,yt,Ft){const vr=dr.length;(!yt||yt<0)&&(yt=0),(!Ft||Ft<0||Ft>vr)&&(Ft=vr);let jr="";for(let Mr=yt;Mr<Ft;++Mr)jr+=vn[dr[Mr]];return jr}function _r(dr,yt,Ft){const vr=dr.slice(yt,Ft);let jr="";for(let Mr=0;Mr<vr.length-1;Mr+=2)jr+=String.fromCharCode(vr[Mr]+vr[Mr+1]*256);return jr}v.prototype.slice=function(yt,Ft){const vr=this.length;yt=~~yt,Ft=Ft===void 0?vr:~~Ft,yt<0?(yt+=vr,yt<0&&(yt=0)):yt>vr&&(yt=vr),Ft<0?(Ft+=vr,Ft<0&&(Ft=0)):Ft>vr&&(Ft=vr),Ft<yt&&(Ft=yt);const jr=this.subarray(yt,Ft);return Object.setPrototypeOf(jr,v.prototype),jr};function Tr(dr,yt,Ft){if(dr%1!==0||dr<0)throw new RangeError("offset is not uint");if(dr+yt>Ft)throw new RangeError("Trying to access beyond buffer length")}v.prototype.readUintLE=v.prototype.readUIntLE=function(yt,Ft,vr){yt=yt>>>0,Ft=Ft>>>0,vr||Tr(yt,Ft,this.length);let jr=this[yt],Mr=1,Or=0;for(;++Or<Ft&&(Mr*=256);)jr+=this[yt+Or]*Mr;return jr},v.prototype.readUintBE=v.prototype.readUIntBE=function(yt,Ft,vr){yt=yt>>>0,Ft=Ft>>>0,vr||Tr(yt,Ft,this.length);let jr=this[yt+--Ft],Mr=1;for(;Ft>0&&(Mr*=256);)jr+=this[yt+--Ft]*Mr;return jr},v.prototype.readUint8=v.prototype.readUInt8=function(yt,Ft){return yt=yt>>>0,Ft||Tr(yt,1,this.length),this[yt]},v.prototype.readUint16LE=v.prototype.readUInt16LE=function(yt,Ft){return yt=yt>>>0,Ft||Tr(yt,2,this.length),this[yt]|this[yt+1]<<8},v.prototype.readUint16BE=v.prototype.readUInt16BE=function(yt,Ft){return yt=yt>>>0,Ft||Tr(yt,2,this.length),this[yt]<<8|this[yt+1]},v.prototype.readUint32LE=v.prototype.readUInt32LE=function(yt,Ft){return yt=yt>>>0,Ft||Tr(yt,4,this.length),(this[yt]|this[yt+1]<<8|this[yt+2]<<16)+this[yt+3]*16777216},v.prototype.readUint32BE=v.prototype.readUInt32BE=function(yt,Ft){return yt=yt>>>0,Ft||Tr(yt,4,this.length),this[yt]*16777216+(this[yt+1]<<16|this[yt+2]<<8|this[yt+3])},v.prototype.readBigUInt64LE=gn(function(yt){yt=yt>>>0,br(yt,"offset");const Ft=this[yt],vr=this[yt+7];(Ft===void 0||vr===void 0)&&Sr(yt,this.length-8);const jr=Ft+this[++yt]*2**8+this[++yt]*2**16+this[++yt]*2**24,Mr=this[++yt]+this[++yt]*2**8+this[++yt]*2**16+vr*2**24;return BigInt(jr)+(BigInt(Mr)<<BigInt(32))}),v.prototype.readBigUInt64BE=gn(function(yt){yt=yt>>>0,br(yt,"offset");const Ft=this[yt],vr=this[yt+7];(Ft===void 0||vr===void 0)&&Sr(yt,this.length-8);const jr=Ft*2**24+this[++yt]*2**16+this[++yt]*2**8+this[++yt],Mr=this[++yt]*2**24+this[++yt]*2**16+this[++yt]*2**8+vr;return(BigInt(jr)<<BigInt(32))+BigInt(Mr)}),v.prototype.readIntLE=function(yt,Ft,vr){yt=yt>>>0,Ft=Ft>>>0,vr||Tr(yt,Ft,this.length);let jr=this[yt],Mr=1,Or=0;for(;++Or<Ft&&(Mr*=256);)jr+=this[yt+Or]*Mr;return Mr*=128,jr>=Mr&&(jr-=Math.pow(2,8*Ft)),jr},v.prototype.readIntBE=function(yt,Ft,vr){yt=yt>>>0,Ft=Ft>>>0,vr||Tr(yt,Ft,this.length);let jr=Ft,Mr=1,Or=this[yt+--jr];for(;jr>0&&(Mr*=256);)Or+=this[yt+--jr]*Mr;return Mr*=128,Or>=Mr&&(Or-=Math.pow(2,8*Ft)),Or},v.prototype.readInt8=function(yt,Ft){return yt=yt>>>0,Ft||Tr(yt,1,this.length),this[yt]&128?(255-this[yt]+1)*-1:this[yt]},v.prototype.readInt16LE=function(yt,Ft){yt=yt>>>0,Ft||Tr(yt,2,this.length);const vr=this[yt]|this[yt+1]<<8;return vr&32768?vr|4294901760:vr},v.prototype.readInt16BE=function(yt,Ft){yt=yt>>>0,Ft||Tr(yt,2,this.length);const vr=this[yt+1]|this[yt]<<8;return vr&32768?vr|4294901760:vr},v.prototype.readInt32LE=function(yt,Ft){return yt=yt>>>0,Ft||Tr(yt,4,this.length),this[yt]|this[yt+1]<<8|this[yt+2]<<16|this[yt+3]<<24},v.prototype.readInt32BE=function(yt,Ft){return yt=yt>>>0,Ft||Tr(yt,4,this.length),this[yt]<<24|this[yt+1]<<16|this[yt+2]<<8|this[yt+3]},v.prototype.readBigInt64LE=gn(function(yt){yt=yt>>>0,br(yt,"offset");const Ft=this[yt],vr=this[yt+7];(Ft===void 0||vr===void 0)&&Sr(yt,this.length-8);const jr=this[yt+4]+this[yt+5]*2**8+this[yt+6]*2**16+(vr<<24);return(BigInt(jr)<<BigInt(32))+BigInt(Ft+this[++yt]*2**8+this[++yt]*2**16+this[++yt]*2**24)}),v.prototype.readBigInt64BE=gn(function(yt){yt=yt>>>0,br(yt,"offset");const Ft=this[yt],vr=this[yt+7];(Ft===void 0||vr===void 0)&&Sr(yt,this.length-8);const jr=(Ft<<24)+this[++yt]*2**16+this[++yt]*2**8+this[++yt];return(BigInt(jr)<<BigInt(32))+BigInt(this[++yt]*2**24+this[++yt]*2**16+this[++yt]*2**8+vr)}),v.prototype.readFloatLE=function(yt,Ft){return yt=yt>>>0,Ft||Tr(yt,4,this.length),$e.read(this,yt,!0,23,4)},v.prototype.readFloatBE=function(yt,Ft){return yt=yt>>>0,Ft||Tr(yt,4,this.length),$e.read(this,yt,!1,23,4)},v.prototype.readDoubleLE=function(yt,Ft){return yt=yt>>>0,Ft||Tr(yt,8,this.length),$e.read(this,yt,!0,52,8)},v.prototype.readDoubleBE=function(yt,Ft){return yt=yt>>>0,Ft||Tr(yt,8,this.length),$e.read(this,yt,!1,52,8)};function Nr(dr,yt,Ft,vr,jr,Mr){if(!v.isBuffer(dr))throw new TypeError('"buffer" argument must be a Buffer instance');if(yt>jr||yt<Mr)throw new RangeError('"value" argument is out of bounds');if(Ft+vr>dr.length)throw new RangeError("Index out of range")}v.prototype.writeUintLE=v.prototype.writeUIntLE=function(yt,Ft,vr,jr){if(yt=+yt,Ft=Ft>>>0,vr=vr>>>0,!jr){const Yr=Math.pow(2,8*vr)-1;Nr(this,yt,Ft,vr,Yr,0)}let Mr=1,Or=0;for(this[Ft]=yt&255;++Or<vr&&(Mr*=256);)this[Ft+Or]=yt/Mr&255;return Ft+vr},v.prototype.writeUintBE=v.prototype.writeUIntBE=function(yt,Ft,vr,jr){if(yt=+yt,Ft=Ft>>>0,vr=vr>>>0,!jr){const Yr=Math.pow(2,8*vr)-1;Nr(this,yt,Ft,vr,Yr,0)}let Mr=vr-1,Or=1;for(this[Ft+Mr]=yt&255;--Mr>=0&&(Or*=256);)this[Ft+Mr]=yt/Or&255;return Ft+vr},v.prototype.writeUint8=v.prototype.writeUInt8=function(yt,Ft,vr){return yt=+yt,Ft=Ft>>>0,vr||Nr(this,yt,Ft,1,255,0),this[Ft]=yt&255,Ft+1},v.prototype.writeUint16LE=v.prototype.writeUInt16LE=function(yt,Ft,vr){return yt=+yt,Ft=Ft>>>0,vr||Nr(this,yt,Ft,2,65535,0),this[Ft]=yt&255,this[Ft+1]=yt>>>8,Ft+2},v.prototype.writeUint16BE=v.prototype.writeUInt16BE=function(yt,Ft,vr){return yt=+yt,Ft=Ft>>>0,vr||Nr(this,yt,Ft,2,65535,0),this[Ft]=yt>>>8,this[Ft+1]=yt&255,Ft+2},v.prototype.writeUint32LE=v.prototype.writeUInt32LE=function(yt,Ft,vr){return yt=+yt,Ft=Ft>>>0,vr||Nr(this,yt,Ft,4,4294967295,0),this[Ft+3]=yt>>>24,this[Ft+2]=yt>>>16,this[Ft+1]=yt>>>8,this[Ft]=yt&255,Ft+4},v.prototype.writeUint32BE=v.prototype.writeUInt32BE=function(yt,Ft,vr){return yt=+yt,Ft=Ft>>>0,vr||Nr(this,yt,Ft,4,4294967295,0),this[Ft]=yt>>>24,this[Ft+1]=yt>>>16,this[Ft+2]=yt>>>8,this[Ft+3]=yt&255,Ft+4};function or(dr,yt,Ft,vr,jr){ar(yt,vr,jr,dr,Ft,7);let Mr=Number(yt&BigInt(4294967295));dr[Ft++]=Mr,Mr=Mr>>8,dr[Ft++]=Mr,Mr=Mr>>8,dr[Ft++]=Mr,Mr=Mr>>8,dr[Ft++]=Mr;let Or=Number(yt>>BigInt(32)&BigInt(4294967295));return dr[Ft++]=Or,Or=Or>>8,dr[Ft++]=Or,Or=Or>>8,dr[Ft++]=Or,Or=Or>>8,dr[Ft++]=Or,Ft}function tr(dr,yt,Ft,vr,jr){ar(yt,vr,jr,dr,Ft,7);let Mr=Number(yt&BigInt(4294967295));dr[Ft+7]=Mr,Mr=Mr>>8,dr[Ft+6]=Mr,Mr=Mr>>8,dr[Ft+5]=Mr,Mr=Mr>>8,dr[Ft+4]=Mr;let Or=Number(yt>>BigInt(32)&BigInt(4294967295));return dr[Ft+3]=Or,Or=Or>>8,dr[Ft+2]=Or,Or=Or>>8,dr[Ft+1]=Or,Or=Or>>8,dr[Ft]=Or,Ft+8}v.prototype.writeBigUInt64LE=gn(function(yt,Ft=0){return or(this,yt,Ft,BigInt(0),BigInt("0xffffffffffffffff"))}),v.prototype.writeBigUInt64BE=gn(function(yt,Ft=0){return tr(this,yt,Ft,BigInt(0),BigInt("0xffffffffffffffff"))}),v.prototype.writeIntLE=function(yt,Ft,vr,jr){if(yt=+yt,Ft=Ft>>>0,!jr){const An=Math.pow(2,8*vr-1);Nr(this,yt,Ft,vr,An-1,-An)}let Mr=0,Or=1,Yr=0;for(this[Ft]=yt&255;++Mr<vr&&(Or*=256);)yt<0&&Yr===0&&this[Ft+Mr-1]!==0&&(Yr=1),this[Ft+Mr]=(yt/Or>>0)-Yr&255;return Ft+vr},v.prototype.writeIntBE=function(yt,Ft,vr,jr){if(yt=+yt,Ft=Ft>>>0,!jr){const An=Math.pow(2,8*vr-1);Nr(this,yt,Ft,vr,An-1,-An)}let Mr=vr-1,Or=1,Yr=0;for(this[Ft+Mr]=yt&255;--Mr>=0&&(Or*=256);)yt<0&&Yr===0&&this[Ft+Mr+1]!==0&&(Yr=1),this[Ft+Mr]=(yt/Or>>0)-Yr&255;return Ft+vr},v.prototype.writeInt8=function(yt,Ft,vr){return yt=+yt,Ft=Ft>>>0,vr||Nr(this,yt,Ft,1,127,-128),yt<0&&(yt=255+yt+1),this[Ft]=yt&255,Ft+1},v.prototype.writeInt16LE=function(yt,Ft,vr){return yt=+yt,Ft=Ft>>>0,vr||Nr(this,yt,Ft,2,32767,-32768),this[Ft]=yt&255,this[Ft+1]=yt>>>8,Ft+2},v.prototype.writeInt16BE=function(yt,Ft,vr){return yt=+yt,Ft=Ft>>>0,vr||Nr(this,yt,Ft,2,32767,-32768),this[Ft]=yt>>>8,this[Ft+1]=yt&255,Ft+2},v.prototype.writeInt32LE=function(yt,Ft,vr){return yt=+yt,Ft=Ft>>>0,vr||Nr(this,yt,Ft,4,2147483647,-2147483648),this[Ft]=yt&255,this[Ft+1]=yt>>>8,this[Ft+2]=yt>>>16,this[Ft+3]=yt>>>24,Ft+4},v.prototype.writeInt32BE=function(yt,Ft,vr){return yt=+yt,Ft=Ft>>>0,vr||Nr(this,yt,Ft,4,2147483647,-2147483648),yt<0&&(yt=4294967295+yt+1),this[Ft]=yt>>>24,this[Ft+1]=yt>>>16,this[Ft+2]=yt>>>8,this[Ft+3]=yt&255,Ft+4},v.prototype.writeBigInt64LE=gn(function(yt,Ft=0){return or(this,yt,Ft,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),v.prototype.writeBigInt64BE=gn(function(yt,Ft=0){return tr(this,yt,Ft,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function yr(dr,yt,Ft,vr,jr,Mr){if(Ft+vr>dr.length)throw new RangeError("Index out of range");if(Ft<0)throw new RangeError("Index out of range")}function mr(dr,yt,Ft,vr,jr){return yt=+yt,Ft=Ft>>>0,jr||yr(dr,yt,Ft,4),$e.write(dr,yt,Ft,vr,23,4),Ft+4}v.prototype.writeFloatLE=function(yt,Ft,vr){return mr(this,yt,Ft,!0,vr)},v.prototype.writeFloatBE=function(yt,Ft,vr){return mr(this,yt,Ft,!1,vr)};function sr(dr,yt,Ft,vr,jr){return yt=+yt,Ft=Ft>>>0,jr||yr(dr,yt,Ft,8),$e.write(dr,yt,Ft,vr,52,8),Ft+8}v.prototype.writeDoubleLE=function(yt,Ft,vr){return sr(this,yt,Ft,!0,vr)},v.prototype.writeDoubleBE=function(yt,Ft,vr){return sr(this,yt,Ft,!1,vr)},v.prototype.copy=function(yt,Ft,vr,jr){if(!v.isBuffer(yt))throw new TypeError("argument should be a Buffer");if(vr||(vr=0),!jr&&jr!==0&&(jr=this.length),Ft>=yt.length&&(Ft=yt.length),Ft||(Ft=0),jr>0&&jr<vr&&(jr=vr),jr===vr||yt.length===0||this.length===0)return 0;if(Ft<0)throw new RangeError("targetStart out of bounds");if(vr<0||vr>=this.length)throw new RangeError("Index out of range");if(jr<0)throw new RangeError("sourceEnd out of bounds");jr>this.length&&(jr=this.length),yt.length-Ft<jr-vr&&(jr=yt.length-Ft+vr);const Mr=jr-vr;return this===yt&&typeof W.prototype.copyWithin=="function"?this.copyWithin(Ft,vr,jr):W.prototype.set.call(yt,this.subarray(vr,jr),Ft),Mr},v.prototype.fill=function(yt,Ft,vr,jr){if(typeof yt=="string"){if(typeof Ft=="string"?(jr=Ft,Ft=0,vr=this.length):typeof vr=="string"&&(jr=vr,vr=this.length),jr!==void 0&&typeof jr!="string")throw new TypeError("encoding must be a string");if(typeof jr=="string"&&!v.isEncoding(jr))throw new TypeError("Unknown encoding: "+jr);if(yt.length===1){const Or=yt.charCodeAt(0);(jr==="utf8"&&Or<128||jr==="latin1")&&(yt=Or)}}else typeof yt=="number"?yt=yt&255:typeof yt=="boolean"&&(yt=Number(yt));if(Ft<0||this.length<Ft||this.length<vr)throw new RangeError("Out of range index");if(vr<=Ft)return this;Ft=Ft>>>0,vr=vr===void 0?this.length:vr>>>0,yt||(yt=0);let Mr;if(typeof yt=="number")for(Mr=Ft;Mr<vr;++Mr)this[Mr]=yt;else{const Or=v.isBuffer(yt)?yt:v.from(yt,jr),Yr=Or.length;if(Yr===0)throw new TypeError('The value "'+yt+'" is invalid for argument "value"');for(Mr=0;Mr<vr-Ft;++Mr)this[Mr+Ft]=Or[Mr%Yr]}return this};const Ar={};function ht(dr,yt,Ft){Ar[dr]=class extends Ft{constructor(){super(),Object.defineProperty(this,"message",{value:yt.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${dr}]`,this.stack,delete this.name}get code(){return dr}set code(jr){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:jr,writable:!0})}toString(){return`${this.name} [${dr}]: ${this.message}`}}}ht("ERR_BUFFER_OUT_OF_BOUNDS",function(dr){return dr?`${dr} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ht("ERR_INVALID_ARG_TYPE",function(dr,yt){return`The "${dr}" argument must be of type number. Received type ${typeof yt}`},TypeError),ht("ERR_OUT_OF_RANGE",function(dr,yt,Ft){let vr=`The value of "${dr}" is out of range.`,jr=Ft;return Number.isInteger(Ft)&&Math.abs(Ft)>2**32?jr=Qe(String(Ft)):typeof Ft=="bigint"&&(jr=String(Ft),(Ft>BigInt(2)**BigInt(32)||Ft<-(BigInt(2)**BigInt(32)))&&(jr=Qe(jr)),jr+="n"),vr+=` It must be ${yt}. Received ${jr}`,vr},RangeError);function Qe(dr){let yt="",Ft=dr.length;const vr=dr[0]==="-"?1:0;for(;Ft>=vr+4;Ft-=3)yt=`_${dr.slice(Ft-3,Ft)}${yt}`;return`${dr.slice(0,Ft)}${yt}`}function lt(dr,yt,Ft){br(yt,"offset"),(dr[yt]===void 0||dr[yt+Ft]===void 0)&&Sr(yt,dr.length-(Ft+1))}function ar(dr,yt,Ft,vr,jr,Mr){if(dr>Ft||dr<yt){const Or=typeof yt=="bigint"?"n":"";let Yr;throw yt===0||yt===BigInt(0)?Yr=`>= 0${Or} and < 2${Or} ** ${(Mr+1)*8}${Or}`:Yr=`>= -(2${Or} ** ${(Mr+1)*8-1}${Or}) and < 2 ** ${(Mr+1)*8-1}${Or}`,new Ar.ERR_OUT_OF_RANGE("value",Yr,dr)}lt(vr,jr,Mr)}function br(dr,yt){if(typeof dr!="number")throw new Ar.ERR_INVALID_ARG_TYPE(yt,"number",dr)}function Sr(dr,yt,Ft){throw Math.floor(dr)!==dr?(br(dr,Ft),new Ar.ERR_OUT_OF_RANGE("offset","an integer",dr)):yt<0?new Ar.ERR_BUFFER_OUT_OF_BOUNDS:new Ar.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${yt}`,dr)}const Rr=/[^+/0-9A-Za-z-_]/g;function Lr(dr){if(dr=dr.split("=")[0],dr=dr.trim().replace(Rr,""),dr.length<2)return"";for(;dr.length%4!==0;)dr=dr+"=";return dr}function Gr(dr,yt){yt=yt||1/0;let Ft;const vr=dr.length;let jr=null;const Mr=[];for(let Or=0;Or<vr;++Or){if(Ft=dr.charCodeAt(Or),Ft>55295&&Ft<57344){if(!jr){if(Ft>56319){(yt-=3)>-1&&Mr.push(239,191,189);continue}else if(Or+1===vr){(yt-=3)>-1&&Mr.push(239,191,189);continue}jr=Ft;continue}if(Ft<56320){(yt-=3)>-1&&Mr.push(239,191,189),jr=Ft;continue}Ft=(jr-55296<<10|Ft-56320)+65536}else jr&&(yt-=3)>-1&&Mr.push(239,191,189);if(jr=null,Ft<128){if((yt-=1)<0)break;Mr.push(Ft)}else if(Ft<2048){if((yt-=2)<0)break;Mr.push(Ft>>6|192,Ft&63|128)}else if(Ft<65536){if((yt-=3)<0)break;Mr.push(Ft>>12|224,Ft>>6&63|128,Ft&63|128)}else if(Ft<1114112){if((yt-=4)<0)break;Mr.push(Ft>>18|240,Ft>>12&63|128,Ft>>6&63|128,Ft&63|128)}else throw new Error("Invalid code point")}return Mr}function zr(dr){const yt=[];for(let Ft=0;Ft<dr.length;++Ft)yt.push(dr.charCodeAt(Ft)&255);return yt}function Vr(dr,yt){let Ft,vr,jr;const Mr=[];for(let Or=0;Or<dr.length&&!((yt-=2)<0);++Or)Ft=dr.charCodeAt(Or),vr=Ft>>8,jr=Ft%256,Mr.push(jr),Mr.push(vr);return Mr}function Zr(dr){return O.toByteArray(Lr(dr))}function an(dr,yt,Ft,vr){let jr;for(jr=0;jr<vr&&!(jr+Ft>=yt.length||jr>=dr.length);++jr)yt[jr+Ft]=dr[jr];return jr}function nn(dr,yt){return dr instanceof yt||dr!=null&&dr.constructor!=null&&dr.constructor.name!=null&&dr.constructor.name===yt.name}function Xn(dr){return dr!==dr}const vn=(function(){const dr="0123456789abcdef",yt=new Array(256);for(let Ft=0;Ft<16;++Ft){const vr=Ft*16;for(let jr=0;jr<16;++jr)yt[vr+jr]=dr[Ft]+dr[jr]}return yt})();function gn(dr){return typeof BigInt>"u"?Ai:dr}function Ai(){throw new Error("BigInt not supported")}})(e);const Re=e.Buffer;t.Blob=e.Blob,t.BlobOptions=e.BlobOptions,t.Buffer=e.Buffer,t.File=e.File,t.FileOptions=e.FileOptions,t.INSPECT_MAX_BYTES=e.INSPECT_MAX_BYTES,t.SlowBuffer=e.SlowBuffer,t.TranscodeEncoding=e.TranscodeEncoding,t.atob=e.atob,t.btoa=e.btoa,t.constants=e.constants,t.default=Re,t.isAscii=e.isAscii,t.isUtf8=e.isUtf8,t.kMaxLength=e.kMaxLength,t.kStringMaxLength=e.kStringMaxLength,t.resolveObjectURL=e.resolveObjectURL,t.transcode=e.transcode})(dist$3)),dist$3}var hasRequiredSafeBuffer;function requireSafeBuffer(){return hasRequiredSafeBuffer||(hasRequiredSafeBuffer=1,(function(t,e){var r=requireDist$4(),n=r.Buffer;function s(c,u){for(var f in c)u[f]=c[f]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=r:(s(r,e),e.Buffer=o);function o(c,u,f){return n(c,u,f)}o.prototype=Object.create(n.prototype),s(n,o),o.from=function(c,u,f){if(typeof c=="number")throw new TypeError("Argument must not be a number");return n(c,u,f)},o.alloc=function(c,u,f){if(typeof c!="number")throw new TypeError("Argument must be a number");var x=n(c);return u!==void 0?typeof f=="string"?x.fill(u,f):x.fill(u):x.fill(0),x},o.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return n(c)},o.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return r.SlowBuffer(c)}})(safeBuffer,safeBuffer.exports)),safeBuffer.exports}var isarray,hasRequiredIsarray;function requireIsarray(){if(hasRequiredIsarray)return isarray;hasRequiredIsarray=1;var t={}.toString;return isarray=Array.isArray||function(e){return t.call(e)=="[object Array]"},isarray}var type,hasRequiredType;function requireType(){return hasRequiredType||(hasRequiredType=1,type=TypeError),type}var esObjectAtoms,hasRequiredEsObjectAtoms;function requireEsObjectAtoms(){return hasRequiredEsObjectAtoms||(hasRequiredEsObjectAtoms=1,esObjectAtoms=Object),esObjectAtoms}var esErrors,hasRequiredEsErrors;function requireEsErrors(){return hasRequiredEsErrors||(hasRequiredEsErrors=1,esErrors=Error),esErrors}var _eval,hasRequired_eval;function require_eval(){return hasRequired_eval||(hasRequired_eval=1,_eval=EvalError),_eval}var range$4,hasRequiredRange;function requireRange(){return hasRequiredRange||(hasRequiredRange=1,range$4=RangeError),range$4}var ref,hasRequiredRef;function requireRef(){return hasRequiredRef||(hasRequiredRef=1,ref=ReferenceError),ref}var syntax,hasRequiredSyntax;function requireSyntax(){return hasRequiredSyntax||(hasRequiredSyntax=1,syntax=SyntaxError),syntax}var uri,hasRequiredUri;function requireUri(){return hasRequiredUri||(hasRequiredUri=1,uri=URIError),uri}var abs,hasRequiredAbs;function requireAbs(){return hasRequiredAbs||(hasRequiredAbs=1,abs=Math.abs),abs}var floor,hasRequiredFloor;function requireFloor(){return hasRequiredFloor||(hasRequiredFloor=1,floor=Math.floor),floor}var max,hasRequiredMax;function requireMax(){return hasRequiredMax||(hasRequiredMax=1,max=Math.max),max}var min,hasRequiredMin;function requireMin(){return hasRequiredMin||(hasRequiredMin=1,min=Math.min),min}var pow,hasRequiredPow;function requirePow(){return hasRequiredPow||(hasRequiredPow=1,pow=Math.pow),pow}var round,hasRequiredRound;function requireRound(){return hasRequiredRound||(hasRequiredRound=1,round=Math.round),round}var _isNaN,hasRequired_isNaN;function require_isNaN(){return hasRequired_isNaN||(hasRequired_isNaN=1,_isNaN=Number.isNaN||function(e){return e!==e}),_isNaN}var sign,hasRequiredSign;function requireSign(){if(hasRequiredSign)return sign;hasRequiredSign=1;var t=require_isNaN();return sign=function(r){return t(r)||r===0?r:r<0?-1:1},sign}var gOPD,hasRequiredGOPD;function requireGOPD(){return hasRequiredGOPD||(hasRequiredGOPD=1,gOPD=Object.getOwnPropertyDescriptor),gOPD}var gopd,hasRequiredGopd;function requireGopd(){if(hasRequiredGopd)return gopd;hasRequiredGopd=1;var t=requireGOPD();if(t)try{t([],"length")}catch{t=null}return gopd=t,gopd}var esDefineProperty,hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return esDefineProperty=t,esDefineProperty}var shams$1,hasRequiredShams$1;function requireShams$1(){return hasRequiredShams$1||(hasRequiredShams$1=1,shams$1=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var s=42;e[r]=s;for(var o in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var c=Object.getOwnPropertySymbols(e);if(c.length!==1||c[0]!==r||!Object.prototype.propertyIsEnumerable.call(e,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var u=Object.getOwnPropertyDescriptor(e,r);if(u.value!==s||u.enumerable!==!0)return!1}return!0}),shams$1}var hasSymbols,hasRequiredHasSymbols;function requireHasSymbols(){if(hasRequiredHasSymbols)return hasSymbols;hasRequiredHasSymbols=1;var t=typeof Symbol<"u"&&Symbol,e=requireShams$1();return hasSymbols=function(){return typeof t!="function"||typeof Symbol!="function"||typeof t("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},hasSymbols}var Reflect_getPrototypeOf,hasRequiredReflect_getPrototypeOf;function requireReflect_getPrototypeOf(){return hasRequiredReflect_getPrototypeOf||(hasRequiredReflect_getPrototypeOf=1,Reflect_getPrototypeOf=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Reflect_getPrototypeOf}var Object_getPrototypeOf,hasRequiredObject_getPrototypeOf;function requireObject_getPrototypeOf(){if(hasRequiredObject_getPrototypeOf)return Object_getPrototypeOf;hasRequiredObject_getPrototypeOf=1;var t=requireEsObjectAtoms();return Object_getPrototypeOf=t.getPrototypeOf||null,Object_getPrototypeOf}var implementation$4,hasRequiredImplementation$4;function requireImplementation$4(){if(hasRequiredImplementation$4)return implementation$4;hasRequiredImplementation$4=1;var t="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,r=Math.max,n="[object Function]",s=function(f,x){for(var p=[],g=0;g<f.length;g+=1)p[g]=f[g];for(var y=0;y<x.length;y+=1)p[y+f.length]=x[y];return p},o=function(f,x){for(var p=[],g=x,y=0;g<f.length;g+=1,y+=1)p[y]=f[g];return p},c=function(u,f){for(var x="",p=0;p<u.length;p+=1)x+=u[p],p+1<u.length&&(x+=f);return x};return implementation$4=function(f){var x=this;if(typeof x!="function"||e.apply(x)!==n)throw new TypeError(t+x);for(var p=o(arguments,1),g,y=function(){if(this instanceof g){var Re=x.apply(this,s(p,arguments));return Object(Re)===Re?Re:this}return x.apply(f,s(p,arguments))},b=r(0,x.length-p.length),R=[],D=0;D<b;D++)R[D]="$"+D;if(g=Function("binder","return function ("+c(R,",")+"){ return binder.apply(this,arguments); }")(y),x.prototype){var k=function(){};k.prototype=x.prototype,g.prototype=new k,k.prototype=null}return g},implementation$4}var functionBind,hasRequiredFunctionBind;function requireFunctionBind(){if(hasRequiredFunctionBind)return functionBind;hasRequiredFunctionBind=1;var t=requireImplementation$4();return functionBind=Function.prototype.bind||t,functionBind}var functionCall,hasRequiredFunctionCall;function requireFunctionCall(){return hasRequiredFunctionCall||(hasRequiredFunctionCall=1,functionCall=Function.prototype.call),functionCall}var functionApply,hasRequiredFunctionApply;function requireFunctionApply(){return hasRequiredFunctionApply||(hasRequiredFunctionApply=1,functionApply=Function.prototype.apply),functionApply}var reflectApply,hasRequiredReflectApply;function requireReflectApply(){return hasRequiredReflectApply||(hasRequiredReflectApply=1,reflectApply=typeof Reflect<"u"&&Reflect&&Reflect.apply),reflectApply}var actualApply,hasRequiredActualApply;function requireActualApply(){if(hasRequiredActualApply)return actualApply;hasRequiredActualApply=1;var t=requireFunctionBind(),e=requireFunctionApply(),r=requireFunctionCall(),n=requireReflectApply();return actualApply=n||t.call(r,e),actualApply}var callBindApplyHelpers,hasRequiredCallBindApplyHelpers;function requireCallBindApplyHelpers(){if(hasRequiredCallBindApplyHelpers)return callBindApplyHelpers;hasRequiredCallBindApplyHelpers=1;var t=requireFunctionBind(),e=requireType(),r=requireFunctionCall(),n=requireActualApply();return callBindApplyHelpers=function(o){if(o.length<1||typeof o[0]!="function")throw new e("a function is required");return n(t,r,o)},callBindApplyHelpers}var get$1,hasRequiredGet;function requireGet(){if(hasRequiredGet)return get$1;hasRequiredGet=1;var t=requireCallBindApplyHelpers(),e=requireGopd(),r;try{r=[].__proto__===Array.prototype}catch(c){if(!c||typeof c!="object"||!("code"in c)||c.code!=="ERR_PROTO_ACCESS")throw c}var n=!!r&&e&&e(Object.prototype,"__proto__"),s=Object,o=s.getPrototypeOf;return get$1=n&&typeof n.get=="function"?t([n.get]):typeof o=="function"?function(u){return o(u==null?u:s(u))}:!1,get$1}var getProto,hasRequiredGetProto;function requireGetProto(){if(hasRequiredGetProto)return getProto;hasRequiredGetProto=1;var t=requireReflect_getPrototypeOf(),e=requireObject_getPrototypeOf(),r=requireGet();return getProto=t?function(s){return t(s)}:e?function(s){if(!s||typeof s!="object"&&typeof s!="function")throw new TypeError("getProto: not an object");return e(s)}:r?function(s){return r(s)}:null,getProto}var hasown,hasRequiredHasown;function requireHasown(){if(hasRequiredHasown)return hasown;hasRequiredHasown=1;var t=Function.prototype.call,e=Object.prototype.hasOwnProperty,r=requireFunctionBind();return hasown=r.call(t,e),hasown}var getIntrinsic,hasRequiredGetIntrinsic;function requireGetIntrinsic(){if(hasRequiredGetIntrinsic)return getIntrinsic;hasRequiredGetIntrinsic=1;var t,e=requireEsObjectAtoms(),r=requireEsErrors(),n=require_eval(),s=requireRange(),o=requireRef(),c=requireSyntax(),u=requireType(),f=requireUri(),x=requireAbs(),p=requireFloor(),g=requireMax(),y=requireMin(),b=requirePow(),R=requireRound(),D=requireSign(),k=Function,Re=function(ir){try{return k('"use strict"; return ('+ir+").constructor;")()}catch{}},Fe=requireGopd(),O=requireEsDefineProperty(),$e=function(){throw new u},ze=Fe?(function(){try{return arguments.callee,$e}catch{try{return Fe(arguments,"callee").get}catch{return $e}}})():$e,q=requireHasSymbols()(),W=requireGetProto(),We=requireObject_getPrototypeOf(),Xe=requireReflect_getPrototypeOf(),it=requireFunctionApply(),Ve=requireFunctionCall(),v={},I=typeof Uint8Array>"u"||!W?t:W(Uint8Array),Ce={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?t:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?t:ArrayBuffer,"%ArrayIteratorPrototype%":q&&W?W([][Symbol.iterator]()):t,"%AsyncFromSyncIteratorPrototype%":t,"%AsyncFunction%":v,"%AsyncGenerator%":v,"%AsyncGeneratorFunction%":v,"%AsyncIteratorPrototype%":v,"%Atomics%":typeof Atomics>"u"?t:Atomics,"%BigInt%":typeof BigInt>"u"?t:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?t:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":n,"%Float16Array%":typeof Float16Array>"u"?t:Float16Array,"%Float32Array%":typeof Float32Array>"u"?t:Float32Array,"%Float64Array%":typeof Float64Array>"u"?t:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?t:FinalizationRegistry,"%Function%":k,"%GeneratorFunction%":v,"%Int8Array%":typeof Int8Array>"u"?t:Int8Array,"%Int16Array%":typeof Int16Array>"u"?t:Int16Array,"%Int32Array%":typeof Int32Array>"u"?t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":q&&W?W(W([][Symbol.iterator]())):t,"%JSON%":typeof JSON=="object"?JSON:t,"%Map%":typeof Map>"u"?t:Map,"%MapIteratorPrototype%":typeof Map>"u"||!q||!W?t:W(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":Fe,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?t:Promise,"%Proxy%":typeof Proxy>"u"?t:Proxy,"%RangeError%":s,"%ReferenceError%":o,"%Reflect%":typeof Reflect>"u"?t:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?t:Set,"%SetIteratorPrototype%":typeof Set>"u"||!q||!W?t:W(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":q&&W?W(""[Symbol.iterator]()):t,"%Symbol%":q?Symbol:t,"%SyntaxError%":c,"%ThrowTypeError%":ze,"%TypedArray%":I,"%TypeError%":u,"%Uint8Array%":typeof Uint8Array>"u"?t:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?t:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?t:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?t:Uint32Array,"%URIError%":f,"%WeakMap%":typeof WeakMap>"u"?t:WeakMap,"%WeakRef%":typeof WeakRef>"u"?t:WeakRef,"%WeakSet%":typeof WeakSet>"u"?t:WeakSet,"%Function.prototype.call%":Ve,"%Function.prototype.apply%":it,"%Object.defineProperty%":O,"%Object.getPrototypeOf%":We,"%Math.abs%":x,"%Math.floor%":p,"%Math.max%":g,"%Math.min%":y,"%Math.pow%":b,"%Math.round%":R,"%Math.sign%":D,"%Reflect.getPrototypeOf%":Xe};if(W)try{null.error}catch(ir){var P=W(W(ir));Ce["%Error.prototype%"]=P}var _e=function ir(ft){var nr;if(ft==="%AsyncFunction%")nr=Re("async function () {}");else if(ft==="%GeneratorFunction%")nr=Re("function* () {}");else if(ft==="%AsyncGeneratorFunction%")nr=Re("async function* () {}");else if(ft==="%AsyncGenerator%"){var lr=ir("%AsyncGeneratorFunction%");lr&&(nr=lr.prototype)}else if(ft==="%AsyncIteratorPrototype%"){var er=ir("%AsyncGenerator%");er&&W&&(nr=W(er.prototype))}return Ce[ft]=nr,nr},Le={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ye=requireFunctionBind(),je=requireHasown(),K=Ye.call(Ve,Array.prototype.concat),L=Ye.call(it,Array.prototype.splice),st=Ye.call(Ve,String.prototype.replace),dt=Ye.call(Ve,String.prototype.slice),Je=Ye.call(Ve,RegExp.prototype.exec),pt=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,rr=/\\(\\)?/g,cr=function(ft){var nr=dt(ft,0,1),lr=dt(ft,-1);if(nr==="%"&&lr!=="%")throw new c("invalid intrinsic syntax, expected closing `%`");if(lr==="%"&&nr!=="%")throw new c("invalid intrinsic syntax, expected opening `%`");var er=[];return st(ft,pt,function(pr,Er,xr,wr){er[er.length]=xr?st(wr,rr,"$1"):Er||pr}),er},fr=function(ft,nr){var lr=ft,er;if(je(Le,lr)&&(er=Le[lr],lr="%"+er[0]+"%"),je(Ce,lr)){var pr=Ce[lr];if(pr===v&&(pr=_e(lr)),typeof pr>"u"&&!nr)throw new u("intrinsic "+ft+" exists, but is not available. Please file an issue!");return{alias:er,name:lr,value:pr}}throw new c("intrinsic "+ft+" does not exist!")};return getIntrinsic=function(ft,nr){if(typeof ft!="string"||ft.length===0)throw new u("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof nr!="boolean")throw new u('"allowMissing" argument must be a boolean');if(Je(/^%?[^%]*%?$/,ft)===null)throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var lr=cr(ft),er=lr.length>0?lr[0]:"",pr=fr("%"+er+"%",nr),Er=pr.name,xr=pr.value,wr=!1,Br=pr.alias;Br&&(er=Br[0],L(lr,K([0,1],Br)));for(var hr=1,Cr=!0;hr<lr.length;hr+=1){var _r=lr[hr],Tr=dt(_r,0,1),Nr=dt(_r,-1);if((Tr==='"'||Tr==="'"||Tr==="`"||Nr==='"'||Nr==="'"||Nr==="`")&&Tr!==Nr)throw new c("property names with quotes must have matching quotes");if((_r==="constructor"||!Cr)&&(wr=!0),er+="."+_r,Er="%"+er+"%",je(Ce,Er))xr=Ce[Er];else if(xr!=null){if(!(_r in xr)){if(!nr)throw new u("base intrinsic for "+ft+" exists, but the property is not available.");return}if(Fe&&hr+1>=lr.length){var or=Fe(xr,_r);Cr=!!or,Cr&&"get"in or&&!("originalValue"in or.get)?xr=or.get:xr=xr[_r]}else Cr=je(xr,_r),xr=xr[_r];Cr&&!wr&&(Ce[Er]=xr)}}return xr},getIntrinsic}var callBound$1,hasRequiredCallBound$1;function requireCallBound$1(){if(hasRequiredCallBound$1)return callBound$1;hasRequiredCallBound$1=1;var t=requireGetIntrinsic(),e=requireCallBindApplyHelpers(),r=e([t("%String.prototype.indexOf%")]);return callBound$1=function(s,o){var c=t(s,!!o);return typeof c=="function"&&r(s,".prototype.")>-1?e([c]):c},callBound$1}var isCallable,hasRequiredIsCallable;function requireIsCallable(){if(hasRequiredIsCallable)return isCallable;hasRequiredIsCallable=1;var t=Function.prototype.toString,e=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,r,n;if(typeof e=="function"&&typeof Object.defineProperty=="function")try{r=Object.defineProperty({},"length",{get:function(){throw n}}),n={},e(function(){throw 42},null,r)}catch(Fe){Fe!==n&&(e=null)}else e=null;var s=/^\s*class\b/,o=function(O){try{var $e=t.call(O);return s.test($e)}catch{return!1}},c=function(O){try{return o(O)?!1:(t.call(O),!0)}catch{return!1}},u=Object.prototype.toString,f="[object Object]",x="[object Function]",p="[object GeneratorFunction]",g="[object HTMLAllCollection]",y="[object HTML document.all class]",b="[object HTMLCollection]",R=typeof Symbol=="function"&&!!Symbol.toStringTag,D=!(0 in[,]),k=function(){return!1};if(typeof document=="object"){var Re=document.all;u.call(Re)===u.call(document.all)&&(k=function(O){if((D||!O)&&(typeof O>"u"||typeof O=="object"))try{var $e=u.call(O);return($e===g||$e===y||$e===b||$e===f)&&O("")==null}catch{}return!1})}return isCallable=e?function(O){if(k(O))return!0;if(!O||typeof O!="function"&&typeof O!="object")return!1;try{e(O,null,r)}catch($e){if($e!==n)return!1}return!o(O)&&c(O)}:function(O){if(k(O))return!0;if(!O||typeof O!="function"&&typeof O!="object")return!1;if(R)return c(O);if(o(O))return!1;var $e=u.call(O);return $e!==x&&$e!==p&&!/^\[object HTML/.test($e)?!1:c(O)},isCallable}var forEach,hasRequiredForEach;function requireForEach(){if(hasRequiredForEach)return forEach;hasRequiredForEach=1;var t=requireIsCallable(),e=Object.prototype.toString,r=Object.prototype.hasOwnProperty,n=function(f,x,p){for(var g=0,y=f.length;g<y;g++)r.call(f,g)&&(p==null?x(f[g],g,f):x.call(p,f[g],g,f))},s=function(f,x,p){for(var g=0,y=f.length;g<y;g++)p==null?x(f.charAt(g),g,f):x.call(p,f.charAt(g),g,f)},o=function(f,x,p){for(var g in f)r.call(f,g)&&(p==null?x(f[g],g,f):x.call(p,f[g],g,f))};function c(u){return e.call(u)==="[object Array]"}return forEach=function(f,x,p){if(!t(x))throw new TypeError("iterator must be a function");var g;arguments.length>=3&&(g=p),c(f)?n(f,x,g):typeof f=="string"?s(f,x,g):o(f,x,g)},forEach}var possibleTypedArrayNames,hasRequiredPossibleTypedArrayNames;function requirePossibleTypedArrayNames(){return hasRequiredPossibleTypedArrayNames||(hasRequiredPossibleTypedArrayNames=1,possibleTypedArrayNames=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),possibleTypedArrayNames}var availableTypedArrays,hasRequiredAvailableTypedArrays;function requireAvailableTypedArrays(){if(hasRequiredAvailableTypedArrays)return availableTypedArrays;hasRequiredAvailableTypedArrays=1;var t=requirePossibleTypedArrayNames(),e=typeof globalThis>"u"?commonjsGlobal:globalThis;return availableTypedArrays=function(){for(var n=[],s=0;s<t.length;s++)typeof e[t[s]]=="function"&&(n[n.length]=t[s]);return n},availableTypedArrays}var callBind={exports:{}},defineDataProperty,hasRequiredDefineDataProperty;function requireDefineDataProperty(){if(hasRequiredDefineDataProperty)return defineDataProperty;hasRequiredDefineDataProperty=1;var t=requireEsDefineProperty(),e=requireSyntax(),r=requireType(),n=requireGopd();return defineDataProperty=function(o,c,u){if(!o||typeof o!="object"&&typeof o!="function")throw new r("`obj` must be an object or a function`");if(typeof c!="string"&&typeof c!="symbol")throw new r("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new r("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new r("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new r("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new r("`loose`, if provided, must be a boolean");var f=arguments.length>3?arguments[3]:null,x=arguments.length>4?arguments[4]:null,p=arguments.length>5?arguments[5]:null,g=arguments.length>6?arguments[6]:!1,y=!!n&&n(o,c);if(t)t(o,c,{configurable:p===null&&y?y.configurable:!p,enumerable:f===null&&y?y.enumerable:!f,value:u,writable:x===null&&y?y.writable:!x});else if(g||!f&&!x&&!p)o[c]=u;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},defineDataProperty}var hasPropertyDescriptors_1,hasRequiredHasPropertyDescriptors;function requireHasPropertyDescriptors(){if(hasRequiredHasPropertyDescriptors)return hasPropertyDescriptors_1;hasRequiredHasPropertyDescriptors=1;var t=requireEsDefineProperty(),e=function(){return!!t};return e.hasArrayLengthDefineBug=function(){if(!t)return null;try{return t([],"length",{value:1}).length!==1}catch{return!0}},hasPropertyDescriptors_1=e,hasPropertyDescriptors_1}var setFunctionLength,hasRequiredSetFunctionLength;function requireSetFunctionLength(){if(hasRequiredSetFunctionLength)return setFunctionLength;hasRequiredSetFunctionLength=1;var t=requireGetIntrinsic(),e=requireDefineDataProperty(),r=requireHasPropertyDescriptors()(),n=requireGopd(),s=requireType(),o=t("%Math.floor%");return setFunctionLength=function(u,f){if(typeof u!="function")throw new s("`fn` is not a function");if(typeof f!="number"||f<0||f>4294967295||o(f)!==f)throw new s("`length` must be a positive 32-bit integer");var x=arguments.length>2&&!!arguments[2],p=!0,g=!0;if("length"in u&&n){var y=n(u,"length");y&&!y.configurable&&(p=!1),y&&!y.writable&&(g=!1)}return(p||g||!x)&&(r?e(u,"length",f,!0,!0):e(u,"length",f)),u},setFunctionLength}var applyBind,hasRequiredApplyBind;function requireApplyBind(){if(hasRequiredApplyBind)return applyBind;hasRequiredApplyBind=1;var t=requireFunctionBind(),e=requireFunctionApply(),r=requireActualApply();return applyBind=function(){return r(t,e,arguments)},applyBind}var hasRequiredCallBind;function requireCallBind(){return hasRequiredCallBind||(hasRequiredCallBind=1,(function(t){var e=requireSetFunctionLength(),r=requireEsDefineProperty(),n=requireCallBindApplyHelpers(),s=requireApplyBind();t.exports=function(c){var u=n(arguments),f=c.length-(arguments.length-1);return e(u,1+(f>0?f:0),!0)},r?r(t.exports,"apply",{value:s}):t.exports.apply=s})(callBind)),callBind.exports}var shams,hasRequiredShams;function requireShams(){if(hasRequiredShams)return shams;hasRequiredShams=1;var t=requireShams$1();return shams=function(){return t()&&!!Symbol.toStringTag},shams}var whichTypedArray,hasRequiredWhichTypedArray;function requireWhichTypedArray(){if(hasRequiredWhichTypedArray)return whichTypedArray;hasRequiredWhichTypedArray=1;var t=requireForEach(),e=requireAvailableTypedArrays(),r=requireCallBind(),n=requireCallBound$1(),s=requireGopd(),o=requireGetProto(),c=n("Object.prototype.toString"),u=requireShams()(),f=typeof globalThis>"u"?commonjsGlobal:globalThis,x=e(),p=n("String.prototype.slice"),g=n("Array.prototype.indexOf",!0)||function(k,Re){for(var Fe=0;Fe<k.length;Fe+=1)if(k[Fe]===Re)return Fe;return-1},y={__proto__:null};u&&s&&o?t(x,function(D){var k=new f[D];if(Symbol.toStringTag in k&&o){var Re=o(k),Fe=s(Re,Symbol.toStringTag);if(!Fe&&Re){var O=o(Re);Fe=s(O,Symbol.toStringTag)}y["$"+D]=r(Fe.get)}}):t(x,function(D){var k=new f[D],Re=k.slice||k.set;Re&&(y["$"+D]=r(Re))});var b=function(k){var Re=!1;return t(y,function(Fe,O){if(!Re)try{"$"+Fe(k)===O&&(Re=p(O,1))}catch{}}),Re},R=function(k){var Re=!1;return t(y,function(Fe,O){if(!Re)try{Fe(k),Re=p(O,1)}catch{}}),Re};return whichTypedArray=function(k){if(!k||typeof k!="object")return!1;if(!u){var Re=p(c(k),8,-1);return g(x,Re)>-1?Re:Re!=="Object"?!1:R(k)}return s?b(k):null},whichTypedArray}var isTypedArray,hasRequiredIsTypedArray;function requireIsTypedArray(){if(hasRequiredIsTypedArray)return isTypedArray;hasRequiredIsTypedArray=1;var t=requireWhichTypedArray();return isTypedArray=function(r){return!!t(r)},isTypedArray}var typedArrayBuffer,hasRequiredTypedArrayBuffer;function requireTypedArrayBuffer(){if(hasRequiredTypedArrayBuffer)return typedArrayBuffer;hasRequiredTypedArrayBuffer=1;var t=requireType(),e=requireCallBound$1(),r=e("TypedArray.prototype.buffer",!0),n=requireIsTypedArray();return typedArrayBuffer=r||function(o){if(!n(o))throw new t("Not a Typed Array");return o.buffer},typedArrayBuffer}var toBuffer,hasRequiredToBuffer;function requireToBuffer(){if(hasRequiredToBuffer)return toBuffer;hasRequiredToBuffer=1;var t=requireSafeBuffer().Buffer,e=requireIsarray(),r=requireTypedArrayBuffer(),n=ArrayBuffer.isView||function(f){try{return r(f),!0}catch{return!1}},s=typeof Uint8Array<"u",o=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",c=o&&(t.prototype instanceof Uint8Array||t.TYPED_ARRAY_SUPPORT);return toBuffer=function(f,x){if(t.isBuffer(f))return f.constructor&&!("isBuffer"in f)?t.from(f):f;if(typeof f=="string")return t.from(f,x);if(o&&n(f)){if(f.byteLength===0)return t.alloc(0);if(c){var p=t.from(f.buffer,f.byteOffset,f.byteLength);if(p.byteLength===f.byteLength)return p}var g=f instanceof Uint8Array?f:new Uint8Array(f.buffer,f.byteOffset,f.byteLength),y=t.from(g);if(y.length===f.byteLength)return y}if(s&&f instanceof Uint8Array)return t.from(f);var b=e(f);if(b)for(var R=0;R<f.length;R+=1){var D=f[R];if(typeof D!="number"||D<0||D>255||~~D!==D)throw new RangeError("Array items must be numbers in the range 0-255.")}if(b||t.isBuffer(f)&&f.constructor&&typeof f.constructor.isBuffer=="function"&&f.constructor.isBuffer(f))return t.from(f);throw new TypeError('The "data" argument must be a string, an Array, a Buffer, a Uint8Array, or a DataView.')},toBuffer}var hash,hasRequiredHash;function requireHash(){if(hasRequiredHash)return hash;hasRequiredHash=1;var t=requireSafeBuffer().Buffer,e=requireToBuffer();function r(n,s){this._block=t.alloc(n),this._finalSize=s,this._blockSize=n,this._len=0}return r.prototype.update=function(n,s){n=e(n,s||"utf8");for(var o=this._block,c=this._blockSize,u=n.length,f=this._len,x=0;x<u;){for(var p=f%c,g=Math.min(u-x,c-p),y=0;y<g;y++)o[p+y]=n[x+y];f+=g,x+=g,f%c===0&&this._update(o)}return this._len+=u,this},r.prototype.digest=function(n){var s=this._len%this._blockSize;this._block[s]=128,this._block.fill(0,s+1),s>=this._finalSize&&(this._update(this._block),this._block.fill(0));var o=this._len*8;if(o<=4294967295)this._block.writeUInt32BE(o,this._blockSize-4);else{var c=(o&4294967295)>>>0,u=(o-c)/4294967296;this._block.writeUInt32BE(u,this._blockSize-8),this._block.writeUInt32BE(c,this._blockSize-4)}this._update(this._block);var f=this._hash();return n?f.toString(n):f},r.prototype._update=function(){throw new Error("_update must be implemented by subclass")},hash=r,hash}var sha,hasRequiredSha;function requireSha(){if(hasRequiredSha)return sha;hasRequiredSha=1;var t=requireInherits_browser(),e=requireHash(),r=requireSafeBuffer().Buffer,n=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function o(){this.init(),this._w=s,e.call(this,64,56)}t(o,e),o.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function c(x){return x<<5|x>>>27}function u(x){return x<<30|x>>>2}function f(x,p,g,y){return x===0?p&g|~p&y:x===2?p&g|p&y|g&y:p^g^y}return o.prototype._update=function(x){for(var p=this._w,g=this._a|0,y=this._b|0,b=this._c|0,R=this._d|0,D=this._e|0,k=0;k<16;++k)p[k]=x.readInt32BE(k*4);for(;k<80;++k)p[k]=p[k-3]^p[k-8]^p[k-14]^p[k-16];for(var Re=0;Re<80;++Re){var Fe=~~(Re/20),O=c(g)+f(Fe,y,b,R)+D+p[Re]+n[Fe]|0;D=R,R=b,b=u(y),y=g,g=O}this._a=g+this._a|0,this._b=y+this._b|0,this._c=b+this._c|0,this._d=R+this._d|0,this._e=D+this._e|0},o.prototype._hash=function(){var x=r.allocUnsafe(20);return x.writeInt32BE(this._a|0,0),x.writeInt32BE(this._b|0,4),x.writeInt32BE(this._c|0,8),x.writeInt32BE(this._d|0,12),x.writeInt32BE(this._e|0,16),x},sha=o,sha}var sha1,hasRequiredSha1;function requireSha1(){if(hasRequiredSha1)return sha1;hasRequiredSha1=1;var t=requireInherits_browser(),e=requireHash(),r=requireSafeBuffer().Buffer,n=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function o(){this.init(),this._w=s,e.call(this,64,56)}t(o,e),o.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function c(p){return p<<1|p>>>31}function u(p){return p<<5|p>>>27}function f(p){return p<<30|p>>>2}function x(p,g,y,b){return p===0?g&y|~g&b:p===2?g&y|g&b|y&b:g^y^b}return o.prototype._update=function(p){for(var g=this._w,y=this._a|0,b=this._b|0,R=this._c|0,D=this._d|0,k=this._e|0,Re=0;Re<16;++Re)g[Re]=p.readInt32BE(Re*4);for(;Re<80;++Re)g[Re]=c(g[Re-3]^g[Re-8]^g[Re-14]^g[Re-16]);for(var Fe=0;Fe<80;++Fe){var O=~~(Fe/20),$e=u(y)+x(O,b,R,D)+k+g[Fe]+n[O]|0;k=D,D=R,R=f(b),b=y,y=$e}this._a=y+this._a|0,this._b=b+this._b|0,this._c=R+this._c|0,this._d=D+this._d|0,this._e=k+this._e|0},o.prototype._hash=function(){var p=r.allocUnsafe(20);return p.writeInt32BE(this._a|0,0),p.writeInt32BE(this._b|0,4),p.writeInt32BE(this._c|0,8),p.writeInt32BE(this._d|0,12),p.writeInt32BE(this._e|0,16),p},sha1=o,sha1}var sha256,hasRequiredSha256;function requireSha256(){if(hasRequiredSha256)return sha256;hasRequiredSha256=1;var t=requireInherits_browser(),e=requireHash(),r=requireSafeBuffer().Buffer,n=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=new Array(64);function o(){this.init(),this._w=s,e.call(this,64,56)}t(o,e),o.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function c(y,b,R){return R^y&(b^R)}function u(y,b,R){return y&b|R&(y|b)}function f(y){return(y>>>2|y<<30)^(y>>>13|y<<19)^(y>>>22|y<<10)}function x(y){return(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7)}function p(y){return(y>>>7|y<<25)^(y>>>18|y<<14)^y>>>3}function g(y){return(y>>>17|y<<15)^(y>>>19|y<<13)^y>>>10}return o.prototype._update=function(y){for(var b=this._w,R=this._a|0,D=this._b|0,k=this._c|0,Re=this._d|0,Fe=this._e|0,O=this._f|0,$e=this._g|0,ze=this._h|0,q=0;q<16;++q)b[q]=y.readInt32BE(q*4);for(;q<64;++q)b[q]=g(b[q-2])+b[q-7]+p(b[q-15])+b[q-16]|0;for(var W=0;W<64;++W){var We=ze+x(Fe)+c(Fe,O,$e)+n[W]+b[W]|0,Xe=f(R)+u(R,D,k)|0;ze=$e,$e=O,O=Fe,Fe=Re+We|0,Re=k,k=D,D=R,R=We+Xe|0}this._a=R+this._a|0,this._b=D+this._b|0,this._c=k+this._c|0,this._d=Re+this._d|0,this._e=Fe+this._e|0,this._f=O+this._f|0,this._g=$e+this._g|0,this._h=ze+this._h|0},o.prototype._hash=function(){var y=r.allocUnsafe(32);return y.writeInt32BE(this._a,0),y.writeInt32BE(this._b,4),y.writeInt32BE(this._c,8),y.writeInt32BE(this._d,12),y.writeInt32BE(this._e,16),y.writeInt32BE(this._f,20),y.writeInt32BE(this._g,24),y.writeInt32BE(this._h,28),y},sha256=o,sha256}var sha224,hasRequiredSha224;function requireSha224(){if(hasRequiredSha224)return sha224;hasRequiredSha224=1;var t=requireInherits_browser(),e=requireSha256(),r=requireHash(),n=requireSafeBuffer().Buffer,s=new Array(64);function o(){this.init(),this._w=s,r.call(this,64,56)}return t(o,e),o.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},o.prototype._hash=function(){var c=n.allocUnsafe(28);return c.writeInt32BE(this._a,0),c.writeInt32BE(this._b,4),c.writeInt32BE(this._c,8),c.writeInt32BE(this._d,12),c.writeInt32BE(this._e,16),c.writeInt32BE(this._f,20),c.writeInt32BE(this._g,24),c},sha224=o,sha224}var sha512,hasRequiredSha512;function requireSha512(){if(hasRequiredSha512)return sha512;hasRequiredSha512=1;var t=requireInherits_browser(),e=requireHash(),r=requireSafeBuffer().Buffer,n=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],s=new Array(160);function o(){this.init(),this._w=s,e.call(this,128,112)}t(o,e),o.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function c(D,k,Re){return Re^D&(k^Re)}function u(D,k,Re){return D&k|Re&(D|k)}function f(D,k){return(D>>>28|k<<4)^(k>>>2|D<<30)^(k>>>7|D<<25)}function x(D,k){return(D>>>14|k<<18)^(D>>>18|k<<14)^(k>>>9|D<<23)}function p(D,k){return(D>>>1|k<<31)^(D>>>8|k<<24)^D>>>7}function g(D,k){return(D>>>1|k<<31)^(D>>>8|k<<24)^(D>>>7|k<<25)}function y(D,k){return(D>>>19|k<<13)^(k>>>29|D<<3)^D>>>6}function b(D,k){return(D>>>19|k<<13)^(k>>>29|D<<3)^(D>>>6|k<<26)}function R(D,k){return D>>>0<k>>>0?1:0}return o.prototype._update=function(D){for(var k=this._w,Re=this._ah|0,Fe=this._bh|0,O=this._ch|0,$e=this._dh|0,ze=this._eh|0,q=this._fh|0,W=this._gh|0,We=this._hh|0,Xe=this._al|0,it=this._bl|0,Ve=this._cl|0,v=this._dl|0,I=this._el|0,Ce=this._fl|0,P=this._gl|0,_e=this._hl|0,Le=0;Le<32;Le+=2)k[Le]=D.readInt32BE(Le*4),k[Le+1]=D.readInt32BE(Le*4+4);for(;Le<160;Le+=2){var Ye=k[Le-30],je=k[Le-30+1],K=p(Ye,je),L=g(je,Ye);Ye=k[Le-4],je=k[Le-4+1];var st=y(Ye,je),dt=b(je,Ye),Je=k[Le-14],pt=k[Le-14+1],rr=k[Le-32],cr=k[Le-32+1],fr=L+pt|0,ir=K+Je+R(fr,L)|0;fr=fr+dt|0,ir=ir+st+R(fr,dt)|0,fr=fr+cr|0,ir=ir+rr+R(fr,cr)|0,k[Le]=ir,k[Le+1]=fr}for(var ft=0;ft<160;ft+=2){ir=k[ft],fr=k[ft+1];var nr=u(Re,Fe,O),lr=u(Xe,it,Ve),er=f(Re,Xe),pr=f(Xe,Re),Er=x(ze,I),xr=x(I,ze),wr=n[ft],Br=n[ft+1],hr=c(ze,q,W),Cr=c(I,Ce,P),_r=_e+xr|0,Tr=We+Er+R(_r,_e)|0;_r=_r+Cr|0,Tr=Tr+hr+R(_r,Cr)|0,_r=_r+Br|0,Tr=Tr+wr+R(_r,Br)|0,_r=_r+fr|0,Tr=Tr+ir+R(_r,fr)|0;var Nr=pr+lr|0,or=er+nr+R(Nr,pr)|0;We=W,_e=P,W=q,P=Ce,q=ze,Ce=I,I=v+_r|0,ze=$e+Tr+R(I,v)|0,$e=O,v=Ve,O=Fe,Ve=it,Fe=Re,it=Xe,Xe=_r+Nr|0,Re=Tr+or+R(Xe,_r)|0}this._al=this._al+Xe|0,this._bl=this._bl+it|0,this._cl=this._cl+Ve|0,this._dl=this._dl+v|0,this._el=this._el+I|0,this._fl=this._fl+Ce|0,this._gl=this._gl+P|0,this._hl=this._hl+_e|0,this._ah=this._ah+Re+R(this._al,Xe)|0,this._bh=this._bh+Fe+R(this._bl,it)|0,this._ch=this._ch+O+R(this._cl,Ve)|0,this._dh=this._dh+$e+R(this._dl,v)|0,this._eh=this._eh+ze+R(this._el,I)|0,this._fh=this._fh+q+R(this._fl,Ce)|0,this._gh=this._gh+W+R(this._gl,P)|0,this._hh=this._hh+We+R(this._hl,_e)|0},o.prototype._hash=function(){var D=r.allocUnsafe(64);function k(Re,Fe,O){D.writeInt32BE(Re,O),D.writeInt32BE(Fe,O+4)}return k(this._ah,this._al,0),k(this._bh,this._bl,8),k(this._ch,this._cl,16),k(this._dh,this._dl,24),k(this._eh,this._el,32),k(this._fh,this._fl,40),k(this._gh,this._gl,48),k(this._hh,this._hl,56),D},sha512=o,sha512}var sha384,hasRequiredSha384;function requireSha384(){if(hasRequiredSha384)return sha384;hasRequiredSha384=1;var t=requireInherits_browser(),e=requireSha512(),r=requireHash(),n=requireSafeBuffer().Buffer,s=new Array(160);function o(){this.init(),this._w=s,r.call(this,128,112)}return t(o,e),o.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},o.prototype._hash=function(){var c=n.allocUnsafe(48);function u(f,x,p){c.writeInt32BE(f,p),c.writeInt32BE(x,p+4)}return u(this._ah,this._al,0),u(this._bh,this._bl,8),u(this._ch,this._cl,16),u(this._dh,this._dl,24),u(this._eh,this._el,32),u(this._fh,this._fl,40),c},sha384=o,sha384}var hasRequiredSha_js;function requireSha_js(){return hasRequiredSha_js||(hasRequiredSha_js=1,(function(t){t.exports=function(r){var n=r.toLowerCase(),s=t.exports[n];if(!s)throw new Error(n+" is not supported (we accept pull requests)");return new s},t.exports.sha=requireSha(),t.exports.sha1=requireSha1(),t.exports.sha224=requireSha224(),t.exports.sha256=requireSha256(),t.exports.sha384=requireSha384(),t.exports.sha512=requireSha512()})(sha_js)),sha_js.exports}const createBuffer=Buffer$1.from&&Buffer$1.alloc&&Buffer$1.allocUnsafe&&Buffer$1.allocUnsafeSlow?Buffer$1.from:t=>new Buffer$1(t);function defineCrc(t,e){const r=(n,s)=>e(n,s)>>>0;return r.signed=e,r.unsigned=r,r.model=t,r}const crc1=defineCrc("crc1",function(t,e){Buffer$1.isBuffer(t)||(t=createBuffer(t));let r=~~e,n=0;for(let s=0;s<t.length;s++){const o=t[s];n+=o}return r+=n%256,r%256});let TABLE$8=[0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,149,146,155,156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243];typeof Int32Array<"u"&&(TABLE$8=new Int32Array(TABLE$8));const crc8=defineCrc("crc-8",function(t,e){Buffer$1.isBuffer(t)||(t=createBuffer(t));let r=~~e;for(let n=0;n<t.length;n++){const s=t[n];r=TABLE$8[(r^s)&255]&255}return r});let TABLE$7=[0,94,188,226,97,63,221,131,194,156,126,32,163,253,31,65,157,195,33,127,252,162,64,30,95,1,227,189,62,96,130,220,35,125,159,193,66,28,254,160,225,191,93,3,128,222,60,98,190,224,2,92,223,129,99,61,124,34,192,158,29,67,161,255,70,24,250,164,39,121,155,197,132,218,56,102,229,187,89,7,219,133,103,57,186,228,6,88,25,71,165,251,120,38,196,154,101,59,217,135,4,90,184,230,167,249,27,69,198,152,122,36,248,166,68,26,153,199,37,123,58,100,134,216,91,5,231,185,140,210,48,110,237,179,81,15,78,16,242,172,47,113,147,205,17,79,173,243,112,46,204,146,211,141,111,49,178,236,14,80,175,241,19,77,206,144,114,44,109,51,209,143,12,82,176,238,50,108,142,208,83,13,239,177,240,174,76,18,145,207,45,115,202,148,118,40,171,245,23,73,8,86,180,234,105,55,213,139,87,9,235,181,54,104,138,212,149,203,41,119,244,170,72,22,233,183,85,11,136,214,52,106,43,117,151,201,74,20,246,168,116,42,200,150,21,75,169,247,182,232,10,84,215,137,107,53];typeof Int32Array<"u"&&(TABLE$7=new Int32Array(TABLE$7));const crc81wire=defineCrc("dallas-1-wire",function(t,e){Buffer$1.isBuffer(t)||(t=createBuffer(t));let r=~~e;for(let n=0;n<t.length;n++){const s=t[n];r=TABLE$7[(r^s)&255]&255}return r});let TABLE$6=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];typeof Int32Array<"u"&&(TABLE$6=new Int32Array(TABLE$6));const crc16=defineCrc("crc-16",function(t,e){Buffer$1.isBuffer(t)||(t=createBuffer(t));let r=~~e;for(let n=0;n<t.length;n++){const s=t[n];r=(TABLE$6[(r^s)&255]^r>>8)&65535}return r});let TABLE$5=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920];typeof Int32Array<"u"&&(TABLE$5=new Int32Array(TABLE$5));const crc16ccitt=defineCrc("ccitt",function(t,e){Buffer$1.isBuffer(t)||(t=createBuffer(t));let r=typeof e<"u"?~~e:65535;for(let n=0;n<t.length;n++){const s=t[n];r=(TABLE$5[(r>>8^s)&255]^r<<8)&65535}return r});let TABLE$4=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];typeof Int32Array<"u"&&(TABLE$4=new Int32Array(TABLE$4));const crc16modbus=defineCrc("crc-16-modbus",function(t,e){Buffer$1.isBuffer(t)||(t=createBuffer(t));let r=typeof e<"u"?~~e:65535;for(let n=0;n<t.length;n++){const s=t[n];r=(TABLE$4[(r^s)&255]^r>>8)&65535}return r}),crc16xmodem=defineCrc("xmodem",function(t,e){Buffer$1.isBuffer(t)||(t=createBuffer(t));let r=typeof e<"u"?~~e:0;for(let n=0;n<t.length;n++){const s=t[n];let o=r>>>8&255;o^=s&255,o^=o>>>4,r=r<<8&65535,r^=o,o=o<<5&65535,r^=o,o=o<<7&65535,r^=o}return r});let TABLE$3=[0,4489,8978,12955,17956,22445,25910,29887,35912,40385,44890,48851,51820,56293,59774,63735,4225,264,13203,8730,22181,18220,30135,25662,40137,36160,49115,44626,56045,52068,63999,59510,8450,12427,528,5017,26406,30383,17460,21949,44362,48323,36440,40913,60270,64231,51324,55797,12675,8202,4753,792,30631,26158,21685,17724,48587,44098,40665,36688,64495,60006,55549,51572,16900,21389,24854,28831,1056,5545,10034,14011,52812,57285,60766,64727,34920,39393,43898,47859,21125,17164,29079,24606,5281,1320,14259,9786,57037,53060,64991,60502,39145,35168,48123,43634,25350,29327,16404,20893,9506,13483,1584,6073,61262,65223,52316,56789,43370,47331,35448,39921,29575,25102,20629,16668,13731,9258,5809,1848,65487,60998,56541,52564,47595,43106,39673,35696,33800,38273,42778,46739,49708,54181,57662,61623,2112,6601,11090,15067,20068,24557,28022,31999,38025,34048,47003,42514,53933,49956,61887,57398,6337,2376,15315,10842,24293,20332,32247,27774,42250,46211,34328,38801,58158,62119,49212,53685,10562,14539,2640,7129,28518,32495,19572,24061,46475,41986,38553,34576,62383,57894,53437,49460,14787,10314,6865,2904,32743,28270,23797,19836,50700,55173,58654,62615,32808,37281,41786,45747,19012,23501,26966,30943,3168,7657,12146,16123,54925,50948,62879,58390,37033,33056,46011,41522,23237,19276,31191,26718,7393,3432,16371,11898,59150,63111,50204,54677,41258,45219,33336,37809,27462,31439,18516,23005,11618,15595,3696,8185,63375,58886,54429,50452,45483,40994,37561,33584,31687,27214,22741,18780,15843,11370,7921,3960];typeof Int32Array<"u"&&(TABLE$3=new Int32Array(TABLE$3));const crc16kermit=defineCrc("kermit",function(t,e){Buffer$1.isBuffer(t)||(t=createBuffer(t));let r=typeof e<"u"?~~e:0;for(let n=0;n<t.length;n++){const s=t[n];r=(TABLE$3[(r^s)&255]^r>>8)&65535}return r});let TABLE$2=[0,8801531,9098509,825846,9692897,1419802,1651692,10452759,10584377,2608578,2839604,11344079,3303384,11807523,12104405,4128302,12930697,4391538,5217156,13227903,5679208,13690003,14450021,5910942,6606768,14844747,15604413,6837830,16197969,7431594,8256604,16494759,840169,9084178,8783076,18463,10434312,1670131,1434117,9678590,11358416,2825259,2590173,10602790,4109873,12122826,11821884,3289031,13213536,5231515,4409965,12912278,5929345,14431610,13675660,5693559,6823513,15618722,14863188,6588335,16513208,8238147,7417269,16212302,1680338,10481449,9664223,1391140,9061683,788936,36926,8838341,12067563,4091408,3340262,11844381,2868234,11372785,10555655,2579964,14478683,5939616,5650518,13661357,5180346,13190977,12967607,4428364,8219746,16457881,16234863,7468436,15633027,6866552,6578062,14816117,1405499,9649856,10463030,1698765,8819930,55329,803287,9047340,11858690,3325945,4072975,12086004,2561507,10574104,11387118,2853909,13647026,5664841,5958079,14460228,4446803,12949160,13176670,5194661,7454091,16249200,16476294,8201341,14834538,6559633,6852199,15647388,3360676,11864927,12161705,4185682,10527045,2551230,2782280,11286707,9619101,1346150,1577872,10379115,73852,8875143,9172337,899466,16124205,7357910,8182816,16421083,6680524,14918455,15678145,6911546,5736468,13747439,14507289,5968354,12873461,4334094,5159928,13170435,4167245,12180150,11879232,3346363,11301036,2767959,2532769,10545498,10360692,1596303,1360505,9604738,913813,9157998,8856728,92259,16439492,8164415,7343561,16138546,6897189,15692510,14936872,6662099,5986813,14488838,13733104,5750795,13156124,5174247,4352529,12855018,2810998,11315341,10498427,2522496,12124823,4148844,3397530,11901793,9135439,862644,110658,8912057,1606574,10407765,9590435,1317464,15706879,6940164,6651890,14889737,8145950,16384229,16161043,7394792,5123014,13133629,12910283,4370992,14535975,5997020,5707818,13718737,2504095,10516836,11329682,2796649,11916158,3383173,4130419,12143240,8893606,129117,876971,9121104,1331783,9576124,10389322,1625009,14908182,6633453,6925851,15721184,7380471,16175372,16402682,8127489,4389423,12891860,13119266,5137369,13704398,5722165,6015427,14517560];typeof Int32Array<"u"&&(TABLE$2=new Int32Array(TABLE$2));const crc24=defineCrc("crc-24",function(t,e){Buffer$1.isBuffer(t)||(t=createBuffer(t));let r=typeof e<"u"?~~e:11994318;for(let n=0;n<t.length;n++){const s=t[n];r=(TABLE$2[(r>>16^s)&255]^r<<8)&16777215}return r});let TABLE$1=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(TABLE$1=new Int32Array(TABLE$1));const crc32=defineCrc("crc-32",function(t,e){Buffer$1.isBuffer(t)||(t=createBuffer(t));let r=e===0?0:~~e^-1;for(let n=0;n<t.length;n++){const s=t[n];r=TABLE$1[(r^s)&255]^r>>>8}return r^-1});let TABLE=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(TABLE=new Int32Array(TABLE));const crcjam=defineCrc("jam",function(t,e=-1){Buffer$1.isBuffer(t)||(t=createBuffer(t));let r=e===0?0:~~e;for(let n=0;n<t.length;n++){const s=t[n];r=TABLE[(r^s)&255]^r>>>8}return r}),index$2={crc1,crc8,crc81wire,crc16,crc16ccitt,crc16modbus,crc16xmodem,crc16kermit,crc24,crc32,crcjam},crc=Object.freeze(Object.defineProperty({__proto__:null,crc1,crc16,crc16ccitt,crc16kermit,crc16modbus,crc16xmodem,crc24,crc32,crc8,crc81wire,crcjam,default:index$2},Symbol.toStringTag,{value:"Module"})),require$$1=getAugmentedNamespace(crc);var hasRequiredUtils$7;function requireUtils$7(){if(hasRequiredUtils$7)return utils$7;hasRequiredUtils$7=1;var t=utils$7&&utils$7.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(utils$7,"__esModule",{value:!0}),utils$7.bufferXOR=utils$7.setDifference=utils$7.arrayContains=utils$7.arraysEqual=utils$7.hasPrefix=utils$7.isURType=utils$7.intToBytes=utils$7.toUint32=utils$7.getCRCHex=utils$7.getCRC=utils$7.split=utils$7.partition=utils$7.sha256Hash=void 0;const e=t(requireSha_js()),r=require$$1,n=k=>e.default("sha256").update(k).digest();utils$7.sha256Hash=n;const s=(k,Re)=>k.match(new RegExp(".{1,"+Re+"}","g"))||[k];utils$7.partition=s;const o=(k,Re)=>[k.slice(0,-Re),k.slice(-Re)];utils$7.split=o;const c=k=>r.crc32(k);utils$7.getCRC=c;const u=k=>r.crc32(k).toString(16).padStart(8,"0");utils$7.getCRCHex=u;const f=k=>k>>>0;utils$7.toUint32=f;const x=k=>{const Re=new ArrayBuffer(4);return new DataView(Re).setUint32(0,k,!1),Buffer.from(Re)};utils$7.intToBytes=x;const p=k=>k.split("").every((Re,Fe)=>{let O=k.charCodeAt(Fe);return 97<=O&&O<=122||48<=O&&O<=57||O===45});utils$7.isURType=p;const g=(k,Re)=>k.indexOf(Re)===0;utils$7.hasPrefix=g;const y=(k,Re)=>k.length!==Re.length?!1:k.every(Fe=>Re.includes(Fe));utils$7.arraysEqual=y;const b=(k,Re)=>Re.every(Fe=>k.includes(Fe));utils$7.arrayContains=b;const R=(k,Re)=>k.filter(Fe=>Re.indexOf(Fe)<0);utils$7.setDifference=R;const D=(k,Re)=>{const Fe=Math.max(k.length,Re.length),O=Buffer.allocUnsafe(Fe);for(let $e=0;$e<Fe;++$e)O[$e]=k[$e]^Re[$e];return O};return utils$7.bufferXOR=D,utils$7}var cbor={},main$1={exports:{}},main=main$1.exports,hasRequiredMain;function requireMain(){return hasRequiredMain||(hasRequiredMain=1,(function(t){(function(e,r){t.exports?t.exports=r():e.CBOR=r()})(main,function(){var e=(function(){function r(q){this.$hex=q}r.prototype={length:function(){return this.$hex.length/2},toString:function(q){if(!q||q==="hex"||q===16)return this.$hex;if(q==="utf-8"){for(var W="",We=0;We<this.$hex.length;We+=2)W+="%"+this.$hex.substring(We,We+2);return decodeURIComponent(W)}if(q==="latin"){for(var W=[],We=0;We<this.$hex.length;We+=2)W.push(parseInt(this.$hex.substring(We,We+2),16));return String.fromCharCode.apply(String,W)}throw new Error("Unrecognised format: "+q)}},r.fromLatinString=function(q){for(var W="",We=0;We<q.length;We++){var Xe=q.charCodeAt(We).toString(16);Xe.length===1&&(Xe="0"+Xe),W+=Xe}return new r(W)},r.fromUtf8String=function(q){for(var W=encodeURIComponent(q),We="",Xe=0;Xe<W.length;Xe++)if(W.charAt(Xe)==="%")We+=W.substring(Xe+1,Xe+3),Xe+=2;else{var it=W.charCodeAt(Xe).toString(16);it.length<2&&(it="0"+it),We+=it}return new r(We)};var n=[],s={},o=function(q){return function(){throw new Error(q+" not implemented")}};function c(){}c.prototype={peekByte:o("peekByte"),readByte:o("readByte"),readChunk:o("readChunk"),readFloat16:function(){var q=this.readUint16(),W=(q&32767)>>10,We=q&1023,Xe=q&32768;if(W===31)return We===0?Xe?-1/0:1/0:NaN;var it=W?Math.pow(2,W-25)*(1024+We):Math.pow(2,-24)*We;return Xe?-it:it},readFloat32:function(){var q=this.readUint32(),W=(q&2147483647)>>23,We=q&8388607,Xe=q&2147483648;if(W===255)return We===0?Xe?-1/0:1/0:NaN;var it=W?Math.pow(2,W-23-127)*(8388608+We):Math.pow(2,-149)*We;return Xe?-it:it},readFloat64:function(){var q=this.readUint32(),W=this.readUint32(),We=q>>20&2047,Xe=(q&1048575)*4294967296+W,it=q&2147483648;if(We===2047)return Xe===0?it?-1/0:1/0:NaN;var Ve=We?Math.pow(2,We-52-1023)*(4503599627370496+Xe):Math.pow(2,-1074)*Xe;return it?-Ve:Ve},readUint16:function(){return this.readByte()*256+this.readByte()},readUint32:function(){return this.readUint16()*65536+this.readUint16()},readUint64:function(){return this.readUint32()*4294967296+this.readUint32()}};function u(){}u.prototype={writeByte:o("writeByte"),result:o("result"),writeFloat16:o("writeFloat16"),writeFloat32:o("writeFloat32"),writeFloat64:o("writeFloat64"),writeUint16:function(q){this.writeByte(q>>8&255),this.writeByte(q&255)},writeUint32:function(q){this.writeUint16(q>>16&65535),this.writeUint16(q&65535)},writeUint64:function(q){if(q>=9007199254740992||q<=-9007199254740992)throw new Error("Cannot encode Uint64 of: "+q+" magnitude to big (floating point errors)");this.writeUint32(Math.floor(q/4294967296)),this.writeUint32(q%4294967296)},writeString:o("writeString"),canWriteBinary:function(q){return!1},writeBinary:o("writeChunk")};function f(q){var W=q.readByte(),We=W>>5,Xe=W&31;return{type:We,value:Xe}}function x(q,W){var We=q.value;if(We<24)return We;if(We==24)return W.readByte();if(We==25)return W.readUint16();if(We==26)return W.readUint32();if(We==27)return W.readUint64();if(We==31)return null;o("Additional info: "+We)()}function p(q,W,We){We.writeByte(q<<5|W)}function g(q,W,We){var Xe=q<<5;W<24?We.writeByte(Xe|W):W<256?(We.writeByte(Xe|24),We.writeByte(W)):W<65536?(We.writeByte(Xe|25),We.writeUint16(W)):W<4294967296?(We.writeByte(Xe|26),We.writeUint32(W)):(We.writeByte(Xe|27),We.writeUint64(W))}var y=new Error;function b(q){var W=f(q);switch(W.type){case 0:return x(W,q);case 1:return-1-x(W,q);case 2:return q.readChunk(x(W,q));case 3:var We=q.readChunk(x(W,q));return We.toString("utf-8");case 4:case 5:var Xe=x(W,q),P=[];if(Xe!==null){W.type===5&&(Xe*=2);for(var it=0;it<Xe;it++)P[it]=b(q)}else for(var Ve;(Ve=b(q))!==y;)P.push(Ve);if(W.type===5){for(var v={},it=0;it<P.length;it+=2)v[P[it]]=P[it+1];return v}else return P;case 6:var I=x(W,q),Ce=s[I],P=b(q);return Ce?Ce(P):P;case 7:if(W.value===25)return q.readFloat16();if(W.value===26)return q.readFloat32();if(W.value===27)return q.readFloat64();switch(x(W,q)){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case null:return y;default:throw new Error("Unknown fixed value: "+W.value)}default:throw new Error("Unsupported header: "+JSON.stringify(W))}throw new Error("not implemented yet")}function R(q,W){for(var We=0;We<n.length;We++){var Xe=n[We].fn(q);if(Xe!==void 0)return g(6,n[We].tag,W),R(Xe,W)}if(q&&typeof q.toCBOR=="function"&&(q=q.toCBOR()),q===!1)g(7,20,W);else if(q===!0)g(7,21,W);else if(q===null)g(7,22,W);else if(q===void 0)g(7,23,W);else if(typeof q=="number")Math.floor(q)===q&&q<9007199254740992&&q>-9007199254740992?q<0?g(1,-1-q,W):g(0,q,W):(p(7,27,W),W.writeFloat64(q));else if(typeof q=="string")W.writeString(q,function(Ve){g(3,Ve,W)});else if(W.canWriteBinary(q))W.writeBinary(q,function(Ve){g(2,Ve,W)});else if(typeof q=="object")if(Re.config.useToJSON&&typeof q.toJSON=="function"&&(q=q.toJSON()),Array.isArray(q)){g(4,q.length,W);for(var We=0;We<q.length;We++)R(q[We],W)}else{var it=Object.keys(q);g(5,it.length,W);for(var We=0;We<it.length;We++)R(it[We],W),R(q[it[We]],W)}else throw new Error("CBOR encoding not supported: "+q)}var D=[],k=[],Re={config:{useToJSON:!0},addWriter:function(q,W){typeof q=="string"?k.push(function(We){if(q===We)return W(We)}):k.push(q)},addReader:function(q,W){typeof q=="string"?D.push(function(We,Xe){if(q===Xe)return W(We,Xe)}):D.push(q)},encode:function(q,W){for(var We=0;We<k.length;We++){var Xe=k[We],it=Xe(W);if(it)return R(q,it),it.result()}throw new Error("Unsupported output format: "+W)},decode:function(q,W){for(var We=0;We<D.length;We++){var Xe=D[We],it=Xe(q,W);if(it)return b(it)}throw new Error("Unsupported input format: "+W)},addSemanticEncode:function(q,W){if(typeof q!="number"||q%1!==0||q<0)throw new Error("Tag must be a positive integer");return n.push({tag:q,fn:W}),this},addSemanticDecode:function(q,W){if(typeof q!="number"||q%1!==0||q<0)throw new Error("Tag must be a positive integer");return s[q]=W,this},Reader:c,Writer:u};function Fe(q){this.buffer=q,this.pos=0}Fe.prototype=Object.create(c.prototype),Fe.prototype.peekByte=function(){return this.buffer[this.pos]},Fe.prototype.readByte=function(){return this.buffer[this.pos++]},Fe.prototype.readUint16=function(){var q=this.buffer.readUInt16BE(this.pos);return this.pos+=2,q},Fe.prototype.readUint32=function(){var q=this.buffer.readUInt32BE(this.pos);return this.pos+=4,q},Fe.prototype.readFloat32=function(){var q=this.buffer.readFloatBE(this.pos);return this.pos+=4,q},Fe.prototype.readFloat64=function(){var q=this.buffer.readDoubleBE(this.pos);return this.pos+=8,q},Fe.prototype.readChunk=function(q){var W=Buffer.alloc(q);return this.buffer.copy(W,0,this.pos,this.pos+=q),W};function O(q){this.byteLength=0,this.defaultBufferLength=16384,this.latestBuffer=Buffer.alloc(this.defaultBufferLength),this.latestBufferOffset=0,this.completeBuffers=[],this.stringFormat=q}O.prototype=Object.create(u.prototype),O.prototype.writeByte=function(q){this.latestBuffer[this.latestBufferOffset++]=q,this.latestBufferOffset>=this.latestBuffer.length&&(this.completeBuffers.push(this.latestBuffer),this.latestBuffer=Buffer.alloc(this.defaultBufferLength),this.latestBufferOffset=0),this.byteLength++},O.prototype.writeFloat32=function(q){var W=Buffer.alloc(4);W.writeFloatBE(q,0),this.writeBuffer(W)},O.prototype.writeFloat64=function(q){var W=Buffer.alloc(8);W.writeDoubleBE(q,0),this.writeBuffer(W)},O.prototype.writeString=function(q,W){var We=Buffer.from(q,"utf-8");W(We.length),this.writeBuffer(We)},O.prototype.canWriteBinary=function(q){return q instanceof Buffer},O.prototype.writeBinary=function(q,W){W(q.length),this.writeBuffer(q)},O.prototype.writeBuffer=function(q){if(!(q instanceof Buffer))throw new TypeError("BufferWriter only accepts Buffers");this.latestBufferOffset?this.latestBuffer.length-this.latestBufferOffset>=q.length?(q.copy(this.latestBuffer,this.latestBufferOffset),this.latestBufferOffset+=q.length,this.latestBufferOffset>=this.latestBuffer.length&&(this.completeBuffers.push(this.latestBuffer),this.latestBuffer=Buffer.alloc(this.defaultBufferLength),this.latestBufferOffset=0)):(this.completeBuffers.push(this.latestBuffer.slice(0,this.latestBufferOffset)),this.completeBuffers.push(q),this.latestBuffer=Buffer.alloc(this.defaultBufferLength),this.latestBufferOffset=0):this.completeBuffers.push(q),this.byteLength+=q.length},O.prototype.result=function(){for(var q=Buffer.alloc(this.byteLength),W=0,We=0;We<this.completeBuffers.length;We++){var Xe=this.completeBuffers[We];Xe.copy(q,W,0,Xe.length),W+=Xe.length}return this.latestBufferOffset&&this.latestBuffer.copy(q,W,0,this.latestBufferOffset),this.stringFormat?q.toString(this.stringFormat):q},typeof Buffer=="function"&&(Re.addReader(function(q,W){if(q instanceof Buffer)return new Fe(q);if(W==="hex"||W==="base64"){var We=Buffer.from(q,W);return new Fe(We)}}),Re.addWriter(function(q){if(!q||q==="buffer")return new O;if(q==="hex"||q==="base64")return new O(q)}));function $e(q){this.hex=q,this.pos=0}$e.prototype=Object.create(c.prototype),$e.prototype.peekByte=function(){var q=this.hex.substring(this.pos,2);return parseInt(q,16)},$e.prototype.readByte=function(){var q=this.hex.substring(this.pos,this.pos+2);return this.pos+=2,parseInt(q,16)},$e.prototype.readChunk=function(q){var W=this.hex.substring(this.pos,this.pos+q*2);return this.pos+=q*2,typeof Buffer=="function"?Buffer.from(W,"hex"):new r(W)};function ze(q){this.$hex="",this.finalFormat=q||"hex"}return ze.prototype=Object.create(u.prototype),ze.prototype.writeByte=function(q){if(q<0||q>255)throw new Error("Byte value out of range: "+q);var W=q.toString(16);W.length==1&&(W="0"+W),this.$hex+=W},ze.prototype.canWriteBinary=function(q){return q instanceof r||typeof Buffer=="function"&&q instanceof Buffer},ze.prototype.writeBinary=function(q,W){if(q instanceof r)W(q.length()),this.$hex+=q.$hex;else if(typeof Buffer=="function"&&q instanceof Buffer)W(q.length),this.$hex+=q.toString("hex");else throw new TypeError("HexWriter only accepts BinaryHex or Buffers")},ze.prototype.result=function(){return this.finalFormat==="buffer"&&typeof Buffer=="function"?Buffer.from(this.$hex,"hex"):new r(this.$hex).toString(this.finalFormat)},ze.prototype.writeString=function(q,W){var We=r.fromUtf8String(q);W(We.length()),this.$hex+=We.$hex},Re.addReader(function(q,W){if(q instanceof r||q.$hex)return new $e(q.$hex);if(W==="hex")return new $e(q)}),Re.addWriter(function(q){if(q==="hex")return new ze}),Re})();return e.addSemanticEncode(0,function(r){if(r instanceof Date)return r.toISOString()}).addSemanticDecode(0,function(r){return new Date(r)}).addSemanticDecode(1,function(r){return new Date(r)}),e})})(main$1)),main$1.exports}var hasRequiredCbor;function requireCbor(){if(hasRequiredCbor)return cbor;hasRequiredCbor=1,Object.defineProperty(cbor,"__esModule",{value:!0}),cbor.cborDecode=cbor.cborEncode=void 0;const t=requireMain(),e=n=>t.encode(n);cbor.cborEncode=e;const r=n=>t.decode(Buffer.isBuffer(n)?n:Buffer.from(n,"hex"));return cbor.cborDecode=r,cbor}var hasRequiredUr;function requireUr(){if(hasRequiredUr)return ur;hasRequiredUr=1,Object.defineProperty(ur,"__esModule",{value:!0});const t=requireErrors$1(),e=requireUtils$7(),r=requireCbor();class n{constructor(o,c="bytes"){if(this._cborPayload=o,this._type=c,!e.isURType(this._type))throw new t.InvalidTypeError}static fromBuffer(o){return new n(r.cborEncode(o))}static from(o,c){return n.fromBuffer(Buffer.from(o,c))}decodeCBOR(){return r.cborDecode(this._cborPayload)}get type(){return this._type}get cbor(){return this._cborPayload}equals(o){return this.type===o.type&&this.cbor.equals(o.cbor)}}return ur.default=n,ur}var urEncoder={},fountainEncoder={},assert$2={exports:{}},errors={},util={},types$1={},isArguments$1,hasRequiredIsArguments$1;function requireIsArguments$1(){if(hasRequiredIsArguments$1)return isArguments$1;hasRequiredIsArguments$1=1;var t=requireShams()(),e=requireCallBound$1(),r=e("Object.prototype.toString"),n=function(u){return t&&u&&typeof u=="object"&&Symbol.toStringTag in u?!1:r(u)==="[object Arguments]"},s=function(u){return n(u)?!0:u!==null&&typeof u=="object"&&"length"in u&&typeof u.length=="number"&&u.length>=0&&r(u)!=="[object Array]"&&"callee"in u&&r(u.callee)==="[object Function]"},o=(function(){return n(arguments)})();return n.isLegacyArguments=s,isArguments$1=o?n:s,isArguments$1}var isRegex,hasRequiredIsRegex;function requireIsRegex(){if(hasRequiredIsRegex)return isRegex;hasRequiredIsRegex=1;var t=requireCallBound$1(),e=requireShams()(),r=requireHasown(),n=requireGopd(),s;if(e){var o=t("RegExp.prototype.exec"),c={},u=function(){throw c},f={toString:u,valueOf:u};typeof Symbol.toPrimitive=="symbol"&&(f[Symbol.toPrimitive]=u),s=function(y){if(!y||typeof y!="object")return!1;var b=n(y,"lastIndex"),R=b&&r(b,"value");if(!R)return!1;try{o(y,f)}catch(D){return D===c}}}else{var x=t("Object.prototype.toString"),p="[object RegExp]";s=function(y){return!y||typeof y!="object"&&typeof y!="function"?!1:x(y)===p}}return isRegex=s,isRegex}var safeRegexTest,hasRequiredSafeRegexTest;function requireSafeRegexTest(){if(hasRequiredSafeRegexTest)return safeRegexTest;hasRequiredSafeRegexTest=1;var t=requireCallBound$1(),e=requireIsRegex(),r=t("RegExp.prototype.exec"),n=requireType();return safeRegexTest=function(o){if(!e(o))throw new n("`regex` must be a RegExp");return function(u){return r(o,u)!==null}},safeRegexTest}var generatorFunction,hasRequiredGeneratorFunction;function requireGeneratorFunction(){if(hasRequiredGeneratorFunction)return generatorFunction;hasRequiredGeneratorFunction=1;const t=(function*(){}).constructor;return generatorFunction=()=>t,generatorFunction}var isGeneratorFunction,hasRequiredIsGeneratorFunction;function requireIsGeneratorFunction(){if(hasRequiredIsGeneratorFunction)return isGeneratorFunction;hasRequiredIsGeneratorFunction=1;var t=requireCallBound$1(),e=requireSafeRegexTest(),r=e(/^\s*(?:function)?\*/),n=requireShams()(),s=requireGetProto(),o=t("Object.prototype.toString"),c=t("Function.prototype.toString"),u=requireGeneratorFunction();return isGeneratorFunction=function(x){if(typeof x!="function")return!1;if(r(c(x)))return!0;if(!n){var p=o(x);return p==="[object GeneratorFunction]"}if(!s)return!1;var g=u();return g&&s(x)===g.prototype},isGeneratorFunction}var hasRequiredTypes$1;function requireTypes$1(){return hasRequiredTypes$1||(hasRequiredTypes$1=1,(function(t){var e=requireIsArguments$1(),r=requireIsGeneratorFunction(),n=requireWhichTypedArray(),s=requireIsTypedArray();function o(hr){return hr.call.bind(hr)}var c=typeof BigInt<"u",u=typeof Symbol<"u",f=o(Object.prototype.toString),x=o(Number.prototype.valueOf),p=o(String.prototype.valueOf),g=o(Boolean.prototype.valueOf);if(c)var y=o(BigInt.prototype.valueOf);if(u)var b=o(Symbol.prototype.valueOf);function R(hr,Cr){if(typeof hr!="object")return!1;try{return Cr(hr),!0}catch{return!1}}t.isArgumentsObject=e,t.isGeneratorFunction=r,t.isTypedArray=s;function D(hr){return typeof Promise<"u"&&hr instanceof Promise||hr!==null&&typeof hr=="object"&&typeof hr.then=="function"&&typeof hr.catch=="function"}t.isPromise=D;function k(hr){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(hr):s(hr)||dt(hr)}t.isArrayBufferView=k;function Re(hr){return n(hr)==="Uint8Array"}t.isUint8Array=Re;function Fe(hr){return n(hr)==="Uint8ClampedArray"}t.isUint8ClampedArray=Fe;function O(hr){return n(hr)==="Uint16Array"}t.isUint16Array=O;function $e(hr){return n(hr)==="Uint32Array"}t.isUint32Array=$e;function ze(hr){return n(hr)==="Int8Array"}t.isInt8Array=ze;function q(hr){return n(hr)==="Int16Array"}t.isInt16Array=q;function W(hr){return n(hr)==="Int32Array"}t.isInt32Array=W;function We(hr){return n(hr)==="Float32Array"}t.isFloat32Array=We;function Xe(hr){return n(hr)==="Float64Array"}t.isFloat64Array=Xe;function it(hr){return n(hr)==="BigInt64Array"}t.isBigInt64Array=it;function Ve(hr){return n(hr)==="BigUint64Array"}t.isBigUint64Array=Ve;function v(hr){return f(hr)==="[object Map]"}v.working=typeof Map<"u"&&v(new Map);function I(hr){return typeof Map>"u"?!1:v.working?v(hr):hr instanceof Map}t.isMap=I;function Ce(hr){return f(hr)==="[object Set]"}Ce.working=typeof Set<"u"&&Ce(new Set);function P(hr){return typeof Set>"u"?!1:Ce.working?Ce(hr):hr instanceof Set}t.isSet=P;function _e(hr){return f(hr)==="[object WeakMap]"}_e.working=typeof WeakMap<"u"&&_e(new WeakMap);function Le(hr){return typeof WeakMap>"u"?!1:_e.working?_e(hr):hr instanceof WeakMap}t.isWeakMap=Le;function Ye(hr){return f(hr)==="[object WeakSet]"}Ye.working=typeof WeakSet<"u"&&Ye(new WeakSet);function je(hr){return Ye(hr)}t.isWeakSet=je;function K(hr){return f(hr)==="[object ArrayBuffer]"}K.working=typeof ArrayBuffer<"u"&&K(new ArrayBuffer);function L(hr){return typeof ArrayBuffer>"u"?!1:K.working?K(hr):hr instanceof ArrayBuffer}t.isArrayBuffer=L;function st(hr){return f(hr)==="[object DataView]"}st.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&st(new DataView(new ArrayBuffer(1),0,1));function dt(hr){return typeof DataView>"u"?!1:st.working?st(hr):hr instanceof DataView}t.isDataView=dt;var Je=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function pt(hr){return f(hr)==="[object SharedArrayBuffer]"}function rr(hr){return typeof Je>"u"?!1:(typeof pt.working>"u"&&(pt.working=pt(new Je)),pt.working?pt(hr):hr instanceof Je)}t.isSharedArrayBuffer=rr;function cr(hr){return f(hr)==="[object AsyncFunction]"}t.isAsyncFunction=cr;function fr(hr){return f(hr)==="[object Map Iterator]"}t.isMapIterator=fr;function ir(hr){return f(hr)==="[object Set Iterator]"}t.isSetIterator=ir;function ft(hr){return f(hr)==="[object Generator]"}t.isGeneratorObject=ft;function nr(hr){return f(hr)==="[object WebAssembly.Module]"}t.isWebAssemblyCompiledModule=nr;function lr(hr){return R(hr,x)}t.isNumberObject=lr;function er(hr){return R(hr,p)}t.isStringObject=er;function pr(hr){return R(hr,g)}t.isBooleanObject=pr;function Er(hr){return c&&R(hr,y)}t.isBigIntObject=Er;function xr(hr){return u&&R(hr,b)}t.isSymbolObject=xr;function wr(hr){return lr(hr)||er(hr)||pr(hr)||Er(hr)||xr(hr)}t.isBoxedPrimitive=wr;function Br(hr){return typeof Uint8Array<"u"&&(L(hr)||rr(hr))}t.isAnyArrayBuffer=Br,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(hr){Object.defineProperty(t,hr,{enumerable:!1,value:function(){throw new Error(hr+" is not supported in userland")}})})})(types$1)),types$1}var isBufferBrowser,hasRequiredIsBufferBrowser;function requireIsBufferBrowser(){return hasRequiredIsBufferBrowser||(hasRequiredIsBufferBrowser=1,isBufferBrowser=function(e){return e&&typeof e=="object"&&typeof e.copy=="function"&&typeof e.fill=="function"&&typeof e.readUInt8=="function"}),isBufferBrowser}var hasRequiredUtil;function requireUtil(){return hasRequiredUtil||(hasRequiredUtil=1,(function(t){var e={},r=Object.getOwnPropertyDescriptors||function(Je){for(var pt=Object.keys(Je),rr={},cr=0;cr<pt.length;cr++)rr[pt[cr]]=Object.getOwnPropertyDescriptor(Je,pt[cr]);return rr},n=/%[sdj%]/g;t.format=function(dt){if(!q(dt)){for(var Je=[],pt=0;pt<arguments.length;pt++)Je.push(u(arguments[pt]));return Je.join(" ")}for(var pt=1,rr=arguments,cr=rr.length,fr=String(dt).replace(n,function(ft){if(ft==="%%")return"%";if(pt>=cr)return ft;switch(ft){case"%s":return String(rr[pt++]);case"%d":return Number(rr[pt++]);case"%j":try{return JSON.stringify(rr[pt++])}catch{return"[Circular]"}default:return ft}}),ir=rr[pt];pt<cr;ir=rr[++pt])O(ir)||!it(ir)?fr+=" "+ir:fr+=" "+u(ir);return fr},t.deprecate=function(dt,Je){if(typeof process$1<"u"&&process$1.noDeprecation===!0)return dt;if(typeof process$1>"u")return function(){return t.deprecate(dt,Je).apply(this,arguments)};var pt=!1;function rr(){if(!pt){if(process$1.throwDeprecation)throw new Error(Je);process$1.traceDeprecation?console.trace(Je):console.error(Je),pt=!0}return dt.apply(this,arguments)}return rr};var s={},o=/^$/;if(e.NODE_DEBUG){var c=e.NODE_DEBUG;c=c.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),o=new RegExp("^"+c+"$","i")}t.debuglog=function(dt){if(dt=dt.toUpperCase(),!s[dt])if(o.test(dt)){var Je=process$1.pid;s[dt]=function(){var pt=t.format.apply(t,arguments);console.error("%s %d: %s",dt,Je,pt)}}else s[dt]=function(){};return s[dt]};function u(dt,Je){var pt={seen:[],stylize:x};return arguments.length>=3&&(pt.depth=arguments[2]),arguments.length>=4&&(pt.colors=arguments[3]),Fe(Je)?pt.showHidden=Je:Je&&t._extend(pt,Je),We(pt.showHidden)&&(pt.showHidden=!1),We(pt.depth)&&(pt.depth=2),We(pt.colors)&&(pt.colors=!1),We(pt.customInspect)&&(pt.customInspect=!0),pt.colors&&(pt.stylize=f),g(pt,dt,pt.depth)}t.inspect=u,u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function f(dt,Je){var pt=u.styles[Je];return pt?"\x1B["+u.colors[pt][0]+"m"+dt+"\x1B["+u.colors[pt][1]+"m":dt}function x(dt,Je){return dt}function p(dt){var Je={};return dt.forEach(function(pt,rr){Je[pt]=!0}),Je}function g(dt,Je,pt){if(dt.customInspect&&Je&&I(Je.inspect)&&Je.inspect!==t.inspect&&!(Je.constructor&&Je.constructor.prototype===Je)){var rr=Je.inspect(pt,dt);return q(rr)||(rr=g(dt,rr,pt)),rr}var cr=y(dt,Je);if(cr)return cr;var fr=Object.keys(Je),ir=p(fr);if(dt.showHidden&&(fr=Object.getOwnPropertyNames(Je)),v(Je)&&(fr.indexOf("message")>=0||fr.indexOf("description")>=0))return b(Je);if(fr.length===0){if(I(Je)){var ft=Je.name?": "+Je.name:"";return dt.stylize("[Function"+ft+"]","special")}if(Xe(Je))return dt.stylize(RegExp.prototype.toString.call(Je),"regexp");if(Ve(Je))return dt.stylize(Date.prototype.toString.call(Je),"date");if(v(Je))return b(Je)}var nr="",lr=!1,er=["{","}"];if(Re(Je)&&(lr=!0,er=["[","]"]),I(Je)){var pr=Je.name?": "+Je.name:"";nr=" [Function"+pr+"]"}if(Xe(Je)&&(nr=" "+RegExp.prototype.toString.call(Je)),Ve(Je)&&(nr=" "+Date.prototype.toUTCString.call(Je)),v(Je)&&(nr=" "+b(Je)),fr.length===0&&(!lr||Je.length==0))return er[0]+nr+er[1];if(pt<0)return Xe(Je)?dt.stylize(RegExp.prototype.toString.call(Je),"regexp"):dt.stylize("[Object]","special");dt.seen.push(Je);var Er;return lr?Er=R(dt,Je,pt,ir,fr):Er=fr.map(function(xr){return D(dt,Je,pt,ir,xr,lr)}),dt.seen.pop(),k(Er,nr,er)}function y(dt,Je){if(We(Je))return dt.stylize("undefined","undefined");if(q(Je)){var pt="'"+JSON.stringify(Je).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return dt.stylize(pt,"string")}if(ze(Je))return dt.stylize(""+Je,"number");if(Fe(Je))return dt.stylize(""+Je,"boolean");if(O(Je))return dt.stylize("null","null")}function b(dt){return"["+Error.prototype.toString.call(dt)+"]"}function R(dt,Je,pt,rr,cr){for(var fr=[],ir=0,ft=Je.length;ir<ft;++ir)je(Je,String(ir))?fr.push(D(dt,Je,pt,rr,String(ir),!0)):fr.push("");return cr.forEach(function(nr){nr.match(/^\d+$/)||fr.push(D(dt,Je,pt,rr,nr,!0))}),fr}function D(dt,Je,pt,rr,cr,fr){var ir,ft,nr;if(nr=Object.getOwnPropertyDescriptor(Je,cr)||{value:Je[cr]},nr.get?nr.set?ft=dt.stylize("[Getter/Setter]","special"):ft=dt.stylize("[Getter]","special"):nr.set&&(ft=dt.stylize("[Setter]","special")),je(rr,cr)||(ir="["+cr+"]"),ft||(dt.seen.indexOf(nr.value)<0?(O(pt)?ft=g(dt,nr.value,null):ft=g(dt,nr.value,pt-1),ft.indexOf(`
`)>-1&&(fr?ft=ft.split(`
`).map(function(lr){return"  "+lr}).join(`
`).slice(2):ft=`
`+ft.split(`
`).map(function(lr){return"   "+lr}).join(`
`))):ft=dt.stylize("[Circular]","special")),We(ir)){if(fr&&cr.match(/^\d+$/))return ft;ir=JSON.stringify(""+cr),ir.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(ir=ir.slice(1,-1),ir=dt.stylize(ir,"name")):(ir=ir.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),ir=dt.stylize(ir,"string"))}return ir+": "+ft}function k(dt,Je,pt){var rr=dt.reduce(function(cr,fr){return fr.indexOf(`
`)>=0,cr+fr.replace(/\u001b\[\d\d?m/g,"").length+1},0);return rr>60?pt[0]+(Je===""?"":Je+`
 `)+" "+dt.join(`,
  `)+" "+pt[1]:pt[0]+Je+" "+dt.join(", ")+" "+pt[1]}t.types=requireTypes$1();function Re(dt){return Array.isArray(dt)}t.isArray=Re;function Fe(dt){return typeof dt=="boolean"}t.isBoolean=Fe;function O(dt){return dt===null}t.isNull=O;function $e(dt){return dt==null}t.isNullOrUndefined=$e;function ze(dt){return typeof dt=="number"}t.isNumber=ze;function q(dt){return typeof dt=="string"}t.isString=q;function W(dt){return typeof dt=="symbol"}t.isSymbol=W;function We(dt){return dt===void 0}t.isUndefined=We;function Xe(dt){return it(dt)&&P(dt)==="[object RegExp]"}t.isRegExp=Xe,t.types.isRegExp=Xe;function it(dt){return typeof dt=="object"&&dt!==null}t.isObject=it;function Ve(dt){return it(dt)&&P(dt)==="[object Date]"}t.isDate=Ve,t.types.isDate=Ve;function v(dt){return it(dt)&&(P(dt)==="[object Error]"||dt instanceof Error)}t.isError=v,t.types.isNativeError=v;function I(dt){return typeof dt=="function"}t.isFunction=I;function Ce(dt){return dt===null||typeof dt=="boolean"||typeof dt=="number"||typeof dt=="string"||typeof dt=="symbol"||typeof dt>"u"}t.isPrimitive=Ce,t.isBuffer=requireIsBufferBrowser();function P(dt){return Object.prototype.toString.call(dt)}function _e(dt){return dt<10?"0"+dt.toString(10):dt.toString(10)}var Le=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Ye(){var dt=new Date,Je=[_e(dt.getHours()),_e(dt.getMinutes()),_e(dt.getSeconds())].join(":");return[dt.getDate(),Le[dt.getMonth()],Je].join(" ")}t.log=function(){console.log("%s - %s",Ye(),t.format.apply(t,arguments))},t.inherits=requireInherits_browser(),t._extend=function(dt,Je){if(!Je||!it(Je))return dt;for(var pt=Object.keys(Je),rr=pt.length;rr--;)dt[pt[rr]]=Je[pt[rr]];return dt};function je(dt,Je){return Object.prototype.hasOwnProperty.call(dt,Je)}var K=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;t.promisify=function(Je){if(typeof Je!="function")throw new TypeError('The "original" argument must be of type Function');if(K&&Je[K]){var pt=Je[K];if(typeof pt!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(pt,K,{value:pt,enumerable:!1,writable:!1,configurable:!0}),pt}function pt(){for(var rr,cr,fr=new Promise(function(nr,lr){rr=nr,cr=lr}),ir=[],ft=0;ft<arguments.length;ft++)ir.push(arguments[ft]);ir.push(function(nr,lr){nr?cr(nr):rr(lr)});try{Je.apply(this,ir)}catch(nr){cr(nr)}return fr}return Object.setPrototypeOf(pt,Object.getPrototypeOf(Je)),K&&Object.defineProperty(pt,K,{value:pt,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(pt,r(Je))},t.promisify.custom=K;function L(dt,Je){if(!dt){var pt=new Error("Promise was rejected with a falsy value");pt.reason=dt,dt=pt}return Je(dt)}function st(dt){if(typeof dt!="function")throw new TypeError('The "original" argument must be of type Function');function Je(){for(var pt=[],rr=0;rr<arguments.length;rr++)pt.push(arguments[rr]);var cr=pt.pop();if(typeof cr!="function")throw new TypeError("The last argument must be of type Function");var fr=this,ir=function(){return cr.apply(fr,arguments)};dt.apply(this,pt).then(function(ft){process$1.nextTick(ir.bind(null,null,ft))},function(ft){process$1.nextTick(L.bind(null,ft,ir))})}return Object.setPrototypeOf(Je,Object.getPrototypeOf(dt)),Object.defineProperties(Je,r(dt)),Je}t.callbackify=st})(util)),util}var hasRequiredErrors;function requireErrors(){if(hasRequiredErrors)return errors;hasRequiredErrors=1;function t(Fe){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},t(Fe)}function e(Fe,O,$e){return Object.defineProperty(Fe,"prototype",{writable:!1}),Fe}function r(Fe,O){if(!(Fe instanceof O))throw new TypeError("Cannot call a class as a function")}function n(Fe,O){if(typeof O!="function"&&O!==null)throw new TypeError("Super expression must either be null or a function");Fe.prototype=Object.create(O&&O.prototype,{constructor:{value:Fe,writable:!0,configurable:!0}}),Object.defineProperty(Fe,"prototype",{writable:!1}),O&&s(Fe,O)}function s(Fe,O){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(ze,q){return ze.__proto__=q,ze},s(Fe,O)}function o(Fe){var O=f();return function(){var ze=x(Fe),q;if(O){var W=x(this).constructor;q=Reflect.construct(ze,arguments,W)}else q=ze.apply(this,arguments);return c(this,q)}}function c(Fe,O){if(O&&(t(O)==="object"||typeof O=="function"))return O;if(O!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return u(Fe)}function u(Fe){if(Fe===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Fe}function f(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function x(Fe){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function($e){return $e.__proto__||Object.getPrototypeOf($e)},x(Fe)}var p={},g,y;function b(Fe,O,$e){$e||($e=Error);function ze(W,We,Xe){return typeof O=="string"?O:O(W,We,Xe)}var q=(function(W){n(Xe,W);var We=o(Xe);function Xe(it,Ve,v){var I;return r(this,Xe),I=We.call(this,ze(it,Ve,v)),I.code=Fe,I}return e(Xe)})($e);p[Fe]=q}function R(Fe,O){if(Array.isArray(Fe)){var $e=Fe.length;return Fe=Fe.map(function(ze){return String(ze)}),$e>2?"one of ".concat(O," ").concat(Fe.slice(0,$e-1).join(", "),", or ")+Fe[$e-1]:$e===2?"one of ".concat(O," ").concat(Fe[0]," or ").concat(Fe[1]):"of ".concat(O," ").concat(Fe[0])}else return"of ".concat(O," ").concat(String(Fe))}function D(Fe,O,$e){return Fe.substr(0,O.length)===O}function k(Fe,O,$e){return($e===void 0||$e>Fe.length)&&($e=Fe.length),Fe.substring($e-O.length,$e)===O}function Re(Fe,O,$e){return typeof $e!="number"&&($e=0),$e+O.length>Fe.length?!1:Fe.indexOf(O,$e)!==-1}return b("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError),b("ERR_INVALID_ARG_TYPE",function(Fe,O,$e){g===void 0&&(g=requireAssert()),g(typeof Fe=="string","'name' must be a string");var ze;typeof O=="string"&&D(O,"not ")?(ze="must not be",O=O.replace(/^not /,"")):ze="must be";var q;if(k(Fe," argument"))q="The ".concat(Fe," ").concat(ze," ").concat(R(O,"type"));else{var W=Re(Fe,".")?"property":"argument";q='The "'.concat(Fe,'" ').concat(W," ").concat(ze," ").concat(R(O,"type"))}return q+=". Received type ".concat(t($e)),q},TypeError),b("ERR_INVALID_ARG_VALUE",function(Fe,O){var $e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"is invalid";y===void 0&&(y=requireUtil());var ze=y.inspect(O);return ze.length>128&&(ze="".concat(ze.slice(0,128),"...")),"The argument '".concat(Fe,"' ").concat($e,". Received ").concat(ze)},TypeError),b("ERR_INVALID_RETURN_VALUE",function(Fe,O,$e){var ze;return $e&&$e.constructor&&$e.constructor.name?ze="instance of ".concat($e.constructor.name):ze="type ".concat(t($e)),"Expected ".concat(Fe,' to be returned from the "').concat(O,'"')+" function but got ".concat(ze,".")},TypeError),b("ERR_MISSING_ARGS",function(){for(var Fe=arguments.length,O=new Array(Fe),$e=0;$e<Fe;$e++)O[$e]=arguments[$e];g===void 0&&(g=requireAssert()),g(O.length>0,"At least one arg needs to be specified");var ze="The ",q=O.length;switch(O=O.map(function(W){return'"'.concat(W,'"')}),q){case 1:ze+="".concat(O[0]," argument");break;case 2:ze+="".concat(O[0]," and ").concat(O[1]," arguments");break;default:ze+=O.slice(0,q-1).join(", "),ze+=", and ".concat(O[q-1]," arguments");break}return"".concat(ze," must be specified")},TypeError),errors.codes=p,errors}var assertion_error,hasRequiredAssertion_error;function requireAssertion_error(){if(hasRequiredAssertion_error)return assertion_error;hasRequiredAssertion_error=1;function t(je,K){var L=Object.keys(je);if(Object.getOwnPropertySymbols){var st=Object.getOwnPropertySymbols(je);K&&(st=st.filter(function(dt){return Object.getOwnPropertyDescriptor(je,dt).enumerable})),L.push.apply(L,st)}return L}function e(je){for(var K=1;K<arguments.length;K++){var L=arguments[K]!=null?arguments[K]:{};K%2?t(Object(L),!0).forEach(function(st){r(je,st,L[st])}):Object.getOwnPropertyDescriptors?Object.defineProperties(je,Object.getOwnPropertyDescriptors(L)):t(Object(L)).forEach(function(st){Object.defineProperty(je,st,Object.getOwnPropertyDescriptor(L,st))})}return je}function r(je,K,L){return K=c(K),K in je?Object.defineProperty(je,K,{value:L,enumerable:!0,configurable:!0,writable:!0}):je[K]=L,je}function n(je,K){if(!(je instanceof K))throw new TypeError("Cannot call a class as a function")}function s(je,K){for(var L=0;L<K.length;L++){var st=K[L];st.enumerable=st.enumerable||!1,st.configurable=!0,"value"in st&&(st.writable=!0),Object.defineProperty(je,c(st.key),st)}}function o(je,K,L){return K&&s(je.prototype,K),Object.defineProperty(je,"prototype",{writable:!1}),je}function c(je){var K=u(je,"string");return Fe(K)==="symbol"?K:String(K)}function u(je,K){if(Fe(je)!=="object"||je===null)return je;var L=je[Symbol.toPrimitive];if(L!==void 0){var st=L.call(je,K);if(Fe(st)!=="object")return st;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(je)}function f(je,K){if(typeof K!="function"&&K!==null)throw new TypeError("Super expression must either be null or a function");je.prototype=Object.create(K&&K.prototype,{constructor:{value:je,writable:!0,configurable:!0}}),Object.defineProperty(je,"prototype",{writable:!1}),K&&k(je,K)}function x(je){var K=R();return function(){var st=Re(je),dt;if(K){var Je=Re(this).constructor;dt=Reflect.construct(st,arguments,Je)}else dt=st.apply(this,arguments);return p(this,dt)}}function p(je,K){if(K&&(Fe(K)==="object"||typeof K=="function"))return K;if(K!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return g(je)}function g(je){if(je===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return je}function y(je){var K=typeof Map=="function"?new Map:void 0;return y=function(st){if(st===null||!D(st))return st;if(typeof st!="function")throw new TypeError("Super expression must either be null or a function");if(typeof K<"u"){if(K.has(st))return K.get(st);K.set(st,dt)}function dt(){return b(st,arguments,Re(this).constructor)}return dt.prototype=Object.create(st.prototype,{constructor:{value:dt,enumerable:!1,writable:!0,configurable:!0}}),k(dt,st)},y(je)}function b(je,K,L){return R()?b=Reflect.construct.bind():b=function(dt,Je,pt){var rr=[null];rr.push.apply(rr,Je);var cr=Function.bind.apply(dt,rr),fr=new cr;return pt&&k(fr,pt.prototype),fr},b.apply(null,arguments)}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(je){return Function.toString.call(je).indexOf("[native code]")!==-1}function k(je,K){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(st,dt){return st.__proto__=dt,st},k(je,K)}function Re(je){return Re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(L){return L.__proto__||Object.getPrototypeOf(L)},Re(je)}function Fe(je){"@babel/helpers - typeof";return Fe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(K){return typeof K}:function(K){return K&&typeof Symbol=="function"&&K.constructor===Symbol&&K!==Symbol.prototype?"symbol":typeof K},Fe(je)}var O=requireUtil(),$e=O.inspect,ze=requireErrors(),q=ze.codes.ERR_INVALID_ARG_TYPE;function W(je,K,L){return(L===void 0||L>je.length)&&(L=je.length),je.substring(L-K.length,L)===K}function We(je,K){if(K=Math.floor(K),je.length==0||K==0)return"";var L=je.length*K;for(K=Math.floor(Math.log(K)/Math.log(2));K;)je+=je,K--;return je+=je.substring(0,L-je.length),je}var Xe="",it="",Ve="",v="",I={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"},Ce=10;function P(je){var K=Object.keys(je),L=Object.create(Object.getPrototypeOf(je));return K.forEach(function(st){L[st]=je[st]}),Object.defineProperty(L,"message",{value:je.message}),L}function _e(je){return $e(je,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}function Le(je,K,L){var st="",dt="",Je=0,pt="",rr=!1,cr=_e(je),fr=cr.split(`
`),ir=_e(K).split(`
`),ft=0,nr="";if(L==="strictEqual"&&Fe(je)==="object"&&Fe(K)==="object"&&je!==null&&K!==null&&(L="strictEqualObject"),fr.length===1&&ir.length===1&&fr[0]!==ir[0]){var lr=fr[0].length+ir[0].length;if(lr<=Ce){if((Fe(je)!=="object"||je===null)&&(Fe(K)!=="object"||K===null)&&(je!==0||K!==0))return"".concat(I[L],`

`)+"".concat(fr[0]," !== ").concat(ir[0],`
`)}else if(L!=="strictEqualObject"){var er=process$1.stderr&&process$1.stderr.isTTY?process$1.stderr.columns:80;if(lr<er){for(;fr[0][ft]===ir[0][ft];)ft++;ft>2&&(nr=`
  `.concat(We(" ",ft),"^"),ft=0)}}}for(var pr=fr[fr.length-1],Er=ir[ir.length-1];pr===Er&&(ft++<2?pt=`
  `.concat(pr).concat(pt):st=pr,fr.pop(),ir.pop(),!(fr.length===0||ir.length===0));)pr=fr[fr.length-1],Er=ir[ir.length-1];var xr=Math.max(fr.length,ir.length);if(xr===0){var wr=cr.split(`
`);if(wr.length>30)for(wr[26]="".concat(Xe,"...").concat(v);wr.length>27;)wr.pop();return"".concat(I.notIdentical,`

`).concat(wr.join(`
`),`
`)}ft>3&&(pt=`
`.concat(Xe,"...").concat(v).concat(pt),rr=!0),st!==""&&(pt=`
  `.concat(st).concat(pt),st="");var Br=0,hr=I[L]+`
`.concat(it,"+ actual").concat(v," ").concat(Ve,"- expected").concat(v),Cr=" ".concat(Xe,"...").concat(v," Lines skipped");for(ft=0;ft<xr;ft++){var _r=ft-Je;if(fr.length<ft+1)_r>1&&ft>2&&(_r>4?(dt+=`
`.concat(Xe,"...").concat(v),rr=!0):_r>3&&(dt+=`
  `.concat(ir[ft-2]),Br++),dt+=`
  `.concat(ir[ft-1]),Br++),Je=ft,st+=`
`.concat(Ve,"-").concat(v," ").concat(ir[ft]),Br++;else if(ir.length<ft+1)_r>1&&ft>2&&(_r>4?(dt+=`
`.concat(Xe,"...").concat(v),rr=!0):_r>3&&(dt+=`
  `.concat(fr[ft-2]),Br++),dt+=`
  `.concat(fr[ft-1]),Br++),Je=ft,dt+=`
`.concat(it,"+").concat(v," ").concat(fr[ft]),Br++;else{var Tr=ir[ft],Nr=fr[ft],or=Nr!==Tr&&(!W(Nr,",")||Nr.slice(0,-1)!==Tr);or&&W(Tr,",")&&Tr.slice(0,-1)===Nr&&(or=!1,Nr+=","),or?(_r>1&&ft>2&&(_r>4?(dt+=`
`.concat(Xe,"...").concat(v),rr=!0):_r>3&&(dt+=`
  `.concat(fr[ft-2]),Br++),dt+=`
  `.concat(fr[ft-1]),Br++),Je=ft,dt+=`
`.concat(it,"+").concat(v," ").concat(Nr),st+=`
`.concat(Ve,"-").concat(v," ").concat(Tr),Br+=2):(dt+=st,st="",(_r===1||ft===0)&&(dt+=`
  `.concat(Nr),Br++))}if(Br>20&&ft<xr-2)return"".concat(hr).concat(Cr,`
`).concat(dt,`
`).concat(Xe,"...").concat(v).concat(st,`
`)+"".concat(Xe,"...").concat(v)}return"".concat(hr).concat(rr?Cr:"",`
`).concat(dt).concat(st).concat(pt).concat(nr)}var Ye=(function(je,K){f(st,je);var L=x(st);function st(dt){var Je;if(n(this,st),Fe(dt)!=="object"||dt===null)throw new q("options","Object",dt);var pt=dt.message,rr=dt.operator,cr=dt.stackStartFn,fr=dt.actual,ir=dt.expected,ft=Error.stackTraceLimit;if(Error.stackTraceLimit=0,pt!=null)Je=L.call(this,String(pt));else if(process$1.stderr&&process$1.stderr.isTTY&&(process$1.stderr&&process$1.stderr.getColorDepth&&process$1.stderr.getColorDepth()!==1?(Xe="\x1B[34m",it="\x1B[32m",v="\x1B[39m",Ve="\x1B[31m"):(Xe="",it="",v="",Ve="")),Fe(fr)==="object"&&fr!==null&&Fe(ir)==="object"&&ir!==null&&"stack"in fr&&fr instanceof Error&&"stack"in ir&&ir instanceof Error&&(fr=P(fr),ir=P(ir)),rr==="deepStrictEqual"||rr==="strictEqual")Je=L.call(this,Le(fr,ir,rr));else if(rr==="notDeepStrictEqual"||rr==="notStrictEqual"){var nr=I[rr],lr=_e(fr).split(`
`);if(rr==="notStrictEqual"&&Fe(fr)==="object"&&fr!==null&&(nr=I.notStrictEqualObject),lr.length>30)for(lr[26]="".concat(Xe,"...").concat(v);lr.length>27;)lr.pop();lr.length===1?Je=L.call(this,"".concat(nr," ").concat(lr[0])):Je=L.call(this,"".concat(nr,`

`).concat(lr.join(`
`),`
`))}else{var er=_e(fr),pr="",Er=I[rr];rr==="notDeepEqual"||rr==="notEqual"?(er="".concat(I[rr],`

`).concat(er),er.length>1024&&(er="".concat(er.slice(0,1021),"..."))):(pr="".concat(_e(ir)),er.length>512&&(er="".concat(er.slice(0,509),"...")),pr.length>512&&(pr="".concat(pr.slice(0,509),"...")),rr==="deepEqual"||rr==="equal"?er="".concat(Er,`

`).concat(er,`

should equal

`):pr=" ".concat(rr," ").concat(pr)),Je=L.call(this,"".concat(er).concat(pr))}return Error.stackTraceLimit=ft,Je.generatedMessage=!pt,Object.defineProperty(g(Je),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),Je.code="ERR_ASSERTION",Je.actual=fr,Je.expected=ir,Je.operator=rr,Error.captureStackTrace&&Error.captureStackTrace(g(Je),cr),Je.stack,Je.name="AssertionError",p(Je)}return o(st,[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:K,value:function(Je,pt){return $e(this,e(e({},pt),{},{customInspect:!1,depth:0}))}}]),st})(y(Error),$e.custom);return assertion_error=Ye,assertion_error}var isArguments,hasRequiredIsArguments;function requireIsArguments(){if(hasRequiredIsArguments)return isArguments;hasRequiredIsArguments=1;var t=Object.prototype.toString;return isArguments=function(r){var n=t.call(r),s=n==="[object Arguments]";return s||(s=n!=="[object Array]"&&r!==null&&typeof r=="object"&&typeof r.length=="number"&&r.length>=0&&t.call(r.callee)==="[object Function]"),s},isArguments}var implementation$3,hasRequiredImplementation$3;function requireImplementation$3(){if(hasRequiredImplementation$3)return implementation$3;hasRequiredImplementation$3=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=requireIsArguments(),s=Object.prototype.propertyIsEnumerable,o=!s.call({toString:null},"toString"),c=s.call(function(){},"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],f=function(y){var b=y.constructor;return b&&b.prototype===y},x={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=(function(){if(typeof window>"u")return!1;for(var y in window)try{if(!x["$"+y]&&e.call(window,y)&&window[y]!==null&&typeof window[y]=="object")try{f(window[y])}catch{return!0}}catch{return!0}return!1})(),g=function(y){if(typeof window>"u"||!p)return f(y);try{return f(y)}catch{return!1}};t=function(b){var R=b!==null&&typeof b=="object",D=r.call(b)==="[object Function]",k=n(b),Re=R&&r.call(b)==="[object String]",Fe=[];if(!R&&!D&&!k)throw new TypeError("Object.keys called on a non-object");var O=c&&D;if(Re&&b.length>0&&!e.call(b,0))for(var $e=0;$e<b.length;++$e)Fe.push(String($e));if(k&&b.length>0)for(var ze=0;ze<b.length;++ze)Fe.push(String(ze));else for(var q in b)!(O&&q==="prototype")&&e.call(b,q)&&Fe.push(String(q));if(o)for(var W=g(b),We=0;We<u.length;++We)!(W&&u[We]==="constructor")&&e.call(b,u[We])&&Fe.push(u[We]);return Fe}}return implementation$3=t,implementation$3}var objectKeys,hasRequiredObjectKeys;function requireObjectKeys(){if(hasRequiredObjectKeys)return objectKeys;hasRequiredObjectKeys=1;var t=Array.prototype.slice,e=requireIsArguments(),r=Object.keys,n=r?function(c){return r(c)}:requireImplementation$3(),s=Object.keys;return n.shim=function(){if(Object.keys){var c=(function(){var u=Object.keys(arguments);return u&&u.length===arguments.length})(1,2);c||(Object.keys=function(f){return e(f)?s(t.call(f)):s(f)})}else Object.keys=n;return Object.keys||n},objectKeys=n,objectKeys}var implementation$2,hasRequiredImplementation$2;function requireImplementation$2(){if(hasRequiredImplementation$2)return implementation$2;hasRequiredImplementation$2=1;var t=requireObjectKeys(),e=requireShams$1()(),r=requireCallBound$1(),n=requireEsObjectAtoms(),s=r("Array.prototype.push"),o=r("Object.prototype.propertyIsEnumerable"),c=e?n.getOwnPropertySymbols:null;return implementation$2=function(f,x){if(f==null)throw new TypeError("target must be an object");var p=n(f);if(arguments.length===1)return p;for(var g=1;g<arguments.length;++g){var y=n(arguments[g]),b=t(y),R=e&&(n.getOwnPropertySymbols||c);if(R)for(var D=R(y),k=0;k<D.length;++k){var Re=D[k];o(y,Re)&&s(b,Re)}for(var Fe=0;Fe<b.length;++Fe){var O=b[Fe];if(o(y,O)){var $e=y[O];p[O]=$e}}}return p},implementation$2}var polyfill$2,hasRequiredPolyfill$2;function requirePolyfill$2(){if(hasRequiredPolyfill$2)return polyfill$2;hasRequiredPolyfill$2=1;var t=requireImplementation$2(),e=function(){if(!Object.assign)return!1;for(var n="abcdefghijklmnopqrst",s=n.split(""),o={},c=0;c<s.length;++c)o[s[c]]=s[c];var u=Object.assign({},o),f="";for(var x in u)f+=x;return n!==f},r=function(){if(!Object.assign||!Object.preventExtensions)return!1;var n=Object.preventExtensions({1:2});try{Object.assign(n,"xy")}catch{return n[1]==="y"}return!1};return polyfill$2=function(){return!Object.assign||e()||r()?t:Object.assign},polyfill$2}var implementation$1,hasRequiredImplementation$1;function requireImplementation$1(){if(hasRequiredImplementation$1)return implementation$1;hasRequiredImplementation$1=1;var t=function(e){return e!==e};return implementation$1=function(r,n){return r===0&&n===0?1/r===1/n:!!(r===n||t(r)&&t(n))},implementation$1}var polyfill$1,hasRequiredPolyfill$1;function requirePolyfill$1(){if(hasRequiredPolyfill$1)return polyfill$1;hasRequiredPolyfill$1=1;var t=requireImplementation$1();return polyfill$1=function(){return typeof Object.is=="function"?Object.is:t},polyfill$1}var callBound,hasRequiredCallBound;function requireCallBound(){if(hasRequiredCallBound)return callBound;hasRequiredCallBound=1;var t=requireGetIntrinsic(),e=requireCallBind(),r=e(t("String.prototype.indexOf"));return callBound=function(s,o){var c=t(s,!!o);return typeof c=="function"&&r(s,".prototype.")>-1?e(c):c},callBound}var defineProperties_1,hasRequiredDefineProperties;function requireDefineProperties(){if(hasRequiredDefineProperties)return defineProperties_1;hasRequiredDefineProperties=1;var t=requireObjectKeys(),e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",r=Object.prototype.toString,n=Array.prototype.concat,s=requireDefineDataProperty(),o=function(x){return typeof x=="function"&&r.call(x)==="[object Function]"},c=requireHasPropertyDescriptors()(),u=function(x,p,g,y){if(p in x){if(y===!0){if(x[p]===g)return}else if(!o(y)||!y())return}c?s(x,p,g,!0):s(x,p,g)},f=function(x,p){var g=arguments.length>2?arguments[2]:{},y=t(p);e&&(y=n.call(y,Object.getOwnPropertySymbols(p)));for(var b=0;b<y.length;b+=1)u(x,y[b],p[y[b]],g[y[b]])};return f.supportsDescriptors=!!c,defineProperties_1=f,defineProperties_1}var shim$1,hasRequiredShim$1;function requireShim$1(){if(hasRequiredShim$1)return shim$1;hasRequiredShim$1=1;var t=requirePolyfill$1(),e=requireDefineProperties();return shim$1=function(){var n=t();return e(Object,{is:n},{is:function(){return Object.is!==n}}),n},shim$1}var objectIs,hasRequiredObjectIs;function requireObjectIs(){if(hasRequiredObjectIs)return objectIs;hasRequiredObjectIs=1;var t=requireDefineProperties(),e=requireCallBind(),r=requireImplementation$1(),n=requirePolyfill$1(),s=requireShim$1(),o=e(n(),Object);return t(o,{getPolyfill:n,implementation:r,shim:s}),objectIs=o,objectIs}var implementation,hasRequiredImplementation;function requireImplementation(){return hasRequiredImplementation||(hasRequiredImplementation=1,implementation=function(e){return e!==e}),implementation}var polyfill,hasRequiredPolyfill;function requirePolyfill(){if(hasRequiredPolyfill)return polyfill;hasRequiredPolyfill=1;var t=requireImplementation();return polyfill=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:t},polyfill}var shim,hasRequiredShim;function requireShim(){if(hasRequiredShim)return shim;hasRequiredShim=1;var t=requireDefineProperties(),e=requirePolyfill();return shim=function(){var n=e();return t(Number,{isNaN:n},{isNaN:function(){return Number.isNaN!==n}}),n},shim}var isNan,hasRequiredIsNan;function requireIsNan(){if(hasRequiredIsNan)return isNan;hasRequiredIsNan=1;var t=requireCallBind(),e=requireDefineProperties(),r=requireImplementation(),n=requirePolyfill(),s=requireShim(),o=t(n(),Number);return e(o,{getPolyfill:n,implementation:r,shim:s}),isNan=o,isNan}var comparisons,hasRequiredComparisons;function requireComparisons(){if(hasRequiredComparisons)return comparisons;hasRequiredComparisons=1;function t(or,tr){return o(or)||s(or,tr)||r(or,tr)||e()}function e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r(or,tr){if(or){if(typeof or=="string")return n(or,tr);var yr=Object.prototype.toString.call(or).slice(8,-1);if(yr==="Object"&&or.constructor&&(yr=or.constructor.name),yr==="Map"||yr==="Set")return Array.from(or);if(yr==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(yr))return n(or,tr)}}function n(or,tr){(tr==null||tr>or.length)&&(tr=or.length);for(var yr=0,mr=new Array(tr);yr<tr;yr++)mr[yr]=or[yr];return mr}function s(or,tr){var yr=or==null?null:typeof Symbol<"u"&&or[Symbol.iterator]||or["@@iterator"];if(yr!=null){var mr,sr,Ar,ht,Qe=[],lt=!0,ar=!1;try{if(Ar=(yr=yr.call(or)).next,tr!==0)for(;!(lt=(mr=Ar.call(yr)).done)&&(Qe.push(mr.value),Qe.length!==tr);lt=!0);}catch(br){ar=!0,sr=br}finally{try{if(!lt&&yr.return!=null&&(ht=yr.return(),Object(ht)!==ht))return}finally{if(ar)throw sr}}return Qe}}function o(or){if(Array.isArray(or))return or}function c(or){"@babel/helpers - typeof";return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(tr){return typeof tr}:function(tr){return tr&&typeof Symbol=="function"&&tr.constructor===Symbol&&tr!==Symbol.prototype?"symbol":typeof tr},c(or)}var u=/a/g.flags!==void 0,f=function(tr){var yr=[];return tr.forEach(function(mr){return yr.push(mr)}),yr},x=function(tr){var yr=[];return tr.forEach(function(mr,sr){return yr.push([sr,mr])}),yr},p=Object.is?Object.is:requireObjectIs(),g=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},y=Number.isNaN?Number.isNaN:requireIsNan();function b(or){return or.call.bind(or)}var R=b(Object.prototype.hasOwnProperty),D=b(Object.prototype.propertyIsEnumerable),k=b(Object.prototype.toString),Re=requireUtil().types,Fe=Re.isAnyArrayBuffer,O=Re.isArrayBufferView,$e=Re.isDate,ze=Re.isMap,q=Re.isRegExp,W=Re.isSet,We=Re.isNativeError,Xe=Re.isBoxedPrimitive,it=Re.isNumberObject,Ve=Re.isStringObject,v=Re.isBooleanObject,I=Re.isBigIntObject,Ce=Re.isSymbolObject,P=Re.isFloat32Array,_e=Re.isFloat64Array;function Le(or){if(or.length===0||or.length>10)return!0;for(var tr=0;tr<or.length;tr++){var yr=or.charCodeAt(tr);if(yr<48||yr>57)return!0}return or.length===10&&or>=Math.pow(2,32)}function Ye(or){return Object.keys(or).filter(Le).concat(g(or).filter(Object.prototype.propertyIsEnumerable.bind(or)))}function je(or,tr){if(or===tr)return 0;for(var yr=or.length,mr=tr.length,sr=0,Ar=Math.min(yr,mr);sr<Ar;++sr)if(or[sr]!==tr[sr]){yr=or[sr],mr=tr[sr];break}return yr<mr?-1:mr<yr?1:0}var K=!0,L=!1,st=0,dt=1,Je=2,pt=3;function rr(or,tr){return u?or.source===tr.source&&or.flags===tr.flags:RegExp.prototype.toString.call(or)===RegExp.prototype.toString.call(tr)}function cr(or,tr){if(or.byteLength!==tr.byteLength)return!1;for(var yr=0;yr<or.byteLength;yr++)if(or[yr]!==tr[yr])return!1;return!0}function fr(or,tr){return or.byteLength!==tr.byteLength?!1:je(new Uint8Array(or.buffer,or.byteOffset,or.byteLength),new Uint8Array(tr.buffer,tr.byteOffset,tr.byteLength))===0}function ir(or,tr){return or.byteLength===tr.byteLength&&je(new Uint8Array(or),new Uint8Array(tr))===0}function ft(or,tr){return it(or)?it(tr)&&p(Number.prototype.valueOf.call(or),Number.prototype.valueOf.call(tr)):Ve(or)?Ve(tr)&&String.prototype.valueOf.call(or)===String.prototype.valueOf.call(tr):v(or)?v(tr)&&Boolean.prototype.valueOf.call(or)===Boolean.prototype.valueOf.call(tr):I(or)?I(tr)&&BigInt.prototype.valueOf.call(or)===BigInt.prototype.valueOf.call(tr):Ce(tr)&&Symbol.prototype.valueOf.call(or)===Symbol.prototype.valueOf.call(tr)}function nr(or,tr,yr,mr){if(or===tr)return or!==0?!0:yr?p(or,tr):!0;if(yr){if(c(or)!=="object")return typeof or=="number"&&y(or)&&y(tr);if(c(tr)!=="object"||or===null||tr===null||Object.getPrototypeOf(or)!==Object.getPrototypeOf(tr))return!1}else{if(or===null||c(or)!=="object")return tr===null||c(tr)!=="object"?or==tr:!1;if(tr===null||c(tr)!=="object")return!1}var sr=k(or),Ar=k(tr);if(sr!==Ar)return!1;if(Array.isArray(or)){if(or.length!==tr.length)return!1;var ht=Ye(or),Qe=Ye(tr);return ht.length!==Qe.length?!1:er(or,tr,yr,mr,dt,ht)}if(sr==="[object Object]"&&(!ze(or)&&ze(tr)||!W(or)&&W(tr)))return!1;if($e(or)){if(!$e(tr)||Date.prototype.getTime.call(or)!==Date.prototype.getTime.call(tr))return!1}else if(q(or)){if(!q(tr)||!rr(or,tr))return!1}else if(We(or)||or instanceof Error){if(or.message!==tr.message||or.name!==tr.name)return!1}else if(O(or)){if(!yr&&(P(or)||_e(or))){if(!cr(or,tr))return!1}else if(!fr(or,tr))return!1;var lt=Ye(or),ar=Ye(tr);return lt.length!==ar.length?!1:er(or,tr,yr,mr,st,lt)}else{if(W(or))return!W(tr)||or.size!==tr.size?!1:er(or,tr,yr,mr,Je);if(ze(or))return!ze(tr)||or.size!==tr.size?!1:er(or,tr,yr,mr,pt);if(Fe(or)){if(!ir(or,tr))return!1}else if(Xe(or)&&!ft(or,tr))return!1}return er(or,tr,yr,mr,st)}function lr(or,tr){return tr.filter(function(yr){return D(or,yr)})}function er(or,tr,yr,mr,sr,Ar){if(arguments.length===5){Ar=Object.keys(or);var ht=Object.keys(tr);if(Ar.length!==ht.length)return!1}for(var Qe=0;Qe<Ar.length;Qe++)if(!R(tr,Ar[Qe]))return!1;if(yr&&arguments.length===5){var lt=g(or);if(lt.length!==0){var ar=0;for(Qe=0;Qe<lt.length;Qe++){var br=lt[Qe];if(D(or,br)){if(!D(tr,br))return!1;Ar.push(br),ar++}else if(D(tr,br))return!1}var Sr=g(tr);if(lt.length!==Sr.length&&lr(tr,Sr).length!==ar)return!1}else{var Rr=g(tr);if(Rr.length!==0&&lr(tr,Rr).length!==0)return!1}}if(Ar.length===0&&(sr===st||sr===dt&&or.length===0||or.size===0))return!0;if(mr===void 0)mr={val1:new Map,val2:new Map,position:0};else{var Lr=mr.val1.get(or);if(Lr!==void 0){var Gr=mr.val2.get(tr);if(Gr!==void 0)return Lr===Gr}mr.position++}mr.val1.set(or,mr.position),mr.val2.set(tr,mr.position);var zr=_r(or,tr,yr,Ar,mr,sr);return mr.val1.delete(or),mr.val2.delete(tr),zr}function pr(or,tr,yr,mr){for(var sr=f(or),Ar=0;Ar<sr.length;Ar++){var ht=sr[Ar];if(nr(tr,ht,yr,mr))return or.delete(ht),!0}return!1}function Er(or){switch(c(or)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":or=+or;case"number":if(y(or))return!1}return!0}function xr(or,tr,yr){var mr=Er(yr);return mr??(tr.has(mr)&&!or.has(mr))}function wr(or,tr,yr,mr,sr){var Ar=Er(yr);if(Ar!=null)return Ar;var ht=tr.get(Ar);return ht===void 0&&!tr.has(Ar)||!nr(mr,ht,!1,sr)?!1:!or.has(Ar)&&nr(mr,ht,!1,sr)}function Br(or,tr,yr,mr){for(var sr=null,Ar=f(or),ht=0;ht<Ar.length;ht++){var Qe=Ar[ht];if(c(Qe)==="object"&&Qe!==null)sr===null&&(sr=new Set),sr.add(Qe);else if(!tr.has(Qe)){if(yr||!xr(or,tr,Qe))return!1;sr===null&&(sr=new Set),sr.add(Qe)}}if(sr!==null){for(var lt=f(tr),ar=0;ar<lt.length;ar++){var br=lt[ar];if(c(br)==="object"&&br!==null){if(!pr(sr,br,yr,mr))return!1}else if(!yr&&!or.has(br)&&!pr(sr,br,yr,mr))return!1}return sr.size===0}return!0}function hr(or,tr,yr,mr,sr,Ar){for(var ht=f(or),Qe=0;Qe<ht.length;Qe++){var lt=ht[Qe];if(nr(yr,lt,sr,Ar)&&nr(mr,tr.get(lt),sr,Ar))return or.delete(lt),!0}return!1}function Cr(or,tr,yr,mr){for(var sr=null,Ar=x(or),ht=0;ht<Ar.length;ht++){var Qe=t(Ar[ht],2),lt=Qe[0],ar=Qe[1];if(c(lt)==="object"&&lt!==null)sr===null&&(sr=new Set),sr.add(lt);else{var br=tr.get(lt);if(br===void 0&&!tr.has(lt)||!nr(ar,br,yr,mr)){if(yr||!wr(or,tr,lt,ar,mr))return!1;sr===null&&(sr=new Set),sr.add(lt)}}}if(sr!==null){for(var Sr=x(tr),Rr=0;Rr<Sr.length;Rr++){var Lr=t(Sr[Rr],2),Gr=Lr[0],zr=Lr[1];if(c(Gr)==="object"&&Gr!==null){if(!hr(sr,or,Gr,zr,yr,mr))return!1}else if(!yr&&(!or.has(Gr)||!nr(or.get(Gr),zr,!1,mr))&&!hr(sr,or,Gr,zr,!1,mr))return!1}return sr.size===0}return!0}function _r(or,tr,yr,mr,sr,Ar){var ht=0;if(Ar===Je){if(!Br(or,tr,yr,sr))return!1}else if(Ar===pt){if(!Cr(or,tr,yr,sr))return!1}else if(Ar===dt)for(;ht<or.length;ht++)if(R(or,ht)){if(!R(tr,ht)||!nr(or[ht],tr[ht],yr,sr))return!1}else{if(R(tr,ht))return!1;for(var Qe=Object.keys(or);ht<Qe.length;ht++){var lt=Qe[ht];if(!R(tr,lt)||!nr(or[lt],tr[lt],yr,sr))return!1}return Qe.length===Object.keys(tr).length}for(ht=0;ht<mr.length;ht++){var ar=mr[ht];if(!nr(or[ar],tr[ar],yr,sr))return!1}return!0}function Tr(or,tr){return nr(or,tr,L)}function Nr(or,tr){return nr(or,tr,K)}return comparisons={isDeepEqual:Tr,isDeepStrictEqual:Nr},comparisons}var hasRequiredAssert;function requireAssert(){if(hasRequiredAssert)return assert$2.exports;hasRequiredAssert=1;function t(Je){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(pt){return typeof pt}:function(pt){return pt&&typeof Symbol=="function"&&pt.constructor===Symbol&&pt!==Symbol.prototype?"symbol":typeof pt},t(Je)}function e(Je,pt,rr){return Object.defineProperty(Je,"prototype",{writable:!1}),Je}function r(Je,pt){if(!(Je instanceof pt))throw new TypeError("Cannot call a class as a function")}var n=requireErrors(),s=n.codes,o=s.ERR_AMBIGUOUS_ARGUMENT,c=s.ERR_INVALID_ARG_TYPE,u=s.ERR_INVALID_ARG_VALUE,f=s.ERR_INVALID_RETURN_VALUE,x=s.ERR_MISSING_ARGS,p=requireAssertion_error(),g=requireUtil(),y=g.inspect,b=requireUtil().types,R=b.isPromise,D=b.isRegExp,k=requirePolyfill$2()(),Re=requirePolyfill$1()(),Fe=requireCallBound()("RegExp.prototype.test"),O,$e;function ze(){var Je=requireComparisons();O=Je.isDeepEqual,$e=Je.isDeepStrictEqual}var q=!1,W=assert$2.exports=v,We={};function Xe(Je){throw Je.message instanceof Error?Je.message:new p(Je)}function it(Je,pt,rr,cr,fr){var ir=arguments.length,ft;if(ir===0)ft="Failed";else if(ir===1)rr=Je,Je=void 0;else{if(q===!1){q=!0;var nr=process$1.emitWarning?process$1.emitWarning:console.warn.bind(console);nr("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")}ir===2&&(cr="!=")}if(rr instanceof Error)throw rr;var lr={actual:Je,expected:pt,operator:cr===void 0?"fail":cr,stackStartFn:fr||it};rr!==void 0&&(lr.message=rr);var er=new p(lr);throw ft&&(er.message=ft,er.generatedMessage=!0),er}W.fail=it,W.AssertionError=p;function Ve(Je,pt,rr,cr){if(!rr){var fr=!1;if(pt===0)fr=!0,cr="No value argument passed to `assert.ok()`";else if(cr instanceof Error)throw cr;var ir=new p({actual:rr,expected:!0,message:cr,operator:"==",stackStartFn:Je});throw ir.generatedMessage=fr,ir}}function v(){for(var Je=arguments.length,pt=new Array(Je),rr=0;rr<Je;rr++)pt[rr]=arguments[rr];Ve.apply(void 0,[v,pt.length].concat(pt))}W.ok=v,W.equal=function Je(pt,rr,cr){if(arguments.length<2)throw new x("actual","expected");pt!=rr&&Xe({actual:pt,expected:rr,message:cr,operator:"==",stackStartFn:Je})},W.notEqual=function Je(pt,rr,cr){if(arguments.length<2)throw new x("actual","expected");pt==rr&&Xe({actual:pt,expected:rr,message:cr,operator:"!=",stackStartFn:Je})},W.deepEqual=function Je(pt,rr,cr){if(arguments.length<2)throw new x("actual","expected");O===void 0&&ze(),O(pt,rr)||Xe({actual:pt,expected:rr,message:cr,operator:"deepEqual",stackStartFn:Je})},W.notDeepEqual=function Je(pt,rr,cr){if(arguments.length<2)throw new x("actual","expected");O===void 0&&ze(),O(pt,rr)&&Xe({actual:pt,expected:rr,message:cr,operator:"notDeepEqual",stackStartFn:Je})},W.deepStrictEqual=function Je(pt,rr,cr){if(arguments.length<2)throw new x("actual","expected");O===void 0&&ze(),$e(pt,rr)||Xe({actual:pt,expected:rr,message:cr,operator:"deepStrictEqual",stackStartFn:Je})},W.notDeepStrictEqual=I;function I(Je,pt,rr){if(arguments.length<2)throw new x("actual","expected");O===void 0&&ze(),$e(Je,pt)&&Xe({actual:Je,expected:pt,message:rr,operator:"notDeepStrictEqual",stackStartFn:I})}W.strictEqual=function Je(pt,rr,cr){if(arguments.length<2)throw new x("actual","expected");Re(pt,rr)||Xe({actual:pt,expected:rr,message:cr,operator:"strictEqual",stackStartFn:Je})},W.notStrictEqual=function Je(pt,rr,cr){if(arguments.length<2)throw new x("actual","expected");Re(pt,rr)&&Xe({actual:pt,expected:rr,message:cr,operator:"notStrictEqual",stackStartFn:Je})};var Ce=e(function Je(pt,rr,cr){var fr=this;r(this,Je),rr.forEach(function(ir){ir in pt&&(cr!==void 0&&typeof cr[ir]=="string"&&D(pt[ir])&&Fe(pt[ir],cr[ir])?fr[ir]=cr[ir]:fr[ir]=pt[ir])})});function P(Je,pt,rr,cr,fr,ir){if(!(rr in Je)||!$e(Je[rr],pt[rr])){if(!cr){var ft=new Ce(Je,fr),nr=new Ce(pt,fr,Je),lr=new p({actual:ft,expected:nr,operator:"deepStrictEqual",stackStartFn:ir});throw lr.actual=Je,lr.expected=pt,lr.operator=ir.name,lr}Xe({actual:Je,expected:pt,message:cr,operator:ir.name,stackStartFn:ir})}}function _e(Je,pt,rr,cr){if(typeof pt!="function"){if(D(pt))return Fe(pt,Je);if(arguments.length===2)throw new c("expected",["Function","RegExp"],pt);if(t(Je)!=="object"||Je===null){var fr=new p({actual:Je,expected:pt,message:rr,operator:"deepStrictEqual",stackStartFn:cr});throw fr.operator=cr.name,fr}var ir=Object.keys(pt);if(pt instanceof Error)ir.push("name","message");else if(ir.length===0)throw new u("error",pt,"may not be an empty object");return O===void 0&&ze(),ir.forEach(function(ft){typeof Je[ft]=="string"&&D(pt[ft])&&Fe(pt[ft],Je[ft])||P(Je,pt,ft,rr,ir,cr)}),!0}return pt.prototype!==void 0&&Je instanceof pt?!0:Error.isPrototypeOf(pt)?!1:pt.call({},Je)===!0}function Le(Je){if(typeof Je!="function")throw new c("fn","Function",Je);try{Je()}catch(pt){return pt}return We}function Ye(Je){return R(Je)||Je!==null&&t(Je)==="object"&&typeof Je.then=="function"&&typeof Je.catch=="function"}function je(Je){return Promise.resolve().then(function(){var pt;if(typeof Je=="function"){if(pt=Je(),!Ye(pt))throw new f("instance of Promise","promiseFn",pt)}else if(Ye(Je))pt=Je;else throw new c("promiseFn",["Function","Promise"],Je);return Promise.resolve().then(function(){return pt}).then(function(){return We}).catch(function(rr){return rr})})}function K(Je,pt,rr,cr){if(typeof rr=="string"){if(arguments.length===4)throw new c("error",["Object","Error","Function","RegExp"],rr);if(t(pt)==="object"&&pt!==null){if(pt.message===rr)throw new o("error/message",'The error message "'.concat(pt.message,'" is identical to the message.'))}else if(pt===rr)throw new o("error/message",'The error "'.concat(pt,'" is identical to the message.'));cr=rr,rr=void 0}else if(rr!=null&&t(rr)!=="object"&&typeof rr!="function")throw new c("error",["Object","Error","Function","RegExp"],rr);if(pt===We){var fr="";rr&&rr.name&&(fr+=" (".concat(rr.name,")")),fr+=cr?": ".concat(cr):".";var ir=Je.name==="rejects"?"rejection":"exception";Xe({actual:void 0,expected:rr,operator:Je.name,message:"Missing expected ".concat(ir).concat(fr),stackStartFn:Je})}if(rr&&!_e(pt,rr,cr,Je))throw pt}function L(Je,pt,rr,cr){if(pt!==We){if(typeof rr=="string"&&(cr=rr,rr=void 0),!rr||_e(pt,rr)){var fr=cr?": ".concat(cr):".",ir=Je.name==="doesNotReject"?"rejection":"exception";Xe({actual:pt,expected:rr,operator:Je.name,message:"Got unwanted ".concat(ir).concat(fr,`
`)+'Actual message: "'.concat(pt&&pt.message,'"'),stackStartFn:Je})}throw pt}}W.throws=function Je(pt){for(var rr=arguments.length,cr=new Array(rr>1?rr-1:0),fr=1;fr<rr;fr++)cr[fr-1]=arguments[fr];K.apply(void 0,[Je,Le(pt)].concat(cr))},W.rejects=function Je(pt){for(var rr=arguments.length,cr=new Array(rr>1?rr-1:0),fr=1;fr<rr;fr++)cr[fr-1]=arguments[fr];return je(pt).then(function(ir){return K.apply(void 0,[Je,ir].concat(cr))})},W.doesNotThrow=function Je(pt){for(var rr=arguments.length,cr=new Array(rr>1?rr-1:0),fr=1;fr<rr;fr++)cr[fr-1]=arguments[fr];L.apply(void 0,[Je,Le(pt)].concat(cr))},W.doesNotReject=function Je(pt){for(var rr=arguments.length,cr=new Array(rr>1?rr-1:0),fr=1;fr<rr;fr++)cr[fr-1]=arguments[fr];return je(pt).then(function(ir){return L.apply(void 0,[Je,ir].concat(cr))})},W.ifError=function Je(pt){if(pt!=null){var rr="ifError got unwanted exception: ";t(pt)==="object"&&typeof pt.message=="string"?pt.message.length===0&&pt.constructor?rr+=pt.constructor.name:rr+=pt.message:rr+=y(pt);var cr=new p({actual:pt,expected:null,operator:"ifError",message:rr,stackStartFn:Je}),fr=pt.stack;if(typeof fr=="string"){var ir=fr.split(`
`);ir.shift();for(var ft=cr.stack.split(`
`),nr=0;nr<ir.length;nr++){var lr=ft.indexOf(ir[nr]);if(lr!==-1){ft=ft.slice(0,lr);break}}cr.stack="".concat(ft.join(`
`),`
`).concat(ir.join(`
`))}throw cr}};function st(Je,pt,rr,cr,fr){if(!D(pt))throw new c("regexp","RegExp",pt);var ir=fr==="match";if(typeof Je!="string"||Fe(pt,Je)!==ir){if(rr instanceof Error)throw rr;var ft=!rr;rr=rr||(typeof Je!="string"?'The "string" argument must be of type string. Received type '+"".concat(t(Je)," (").concat(y(Je),")"):(ir?"The input did not match the regular expression ":"The input was expected to not match the regular expression ")+"".concat(y(pt),`. Input:

`).concat(y(Je),`
`));var nr=new p({actual:Je,expected:pt,message:rr,operator:fr,stackStartFn:cr});throw nr.generatedMessage=ft,nr}}W.match=function Je(pt,rr,cr){st(pt,rr,cr,Je,"match")},W.doesNotMatch=function Je(pt,rr,cr){st(pt,rr,cr,Je,"doesNotMatch")};function dt(){for(var Je=arguments.length,pt=new Array(Je),rr=0;rr<Je;rr++)pt[rr]=arguments[rr];Ve.apply(void 0,[dt,pt.length].concat(pt))}return W.strict=k(dt,W,{equal:W.strictEqual,deepEqual:W.deepStrictEqual,notEqual:W.notStrictEqual,notDeepEqual:W.notDeepStrictEqual}),W.strict.strict=W.strict,assert$2.exports}var fountainUtils={},xoshiro={},bignumber$1={exports:{}},bignumber=bignumber$1.exports,hasRequiredBignumber;function requireBignumber(){return hasRequiredBignumber||(hasRequiredBignumber=1,(function(t){(function(e){var r,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,s=Math.ceil,o=Math.floor,c="[BigNumber Error] ",u=c+"Number primitive has more than 15 significant digits: ",f=1e14,x=14,p=9007199254740991,g=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],y=1e7,b=1e9;function R(q){var W,We,Xe,it=Je.prototype={constructor:Je,toString:null,valueOf:null},Ve=new Je(1),v=20,I=4,Ce=-7,P=21,_e=-1e7,Le=1e7,Ye=!1,je=1,K=0,L={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},st="0123456789abcdefghijklmnopqrstuvwxyz",dt=!0;function Je(ft,nr){var lr,er,pr,Er,xr,wr,Br,hr,Cr=this;if(!(Cr instanceof Je))return new Je(ft,nr);if(nr==null){if(ft&&ft._isBigNumber===!0){Cr.s=ft.s,!ft.c||ft.e>Le?Cr.c=Cr.e=null:ft.e<_e?Cr.c=[Cr.e=0]:(Cr.e=ft.e,Cr.c=ft.c.slice());return}if((wr=typeof ft=="number")&&ft*0==0){if(Cr.s=1/ft<0?(ft=-ft,-1):1,ft===~~ft){for(Er=0,xr=ft;xr>=10;xr/=10,Er++);Er>Le?Cr.c=Cr.e=null:(Cr.e=Er,Cr.c=[ft]);return}hr=String(ft)}else{if(!n.test(hr=String(ft)))return Xe(Cr,hr,wr);Cr.s=hr.charCodeAt(0)==45?(hr=hr.slice(1),-1):1}(Er=hr.indexOf("."))>-1&&(hr=hr.replace(".","")),(xr=hr.search(/e/i))>0?(Er<0&&(Er=xr),Er+=+hr.slice(xr+1),hr=hr.substring(0,xr)):Er<0&&(Er=hr.length)}else{if(Fe(nr,2,st.length,"Base"),nr==10&&dt)return Cr=new Je(ft),fr(Cr,v+Cr.e+1,I);if(hr=String(ft),wr=typeof ft=="number"){if(ft*0!=0)return Xe(Cr,hr,wr,nr);if(Cr.s=1/ft<0?(hr=hr.slice(1),-1):1,Je.DEBUG&&hr.replace(/^0\.0*|\./,"").length>15)throw Error(u+ft)}else Cr.s=hr.charCodeAt(0)===45?(hr=hr.slice(1),-1):1;for(lr=st.slice(0,nr),Er=xr=0,Br=hr.length;xr<Br;xr++)if(lr.indexOf(er=hr.charAt(xr))<0){if(er=="."){if(xr>Er){Er=Br;continue}}else if(!pr&&(hr==hr.toUpperCase()&&(hr=hr.toLowerCase())||hr==hr.toLowerCase()&&(hr=hr.toUpperCase()))){pr=!0,xr=-1,Er=0;continue}return Xe(Cr,String(ft),wr,nr)}wr=!1,hr=We(hr,nr,10,Cr.s),(Er=hr.indexOf("."))>-1?hr=hr.replace(".",""):Er=hr.length}for(xr=0;hr.charCodeAt(xr)===48;xr++);for(Br=hr.length;hr.charCodeAt(--Br)===48;);if(hr=hr.slice(xr,++Br)){if(Br-=xr,wr&&Je.DEBUG&&Br>15&&(ft>p||ft!==o(ft)))throw Error(u+Cr.s*ft);if((Er=Er-xr-1)>Le)Cr.c=Cr.e=null;else if(Er<_e)Cr.c=[Cr.e=0];else{if(Cr.e=Er,Cr.c=[],xr=(Er+1)%x,Er<0&&(xr+=x),xr<Br){for(xr&&Cr.c.push(+hr.slice(0,xr)),Br-=x;xr<Br;)Cr.c.push(+hr.slice(xr,xr+=x));xr=x-(hr=hr.slice(xr)).length}else xr-=Br;for(;xr--;hr+="0");Cr.c.push(+hr)}}else Cr.c=[Cr.e=0]}Je.clone=R,Je.ROUND_UP=0,Je.ROUND_DOWN=1,Je.ROUND_CEIL=2,Je.ROUND_FLOOR=3,Je.ROUND_HALF_UP=4,Je.ROUND_HALF_DOWN=5,Je.ROUND_HALF_EVEN=6,Je.ROUND_HALF_CEIL=7,Je.ROUND_HALF_FLOOR=8,Je.EUCLID=9,Je.config=Je.set=function(ft){var nr,lr;if(ft!=null)if(typeof ft=="object"){if(ft.hasOwnProperty(nr="DECIMAL_PLACES")&&(lr=ft[nr],Fe(lr,0,b,nr),v=lr),ft.hasOwnProperty(nr="ROUNDING_MODE")&&(lr=ft[nr],Fe(lr,0,8,nr),I=lr),ft.hasOwnProperty(nr="EXPONENTIAL_AT")&&(lr=ft[nr],lr&&lr.pop?(Fe(lr[0],-b,0,nr),Fe(lr[1],0,b,nr),Ce=lr[0],P=lr[1]):(Fe(lr,-b,b,nr),Ce=-(P=lr<0?-lr:lr))),ft.hasOwnProperty(nr="RANGE"))if(lr=ft[nr],lr&&lr.pop)Fe(lr[0],-b,-1,nr),Fe(lr[1],1,b,nr),_e=lr[0],Le=lr[1];else if(Fe(lr,-b,b,nr),lr)_e=-(Le=lr<0?-lr:lr);else throw Error(c+nr+" cannot be zero: "+lr);if(ft.hasOwnProperty(nr="CRYPTO"))if(lr=ft[nr],lr===!!lr)if(lr)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))Ye=lr;else throw Ye=!lr,Error(c+"crypto unavailable");else Ye=lr;else throw Error(c+nr+" not true or false: "+lr);if(ft.hasOwnProperty(nr="MODULO_MODE")&&(lr=ft[nr],Fe(lr,0,9,nr),je=lr),ft.hasOwnProperty(nr="POW_PRECISION")&&(lr=ft[nr],Fe(lr,0,b,nr),K=lr),ft.hasOwnProperty(nr="FORMAT"))if(lr=ft[nr],typeof lr=="object")L=lr;else throw Error(c+nr+" not an object: "+lr);if(ft.hasOwnProperty(nr="ALPHABET"))if(lr=ft[nr],typeof lr=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(lr))dt=lr.slice(0,10)=="0123456789",st=lr;else throw Error(c+nr+" invalid: "+lr)}else throw Error(c+"Object expected: "+ft);return{DECIMAL_PLACES:v,ROUNDING_MODE:I,EXPONENTIAL_AT:[Ce,P],RANGE:[_e,Le],CRYPTO:Ye,MODULO_MODE:je,POW_PRECISION:K,FORMAT:L,ALPHABET:st}},Je.isBigNumber=function(ft){if(!ft||ft._isBigNumber!==!0)return!1;if(!Je.DEBUG)return!0;var nr,lr,er=ft.c,pr=ft.e,Er=ft.s;e:if({}.toString.call(er)=="[object Array]"){if((Er===1||Er===-1)&&pr>=-b&&pr<=b&&pr===o(pr)){if(er[0]===0){if(pr===0&&er.length===1)return!0;break e}if(nr=(pr+1)%x,nr<1&&(nr+=x),String(er[0]).length==nr){for(nr=0;nr<er.length;nr++)if(lr=er[nr],lr<0||lr>=f||lr!==o(lr))break e;if(lr!==0)return!0}}}else if(er===null&&pr===null&&(Er===null||Er===1||Er===-1))return!0;throw Error(c+"Invalid BigNumber: "+ft)},Je.maximum=Je.max=function(){return rr(arguments,-1)},Je.minimum=Je.min=function(){return rr(arguments,1)},Je.random=(function(){var ft=9007199254740992,nr=Math.random()*ft&2097151?function(){return o(Math.random()*ft)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(lr){var er,pr,Er,xr,wr,Br=0,hr=[],Cr=new Je(Ve);if(lr==null?lr=v:Fe(lr,0,b),xr=s(lr/x),Ye)if(crypto.getRandomValues){for(er=crypto.getRandomValues(new Uint32Array(xr*=2));Br<xr;)wr=er[Br]*131072+(er[Br+1]>>>11),wr>=9e15?(pr=crypto.getRandomValues(new Uint32Array(2)),er[Br]=pr[0],er[Br+1]=pr[1]):(hr.push(wr%1e14),Br+=2);Br=xr/2}else if(crypto.randomBytes){for(er=crypto.randomBytes(xr*=7);Br<xr;)wr=(er[Br]&31)*281474976710656+er[Br+1]*1099511627776+er[Br+2]*4294967296+er[Br+3]*16777216+(er[Br+4]<<16)+(er[Br+5]<<8)+er[Br+6],wr>=9e15?crypto.randomBytes(7).copy(er,Br):(hr.push(wr%1e14),Br+=7);Br=xr/7}else throw Ye=!1,Error(c+"crypto unavailable");if(!Ye)for(;Br<xr;)wr=nr(),wr<9e15&&(hr[Br++]=wr%1e14);for(xr=hr[--Br],lr%=x,xr&&lr&&(wr=g[x-lr],hr[Br]=o(xr/wr)*wr);hr[Br]===0;hr.pop(),Br--);if(Br<0)hr=[Er=0];else{for(Er=-1;hr[0]===0;hr.splice(0,1),Er-=x);for(Br=1,wr=hr[0];wr>=10;wr/=10,Br++);Br<x&&(Er-=x-Br)}return Cr.e=Er,Cr.c=hr,Cr}})(),Je.sum=function(){for(var ft=1,nr=arguments,lr=new Je(nr[0]);ft<nr.length;)lr=lr.plus(nr[ft++]);return lr},We=(function(){var ft="0123456789";function nr(lr,er,pr,Er){for(var xr,wr=[0],Br,hr=0,Cr=lr.length;hr<Cr;){for(Br=wr.length;Br--;wr[Br]*=er);for(wr[0]+=Er.indexOf(lr.charAt(hr++)),xr=0;xr<wr.length;xr++)wr[xr]>pr-1&&(wr[xr+1]==null&&(wr[xr+1]=0),wr[xr+1]+=wr[xr]/pr|0,wr[xr]%=pr)}return wr.reverse()}return function(lr,er,pr,Er,xr){var wr,Br,hr,Cr,_r,Tr,Nr,or,tr=lr.indexOf("."),yr=v,mr=I;for(tr>=0&&(Cr=K,K=0,lr=lr.replace(".",""),or=new Je(er),Tr=or.pow(lr.length-tr),K=Cr,or.c=nr(ze(k(Tr.c),Tr.e,"0"),10,pr,ft),or.e=or.c.length),Nr=nr(lr,er,pr,xr?(wr=st,ft):(wr=ft,st)),hr=Cr=Nr.length;Nr[--Cr]==0;Nr.pop());if(!Nr[0])return wr.charAt(0);if(tr<0?--hr:(Tr.c=Nr,Tr.e=hr,Tr.s=Er,Tr=W(Tr,or,yr,mr,pr),Nr=Tr.c,_r=Tr.r,hr=Tr.e),Br=hr+yr+1,tr=Nr[Br],Cr=pr/2,_r=_r||Br<0||Nr[Br+1]!=null,_r=mr<4?(tr!=null||_r)&&(mr==0||mr==(Tr.s<0?3:2)):tr>Cr||tr==Cr&&(mr==4||_r||mr==6&&Nr[Br-1]&1||mr==(Tr.s<0?8:7)),Br<1||!Nr[0])lr=_r?ze(wr.charAt(1),-yr,wr.charAt(0)):wr.charAt(0);else{if(Nr.length=Br,_r)for(--pr;++Nr[--Br]>pr;)Nr[Br]=0,Br||(++hr,Nr=[1].concat(Nr));for(Cr=Nr.length;!Nr[--Cr];);for(tr=0,lr="";tr<=Cr;lr+=wr.charAt(Nr[tr++]));lr=ze(lr,hr,wr.charAt(0))}return lr}})(),W=(function(){function ft(er,pr,Er){var xr,wr,Br,hr,Cr=0,_r=er.length,Tr=pr%y,Nr=pr/y|0;for(er=er.slice();_r--;)Br=er[_r]%y,hr=er[_r]/y|0,xr=Nr*Br+hr*Tr,wr=Tr*Br+xr%y*y+Cr,Cr=(wr/Er|0)+(xr/y|0)+Nr*hr,er[_r]=wr%Er;return Cr&&(er=[Cr].concat(er)),er}function nr(er,pr,Er,xr){var wr,Br;if(Er!=xr)Br=Er>xr?1:-1;else for(wr=Br=0;wr<Er;wr++)if(er[wr]!=pr[wr]){Br=er[wr]>pr[wr]?1:-1;break}return Br}function lr(er,pr,Er,xr){for(var wr=0;Er--;)er[Er]-=wr,wr=er[Er]<pr[Er]?1:0,er[Er]=wr*xr+er[Er]-pr[Er];for(;!er[0]&&er.length>1;er.splice(0,1));}return function(er,pr,Er,xr,wr){var Br,hr,Cr,_r,Tr,Nr,or,tr,yr,mr,sr,Ar,ht,Qe,lt,ar,br,Sr=er.s==pr.s?1:-1,Rr=er.c,Lr=pr.c;if(!Rr||!Rr[0]||!Lr||!Lr[0])return new Je(!er.s||!pr.s||(Rr?Lr&&Rr[0]==Lr[0]:!Lr)?NaN:Rr&&Rr[0]==0||!Lr?Sr*0:Sr/0);for(tr=new Je(Sr),yr=tr.c=[],hr=er.e-pr.e,Sr=Er+hr+1,wr||(wr=f,hr=D(er.e/x)-D(pr.e/x),Sr=Sr/x|0),Cr=0;Lr[Cr]==(Rr[Cr]||0);Cr++);if(Lr[Cr]>(Rr[Cr]||0)&&hr--,Sr<0)yr.push(1),_r=!0;else{for(Qe=Rr.length,ar=Lr.length,Cr=0,Sr+=2,Tr=o(wr/(Lr[0]+1)),Tr>1&&(Lr=ft(Lr,Tr,wr),Rr=ft(Rr,Tr,wr),ar=Lr.length,Qe=Rr.length),ht=ar,mr=Rr.slice(0,ar),sr=mr.length;sr<ar;mr[sr++]=0);br=Lr.slice(),br=[0].concat(br),lt=Lr[0],Lr[1]>=wr/2&&lt++;do{if(Tr=0,Br=nr(Lr,mr,ar,sr),Br<0){if(Ar=mr[0],ar!=sr&&(Ar=Ar*wr+(mr[1]||0)),Tr=o(Ar/lt),Tr>1)for(Tr>=wr&&(Tr=wr-1),Nr=ft(Lr,Tr,wr),or=Nr.length,sr=mr.length;nr(Nr,mr,or,sr)==1;)Tr--,lr(Nr,ar<or?br:Lr,or,wr),or=Nr.length,Br=1;else Tr==0&&(Br=Tr=1),Nr=Lr.slice(),or=Nr.length;if(or<sr&&(Nr=[0].concat(Nr)),lr(mr,Nr,sr,wr),sr=mr.length,Br==-1)for(;nr(Lr,mr,ar,sr)<1;)Tr++,lr(mr,ar<sr?br:Lr,sr,wr),sr=mr.length}else Br===0&&(Tr++,mr=[0]);yr[Cr++]=Tr,mr[0]?mr[sr++]=Rr[ht]||0:(mr=[Rr[ht]],sr=1)}while((ht++<Qe||mr[0]!=null)&&Sr--);_r=mr[0]!=null,yr[0]||yr.splice(0,1)}if(wr==f){for(Cr=1,Sr=yr[0];Sr>=10;Sr/=10,Cr++);fr(tr,Er+(tr.e=Cr+hr*x-1)+1,xr,_r)}else tr.e=hr,tr.r=+_r;return tr}})();function pt(ft,nr,lr,er){var pr,Er,xr,wr,Br;if(lr==null?lr=I:Fe(lr,0,8),!ft.c)return ft.toString();if(pr=ft.c[0],xr=ft.e,nr==null)Br=k(ft.c),Br=er==1||er==2&&(xr<=Ce||xr>=P)?$e(Br,xr):ze(Br,xr,"0");else if(ft=fr(new Je(ft),nr,lr),Er=ft.e,Br=k(ft.c),wr=Br.length,er==1||er==2&&(nr<=Er||Er<=Ce)){for(;wr<nr;Br+="0",wr++);Br=$e(Br,Er)}else if(nr-=xr+(er===2&&Er>xr),Br=ze(Br,Er,"0"),Er+1>wr){if(--nr>0)for(Br+=".";nr--;Br+="0");}else if(nr+=Er-wr,nr>0)for(Er+1==wr&&(Br+=".");nr--;Br+="0");return ft.s<0&&pr?"-"+Br:Br}function rr(ft,nr){for(var lr,er,pr=1,Er=new Je(ft[0]);pr<ft.length;pr++)er=new Je(ft[pr]),(!er.s||(lr=Re(Er,er))===nr||lr===0&&Er.s===nr)&&(Er=er);return Er}function cr(ft,nr,lr){for(var er=1,pr=nr.length;!nr[--pr];nr.pop());for(pr=nr[0];pr>=10;pr/=10,er++);return(lr=er+lr*x-1)>Le?ft.c=ft.e=null:lr<_e?ft.c=[ft.e=0]:(ft.e=lr,ft.c=nr),ft}Xe=(function(){var ft=/^(-?)0([xbo])(?=\w[\w.]*$)/i,nr=/^([^.]+)\.$/,lr=/^\.([^.]+)$/,er=/^-?(Infinity|NaN)$/,pr=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(Er,xr,wr,Br){var hr,Cr=wr?xr:xr.replace(pr,"");if(er.test(Cr))Er.s=isNaN(Cr)?null:Cr<0?-1:1;else{if(!wr&&(Cr=Cr.replace(ft,function(_r,Tr,Nr){return hr=(Nr=Nr.toLowerCase())=="x"?16:Nr=="b"?2:8,!Br||Br==hr?Tr:_r}),Br&&(hr=Br,Cr=Cr.replace(nr,"$1").replace(lr,"0.$1")),xr!=Cr))return new Je(Cr,hr);if(Je.DEBUG)throw Error(c+"Not a"+(Br?" base "+Br:"")+" number: "+xr);Er.s=null}Er.c=Er.e=null}})();function fr(ft,nr,lr,er){var pr,Er,xr,wr,Br,hr,Cr,_r=ft.c,Tr=g;if(_r){e:{for(pr=1,wr=_r[0];wr>=10;wr/=10,pr++);if(Er=nr-pr,Er<0)Er+=x,xr=nr,Br=_r[hr=0],Cr=o(Br/Tr[pr-xr-1]%10);else if(hr=s((Er+1)/x),hr>=_r.length)if(er){for(;_r.length<=hr;_r.push(0));Br=Cr=0,pr=1,Er%=x,xr=Er-x+1}else break e;else{for(Br=wr=_r[hr],pr=1;wr>=10;wr/=10,pr++);Er%=x,xr=Er-x+pr,Cr=xr<0?0:o(Br/Tr[pr-xr-1]%10)}if(er=er||nr<0||_r[hr+1]!=null||(xr<0?Br:Br%Tr[pr-xr-1]),er=lr<4?(Cr||er)&&(lr==0||lr==(ft.s<0?3:2)):Cr>5||Cr==5&&(lr==4||er||lr==6&&(Er>0?xr>0?Br/Tr[pr-xr]:0:_r[hr-1])%10&1||lr==(ft.s<0?8:7)),nr<1||!_r[0])return _r.length=0,er?(nr-=ft.e+1,_r[0]=Tr[(x-nr%x)%x],ft.e=-nr||0):_r[0]=ft.e=0,ft;if(Er==0?(_r.length=hr,wr=1,hr--):(_r.length=hr+1,wr=Tr[x-Er],_r[hr]=xr>0?o(Br/Tr[pr-xr]%Tr[xr])*wr:0),er)for(;;)if(hr==0){for(Er=1,xr=_r[0];xr>=10;xr/=10,Er++);for(xr=_r[0]+=wr,wr=1;xr>=10;xr/=10,wr++);Er!=wr&&(ft.e++,_r[0]==f&&(_r[0]=1));break}else{if(_r[hr]+=wr,_r[hr]!=f)break;_r[hr--]=0,wr=1}for(Er=_r.length;_r[--Er]===0;_r.pop());}ft.e>Le?ft.c=ft.e=null:ft.e<_e&&(ft.c=[ft.e=0])}return ft}function ir(ft){var nr,lr=ft.e;return lr===null?ft.toString():(nr=k(ft.c),nr=lr<=Ce||lr>=P?$e(nr,lr):ze(nr,lr,"0"),ft.s<0?"-"+nr:nr)}return it.absoluteValue=it.abs=function(){var ft=new Je(this);return ft.s<0&&(ft.s=1),ft},it.comparedTo=function(ft,nr){return Re(this,new Je(ft,nr))},it.decimalPlaces=it.dp=function(ft,nr){var lr,er,pr,Er=this;if(ft!=null)return Fe(ft,0,b),nr==null?nr=I:Fe(nr,0,8),fr(new Je(Er),ft+Er.e+1,nr);if(!(lr=Er.c))return null;if(er=((pr=lr.length-1)-D(this.e/x))*x,pr=lr[pr])for(;pr%10==0;pr/=10,er--);return er<0&&(er=0),er},it.dividedBy=it.div=function(ft,nr){return W(this,new Je(ft,nr),v,I)},it.dividedToIntegerBy=it.idiv=function(ft,nr){return W(this,new Je(ft,nr),0,1)},it.exponentiatedBy=it.pow=function(ft,nr){var lr,er,pr,Er,xr,wr,Br,hr,Cr,_r=this;if(ft=new Je(ft),ft.c&&!ft.isInteger())throw Error(c+"Exponent not an integer: "+ir(ft));if(nr!=null&&(nr=new Je(nr)),wr=ft.e>14,!_r.c||!_r.c[0]||_r.c[0]==1&&!_r.e&&_r.c.length==1||!ft.c||!ft.c[0])return Cr=new Je(Math.pow(+ir(_r),wr?ft.s*(2-O(ft)):+ir(ft))),nr?Cr.mod(nr):Cr;if(Br=ft.s<0,nr){if(nr.c?!nr.c[0]:!nr.s)return new Je(NaN);er=!Br&&_r.isInteger()&&nr.isInteger(),er&&(_r=_r.mod(nr))}else{if(ft.e>9&&(_r.e>0||_r.e<-1||(_r.e==0?_r.c[0]>1||wr&&_r.c[1]>=24e7:_r.c[0]<8e13||wr&&_r.c[0]<=9999975e7)))return Er=_r.s<0&&O(ft)?-0:0,_r.e>-1&&(Er=1/Er),new Je(Br?1/Er:Er);K&&(Er=s(K/x+2))}for(wr?(lr=new Je(.5),Br&&(ft.s=1),hr=O(ft)):(pr=Math.abs(+ir(ft)),hr=pr%2),Cr=new Je(Ve);;){if(hr){if(Cr=Cr.times(_r),!Cr.c)break;Er?Cr.c.length>Er&&(Cr.c.length=Er):er&&(Cr=Cr.mod(nr))}if(pr){if(pr=o(pr/2),pr===0)break;hr=pr%2}else if(ft=ft.times(lr),fr(ft,ft.e+1,1),ft.e>14)hr=O(ft);else{if(pr=+ir(ft),pr===0)break;hr=pr%2}_r=_r.times(_r),Er?_r.c&&_r.c.length>Er&&(_r.c.length=Er):er&&(_r=_r.mod(nr))}return er?Cr:(Br&&(Cr=Ve.div(Cr)),nr?Cr.mod(nr):Er?fr(Cr,K,I,xr):Cr)},it.integerValue=function(ft){var nr=new Je(this);return ft==null?ft=I:Fe(ft,0,8),fr(nr,nr.e+1,ft)},it.isEqualTo=it.eq=function(ft,nr){return Re(this,new Je(ft,nr))===0},it.isFinite=function(){return!!this.c},it.isGreaterThan=it.gt=function(ft,nr){return Re(this,new Je(ft,nr))>0},it.isGreaterThanOrEqualTo=it.gte=function(ft,nr){return(nr=Re(this,new Je(ft,nr)))===1||nr===0},it.isInteger=function(){return!!this.c&&D(this.e/x)>this.c.length-2},it.isLessThan=it.lt=function(ft,nr){return Re(this,new Je(ft,nr))<0},it.isLessThanOrEqualTo=it.lte=function(ft,nr){return(nr=Re(this,new Je(ft,nr)))===-1||nr===0},it.isNaN=function(){return!this.s},it.isNegative=function(){return this.s<0},it.isPositive=function(){return this.s>0},it.isZero=function(){return!!this.c&&this.c[0]==0},it.minus=function(ft,nr){var lr,er,pr,Er,xr=this,wr=xr.s;if(ft=new Je(ft,nr),nr=ft.s,!wr||!nr)return new Je(NaN);if(wr!=nr)return ft.s=-nr,xr.plus(ft);var Br=xr.e/x,hr=ft.e/x,Cr=xr.c,_r=ft.c;if(!Br||!hr){if(!Cr||!_r)return Cr?(ft.s=-nr,ft):new Je(_r?xr:NaN);if(!Cr[0]||!_r[0])return _r[0]?(ft.s=-nr,ft):new Je(Cr[0]?xr:I==3?-0:0)}if(Br=D(Br),hr=D(hr),Cr=Cr.slice(),wr=Br-hr){for((Er=wr<0)?(wr=-wr,pr=Cr):(hr=Br,pr=_r),pr.reverse(),nr=wr;nr--;pr.push(0));pr.reverse()}else for(er=(Er=(wr=Cr.length)<(nr=_r.length))?wr:nr,wr=nr=0;nr<er;nr++)if(Cr[nr]!=_r[nr]){Er=Cr[nr]<_r[nr];break}if(Er&&(pr=Cr,Cr=_r,_r=pr,ft.s=-ft.s),nr=(er=_r.length)-(lr=Cr.length),nr>0)for(;nr--;Cr[lr++]=0);for(nr=f-1;er>wr;){if(Cr[--er]<_r[er]){for(lr=er;lr&&!Cr[--lr];Cr[lr]=nr);--Cr[lr],Cr[er]+=f}Cr[er]-=_r[er]}for(;Cr[0]==0;Cr.splice(0,1),--hr);return Cr[0]?cr(ft,Cr,hr):(ft.s=I==3?-1:1,ft.c=[ft.e=0],ft)},it.modulo=it.mod=function(ft,nr){var lr,er,pr=this;return ft=new Je(ft,nr),!pr.c||!ft.s||ft.c&&!ft.c[0]?new Je(NaN):!ft.c||pr.c&&!pr.c[0]?new Je(pr):(je==9?(er=ft.s,ft.s=1,lr=W(pr,ft,0,3),ft.s=er,lr.s*=er):lr=W(pr,ft,0,je),ft=pr.minus(lr.times(ft)),!ft.c[0]&&je==1&&(ft.s=pr.s),ft)},it.multipliedBy=it.times=function(ft,nr){var lr,er,pr,Er,xr,wr,Br,hr,Cr,_r,Tr,Nr,or,tr,yr,mr=this,sr=mr.c,Ar=(ft=new Je(ft,nr)).c;if(!sr||!Ar||!sr[0]||!Ar[0])return!mr.s||!ft.s||sr&&!sr[0]&&!Ar||Ar&&!Ar[0]&&!sr?ft.c=ft.e=ft.s=null:(ft.s*=mr.s,!sr||!Ar?ft.c=ft.e=null:(ft.c=[0],ft.e=0)),ft;for(er=D(mr.e/x)+D(ft.e/x),ft.s*=mr.s,Br=sr.length,_r=Ar.length,Br<_r&&(or=sr,sr=Ar,Ar=or,pr=Br,Br=_r,_r=pr),pr=Br+_r,or=[];pr--;or.push(0));for(tr=f,yr=y,pr=_r;--pr>=0;){for(lr=0,Tr=Ar[pr]%yr,Nr=Ar[pr]/yr|0,xr=Br,Er=pr+xr;Er>pr;)hr=sr[--xr]%yr,Cr=sr[xr]/yr|0,wr=Nr*hr+Cr*Tr,hr=Tr*hr+wr%yr*yr+or[Er]+lr,lr=(hr/tr|0)+(wr/yr|0)+Nr*Cr,or[Er--]=hr%tr;or[Er]=lr}return lr?++er:or.splice(0,1),cr(ft,or,er)},it.negated=function(){var ft=new Je(this);return ft.s=-ft.s||null,ft},it.plus=function(ft,nr){var lr,er=this,pr=er.s;if(ft=new Je(ft,nr),nr=ft.s,!pr||!nr)return new Je(NaN);if(pr!=nr)return ft.s=-nr,er.minus(ft);var Er=er.e/x,xr=ft.e/x,wr=er.c,Br=ft.c;if(!Er||!xr){if(!wr||!Br)return new Je(pr/0);if(!wr[0]||!Br[0])return Br[0]?ft:new Je(wr[0]?er:pr*0)}if(Er=D(Er),xr=D(xr),wr=wr.slice(),pr=Er-xr){for(pr>0?(xr=Er,lr=Br):(pr=-pr,lr=wr),lr.reverse();pr--;lr.push(0));lr.reverse()}for(pr=wr.length,nr=Br.length,pr-nr<0&&(lr=Br,Br=wr,wr=lr,nr=pr),pr=0;nr;)pr=(wr[--nr]=wr[nr]+Br[nr]+pr)/f|0,wr[nr]=f===wr[nr]?0:wr[nr]%f;return pr&&(wr=[pr].concat(wr),++xr),cr(ft,wr,xr)},it.precision=it.sd=function(ft,nr){var lr,er,pr,Er=this;if(ft!=null&&ft!==!!ft)return Fe(ft,1,b),nr==null?nr=I:Fe(nr,0,8),fr(new Je(Er),ft,nr);if(!(lr=Er.c))return null;if(pr=lr.length-1,er=pr*x+1,pr=lr[pr]){for(;pr%10==0;pr/=10,er--);for(pr=lr[0];pr>=10;pr/=10,er++);}return ft&&Er.e+1>er&&(er=Er.e+1),er},it.shiftedBy=function(ft){return Fe(ft,-p,p),this.times("1e"+ft)},it.squareRoot=it.sqrt=function(){var ft,nr,lr,er,pr,Er=this,xr=Er.c,wr=Er.s,Br=Er.e,hr=v+4,Cr=new Je("0.5");if(wr!==1||!xr||!xr[0])return new Je(!wr||wr<0&&(!xr||xr[0])?NaN:xr?Er:1/0);if(wr=Math.sqrt(+ir(Er)),wr==0||wr==1/0?(nr=k(xr),(nr.length+Br)%2==0&&(nr+="0"),wr=Math.sqrt(+nr),Br=D((Br+1)/2)-(Br<0||Br%2),wr==1/0?nr="5e"+Br:(nr=wr.toExponential(),nr=nr.slice(0,nr.indexOf("e")+1)+Br),lr=new Je(nr)):lr=new Je(wr+""),lr.c[0]){for(Br=lr.e,wr=Br+hr,wr<3&&(wr=0);;)if(pr=lr,lr=Cr.times(pr.plus(W(Er,pr,hr,1))),k(pr.c).slice(0,wr)===(nr=k(lr.c)).slice(0,wr))if(lr.e<Br&&--wr,nr=nr.slice(wr-3,wr+1),nr=="9999"||!er&&nr=="4999"){if(!er&&(fr(pr,pr.e+v+2,0),pr.times(pr).eq(Er))){lr=pr;break}hr+=4,wr+=4,er=1}else{(!+nr||!+nr.slice(1)&&nr.charAt(0)=="5")&&(fr(lr,lr.e+v+2,1),ft=!lr.times(lr).eq(Er));break}}return fr(lr,lr.e+v+1,I,ft)},it.toExponential=function(ft,nr){return ft!=null&&(Fe(ft,0,b),ft++),pt(this,ft,nr,1)},it.toFixed=function(ft,nr){return ft!=null&&(Fe(ft,0,b),ft=ft+this.e+1),pt(this,ft,nr)},it.toFormat=function(ft,nr,lr){var er,pr=this;if(lr==null)ft!=null&&nr&&typeof nr=="object"?(lr=nr,nr=null):ft&&typeof ft=="object"?(lr=ft,ft=nr=null):lr=L;else if(typeof lr!="object")throw Error(c+"Argument not an object: "+lr);if(er=pr.toFixed(ft,nr),pr.c){var Er,xr=er.split("."),wr=+lr.groupSize,Br=+lr.secondaryGroupSize,hr=lr.groupSeparator||"",Cr=xr[0],_r=xr[1],Tr=pr.s<0,Nr=Tr?Cr.slice(1):Cr,or=Nr.length;if(Br&&(Er=wr,wr=Br,Br=Er,or-=Er),wr>0&&or>0){for(Er=or%wr||wr,Cr=Nr.substr(0,Er);Er<or;Er+=wr)Cr+=hr+Nr.substr(Er,wr);Br>0&&(Cr+=hr+Nr.slice(Er)),Tr&&(Cr="-"+Cr)}er=_r?Cr+(lr.decimalSeparator||"")+((Br=+lr.fractionGroupSize)?_r.replace(new RegExp("\\d{"+Br+"}\\B","g"),"$&"+(lr.fractionGroupSeparator||"")):_r):Cr}return(lr.prefix||"")+er+(lr.suffix||"")},it.toFraction=function(ft){var nr,lr,er,pr,Er,xr,wr,Br,hr,Cr,_r,Tr,Nr=this,or=Nr.c;if(ft!=null&&(wr=new Je(ft),!wr.isInteger()&&(wr.c||wr.s!==1)||wr.lt(Ve)))throw Error(c+"Argument "+(wr.isInteger()?"out of range: ":"not an integer: ")+ir(wr));if(!or)return new Je(Nr);for(nr=new Je(Ve),hr=lr=new Je(Ve),er=Br=new Je(Ve),Tr=k(or),Er=nr.e=Tr.length-Nr.e-1,nr.c[0]=g[(xr=Er%x)<0?x+xr:xr],ft=!ft||wr.comparedTo(nr)>0?Er>0?nr:hr:wr,xr=Le,Le=1/0,wr=new Je(Tr),Br.c[0]=0;Cr=W(wr,nr,0,1),pr=lr.plus(Cr.times(er)),pr.comparedTo(ft)!=1;)lr=er,er=pr,hr=Br.plus(Cr.times(pr=hr)),Br=pr,nr=wr.minus(Cr.times(pr=nr)),wr=pr;return pr=W(ft.minus(lr),er,0,1),Br=Br.plus(pr.times(hr)),lr=lr.plus(pr.times(er)),Br.s=hr.s=Nr.s,Er=Er*2,_r=W(hr,er,Er,I).minus(Nr).abs().comparedTo(W(Br,lr,Er,I).minus(Nr).abs())<1?[hr,er]:[Br,lr],Le=xr,_r},it.toNumber=function(){return+ir(this)},it.toPrecision=function(ft,nr){return ft!=null&&Fe(ft,1,b),pt(this,ft,nr,2)},it.toString=function(ft){var nr,lr=this,er=lr.s,pr=lr.e;return pr===null?er?(nr="Infinity",er<0&&(nr="-"+nr)):nr="NaN":(ft==null?nr=pr<=Ce||pr>=P?$e(k(lr.c),pr):ze(k(lr.c),pr,"0"):ft===10&&dt?(lr=fr(new Je(lr),v+pr+1,I),nr=ze(k(lr.c),lr.e,"0")):(Fe(ft,2,st.length,"Base"),nr=We(ze(k(lr.c),pr,"0"),10,ft,er,!0)),er<0&&lr.c[0]&&(nr="-"+nr)),nr},it.valueOf=it.toJSON=function(){return ir(this)},it._isBigNumber=!0,q!=null&&Je.set(q),Je}function D(q){var W=q|0;return q>0||q===W?W:W-1}function k(q){for(var W,We,Xe=1,it=q.length,Ve=q[0]+"";Xe<it;){for(W=q[Xe++]+"",We=x-W.length;We--;W="0"+W);Ve+=W}for(it=Ve.length;Ve.charCodeAt(--it)===48;);return Ve.slice(0,it+1||1)}function Re(q,W){var We,Xe,it=q.c,Ve=W.c,v=q.s,I=W.s,Ce=q.e,P=W.e;if(!v||!I)return null;if(We=it&&!it[0],Xe=Ve&&!Ve[0],We||Xe)return We?Xe?0:-I:v;if(v!=I)return v;if(We=v<0,Xe=Ce==P,!it||!Ve)return Xe?0:!it^We?1:-1;if(!Xe)return Ce>P^We?1:-1;for(I=(Ce=it.length)<(P=Ve.length)?Ce:P,v=0;v<I;v++)if(it[v]!=Ve[v])return it[v]>Ve[v]^We?1:-1;return Ce==P?0:Ce>P^We?1:-1}function Fe(q,W,We,Xe){if(q<W||q>We||q!==o(q))throw Error(c+(Xe||"Argument")+(typeof q=="number"?q<W||q>We?" out of range: ":" not an integer: ":" not a primitive number: ")+String(q))}function O(q){var W=q.c.length-1;return D(q.e/x)==W&&q.c[W]%2!=0}function $e(q,W){return(q.length>1?q.charAt(0)+"."+q.slice(1):q)+(W<0?"e":"e+")+W}function ze(q,W,We){var Xe,it;if(W<0){for(it=We+".";++W;it+=We);q=it+q}else if(Xe=q.length,++W>Xe){for(it=We,W-=Xe;--W;it+=We);q+=it}else W<Xe&&(q=q.slice(0,W)+"."+q.slice(W));return q}r=R(),r.default=r.BigNumber=r,t.exports?t.exports=r:(e||(e=typeof self<"u"&&self?self:window),e.BigNumber=r)})(bignumber)})(bignumber$1)),bignumber$1.exports}var jsbiUmd$1={exports:{}},jsbiUmd=jsbiUmd$1.exports,hasRequiredJsbiUmd;function requireJsbiUmd(){return hasRequiredJsbiUmd||(hasRequiredJsbiUmd=1,(function(t,e){(function(r,n){t.exports=n()})(jsbiUmd,function(){var r=Math.imul,n=Math.clz32,s=Math.abs,o=Math.max,c=Math.floor;class u extends Array{constructor(x,p){if(super(x),this.sign=p,x>u.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded")}static BigInt(x){var p=Number.isFinite;if(typeof x=="number"){if(x===0)return u.__zero();if(u.__isOneDigitInt(x))return 0>x?u.__oneDigit(-x,!0):u.__oneDigit(x,!1);if(!p(x)||c(x)!==x)throw new RangeError("The number "+x+" cannot be converted to BigInt because it is not an integer");return u.__fromDouble(x)}if(typeof x=="string"){const g=u.__fromString(x);if(g===null)throw new SyntaxError("Cannot convert "+x+" to a BigInt");return g}if(typeof x=="boolean")return x===!0?u.__oneDigit(1,!1):u.__zero();if(typeof x=="object"){if(x.constructor===u)return x;const g=u.__toPrimitive(x);return u.BigInt(g)}throw new TypeError("Cannot convert "+x+" to a BigInt")}toDebugString(){const x=["BigInt["];for(const p of this)x.push((p&&(p>>>0).toString(16))+", ");return x.push("]"),x.join("")}toString(x=10){if(2>x||36<x)throw new RangeError("toString() radix argument must be between 2 and 36");return this.length===0?"0":(x&x-1)==0?u.__toStringBasePowerOfTwo(this,x):u.__toStringGeneric(this,x,!1)}static toNumber(x){const p=x.length;if(p===0)return 0;if(p===1){const We=x.__unsignedDigit(0);return x.sign?-We:We}const g=x.__digit(p-1),y=u.__clz30(g),b=30*p-y;if(1024<b)return x.sign?-1/0:1/0;let R=b-1,D=g,k=p-1;const Re=y+3;let Fe=Re===32?0:D<<Re;Fe>>>=12;const O=Re-12;let $e=12<=Re?0:D<<20+Re,ze=20+Re;for(0<O&&0<k&&(k--,D=x.__digit(k),Fe|=D>>>30-O,$e=D<<O+2,ze=O+2);0<ze&&0<k;)k--,D=x.__digit(k),$e|=30<=ze?D<<ze-30:D>>>30-ze,ze-=30;const q=u.__decideRounding(x,ze,k,D);if((q===1||q===0&&(1&$e)==1)&&($e=$e+1>>>0,$e===0&&(Fe++,Fe>>>20!=0&&(Fe=0,R++,1023<R))))return x.sign?-1/0:1/0;const W=x.sign?-2147483648:0;return R=R+1023<<20,u.__kBitConversionInts[1]=W|R|Fe,u.__kBitConversionInts[0]=$e,u.__kBitConversionDouble[0]}static unaryMinus(x){if(x.length===0)return x;const p=x.__copy();return p.sign=!x.sign,p}static bitwiseNot(x){return x.sign?u.__absoluteSubOne(x).__trim():u.__absoluteAddOne(x,!0)}static exponentiate(x,p){if(p.sign)throw new RangeError("Exponent must be positive");if(p.length===0)return u.__oneDigit(1,!1);if(x.length===0)return x;if(x.length===1&&x.__digit(0)===1)return x.sign&&(1&p.__digit(0))==0?u.unaryMinus(x):x;if(1<p.length)throw new RangeError("BigInt too big");let g=p.__unsignedDigit(0);if(g===1)return x;if(g>=u.__kMaxLengthBits)throw new RangeError("BigInt too big");if(x.length===1&&x.__digit(0)===2){const R=1+(0|g/30),D=x.sign&&(1&g)!=0,k=new u(R,D);k.__initializeDigits();const Re=1<<g%30;return k.__setDigit(R-1,Re),k}let y=null,b=x;for((1&g)!=0&&(y=x),g>>=1;g!==0;g>>=1)b=u.multiply(b,b),(1&g)!=0&&(y===null?y=b:y=u.multiply(y,b));return y}static multiply(x,p){if(x.length===0)return x;if(p.length===0)return p;let g=x.length+p.length;30<=x.__clzmsd()+p.__clzmsd()&&g--;const y=new u(g,x.sign!==p.sign);y.__initializeDigits();for(let b=0;b<x.length;b++)u.__multiplyAccumulate(p,x.__digit(b),y,b);return y.__trim()}static divide(x,p){if(p.length===0)throw new RangeError("Division by zero");if(0>u.__absoluteCompare(x,p))return u.__zero();const g=x.sign!==p.sign,y=p.__unsignedDigit(0);let b;if(p.length===1&&32767>=y){if(y===1)return g===x.sign?x:u.unaryMinus(x);b=u.__absoluteDivSmall(x,y,null)}else b=u.__absoluteDivLarge(x,p,!0,!1);return b.sign=g,b.__trim()}static remainder(x,p){if(p.length===0)throw new RangeError("Division by zero");if(0>u.__absoluteCompare(x,p))return x;const g=p.__unsignedDigit(0);if(p.length===1&&32767>=g){if(g===1)return u.__zero();const b=u.__absoluteModSmall(x,g);return b===0?u.__zero():u.__oneDigit(b,x.sign)}const y=u.__absoluteDivLarge(x,p,!1,!0);return y.sign=x.sign,y.__trim()}static add(x,p){const g=x.sign;return g===p.sign?u.__absoluteAdd(x,p,g):0<=u.__absoluteCompare(x,p)?u.__absoluteSub(x,p,g):u.__absoluteSub(p,x,!g)}static subtract(x,p){const g=x.sign;return g===p.sign?0<=u.__absoluteCompare(x,p)?u.__absoluteSub(x,p,g):u.__absoluteSub(p,x,!g):u.__absoluteAdd(x,p,g)}static leftShift(x,p){return p.length===0||x.length===0?x:p.sign?u.__rightShiftByAbsolute(x,p):u.__leftShiftByAbsolute(x,p)}static signedRightShift(x,p){return p.length===0||x.length===0?x:p.sign?u.__leftShiftByAbsolute(x,p):u.__rightShiftByAbsolute(x,p)}static unsignedRightShift(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}static lessThan(x,p){return 0>u.__compareToBigInt(x,p)}static lessThanOrEqual(x,p){return 0>=u.__compareToBigInt(x,p)}static greaterThan(x,p){return 0<u.__compareToBigInt(x,p)}static greaterThanOrEqual(x,p){return 0<=u.__compareToBigInt(x,p)}static equal(x,p){if(x.sign!==p.sign||x.length!==p.length)return!1;for(let g=0;g<x.length;g++)if(x.__digit(g)!==p.__digit(g))return!1;return!0}static notEqual(x,p){return!u.equal(x,p)}static bitwiseAnd(x,p){if(!x.sign&&!p.sign)return u.__absoluteAnd(x,p).__trim();if(x.sign&&p.sign){const g=o(x.length,p.length)+1;let y=u.__absoluteSubOne(x,g);const b=u.__absoluteSubOne(p);return y=u.__absoluteOr(y,b,y),u.__absoluteAddOne(y,!0,y).__trim()}return x.sign&&([x,p]=[p,x]),u.__absoluteAndNot(x,u.__absoluteSubOne(p)).__trim()}static bitwiseXor(x,p){if(!x.sign&&!p.sign)return u.__absoluteXor(x,p).__trim();if(x.sign&&p.sign){const b=o(x.length,p.length),R=u.__absoluteSubOne(x,b),D=u.__absoluteSubOne(p);return u.__absoluteXor(R,D,R).__trim()}const g=o(x.length,p.length)+1;x.sign&&([x,p]=[p,x]);let y=u.__absoluteSubOne(p,g);return y=u.__absoluteXor(y,x,y),u.__absoluteAddOne(y,!0,y).__trim()}static bitwiseOr(x,p){const g=o(x.length,p.length);if(!x.sign&&!p.sign)return u.__absoluteOr(x,p).__trim();if(x.sign&&p.sign){let b=u.__absoluteSubOne(x,g);const R=u.__absoluteSubOne(p);return b=u.__absoluteAnd(b,R,b),u.__absoluteAddOne(b,!0,b).__trim()}x.sign&&([x,p]=[p,x]);let y=u.__absoluteSubOne(p,g);return y=u.__absoluteAndNot(y,x,y),u.__absoluteAddOne(y,!0,y).__trim()}static asIntN(x,p){if(p.length===0)return p;if(x=c(x),0>x)throw new RangeError("Invalid value: not (convertible to) a safe integer");if(x===0)return u.__zero();if(x>=u.__kMaxLengthBits)return p;const g=0|(x+29)/30;if(p.length<g)return p;const y=p.__unsignedDigit(g-1),b=1<<(x-1)%30;if(p.length===g&&y<b)return p;if((y&b)!==b)return u.__truncateToNBits(x,p);if(!p.sign)return u.__truncateAndSubFromPowerOfTwo(x,p,!0);if((y&b-1)==0){for(let R=g-2;0<=R;R--)if(p.__digit(R)!==0)return u.__truncateAndSubFromPowerOfTwo(x,p,!1);return p.length===g&&y===b?p:u.__truncateToNBits(x,p)}return u.__truncateAndSubFromPowerOfTwo(x,p,!1)}static asUintN(x,p){if(p.length===0)return p;if(x=c(x),0>x)throw new RangeError("Invalid value: not (convertible to) a safe integer");if(x===0)return u.__zero();if(p.sign){if(x>u.__kMaxLengthBits)throw new RangeError("BigInt too big");return u.__truncateAndSubFromPowerOfTwo(x,p,!1)}if(x>=u.__kMaxLengthBits)return p;const g=0|(x+29)/30;if(p.length<g)return p;const y=x%30;return p.length==g&&(y===0||!(p.__digit(g-1)>>>y))?p:u.__truncateToNBits(x,p)}static ADD(x,p){if(x=u.__toPrimitive(x),p=u.__toPrimitive(p),typeof x=="string")return typeof p!="string"&&(p=p.toString()),x+p;if(typeof p=="string")return x.toString()+p;if(x=u.__toNumeric(x),p=u.__toNumeric(p),u.__isBigInt(x)&&u.__isBigInt(p))return u.add(x,p);if(typeof x=="number"&&typeof p=="number")return x+p;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}static LT(x,p){return u.__compare(x,p,0)}static LE(x,p){return u.__compare(x,p,1)}static GT(x,p){return u.__compare(x,p,2)}static GE(x,p){return u.__compare(x,p,3)}static EQ(x,p){for(;;){if(u.__isBigInt(x))return u.__isBigInt(p)?u.equal(x,p):u.EQ(p,x);if(typeof x=="number"){if(u.__isBigInt(p))return u.__equalToNumber(p,x);if(typeof p!="object")return x==p;p=u.__toPrimitive(p)}else if(typeof x=="string"){if(u.__isBigInt(p))return x=u.__fromString(x),x!==null&&u.equal(x,p);if(typeof p!="object")return x==p;p=u.__toPrimitive(p)}else if(typeof x=="boolean"){if(u.__isBigInt(p))return u.__equalToNumber(p,+x);if(typeof p!="object")return x==p;p=u.__toPrimitive(p)}else if(typeof x=="symbol"){if(u.__isBigInt(p))return!1;if(typeof p!="object")return x==p;p=u.__toPrimitive(p)}else if(typeof x=="object"){if(typeof p=="object"&&p.constructor!==u)return x==p;x=u.__toPrimitive(x)}else return x==p}}static NE(x,p){return!u.EQ(x,p)}static __zero(){return new u(0,!1)}static __oneDigit(x,p){const g=new u(1,p);return g.__setDigit(0,x),g}__copy(){const x=new u(this.length,this.sign);for(let p=0;p<this.length;p++)x[p]=this[p];return x}__trim(){let x=this.length,p=this[x-1];for(;p===0;)x--,p=this[x-1],this.pop();return x===0&&(this.sign=!1),this}__initializeDigits(){for(let x=0;x<this.length;x++)this[x]=0}static __decideRounding(x,p,g,y){if(0<p)return-1;let b;if(0>p)b=-p-1;else{if(g===0)return-1;g--,y=x.__digit(g),b=29}let R=1<<b;if((y&R)==0)return-1;if(R-=1,(y&R)!=0)return 1;for(;0<g;)if(g--,x.__digit(g)!==0)return 1;return 0}static __fromDouble(x){u.__kBitConversionDouble[0]=x;const p=2047&u.__kBitConversionInts[1]>>>20,g=p-1023,y=(0|g/30)+1,b=new u(y,0>x);let R=1048575&u.__kBitConversionInts[1]|1048576,D=u.__kBitConversionInts[0];const k=20,Re=g%30;let Fe,O=0;if(20>Re){const $e=k-Re;O=$e+32,Fe=R>>>$e,R=R<<32-$e|D>>>$e,D<<=32-$e}else if(Re===20)O=32,Fe=R,R=D,D=0;else{const $e=Re-k;O=32-$e,Fe=R<<$e|D>>>32-$e,R=D<<$e,D=0}b.__setDigit(y-1,Fe);for(let $e=y-2;0<=$e;$e--)0<O?(O-=30,Fe=R>>>2,R=R<<30|D>>>2,D<<=30):Fe=0,b.__setDigit($e,Fe);return b.__trim()}static __isWhitespace(x){return 13>=x&&9<=x||(159>=x?x==32:131071>=x?x==160||x==5760:196607>=x?(x&=131071,10>=x||x==40||x==41||x==47||x==95||x==4096):x==65279)}static __fromString(x,p=0){let g=0;const y=x.length;let b=0;if(b===y)return u.__zero();let R=x.charCodeAt(b);for(;u.__isWhitespace(R);){if(++b===y)return u.__zero();R=x.charCodeAt(b)}if(R===43){if(++b===y)return null;R=x.charCodeAt(b),g=1}else if(R===45){if(++b===y)return null;R=x.charCodeAt(b),g=-1}if(p===0){if(p=10,R===48){if(++b===y)return u.__zero();if(R=x.charCodeAt(b),R===88||R===120){if(p=16,++b===y)return null;R=x.charCodeAt(b)}else if(R===79||R===111){if(p=8,++b===y)return null;R=x.charCodeAt(b)}else if(R===66||R===98){if(p=2,++b===y)return null;R=x.charCodeAt(b)}}}else if(p===16&&R===48){if(++b===y)return u.__zero();if(R=x.charCodeAt(b),R===88||R===120){if(++b===y)return null;R=x.charCodeAt(b)}}if(g!=0&&p!==10)return null;for(;R===48;){if(++b===y)return u.__zero();R=x.charCodeAt(b)}const D=y-b;let k=u.__kMaxBitsPerChar[p],Re=u.__kBitsPerCharTableMultiplier-1;if(D>1073741824/k)return null;const Fe=k*D+Re>>>u.__kBitsPerCharTableShift,O=new u(0|(Fe+29)/30,!1),$e=10>p?p:10,ze=10<p?p-10:0;if((p&p-1)==0){k>>=u.__kBitsPerCharTableShift;const q=[],W=[];let We=!1;do{let Xe=0,it=0;for(;;){let Ve;if(R-48>>>0<$e)Ve=R-48;else if((32|R)-97>>>0<ze)Ve=(32|R)-87;else{We=!0;break}if(it+=k,Xe=Xe<<k|Ve,++b===y){We=!0;break}if(R=x.charCodeAt(b),30<it+k)break}q.push(Xe),W.push(it)}while(!We);u.__fillFromParts(O,q,W)}else{O.__initializeDigits();let q=!1,W=0;do{let We=0,Xe=1;for(;;){let Ve;if(R-48>>>0<$e)Ve=R-48;else if((32|R)-97>>>0<ze)Ve=(32|R)-87;else{q=!0;break}const v=Xe*p;if(1073741823<v)break;if(Xe=v,We=We*p+Ve,W++,++b===y){q=!0;break}R=x.charCodeAt(b)}Re=30*u.__kBitsPerCharTableMultiplier-1;const it=0|(k*W+Re>>>u.__kBitsPerCharTableShift)/30;O.__inplaceMultiplyAdd(Xe,We,it)}while(!q)}if(b!==y){if(!u.__isWhitespace(R))return null;for(b++;b<y;b++)if(R=x.charCodeAt(b),!u.__isWhitespace(R))return null}return O.sign=g==-1,O.__trim()}static __fillFromParts(x,p,g){let y=0,b=0,R=0;for(let D=p.length-1;0<=D;D--){const k=p[D],Re=g[D];b|=k<<R,R+=Re,R===30?(x.__setDigit(y++,b),R=0,b=0):30<R&&(x.__setDigit(y++,1073741823&b),R-=30,b=k>>>Re-R)}if(b!==0){if(y>=x.length)throw new Error("implementation bug");x.__setDigit(y++,b)}for(;y<x.length;y++)x.__setDigit(y,0)}static __toStringBasePowerOfTwo(x,p){const g=x.length;let y=p-1;y=(85&y>>>1)+(85&y),y=(51&y>>>2)+(51&y),y=(15&y>>>4)+(15&y);const b=y,R=p-1,D=x.__digit(g-1),k=u.__clz30(D);let Re=0|(30*g-k+b-1)/b;if(x.sign&&Re++,268435456<Re)throw new Error("string too long");const Fe=Array(Re);let O=Re-1,$e=0,ze=0;for(let W=0;W<g-1;W++){const We=x.__digit(W),Xe=($e|We<<ze)&R;Fe[O--]=u.__kConversionChars[Xe];const it=b-ze;for($e=We>>>it,ze=30-it;ze>=b;)Fe[O--]=u.__kConversionChars[$e&R],$e>>>=b,ze-=b}const q=($e|D<<ze)&R;for(Fe[O--]=u.__kConversionChars[q],$e=D>>>b-ze;$e!==0;)Fe[O--]=u.__kConversionChars[$e&R],$e>>>=b;if(x.sign&&(Fe[O--]="-"),O!=-1)throw new Error("implementation bug");return Fe.join("")}static __toStringGeneric(x,p,g){const y=x.length;if(y===0)return"";if(y===1){let W=x.__unsignedDigit(0).toString(p);return g===!1&&x.sign&&(W="-"+W),W}const b=30*y-u.__clz30(x.__digit(y-1)),R=u.__kMaxBitsPerChar[p],D=R-1;let k=b*u.__kBitsPerCharTableMultiplier;k+=D-1,k=0|k/D;const Re=k+1>>1,Fe=u.exponentiate(u.__oneDigit(p,!1),u.__oneDigit(Re,!1));let O,$e;const ze=Fe.__unsignedDigit(0);if(Fe.length===1&&32767>=ze){O=new u(x.length,!1),O.__initializeDigits();let W=0;for(let We=2*x.length-1;0<=We;We--){const Xe=W<<15|x.__halfDigit(We);O.__setHalfDigit(We,0|Xe/ze),W=0|Xe%ze}$e=W.toString(p)}else{const W=u.__absoluteDivLarge(x,Fe,!0,!0);O=W.quotient;const We=W.remainder.__trim();$e=u.__toStringGeneric(We,p,!0)}O.__trim();let q=u.__toStringGeneric(O,p,!0);for(;$e.length<Re;)$e="0"+$e;return g===!1&&x.sign&&(q="-"+q),q+$e}static __unequalSign(x){return x?-1:1}static __absoluteGreater(x){return x?-1:1}static __absoluteLess(x){return x?1:-1}static __compareToBigInt(x,p){const g=x.sign;if(g!==p.sign)return u.__unequalSign(g);const y=u.__absoluteCompare(x,p);return 0<y?u.__absoluteGreater(g):0>y?u.__absoluteLess(g):0}static __compareToNumber(x,p){if(u.__isOneDigitInt(p)){const g=x.sign,y=0>p;if(g!==y)return u.__unequalSign(g);if(x.length===0){if(y)throw new Error("implementation bug");return p===0?0:-1}if(1<x.length)return u.__absoluteGreater(g);const b=s(p),R=x.__unsignedDigit(0);return R>b?u.__absoluteGreater(g):R<b?u.__absoluteLess(g):0}return u.__compareToDouble(x,p)}static __compareToDouble(x,p){if(p!==p)return p;if(p===1/0)return-1;if(p===-1/0)return 1;const g=x.sign;if(g!==0>p)return u.__unequalSign(g);if(p===0)throw new Error("implementation bug: should be handled elsewhere");if(x.length===0)return-1;u.__kBitConversionDouble[0]=p;const y=2047&u.__kBitConversionInts[1]>>>20;if(y==2047)throw new Error("implementation bug: handled elsewhere");const b=y-1023;if(0>b)return u.__absoluteGreater(g);const R=x.length;let D=x.__digit(R-1);const k=u.__clz30(D),Re=30*R-k,Fe=b+1;if(Re<Fe)return u.__absoluteLess(g);if(Re>Fe)return u.__absoluteGreater(g);let O=1048576|1048575&u.__kBitConversionInts[1],$e=u.__kBitConversionInts[0];const ze=20,q=29-k;if(q!==(0|(Re-1)%30))throw new Error("implementation bug");let W,We=0;if(20>q){const Xe=ze-q;We=Xe+32,W=O>>>Xe,O=O<<32-Xe|$e>>>Xe,$e<<=32-Xe}else if(q===20)We=32,W=O,O=$e,$e=0;else{const Xe=q-ze;We=32-Xe,W=O<<Xe|$e>>>32-Xe,O=$e<<Xe,$e=0}if(D>>>=0,W>>>=0,D>W)return u.__absoluteGreater(g);if(D<W)return u.__absoluteLess(g);for(let Xe=R-2;0<=Xe;Xe--){0<We?(We-=30,W=O>>>2,O=O<<30|$e>>>2,$e<<=30):W=0;const it=x.__unsignedDigit(Xe);if(it>W)return u.__absoluteGreater(g);if(it<W)return u.__absoluteLess(g)}if(O!==0||$e!==0){if(We===0)throw new Error("implementation bug");return u.__absoluteLess(g)}return 0}static __equalToNumber(x,p){return u.__isOneDigitInt(p)?p===0?x.length===0:x.length===1&&x.sign===0>p&&x.__unsignedDigit(0)===s(p):u.__compareToDouble(x,p)===0}static __comparisonResultToBool(x,p){return p===0?0>x:p===1?0>=x:p===2?0<x:p===3?0<=x:void 0}static __compare(x,p,g){if(x=u.__toPrimitive(x),p=u.__toPrimitive(p),typeof x=="string"&&typeof p=="string")switch(g){case 0:return x<p;case 1:return x<=p;case 2:return x>p;case 3:return x>=p}if(u.__isBigInt(x)&&typeof p=="string")return p=u.__fromString(p),p!==null&&u.__comparisonResultToBool(u.__compareToBigInt(x,p),g);if(typeof x=="string"&&u.__isBigInt(p))return x=u.__fromString(x),x!==null&&u.__comparisonResultToBool(u.__compareToBigInt(x,p),g);if(x=u.__toNumeric(x),p=u.__toNumeric(p),u.__isBigInt(x)){if(u.__isBigInt(p))return u.__comparisonResultToBool(u.__compareToBigInt(x,p),g);if(typeof p!="number")throw new Error("implementation bug");return u.__comparisonResultToBool(u.__compareToNumber(x,p),g)}if(typeof x!="number")throw new Error("implementation bug");if(u.__isBigInt(p))return u.__comparisonResultToBool(u.__compareToNumber(p,x),2^g);if(typeof p!="number")throw new Error("implementation bug");return g===0?x<p:g===1?x<=p:g===2?x>p:g===3?x>=p:void 0}__clzmsd(){return u.__clz30(this.__digit(this.length-1))}static __absoluteAdd(x,p,g){if(x.length<p.length)return u.__absoluteAdd(p,x,g);if(x.length===0)return x;if(p.length===0)return x.sign===g?x:u.unaryMinus(x);let y=x.length;(x.__clzmsd()===0||p.length===x.length&&p.__clzmsd()===0)&&y++;const b=new u(y,g);let R=0,D=0;for(;D<p.length;D++){const k=x.__digit(D)+p.__digit(D)+R;R=k>>>30,b.__setDigit(D,1073741823&k)}for(;D<x.length;D++){const k=x.__digit(D)+R;R=k>>>30,b.__setDigit(D,1073741823&k)}return D<b.length&&b.__setDigit(D,R),b.__trim()}static __absoluteSub(x,p,g){if(x.length===0)return x;if(p.length===0)return x.sign===g?x:u.unaryMinus(x);const y=new u(x.length,g);let b=0,R=0;for(;R<p.length;R++){const D=x.__digit(R)-p.__digit(R)-b;b=1&D>>>30,y.__setDigit(R,1073741823&D)}for(;R<x.length;R++){const D=x.__digit(R)-b;b=1&D>>>30,y.__setDigit(R,1073741823&D)}return y.__trim()}static __absoluteAddOne(x,p,g=null){const y=x.length;g===null?g=new u(y,p):g.sign=p;let b=1;for(let R=0;R<y;R++){const D=x.__digit(R)+b;b=D>>>30,g.__setDigit(R,1073741823&D)}return b!=0&&g.__setDigitGrow(y,1),g}static __absoluteSubOne(x,p){const g=x.length;p=p||g;const y=new u(p,!1);let b=1;for(let R=0;R<g;R++){const D=x.__digit(R)-b;b=1&D>>>30,y.__setDigit(R,1073741823&D)}if(b!=0)throw new Error("implementation bug");for(let R=g;R<p;R++)y.__setDigit(R,0);return y}static __absoluteAnd(x,p,g=null){let y=x.length,b=p.length,R=b;if(y<b){R=y;const Re=x,Fe=y;x=p,y=b,p=Re,b=Fe}let D=R;g===null?g=new u(D,!1):D=g.length;let k=0;for(;k<R;k++)g.__setDigit(k,x.__digit(k)&p.__digit(k));for(;k<D;k++)g.__setDigit(k,0);return g}static __absoluteAndNot(x,p,g=null){const y=x.length,b=p.length;let R=b;y<b&&(R=y);let D=y;g===null?g=new u(D,!1):D=g.length;let k=0;for(;k<R;k++)g.__setDigit(k,x.__digit(k)&~p.__digit(k));for(;k<y;k++)g.__setDigit(k,x.__digit(k));for(;k<D;k++)g.__setDigit(k,0);return g}static __absoluteOr(x,p,g=null){let y=x.length,b=p.length,R=b;if(y<b){R=y;const Re=x,Fe=y;x=p,y=b,p=Re,b=Fe}let D=y;g===null?g=new u(D,!1):D=g.length;let k=0;for(;k<R;k++)g.__setDigit(k,x.__digit(k)|p.__digit(k));for(;k<y;k++)g.__setDigit(k,x.__digit(k));for(;k<D;k++)g.__setDigit(k,0);return g}static __absoluteXor(x,p,g=null){let y=x.length,b=p.length,R=b;if(y<b){R=y;const Re=x,Fe=y;x=p,y=b,p=Re,b=Fe}let D=y;g===null?g=new u(D,!1):D=g.length;let k=0;for(;k<R;k++)g.__setDigit(k,x.__digit(k)^p.__digit(k));for(;k<y;k++)g.__setDigit(k,x.__digit(k));for(;k<D;k++)g.__setDigit(k,0);return g}static __absoluteCompare(x,p){const g=x.length-p.length;if(g!=0)return g;let y=x.length-1;for(;0<=y&&x.__digit(y)===p.__digit(y);)y--;return 0>y?0:x.__unsignedDigit(y)>p.__unsignedDigit(y)?1:-1}static __multiplyAccumulate(x,p,g,y){if(p===0)return;const b=32767&p,R=p>>>15;let D=0,k=0;for(let Re,Fe=0;Fe<x.length;Fe++,y++){Re=g.__digit(y);const O=x.__digit(Fe),$e=32767&O,ze=O>>>15,q=u.__imul($e,b),W=u.__imul($e,R),We=u.__imul(ze,b),Xe=u.__imul(ze,R);Re+=k+q+D,D=Re>>>30,Re&=1073741823,Re+=((32767&W)<<15)+((32767&We)<<15),D+=Re>>>30,k=Xe+(W>>>15)+(We>>>15),g.__setDigit(y,1073741823&Re)}for(;D!=0||k!==0;y++){let Re=g.__digit(y);Re+=D+k,k=0,D=Re>>>30,g.__setDigit(y,1073741823&Re)}}static __internalMultiplyAdd(x,p,g,y,b){let R=g,D=0;for(let k=0;k<y;k++){const Re=x.__digit(k),Fe=u.__imul(32767&Re,p),O=u.__imul(Re>>>15,p),$e=Fe+((32767&O)<<15)+D+R;R=$e>>>30,D=O>>>15,b.__setDigit(k,1073741823&$e)}if(b.length>y)for(b.__setDigit(y++,R+D);y<b.length;)b.__setDigit(y++,0);else if(R+D!==0)throw new Error("implementation bug")}__inplaceMultiplyAdd(x,p,g){g>this.length&&(g=this.length);const y=32767&x,b=x>>>15;let R=0,D=p;for(let k=0;k<g;k++){const Re=this.__digit(k),Fe=32767&Re,O=Re>>>15,$e=u.__imul(Fe,y),ze=u.__imul(Fe,b),q=u.__imul(O,y),W=u.__imul(O,b);let We=D+$e+R;R=We>>>30,We&=1073741823,We+=((32767&ze)<<15)+((32767&q)<<15),R+=We>>>30,D=W+(ze>>>15)+(q>>>15),this.__setDigit(k,1073741823&We)}if(R!=0||D!==0)throw new Error("implementation bug")}static __absoluteDivSmall(x,p,g=null){g===null&&(g=new u(x.length,!1));let y=0;for(let b,R=2*x.length-1;0<=R;R-=2){b=(y<<15|x.__halfDigit(R))>>>0;const D=0|b/p;y=0|b%p,b=(y<<15|x.__halfDigit(R-1))>>>0;const k=0|b/p;y=0|b%p,g.__setDigit(R>>>1,D<<15|k)}return g}static __absoluteModSmall(x,p){let g=0;for(let y=2*x.length-1;0<=y;y--)g=0|((g<<15|x.__halfDigit(y))>>>0)%p;return g}static __absoluteDivLarge(x,p,g,y){const b=p.__halfDigitLength(),R=p.length,D=x.__halfDigitLength()-b;let k=null;g&&(k=new u(D+2>>>1,!1),k.__initializeDigits());const Re=new u(b+2>>>1,!1);Re.__initializeDigits();const Fe=u.__clz15(p.__halfDigit(b-1));0<Fe&&(p=u.__specialLeftShift(p,Fe,0));const O=u.__specialLeftShift(x,Fe,1),$e=p.__halfDigit(b-1);let ze=0;for(let q,W=D;0<=W;W--){q=32767;const We=O.__halfDigit(W+b);if(We!==$e){const it=(We<<15|O.__halfDigit(W+b-1))>>>0;q=0|it/$e;let Ve=0|it%$e;const v=p.__halfDigit(b-2),I=O.__halfDigit(W+b-2);for(;u.__imul(q,v)>>>0>(Ve<<16|I)>>>0&&(q--,Ve+=$e,!(32767<Ve)););}u.__internalMultiplyAdd(p,q,0,R,Re);let Xe=O.__inplaceSub(Re,W,b+1);Xe!==0&&(Xe=O.__inplaceAdd(p,W,b),O.__setHalfDigit(W+b,32767&O.__halfDigit(W+b)+Xe),q--),g&&(1&W?ze=q<<15:k.__setDigit(W>>>1,ze|q))}if(y)return O.__inplaceRightShift(Fe),g?{quotient:k,remainder:O}:O;if(g)return k;throw new Error("unreachable")}static __clz15(x){return u.__clz30(x)-15}__inplaceAdd(x,p,g){let y=0;for(let b=0;b<g;b++){const R=this.__halfDigit(p+b)+x.__halfDigit(b)+y;y=R>>>15,this.__setHalfDigit(p+b,32767&R)}return y}__inplaceSub(x,p,g){let y=0;if(1&p){p>>=1;let b=this.__digit(p),R=32767&b,D=0;for(;D<g-1>>>1;D++){const Fe=x.__digit(D),O=(b>>>15)-(32767&Fe)-y;y=1&O>>>15,this.__setDigit(p+D,(32767&O)<<15|32767&R),b=this.__digit(p+D+1),R=(32767&b)-(Fe>>>15)-y,y=1&R>>>15}const k=x.__digit(D),Re=(b>>>15)-(32767&k)-y;if(y=1&Re>>>15,this.__setDigit(p+D,(32767&Re)<<15|32767&R),p+D+1>=this.length)throw new RangeError("out of bounds");(1&g)==0&&(b=this.__digit(p+D+1),R=(32767&b)-(k>>>15)-y,y=1&R>>>15,this.__setDigit(p+x.length,1073709056&b|32767&R))}else{p>>=1;let b=0;for(;b<x.length-1;b++){const Fe=this.__digit(p+b),O=x.__digit(b),$e=(32767&Fe)-(32767&O)-y;y=1&$e>>>15;const ze=(Fe>>>15)-(O>>>15)-y;y=1&ze>>>15,this.__setDigit(p+b,(32767&ze)<<15|32767&$e)}const R=this.__digit(p+b),D=x.__digit(b),k=(32767&R)-(32767&D)-y;y=1&k>>>15;let Re=0;(1&g)==0&&(Re=(R>>>15)-(D>>>15)-y,y=1&Re>>>15),this.__setDigit(p+b,(32767&Re)<<15|32767&k)}return y}__inplaceRightShift(x){if(x===0)return;let p=this.__digit(0)>>>x;const g=this.length-1;for(let y=0;y<g;y++){const b=this.__digit(y+1);this.__setDigit(y,1073741823&b<<30-x|p),p=b>>>x}this.__setDigit(g,p)}static __specialLeftShift(x,p,g){const y=x.length,b=new u(y+g,!1);if(p===0){for(let D=0;D<y;D++)b.__setDigit(D,x.__digit(D));return 0<g&&b.__setDigit(y,0),b}let R=0;for(let D=0;D<y;D++){const k=x.__digit(D);b.__setDigit(D,1073741823&k<<p|R),R=k>>>30-p}return 0<g&&b.__setDigit(y,R),b}static __leftShiftByAbsolute(x,p){const g=u.__toShiftAmount(p);if(0>g)throw new RangeError("BigInt too big");const y=0|g/30,b=g%30,R=x.length,D=b!==0&&x.__digit(R-1)>>>30-b!=0,k=R+y+(D?1:0),Re=new u(k,x.sign);if(b===0){let Fe=0;for(;Fe<y;Fe++)Re.__setDigit(Fe,0);for(;Fe<k;Fe++)Re.__setDigit(Fe,x.__digit(Fe-y))}else{let Fe=0;for(let O=0;O<y;O++)Re.__setDigit(O,0);for(let O=0;O<R;O++){const $e=x.__digit(O);Re.__setDigit(O+y,1073741823&$e<<b|Fe),Fe=$e>>>30-b}if(D)Re.__setDigit(R+y,Fe);else if(Fe!==0)throw new Error("implementation bug")}return Re.__trim()}static __rightShiftByAbsolute(x,p){const g=x.length,y=x.sign,b=u.__toShiftAmount(p);if(0>b)return u.__rightShiftByMaximum(y);const R=0|b/30,D=b%30;let k=g-R;if(0>=k)return u.__rightShiftByMaximum(y);let Re=!1;if(y){if((x.__digit(R)&(1<<D)-1)!=0)Re=!0;else for(let O=0;O<R;O++)if(x.__digit(O)!==0){Re=!0;break}}Re&&D===0&&~x.__digit(g-1)==0&&k++;let Fe=new u(k,y);if(D===0){Fe.__setDigit(k-1,0);for(let O=R;O<g;O++)Fe.__setDigit(O-R,x.__digit(O))}else{let O=x.__digit(R)>>>D;const $e=g-R-1;for(let ze=0;ze<$e;ze++){const q=x.__digit(ze+R+1);Fe.__setDigit(ze,1073741823&q<<30-D|O),O=q>>>D}Fe.__setDigit($e,O)}return Re&&(Fe=u.__absoluteAddOne(Fe,!0,Fe)),Fe.__trim()}static __rightShiftByMaximum(x){return x?u.__oneDigit(1,!0):u.__zero()}static __toShiftAmount(x){if(1<x.length)return-1;const p=x.__unsignedDigit(0);return p>u.__kMaxLengthBits?-1:p}static __toPrimitive(x,p="default"){if(typeof x!="object"||x.constructor===u)return x;if(typeof Symbol<"u"&&typeof Symbol.toPrimitive=="symbol"){const b=x[Symbol.toPrimitive];if(b){const R=b(p);if(typeof R!="object")return R;throw new TypeError("Cannot convert object to primitive value")}}const g=x.valueOf;if(g){const b=g.call(x);if(typeof b!="object")return b}const y=x.toString;if(y){const b=y.call(x);if(typeof b!="object")return b}throw new TypeError("Cannot convert object to primitive value")}static __toNumeric(x){return u.__isBigInt(x)?x:+x}static __isBigInt(x){return typeof x=="object"&&x!==null&&x.constructor===u}static __truncateToNBits(x,p){const g=0|(x+29)/30,y=new u(g,p.sign),b=g-1;for(let D=0;D<b;D++)y.__setDigit(D,p.__digit(D));let R=p.__digit(b);if(x%30!=0){const D=32-x%30;R=R<<D>>>D}return y.__setDigit(b,R),y.__trim()}static __truncateAndSubFromPowerOfTwo(x,p,g){var y=Math.min;const b=0|(x+29)/30,R=new u(b,g);let D=0;const k=b-1;let Re=0;for(const ze=y(k,p.length);D<ze;D++){const q=0-p.__digit(D)-Re;Re=1&q>>>30,R.__setDigit(D,1073741823&q)}for(;D<k;D++)R.__setDigit(D,0|1073741823&-Re);let Fe=k<p.length?p.__digit(k):0;const O=x%30;let $e;if(O==0)$e=0-Fe-Re,$e&=1073741823;else{const ze=32-O;Fe=Fe<<ze>>>ze;const q=1<<32-ze;$e=q-Fe-Re,$e&=q-1}return R.__setDigit(k,$e),R.__trim()}__digit(x){return this[x]}__unsignedDigit(x){return this[x]>>>0}__setDigit(x,p){this[x]=0|p}__setDigitGrow(x,p){this[x]=0|p}__halfDigitLength(){const x=this.length;return 32767>=this.__unsignedDigit(x-1)?2*x-1:2*x}__halfDigit(x){return 32767&this[x>>>1]>>>15*(1&x)}__setHalfDigit(x,p){const g=x>>>1,y=this.__digit(g),b=1&x?32767&y|p<<15:1073709056&y|32767&p;this.__setDigit(g,b)}static __digitPow(x,p){let g=1;for(;0<p;)1&p&&(g*=x),p>>>=1,x*=x;return g}static __isOneDigitInt(x){return(1073741823&x)===x}}return u.__kMaxLength=33554432,u.__kMaxLengthBits=u.__kMaxLength<<5,u.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],u.__kBitsPerCharTableShift=5,u.__kBitsPerCharTableMultiplier=1<<u.__kBitsPerCharTableShift,u.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],u.__kBitConversionBuffer=new ArrayBuffer(8),u.__kBitConversionDouble=new Float64Array(u.__kBitConversionBuffer),u.__kBitConversionInts=new Int32Array(u.__kBitConversionBuffer),u.__clz30=n?function(f){return n(f)-2}:function(f){var x=Math.LN2,p=Math.log;return f===0?30:0|29-(0|p(f>>>0)/x)},u.__imul=r||function(f,x){return 0|f*x},u})})(jsbiUmd$1)),jsbiUmd$1.exports}var hasRequiredXoshiro;function requireXoshiro(){if(hasRequiredXoshiro)return xoshiro;hasRequiredXoshiro=1;var t=xoshiro&&xoshiro.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(xoshiro,"__esModule",{value:!0});const e=requireUtils$7(),r=t(requireBignumber()),n=t(requireJsbiUmd()),s=18446744073709552e3,o=(u,f)=>n.default.bitwiseXor(n.default.asUintN(64,n.default.leftShift(u,n.default.BigInt(f))),n.default.BigInt(n.default.asUintN(64,n.default.signedRightShift(u,n.default.subtract(n.default.BigInt(64),n.default.BigInt(f))))));class c{constructor(f){this.next=()=>new r.default(this.roll().toString()),this.nextDouble=()=>new r.default(this.roll().toString()).div(s+1),this.nextInt=(p,g)=>Math.floor(this.nextDouble().toNumber()*(g-p+1)+p),this.nextByte=()=>this.nextInt(0,255),this.nextData=p=>[...new Array(p)].map(()=>this.nextByte());const x=e.sha256Hash(f);this.s=[n.default.BigInt(0),n.default.BigInt(0),n.default.BigInt(0),n.default.BigInt(0)],this.setS(x)}setS(f){for(let x=0;x<4;x++){let p=x*8,g=n.default.BigInt(0);for(let y=0;y<8;y++)g=n.default.asUintN(64,n.default.leftShift(g,n.default.BigInt(8))),g=n.default.asUintN(64,n.default.bitwiseOr(g,n.default.BigInt(f[p+y])));this.s[x]=n.default.asUintN(64,g)}}roll(){const f=n.default.asUintN(64,n.default.multiply(o(n.default.asUintN(64,n.default.multiply(this.s[1],n.default.BigInt(5))),7),n.default.BigInt(9))),x=n.default.asUintN(64,n.default.leftShift(this.s[1],n.default.BigInt(17)));return this.s[2]=n.default.asUintN(64,n.default.bitwiseXor(this.s[2],n.default.BigInt(this.s[0]))),this.s[3]=n.default.asUintN(64,n.default.bitwiseXor(this.s[3],n.default.BigInt(this.s[1]))),this.s[1]=n.default.asUintN(64,n.default.bitwiseXor(this.s[1],n.default.BigInt(this.s[2]))),this.s[0]=n.default.asUintN(64,n.default.bitwiseXor(this.s[0],n.default.BigInt(this.s[3]))),this.s[2]=n.default.asUintN(64,n.default.bitwiseXor(this.s[2],n.default.BigInt(x))),this.s[3]=n.default.asUintN(64,o(this.s[3],45)),f}}return xoshiro.default=c,xoshiro}var precomputeAlias=function(t,e){var r=t.reduce(function(p,g){if(g<0)throw new Error("Probability must be a positive: p["+t.indexOf(g)+"]="+g);return p+g},0);if(r===0)throw new Error("Probability sum must be greater than zero.");for(var n=t.map(function(p){return p*e/r}),s={prob:new Array(e),alias:new Array(e)},o=[],c=[],u=e-1;u>=0;u--)n[u]<1?o.push(u):c.push(u);for(;o.length>0&&c.length>0;){var f=o.pop(),x=c.pop();s.prob[f]=n[f],s.alias[f]=x,n[x]=n[x]+n[f]-1,n[x]<1?o.push(x):c.push(x)}for(;c.length>0;)s.prob[c.pop()]=1;for(;o.length>0;)s.prob[o.pop()]=1;return s},draw=function(t,e,r){var n=Math.floor(r()*t.prob.length);return e[r()<t.prob[n]?n:t.alias[n]]},next=function(t,e,r,n){if(n===void 0&&(n=1),n===1)return draw(t,e,r);for(var s=[],o=0;o<n;o++)s.push(draw(t,e,r));return s},sample=function(t,e,r){if(r===void 0&&(r=Math.random),!Array.isArray(t))throw new Error("Probabilities must be an array.");if(t.length===0)throw new Error("Probabilities array must not be empty.");var n=t.length,s=e??Array.from({length:n},function(c,u){return u}),o=precomputeAlias(t,n);return{next:function(c){return c===void 0&&(c=1),next(o,s,r,c)}}};const esm=Object.freeze(Object.defineProperty({__proto__:null,default:sample},Symbol.toStringTag,{value:"Module"})),require$$2=getAugmentedNamespace(esm);var hasRequiredFountainUtils;function requireFountainUtils(){return hasRequiredFountainUtils||(hasRequiredFountainUtils=1,(function(t){var e=fountainUtils&&fountainUtils.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(t,"__esModule",{value:!0}),t.chooseFragments=t.shuffle=t.chooseDegree=void 0;const r=requireUtils$7(),n=e(requireXoshiro()),s=e(require$$2),o=(f,x)=>{const p=[...new Array(f)].map((y,b)=>1/(b+1));return s.default(p,void 0,x.nextDouble).next()+1};t.chooseDegree=o;const c=(f,x)=>{let p=[...f],g=[];for(;p.length>0;){let y=x.nextInt(0,p.length-1),b=p[y];p.splice(y,1),g.push(b)}return g};t.shuffle=c;const u=(f,x,p)=>{if(f<=x)return[f-1];{const g=Buffer.concat([r.intToBytes(f),r.intToBytes(p)]),y=new n.default(g),b=t.chooseDegree(x,y),R=[...new Array(x)].map((k,Re)=>Re);return t.shuffle(R,y).slice(0,b)}};t.chooseFragments=u})(fountainUtils)),fountainUtils}var hasRequiredFountainEncoder;function requireFountainEncoder(){if(hasRequiredFountainEncoder)return fountainEncoder;hasRequiredFountainEncoder=1;var t=fountainEncoder&&fountainEncoder.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(fountainEncoder,"__esModule",{value:!0}),fountainEncoder.FountainEncoderPart=void 0;const e=t(requireAssert()),r=requireUtils$7(),n=requireFountainUtils(),s=requireCbor();class o{constructor(f,x,p,g,y){this._seqNum=f,this._seqLength=x,this._messageLength=p,this._checksum=g,this._fragment=y}get messageLength(){return this._messageLength}get fragment(){return this._fragment}get seqNum(){return this._seqNum}get seqLength(){return this._seqLength}get checksum(){return this._checksum}cbor(){const f=s.cborEncode([this._seqNum,this._seqLength,this._messageLength,this._checksum,this._fragment]);return Buffer.from(f)}description(){return`seqNum:${this._seqNum}, seqLen:${this._seqLength}, messageLen:${this._messageLength}, checksum:${this._checksum}, data:${this._fragment.toString("hex")}`}static fromCBOR(f){const[x,p,g,y,b]=s.cborDecode(f);return e.default(typeof x=="number"),e.default(typeof p=="number"),e.default(typeof g=="number"),e.default(typeof y=="number"),e.default(Buffer.isBuffer(b)&&b.length>0),new o(x,p,g,y,Buffer.from(b))}}fountainEncoder.FountainEncoderPart=o;class c{constructor(f,x=100,p=0,g=10){const y=c.findNominalFragmentLength(f.length,g,x);this._messageLength=f.length,this._fragments=c.partitionMessage(f,y),this.fragmentLength=y,this.seqNum=r.toUint32(p),this.checksum=r.getCRC(f)}get fragmentsLength(){return this._fragments.length}get fragments(){return this._fragments}get messageLength(){return this._messageLength}isComplete(){return this.seqNum>=this._fragments.length}isSinglePart(){return this._fragments.length===1}seqLength(){return this._fragments.length}mix(f){return f.reduce((x,p)=>r.bufferXOR(this._fragments[p],x),Buffer.alloc(this.fragmentLength,0))}nextPart(){this.seqNum=r.toUint32(this.seqNum+1);const f=n.chooseFragments(this.seqNum,this._fragments.length,this.checksum),x=this.mix(f);return new o(this.seqNum,this._fragments.length,this._messageLength,this.checksum,x)}static findNominalFragmentLength(f,x,p){e.default(f>0),e.default(x>0),e.default(p>=x);const g=Math.ceil(f/x);let y=0;for(let b=1;b<=g&&(y=Math.ceil(f/b),!(y<=p));b++);return y}static partitionMessage(f,x){let p=Buffer.from(f),g,y=[];for(;p.length>0;)[g,p]=r.split(p,-x),g=Buffer.alloc(x,0).fill(g,0,g.length),y.push(g);return y}}return fountainEncoder.default=c,fountainEncoder}var bytewords={},hasRequiredBytewords;function requireBytewords(){if(hasRequiredBytewords)return bytewords;hasRequiredBytewords=1;var t=bytewords&&bytewords.__importDefault||function(Fe){return Fe&&Fe.__esModule?Fe:{default:Fe}};Object.defineProperty(bytewords,"__esModule",{value:!0});const e=t(requireAssert()),r=requireUtils$7(),n="ableacidalsoapexaquaarchatomauntawayaxisbackbaldbarnbeltbetabiasbluebodybragbrewbulbbuzzcalmcashcatschefcityclawcodecolacookcostcruxcurlcuspcyandarkdatadaysdelidicedietdoordowndrawdropdrumdulldutyeacheasyechoedgeepicevenexamexiteyesfactfairfernfigsfilmfishfizzflapflewfluxfoxyfreefrogfuelfundgalagamegeargemsgiftgirlglowgoodgraygrimgurugushgyrohalfhanghardhawkheathelphighhillholyhopehornhutsicedideaidleinchinkyintoirisironitemjadejazzjoinjoltjowljudojugsjumpjunkjurykeepkenokeptkeyskickkilnkingkitekiwiknoblamblavalazyleaflegsliarlimplionlistlogoloudloveluaulucklungmainmanymathmazememomenumeowmildmintmissmonknailnavyneednewsnextnoonnotenumbobeyoboeomitonyxopenovalowlspaidpartpeckplaypluspoempoolposepuffpumapurrquadquizraceramprealredorichroadrockroofrubyruinrunsrustsafesagascarsetssilkskewslotsoapsolosongstubsurfswantacotasktaxitenttiedtimetinytoiltombtoystriptunatwinuglyundouniturgeuservastveryvetovialvibeviewvisavoidvowswallwandwarmwaspwavewaxywebswhatwhenwhizwolfworkyankyawnyellyogayurtzapszerozestzinczonezoom";let s=[];const o=256,c=4,u=2;var f;(function(Fe){Fe.STANDARD="standard",Fe.URI="uri",Fe.MINIMAL="minimal"})(f||(f={}));const x=Fe=>n.slice(Fe*c,Fe*c+c),p=Fe=>{const O=x(Fe);return`${O[0]}${O[c-1]}`},g=Fe=>{const O=r.getCRCHex(Buffer.from(Fe,"hex"));return`${Fe}${O}`},y=(Fe,O)=>{const $e=g(Fe);return Buffer.from($e,"hex").reduce((W,We)=>[...W,x(We)],[]).join(O)},b=Fe=>{const O=g(Fe);return Buffer.from(O,"hex").reduce((q,W)=>q+p(W),"")},R=(Fe,O)=>{e.default(Fe.length===O,"Invalid Bytewords: word.length does not match wordLength provided");const $e=26;if(s.length===0){const Xe=$e*$e;s=[...new Array(Xe)].map(()=>-1);for(let it=0;it<o;it++){const Ve=x(it);let v=Ve[0].charCodeAt(0)-97,Ce=(Ve[3].charCodeAt(0)-97)*$e+v;s[Ce]=it}}let ze=Fe[0].toLowerCase().charCodeAt(0)-97,q=Fe[O==4?3:1].toLowerCase().charCodeAt(0)-97;e.default(0<=ze&&ze<$e&&0<=q&&q<$e,"Invalid Bytewords: invalid word");let W=q*$e+ze,We=s[W];if(e.default(We!==-1,"Invalid Bytewords: value not in lookup table"),O==c){const Xe=x(We);let it=Fe[1].toLowerCase(),Ve=Fe[2].toLowerCase();e.default(it===Xe[1]&&Ve===Xe[2],"Invalid Bytewords: invalid middle letters of word")}return Buffer.from([We]).toString("hex")},D=(Fe,O,$e)=>{const q=($e==c?Fe.split(O):r.partition(Fe,2)).map(it=>R(it,$e)).join("");e.default(q.length>=5,"Invalid Bytewords: invalid decoded string length");const[W,We]=r.split(Buffer.from(q,"hex"),4),Xe=r.getCRCHex(W);return e.default(Xe===We.toString("hex"),"Invalid Checksum"),W.toString("hex")},k=(Fe,O=f.MINIMAL)=>{switch(O){case f.STANDARD:return D(Fe," ",c);case f.URI:return D(Fe,"-",c);case f.MINIMAL:return D(Fe,"",u);default:throw new Error(`Invalid style ${O}`)}},Re=(Fe,O=f.MINIMAL)=>{switch(O){case f.STANDARD:return y(Fe," ");case f.URI:return y(Fe,"-");case f.MINIMAL:return b(Fe);default:throw new Error(`Invalid style ${O}`)}};return bytewords.default={decode:k,encode:Re,STYLES:f},bytewords}var hasRequiredUrEncoder;function requireUrEncoder(){if(hasRequiredUrEncoder)return urEncoder;hasRequiredUrEncoder=1;var t=urEncoder&&urEncoder.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(urEncoder,"__esModule",{value:!0});const e=t(requireFountainEncoder()),r=t(requireBytewords());class n{constructor(o,c,u,f){this.ur=o,this.fountainEncoder=new e.default(o.cbor,c,u,f)}get fragmentsLength(){return this.fountainEncoder.fragmentsLength}get fragments(){return this.fountainEncoder.fragments}get messageLength(){return this.fountainEncoder.messageLength}get cbor(){return this.ur.cbor}encodeWhole(){return[...new Array(this.fragmentsLength)].map(()=>this.nextPart())}nextPart(){const o=this.fountainEncoder.nextPart();return this.fountainEncoder.isSinglePart()?n.encodeSinglePart(this.ur):n.encodePart(this.ur.type,o)}static encodeUri(o,c){const u=c.join("/");return[o,u].join(":")}static encodeUR(o){return n.encodeUri("ur",o)}static encodePart(o,c){const u=`${c.seqNum}-${c.seqLength}`,f=r.default.encode(c.cbor().toString("hex"),r.default.STYLES.MINIMAL);return n.encodeUR([o,u,f])}static encodeSinglePart(o){const c=r.default.encode(o.cbor.toString("hex"),r.default.STYLES.MINIMAL);return n.encodeUR([o.type,c])}}return urEncoder.default=n,urEncoder}var urDecoder={},fountainDecoder={},hasRequiredFountainDecoder;function requireFountainDecoder(){if(hasRequiredFountainDecoder)return fountainDecoder;hasRequiredFountainDecoder=1,Object.defineProperty(fountainDecoder,"__esModule",{value:!0}),fountainDecoder.FountainDecoderPart=void 0;const t=requireUtils$7(),e=requireFountainUtils(),r=requireErrors$1();class n{constructor(c,u){this._indexes=c,this._fragment=u}get indexes(){return this._indexes}get fragment(){return this._fragment}static fromEncoderPart(c){const u=e.chooseFragments(c.seqNum,c.seqLength,c.checksum),f=c.fragment;return new n(u,f)}isSimple(){return this.indexes.length===1}}fountainDecoder.FountainDecoderPart=n;class s{constructor(){this.result=void 0,this.expectedMessageLength=0,this.expectedChecksum=0,this.expectedFragmentLength=0,this.processedPartsCount=0,this.expectedPartIndexes=[],this.lastPartIndexes=[],this.queuedParts=[],this.receivedPartIndexes=[],this.mixedParts=[],this.simpleParts=[]}validatePart(c){if(this.expectedPartIndexes.length===0)[...new Array(c.seqLength)].forEach((u,f)=>this.expectedPartIndexes.push(f)),this.expectedMessageLength=c.messageLength,this.expectedChecksum=c.checksum,this.expectedFragmentLength=c.fragment.length;else if(this.expectedPartIndexes.length!==c.seqLength||this.expectedMessageLength!==c.messageLength||this.expectedChecksum!==c.checksum||this.expectedFragmentLength!==c.fragment.length)return!1;return!0}reducePartByPart(c,u){if(t.arrayContains(c.indexes,u.indexes)){const f=t.setDifference(c.indexes,u.indexes),x=t.bufferXOR(c.fragment,u.fragment);return new n(f,x)}else return c}reduceMixedBy(c){const u=[];this.mixedParts.map(({value:f})=>this.reducePartByPart(f,c)).forEach(f=>{f.isSimple()?this.queuedParts.push(f):u.push({key:f.indexes,value:f})}),this.mixedParts=u}processSimplePart(c){const u=c.indexes[0];if(!this.receivedPartIndexes.includes(u))if(this.simpleParts.push({key:c.indexes,value:c}),this.receivedPartIndexes.push(u),t.arraysEqual(this.receivedPartIndexes,this.expectedPartIndexes)){const f=this.simpleParts.map(({value:g})=>g).sort((g,y)=>g.indexes[0]-y.indexes[0]),x=s.joinFragments(f.map(g=>g.fragment),this.expectedMessageLength);t.getCRC(x)===this.expectedChecksum?this.result=x:this.error=new r.InvalidChecksumError}else this.reduceMixedBy(c)}processMixedPart(c){if(this.mixedParts.some(({key:f})=>t.arraysEqual(f,c.indexes)))return;let u=this.simpleParts.reduce((f,{value:x})=>this.reducePartByPart(f,x),c);u=this.mixedParts.reduce((f,{value:x})=>this.reducePartByPart(f,x),u),u.isSimple()?this.queuedParts.push(u):(this.reduceMixedBy(u),this.mixedParts.push({key:u.indexes,value:u}))}processQueuedItem(){if(this.queuedParts.length===0)return;const c=this.queuedParts.shift();c.isSimple()?this.processSimplePart(c):this.processMixedPart(c)}receivePart(c){if(this.isComplete()||!this.validatePart(c))return!1;const u=n.fromEncoderPart(c);for(this.lastPartIndexes=u.indexes,this.queuedParts.push(u);!this.isComplete()&&this.queuedParts.length>0;)this.processQueuedItem();return this.processedPartsCount+=1,!0}isComplete(){return this.result!==void 0&&this.result.length>0}isSuccess(){return!!(this.error===void 0&&this.isComplete())}resultMessage(){return this.isSuccess()?this.result:Buffer.from([])}isFailure(){return this.error!==void 0}resultError(){return this.error?this.error.message:""}expectedPartCount(){return this.expectedPartIndexes.length}getExpectedPartIndexes(){return[...this.expectedPartIndexes]}getReceivedPartIndexes(){return[...this.receivedPartIndexes]}getLastPartIndexes(){return[...this.lastPartIndexes]}estimatedPercentComplete(){if(this.isComplete())return 1;const c=this.expectedPartCount();return c===0?0:Math.min(.99,this.processedPartsCount/(c*1.75))}getProgress(){if(this.isComplete())return 1;const c=this.expectedPartCount();return c===0?0:this.receivedPartIndexes.length/c}}return fountainDecoder.default=s,s.joinFragments=(o,c)=>Buffer.concat(o).slice(0,c),fountainDecoder}var hasRequiredUrDecoder;function requireUrDecoder(){if(hasRequiredUrDecoder)return urDecoder;hasRequiredUrDecoder=1;var t=urDecoder&&urDecoder.__importDefault||function(x){return x&&x.__esModule?x:{default:x}};Object.defineProperty(urDecoder,"__esModule",{value:!0});const e=t(requireFountainDecoder()),r=t(requireBytewords()),n=t(requireAssert()),s=requireUtils$7(),o=requireErrors$1(),c=t(requireUr()),u=requireFountainEncoder();class f{constructor(p=new e.default,g="bytes"){this.fountainDecoder=p,this.type=g,n.default(s.isURType(g),"Invalid UR type"),this.expected_type=""}static decodeBody(p,g){const y=r.default.decode(g,r.default.STYLES.MINIMAL);return new c.default(Buffer.from(y,"hex"),p)}validatePart(p){return this.expected_type?this.expected_type===p:s.isURType(p)?(this.expected_type=p,!0):!1}static decode(p){const[g,y]=this.parse(p);if(y.length===0)throw new o.InvalidPathLengthError;const b=y[0];return f.decodeBody(g,b)}static parse(p){const g=p.toLowerCase();if(g.slice(0,3)!=="ur:")throw new o.InvalidSchemeError;const b=g.slice(3).split("/"),R=b[0];if(b.length<2)throw new o.InvalidPathLengthError;if(!s.isURType(R))throw new o.InvalidTypeError;return[R,b.slice(1)]}static parseSequenceComponent(p){const g=p.split("-");if(g.length!==2)throw new o.InvalidSequenceComponentError;const y=s.toUint32(Number(g[0])),b=Number(g[1]);if(y<1||b<1)throw new o.InvalidSequenceComponentError;return[y,b]}receivePart(p){if(this.result!==void 0)return!1;const[g,y]=f.parse(p);if(!this.validatePart(g))return!1;if(y.length===1)return this.result=f.decodeBody(g,y[0]),!0;if(y.length!==2)throw new o.InvalidPathLengthError;const[b,R]=y,[D,k]=f.parseSequenceComponent(b),Re=r.default.decode(R,r.default.STYLES.MINIMAL),Fe=u.FountainEncoderPart.fromCBOR(Re);return D!==Fe.seqNum||k!==Fe.seqLength||!this.fountainDecoder.receivePart(Fe)?!1:(this.fountainDecoder.isSuccess()?this.result=new c.default(this.fountainDecoder.resultMessage(),g):this.fountainDecoder.isFailure()&&(this.error=new o.InvalidSchemeError),!0)}resultUR(){return this.result?this.result:new c.default(Buffer.from([]))}isComplete(){return this.result&&this.result.cbor.length>0}isSuccess(){return!this.error&&this.isComplete()}isError(){return this.error!==void 0}resultError(){return this.error?this.error.message:""}expectedPartCount(){return this.fountainDecoder.expectedPartCount()}expectedPartIndexes(){return this.fountainDecoder.getExpectedPartIndexes()}receivedPartIndexes(){return this.fountainDecoder.getReceivedPartIndexes()}lastPartIndexes(){return this.fountainDecoder.getLastPartIndexes()}estimatedPercentComplete(){return this.fountainDecoder.estimatedPercentComplete()}getProgress(){return this.fountainDecoder.getProgress()}}return urDecoder.default=f,urDecoder}var hasRequiredDist$3;function requireDist$3(){if(hasRequiredDist$3)return dist$4;hasRequiredDist$3=1;var t=dist$4&&dist$4.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(dist$4,"__esModule",{value:!0}),dist$4.URDecoder=dist$4.UREncoder=dist$4.UR=void 0;const e=t(requireUr());dist$4.UR=e.default;const r=t(requireUrEncoder());dist$4.UREncoder=r.default;const n=t(requireUrDecoder());return dist$4.URDecoder=n.default,dist$4}var distExports$3=requireDist$3();const AnimatedQRCode=({data:t,type:e="bytes"})=>{const[r,n]=reactExports.useState(""),s=reactExports.useRef(null),o=c=>{const u=c.length;let f;if(u<24)f=Buffer$1.from([64|u]);else if(u<256)f=Buffer$1.from([88,u]);else if(u<65536){const x=Buffer$1.alloc(3);x[0]=89,x.writeUInt16BE(u,1),f=x}else{const x=Buffer$1.alloc(5);x[0]=90,x.writeUInt32BE(u,1),f=x}return Buffer$1.concat([f,c])};return reactExports.useEffect(()=>{const c=Buffer$1.from(t),u=o(c),f=new distExports$3.UREncoder(new distExports$3.UR(u,e),200);s.current=f;const x=setInterval(()=>{s.current&&n(s.current.nextPart())},100);return()=>clearInterval(x)},[t,e]),r?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx("div",{className:"bg-white p-4 rounded-xl",children:jsxRuntimeExports.jsx(QRCodeSVG,{value:r,size:256,level:"L"})}),jsxRuntimeExports.jsx("div",{className:"mt-4 text-center space-y-1",children:(()=>{const c=r.split("/");return c.length>2&&c[1].includes("-")?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"animate-pulse w-2 h-2 rounded-full bg-amber-500"}),jsxRuntimeExports.jsx("p",{className:"text-amber-500 text-xs font-bold uppercase tracking-wider",children:"ANIMATED (FOUNTAIN) QR"})]}):null})()})]}):null},useRequestStore=create(t=>({requests:[],addRequest:e=>t(r=>r.requests.some(n=>n.id===e.id)?r:{requests:[...r.requests,e]}),removeRequest:e=>t(r=>({requests:r.requests.filter(n=>n.id!==e)})),clearRequests:()=>t({requests:[]})}));var lib$1={},types={},hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,Object.defineProperty(types,"__esModule",{value:!0})),types}var ee={},taskCollection$1={},taskCollection={},utils$6={},hasRequiredUtils$6;function requireUtils$6(){if(hasRequiredUtils$6)return utils$6;hasRequiredUtils$6=1,Object.defineProperty(utils$6,"__esModule",{value:!0}),utils$6._fast_remove_single=void 0;function t(e,r){r!==-1&&(r===0?e.shift():r===e.length-1?e.length=e.length-1:e.splice(r,1))}return utils$6._fast_remove_single=t,utils$6}var bakeCollection={},hasRequiredBakeCollection;function requireBakeCollection(){return hasRequiredBakeCollection||(hasRequiredBakeCollection=1,(function(exports$1){Object.defineProperty(exports$1,"__esModule",{value:!0}),exports$1.bakeCollectionVariadic=exports$1.bakeCollectionAwait=exports$1.bakeCollection=exports$1.BAKED_EMPTY_FUNC=void 0,exports$1.BAKED_EMPTY_FUNC=(function(){});var FORLOOP_FALLBACK=1500;function generateArgsDefCode(t){var e="";if(t===0)return e;for(var r=0;r<t-1;++r)e+="arg"+String(r)+", ";return e+="arg"+String(t-1),e}function generateBodyPartsCode(t,e){for(var r="",n="",s=0;s<e;++s)r+="var f".concat(s," = collection[").concat(s,`];
`),n+="f".concat(s,"(").concat(t,`)
`);return{funcDefCode:r,funcCallCode:n}}function generateBodyPartsVariadicCode(t){for(var e="",r="",n=0;n<t;++n)e+="var f".concat(n," = collection[").concat(n,`];
`),r+="f".concat(n,`.apply(undefined, arguments)
`);return{funcDefCode:e,funcCallCode:r}}function bakeCollection(collection,fixedArgsNum){if(collection.length===0)return exports$1.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                `).concat(funcCallCode,`
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);collection.length%10===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 10) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                        collection[i+4](`).concat(argsDefCode,`);
                        collection[i+5](`).concat(argsDefCode,`);
                        collection[i+6](`).concat(argsDefCode,`);
                        collection[i+7](`).concat(argsDefCode,`);
                        collection[i+8](`).concat(argsDefCode,`);
                        collection[i+9](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%4===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 4) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%3===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 3) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                    }
                });
            })`):funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; ++i) {
                        collection[i](`).concat(argsDefCode,`);
                    }
                });
            })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports$1.bakeCollection=bakeCollection;function bakeCollectionAwait(collection,fixedArgsNum){if(collection.length===0)return exports$1.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                return Promise.all([ `).concat(funcCallCode,` ]);
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=`(function(collection) {
            return (function(`.concat(argsDefCode,`) {
                var promises = Array(collection.length);
                for (var i = 0; i < collection.length; ++i) {
                    promises[i] = collection[i](`).concat(argsDefCode,`);
                }
                return Promise.all(promises);
            });
        })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports$1.bakeCollectionAwait=bakeCollectionAwait;function bakeCollectionVariadic(collection){if(collection.length===0)return exports$1.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function() {
                `).concat(funcCallCode,`
            });
        })`)}else funcFactoryCode=`(function(collection) {
            return (function() {
                for (var i = 0; i < collection.length; ++i) {
                    collection[i].apply(undefined, arguments);
                }
            });
        })`;{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports$1.bakeCollectionVariadic=bakeCollectionVariadic})(bakeCollection)),bakeCollection}var hasRequiredTaskCollection$1;function requireTaskCollection$1(){if(hasRequiredTaskCollection$1)return taskCollection;hasRequiredTaskCollection$1=1;var t=taskCollection&&taskCollection.__spreadArray||function(O,$e,ze){if(ze||arguments.length===2)for(var q=0,W=$e.length,We;q<W;q++)(We||!(q in $e))&&(We||(We=Array.prototype.slice.call($e,0,q)),We[q]=$e[q]);return O.concat(We||Array.prototype.slice.call($e))};Object.defineProperty(taskCollection,"__esModule",{value:!0}),taskCollection.TaskCollection=void 0;var e=requireUtils$6(),r=requireBakeCollection();function n(O,$e){var ze=this.length;if(ze>1)if($e){var q;(q=this._tasks).push.apply(q,arguments),this.length+=arguments.length}else this._tasks.push(O),this.length++;else if($e){if(ze===1){var W=Array(1+arguments.length);W.push(W),W.push.apply(W,arguments),this._tasks=W}else{var W=Array(arguments.length);W.push.apply(W,arguments),this._tasks=W}this.length+=arguments.length}else ze===1?this._tasks=[this._tasks,O]:this._tasks=O,this.length++}function s(O,$e){var ze=this.length;if(ze>1)if($e){var q;(q=this._tasks).push.apply(q,arguments),this.length+=arguments.length}else this._tasks.push(O),this.length++;else if($e){if(ze===1){var W=Array(1+arguments.length);W.push(W),W.push.apply(W,arguments),this._tasks=W}else{var W=Array(arguments.length);W.push.apply(W,arguments),this._tasks=W}this.length+=arguments.length}else ze===1?this._tasks=[this._tasks,O]:this._tasks=O,this.length++;this.firstEmitBuildStrategy?this.call=g:this.rebuild()}function o(O){this.length!==0&&(this.length===1?this._tasks===O&&(this.length=0):((0,e._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(O)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function c(O){if(this.length!==0){if(this.length===1)if(this._tasks===O&&(this.length=0),this.firstEmitBuildStrategy){this.call=r.BAKED_EMPTY_FUNC;return}else{this.rebuild();return}else(0,e._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(O)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length;this.firstEmitBuildStrategy?this.call=g:this.rebuild()}}function u(O){for(var $e,ze=[],q=1;q<arguments.length;q++)ze[q-1]=arguments[q];this.length===0?(this._tasks=ze,this.length=1):this.length===1?(ze.unshift(this._tasks),this._tasks=ze,this.length=this._tasks.length):(($e=this._tasks).splice.apply($e,t([O,0],ze,!1)),this.length=this._tasks.length)}function f(O){for(var $e,ze=[],q=1;q<arguments.length;q++)ze[q-1]=arguments[q];this.length===0?(this._tasks=ze,this.length=1):this.length===1?(ze.unshift(this._tasks),this._tasks=ze,this.length=this._tasks.length):(($e=this._tasks).splice.apply($e,t([O,0],ze,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=g:this.rebuild()}function x(){this.length===0?this.call=r.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,r.bakeCollection)(this._tasks,this.argsNum)}function p(){this.length===0?this.call=r.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,r.bakeCollectionAwait)(this._tasks,this.argsNum)}function g(){this.rebuild(),this.call.apply(void 0,arguments)}var y=(function(){function O($e,ze,q,W){ze===void 0&&(ze=!0),q===void 0&&(q=null),W===void 0&&(W=!1),this.awaitTasks=W,this.call=r.BAKED_EMPTY_FUNC,this.argsNum=$e,this.firstEmitBuildStrategy=!0,W?this.rebuild=p.bind(this):this.rebuild=x.bind(this),this.setAutoRebuild(ze),q?typeof q=="function"?(this._tasks=q,this.length=1):(this._tasks=q,this.length=q.length):(this._tasks=null,this.length=0),ze&&this.rebuild()}return O})();taskCollection.TaskCollection=y;function b(){this._tasks=null,this.length=0,this.call=r.BAKED_EMPTY_FUNC}function R(){this._tasks=null,this.length=0,this.call=r.BAKED_EMPTY_FUNC}function D(O){this.argsNum<O&&(this.argsNum=O,this.firstEmitBuildStrategy?this.call=g:this.rebuild())}function k(O){O?(this.push=s.bind(this),this.insert=f.bind(this),this.removeLast=c.bind(this)):(this.push=n.bind(this),this.insert=u.bind(this),this.removeLast=o.bind(this))}function Re(){return this.length===0?[]:this.length===1?[this._tasks]:this._tasks}function Fe(O){O.length===0?(this.length=0,this.call=r.BAKED_EMPTY_FUNC):O.length===1?(this.length=1,this.call=O[0],this._tasks=O[0]):(this.length=O.length,this._tasks=O,this.firstEmitBuildStrategy?this.call=g:this.rebuild())}return y.prototype.fastClear=b,y.prototype.clear=R,y.prototype.growArgsNum=D,y.prototype.setAutoRebuild=k,y.prototype.tasksAsArray=Re,y.prototype.setTasks=Fe,taskCollection}var hasRequiredTaskCollection;function requireTaskCollection(){return hasRequiredTaskCollection||(hasRequiredTaskCollection=1,(function(t){var e=taskCollection$1&&taskCollection$1.__createBinding||(Object.create?(function(n,s,o,c){c===void 0&&(c=o);var u=Object.getOwnPropertyDescriptor(s,o);(!u||("get"in u?!s.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(n,c,u)}):(function(n,s,o,c){c===void 0&&(c=o),n[c]=s[o]})),r=taskCollection$1&&taskCollection$1.__exportStar||function(n,s){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,n,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(requireTaskCollection$1(),t)})(taskCollection$1)),taskCollection$1}var utils$5={},hasRequiredUtils$5;function requireUtils$5(){if(hasRequiredUtils$5)return utils$5;hasRequiredUtils$5=1,Object.defineProperty(utils$5,"__esModule",{value:!0}),utils$5.nullObj=void 0;function t(){var e={};return e.__proto__=null,e}return utils$5.nullObj=t,utils$5}var hasRequiredEe;function requireEe(){if(hasRequiredEe)return ee;hasRequiredEe=1;var t=ee&&ee.__spreadArray||function(ze,q,W){if(W||arguments.length===2)for(var We=0,Xe=q.length,it;We<Xe;We++)(it||!(We in q))&&(it||(it=Array.prototype.slice.call(q,0,We)),it[We]=q[We]);return ze.concat(it||Array.prototype.slice.call(q))};Object.defineProperty(ee,"__esModule",{value:!0}),ee.EventEmitter=void 0;var e=requireTaskCollection(),r=requireUtils$6(),n=requireUtils$5();function s(ze,q,W,We,Xe,it){var Ve=this.events[ze];if(Ve){if(Ve.length===0)return!1;if(Ve.argsNum<6)Ve.call(q,W,We,Xe,it);else{for(var v=new Array(Ve.argsNum),I=0,Ce=v.length;I<Ce;++I)v[I]=arguments[I+1];Ve.call.apply(void 0,v)}return!0}return!1}function o(ze,q,W,We,Xe,it){var Ve=this.events[ze],v;if(Ve!==void 0){if(Ve.length===0)return!1;if(Ve.argsNum<6)Ve.call(q,W,We,Xe,it);else{v=new Array(Ve.argsNum);for(var I=0,Ce=v.length;I<Ce;++I)v[I]=arguments[I+1];Ve.call.apply(void 0,v)}}var P=this.onceEvents[ze];if(P){if(typeof P=="function")if(this.onceEvents[ze]=void 0,arguments.length<6)P(q,W,We,Xe,it);else{if(v===void 0){v=new Array(arguments.length-1);for(var I=0,Ce=v.length;I<Ce;++I)v[I]=arguments[I+1]}P.apply(void 0,v)}else{var _e=P;if(this.onceEvents[ze]=void 0,arguments.length<6)for(var I=0;I<_e.length;++I)_e[I](q,W,We,Xe,it);else{if(v===void 0){v=new Array(arguments.length-1);for(var I=0,Ce=v.length;I<Ce;++I)v[I]=arguments[I+1]}for(var I=0;I<_e.length;++I)_e[I].apply(void 0,v)}}return!0}return Ve!==void 0}var c=(function(){function ze(){this.events=(0,n.nullObj)(),this.onceEvents=(0,n.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(ze.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),ze})();ee.EventEmitter=c;function u(ze,q){switch(this.emit===s&&(this.emit=o),typeof this.onceEvents[ze]){case"undefined":this.onceEvents[ze]=q,typeof ze=="symbol"&&this._symbolKeys.add(ze);break;case"function":this.onceEvents[ze]=[this.onceEvents[ze],q];break;case"object":this.onceEvents[ze].push(q)}return this}function f(ze,q,W){if(W===void 0&&(W=q.length),typeof q!="function")throw new TypeError("The listener must be a function");var We=this.events[ze];return We?(We.push(q),We.growArgsNum(W),this.maxListeners!==1/0&&this.maxListeners<=We.length&&console.warn('Maximum event listeners for "'.concat(String(ze),'" event!'))):(this.events[ze]=new e.TaskCollection(W,!0,q,!1),typeof ze=="symbol"&&this._symbolKeys.add(ze)),this}function x(ze,q){var W=this.events[ze];W&&W.removeLast(q);var We=this.onceEvents[ze];return We&&(typeof We=="function"?this.onceEvents[ze]=void 0:typeof We=="object"&&(We.length===1&&We[0]===q?this.onceEvents[ze]=void 0:(0,r._fast_remove_single)(We,We.lastIndexOf(q)))),this}function p(ze,q,W,We){W===void 0&&(W=this),We===void 0&&(We=q.length),this.boundFuncs||(this.boundFuncs=new Map);var Xe=q.bind(W);return this.boundFuncs.set(q,Xe),this.addListener(ze,Xe,We)}function g(ze,q){var W,We,Xe=(W=this.boundFuncs)===null||W===void 0?void 0:W.get(q);return(We=this.boundFuncs)===null||We===void 0||We.delete(q),this.removeListener(ze,Xe)}function y(ze){return this.events[ze]&&!!this.events[ze].length}function b(ze,q,W){if(W===void 0&&(W=q.length),typeof q!="function")throw new TypeError("The listener must be a function");var We=this.events[ze];return!We||!(We instanceof e.TaskCollection)?(We=this.events[ze]=new e.TaskCollection(W,!0,q,!1),typeof ze=="symbol"&&this._symbolKeys.add(ze)):(We.insert(0,q),We.growArgsNum(W),this.maxListeners!==1/0&&this.maxListeners<=We.length&&console.warn('Maximum event listeners for "'.concat(String(ze),'" event!'))),this}function R(ze,q){this.emit===s&&(this.emit=o);var W=this.onceEvents[ze];return W?typeof W!="object"?(this.onceEvents[ze]=[q,W],typeof ze=="symbol"&&this._symbolKeys.add(ze)):(W.unshift(q),this.maxListeners!==1/0&&this.maxListeners<=W.length&&console.warn('Maximum event listeners for "'.concat(String(ze),'" once event!'))):(this.onceEvents[ze]=[q],typeof ze=="symbol"&&this._symbolKeys.add(ze)),this}function D(ze){return ze===void 0?(this.events=(0,n.nullObj)(),this.onceEvents=(0,n.nullObj)(),this._symbolKeys=new Set):(this.events[ze]=void 0,this.onceEvents[ze]=void 0,typeof ze=="symbol"&&this._symbolKeys.delete(ze)),this}function k(ze){return this.maxListeners=ze,this}function Re(){return this.maxListeners}function Fe(ze){return this.emit===s?this.events[ze]?this.events[ze].tasksAsArray().slice():[]:this.events[ze]&&this.onceEvents[ze]?t(t([],this.events[ze].tasksAsArray(),!0),typeof this.onceEvents[ze]=="function"?[this.onceEvents[ze]]:this.onceEvents[ze],!0):this.events[ze]?this.events[ze].tasksAsArray():this.onceEvents[ze]?typeof this.onceEvents[ze]=="function"?[this.onceEvents[ze]]:this.onceEvents[ze]:[]}function O(){var ze=this;if(this.emit===s){var q=Object.keys(this.events);return t(t([],q,!0),Array.from(this._symbolKeys),!0).filter(function(We){return We in ze.events&&ze.events[We]&&ze.events[We].length})}else{var q=Object.keys(this.events).filter(function(Xe){return ze.events[Xe]&&ze.events[Xe].length}),W=Object.keys(this.onceEvents).filter(function(Xe){return ze.onceEvents[Xe]&&ze.onceEvents[Xe].length});return t(t(t([],q,!0),W,!0),Array.from(this._symbolKeys).filter(function(Xe){return Xe in ze.events&&ze.events[Xe]&&ze.events[Xe].length||Xe in ze.onceEvents&&ze.onceEvents[Xe]&&ze.onceEvents[Xe].length}),!0)}}function $e(ze){return this.emit===s?this.events[ze]&&this.events[ze].length||0:(this.events[ze]&&this.events[ze].length||0)+(this.onceEvents[ze]&&this.onceEvents[ze].length||0)}return c.prototype.emit=s,c.prototype.on=f,c.prototype.once=u,c.prototype.addListener=f,c.prototype.removeListener=x,c.prototype.addListenerBound=p,c.prototype.removeListenerBound=g,c.prototype.hasListeners=y,c.prototype.prependListener=b,c.prototype.prependOnceListener=R,c.prototype.off=x,c.prototype.removeAllListeners=D,c.prototype.setMaxListeners=k,c.prototype.getMaxListeners=Re,c.prototype.listeners=Fe,c.prototype.eventNames=O,c.prototype.listenerCount=$e,ee}var hasRequiredLib$1;function requireLib$1(){return hasRequiredLib$1||(hasRequiredLib$1=1,(function(t){var e=lib$1&&lib$1.__createBinding||(Object.create?(function(n,s,o,c){c===void 0&&(c=o);var u=Object.getOwnPropertyDescriptor(s,o);(!u||("get"in u?!s.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(n,c,u)}):(function(n,s,o,c){c===void 0&&(c=o),n[c]=s[o]})),r=lib$1&&lib$1.__exportStar||function(n,s){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,n,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(requireTypes(),t),r(requireEe(),t)})(lib$1)),lib$1}var libExports=requireLib$1(),browser$1={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var t=1e3,e=t*60,r=e*60,n=r*24,s=n*7,o=n*365.25;ms=function(p,g){g=g||{};var y=typeof p;if(y==="string"&&p.length>0)return c(p);if(y==="number"&&isFinite(p))return g.long?f(p):u(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function c(p){if(p=String(p),!(p.length>100)){var g=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(g){var y=parseFloat(g[1]),b=(g[2]||"ms").toLowerCase();switch(b){case"years":case"year":case"yrs":case"yr":case"y":return y*o;case"weeks":case"week":case"w":return y*s;case"days":case"day":case"d":return y*n;case"hours":case"hour":case"hrs":case"hr":case"h":return y*r;case"minutes":case"minute":case"mins":case"min":case"m":return y*e;case"seconds":case"second":case"secs":case"sec":case"s":return y*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return y;default:return}}}}function u(p){var g=Math.abs(p);return g>=n?Math.round(p/n)+"d":g>=r?Math.round(p/r)+"h":g>=e?Math.round(p/e)+"m":g>=t?Math.round(p/t)+"s":p+"ms"}function f(p){var g=Math.abs(p);return g>=n?x(p,g,n,"day"):g>=r?x(p,g,r,"hour"):g>=e?x(p,g,e,"minute"):g>=t?x(p,g,t,"second"):p+" ms"}function x(p,g,y,b){var R=g>=y*1.5;return Math.round(p/y)+" "+b+(R?"s":"")}return ms}var common,hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common;hasRequiredCommon=1;function t(e){n.debug=n,n.default=n,n.coerce=x,n.disable=u,n.enable=o,n.enabled=f,n.humanize=requireMs(),n.destroy=p,Object.keys(e).forEach(g=>{n[g]=e[g]}),n.names=[],n.skips=[],n.formatters={};function r(g){let y=0;for(let b=0;b<g.length;b++)y=(y<<5)-y+g.charCodeAt(b),y|=0;return n.colors[Math.abs(y)%n.colors.length]}n.selectColor=r;function n(g){let y,b=null,R,D;function k(...Re){if(!k.enabled)return;const Fe=k,O=Number(new Date),$e=O-(y||O);Fe.diff=$e,Fe.prev=y,Fe.curr=O,y=O,Re[0]=n.coerce(Re[0]),typeof Re[0]!="string"&&Re.unshift("%O");let ze=0;Re[0]=Re[0].replace(/%([a-zA-Z%])/g,(W,We)=>{if(W==="%%")return"%";ze++;const Xe=n.formatters[We];if(typeof Xe=="function"){const it=Re[ze];W=Xe.call(Fe,it),Re.splice(ze,1),ze--}return W}),n.formatArgs.call(Fe,Re),(Fe.log||n.log).apply(Fe,Re)}return k.namespace=g,k.useColors=n.useColors(),k.color=n.selectColor(g),k.extend=s,k.destroy=n.destroy,Object.defineProperty(k,"enabled",{enumerable:!0,configurable:!1,get:()=>b!==null?b:(R!==n.namespaces&&(R=n.namespaces,D=n.enabled(g)),D),set:Re=>{b=Re}}),typeof n.init=="function"&&n.init(k),k}function s(g,y){const b=n(this.namespace+(typeof y>"u"?":":y)+g);return b.log=this.log,b}function o(g){n.save(g),n.namespaces=g,n.names=[],n.skips=[];const y=(typeof g=="string"?g:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const b of y)b[0]==="-"?n.skips.push(b.slice(1)):n.names.push(b)}function c(g,y){let b=0,R=0,D=-1,k=0;for(;b<g.length;)if(R<y.length&&(y[R]===g[b]||y[R]==="*"))y[R]==="*"?(D=R,k=b,R++):(b++,R++);else if(D!==-1)R=D+1,k++,b=k;else return!1;for(;R<y.length&&y[R]==="*";)R++;return R===y.length}function u(){const g=[...n.names,...n.skips.map(y=>"-"+y)].join(",");return n.enable(""),g}function f(g){for(const y of n.skips)if(c(g,y))return!1;for(const y of n.names)if(c(g,y))return!0;return!1}function x(g){return g instanceof Error?g.stack||g.message:g}function p(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}return common=t,common}var hasRequiredBrowser$1;function requireBrowser$1(){return hasRequiredBrowser$1||(hasRequiredBrowser$1=1,(function(t,e){var r={};e.formatArgs=s,e.save=o,e.load=c,e.useColors=n,e.storage=u(),e.destroy=(()=>{let x=!1;return()=>{x||(x=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let x;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(x=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(x[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(x){if(x[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+x[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const p="color: "+this.color;x.splice(1,0,p,"color: inherit");let g=0,y=0;x[0].replace(/%[a-zA-Z%]/g,b=>{b!=="%%"&&(g++,b==="%c"&&(y=g))}),x.splice(y,0,p)}e.log=console.debug||console.log||(()=>{});function o(x){try{x?e.storage.setItem("debug",x):e.storage.removeItem("debug")}catch{}}function c(){let x;try{x=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!x&&typeof process$1<"u"&&"env"in process$1&&(x=r.DEBUG),x}function u(){try{return localStorage}catch{}}t.exports=requireCommon()(e);const{formatters:f}=t.exports;f.j=function(x){try{return JSON.stringify(x)}catch(p){return"[UnexpectedJSONParseError]: "+p.message}}})(browser$1,browser$1.exports)),browser$1.exports}var browserExports$1=requireBrowser$1();const createDebug5=getDefaultExportFromCjs$1(browserExports$1);var dist$2={},LRUCache={},LRUCacheNode={},hasRequiredLRUCacheNode;function requireLRUCacheNode(){if(hasRequiredLRUCacheNode)return LRUCacheNode;hasRequiredLRUCacheNode=1,Object.defineProperty(LRUCacheNode,"__esModule",{value:!0}),LRUCacheNode.LRUCacheNode=void 0;let t=class{constructor(r,n,s){const{entryExpirationTimeInMS:o=null,next:c=null,prev:u=null,onEntryEvicted:f,onEntryMarkedAsMostRecentlyUsed:x,clone:p,cloneFn:g}=s??{};if(typeof o=="number"&&(o<=0||Number.isNaN(o)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=p??!1,this.cloneFn=g??this.defaultClone,this.key=r,this.internalValue=this.clone?this.cloneFn(n):n,this.created=Date.now(),this.entryExpirationTimeInMS=o,this.next=c,this.prev=u,this.onEntryEvicted=f,this.onEntryMarkedAsMostRecentlyUsed=x}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return typeof this.entryExpirationTimeInMS=="number"&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:r,value:n,isExpired:s}=this;this.onEntryEvicted({key:r,value:n,isExpired:s})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:r,value:n}=this;this.onEntryMarkedAsMostRecentlyUsed({key:r,value:n})}}defaultClone(r){return typeof r=="boolean"||typeof r=="string"||typeof r=="number"?r:JSON.parse(JSON.stringify(r))}};return LRUCacheNode.LRUCacheNode=t,LRUCacheNode}var hasRequiredLRUCache;function requireLRUCache(){if(hasRequiredLRUCache)return LRUCache;hasRequiredLRUCache=1,Object.defineProperty(LRUCache,"__esModule",{value:!0}),LRUCache.LRUCache=void 0;const t=requireLRUCacheNode();let e=class{constructor(n){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:s=25,entryExpirationTimeInMS:o=null,onEntryEvicted:c,onEntryMarkedAsMostRecentlyUsed:u,cloneFn:f,clone:x}=n??{};if(Number.isNaN(s)||s<=0)throw new Error("maxSize must be greater than 0.");if(typeof o=="number"&&(o<=0||Number.isNaN(o)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=s,this.entryExpirationTimeInMS=o,this.onEntryEvicted=c,this.onEntryMarkedAsMostRecentlyUsed=u,this.clone=x,this.cloneFn=f}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(n){if(Number.isNaN(n)||n<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=n,this.enforceSizeLimit()}set(n,s,o){const c=this.lookupTable.get(n);c&&this.removeNodeFromListAndLookupTable(c);const u=new t.LRUCacheNode(n,s,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...o});return this.setNodeAsHead(u),this.lookupTable.set(n,u),this.enforceSizeLimit(),this}get(n){const s=this.lookupTable.get(n);return s?s.isExpired?(this.removeNodeFromListAndLookupTable(s),null):(this.setNodeAsHead(s),s.value):null}peek(n){const s=this.lookupTable.get(n);return s?s.isExpired?(this.removeNodeFromListAndLookupTable(s),null):s.value:null}delete(n){const s=this.lookupTable.get(n);return s?this.removeNodeFromListAndLookupTable(s):!1}has(n){const s=this.lookupTable.get(n);return s?s.isExpired?(this.removeNodeFromListAndLookupTable(s),!1):!0:!1}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(n){let s=this.head;for(;s;){if(s.isExpired){const c=s.next;this.removeNodeFromListAndLookupTable(s),s=c;continue}const o=this.mapNodeToEntry(s);if(n(o))return this.setNodeAsHead(s),o;s=s.next}return null}forEach(n){let s=this.head,o=0;for(;s;){if(s.isExpired){const c=s.next;this.removeNodeFromListAndLookupTable(s),s=c;continue}n(s.value,s.key,o),s=s.next,o++}}*values(){let n=this.head;for(;n;){if(n.isExpired){const s=n.next;this.removeNodeFromListAndLookupTable(n),n=s;continue}yield n.value,n=n.next}}*keys(){let n=this.head;for(;n;){if(n.isExpired){const s=n.next;this.removeNodeFromListAndLookupTable(n),n=s;continue}yield n.key,n=n.next}}*entries(){let n=this.head;for(;n;){if(n.isExpired){const s=n.next;this.removeNodeFromListAndLookupTable(n),n=s;continue}yield this.mapNodeToEntry(n),n=n.next}}*[Symbol.iterator](){let n=this.head;for(;n;){if(n.isExpired){const s=n.next;this.removeNodeFromListAndLookupTable(n),n=s;continue}yield this.mapNodeToEntry(n),n=n.next}}enforceSizeLimit(){let n=this.tail;for(;n!==null&&this.size>this.maxSizeInternal;){const s=n.prev;this.removeNodeFromListAndLookupTable(n),n=s}}mapNodeToEntry({key:n,value:s}){return{key:n,value:s}}setNodeAsHead(n){this.removeNodeFromList(n),this.head?(n.next=this.head,this.head.prev=n,this.head=n):(this.head=n,this.tail=n),n.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(n){n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.head===n&&(this.head=n.next),this.tail===n&&(this.tail=n.prev),n.next=null,n.prev=null}removeNodeFromListAndLookupTable(n){return n.invokeOnEvicted(),this.removeNodeFromList(n),this.lookupTable.delete(n.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const n=[];for(const s of this.lookupTable.values())s.isExpired&&n.push(s);n.forEach(s=>this.removeNodeFromListAndLookupTable(s))}};return LRUCache.LRUCache=e,LRUCache}var hasRequiredDist$2;function requireDist$2(){return hasRequiredDist$2||(hasRequiredDist$2=1,(function(t){var e=dist$2&&dist$2.__createBinding||(Object.create?(function(n,s,o,c){c===void 0&&(c=o);var u=Object.getOwnPropertyDescriptor(s,o);(!u||("get"in u?!s.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(n,c,u)}):(function(n,s,o,c){c===void 0&&(c=o),n[c]=s[o]})),r=dist$2&&dist$2.__exportStar||function(n,s){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,n,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(requireLRUCache(),t)})(dist$2)),dist$2}var distExports$2=requireDist$2();function pbkdf2Init(t,e,r,n){assert$3.hash(t);const s=checkOpts$1({dkLen:32,asyncTick:10},n),{c:o,dkLen:c,asyncTick:u}=s;if(assert$3.number(o),assert$3.number(c),assert$3.number(u),o<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const f=toBytes$1(e),x=toBytes$1(r),p=new Uint8Array(c),g=hmac$1.create(t,f),y=g._cloneInto().update(x);return{c:o,dkLen:c,asyncTick:u,DK:p,PRF:g,PRFSalt:y}}function pbkdf2Output(t,e,r,n,s){return t.destroy(),e.destroy(),n&&n.destroy(),s.fill(0),r}function pbkdf2(t,e,r,n){const{c:s,dkLen:o,DK:c,PRF:u,PRFSalt:f}=pbkdf2Init(t,e,r,n);let x;const p=new Uint8Array(4),g=createView$1(p),y=new Uint8Array(u.outputLen);for(let b=1,R=0;R<o;b++,R+=u.outputLen){const D=c.subarray(R,R+u.outputLen);g.setInt32(0,b,!1),(x=f._cloneInto(x)).update(p).digestInto(y),D.set(y.subarray(0,D.length));for(let k=1;k<s;k++){u._cloneInto(x).update(y).digestInto(y);for(let Re=0;Re<D.length;Re++)D[Re]^=y[Re]}}return pbkdf2Output(u,f,c,x,y)}const rotl=(t,e)=>t<<e|t>>>32-e;function XorAndSalsa(t,e,r,n,s,o){let c=t[e++]^r[n++],u=t[e++]^r[n++],f=t[e++]^r[n++],x=t[e++]^r[n++],p=t[e++]^r[n++],g=t[e++]^r[n++],y=t[e++]^r[n++],b=t[e++]^r[n++],R=t[e++]^r[n++],D=t[e++]^r[n++],k=t[e++]^r[n++],Re=t[e++]^r[n++],Fe=t[e++]^r[n++],O=t[e++]^r[n++],$e=t[e++]^r[n++],ze=t[e++]^r[n++],q=c,W=u,We=f,Xe=x,it=p,Ve=g,v=y,I=b,Ce=R,P=D,_e=k,Le=Re,Ye=Fe,je=O,K=$e,L=ze;for(let st=0;st<8;st+=2)it^=rotl(q+Ye|0,7),Ce^=rotl(it+q|0,9),Ye^=rotl(Ce+it|0,13),q^=rotl(Ye+Ce|0,18),P^=rotl(Ve+W|0,7),je^=rotl(P+Ve|0,9),W^=rotl(je+P|0,13),Ve^=rotl(W+je|0,18),K^=rotl(_e+v|0,7),We^=rotl(K+_e|0,9),v^=rotl(We+K|0,13),_e^=rotl(v+We|0,18),Xe^=rotl(L+Le|0,7),I^=rotl(Xe+L|0,9),Le^=rotl(I+Xe|0,13),L^=rotl(Le+I|0,18),W^=rotl(q+Xe|0,7),We^=rotl(W+q|0,9),Xe^=rotl(We+W|0,13),q^=rotl(Xe+We|0,18),v^=rotl(Ve+it|0,7),I^=rotl(v+Ve|0,9),it^=rotl(I+v|0,13),Ve^=rotl(it+I|0,18),Le^=rotl(_e+P|0,7),Ce^=rotl(Le+_e|0,9),P^=rotl(Ce+Le|0,13),_e^=rotl(P+Ce|0,18),Ye^=rotl(L+K|0,7),je^=rotl(Ye+L|0,9),K^=rotl(je+Ye|0,13),L^=rotl(K+je|0,18);s[o++]=c+q|0,s[o++]=u+W|0,s[o++]=f+We|0,s[o++]=x+Xe|0,s[o++]=p+it|0,s[o++]=g+Ve|0,s[o++]=y+v|0,s[o++]=b+I|0,s[o++]=R+Ce|0,s[o++]=D+P|0,s[o++]=k+_e|0,s[o++]=Re+Le|0,s[o++]=Fe+Ye|0,s[o++]=O+je|0,s[o++]=$e+K|0,s[o++]=ze+L|0}function BlockMix(t,e,r,n,s){let o=n+0,c=n+16*s;for(let u=0;u<16;u++)r[c+u]=t[e+(2*s-1)*16+u];for(let u=0;u<s;u++,o+=16,e+=16)XorAndSalsa(r,c,t,e,r,o),u>0&&(c+=16),XorAndSalsa(r,o,t,e+=16,r,c)}function scryptInit(t,e,r){const n=checkOpts$1({dkLen:32,asyncTick:10,maxmem:1073742848},r),{N:s,r:o,p:c,dkLen:u,asyncTick:f,maxmem:x,onProgress:p}=n;if(assert$3.number(s),assert$3.number(o),assert$3.number(c),assert$3.number(u),assert$3.number(f),assert$3.number(x),p!==void 0&&typeof p!="function")throw new Error("progressCb should be function");const g=128*o,y=g/4;if(s<=1||(s&s-1)!==0||s>=2**(g/8)||s>2**32)throw new Error("Scrypt: N must be larger than 1, a power of 2, less than 2^(128 * r / 8) and less than 2^32");if(c<0||c>(2**32-1)*32/g)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(u<0||u>(2**32-1)*32)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");const b=g*(s+c);if(b>x)throw new Error(`Scrypt: parameters too large, ${b} (128 * r * (N + p)) > ${x} (maxmem)`);const R=pbkdf2(sha256$1,t,e,{c:1,dkLen:g*c}),D=u32$1(R),k=u32$1(new Uint8Array(g*s)),Re=u32$1(new Uint8Array(g));let Fe=()=>{};if(p){const O=2*s*c,$e=Math.max(Math.floor(O/1e4),1);let ze=0;Fe=()=>{ze++,p&&(!(ze%$e)||ze===O)&&p(ze/O)}}return{N:s,r:o,p:c,dkLen:u,blockSize32:y,V:k,B32:D,B:R,tmp:Re,blockMixCb:Fe,asyncTick:f}}function scryptOutput(t,e,r,n,s){const o=pbkdf2(sha256$1,t,r,{c:1,dkLen:e});return r.fill(0),n.fill(0),s.fill(0),o}function scrypt(t,e,r){const{N:n,r:s,p:o,dkLen:c,blockSize32:u,V:f,B32:x,B:p,tmp:g,blockMixCb:y}=scryptInit(t,e,r);for(let b=0;b<o;b++){const R=u*b;for(let D=0;D<u;D++)f[D]=x[R+D];for(let D=0,k=0;D<n-1;D++)BlockMix(f,k,f,k+=u,s),y();BlockMix(f,(n-1)*u,x,R,s),y();for(let D=0;D<n;D++){const k=x[R+u-16]%n;for(let Re=0;Re<u;Re++)g[Re]=x[R+Re]^f[k*u+Re];BlockMix(g,0,x,R,s),y()}}return scryptOutput(t,c,p,f,g)}var Bech32MaxSize$1=5e3;function encodeBech32$1(t,e){let r=bech32$1.toWords(e);return bech32$1.encode(t,r,Bech32MaxSize$1)}function encodeBytes$1(t,e){return encodeBech32$1(t,e)}function encrypt$1(t,e,r=16,n=2){let s=randomBytes(16),o=2**r,c=scrypt(e.normalize("NFKC"),s,{N:o,r:8,p:1,dkLen:32}),u=randomBytes(24),f=Uint8Array.from([n]),p=xchacha20poly1305(c,u,f).encrypt(t),g=concatBytes(Uint8Array.from([2]),Uint8Array.from([r]),s,u,f,p);return encodeBytes$1("ncryptsec",g)}function decrypt$1(t,e){let{prefix:r,words:n}=bech32$1.decode(t,Bech32MaxSize$1);if(r!=="ncryptsec")throw new Error(`invalid prefix ${r}, expected 'ncryptsec'`);let s=new Uint8Array(bech32$1.fromWords(n)),o=s[0];if(o!==2)throw new Error(`invalid version ${o}, expected 0x02`);let u=2**s[1],f=s.slice(2,18),x=s.slice(18,42),p=s[42],g=Uint8Array.from([p]),y=s.slice(43),b=scrypt(e.normalize("NFKC"),f,{N:u,r:8,p:1,dkLen:32});return xchacha20poly1305(b,x,g).decrypt(y)}const nip49_star=Object.freeze(Object.defineProperty({__proto__:null,decrypt:decrypt$1,encrypt:encrypt$1},Symbol.toStringTag,{value:"Module"}));var utf8Decoder=new TextDecoder("utf-8"),utf8Encoder=new TextEncoder,NostrTypeGuard={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},Bech32MaxSize=5e3,BECH32_REGEX$1=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function decodeNostrURI(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),decode$k(t)}catch{return{type:"invalid",data:null}}}function decode$k(t){let{prefix:e,words:r}=bech32$1.decode(t,Bech32MaxSize),n=new Uint8Array(bech32$1.fromWords(r));switch(e){case"nprofile":{let s=parseTLV(n);if(!s[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(s[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex$1(s[0][0]),relays:s[1]?s[1].map(o=>utf8Decoder.decode(o)):[]}}}case"nevent":{let s=parseTLV(n);if(!s[0]?.[0])throw new Error("missing TLV 0 for nevent");if(s[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(s[2]&&s[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(s[3]&&s[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex$1(s[0][0]),relays:s[1]?s[1].map(o=>utf8Decoder.decode(o)):[],author:s[2]?.[0]?bytesToHex$1(s[2][0]):void 0,kind:s[3]?.[0]?parseInt(bytesToHex$1(s[3][0]),16):void 0}}}case"naddr":{let s=parseTLV(n);if(!s[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!s[2]?.[0])throw new Error("missing TLV 2 for naddr");if(s[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!s[3]?.[0])throw new Error("missing TLV 3 for naddr");if(s[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder.decode(s[0][0]),pubkey:bytesToHex$1(s[2][0]),kind:parseInt(bytesToHex$1(s[3][0]),16),relays:s[1]?s[1].map(o=>utf8Decoder.decode(o)):[]}}}case"nsec":return{type:e,data:n};case"npub":case"note":return{type:e,data:bytesToHex$1(n)};default:throw new Error(`unknown prefix ${e}`)}}function parseTLV(t){let e={},r=t;for(;r.length>0;){let n=r[0],s=r[1],o=r.slice(2,2+s);if(r=r.slice(2+s),o.length<s)throw new Error(`not enough data to read on TLV ${n}`);e[n]=e[n]||[],e[n].push(o)}return e}function nsecEncode(t){return encodeBytes("nsec",t)}function npubEncode(t){return encodeBytes("npub",hexToBytes$3(t))}function noteEncode(t){return encodeBytes("note",hexToBytes$3(t))}function encodeBech32(t,e){let r=bech32$1.toWords(e);return bech32$1.encode(t,r,Bech32MaxSize)}function encodeBytes(t,e){return encodeBech32(t,e)}function nprofileEncode(t){let e=encodeTLV({0:[hexToBytes$3(t.pubkey)],1:(t.relays||[]).map(r=>utf8Encoder.encode(r))});return encodeBech32("nprofile",e)}function neventEncode(t){let e;t.kind!==void 0&&(e=integerToUint8Array(t.kind));let r=encodeTLV({0:[hexToBytes$3(t.id)],1:(t.relays||[]).map(n=>utf8Encoder.encode(n)),2:t.author?[hexToBytes$3(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return encodeBech32("nevent",r)}function naddrEncode(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let r=encodeTLV({0:[utf8Encoder.encode(t.identifier)],1:(t.relays||[]).map(n=>utf8Encoder.encode(n)),2:[hexToBytes$3(t.pubkey)],3:[new Uint8Array(e)]});return encodeBech32("naddr",r)}function encodeTLV(t){let e=[];return Object.entries(t).reverse().forEach(([r,n])=>{n.forEach(s=>{let o=new Uint8Array(s.length+2);o.set([parseInt(r)],0),o.set([s.length],1),o.set(s,2),e.push(o)})}),concatBytes(...e)}const nip19_star=Object.freeze(Object.defineProperty({__proto__:null,BECH32_REGEX:BECH32_REGEX$1,Bech32MaxSize,NostrTypeGuard,decode:decode$k,decodeNostrURI,encodeBytes,naddrEncode,neventEncode,noteEncode,nprofileEncode,npubEncode,nsecEncode},Symbol.toStringTag,{value:"Module"}));var lib={},hasRequiredLib;function requireLib(){return hasRequiredLib||(hasRequiredLib=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.bytes=t.stringToBytes=t.str=t.bytesToString=t.hex=t.utf8=t.bech32m=t.bech32=t.base58check=t.base58xmr=t.base58xrp=t.base58flickr=t.base58=t.base64url=t.base64=t.base32crockford=t.base32hex=t.base32=t.base16=t.utils=t.assertNumber=void 0;function e(Ve){if(!Number.isSafeInteger(Ve))throw new Error(`Wrong integer: ${Ve}`)}t.assertNumber=e;function r(...Ve){const v=(P,_e)=>Le=>P(_e(Le)),I=Array.from(Ve).reverse().reduce((P,_e)=>P?v(P,_e.encode):_e.encode,void 0),Ce=Ve.reduce((P,_e)=>P?v(P,_e.decode):_e.decode,void 0);return{encode:I,decode:Ce}}function n(Ve){return{encode:v=>{if(!Array.isArray(v)||v.length&&typeof v[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return v.map(I=>{if(e(I),I<0||I>=Ve.length)throw new Error(`Digit index outside alphabet: ${I} (alphabet: ${Ve.length})`);return Ve[I]})},decode:v=>{if(!Array.isArray(v)||v.length&&typeof v[0]!="string")throw new Error("alphabet.decode input should be array of strings");return v.map(I=>{if(typeof I!="string")throw new Error(`alphabet.decode: not string element=${I}`);const Ce=Ve.indexOf(I);if(Ce===-1)throw new Error(`Unknown letter: "${I}". Allowed: ${Ve}`);return Ce})}}}function s(Ve=""){if(typeof Ve!="string")throw new Error("join separator should be string");return{encode:v=>{if(!Array.isArray(v)||v.length&&typeof v[0]!="string")throw new Error("join.encode input should be array of strings");for(let I of v)if(typeof I!="string")throw new Error(`join.encode: non-string input=${I}`);return v.join(Ve)},decode:v=>{if(typeof v!="string")throw new Error("join.decode input should be string");return v.split(Ve)}}}function o(Ve,v="="){if(e(Ve),typeof v!="string")throw new Error("padding chr should be string");return{encode(I){if(!Array.isArray(I)||I.length&&typeof I[0]!="string")throw new Error("padding.encode input should be array of strings");for(let Ce of I)if(typeof Ce!="string")throw new Error(`padding.encode: non-string input=${Ce}`);for(;I.length*Ve%8;)I.push(v);return I},decode(I){if(!Array.isArray(I)||I.length&&typeof I[0]!="string")throw new Error("padding.encode input should be array of strings");for(let P of I)if(typeof P!="string")throw new Error(`padding.decode: non-string input=${P}`);let Ce=I.length;if(Ce*Ve%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;Ce>0&&I[Ce-1]===v;Ce--)if(!((Ce-1)*Ve%8))throw new Error("Invalid padding: string has too much padding");return I.slice(0,Ce)}}}function c(Ve){if(typeof Ve!="function")throw new Error("normalize fn should be function");return{encode:v=>v,decode:v=>Ve(v)}}function u(Ve,v,I){if(v<2)throw new Error(`convertRadix: wrong from=${v}, base cannot be less than 2`);if(I<2)throw new Error(`convertRadix: wrong to=${I}, base cannot be less than 2`);if(!Array.isArray(Ve))throw new Error("convertRadix: data should be array");if(!Ve.length)return[];let Ce=0;const P=[],_e=Array.from(Ve);for(_e.forEach(Le=>{if(e(Le),Le<0||Le>=v)throw new Error(`Wrong integer: ${Le}`)});;){let Le=0,Ye=!0;for(let je=Ce;je<_e.length;je++){const K=_e[je],L=v*Le+K;if(!Number.isSafeInteger(L)||v*Le/v!==Le||L-K!==v*Le)throw new Error("convertRadix: carry overflow");if(Le=L%I,_e[je]=Math.floor(L/I),!Number.isSafeInteger(_e[je])||_e[je]*I+Le!==L)throw new Error("convertRadix: carry overflow");if(Ye)_e[je]?Ye=!1:Ce=je;else continue}if(P.push(Le),Ye)break}for(let Le=0;Le<Ve.length-1&&Ve[Le]===0;Le++)P.push(0);return P.reverse()}const f=(Ve,v)=>v?f(v,Ve%v):Ve,x=(Ve,v)=>Ve+(v-f(Ve,v));function p(Ve,v,I,Ce){if(!Array.isArray(Ve))throw new Error("convertRadix2: data should be array");if(v<=0||v>32)throw new Error(`convertRadix2: wrong from=${v}`);if(I<=0||I>32)throw new Error(`convertRadix2: wrong to=${I}`);if(x(v,I)>32)throw new Error(`convertRadix2: carry overflow from=${v} to=${I} carryBits=${x(v,I)}`);let P=0,_e=0;const Le=2**I-1,Ye=[];for(const je of Ve){if(e(je),je>=2**v)throw new Error(`convertRadix2: invalid data word=${je} from=${v}`);if(P=P<<v|je,_e+v>32)throw new Error(`convertRadix2: carry overflow pos=${_e} from=${v}`);for(_e+=v;_e>=I;_e-=I)Ye.push((P>>_e-I&Le)>>>0);P&=2**_e-1}if(P=P<<I-_e&Le,!Ce&&_e>=v)throw new Error("Excess padding");if(!Ce&&P)throw new Error(`Non-zero padding: ${P}`);return Ce&&_e>0&&Ye.push(P>>>0),Ye}function g(Ve){return e(Ve),{encode:v=>{if(!(v instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return u(Array.from(v),2**8,Ve)},decode:v=>{if(!Array.isArray(v)||v.length&&typeof v[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(u(v,Ve,2**8))}}}function y(Ve,v=!1){if(e(Ve),Ve<=0||Ve>32)throw new Error("radix2: bits should be in (0..32]");if(x(8,Ve)>32||x(Ve,8)>32)throw new Error("radix2: carry overflow");return{encode:I=>{if(!(I instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return p(Array.from(I),8,Ve,!v)},decode:I=>{if(!Array.isArray(I)||I.length&&typeof I[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(p(I,Ve,8,v))}}}function b(Ve){if(typeof Ve!="function")throw new Error("unsafeWrapper fn should be function");return function(...v){try{return Ve.apply(null,v)}catch{}}}function R(Ve,v){if(e(Ve),typeof v!="function")throw new Error("checksum fn should be function");return{encode(I){if(!(I instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const Ce=v(I).slice(0,Ve),P=new Uint8Array(I.length+Ve);return P.set(I),P.set(Ce,I.length),P},decode(I){if(!(I instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const Ce=I.slice(0,-Ve),P=v(Ce).slice(0,Ve),_e=I.slice(-Ve);for(let Le=0;Le<Ve;Le++)if(P[Le]!==_e[Le])throw new Error("Invalid checksum");return Ce}}}t.utils={alphabet:n,chain:r,checksum:R,radix:g,radix2:y,join:s,padding:o},t.base16=r(y(4),n("0123456789ABCDEF"),s("")),t.base32=r(y(5),n("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),t.base32hex=r(y(5),n("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),t.base32crockford=r(y(5),n("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),c(Ve=>Ve.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),t.base64=r(y(6),n("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),t.base64url=r(y(6),n("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const D=Ve=>r(g(58),n(Ve),s(""));t.base58=D("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),t.base58flickr=D("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),t.base58xrp=D("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const k=[0,2,3,5,6,7,9,10,11];t.base58xmr={encode(Ve){let v="";for(let I=0;I<Ve.length;I+=8){const Ce=Ve.subarray(I,I+8);v+=t.base58.encode(Ce).padStart(k[Ce.length],"1")}return v},decode(Ve){let v=[];for(let I=0;I<Ve.length;I+=11){const Ce=Ve.slice(I,I+11),P=k.indexOf(Ce.length),_e=t.base58.decode(Ce);for(let Le=0;Le<_e.length-P;Le++)if(_e[Le]!==0)throw new Error("base58xmr: wrong padding");v=v.concat(Array.from(_e.slice(_e.length-P)))}return Uint8Array.from(v)}};const Re=Ve=>r(R(4,v=>Ve(Ve(v))),t.base58);t.base58check=Re;const Fe=r(n("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),O=[996825010,642813549,513874426,1027748829,705979059];function $e(Ve){const v=Ve>>25;let I=(Ve&33554431)<<5;for(let Ce=0;Ce<O.length;Ce++)(v>>Ce&1)===1&&(I^=O[Ce]);return I}function ze(Ve,v,I=1){const Ce=Ve.length;let P=1;for(let _e=0;_e<Ce;_e++){const Le=Ve.charCodeAt(_e);if(Le<33||Le>126)throw new Error(`Invalid prefix (${Ve})`);P=$e(P)^Le>>5}P=$e(P);for(let _e=0;_e<Ce;_e++)P=$e(P)^Ve.charCodeAt(_e)&31;for(let _e of v)P=$e(P)^_e;for(let _e=0;_e<6;_e++)P=$e(P);return P^=I,Fe.encode(p([P%2**30],30,5,!1))}function q(Ve){const v=Ve==="bech32"?1:734539939,I=y(5),Ce=I.decode,P=I.encode,_e=b(Ce);function Le(L,st,dt=90){if(typeof L!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof L}`);if(!Array.isArray(st)||st.length&&typeof st[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof st}`);const Je=L.length+7+st.length;if(dt!==!1&&Je>dt)throw new TypeError(`Length ${Je} exceeds limit ${dt}`);return L=L.toLowerCase(),`${L}1${Fe.encode(st)}${ze(L,st,v)}`}function Ye(L,st=90){if(typeof L!="string")throw new Error(`bech32.decode input should be string, not ${typeof L}`);if(L.length<8||st!==!1&&L.length>st)throw new TypeError(`Wrong string length: ${L.length} (${L}). Expected (8..${st})`);const dt=L.toLowerCase();if(L!==dt&&L!==L.toUpperCase())throw new Error("String must be lowercase or uppercase");L=dt;const Je=L.lastIndexOf("1");if(Je===0||Je===-1)throw new Error('Letter "1" must be present between prefix and data only');const pt=L.slice(0,Je),rr=L.slice(Je+1);if(rr.length<6)throw new Error("Data must be at least 6 characters long");const cr=Fe.decode(rr).slice(0,-6),fr=ze(pt,cr,v);if(!rr.endsWith(fr))throw new Error(`Invalid checksum in ${L}: expected "${fr}"`);return{prefix:pt,words:cr}}const je=b(Ye);function K(L){const{prefix:st,words:dt}=Ye(L,!1);return{prefix:st,words:dt,bytes:Ce(dt)}}return{encode:Le,decode:Ye,decodeToBytes:K,decodeUnsafe:je,fromWords:Ce,fromWordsUnsafe:_e,toWords:P}}t.bech32=q("bech32"),t.bech32m=q("bech32m"),t.utf8={encode:Ve=>new TextDecoder().decode(Ve),decode:Ve=>new TextEncoder().encode(Ve)},t.hex=r(y(4),n("0123456789abcdef"),s(""),c(Ve=>{if(typeof Ve!="string"||Ve.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof Ve} with length ${Ve.length}`);return Ve.toLowerCase()}));const W={utf8:t.utf8,hex:t.hex,base16:t.base16,base32:t.base32,base64:t.base64,base64url:t.base64url,base58:t.base58,base58xmr:t.base58xmr},We=`Invalid encoding type. Available types: ${Object.keys(W).join(", ")}`,Xe=(Ve,v)=>{if(typeof Ve!="string"||!W.hasOwnProperty(Ve))throw new TypeError(We);if(!(v instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return W[Ve].encode(v)};t.bytesToString=Xe,t.str=t.bytesToString;const it=(Ve,v)=>{if(!W.hasOwnProperty(Ve))throw new TypeError(We);if(typeof v!="string")throw new TypeError("stringToBytes() expects string");return W[Ve].decode(v)};t.stringToBytes=it,t.bytes=t.stringToBytes})(lib)),lib}var bolt11,hasRequiredBolt11;function requireBolt11(){if(hasRequiredBolt11)return bolt11;hasRequiredBolt11=1;const{bech32:t,hex:e,utf8:r}=requireLib(),n={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},s={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},o={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},u={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},f=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],x={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},p=BigInt("2100000000000000000"),g=BigInt(1e11),y={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},b={};for(let ze=0,q=Object.keys(y);ze<q.length;ze++){const W=q[ze],We=y[q[ze]].toString();b[We]=W}const R={1:ze=>e.encode(t.fromWordsUnsafe(ze)),16:ze=>e.encode(t.fromWordsUnsafe(ze)),13:ze=>r.encode(t.fromWordsUnsafe(ze)),19:ze=>e.encode(t.fromWordsUnsafe(ze)),23:ze=>e.encode(t.fromWordsUnsafe(ze)),27:ze=>e.encode(t.fromWordsUnsafe(ze)),6:k,24:k,3:Re,5:Fe};function D(ze){return q=>({tagCode:parseInt(ze),words:t.encode("unknown",q,Number.MAX_SAFE_INTEGER)})}function k(ze){return ze.reverse().reduce((q,W,We)=>q+W*Math.pow(32,We),0)}function Re(ze){const q=[];let W,We,Xe,it,Ve,v=t.fromWordsUnsafe(ze);for(;v.length>0;)W=e.encode(v.slice(0,33)),We=e.encode(v.slice(33,41)),Xe=parseInt(e.encode(v.slice(41,45)),16),it=parseInt(e.encode(v.slice(45,49)),16),Ve=parseInt(e.encode(v.slice(49,51)),16),v=v.slice(51),q.push({pubkey:W,short_channel_id:We,fee_base_msat:Xe,fee_proportional_millionths:it,cltv_expiry_delta:Ve});return q}function Fe(ze){const q=ze.slice().reverse().map(Xe=>[!!(Xe&1),!!(Xe&2),!!(Xe&4),!!(Xe&8),!!(Xe&16)]).reduce((Xe,it)=>Xe.concat(it),[]);for(;q.length<f.length*2;)q.push(!1);const W={};f.forEach((Xe,it)=>{let Ve;q[it*2]?Ve="required":q[it*2+1]?Ve="supported":Ve="unsupported",W[Xe]=Ve});const We=q.slice(f.length*2);return W.extra_bits={start_bit:f.length*2,bits:We,has_required:We.reduce((Xe,it,Ve)=>Ve%2!==0?Xe||!1:Xe||it,!1)},W}function O(ze,q){let W,We;if(ze.slice(-1).match(/^[munp]$/))W=ze.slice(-1),We=ze.slice(0,-1);else{if(ze.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");We=ze}if(!We.match(/^\d+$/))throw new Error("Not a valid human readable amount");const Xe=BigInt(We),it=W?Xe*g/x[W]:Xe*g;if(W==="p"&&Xe%BigInt(10)!==BigInt(0)||it>p)throw new Error("Amount is outside of valid range");return q?it.toString():it}function $e(ze,q){if(typeof ze!="string")throw new Error("Lightning Payment Request must be string");if(ze.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const W=[],We=t.decode(ze,Number.MAX_SAFE_INTEGER);ze=ze.toLowerCase();const Xe=We.prefix;let it=We.words,Ve=ze.slice(Xe.length+1),v=it.slice(-104);it=it.slice(0,-104);let I=Xe.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(I&&!I[2]&&(I=Xe.match(/^ln(\S+)$/)),!I)throw new Error("Not a proper lightning payment request");W.push({name:"lightning_network",letters:"ln"});const Ce=I[1];let P;if(q){if(q.bech32===void 0||q.pubKeyHash===void 0||q.scriptHash===void 0||!Array.isArray(q.validWitnessVersions))throw new Error("Invalid network");P=q}else switch(Ce){case n.bech32:P=n;break;case s.bech32:P=s;break;case o.bech32:P=o;break;case c.bech32:P=c;break;case u.bech32:P=u;break}if(!P||P.bech32!==Ce)throw new Error("Unknown coin bech32 prefix");W.push({name:"coin_network",letters:Ce,value:P});const _e=I[2];let Le;if(_e){const pt=I[3];Le=O(_e+pt,!0),W.push({name:"amount",letters:I[2]+I[3],value:Le})}else Le=null;W.push({name:"separator",letters:"1"});const Ye=k(it.slice(0,7));it=it.slice(7),W.push({name:"timestamp",letters:Ve.slice(0,7),value:Ye}),Ve=Ve.slice(7);let je,K,L,st;for(;it.length>0;){const pt=it[0].toString();je=b[pt]||"unknown_tag",K=R[pt]||D(pt),it=it.slice(1),L=k(it.slice(0,2)),it=it.slice(2),st=it.slice(0,L),it=it.slice(L),W.push({name:je,tag:Ve[0],letters:Ve.slice(0,3+L),value:K(st)}),Ve=Ve.slice(3+L)}W.push({name:"signature",letters:Ve.slice(0,104),value:e.encode(t.fromWordsUnsafe(v))}),Ve=Ve.slice(104),W.push({name:"checksum",letters:Ve});let dt={paymentRequest:ze,sections:W,get expiry(){let pt=W.find(rr=>rr.name==="expiry");if(pt)return Je("timestamp")+pt.value},get route_hints(){return W.filter(pt=>pt.name==="route_hint").map(pt=>pt.value)}};for(let pt in y)pt!=="route_hint"&&Object.defineProperty(dt,pt,{get(){return Je(pt)}});return dt;function Je(pt){let rr=W.find(cr=>cr.name===pt);return rr?rr.value:void 0}}return bolt11={decode:$e,hrpToMillisat:O},bolt11}requireBolt11();var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__copyProps=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of __getOwnPropNames(e))!__hasOwnProp.call(t,s)&&s!==r&&__defProp(t,s,{get:()=>e[s],enumerable:!(n=__getOwnPropDesc(e,s))||n.enumerable});return t},__reExport=(t,e,r)=>(__copyProps(t,e,"default"),r);function getRelaysForSync(t,e,r="write"){if(!t.outboxTracker)return;const n=t.outboxTracker.data.get(e);if(n)return r==="write"?n.writeRelays:n.readRelays}async function getWriteRelaysFor(t,e,r="write"){if(t.outboxTracker)return t.outboxTracker.data.has(e)||await t.outboxTracker.trackUsers([e]),getRelaysForSync(t,e,r)}function getTopRelaysForAuthors(t,e){const r=new Map;return e.forEach(s=>{const o=getRelaysForSync(t,s);o&&o.forEach(c=>{const u=r.get(c)||0;r.set(c,u+1)})}),Array.from(r.entries()).sort((s,o)=>o[1]-s[1]).map(s=>s[0])}function getAllRelaysForAllPubkeys(t,e,r="read"){const n=new Map,s=new Set;return e.forEach(o=>{const c=getRelaysForSync(t,o,r);c&&c.size>0?(c.forEach(u=>{(n.get(u)||new Set).add(o)}),n.set(o,c)):s.add(o)}),{pubkeysToRelays:n,authorsMissingRelays:s}}function chooseRelayCombinationForPubkeys(t,e,r,{count:n,preferredRelays:s}={}){n??=2,s??=new Set;const o=t.pool,c=o.connectedRelays();c.forEach(y=>{s?.add(y.url)});const u=new Map,{pubkeysToRelays:f,authorsMissingRelays:x}=getAllRelaysForAllPubkeys(t,e,r),p=getTopRelaysForAuthors(t,e),g=(y,b)=>{const R=u.get(b)||[];R.push(y),u.set(b,R)};for(const[y,b]of f.entries()){let R=n;const D=new Set;for(const k of c)b.has(k.url)&&(g(y,k.url),D.add(k.url),R--);for(const k of b)D.has(k)||u.has(k)&&(g(y,k),D.add(k),R--);if(!(R<=0))for(const k of p){if(R<=0)break;D.has(k)||b.has(k)&&(g(y,k),D.add(k),R--)}}for(const y of x)o.permanentAndConnectedRelays().forEach(b=>{const R=u.get(b.url)||[];R.push(y),u.set(b.url,R)});return u}function getRelaysForFilterWithAuthors(t,e,r=2){return chooseRelayCombinationForPubkeys(t,e,"write",{count:r})}function tryNormalizeRelayUrl(t){try{return normalizeRelayUrl(t)}catch{return}}function normalizeRelayUrl(t){let e=normalizeUrl(t,{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return e.endsWith("/")||(e+="/"),e}function normalize(t){const e=new Set;for(const r of t)try{e.add(normalizeRelayUrl(r))}catch{}return Array.from(e)}var DATA_URL_DEFAULT_MIME_TYPE="text/plain",DATA_URL_DEFAULT_CHARSET="us-ascii",testParameter=(t,e)=>e.some(r=>r instanceof RegExp?r.test(t):r===t),supportedProtocols=new Set(["https:","http:","file:"]),hasCustomProtocol=t=>{try{const{protocol:e}=new URL(t);return e.endsWith(":")&&!e.includes(".")&&!supportedProtocols.has(e)}catch{return!1}},normalizeDataURL=(t,{stripHash:e})=>{const r=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!r)throw new Error(`Invalid URL: ${t}`);const n=r.groups?.type??"",s=r.groups?.data??"";let o=r.groups?.hash??"";const c=n.split(";");o=e?"":o;let u=!1;c[c.length-1]==="base64"&&(c.pop(),u=!0);const f=c.shift()?.toLowerCase()??"",p=[...c.map(g=>{let[y,b=""]=g.split("=").map(R=>R.trim());return y==="charset"&&(b=b.toLowerCase(),b===DATA_URL_DEFAULT_CHARSET)?"":`${y}${b?`=${b}`:""}`}).filter(Boolean)];return u&&p.push("base64"),(p.length>0||f&&f!==DATA_URL_DEFAULT_MIME_TYPE)&&p.unshift(f),`data:${p.join(";")},${u?s.trim():s}${o?`#${o}`:""}`};function normalizeUrl(t,e={}){if(e={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...e},typeof e.defaultProtocol=="string"&&!e.defaultProtocol.endsWith(":")&&(e.defaultProtocol=`${e.defaultProtocol}:`),t=t.trim(),/^data:/i.test(t))return normalizeDataURL(t,e);if(hasCustomProtocol(t))return t;const r=t.startsWith("//");!r&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));const s=new URL(t);if(s.hostname=s.hostname.toLowerCase(),e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&s.protocol==="https:"&&(s.protocol="http:"),e.forceHttps&&s.protocol==="http:"&&(s.protocol="https:"),e.stripAuthentication&&(s.username="",s.password=""),e.stripHash?s.hash="":e.stripTextFragment&&(s.hash=s.hash.replace(/#?:~:text.*?$/i,"")),s.pathname){const c=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let u=0,f="";for(;;){const p=c.exec(s.pathname);if(!p)break;const g=p[0],y=p.index,b=s.pathname.slice(u,y);f+=b.replace(/\/{2,}/g,"/"),f+=g,u=y+g.length}const x=s.pathname.slice(u,s.pathname.length);f+=x.replace(/\/{2,}/g,"/"),s.pathname=f}if(s.pathname)try{s.pathname=decodeURI(s.pathname)}catch{}if(e.removeDirectoryIndex===!0&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let c=s.pathname.split("/");const u=c[c.length-1];testParameter(u,e.removeDirectoryIndex)&&(c=c.slice(0,-1),s.pathname=`${c.slice(1).join("/")}/`)}if(s.hostname&&(s.hostname=s.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(s.hostname)&&(s.hostname=s.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(const c of[...s.searchParams.keys()])testParameter(c,e.removeQueryParameters)&&s.searchParams.delete(c);if(!Array.isArray(e.keepQueryParameters)&&e.removeQueryParameters===!0&&(s.search=""),Array.isArray(e.keepQueryParameters)&&e.keepQueryParameters.length>0)for(const c of[...s.searchParams.keys()])testParameter(c,e.keepQueryParameters)||s.searchParams.delete(c);if(e.sortQueryParameters){s.searchParams.sort();try{s.search=decodeURIComponent(s.search)}catch{}}e.removeTrailingSlash&&(s.pathname=s.pathname.replace(/\/$/,"")),e.removeExplicitPort&&s.port&&(s.port="");const o=t;return t=s.toString(),!e.removeSingleSlash&&s.pathname==="/"&&!o.endsWith("/")&&s.hash===""&&(t=t.replace(/\/$/,"")),(e.removeTrailingSlash||s.pathname==="/")&&s.hash===""&&e.removeSingleSlash&&(t=t.replace(/\/$/,"")),r&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}var NDKRelayKeepalive=class{constructor(t=3e4,e){this.onSilenceDetected=e,this.timeout=t}lastActivity=Date.now();timer;timeout;isRunning=!1;recordActivity(){this.lastActivity=Date.now(),this.isRunning&&this.resetTimer()}start(){this.isRunning||(this.isRunning=!0,this.lastActivity=Date.now(),this.resetTimer())}stop(){this.isRunning=!1,this.timer&&(clearTimeout(this.timer),this.timer=void 0)}resetTimer(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{const t=Date.now()-this.lastActivity;if(t>=this.timeout)this.onSilenceDetected();else{const e=this.timeout-t;this.timer=setTimeout(()=>{this.onSilenceDetected()},e)}},this.timeout)}};async function probeRelayConnection(t){const e=`probe-${Math.random().toString(36).substring(7)}`;return new Promise(r=>{let n=!1;const s=setTimeout(()=>{n||(n=!0,t.send(["CLOSE",e]),r(!1))},5e3),o=()=>{n||(n=!0,clearTimeout(s),t.send(["CLOSE",e]),r(!0))};t.once("message",o),t.send(["REQ",e,{kinds:[99999],limit:0}])})}var MAX_RECONNECT_ATTEMPTS=5,FLAPPING_THRESHOLD_MS=1e3,NDKRelayConnectivity=class{ndkRelay;ws;_status;timeoutMs;connectedAt;_connectionStats={attempts:0,success:0,durations:[]};debug;netDebug;connectTimeout;reconnectTimeout;ndk;openSubs=new Map;openCountRequests=new Map;openEventPublishes=new Map;pendingAuthPublishes=new Map;serial=0;baseEoseTimeout=4400;keepalive;wsStateMonitor;sleepDetector;lastSleepCheck=Date.now();lastMessageSent=Date.now();wasIdle=!1;constructor(t,e){this.ndkRelay=t,this._status=1;const r=Math.floor(Math.random()*1e3);this.debug=this.ndkRelay.debug.extend(`connectivity${r}`),this.ndk=e,this.setupMonitoring()}setupMonitoring(){this.keepalive=new NDKRelayKeepalive(12e4,async()=>{this.debug("Relay silence detected, probing connection"),await probeRelayConnection({send:e=>this.send(JSON.stringify(e)),once:(e,r)=>{const n=s=>{try{const o=JSON.parse(s.data);(o[0]==="EOSE"||o[0]==="EVENT"||o[0]==="NOTICE")&&(r(),this.ws?.removeEventListener("message",n))}catch{}};this.ws?.addEventListener("message",n)}})||(this.debug("Probe failed, connection is stale"),this.handleStaleConnection())}),this.wsStateMonitor=setInterval(()=>{this._status===5&&(!this.ws||this.ws.readyState!==WebSocket.OPEN)&&(this.debug("WebSocket died silently, reconnecting"),this.handleStaleConnection())},5e3),this.sleepDetector=setInterval(()=>{const t=Date.now(),e=t-this.lastSleepCheck;e>15e3&&(this.debug(`Detected possible sleep/wake (${e}ms gap)`),this.handlePossibleWake()),this.lastSleepCheck=t},1e4)}handleStaleConnection(){this._status=1,this.wasIdle=!0,this.onDisconnect()}handlePossibleWake(){this.debug("System wake detected, checking all connections"),this.wasIdle=!0,this._status>=5&&(!this.ws||this.ws.readyState!==WebSocket.OPEN?this.handleStaleConnection():probeRelayConnection({send:t=>this.send(JSON.stringify(t)),once:(t,e)=>{const r=n=>{try{const s=JSON.parse(n.data);(s[0]==="EOSE"||s[0]==="EVENT"||s[0]==="NOTICE")&&(e(),this.ws?.removeEventListener("message",r))}catch{}};this.ws?.addEventListener("message",r)}}).then(t=>{t||this.handleStaleConnection()}))}resetReconnectionState(){this.wasIdle=!0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0)}async connect(t,e=!0){if(this.ws&&this.ws.readyState!==WebSocket.OPEN&&this.ws.readyState!==WebSocket.CONNECTING){this.debug("Cleaning up stale WebSocket connection");try{this.ws.close()}catch{}this.ws=void 0,this._status=1}if(this._status!==2&&this._status!==1||this.reconnectTimeout){this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);return}this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),t??=this.timeoutMs,!this.timeoutMs&&t&&(this.timeoutMs=t),this.timeoutMs&&(this.connectTimeout=setTimeout(()=>this.onConnectionError(e),this.timeoutMs));try{this.updateConnectionStats.attempt(),this._status===1?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(r){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,r),this._status=1,e?this.handleReconnection():this.ndkRelay.emit("delayed-connect",2880*60*1e3),r}}disconnect(){this._status=0,this.keepalive?.stop(),this.wsStateMonitor&&(clearInterval(this.wsStateMonitor),this.wsStateMonitor=void 0),this.sleepDetector&&(clearInterval(this.sleepDetector),this.sleepDetector=void 0);try{this.ws?.close()}catch(t){this.debug("Failed to disconnect",t),this._status=1}}onConnectionError(t){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),t&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){this.netDebug?.("connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,this.keepalive?.start(),this.wasIdle=!1,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){this.netDebug?.("disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),this.keepalive?.stop(),this.clearPendingPublishes(new Error(`Relay ${this.ndkRelay.url} disconnected`)),this._status===5&&this.handleReconnection(),this._status=1,this.ndkRelay.emit("disconnect")}onMessage(t){this.netDebug?.(t.data,this.ndkRelay,"recv"),this.keepalive?.recordActivity();try{const e=JSON.parse(t.data),[r,n,...s]=e,o=this.ndkRelay.getProtocolHandler(r);if(o){o(this.ndkRelay,e);return}switch(r){case"EVENT":{const c=this.openSubs.get(n),u=e[2];if(!c){this.debug(`Received event for unknown subscription ${n}`);return}c.onevent(u);return}case"COUNT":{const c=e[2],u=this.openCountRequests.get(n);u&&(u.resolve(c.count),this.openCountRequests.delete(n));return}case"EOSE":{const c=this.openSubs.get(n);if(!c)return;c.oneose(n);return}case"OK":{const c=e[2],u=e[3],f=this.openEventPublishes.get(n),x=f?.pop();if(!f||!x){this.debug("Received OK for unknown event publish",n);return}c?(x.resolve(u),this.pendingAuthPublishes.delete(n)):u&&(u.toLowerCase().includes("auth-required")||u.toLowerCase().includes("not authorized")||u.toLowerCase().includes("blocked: not authorized"))?this.pendingAuthPublishes.get(n)?(this.debug("Publish failed due to auth-required, will retry after auth",n),f.push(x),this.openEventPublishes.set(n,f)):x.reject(new Error(u)):(x.reject(new Error(u)),this.pendingAuthPublishes.delete(n)),f.length===0?this.openEventPublishes.delete(n):!c&&!(u?.toLowerCase().includes("auth-required")||u?.toLowerCase().includes("not authorized")||u?.toLowerCase().includes("blocked: not authorized"))&&this.openEventPublishes.set(n,f);return}case"CLOSED":{const c=this.openSubs.get(n);if(!c)return;c.onclosed(e[2]);return}case"NOTICE":this.onNotice(e[1]);return;case"AUTH":{this.onAuthRequested(e[1]);return}}}catch(e){this.debug(`Error parsing message from ${this.ndkRelay.url}: ${e.message}`,e?.stack);return}}async onAuthRequested(t){const e=this.ndkRelay.authPolicy??this.ndk?.relayAuthDefaultPolicy;if(this.debug("Relay requested authentication",{havePolicy:!!e}),this._status===7){this.debug("Already authenticating, ignoring");return}if(this._status=6,e){if(this._status>=5){this._status=7;let r;try{r=await e(this.ndkRelay,t)}catch(n){this.debug("Authentication policy threw an error",n),r=!1}if(this.debug("Authentication policy returned",!!r),r instanceof NDKEvent||r===!0){r instanceof NDKEvent&&await this.auth(r);const n=async()=>{if(this._status>=5&&this._status<8){const s=new NDKEvent(this.ndk);s.kind=22242,s.tags=[["relay",this.ndkRelay.url],["challenge",t]],await s.sign(),this.auth(s).then(()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful"),this.retryPendingAuthPublishes()}).catch(o=>{this._status=6,this.ndkRelay.emit("auth:failed",o),this.debug("Authentication failed",o),this.rejectPendingAuthPublishes(o)})}else this.debug("Authentication failed, it changed status, status is %d",this._status)};r===!0&&(this.ndk?.signer?n().catch(s=>{console.error("Error authenticating",s)}):(this.debug("No signer available for authentication localhost"),this.ndk?.once("signer:ready",n))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",t)}onError(t){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,t)}get status(){return this._status}isAvailable(){return this._status===5}isFlapping(){const t=this._connectionStats.durations;if(t.length%3!==0)return!1;const r=t.reduce((c,u)=>c+u,0)/t.length,n=t.map(c=>(c-r)**2).reduce((c,u)=>c+u,0)/t.length;return Math.sqrt(n)<FLAPPING_THRESHOLD_MS}async onNotice(t){this.ndkRelay.emit("notice",t)}handleReconnection(t=0){if(this.reconnectTimeout)return;if(this.isFlapping()){this.ndkRelay.emit("flapping",this._connectionStats),this._status=3;return}let e;if(this.wasIdle){const r=[0,1e3,2e3,5e3,1e4,3e4];e=r[Math.min(t,r.length-1)],this.debug(`Using aggressive reconnect after idle, attempt ${t}, delay ${e}ms`)}else this.connectedAt?e=Math.max(0,6e4-(Date.now()-this.connectedAt)):(e=Math.min(1e3*2**t,3e4),this.debug(`Using standard backoff, attempt ${t}, delay ${e}ms`));this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch(r=>{t<MAX_RECONNECT_ATTEMPTS?this.handleReconnection(t+1):(this.debug("Max reconnect attempts reached"),this.wasIdle=!1)})},e),this.ndkRelay.emit("delayed-connect",e),this.debug("Reconnecting in",e),this._connectionStats.nextReconnectAt=Date.now()+e}async send(t){Date.now()-this.lastMessageSent>12e4&&(this.wasIdle=!0),this._status>=5&&this.ws?.readyState===WebSocket.OPEN?(this.ws?.send(t),this.netDebug?.(t,this.ndkRelay,"send"),this.lastMessageSent=Date.now()):(this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${t}`,this._status),this._status>=5&&this.ws?.readyState!==WebSocket.OPEN&&(this.debug(`Stale connection detected, WebSocket state: ${this.ws?.readyState}`),this.handleStaleConnection()))}async auth(t){const e=new Promise((r,n)=>{const s=this.openEventPublishes.get(t.id)??[];s.push({resolve:r,reject:n}),this.openEventPublishes.set(t.id,s)});return this.send(`["AUTH",${JSON.stringify(t.rawEvent())}]`),e}clearPendingPublishes(t){this.rejectPendingAuthPublishes(t);for(const[e,r]of this.openEventPublishes.entries()){for(;r.length>0;){const n=r.shift();n&&n.reject(t)}this.openEventPublishes.delete(e)}}retryPendingAuthPublishes(){if(this.pendingAuthPublishes.size!==0){this.debug(`Retrying ${this.pendingAuthPublishes.size} pending publishes after auth`);for(const[t,e]of this.pendingAuthPublishes.entries())this.debug(`Retrying publish for event ${t}`),this.send(`["EVENT",${JSON.stringify(e)}]`);this.pendingAuthPublishes.clear()}}rejectPendingAuthPublishes(t){if(this.pendingAuthPublishes.size!==0){this.debug(`Rejecting ${this.pendingAuthPublishes.size} pending publishes due to auth failure`);for(const[e]of this.pendingAuthPublishes.entries()){const r=this.openEventPublishes.get(e);if(r&&r.length>0){const n=r.pop();n&&n.reject(new Error(`Authentication failed: ${t.message}`)),r.length===0&&this.openEventPublishes.delete(e)}}this.pendingAuthPublishes.clear()}}async publish(t){const e=new Promise((r,n)=>{const s=this.openEventPublishes.get(t.id)??[];s.length>0&&console.warn(`Duplicate event publishing detected, you are publishing event ${t.id} twice`),s.push({resolve:r,reject:n}),this.openEventPublishes.set(t.id,s)});return this.pendingAuthPublishes.set(t.id,t),this.send(`["EVENT",${JSON.stringify(t)}]`),e}async count(t,e){this.serial++;const r=e?.id||`count:${this.serial}`,n=new Promise((s,o)=>{this.openCountRequests.set(r,{resolve:s,reject:o})});return this.send(`["COUNT","${r}",${JSON.stringify(t).substring(1)}`),n}close(t,e){this.send(`["CLOSE","${t}"]`);const r=this.openSubs.get(t);this.openSubs.delete(t),r&&r.onclose(e)}req(t){`${this.send(`["REQ","${t.subId}",${JSON.stringify(t.executeFilters).substring(1)}`)}`,this.openSubs.set(t.subId,t)}updateConnectionStats={connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}};get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){return this._status>=5&&this.ws?.readyState===WebSocket.OPEN}};async function fetchRelayInformation(t){const e=t.replace(/^wss:\/\//,"https://").replace(/^ws:\/\//,"http://"),r=await fetch(e,{headers:{Accept:"application/nostr+json"}});if(!r.ok)throw new Error(`Failed to fetch relay information: ${r.status} ${r.statusText}`);return await r.json()}var NDKRelayPublisher=class{ndkRelay;debug;constructor(t){this.ndkRelay=t,this.debug=t.debug.extend("publisher")}async publish(t,e=2500){let r;const n=()=>new Promise((p,g)=>{try{this.publishEvent(t).then(y=>{this.ndkRelay.emit("published",t),t.emit("relay:published",this.ndkRelay),p(!0)}).catch(g)}catch(y){g(y)}}),s=new Promise((p,g)=>{r=setTimeout(()=>{r=void 0,g(new Error(`Timeout: ${e}ms`))},e)}),o=()=>{n().then(p=>c(p)).catch(p=>u(p))};let c,u;const f=p=>{throw this.ndkRelay.debug("Publish failed",p,t.id),this.ndkRelay.emit("publish:failed",t,p),t.emit("relay:publish:failed",this.ndkRelay,p),p},x=()=>{r&&clearTimeout(r),this.ndkRelay.removeListener("connect",o)};return this.ndkRelay.status>=5?Promise.race([n(),s]).catch(f).finally(x):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise((p,g)=>{c=p,u=g,this.ndkRelay.on("connect",o)}),s]).catch(f).finally(x))}async publishEvent(t){return this.ndkRelay.connectivity.publish(t.rawEvent())}};function filterFingerprint(t,e){const r=[];for(const s of t){const o=Object.entries(s||{}).map(([c,u])=>["since","until"].includes(c)?`${c}:${u}`:c).sort().join("-");r.push(o)}let n=e?"+":"";return n+=r.join("|"),n}function mergeFilters(t){const e=[],r={};return t.filter(n=>!!n.limit).forEach(n=>e.push(n)),t=t.filter(n=>!n.limit),t.length===0?e:(t.forEach(n=>{Object.entries(n).forEach(([s,o])=>{Array.isArray(o)?r[s]===void 0?r[s]=[...o]:r[s]=Array.from(new Set([...r[s],...o])):r[s]=o})}),[...e,r])}var MAX_ITEMS=3;function formatArray(t,e){const n=(e?t.slice(0,MAX_ITEMS).map(e):t.slice(0,MAX_ITEMS)).join(",");return t.length>MAX_ITEMS?`${n}+${t.length-MAX_ITEMS}`:n}function formatFilters(t){return t.map(e=>{const r=[];e.ids?.length&&r.push(`ids:[${formatArray(e.ids,n=>String(n).slice(0,8))}]`),e.kinds?.length&&r.push(`kinds:[${formatArray(e.kinds)}]`),e.authors?.length&&r.push(`authors:[${formatArray(e.authors,n=>String(n).slice(0,8))}]`),e.since&&r.push(`since:${e.since}`),e.until&&r.push(`until:${e.until}`),e.limit&&r.push(`limit:${e.limit}`),e.search&&r.push(`search:"${String(e.search).slice(0,20)}"`);for(const[n,s]of Object.entries(e))n.startsWith("#")&&Array.isArray(s)&&s.length>0&&r.push(`${n}:[${formatArray(s,o=>String(o).slice(0,8))}]`);return`{${r.join(" ")}}`}).join(", ")}var NDKRelaySubscription=class{fingerprint;items=new Map;topSubManager;debug;status=0;onClose;relay;eosed=!1;executionTimer;fireTime;delayType;executeFilters;id=Math.random().toString(36).substring(7);constructor(t,e,r){this.relay=t,this.topSubManager=r,this.debug=t.debug.extend(`sub[${this.id}]`),this.fingerprint=e||Math.random().toString(36).substring(7)}_subId;get subId(){return this._subId?this._subId:(this._subId=this.fingerprint.slice(0,15),this._subId)}subIdParts=new Set;addSubIdPart(t){this.subIdParts.add(t)}addItem(t,e){if(this.debug("Adding item",{filters:formatFilters(e),internalId:t.internalId,status:this.status,fingerprint:this.fingerprint,id:this.subId,itemsSize:this.items.size}),!this.items.has(t.internalId))switch(t.on("close",this.removeItem.bind(this,t)),this.items.set(t.internalId,{subscription:t,filters:e}),this.status!==3&&t.subId&&(!this._subId||this._subId.length<25)&&(this.status===0||this.status===1)&&this.addSubIdPart(t.subId),this.status){case 0:this.evaluateExecutionPlan(t);break;case 3:break;case 1:this.evaluateExecutionPlan(t);break;case 4:throw this.debug("Subscription is closed, cannot add new items",{filters:formatFilters(e),subId:t.subId,internalId:t.internalId}),new Error("Cannot add new items to a closed subscription")}}removeItem(t){if(this.items.delete(t.internalId),this.items.size===0){if(!this.eosed)return;this.close(),this.cleanup()}}close(){if(this.status===4)return;const t=this.status;if(this.status=4,t===3)try{this.relay.close(this.subId)}catch(e){this.debug("Error closing subscription",e,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:t,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(t){if(!t.isGroupable()){this.status=1,this.execute();return}if(t.filters.find(n=>!!n.limit)&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10)){this.status=1,this.execute();return}const e=t.groupableDelay,r=t.groupableDelayType;if(!e)throw new Error("Cannot group a subscription without a delay");if(this.status===0)this.schedule(e,r);else{const n=this.delayType,s=this.fireTime-Date.now();if(n==="at-least"&&r==="at-least")s<e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,r));else if(n==="at-least"&&r==="at-most")s>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,r));else if(n==="at-most"&&r==="at-most")s>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,r));else if(n==="at-most"&&r==="at-least")s>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,r));else throw new Error(`Unknown delay type combination ${n} ${r}`)}}schedule(t,e){this.status=1;const r=Date.now();this.fireTime=r+t,this.delayType=e;const n=setTimeout(this.execute.bind(this),t);e==="at-least"&&(this.executionTimer=n)}executeOnRelayReady=()=>{if(this.status===2){if(this.items.size===0){this.debug("No items to execute; this relay was probably too slow to respond and the caller gave up",{status:this.status,fingerprint:this.fingerprint,id:this.id,subId:this.subId}),this.cleanup();return}this.debug("Executing on relay ready",{status:this.status,fingerprint:this.fingerprint,itemsSize:this.items.size,filters:formatFilters(this.compileFilters())}),this.status=1,this.execute()}};finalizeSubId(){if(this.subIdParts.size>0){let e=Array.from(this.subIdParts).map(r=>r.substring(0,10)).join("-");e.length>20&&(e=e.substring(0,20)),this._subId=e}else this._subId=this.fingerprint.slice(0,15);this._subId+=`-${Math.random().toString(36).substring(2,7)}`}reExecuteAfterAuth=(()=>{const t=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:t}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s  %s",t,this.subId)}).bind(this);execute(){if(this.status===1){if(!this.relay.connected){this.status=2,this.debug("Waiting for relay to be ready",{status:this.status,id:this.subId,fingerprint:this.fingerprint,itemsSize:this.items.size}),this.relay.once("ready",this.executeOnRelayReady);return}this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth),this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(t){this.topSubManager.dispatchEvent(t,this.relay)}oneose(t){if(this.eosed=!0,t!==this.subId){this.debug("Received EOSE for an abandoned subscription",t,this.subId),this.relay.close(t);return}this.items.size===0&&this.close();for(const{subscription:e}of this.items.values())e.eoseReceived(this.relay),e.closeOnEose&&(this.debug("Removing item because of EOSE",{filters:formatFilters(e.filters),internalId:e.internalId,status:this.status,fingerprint:this.fingerprint,itemsSize:this.items.size}),this.removeItem(e))}onclose(t){this.status=4}onclosed(t){if(t)for(const{subscription:e}of this.items.values())e.closedReceived(this.relay,t)}compileFilters(){const t=[],e=Array.from(this.items.values()).map(n=>n.filters);if(!e[0])return this.debug(" No filters to merge",{itemsSize:this.items.size}),[];const r=e[0].length;for(let n=0;n<r;n++){const s=e.map(c=>c[n]),o=mergeFilters(s);t.push(...o)}return t}},NDKRelaySubscriptionManager=class{relay;subscriptions;generalSubManager;constructor(t,e){this.relay=t,this.subscriptions=new Map,this.generalSubManager=e}addSubscription(t,e){let r;if(!t.isGroupable())r=this.createSubscription(t,e);else{const n=filterFingerprint(e,t.closeOnEose);n&&(r=(this.subscriptions.get(n)||[]).find(o=>o.status<3)),r??=this.createSubscription(t,e,n)}r.addItem(t,e)}createSubscription(t,e,r){const n=new NDKRelaySubscription(this.relay,r||null,this.generalSubManager);n.onClose=this.onRelaySubscriptionClose.bind(this);const s=this.subscriptions.get(n.fingerprint)??[];return this.subscriptions.set(n.fingerprint,[...s,n]),n}onRelaySubscriptionClose(t){let e=this.subscriptions.get(t.fingerprint)??[];e?e.length===1?this.subscriptions.delete(t.fingerprint):(e=e.filter(r=>r.id!==t.id),this.subscriptions.set(t.fingerprint,e)):console.warn("Unexpectedly did not find a subscription with fingerprint",t.fingerprint)}},NDKRelayStatus=(t=>(t[t.DISCONNECTING=0]="DISCONNECTING",t[t.DISCONNECTED=1]="DISCONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.FLAPPING=3]="FLAPPING",t[t.CONNECTING=4]="CONNECTING",t[t.CONNECTED=5]="CONNECTED",t[t.AUTH_REQUESTED=6]="AUTH_REQUESTED",t[t.AUTHENTICATING=7]="AUTHENTICATING",t[t.AUTHENTICATED=8]="AUTHENTICATED",t))(NDKRelayStatus||{}),NDKRelay=class jf extends libExports.EventEmitter{url;scores;connectivity;subs;publisher;authPolicy;protocolHandlers=new Map;_relayInfo;lowestValidationRatio;targetValidationRatio;validationRatioFn;validatedEventCount=0;nonValidatedEventCount=0;trusted=!1;complaining=!1;debug;static defaultValidationRatioUpdateFn=(e,r,n)=>{if(e.lowestValidationRatio===void 0||e.targetValidationRatio===void 0)return 1;let s=e.validationRatio;if(e.validationRatio>e.targetValidationRatio){const o=r/100;s=Math.max(e.lowestValidationRatio,e.validationRatio-o)}return s<e.validationRatio?s:e.validationRatio};constructor(e,r,n){super(),this.url=normalizeRelayUrl(e),this.scores=new Map,this.debug=createDebug5(`ndk:relay:${e}`),this.connectivity=new NDKRelayConnectivity(this,n),this.connectivity.netDebug=n?.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new NDKRelaySubscriptionManager(this,n.subManager),this.publisher=new NDKRelayPublisher(this),this.authPolicy=r,this.targetValidationRatio=n?.initialValidationRatio,this.lowestValidationRatio=n?.lowestValidationRatio,this.validationRatioFn=(n?.validationRatioFn??jf.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),n||console.trace("relay created without ndk")}updateValidationRatio(){if(this.validationRatioFn&&this.validatedEventCount>0){const e=this.validationRatioFn(this,this.validatedEventCount,this.nonValidatedEventCount);this.targetValidationRatio=e}setTimeout(()=>{this.updateValidationRatio()},3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(e,r=!0){return this.connectivity.connect(e,r)}disconnect(){this.status!==1&&this.connectivity.disconnect()}subscribe(e,r){this.subs.addSubscription(e,r)}async publish(e,r=2500){return this.publisher.publish(e,r)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return this.nonValidatedEventCount===0?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return this.trusted?!1:this.targetValidationRatio===void 0||this.targetValidationRatio>=1?!0:Math.random()<this.targetValidationRatio}get connected(){return this.connectivity.connected}req;close;registerProtocolHandler(e,r){this.protocolHandlers.set(e,r)}unregisterProtocolHandler(e){this.protocolHandlers.delete(e)}getProtocolHandler(e){return this.protocolHandlers.get(e)}async fetchInfo(e=!1){const n=this.connectivity.ndk;if(!e&&n?.cacheAdapter?.getRelayStatus){const s=await n.cacheAdapter.getRelayStatus(this.url);if(s?.nip11&&Date.now()-s.nip11.fetchedAt<864e5)return this._relayInfo=s.nip11.data,s.nip11.data}return!e&&this._relayInfo?this._relayInfo:(this._relayInfo=await fetchRelayInformation(this.url),n?.cacheAdapter?.updateRelayStatus&&await n.cacheAdapter.updateRelayStatus(this.url,{nip11:{data:this._relayInfo,fetchedAt:Date.now()}}),this._relayInfo)}get info(){return this._relayInfo}},NDKPublishError=class extends Error{errors;publishedToRelays;intendedRelaySet;constructor(t,e,r,n){super(t),this.errors=e,this.publishedToRelays=r,this.intendedRelaySet=n}get relayErrors(){const t=[];for(const[e,r]of this.errors)t.push(`${e.url}: ${r}`);return t.join(`
`)}},NDKRelaySet=class Nf{relays;debug;ndk;pool;constructor(e,r,n){this.relays=e,this.ndk=r,this.pool=n??r.pool,this.debug=r.debug.extend("relayset")}addRelay(e){this.relays.add(e)}get relayUrls(){return Array.from(this.relays).map(e=>e.url)}static fromRelayUrls(e,r,n=!0,s){if(s=s??r.pool,!s)throw new Error("No pool provided");const o=new Set;for(const c of e){const u=s.relays.get(normalizeRelayUrl(c));if(u)u.status<5&&n&&u.connect(),o.add(u);else{const f=new NDKRelay(normalizeRelayUrl(c),r?.relayAuthDefaultPolicy,r);s.useTemporaryRelay(f,void 0,`requested from fromRelayUrls ${e}`),o.add(f)}}return new Nf(new Set(o),r,s)}async publish(e,r,n=1){const s=new Set,o=new Map,c=e.isEphemeral();e.publishStatus="pending";const u=f=>{s.add(f)};e.on("relay:published",u);try{const f=Array.from(this.relays).map(x=>new Promise(p=>{const g=r?setTimeout(()=>{s.has(x)||(o.set(x,new Error(`Publish timeout after ${r}ms`)),p(!1))},r):null;x.publish(e,r).then(y=>{g&&clearTimeout(g),y?(s.add(x),p(!0)):p(!1)}).catch(y=>{g&&clearTimeout(g),c||o.set(x,y),p(!1)})}));if(await Promise.all(f),s.size<n){if(!c){const x=new NDKPublishError("Not enough relays received the event ("+s.size+" published, "+n+" required)",o,s,this);throw e.publishStatus="error",e.publishError=x,this.ndk?.emit("event:publish-failed",e,x,this.relayUrls),x}}else e.publishStatus="success",e.emit("published",{relaySet:this,publishedToRelays:s});return s}finally{e.off("relay:published",u)}}get size(){return this.relays.size}},d=createDebug5("ndk:outbox:calculate");async function calculateRelaySetFromEvent(t,e,r){const n=new Set,s=await getWriteRelaysFor(t,e.pubkey);s&&s.forEach(u=>{const f=t.pool?.getRelay(u);f&&n.add(f)});let o=e.tags.filter(u=>["a","e"].includes(u[0])).map(u=>u[2]).filter(u=>u?.startsWith("wss://")).filter(u=>{try{return new URL(u),!0}catch{return!1}}).map(u=>normalizeRelayUrl(u));o=Array.from(new Set(o)).slice(0,5),o.forEach(u=>{const f=t.pool?.getRelay(u,!0,!0);f&&(d("Adding relay hint %s",u),n.add(f))});const c=e.getMatchingTags("p").map(u=>u[1]);return c.length<5?Array.from(chooseRelayCombinationForPubkeys(t,c,"read",{preferredRelays:new Set(s)}).keys()).forEach(f=>{const x=t.pool?.getRelay(f,!1,!0);x&&(d("Adding p-tagged relay %s",f),n.add(x))}):d("Too many p-tags to consider %d",c.length),t.pool?.permanentAndConnectedRelays().forEach(u=>n.add(u)),r&&n.size<r&&t.explicitRelayUrls?.filter(f=>!Array.from(n).some(x=>x.url===f)).slice(0,r-n.size)?.forEach(f=>{const x=t.pool?.getRelay(f,!1,!0);x&&(d("Adding explicit relay %s",f),n.add(x))}),new NDKRelaySet(n,t)}function calculateRelaySetsFromFilter(t,e,r,n){const s=new Map,o=new Set;if(e.forEach(c=>{c.authors&&c.authors.forEach(u=>o.add(u))}),o.size>0){const c=getRelaysForFilterWithAuthors(t,Array.from(o),n);for(const u of c.keys())s.set(u,[]);for(const u of e)if(u.authors)for(const[f,x]of c.entries()){const p=u.authors.filter(g=>x.includes(g));s.set(f,[...s.get(f),{...u,authors:p}])}else for(const f of c.keys())s.set(f,[...s.get(f),u])}else t.explicitRelayUrls&&t.explicitRelayUrls.forEach(c=>{s.set(c,e)});return s.size===0&&r.permanentAndConnectedRelays().slice(0,5).forEach(c=>{s.set(c.url,e)}),s}function calculateRelaySetsFromFilters(t,e,r,n){return calculateRelaySetsFromFilter(t,e,r,n)}function isValidHex64(t){if(typeof t!="string"||t.length!==64)return!1;for(let e=0;e<64;e++){const r=t.charCodeAt(e);if(!(r>=48&&r<=57||r>=97&&r<=102||r>=65&&r<=70))return!1}return!0}function isValidPubkey(t){return isValidHex64(t)}function isValidNip05(t){if(typeof t!="string")return!1;for(let e=0;e<t.length;e++)if(t.charCodeAt(e)===46)return!0;return!1}function mergeTags(t,e){const r=new Map,n=c=>c.join(","),s=(c,u)=>c.every((f,x)=>f===u[x]),o=c=>{for(const[u,f]of r)if(s(f,c)||s(c,f)){c.length>=f.length&&r.set(u,c);return}r.set(n(c),c)};return t.concat(e).forEach(o),Array.from(r.values())}var hashtagRegex=new RegExp(`(?<=\\s|^)(#[^\\s!@#$%^&*()=+./,[{\\]};:'"?><]+)`,"g");function generateHashtags(t){const e=t.match(hashtagRegex),r=new Set,n=new Set;if(e)for(const s of e)r.has(s.slice(1))||(n.add(s.slice(1)),r.add(s.slice(1)));return Array.from(n)}async function generateContentTags(t,e=[],r,n){if(r?.skipContentTagging)return{content:t,tags:e};const s=/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,o=[],c=u=>{e.find(f=>["q",u[0]].includes(f[0])&&f[1]===u[1])||e.push(u)};if(t=t.replace(s,u=>{try{const f=u.split(/(@|nostr:)/)[2],{type:x,data:p}=nip19_exports$1.decode(f);let g;if(r?.filters){const y=!r.filters.includeTypes||r.filters.includeTypes.includes(x),b=r.filters.excludeTypes?.includes(x);if(!y||b)return u}switch(x){case"npub":r?.pTags!==!1&&(g=["p",p]);break;case"nprofile":r?.pTags!==!1&&(g=["p",p.pubkey]);break;case"note":o.push(new Promise(async y=>{const b=await maybeGetEventRelayUrl(f);c(["q",p,b]),y()}));break;case"nevent":o.push(new Promise(async y=>{const{id:b,author:R}=p;let{relays:D}=p;(!D||D.length===0)&&(D=[await maybeGetEventRelayUrl(f)]),c(["q",b,D[0]]),R&&r?.pTags!==!1&&r?.pTagOnQTags!==!1&&c(["p",R]),y()}));break;case"naddr":o.push(new Promise(async y=>{const b=[p.kind,p.pubkey,p.identifier].join(":");let R=p.relays??[];R.length===0&&(R=[await maybeGetEventRelayUrl(f)]),c(["q",b,R[0]]),r?.pTags!==!1&&r?.pTagOnQTags!==!1&&r?.pTagOnATags!==!1&&c(["p",p.pubkey]),y()}));break;default:return u}return g&&c(g),`nostr:${f}`}catch{return u}}),await Promise.all(o),!r?.filters?.excludeTypes?.includes("hashtag")){const u=generateHashtags(t).map(f=>["t",f]);e=mergeTags(e,u)}if(r?.pTags!==!1&&r?.copyPTagsFromTarget&&n){const u=n.getMatchingTags("p");for(const f of u)!f[1]||!isValidPubkey(f[1])||e.find(x=>x[0]==="p"&&x[1]===f[1])||e.push(f)}return{content:t,tags:e}}async function maybeGetEventRelayUrl(t){return""}async function encrypt(t,e,r="nip44"){let n;if(!this.ndk)throw new Error("No NDK instance found!");let s=e;if(s||(this.ndk.assertSigner(),s=this.ndk.signer),!s)throw new Error("no NDK signer");const o=t||(()=>{const c=this.getMatchingTags("p");if(c.length!==1)throw new Error("No recipient could be determined and no explicit recipient was provided");return this.ndk.getUser({pubkey:c[0][1]})})();if(r==="nip44"&&await isEncryptionEnabled(s,"nip44")&&(n=await s.encrypt(o,this.content,"nip44")),(!n||r==="nip04")&&await isEncryptionEnabled(s,"nip04")&&(n=await s.encrypt(o,this.content,"nip04")),!n)throw new Error("Failed to encrypt event.");this.content=n}async function decrypt(t,e,r){if(this.ndk?.cacheAdapter?.getDecryptedEvent){const u=await this.ndk.cacheAdapter.getDecryptedEvent(this.id);if(u){this.content=u.content;return}}let n;if(!this.ndk)throw new Error("No NDK instance found!");let s=e;if(s||(this.ndk.assertSigner(),s=this.ndk.signer),!s)throw new Error("no NDK signer");const o=t||this.author;if(!o)throw new Error("No sender provided and no author available");const c=r||(this.content.match(/\\?iv=/)?"nip04":"nip44");if((c==="nip04"||this.kind===4)&&await isEncryptionEnabled(s,"nip04")&&this.content.search("\\?iv=")&&(n=await s.decrypt(o,this.content,"nip04")),!n&&c==="nip44"&&await isEncryptionEnabled(s,"nip44")&&(n=await s.decrypt(o,this.content,"nip44")),!n)throw new Error("Failed to decrypt event.");this.content=n,this.ndk?.cacheAdapter?.addDecryptedEvent&&this.ndk.cacheAdapter.addDecryptedEvent(this.id,this)}async function isEncryptionEnabled(t,e){return t.encryptionEnabled?e?!!await t.encryptionEnabled(e):!0:!1}function eventHasETagMarkers(t){for(const e of t.tags)if(e[0]==="e"&&(e[3]??"").length>0)return!0;return!1}function getRootTag(t,e){e??=t.tagType();const r=t.tags.find(isTagRootTag);if(!r){if(eventHasETagMarkers(t))return;const n=t.getMatchingTags(e);if(n.length<3)return n[0]}return r}var nip22RootTags=new Set(["A","E","I"]),nip22ReplyTags=new Set(["a","e","i"]);function getReplyTag(t,e){if(t.kind===1111){let s;for(const o of t.tags)if(nip22RootTags.has(o[0]))s=o;else if(nip22ReplyTags.has(o[0])){s=o;break}return s}e??=t.tagType();let r=!1,n;for(const s of t.tags)if(s[0]===e){if((s[3]??"").length>0&&(r=!0),r&&s[3]==="reply")return s;r&&s[3]==="root"&&(n=s),r||(n=s)}return n}function isTagRootTag(t){return t[0]==="E"||t[3]==="root"}async function fetchTaggedEvent(t,e){if(!this.ndk)throw new Error("NDK instance not found");const r=this.getMatchingTags(t,e);if(r.length===0)return;const[n,s,o]=r[0],c=o!==""?this.ndk.pool.getRelay(o):void 0;return await this.ndk.fetchEvent(s,{},c)}async function fetchRootEvent(t){if(!this.ndk)throw new Error("NDK instance not found");const e=getRootTag(this);if(e)return this.ndk.fetchEventFromTag(e,this,t)}async function fetchReplyEvent(t){if(!this.ndk)throw new Error("NDK instance not found");const e=getReplyTag(this);if(e)return this.ndk.fetchEventFromTag(e,this,t)}function isReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function isEphemeral(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function isParamReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var DEFAULT_RELAY_COUNT=2;function encode$l(t=DEFAULT_RELAY_COUNT){let e=[];return this.onRelays.length>0?e=this.onRelays.map(r=>r.url):this.relay&&(e=[this.relay.url]),e.length>t&&(e=e.slice(0,t)),this.isParamReplaceable()?nip19_exports$1.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:e}):e.length>0?nip19_exports$1.neventEncode({id:this.tagId(),relays:e,author:this.pubkey}):nip19_exports$1.noteEncode(this.tagId())}async function repost(t=!0,e){if(!e&&t){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),e=this.ndk.signer}const r=new NDKEvent(this.ndk,{kind:getKind(this)});return this.isProtected||(r.content=JSON.stringify(this.rawEvent())),r.tag(this),this.kind!==1&&r.tags.push(["k",`${this.kind}`]),e&&await r.sign(e),t&&await r.publish(),r}function getKind(t){return t.kind===1?6:16}function getEventDetails(t){return"inspect"in t&&typeof t.inspect=="string"?t.inspect:JSON.stringify(t)}function validateForSerialization(t){if(typeof t.kind!="number")throw new Error(`Can't serialize event with invalid properties: kind (must be number, got ${typeof t.kind}). Event: ${getEventDetails(t)}`);if(typeof t.content!="string")throw new Error(`Can't serialize event with invalid properties: content (must be string, got ${typeof t.content}). Event: ${getEventDetails(t)}`);if(typeof t.created_at!="number")throw new Error(`Can't serialize event with invalid properties: created_at (must be number, got ${typeof t.created_at}). Event: ${getEventDetails(t)}`);if(typeof t.pubkey!="string")throw new Error(`Can't serialize event with invalid properties: pubkey (must be string, got ${typeof t.pubkey}). Event: ${getEventDetails(t)}`);if(!Array.isArray(t.tags))throw new Error(`Can't serialize event with invalid properties: tags (must be array, got ${typeof t.tags}). Event: ${getEventDetails(t)}`);for(let e=0;e<t.tags.length;e++){const r=t.tags[e];if(!Array.isArray(r))throw new Error(`Can't serialize event with invalid properties: tags[${e}] (must be array, got ${typeof r}). Event: ${getEventDetails(t)}`);for(let n=0;n<r.length;n++)if(typeof r[n]!="string")throw new Error(`Can't serialize event with invalid properties: tags[${e}][${n}] (must be string, got ${typeof r[n]}). Event: ${getEventDetails(t)}`)}}function serialize(t=!1,e=!1){validateForSerialization(this);const r=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return t&&r.push(this.sig),e&&r.push(this.id),JSON.stringify(r)}function deserialize(t){const e=JSON.parse(t),r={pubkey:e[1],created_at:e[2],kind:e[3],tags:e[4],content:e[5]};if(e.length>=7){const n=e[6],s=e[7];n&&n.length===128?(r.sig=n,s&&s.length===64&&(r.id=s)):n&&n.length===64&&(r.id=n,s&&s.length===128&&(r.sig=s))}return r}var worker,processingQueue={};function signatureVerificationInit(t){worker=t,worker.onmessage=e=>{if(!Array.isArray(e.data)||e.data.length!==2){console.error("[NDK]  Signature verification worker received incompatible message format.",`

 Expected format: [eventId, boolean]`,`
 Received:`,e.data,`

 This likely means:`,`
  1. You have a STALE worker.js file that needs updating`,`
  2. Version mismatch between @nostr-dev-kit/ndk and deployed worker`,`
  3. Wrong worker is being used for signature verification`,`

 Solution: Update your worker files:`,`
  cp node_modules/@nostr-dev-kit/ndk/dist/workers/sig-verification.js public/`,`
  cp node_modules/@nostr-dev-kit/cache-sqlite-wasm/dist/worker.js public/`,`

 Or use Vite/bundler imports instead of static files:`,`
  import SigWorker from "@nostr-dev-kit/ndk/workers/sig-verification?worker"`);return}const[r,n]=e.data,s=processingQueue[r];if(!s){console.error("No record found for event",r);return}delete processingQueue[r];for(const o of s.resolves)o(n)}}async function verifySignatureAsync(t,e,r){const n=t.ndk,s=Date.now();let o;return n.signatureVerificationFunction?o=await n.signatureVerificationFunction(t):o=await new Promise(c=>{const u=t.serialize();let f=!1;processingQueue[t.id]||(processingQueue[t.id]={event:t,resolves:[],relay:r},f=!0),processingQueue[t.id].resolves.push(c),f&&worker?.postMessage({serialized:u,id:t.id,sig:t.sig,pubkey:t.pubkey})}),n.signatureVerificationTimeMs+=Date.now()-s,o}var PUBKEY_REGEX=/^[a-f0-9]{64}$/;function validate(){if(typeof this.kind!="number"||typeof this.content!="string"||typeof this.created_at!="number"||typeof this.pubkey!="string"||!this.pubkey.match(PUBKEY_REGEX)||!Array.isArray(this.tags))return!1;for(let t=0;t<this.tags.length;t++){const e=this.tags[t];if(!Array.isArray(e))return!1;for(let r=0;r<e.length;r++)if(typeof e[r]=="object")return!1}return!0}var verifiedSignatures=new distExports$2.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function verifySignature(t){if(typeof this.signatureVerified=="boolean")return this.signatureVerified;const e=verifiedSignatures.get(this.id);if(e!==null)return this.signatureVerified=!!e,this.signatureVerified;try{if(this.ndk?.asyncSigVerification){const r=this.relay;verifySignatureAsync(this,t,r).then(n=>{t&&(this.signatureVerified=n,n&&verifiedSignatures.set(this.id,this.sig)),n?r&&r.addValidatedEvent():(r?this.ndk?.reportInvalidSignature(this,r):this.ndk?.reportInvalidSignature(this),verifiedSignatures.set(this.id,!1))}).catch(n=>{console.error("signature verification error",this.id,n)})}else{const r=sha256$5(new TextEncoder().encode(this.serialize())),n=schnorr$1.verify(this.sig,r,this.pubkey);return n?verifiedSignatures.set(this.id,this.sig):verifiedSignatures.set(this.id,!1),this.signatureVerified=n,n}}catch{return this.signatureVerified=!1,!1}}function getEventHash(){return getEventHashFromSerializedEvent(this.serialize())}function getEventHashFromSerializedEvent(t){const e=sha256$5(new TextEncoder().encode(t));return bytesToHex$5(e)}var skipClientTagOnKinds=new Set([0,4,1059,13,3,9734,5]),NDKEvent=class Hi extends libExports.EventEmitter{ndk;created_at;content="";tags=[];kind;id="";sig;pubkey="";signatureVerified;_author=void 0;relay;get onRelays(){let e=[];return this.ndk?e=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&e.push(this.relay),e}publishStatus="success";publishError;constructor(e,r){super(),this.ndk=e,this.created_at=r?.created_at,this.content=r?.content||"",this.tags=r?.tags||[],this.id=r?.id||"",this.sig=r?.sig,this.pubkey=r?.pubkey||"",this.kind=r?.kind,r instanceof Hi&&(this.relay&&(this.relay=r.relay,this.ndk?.subManager.seenEvent(r.id,this.relay)),this.publishStatus=r.publishStatus,this.publishError=r.publishError)}static deserialize(e,r){return new Hi(e,deserialize(r))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(e){this.pubkey=e.pubkey,this._author=e,this._author.ndk??=this.ndk}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const e=this.ndk.getUser({pubkey:this.pubkey});return this._author=e,e}tagExternal(e,r,n){const s=["i"],o=["k"];switch(r){case"url":{const c=new URL(e);c.hash="",s.push(c.toString()),o.push(`${c.protocol}//${c.host}`);break}case"hashtag":s.push(`#${e.toLowerCase()}`),o.push("#");break;case"geohash":s.push(`geo:${e.toLowerCase()}`),o.push("geo");break;case"isbn":s.push(`isbn:${e.replace(/-/g,"")}`),o.push("isbn");break;case"podcast:guid":s.push(`podcast:guid:${e}`),o.push("podcast:guid");break;case"podcast:item:guid":s.push(`podcast:item:guid:${e}`),o.push("podcast:item:guid");break;case"podcast:publisher:guid":s.push(`podcast:publisher:guid:${e}`),o.push("podcast:publisher:guid");break;case"isan":s.push(`isan:${e.split("-").slice(0,4).join("-")}`),o.push("isan");break;case"doi":s.push(`doi:${e.toLowerCase()}`),o.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${r}`)}n&&s.push(n),this.tags.push(s),this.tags.push(o)}tag(e,r,n,s,o){let c=[];if(e.fetchProfile!==void 0){if(s??="p",s==="p"&&o?.pTags===!1)return;const f=[s,e.pubkey];r&&f.push("",r),c.push(f)}else if(e instanceof Hi){const f=e;if(n??=f?.pubkey===this.pubkey,c=f.referenceTags(r,n,s,o),o?.pTags!==!1)for(const x of f.getMatchingTags("p"))!x[1]||!isValidPubkey(x[1])||x[1]!==this.pubkey&&(this.tags.find(p=>p[0]==="p"&&p[1]===x[1])||this.tags.push(["p",x[1]]))}else if(Array.isArray(e))c=[e];else throw new Error("Invalid argument",e);this.tags=mergeTags(this.tags,c)}async toNostrEvent(e,r){if(!e&&this.pubkey===""){const o=await this.ndk?.signer?.user();this.pubkey=o?.pubkey||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:n,tags:s}=await this.generateTags(r);this.content=n||"",this.tags=s;try{this.id=this.getEventHash()}catch{}return this.rawEvent()}serialize=serialize.bind(this);getEventHash=getEventHash.bind(this);validate=validate.bind(this);verifySignature=verifySignature.bind(this);isReplaceable=isReplaceable.bind(this);isEphemeral=isEphemeral.bind(this);isDvm=()=>this.kind&&this.kind>=5e3&&this.kind<=7e3;isParamReplaceable=isParamReplaceable.bind(this);encode=encode$l.bind(this);encrypt=encrypt.bind(this);decrypt=decrypt.bind(this);getMatchingTags(e,r){const n=this.tags.filter(s=>s[0]===e);return r===void 0?n:n.filter(s=>s[3]===r)}hasTag(e,r){return this.tags.some(n=>n[0]===e&&(!r||n[3]===r))}tagValue(e,r){const n=this.getMatchingTags(e,r);if(n.length!==0)return n[0][1]}get alt(){return this.tagValue("alt")}set alt(e){this.removeTag("alt"),e&&this.tags.push(["alt",e])}get dTag(){return this.tagValue("d")}set dTag(e){this.removeTag("d"),e&&this.tags.push(["d",e])}removeTag(e,r){const n=Array.isArray(e)?e:[e];this.tags=this.tags.filter(s=>{const o=n.includes(s[0]),c=r?s[3]===r:!0;return!(o&&c)})}replaceTag(e){this.removeTag(e[0]),this.tags.push(e)}async sign(e,r){this.ndk?.aiGuardrails?.event?.signing(this),e?this.author=await e.user():(this.ndk?.assertSigner(),e=this.ndk?.signer);const n=await this.toNostrEvent(void 0,r);return this.sig=await e.sign(n),this.sig}async publishReplaceable(e,r,n){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(e,r,n)}async publish(e,r,n,s){if(n||(n=1),this.sig||await this.sign(void 0,s),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");if(this.ndk.aiGuardrails?.event?.publishing(this),(!e||e.size===0)&&(e=this.ndk.devWriteRelaySet||await calculateRelaySetFromEvent(this.ndk,this,n)),this.kind===5&&this.ndk.cacheAdapter?.deleteEventIds){const u=this.getMatchingTags("e").map(f=>f[1]);this.ndk.cacheAdapter.deleteEventIds(u)}const o=this.rawEvent();if(this.ndk.cacheAdapter?.addUnpublishedEvent&&shouldTrackUnpublishedEvent(this))try{this.ndk.cacheAdapter.addUnpublishedEvent(this,e.relayUrls)}catch(u){console.error("Error adding unpublished event to cache",u)}this.kind===5&&this.ndk.cacheAdapter?.deleteEventIds&&this.ndk.cacheAdapter.deleteEventIds(this.getMatchingTags("e").map(u=>u[1])),this.ndk.subManager.dispatchEvent(o,void 0,!0);const c=await e.publish(this,r,n);return c.forEach(u=>this.ndk?.subManager.seenEvent(this.id,u)),c}async generateTags(e){let r=[];const n=await generateContentTags(this.content,this.tags,e,this),s=n.content;if(r=n.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){const c=this.tagValue("title");let f=[...Array(c?6:16)].map(()=>Math.random().toString(36)[2]).join("");c&&c.length>0&&(f=`${c.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")}-${f}`),r.push(["d",f])}if(this.shouldAddClientTag){const o=["client",this.ndk?.clientName??""];this.ndk?.clientNip89&&o.push(this.ndk?.clientNip89),r.push(o)}else this.shouldStripClientTag&&(r=r.filter(o=>o[0]!=="client"));return{content:s||"",tags:r}}get shouldAddClientTag(){return!(!this.ndk?.clientName&&!this.ndk?.clientNip89||skipClientTagOnKinds.has(this.kind)||this.isEphemeral()||this.isReplaceable()&&!this.isParamReplaceable()||this.isDvm()||this.hasTag("client"))}get shouldStripClientTag(){return skipClientTagOnKinds.has(this.kind)}muted(){return this.ndk?.muteFilter&&this.ndk.muteFilter(this)?"muted":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const e=this.getMatchingTags("d")[0];return e?e[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return this.kind===0||this.kind===3||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(this.isParamReplaceable()){const e=this.dTag??"";return`${this.kind}:${this.pubkey}:${e}`}if(this.isReplaceable())return`${this.kind}:${this.pubkey}:`;throw new Error("Event is not a replaceable event")}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(e){let r;return this.isParamReplaceable()?r=["a",this.tagAddress()]:r=["e",this.tagId()],this.relay?r.push(this.relay.url):r.push(""),r.push(e??""),this.isParamReplaceable()||r.push(this.pubkey),r}referenceTags(e,r,n,s){let o=[];return this.isParamReplaceable()?o=[[n??"a",this.tagAddress()],[n??"e",this.id]]:o=[[n??"e",this.id]],o=o.map(c=>(c[0]==="e"||e?c.push(this.relay?.url??""):this.relay?.url&&c.push(this.relay?.url),c)),o.forEach(c=>{c[0]==="e"?(c.push(e??""),c.push(this.pubkey)):e&&c.push(e)}),o=[...o,...this.getMatchingTags("h")],!r&&s?.pTags!==!1&&o.push(...this.author.referenceTags()),o}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}nip22Filter(){return this.isParamReplaceable()?{"#A":[this.tagId()]}:{"#E":[this.tagId()]}}async delete(e,r=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const n=new Hi(this.ndk,{kind:5,content:e||""});return n.tag(this,void 0,!0),n.tags.push(["k",this.kind?.toString()]),r&&(this.emit("deleted"),await n.publish()),n}set isProtected(e){this.removeTag("-"),e&&this.tags.push(["-"])}get isProtected(){return this.hasTag("-")}fetchTaggedEvent=fetchTaggedEvent.bind(this);fetchRootEvent=fetchRootEvent.bind(this);fetchReplyEvent=fetchReplyEvent.bind(this);repost=repost.bind(this);async react(e,r=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const n=new Hi(this.ndk,{kind:7,content:e});return n.tag(this),this.kind!==1&&n.tags.push(["k",`${this.kind}`]),r&&await n.publish(),n}get isValid(){return this.validate()}get inspect(){return JSON.stringify(this.rawEvent(),null,4)}dump(){console.debug(JSON.stringify(this.rawEvent(),null,4)),console.debug("Event on relays:",this.onRelays.map(e=>e.url).join(", "))}reply(e,r){const n=new Hi(this.ndk);if(this.ndk?.aiGuardrails?.event?.creatingReply(n),this.kind===1&&!e)n.kind=1,this.hasTag("e")?n.tags=[...n.tags,...this.getMatchingTags("e"),...this.getMatchingTags("p"),...this.getMatchingTags("a"),...this.referenceTags("reply",!1,void 0,r)]:n.tag(this,"root",!1,void 0,r);else{n.kind=1111;const s=["A","E","I","P"],o=this.tags.filter(c=>s.includes(c[0]));if(o.length>0){const c=this.tagValue("K");n.tags.push(...o),c&&n.tags.push(["K",c]);let u;if(this.isParamReplaceable()){u=["a",this.tagAddress()];const f=this.relay?.url??"";f&&u.push(f)}else{u=["e",this.tagId()];const f=this.relay?.url??"";u.push(f),u.push(this.pubkey)}n.tags.push(u)}else{let c,u;const f=this.relay?.url??"";this.isParamReplaceable()?(c=["a",this.tagAddress(),f],u=["A",this.tagAddress(),f]):(c=["e",this.tagId(),f,this.pubkey],u=["E",this.tagId(),f,this.pubkey]),n.tags.push(c),n.tags.push(u),n.tags.push(["K",this.kind?.toString()]),r?.pTags!==!1&&r?.pTagOnATags!==!1&&n.tags.push(["P",this.pubkey])}n.tags.push(["k",this.kind?.toString()]),r?.pTags!==!1&&(n.tags.push(...this.getMatchingTags("p")),n.tags.push(["p",this.pubkey]))}return n}},untrackedUnpublishedEvents=new Set([24133,13194,23194,23195]);function shouldTrackUnpublishedEvent(t){return!untrackedUnpublishedEvents.has(t.kind)}var NDKPool=class extends libExports.EventEmitter{_relays=new Map;status="idle";autoConnectRelays=new Set;debug;temporaryRelayTimers=new Map;flappingRelays=new Set;backoffTimes=new Map;ndk;disconnectionTimes=new Map;systemEventDetector;constructor(t,e,{debug:r,name:n}={}){super(),this.debug=r??e.debug.extend("pool"),n&&(this._name=n),this.ndk=e,this.relayUrls=t,this.ndk.pools&&this.ndk.pools.push(this)}get relays(){return this._relays}set relayUrls(t){this._relays.clear();for(const e of t){const r=new NDKRelay(e,void 0,this.ndk);r.connectivity.netDebug=this.ndk.netDebug,this.addRelay(r)}}_name="unnamed";get name(){return this._name}set name(t){this._name=t,this.debug=this.debug.extend(t)}useTemporaryRelay(t,e=3e4,r){const n=this.relays.has(t.url);n||(this.addRelay(t),this.debug("Adding temporary relay %s for filters %o",t.url,r));const s=this.temporaryRelayTimers.get(t.url);if(s&&clearTimeout(s),!n||s){const o=setTimeout(()=>{this.ndk.explicitRelayUrls?.includes(t.url)||this.removeRelay(t.url)},e);this.temporaryRelayTimers.set(t.url,o)}}addRelay(t,e=!0){const r=this.relays.has(t.url),n=t.url.includes("/npub1");let s=!0;const o=t.url;if(r)return;if(this.ndk.relayConnectionFilter&&!this.ndk.relayConnectionFilter(o)){this.debug(`Refusing to add relay ${o}: blocked by relayConnectionFilter`);return}if(n){this.debug(`Refusing to add relay ${o}: is a filter relay`);return}if(this.ndk.cacheAdapter?.getRelayStatus){const b=this.ndk.cacheAdapter.getRelayStatus(o),R=b instanceof Promise?void 0:b;if(R?.dontConnectBefore){if(R.dontConnectBefore>Date.now()){const D=R.dontConnectBefore-Date.now();this.debug(`Refusing to add relay ${o}: delayed connect for ${D}ms`),setTimeout(()=>{this.addRelay(t,e)},D);return}s=!1}}const c=b=>this.emit("notice",t,b),u=()=>this.handleRelayConnect(o),f=()=>this.handleRelayReady(t),x=()=>{this.recordDisconnection(t),this.emit("relay:disconnect",t)},p=()=>this.handleFlapping(t),g=b=>this.emit("relay:auth",t,b),y=()=>this.emit("relay:authed",t);t.off("notice",c),t.off("connect",u),t.off("ready",f),t.off("disconnect",x),t.off("flapping",p),t.off("auth",g),t.off("authed",y),t.on("notice",c),t.on("connect",u),t.on("ready",f),t.on("disconnect",x),t.on("flapping",p),t.on("auth",g),t.on("authed",y),t.on("delayed-connect",b=>{this.ndk.cacheAdapter?.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(t.url,{dontConnectBefore:Date.now()+b})}),this._relays.set(o,t),e&&this.autoConnectRelays.add(o),e&&this.status==="active"&&(this.emit("relay:connecting",t),t.connect(void 0,s).catch(b=>{this.debug(`Failed to connect to relay ${o}`,b)}))}removeRelay(t){const e=this.relays.get(t);if(e)return e.disconnect(),this.relays.delete(t),this.autoConnectRelays.delete(t),this.emit("relay:disconnect",e),!0;const r=this.temporaryRelayTimers.get(t);return r&&(clearTimeout(r),this.temporaryRelayTimers.delete(t)),!1}isRelayConnected(t){const e=normalizeRelayUrl(t),r=this.relays.get(e);return r?r.status===5:!1}getRelay(t,e=!0,r=!1,n){let s=this.relays.get(normalizeRelayUrl(t));return s||(s=new NDKRelay(t,void 0,this.ndk),s.connectivity.netDebug=this.ndk.netDebug,r?this.useTemporaryRelay(s,3e4,n):this.addRelay(s,e)),s}handleRelayConnect(t){const e=this.relays.get(t);if(!e){console.error("NDK BUG: relay not found in pool",{relayUrl:t});return}this.emit("relay:connect",e),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(t){this.emit("relay:ready",t)}async connect(t){this.status="active",this.debug(`Connecting to ${this.relays.size} relays${t?`, timeout ${t}ms`:""}...`);const e=Array.from(this.autoConnectRelays.keys()).map(o=>this.relays.get(o)).filter(o=>!!o);for(const o of e)o.status!==5&&o.status!==4&&(this.emit("relay:connecting",o),o.connect().catch(c=>{this.debug(`Failed to connect to relay ${o.url}: ${c??"No reason specified"}`)}));const r=()=>e.every(o=>o.status===5),n=new Promise(o=>{if(r()){o();return}const c=[];for(const u of e){const f=()=>{if(r()){for(let x=0;x<e.length;x++)e[x].off("connect",c[x]);o()}};c.push(f),u.on("connect",f)}}),s=typeof t=="number"?new Promise(o=>setTimeout(o,t)):new Promise(()=>{});await Promise.race([n,s])}checkOnFlappingRelays(){const t=this.flappingRelays.size,e=this.relays.size;if(t/e>=.8)for(const r of this.flappingRelays)this.backoffTimes.set(r,0)}recordDisconnection(t){const e=Date.now();this.disconnectionTimes.set(t.url,e);for(const[r,n]of this.disconnectionTimes.entries())e-n>1e4&&this.disconnectionTimes.delete(r);this.checkForSystemWideDisconnection()}checkForSystemWideDisconnection(){const t=Date.now(),e=[];for(const r of this.disconnectionTimes.values())t-r<5e3&&e.push(r);e.length>this.relays.size/2&&this.relays.size>1&&(this.debug(`System-wide disconnection detected: ${e.length}/${this.relays.size} relays disconnected`),this.handleSystemWideReconnection())}handleSystemWideReconnection(){if(this.systemEventDetector){this.debug("System-wide reconnection already in progress, skipping");return}this.debug("Initiating system-wide reconnection with reset backoff"),this.systemEventDetector=setTimeout(()=>{this.systemEventDetector=void 0},1e4);for(const t of this.relays.values())t.connectivity&&(t.connectivity.resetReconnectionState(),t.status!==5&&t.status!==4&&t.connect().catch(e=>{this.debug(`Failed to reconnect relay ${t.url} after system event: ${e}`)}));this.disconnectionTimes.clear()}handleFlapping(t){this.debug(`Relay ${t.url} is flapping`);let e=this.backoffTimes.get(t.url)||5e3;e=e*2,this.backoffTimes.set(t.url,e),this.debug(`Backoff time for ${t.url} is ${e}ms`),setTimeout(()=>{this.debug(`Attempting to reconnect to ${t.url}`),this.emit("relay:connecting",t),t.connect(),this.checkOnFlappingRelays()},e),t.disconnect(),this.emit("flapping",t)}size(){return this.relays.size}stats(){const t={total:0,connected:0,disconnected:0,connecting:0};for(const e of this.relays.values())t.total++,e.status===5?t.connected++:e.status===1?t.disconnected++:e.status===4&&t.connecting++;return t}connectedRelays(){return Array.from(this.relays.values()).filter(t=>t.status>=5)}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter(t=>t.status>=5&&!this.temporaryRelayTimers.has(t.url))}urls(){return Array.from(this.relays.keys())}},NDKDVMJobFeedback=class Df extends NDKEvent{static kinds=[7e3];constructor(e,r){super(e,r),this.kind??=7e3}static async from(e){const r=new Df(e.ndk,e.rawEvent());return r.encrypted&&await r.dvmDecrypt(),r}get status(){return this.tagValue("status")}set status(e){this.removeTag("status"),e!==void 0&&this.tags.push(["status",e])}get encrypted(){return!!this.getMatchingTags("encrypted")[0]}async dvmDecrypt(){await this.decrypt();const e=JSON.parse(this.content);this.tags.push(...e)}},NDKCashuMintList=class Ff extends NDKEvent{static kind=10019;static kinds=[10019];_p2pk;constructor(e,r){super(e,r),this.kind??=10019}static from(e){return new Ff(e.ndk,e)}set relays(e){this.tags=this.tags.filter(r=>r[0]!=="relay");for(const r of e)this.tags.push(["relay",r])}get relays(){const e=[];for(const r of this.tags)r[0]==="relay"&&e.push(r[1]);return e}set mints(e){this.tags=this.tags.filter(r=>r[0]!=="mint");for(const r of e)this.tags.push(["mint",r])}get mints(){const e=[];for(const r of this.tags)r[0]==="mint"&&e.push(r[1]);return Array.from(new Set(e))}get p2pk(){return this._p2pk?this._p2pk:(this._p2pk=this.tagValue("pubkey")??this.pubkey,this._p2pk)}set p2pk(e){this._p2pk=e,this.removeTag("pubkey"),e&&this.tags.push(["pubkey",e])}get relaySet(){return NDKRelaySet.fromRelayUrls(this.relays,this.ndk)}},NDKArticle=class Tf extends NDKEvent{static kind=30023;static kinds=[30023];constructor(e,r){super(e,r),this.kind??=30023}static from(e){return new Tf(e.ndk,e)}get title(){return this.tagValue("title")}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get image(){return this.tagValue("image")}set image(e){this.removeTag("image"),e&&this.tags.push(["image",e])}get summary(){return this.tagValue("summary")}set summary(e){this.removeTag("summary"),e&&this.tags.push(["summary",e])}get published_at(){const e=this.tagValue("published_at");if(e){let r=Number.parseInt(e);return r>1e12&&(r=Math.floor(r/1e3)),r}}set published_at(e){this.removeTag("published_at"),e!==void 0&&this.tags.push(["published_at",e.toString()])}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}get url(){return this.tagValue("url")}set url(e){e?this.tags.push(["url",e]):this.removeTag("url")}},NDKBlossomList=class $f extends NDKEvent{static kinds=[10063];constructor(e,r){super(e,r),this.kind??=10063}static from(e){return new $f(e.ndk,e.rawEvent())}get servers(){return this.tags.filter(e=>e[0]==="server").map(e=>e[1])}set servers(e){this.tags=this.tags.filter(r=>r[0]!=="server");for(const r of e)this.tags.push(["server",r])}get default(){const e=this.servers;return e.length>0?e[0]:void 0}set default(e){if(!e)return;const n=this.servers.filter(s=>s!==e);this.servers=[e,...n]}addServer(e){if(!e)return;const r=this.servers;r.includes(e)||(this.servers=[...r,e])}removeServer(e){if(!e)return;const r=this.servers;this.servers=r.filter(n=>n!==e)}},NDKFedimintMint=class If extends NDKEvent{static kind=38173;static kinds=[38173];constructor(e,r){super(e,r),this.kind??=38173}static async from(e){return new If(e.ndk,e)}get identifier(){return this.tagValue("d")}set identifier(e){this.removeTag("d"),e&&this.tags.push(["d",e])}get inviteCodes(){return this.getMatchingTags("u").map(e=>e[1])}set inviteCodes(e){this.removeTag("u");for(const r of e)this.tags.push(["u",r])}get modules(){return this.getMatchingTags("modules").map(e=>e[1])}set modules(e){this.removeTag("modules");for(const r of e)this.tags.push(["modules",r])}get network(){return this.tagValue("n")}set network(e){this.removeTag("n"),e&&this.tags.push(["n",e])}get metadata(){if(this.content)try{return JSON.parse(this.content)}catch{return}}set metadata(e){e?this.content=JSON.stringify(e):this.content=""}},NDKCashuMintAnnouncement=class Pf extends NDKEvent{static kind=38172;static kinds=[38172];constructor(e,r){super(e,r),this.kind??=38172}static async from(e){return new Pf(e.ndk,e)}get identifier(){return this.tagValue("d")}set identifier(e){this.removeTag("d"),e&&this.tags.push(["d",e])}get url(){return this.tagValue("u")}set url(e){this.removeTag("u"),e&&this.tags.push(["u",e])}get nuts(){return this.getMatchingTags("nuts").map(e=>e[1])}set nuts(e){this.removeTag("nuts");for(const r of e)this.tags.push(["nuts",r])}get network(){return this.tagValue("n")}set network(e){this.removeTag("n"),e&&this.tags.push(["n",e])}get metadata(){if(this.content)try{return JSON.parse(this.content)}catch{return}}set metadata(e){e?this.content=JSON.stringify(e):this.content=""}},NDKMintRecommendation=class Mf extends NDKEvent{static kind=38e3;static kinds=[38e3];constructor(e,r){super(e,r),this.kind??=38e3}static async from(e){return new Mf(e.ndk,e)}get recommendedKind(){const e=this.tagValue("k");return e?Number(e):void 0}set recommendedKind(e){this.removeTag("k"),e&&this.tags.push(["k",e.toString()])}get identifier(){return this.tagValue("d")}set identifier(e){this.removeTag("d"),e&&this.tags.push(["d",e])}get urls(){return this.getMatchingTags("u").map(e=>e[1])}set urls(e){this.removeTag("u");for(const r of e)this.tags.push(["u",r])}get mintEventPointers(){return this.getMatchingTags("a").map(e=>({kind:Number(e[1].split(":")[0]),identifier:e[1].split(":")[2],relay:e[2]}))}addMintEventPointer(e,r,n,s){const o=["a",`${e}:${r}:${n}`];s&&o.push(s),this.tags.push(o)}get review(){return this.content}set review(e){this.content=e}},NDKClassified=class Uf extends NDKEvent{static kinds=[30402];constructor(e,r){super(e,r),this.kind??=30402}static from(e){return new Uf(e.ndk,e)}get title(){return this.tagValue("title")}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get summary(){return this.tagValue("summary")}set summary(e){this.removeTag("summary"),e&&this.tags.push(["summary",e])}get published_at(){const e=this.tagValue("published_at");if(e)return Number.parseInt(e)}set published_at(e){this.removeTag("published_at"),e!==void 0&&this.tags.push(["published_at",e.toString()])}get location(){return this.tagValue("location")}set location(e){this.removeTag("location"),e&&this.tags.push(["location",e])}get price(){const e=this.tags.find(r=>r[0]==="price");if(e)return{amount:Number.parseFloat(e[1]),currency:e[2],frequency:e[3]}}set price(e){if(typeof e=="string"&&(e={amount:Number.parseFloat(e)}),e?.amount){const r=["price",e.amount.toString()];e.currency&&r.push(e.currency),e.frequency&&r.push(e.frequency),this.tags.push(r)}else this.removeTag("price")}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}},NDKDraft=class Of extends NDKEvent{_event;static kind=31234;static kinds=[31234,1234];counterparty;constructor(e,r){super(e,r),this.kind??=31234}static from(e){return new Of(e.ndk,e)}set identifier(e){this.removeTag("d"),this.tags.push(["d",e])}get identifier(){return this.dTag}set event(e){e instanceof NDKEvent?this._event=e:this._event=new NDKEvent(void 0,e),this.prepareEvent()}set checkpoint(e){e?(this.tags.push(e.tagReference()),this.kind=1234):(this.removeTag("a"),this.kind=31234)}get isCheckpoint(){return this.kind===1234}get isProposal(){const e=this.tagValue("p");return!!e&&e!==this.pubkey}async getEvent(e){if(this._event)return this._event;if(e??=this.ndk?.signer,!e)throw new Error("No signer available");if(this.content&&this.content.length>0)try{const r=e.pubkey,s=[this.tagValue("p"),this.pubkey].filter(Boolean).find(u=>u!==r);let o;o=new NDKUser({pubkey:s??r}),await this.decrypt(o,e);const c=JSON.parse(this.content);return this._event=await wrapEvent(new NDKEvent(this.ndk,c)),this._event}catch(r){console.error(r);return}else return null}prepareEvent(){if(!this._event)throw new Error("No event has been provided");this.removeTag("k"),this._event.kind&&this.tags.push(["k",this._event.kind.toString()]),this.content=JSON.stringify(this._event.rawEvent())}async save({signer:e,publish:r,relaySet:n}){if(e??=this.ndk?.signer,!e)throw new Error("No signer available");const s=this.counterparty||await e.user();if(await this.encrypt(s,e),this.counterparty){const o=this.counterparty.pubkey;this.removeTag("p"),this.tags.push(["p",o])}if(r!==!1)return this.publishReplaceable(n)}};function mapImetaTag(t){const e={};if(t.length===2){const n=t[1].split(" ");for(let s=0;s<n.length;s+=2){const o=n[s],c=n[s+1];o==="fallback"?(e.fallback||(e.fallback=[]),e.fallback.push(c)):e[o]=c}return e}const r=t.slice(1);for(const n of r){const s=n.split(" "),o=s[0],c=s.slice(1).join(" ");o==="fallback"?(e.fallback||(e.fallback=[]),e.fallback.push(c)):e[o]=c}return e}function imetaTagToTag(t){const e=["imeta"];for(const[r,n]of Object.entries(t))if(Array.isArray(n))for(const s of n)e.push(`${r} ${s}`);else n&&e.push(`${r} ${n}`);return e}var NDKFollowPack=class Lf extends NDKEvent{static kind=39089;static kinds=[39089,39092];constructor(e,r){super(e,r),this.kind??=39089}static from(e){return new Lf(e.ndk,e)}get title(){return this.tagValue("title")}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get image(){const e=this.tags.find(r=>r[0]==="imeta");if(e){const r=mapImetaTag(e);if(r.url)return r.url}return this.tagValue("image")}set image(e){this.tags=this.tags.filter(r=>r[0]!=="imeta"&&r[0]!=="image"),typeof e=="string"?e!==void 0&&this.tags.push(["image",e]):e&&typeof e=="object"&&(this.tags.push(imetaTagToTag(e)),e.url&&this.tags.push(["image",e.url]))}get pubkeys(){return Array.from(new Set(this.tags.filter(e=>e[0]==="p"&&e[1]&&isValidPubkey(e[1])).map(e=>e[1])))}set pubkeys(e){this.tags=this.tags.filter(r=>r[0]!=="p");for(const r of e)this.tags.push(["p",r])}get description(){return this.tagValue("description")}set description(e){this.removeTag("description"),e&&this.tags.push(["description",e])}},NDKHighlight=class Hf extends NDKEvent{_article;static kind=9802;static kinds=[9802];constructor(e,r){super(e,r),this.kind??=9802}static from(e){return new Hf(e.ndk,e)}get url(){return this.tagValue("r")}set context(e){e===void 0?this.tags=this.tags.filter(([r,n])=>r!=="context"):(this.tags=this.tags.filter(([r,n])=>r!=="context"),this.tags.push(["context",e]))}get context(){return this.tags.find(([e,r])=>e==="context")?.[1]??void 0}get article(){return this._article}set article(e){this._article=e,typeof e=="string"?this.tags.push(["r",e]):this.tag(e)}getArticleTag(){return this.getMatchingTags("a")[0]||this.getMatchingTags("e")[0]||this.getMatchingTags("r")[0]}async getArticle(){if(this._article!==void 0)return this._article;let e;const r=this.getArticleTag();if(r){switch(r[0]){case"a":{const[n,s,o]=r[1].split(":");e=nip19_exports$1.naddrEncode({kind:Number.parseInt(n),pubkey:s,identifier:o});break}case"e":e=nip19_exports$1.noteEncode(r[1]);break;case"r":this._article=r[1];break}if(e){let n=await this.ndk?.fetchEvent(e);n&&(n.kind===30023&&(n=NDKArticle.from(n)),this._article=n)}return this._article}}},NDKImage=class qf extends NDKEvent{static kind=20;static kinds=[20];_imetas;constructor(e,r){super(e,r),this.kind??=20}static from(e){return new qf(e.ndk,e.rawEvent())}get isValid(){return this.imetas.length>0}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(e=>e[0]==="imeta").map(mapImetaTag).filter(e=>!!e.url),this._imetas)}set imetas(e){this._imetas=e,this.tags=this.tags.filter(r=>r[0]!=="imeta"),this.tags.push(...e.map(imetaTagToTag))}},NDKList=class Kf extends NDKEvent{_encryptedTags;static kinds=[30001,10004,10050,10030,10015,10001,10002,10007,10006,10003];encryptedTagsLength;constructor(e,r){super(e,r),this.kind??=30001}static from(e){return new Kf(e.ndk,e)}get title(){const e=this.tagValue("title")||this.tagValue("name");return e||(this.kind===3?"Contacts":this.kind===1e4?"Mute":this.kind===10001?"Pinned Notes":this.kind===10002?"Relay Metadata":this.kind===10003?"Bookmarks":this.kind===10004?"Communities":this.kind===10005?"Public Chats":this.kind===10006?"Blocked Relays":this.kind===10007?"Search Relays":this.kind===10050?"Direct Message Receive Relays":this.kind===10015?"Interests":this.kind===10030?"Emojis":this.tagValue("d"))}set title(e){this.removeTag(["title","name"]),e&&this.tags.push(["title",e])}get name(){return this.title}set name(e){this.title=e}get description(){return this.tagValue("description")}set description(e){this.removeTag("description"),e&&this.tags.push(["description",e])}get image(){return this.tagValue("image")}set image(e){this.removeTag("image"),e&&this.tags.push(["image",e])}isEncryptedTagsCacheValid(){return!!(this._encryptedTags&&this.encryptedTagsLength===this.content.length)}async encryptedTags(e=!0){if(e&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const r=await this.ndk.signer.user();try{if(this.content.length>0)try{const n=await this.ndk.signer.decrypt(r,this.content),s=JSON.parse(n);return s?.[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=s):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch{}}catch{}return[]}validateTag(e){return!0}getItems(e){return this.tags.filter(r=>r[0]===e)}get items(){return this.tags.filter(e=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(e[0]))}async addItem(e,r=void 0,n=!1,s="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let o;if(e instanceof NDKEvent)o=[e.tagReference(r)];else if(e instanceof NDKUser)o=e.referenceTags();else if(e instanceof NDKRelay)o=e.referenceTags();else if(Array.isArray(e))o=[e];else throw new Error("Invalid object type");if(r&&o[0].push(r),n){const c=await this.ndk.signer.user(),u=await this.encryptedTags();s==="top"?u.unshift(...o):u.push(...o),this._encryptedTags=u,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(u),await this.encrypt(c)}else s==="top"?this.tags.unshift(...o):this.tags.push(...o);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(e,r=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const n=this.tags.findIndex(u=>u[1]===e);n>=0&&this.tags.splice(n,1);const s=await this.ndk.signer.user(),o=await this.encryptedTags(),c=o.findIndex(u=>u[1]===e);if(c>=0&&(o.splice(c,1),this._encryptedTags=o,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(o),await this.encrypt(s)),r)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(e,r){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(r){const n=await this.ndk.signer.user(),s=await this.encryptedTags();s.splice(e,1),this._encryptedTags=s,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(s),await this.encrypt(n)}else this.tags.splice(e,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(e){return this.items.some(r=>r[1]===e)}filterForItems(){const e=new Set,r=new Map,n=[];for(const s of this.items)if(s[0]==="e"&&s[1])e.add(s[1]);else if(s[0]==="a"&&s[1]){const[o,c,u]=s[1].split(":");if(!o||!c)continue;const f=`${o}:${c}`,x=r.get(f)||[];x.push(u||""),r.set(f,x)}if(e.size>0&&n.push({ids:Array.from(e)}),r.size>0)for(const[s,o]of r.entries()){const[c,u]=s.split(":");n.push({kinds:[Number.parseInt(c)],authors:[u],"#d":o})}return n}},NDKAppHandlerEvent=class zf extends NDKEvent{profile;static kinds=[31990];constructor(e,r){super(e,r),this.kind??=31990}static from(e){const r=new zf(e.ndk,e.rawEvent());return r.isValid?r:null}get isValid(){const e=new Map,r=s=>[s[0],s[2]].join(":").toLowerCase(),n=["web","android","ios"];for(const s of this.tags)if(n.includes(s[0])){const o=r(s);if(e.has(o)&&e.get(o)!==s[1].toLowerCase())return!1;e.set(o,s[1].toLowerCase())}return!0}async fetchProfile(){if(this.profile===void 0&&this.content.length>0)try{const e=JSON.parse(this.content);if(e?.name)return e;this.profile=null}catch{this.profile=null}return new Promise((e,r)=>{const n=this.author;n.fetchProfile().then(()=>{e(n.profile)}).catch(r)})}},NDKNutzap=class H0 extends NDKEvent{debug;_proofs=[];static kind=9321;static kinds=[H0.kind];constructor(e,r){super(e,r),this.kind??=9321,this.debug=e?.debug.extend("nutzap")??createDebug5("ndk:nutzap"),this.alt||(this.alt="This is a nutzap");try{const n=this.getMatchingTags("proof");n.length?this._proofs=n.map(s=>JSON.parse(s[1])):this._proofs=JSON.parse(this.content)}catch{return}}static from(e){const r=new H0(e.ndk,e);if(!(!r._proofs||!r._proofs.length))return r}set comment(e){this.content=e??""}get comment(){const e=this.tagValue("comment");return e||this.content}set proofs(e){this._proofs=e,this.tags=this.tags.filter(r=>r[0]!=="proof");for(const r of e)this.tags.push(["proof",JSON.stringify(r)])}get proofs(){return this._proofs}get rawP2pk(){const e=this.proofs[0];try{const r=JSON.parse(e.secret);let n;if(typeof r=="string"?(n=JSON.parse(r),this.debug("stringified payload",e.secret)):typeof r=="object"&&(n=r),Array.isArray(n)&&n[0]==="P2PK"&&n.length>1&&typeof n[1]=="object"&&n[1]!==null||typeof n=="object"&&n!==null&&typeof n[1]?.data=="string")return n[1].data}catch(r){this.debug("error parsing p2pk pubkey",r,this.proofs[0])}}get p2pk(){const e=this.rawP2pk;if(e)return e.startsWith("02")?e.slice(2):e}get mint(){return this.tagValue("u")}set mint(e){this.replaceTag(["u",e])}get unit(){let e=this.tagValue("unit")??"sat";return e?.startsWith("msat")&&(e="sat"),e}set unit(e){if(this.removeTag("unit"),e?.startsWith("msat"))throw new Error("msat is not allowed, use sat denomination instead");e&&this.tag(["unit",e])}get amount(){return this.proofs.reduce((r,n)=>r+n.amount,0)}sender=this.author;set target(e){this.tags=this.tags.filter(r=>r[0]!=="p"),e instanceof NDKEvent&&this.tags.push(e.tagReference())}set recipientPubkey(e){this.removeTag("p"),this.tag(["p",e])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const e=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:e}):new NDKUser({pubkey:e})}async toNostrEvent(){this.unit==="msat"&&(this.unit="sat"),this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()]);const e=await super.toNostrEvent();return e.content=this.comment,e}get isValid(){let e=0,r=0,n=0;for(const s of this.tags)s[0]==="e"&&e++,s[0]==="p"&&r++,s[0]==="u"&&n++;return r===1&&n===1&&e<=1&&this.proofs.length>0}},NDKProject=class Vf extends NDKEvent{static kind=31933;static kinds=[31933];_signer;constructor(e,r){super(e,r),this.kind=31933}static from(e){return new Vf(e.ndk,e.rawEvent())}set repo(e){this.removeTag("repo"),e&&this.tags.push(["repo",e])}set hashtags(e){this.removeTag("hashtags"),e.filter(r=>r.length>0).length&&this.tags.push(["hashtags",...e])}get hashtags(){const e=this.tags.find(r=>r[0]==="hashtags");return e?e.slice(1):[]}get repo(){return this.tagValue("repo")}get title(){return this.tagValue("title")}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get picture(){return this.tagValue("picture")}set picture(e){this.removeTag("picture"),e&&this.tags.push(["picture",e])}set description(e){this.content=e}get description(){return this.content}get slug(){return this.dTag??"empty-dtag"}async getSigner(){if(this._signer)return this._signer;const e=this.tagValue("key");if(!e)this._signer=NDKPrivateKeySigner.generate(),await this.encryptAndSaveNsec();else{const r=await this.ndk?.signer?.decrypt(this.ndk.activeUser,e);if(!r)throw new Error("Failed to decrypt project key or missing signer context.");this._signer=new NDKPrivateKeySigner(r)}return this._signer}async getNsec(){return(await this.getSigner()).privateKey}async setNsec(e){this._signer=new NDKPrivateKeySigner(e),await this.encryptAndSaveNsec()}async encryptAndSaveNsec(){if(!this._signer)throw new Error("Signer is not set.");const e=this._signer.privateKey,r=await this.ndk?.signer?.encrypt(this.ndk.activeUser,e);r&&(this.removeTag("key"),this.tags.push(["key",r]))}},NDKProjectTemplate=class Gf extends NDKEvent{static kind=30717;static kinds=[30717];constructor(e,r){super(e,r),this.kind=30717}static from(e){return new Gf(e.ndk,e.rawEvent())}get templateId(){return this.dTag??""}set templateId(e){this.dTag=e}get name(){return this.tagValue("title")??""}set name(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get description(){return this.tagValue("description")??""}set description(e){this.removeTag("description"),e&&this.tags.push(["description",e])}get repoUrl(){return this.tagValue("uri")??""}set repoUrl(e){this.removeTag("uri"),e&&this.tags.push(["uri",e])}get image(){return this.tagValue("image")}set image(e){this.removeTag("image"),e&&this.tags.push(["image",e])}get command(){return this.tagValue("command")}set command(e){this.removeTag("command"),e&&this.tags.push(["command",e])}get agentConfig(){const e=this.tagValue("agent");if(e)try{return JSON.parse(e)}catch{return}}set agentConfig(e){this.removeTag("agent"),e&&this.tags.push(["agent",JSON.stringify(e)])}get templateTags(){return this.getMatchingTags("t").map(e=>e[1]).filter(Boolean)}set templateTags(e){this.tags=this.tags.filter(r=>r[0]!=="t"),e.forEach(r=>{r&&this.tags.push(["t",r])})}},READ_MARKER="read",WRITE_MARKER="write",NDKRelayList=class Wf extends NDKEvent{static kinds=[10002];constructor(e,r){super(e,r),this.kind??=10002}static from(e){return new Wf(e.ndk,e.rawEvent())}get readRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]||e[2]&&e[2]===READ_MARKER).map(e=>tryNormalizeRelayUrl(e[1])).filter(e=>!!e)}set readRelayUrls(e){for(const r of e)this.tags.push(["r",r,READ_MARKER])}get writeRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]||e[2]&&e[2]===WRITE_MARKER).map(e=>tryNormalizeRelayUrl(e[1])).filter(e=>!!e)}set writeRelayUrls(e){for(const r of e)this.tags.push(["r",r,WRITE_MARKER])}get bothRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]).map(e=>e[1])}set bothRelayUrls(e){for(const r of e)this.tags.push(["r",r])}get relays(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").map(e=>e[1])}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new NDKRelaySet(new Set(this.relays.map(e=>this.ndk?.pool.getRelay(e)).filter(e=>!!e)),this.ndk)}};function relayListFromKind3(t,e){try{const r=JSON.parse(e.content),n=new NDKRelayList(t),s=new Set,o=new Set;for(let[c,u]of Object.entries(r)){try{c=normalizeRelayUrl(c)}catch{continue}if(!u)s.add(c),o.add(c);else{const f=u;f.write&&o.add(c),f.read&&s.add(c)}}return n.readRelayUrls=Array.from(s),n.writeRelayUrls=Array.from(o),n}catch{}}var NDKRepost=class Yf extends NDKEvent{_repostedEvents;static kinds=[6,16];static from(e){return new Yf(e.ndk,e.rawEvent())}async repostedEvents(e,r){const n=[];if(!this.ndk)throw new Error("NDK instance not set");if(this._repostedEvents!==void 0)return this._repostedEvents;for(const s of this.repostedEventIds()){const o=filterForId(s),c=await this.ndk.fetchEvent(o,r);c&&n.push(e?e.from(c):c)}return n}repostedEventIds(){return this.tags.filter(e=>e[0]==="e"||e[0]==="a").map(e=>e[1])}};function filterForId(t){if(t.match(/:/)){const[e,r,n]=t.split(":");return{kinds:[Number.parseInt(e)],authors:[r],"#d":[n]}}return{ids:[t]}}var NDKSimpleGroupMemberList=class Xf extends NDKEvent{relaySet;memberSet=new Set;static kind=39002;static kinds=[39002];constructor(e,r){super(e,r),this.kind??=39002,this.memberSet=new Set(this.members)}static from(e){return new Xf(e.ndk,e)}get members(){return this.getMatchingTags("p").map(e=>e[1])}hasMember(e){return this.memberSet.has(e)}async publish(e,r,n){return e??=this.relaySet,super.publishReplaceable(e,r,n)}},NDKSimpleGroupMetadata=class Zf extends NDKEvent{static kind=39e3;static kinds=[39e3];constructor(e,r){super(e,r),this.kind??=39e3}static from(e){return new Zf(e.ndk,e)}get name(){return this.tagValue("name")}get picture(){return this.tagValue("picture")}get about(){return this.tagValue("about")}get scope(){if(this.getMatchingTags("public").length>0)return"public";if(this.getMatchingTags("public").length>0)return"private"}set scope(e){this.removeTag("public"),this.removeTag("private"),e==="public"?this.tags.push(["public",""]):e==="private"&&this.tags.push(["private",""])}get access(){if(this.getMatchingTags("open").length>0)return"open";if(this.getMatchingTags("closed").length>0)return"closed"}set access(e){this.removeTag("open"),this.removeTag("closed"),e==="open"?this.tags.push(["open",""]):e==="closed"&&this.tags.push(["closed",""])}};function strToPosition(t){const[e,r]=t.split(",").map(Number);return{x:e,y:r}}function strToDimension(t){const[e,r]=t.split("x").map(Number);return{width:e,height:r}}var NDKStorySticker=class Qf{static Text="text";static Pubkey="pubkey";static Event="event";static Prompt="prompt";static Countdown="countdown";type;value;position;dimension;properties;constructor(e){if(Array.isArray(e)){const r=e;if(r[0]!=="sticker"||r.length<5)throw new Error("Invalid sticker tag");this.type=r[1],this.value=r[2],this.position=strToPosition(r[3]),this.dimension=strToDimension(r[4]);const n={};for(let s=5;s<r.length;s++){const[o,...c]=r[s].split(" ");n[o]=c.join(" ")}Object.keys(n).length>0&&(this.properties=n)}else this.type=e,this.value=void 0,this.position={x:0,y:0},this.dimension={width:0,height:0}}static fromTag(e){try{return new Qf(e)}catch{return null}}get style(){return this.properties?.style}set style(e){e?this.properties={...this.properties,style:e}:delete this.properties?.style}get rotation(){return this.properties?.rot?Number.parseFloat(this.properties.rot):void 0}set rotation(e){e!==void 0?this.properties={...this.properties,rot:e.toString()}:delete this.properties?.rot}get isValid(){return this.hasValidDimensions()&&this.hasValidPosition()}hasValidDimensions=()=>typeof this.dimension.width=="number"&&typeof this.dimension.height=="number"&&!Number.isNaN(this.dimension.width)&&!Number.isNaN(this.dimension.height);hasValidPosition=()=>typeof this.position.x=="number"&&typeof this.position.y=="number"&&!Number.isNaN(this.position.x)&&!Number.isNaN(this.position.y);toTag(){if(!this.isValid){const n=[this.hasValidDimensions()?void 0:"dimensions is invalid",this.hasValidPosition()?void 0:"position is invalid"].filter(Boolean);throw new Error(`Invalid sticker: ${n.join(", ")}`)}let e;switch(this.type){case"event":e=this.value.tagId();break;case"pubkey":e=this.value.pubkey;break;default:e=this.value}const r=["sticker",this.type,e,coordinates(this.position),dimension(this.dimension)];if(this.properties)for(const[n,s]of Object.entries(this.properties))r.push(`${n} ${s}`);return r}},NDKStory=class Jf extends NDKEvent{static kind=23;static kinds=[23];_imeta;_dimensions;constructor(e,r){if(super(e,r),this.kind??=23,r)for(const n of r.tags)switch(n[0]){case"imeta":this._imeta=mapImetaTag(n);break;case"dim":this.dimensions=strToDimension(n[1]);break}}static from(e){return new Jf(e.ndk,e)}get isValid(){return!!this.imeta}get imeta(){return this._imeta}set imeta(e){this._imeta=e,this.tags=this.tags.filter(r=>r[0]!=="imeta"),e&&this.tags.push(imetaTagToTag(e))}get dimensions(){const e=this.tagValue("dim");if(e)return strToDimension(e)}set dimensions(e){this.removeTag("dim"),e&&this.tags.push(["dim",`${e.width}x${e.height}`])}get duration(){const e=this.tagValue("dur");if(e)return Number.parseInt(e)}set duration(e){this.removeTag("dur"),e!==void 0&&this.tags.push(["dur",e.toString()])}get stickers(){const e=[];for(const r of this.tags){if(r[0]!=="sticker"||r.length<5)continue;const n=NDKStorySticker.fromTag(r);n&&e.push(n)}return e}addSticker(e){let r;if(e instanceof NDKStorySticker)r=e;else{const n=["sticker",e.type,typeof e.value=="string"?e.value:"",coordinates(e.position),dimension(e.dimension)];if(e.properties)for(const[s,o]of Object.entries(e.properties))n.push(`${s} ${o}`);r=new NDKStorySticker(n),r.value=e.value}r.type==="pubkey"?this.tag(r.value):r.type==="event"&&this.tag(r.value),this.tags.push(r.toTag())}removeSticker(e){const r=this.stickers;if(e<0||e>=r.length)return;let n=0;for(let s=0;s<this.tags.length;s++)if(this.tags[s][0]==="sticker"){if(n===e){this.tags.splice(s,1);break}n++}}},coordinates=t=>`${t.x},${t.y}`,dimension=t=>`${t.width}x${t.height}`,NDKSubscriptionReceipt=class eh extends NDKEvent{debug;static kinds=[7003];constructor(e,r){super(e,r),this.kind??=7003,this.debug=e?.debug.extend("subscription-start")??createDebug5("ndk:subscription-start")}static from(e){return new eh(e.ndk,e.rawEvent())}get recipient(){const e=this.getMatchingTags("p")?.[0];return e?new NDKUser({pubkey:e[1]}):void 0}set recipient(e){this.removeTag("p"),e&&this.tags.push(["p",e.pubkey])}get subscriber(){const e=this.getMatchingTags("P")?.[0];return e?new NDKUser({pubkey:e[1]}):void 0}set subscriber(e){this.removeTag("P"),e&&this.tags.push(["P",e.pubkey])}set subscriptionStart(e){this.debug(`before setting subscription start: ${this.rawEvent}`),this.removeTag("e"),this.tag(e,"subscription",!0),this.debug(`after setting subscription start: ${this.rawEvent}`)}get tierName(){return this.getMatchingTags("tier")?.[0]?.[1]}get isValid(){const e=this.validPeriod;if(!e||e.start>e.end)return!1;const r=this.getMatchingTags("p"),n=this.getMatchingTags("P");return!(r.length!==1||n.length!==1)}get validPeriod(){const e=this.getMatchingTags("valid")?.[0];if(e)try{return{start:new Date(Number.parseInt(e[1])*1e3),end:new Date(Number.parseInt(e[2])*1e3)}}catch{return}}set validPeriod(e){this.removeTag("valid"),e&&this.tags.push(["valid",Math.floor(e.start.getTime()/1e3).toString(),Math.floor(e.end.getTime()/1e3).toString()])}get startPeriod(){return this.validPeriod?.start}get endPeriod(){return this.validPeriod?.end}isActive(e){e??=new Date;const r=this.validPeriod;return!(!r||e<r.start||e>r.end)}},possibleIntervalFrequencies=["daily","weekly","monthly","quarterly","yearly"];function newAmount(t,e,r){return["amount",t.toString(),e,r]}function parseTagToSubscriptionAmount(t){const e=Number.parseInt(t[1]);if(Number.isNaN(e)||e===void 0||e===null||e<=0)return;const r=t[2];if(r===void 0||r==="")return;const n=t[3];if(n!==void 0&&possibleIntervalFrequencies.includes(n))return{amount:e,currency:r,term:n}}var NDKSubscriptionTier=class th extends NDKArticle{static kind=37001;static kinds=[37001];constructor(e,r){const n=r?.kind??37001;super(e,r),this.kind=n}static from(e){return new th(e.ndk,e)}get perks(){return this.getMatchingTags("perk").map(e=>e[1]).filter(e=>e!==void 0)}addPerk(e){this.tags.push(["perk",e])}get amounts(){return this.getMatchingTags("amount").map(e=>parseTagToSubscriptionAmount(e)).filter(e=>e!==void 0)}addAmount(e,r,n){this.tags.push(newAmount(e,r,n))}set relayUrl(e){this.tags.push(["r",e])}get relayUrls(){return this.getMatchingTags("r").map(e=>e[1]).filter(e=>e!==void 0)}get verifierPubkey(){return this.tagValue("p")}set verifierPubkey(e){this.removeTag("p"),e&&this.tags.push(["p",e])}get isValid(){return this.title!==void 0&&this.amounts.length>0}},NDKSubscriptionStart=class rh extends NDKEvent{debug;static kinds=[7001];constructor(e,r){super(e,r),this.kind??=7001,this.debug=e?.debug.extend("subscription-start")??createDebug5("ndk:subscription-start")}static from(e){return new rh(e.ndk,e.rawEvent())}get recipient(){const e=this.getMatchingTags("p")?.[0];return e?new NDKUser({pubkey:e[1]}):void 0}set recipient(e){this.removeTag("p"),e&&this.tags.push(["p",e.pubkey])}get amount(){const e=this.getMatchingTags("amount")?.[0];if(e)return parseTagToSubscriptionAmount(e)}set amount(e){this.removeTag("amount"),e&&this.tags.push(newAmount(e.amount,e.currency,e.term))}get tierId(){const e=this.getMatchingTags("e")?.[0],r=this.getMatchingTags("a")?.[0];if(!(!e||!r))return e[1]??r[1]}set tier(e){this.removeTag("e"),this.removeTag("a"),this.removeTag("event"),e&&(this.tag(e),this.removeTag("p"),this.tags.push(["p",e.pubkey]),this.tags.push(["event",JSON.stringify(e.rawEvent())]))}async fetchTier(){const e=this.tagValue("event");if(e)try{const s=JSON.parse(e);return new NDKSubscriptionTier(this.ndk,s)}catch{this.debug("Failed to parse event tag")}const r=this.tierId;if(!r)return;const n=await this.ndk?.fetchEvent(r);if(n)return NDKSubscriptionTier.from(n)}get isValid(){return this.getMatchingTags("amount").length!==1?(this.debug("Invalid # of amount tag"),!1):this.amount?this.getMatchingTags("p").length!==1?(this.debug("Invalid # of p tag"),!1):this.recipient?!0:(this.debug("Invalid p tag"),!1):(this.debug("Invalid amount tag"),!1)}},NDKTask=class nh extends NDKEvent{static kind=1934;static kinds=[1934];constructor(e,r){super(e,r),this.kind=1934}static from(e){return new nh(e.ndk,e.rawEvent())}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get title(){return this.tagValue("title")}set project(e){this.removeTag("a"),this.tags.push(e.tagReference())}get projectSlug(){const e=this.getMatchingTags("a")[0];return e?e[1].split(/:/)?.[2]:void 0}},NDKThread=class sh extends NDKEvent{static kind=11;static kinds=[11];constructor(e,r){super(e,r),this.kind??=11}static from(e){return new sh(e.ndk,e)}get title(){return this.tagValue("title")}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}},NDKVideo=class ih extends NDKEvent{static kind=21;static kinds=[34235,34236,22,21];_imetas;static from(e){return new ih(e.ndk,e.rawEvent())}get title(){return this.tagValue("title")}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get thumbnail(){let e;return this.imetas&&this.imetas.length>0&&(e=this.imetas[0].image?.[0]),e??this.tagValue("thumb")}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(e=>e[0]==="imeta").map(mapImetaTag),this._imetas)}set imetas(e){this._imetas=e,this.tags=this.tags.filter(r=>r[0]!=="imeta"),this.tags.push(...e.map(imetaTagToTag))}get url(){return this.imetas&&this.imetas.length>0?this.imetas[0].url:this.tagValue("url")}get published_at(){const e=this.tagValue("published_at");if(e)return Number.parseInt(e)}async generateTags(){if(super.generateTags(),!this.kind&&this.imetas?.[0]?.dim){const[e,r]=this.imetas[0].dim.split("x"),n=e&&r&&Number.parseInt(e)<Number.parseInt(r);this.duration&&this.duration<120&&n?this.kind=22:this.kind=21}return super.generateTags()}get duration(){const e=this.tagValue("duration");if(e)return Number.parseInt(e)}set duration(e){this.removeTag("duration"),e!==void 0&&this.tags.push(["duration",Math.floor(e).toString()])}},NDKWiki=class oh extends NDKArticle{static kind=30818;static kinds=[30818];static from(e){return new oh(e.ndk,e.rawEvent())}get isDefered(){return this.hasTag("a","defer")}get deferedId(){return this.tagValue("a","defer")}set defer(e){this.removeTag("a","defer"),this.tag(e,"defer")}},NDKWikiMergeRequest=class ah extends NDKEvent{static kinds=[818];static from(e){return new ah(e.ndk,e.rawEvent())}get targetId(){return this.tagValue("a")}set target(e){this.tags=this.tags.filter(r=>{if(r[0]==="a"||r[0]==="e"&&r[3]!=="source")return!0}),this.tag(e)}get sourceId(){return this.tagValue("e","source")}set source(e){this.removeTag("e","source"),this.tag(e,"source",!1,"e")}},registeredEventClasses=new Set;function wrapEvent(t){const e=new Map,n=[...[NDKImage,NDKVideo,NDKCashuMintList,NDKArticle,NDKHighlight,NDKDraft,NDKWiki,NDKWikiMergeRequest,NDKNutzap,NDKProject,NDKTask,NDKProjectTemplate,NDKSimpleGroupMemberList,NDKSimpleGroupMetadata,NDKSubscriptionTier,NDKSubscriptionStart,NDKSubscriptionReceipt,NDKList,NDKRelayList,NDKStory,NDKBlossomList,NDKFollowPack,NDKThread,NDKRepost,NDKClassified,NDKAppHandlerEvent,NDKDVMJobFeedback,NDKCashuMintAnnouncement,NDKFedimintMint,NDKMintRecommendation],...registeredEventClasses];for(const o of n)for(const c of o.kinds)e.set(c,o);const s=e.get(t.kind);return s?s.from(t):t}function checkMissingKind(t,e){(t.kind===void 0||t.kind===null)&&e("event-missing-kind",`Cannot sign event without 'kind'.

 Event data:
    content: ${t.content?`"${t.content.substring(0,50)}${t.content.length>50?"...":""}"`:"(empty)"}
    tags: ${t.tags.length} tag${t.tags.length!==1?"s":""}
    kind: ${t.kind} 

Set event.kind before signing.`,"Example: event.kind = 1; // for text note",!1)}function checkContentIsObject(t,e){if(typeof t.content=="object"){const r=JSON.stringify(t.content,null,2).substring(0,200);e("event-content-is-object",`Event content is an object. Content must be a string.

 Your content (${typeof t.content}):
${r}${JSON.stringify(t.content).length>200?"...":""}

 event.content = { ... }  // WRONG
 event.content = JSON.stringify({ ... })  // CORRECT`,"Use JSON.stringify() for structured data: event.content = JSON.stringify(data)",!1)}}function checkCreatedAtMilliseconds(t,e){if(t.created_at&&t.created_at>1e10){const r=Math.floor(t.created_at/1e3),n=new Date(t.created_at).toISOString();e("event-created-at-milliseconds",`Event created_at is in milliseconds, not seconds.

 Your value:
    created_at: ${t.created_at} 
    Interpreted as: ${n}
    Should be: ${r} 

Nostr timestamps MUST be in seconds since Unix epoch.`,"Use Math.floor(Date.now() / 1000) instead of Date.now()",!1)}}function checkInvalidPTags(t,e){t.getMatchingTags("p").forEach((n,s)=>{if(n[1]&&!/^[0-9a-f]{64}$/i.test(n[1])){const o=JSON.stringify(n);e("tag-invalid-p-tag",`p-tag[${s}] has invalid pubkey.

 Your tag:
   ${o}

 Invalid value: "${n[1]}"
    Length: ${n[1].length} (expected 64)
    Format: ${n[1].startsWith("npub")?"bech32 (npub)":"unknown"}

p-tags MUST contain 64-character hex pubkeys.`,n[1].startsWith("npub")?`Use ndkUser.pubkey instead of npub:
    event.tags.push(['p', ndkUser.pubkey])
    event.tags.push(['p', 'npub1...'])`:"p-tags must contain valid hex pubkeys (64 characters, 0-9a-f)",!1)}})}function checkInvalidETags(t,e){t.getMatchingTags("e").forEach((n,s)=>{if(n[1]&&!/^[0-9a-f]{64}$/i.test(n[1])){const o=JSON.stringify(n),c=n[1].startsWith("note")||n[1].startsWith("nevent");e("tag-invalid-e-tag",`e-tag[${s}] has invalid event ID.

 Your tag:
   ${o}

 Invalid value: "${n[1]}"
    Length: ${n[1].length} (expected 64)
    Format: ${c?"bech32 (note/nevent)":"unknown"}

e-tags MUST contain 64-character hex event IDs.`,c?`Use event.id instead of bech32:
    event.tags.push(['e', referencedEvent.id])
    event.tags.push(['e', 'note1...'])`:"e-tags must contain valid hex event IDs (64 characters, 0-9a-f)",!1)}})}function checkManualReplyMarkers(t,e,r){if(t.kind!==1||r.has(t))return;const n=t.tags.filter(s=>s[0]==="e"&&(s[3]==="reply"||s[3]==="root"));if(n.length>0){const s=n.map((o,c)=>`   ${c+1}. ${JSON.stringify(o)}`).join(`
`);e("event-manual-reply-markers",`Event has ${n.length} e-tag(s) with manual reply/root markers.

 Your tags with markers:
${s}

  Manual reply markers detected! This will cause incorrect threading.`,`Reply events MUST be created using .reply():

    CORRECT:
   const replyEvent = originalEvent.reply();
   replyEvent.content = 'good point!';
   await replyEvent.publish();

    WRONG:
   event.tags.push(['e', eventId, '', 'reply']);

NDK handles all reply threading automatically - never add reply/root markers manually.`)}}function checkHashtagsWithPrefix(t,e){t.getMatchingTags("t").forEach((n,s)=>{if(n[1]&&n[1].startsWith("#")){const o=JSON.stringify(n);e("tag-hashtag-with-prefix",`t-tag[${s}] contains hashtag with # prefix.

 Your tag:
   ${o}

 Invalid value: "${n[1]}"

Hashtag tags should NOT include the # symbol.`,`Remove the # prefix from hashtag tags:
    event.tags.push(['t', 'nostr'])
    event.tags.push(['t', '#nostr'])`,!1)}})}function checkReplaceableWithOldTimestamp(t,e){if(t.kind===void 0||t.kind===null||!t.created_at||!t.isReplaceable())return;const r=Math.floor(Date.now()/1e3),n=r-t.created_at;if(n>10){const o=Math.floor(n/60),c=o>0?`${o} minute${o!==1?"s":""}`:`${n} seconds`;e("event-replaceable-old-timestamp",`Publishing a replaceable event with an old created_at timestamp.

 Event details:
    kind: ${t.kind} (replaceable)
    created_at: ${t.created_at}
    age: ${c} old
    current time: ${r}

  This is wrong and will be rejected by relays.`,`For replaceable events, use publishReplaceable():

    CORRECT:
   await event.publishReplaceable();
   // Automatically updates created_at to now

    WRONG:
   await event.publish();
   // Uses old created_at`)}}function signing(t,e,r,n){checkMissingKind(t,e),checkContentIsObject(t,e),checkCreatedAtMilliseconds(t,e),checkInvalidPTags(t,e),checkInvalidETags(t,e),checkHashtagsWithPrefix(t,e),checkManualReplyMarkers(t,r,n)}function publishing(t,e){checkReplaceableWithOldTimestamp(t,e)}function isNip33Pattern(t){const e=Array.isArray(t)?t:[t];if(e.length!==1)return!1;const r=e[0];return r.kinds&&Array.isArray(r.kinds)&&r.kinds.length===1&&r.authors&&Array.isArray(r.authors)&&r.authors.length===1&&r["#d"]&&Array.isArray(r["#d"])&&r["#d"].length===1}function isReplaceableEventFilter(t){const e=Array.isArray(t)?t:[t];return e.length===0?!1:e.every(r=>!r.kinds||!Array.isArray(r.kinds)||r.kinds.length===0||!r.authors||!Array.isArray(r.authors)||r.authors.length===0?!1:r.kinds.every(s=>s===0||s===3||s>=1e4&&s<=19999))}function formatFilter(t){return JSON.stringify(t,null,2).split(`
`).map((r,n)=>n===0?r:`   ${r}`).join(`
`)}function fetchingEvents(t,e,r,n,s){if(s(),e?.cacheUsage==="ONLY_CACHE")return;const o=Array.isArray(t)?t:[t],c=o.map(formatFilter).join(`

   ---

   `);if(isNip33Pattern(t))o[0],r("fetch-events-usage",`For fetching a NIP-33 addressable event, use fetchEvent() with the naddr directly.

 Your filter:
   `+c+`

   BAD:  const decoded = nip19.decode(naddr);
           const events = await ndk.fetchEvents({
             kinds: [decoded.data.kind],
             authors: [decoded.data.pubkey],
             "#d": [decoded.data.identifier]
           });
           const event = Array.from(events)[0];

   GOOD: const event = await ndk.fetchEvent(naddr);
   GOOD: const event = await ndk.fetchEvent('naddr1...');

fetchEvent() handles naddr decoding automatically and returns the event directly.`);else{if(isReplaceableEventFilter(t))return;{if(!n())return;let u="";const f=o.some(g=>g.limit!==void 0),x=new Set(o.flatMap(g=>g.kinds||[])).size,p=new Set(o.flatMap(g=>g.authors||[])).size;if(f){const g=Math.max(...o.map(y=>y.limit||0));u+=`
    Limit: ${g} event${g!==1?"s":""}`}x>0&&(u+=`
    Kinds: ${x} type${x!==1?"s":""}`),p>0&&(u+=`
    Authors: ${p} author${p!==1?"s":""}`),r("fetch-events-usage",`fetchEvents() is a BLOCKING operation that waits for EOSE.
In most cases, you should use subscribe() instead.

 Your filter`+(o.length>1?"s":"")+`:
   `+c+(u?`

 Filter analysis:`+u:"")+`

   BAD:  const events = await ndk.fetchEvents(filter);
   GOOD: ndk.subscribe(filter, { onEvent: (e) => ... });

Only use fetchEvents() when you MUST block until data arrives.`,"For one-time queries, use fetchEvent() instead of fetchEvents() when expecting a single result.")}}}var GuardrailCheckId={NDK_NO_CACHE:"ndk-no-cache",FILTER_BECH32_IN_ARRAY:"filter-bech32-in-array",FILTER_INVALID_HEX:"filter-invalid-hex",FILTER_ONLY_LIMIT:"filter-only-limit",FILTER_EMPTY:"filter-empty",FILTER_SINCE_AFTER_UNTIL:"filter-since-after-until",FILTER_INVALID_A_TAG:"filter-invalid-a-tag",FILTER_HASHTAG_WITH_PREFIX:"filter-hashtag-with-prefix"};function checkCachePresence(t,e){e(GuardrailCheckId.NDK_NO_CACHE)&&setTimeout(()=>{if(!t.cacheAdapter){const s=`
 AI_GUARDRAILS WARNING: NDK initialized without a cache adapter. Apps perform significantly better with caching.

 ${typeof window<"u"?"Consider using @nostr-dev-kit/ndk-cache-dexie or @nostr-dev-kit/ndk-cache-sqlite-wasm":"Consider using @nostr-dev-kit/ndk-cache-redis or @nostr-dev-kit/ndk-cache-sqlite"}

 To disable this check:
   ndk.aiGuardrails.skip('${GuardrailCheckId.NDK_NO_CACHE}')
   or set: ndk.aiGuardrails = { skip: new Set(['${GuardrailCheckId.NDK_NO_CACHE}']) }`;console.warn(s)}},2500)}var AIGuardrails=class{enabled=!1;skipSet=new Set;extensions=new Map;_nextCallDisabled=null;_replyEvents=new WeakSet;_fetchEventsCount=0;_subscribeCount=0;constructor(t=!1){this.setMode(t)}register(t,e){this.extensions.has(t)&&console.warn(`AIGuardrails: Extension '${t}' already registered, overwriting`);const r={};for(const[n,s]of Object.entries(e))typeof s=="function"&&(r[n]=(...o)=>{this.enabled&&s(...o,this.shouldCheck.bind(this),this.error.bind(this),this.warn.bind(this))});this.extensions.set(t,r),this[t]=r}setMode(t){typeof t=="boolean"?(this.enabled=t,this.skipSet.clear()):t&&typeof t=="object"&&(this.enabled=!0,this.skipSet=t.skip||new Set)}isEnabled(){return this.enabled}shouldCheck(t){return!(!this.enabled||this.skipSet.has(t)||this._nextCallDisabled==="all"||this._nextCallDisabled&&this._nextCallDisabled.has(t))}skip(t){this.skipSet.add(t)}enable(t){this.skipSet.delete(t)}getSkipped(){return Array.from(this.skipSet)}captureAndClearNextCallDisabled(){const t=this._nextCallDisabled;return this._nextCallDisabled=null,t}incrementFetchEventsCount(){this._fetchEventsCount++}incrementSubscribeCount(){this._subscribeCount++}shouldWarnAboutFetchEventsRatio(){const t=this._fetchEventsCount+this._subscribeCount;return t<=6?!1:this._fetchEventsCount/t>.5}error(t,e,r,n=!0){if(!this.shouldCheck(t))return;const s=this.formatMessage(t,"ERROR",e,r,n);throw console.error(s),new Error(s)}warn(t,e,r){if(!this.shouldCheck(t))return;const n=this.formatMessage(t,"WARNING",e,r,!0);throw console.error(n),new Error(n)}formatMessage(t,e,r,n,s=!0){let o=`
 AI_GUARDRAILS ${e}: ${r}`;return n&&(o+=`

 ${n}`),s&&(o+=`

 To disable this check:
   ndk.guardrailOff('${t}').yourMethod()  // For one call`,o+=`
   ndk.aiGuardrails.skip('${t}')  // Permanently`,o+=`
   or set: ndk.aiGuardrails = { skip: new Set(['${t}']) }`),o}ndkInstantiated(t){this.enabled&&checkCachePresence(t,this.shouldCheck.bind(this))}ndk={fetchingEvents:(t,e)=>{this.enabled&&fetchingEvents(t,e,this.warn.bind(this),this.shouldWarnAboutFetchEventsRatio.bind(this),this.incrementFetchEventsCount.bind(this))}};event={signing:t=>{this.enabled&&signing(t,this.error.bind(this),this.warn.bind(this),this._replyEvents)},publishing:t=>{this.enabled&&publishing(t,this.warn.bind(this))},received:(t,e)=>{this.enabled},creatingReply:t=>{this.enabled&&this._replyEvents.add(t)}};subscription={created:(t,e)=>{this.enabled&&this.incrementSubscribeCount()}};relay={connected:t=>{this.enabled}}};function processFilters(t,e="validate",r,n){if(e==="ignore")return t;const s=[],o=t.map((c,u)=>(n?.aiGuardrails.isEnabled()&&runAIGuardrailsForFilter(c,u,n),processFilter(c,e,u,s,r)));if(e==="validate"&&s.length>0)throw new Error(`Invalid filter(s) detected:
${s.join(`
`)}`);return o}function processFilter(t,e,r,n,s){const o=e==="validate",c=o?t:{...t};if(t.ids){const u=[];t.ids.forEach((f,x)=>{f===void 0?o?n.push(`Filter[${r}].ids[${x}] is undefined`):s?.(`Fixed: Removed undefined value at ids[${x}]`):typeof f!="string"?o?n.push(`Filter[${r}].ids[${x}] is not a string (got ${typeof f})`):s?.(`Fixed: Removed non-string value at ids[${x}] (was ${typeof f})`):isValidHex64(f)?u.push(f):o?n.push(`Filter[${r}].ids[${x}] is not a valid 64-char hex string: "${f}"`):s?.(`Fixed: Removed invalid hex string at ids[${x}]`)}),o||(c.ids=u.length>0?u:void 0)}if(t.authors){const u=[];t.authors.forEach((f,x)=>{f===void 0?o?n.push(`Filter[${r}].authors[${x}] is undefined`):s?.(`Fixed: Removed undefined value at authors[${x}]`):typeof f!="string"?o?n.push(`Filter[${r}].authors[${x}] is not a string (got ${typeof f})`):s?.(`Fixed: Removed non-string value at authors[${x}] (was ${typeof f})`):isValidHex64(f)?u.push(f):o?n.push(`Filter[${r}].authors[${x}] is not a valid 64-char hex pubkey: "${f}"`):s?.(`Fixed: Removed invalid hex pubkey at authors[${x}]`)}),o||(c.authors=u.length>0?u:void 0)}if(t.kinds){const u=[];t.kinds.forEach((f,x)=>{f===void 0?o?n.push(`Filter[${r}].kinds[${x}] is undefined`):s?.(`Fixed: Removed undefined value at kinds[${x}]`):typeof f!="number"?o?n.push(`Filter[${r}].kinds[${x}] is not a number (got ${typeof f})`):s?.(`Fixed: Removed non-number value at kinds[${x}] (was ${typeof f})`):Number.isInteger(f)?f<0||f>65535?o?n.push(`Filter[${r}].kinds[${x}] is out of valid range (0-65535): ${f}`):s?.(`Fixed: Removed out-of-range kind at kinds[${x}]: ${f}`):u.push(f):o?n.push(`Filter[${r}].kinds[${x}] is not an integer: ${f}`):s?.(`Fixed: Removed non-integer value at kinds[${x}]: ${f}`)}),o||(c.kinds=u.length>0?u:void 0)}for(const u in t)if(u.startsWith("#")&&u.length===2){const f=t[u];if(Array.isArray(f)){const x=[];f.forEach((p,g)=>{p===void 0?o?n.push(`Filter[${r}].${u}[${g}] is undefined`):s?.(`Fixed: Removed undefined value at ${u}[${g}]`):typeof p!="string"?o?n.push(`Filter[${r}].${u}[${g}] is not a string (got ${typeof p})`):s?.(`Fixed: Removed non-string value at ${u}[${g}] (was ${typeof p})`):(u==="#e"||u==="#p")&&!isValidHex64(p)?o?n.push(`Filter[${r}].${u}[${g}] is not a valid 64-char hex string: "${p}"`):s?.(`Fixed: Removed invalid hex string at ${u}[${g}]`):x.push(p)}),o||(c[u]=x.length>0?x:void 0)}}return o||Object.keys(c).forEach(u=>{c[u]===void 0&&delete c[u]}),c}function runAIGuardrailsForFilter(t,e,r){const n=r.aiGuardrails,s=JSON.stringify(t,null,2);if(Object.keys(t).length===1&&t.limit!==void 0&&n.error(GuardrailCheckId.FILTER_ONLY_LIMIT,`Filter[${e}] contains only 'limit' without any filtering criteria.

 Your filter:
${s}

  This will fetch random events from relays without any criteria.`,`Add filtering criteria:
    { kinds: [1], limit: 10 }
    { authors: [pubkey], limit: 10 }
    { limit: 10 }`),Object.keys(t).length===0&&n.error(GuardrailCheckId.FILTER_EMPTY,`Filter[${e}] is empty.

 Your filter:
${s}

  This will request ALL events from relays, which is never what you want.`,"Add filtering criteria like 'kinds', 'authors', or tags.",!1),t.since!==void 0&&t.until!==void 0&&t.since>t.until){const c=new Date(t.since*1e3).toISOString(),u=new Date(t.until*1e3).toISOString();n.error(GuardrailCheckId.FILTER_SINCE_AFTER_UNTIL,`Filter[${e}] has 'since' AFTER 'until'.

 Your filter:
${s}

 since: ${t.since} (${c})
 until: ${t.until} (${u})

No events can match this time range!`,"'since' must be BEFORE 'until'. Both are Unix timestamps in seconds.",!1)}const o=/^n(addr|event|ote|pub|profile)1/;t.ids&&t.ids.forEach((c,u)=>{typeof c=="string"&&(o.test(c)?n.error(GuardrailCheckId.FILTER_BECH32_IN_ARRAY,`Filter[${e}].ids[${u}] contains bech32: "${c}". IDs must be hex, not bech32.`,'Use filterFromId() to decode bech32 first: import { filterFromId } from "@nostr-dev-kit/ndk"',!1):isValidHex64(c)||n.error(GuardrailCheckId.FILTER_INVALID_HEX,`Filter[${e}].ids[${u}] is not a valid 64-char hex string: "${c}"`,`Event IDs must be 64-character hexadecimal strings. Invalid IDs often come from corrupted data in user-generated lists. Always validate hex strings before using them in filters:

   const validIds = ids.filter(id => /^[0-9a-f]{64}$/i.test(id));`,!1))}),t.authors&&t.authors.forEach((c,u)=>{typeof c=="string"&&(o.test(c)?n.error(GuardrailCheckId.FILTER_BECH32_IN_ARRAY,`Filter[${e}].authors[${u}] contains bech32: "${c}". Authors must be hex pubkeys, not npub.`,"Use ndkUser.pubkey instead. Example: { authors: [ndkUser.pubkey] }",!1):isValidHex64(c)||n.error(GuardrailCheckId.FILTER_INVALID_HEX,`Filter[${e}].authors[${u}] is not a valid 64-char hex pubkey: "${c}"`,`Kind:3 follow lists can contain invalid entries like labels ("Follow List"), partial strings ("highlig"), or other corrupted data. You MUST validate all pubkeys before using them in filters.

   Example:
   const validPubkeys = pubkeys.filter(p => /^[0-9a-f]{64}$/i.test(p));
   ndk.subscribe({ authors: validPubkeys, kinds: [1] });`,!1))});for(const c in t)if(c.startsWith("#")&&c.length===2){const u=t[c];Array.isArray(u)&&u.forEach((f,x)=>{typeof f=="string"&&(c==="#e"||c==="#p")&&(o.test(f)?n.error(GuardrailCheckId.FILTER_BECH32_IN_ARRAY,`Filter[${e}].${c}[${x}] contains bech32: "${f}". Tag values must be decoded.`,"Use filterFromId() or nip19.decode() to get the hex value first.",!1):isValidHex64(f)||n.error(GuardrailCheckId.FILTER_INVALID_HEX,`Filter[${e}].${c}[${x}] is not a valid 64-char hex string: "${f}"`,`${c==="#e"?"Event IDs":"Public keys"} in tag filters must be 64-character hexadecimal strings. Kind:3 follow lists and other user-generated content can contain invalid data. Always filter before using:

   const validValues = values.filter(v => /^[0-9a-f]{64}$/i.test(v));`,!1))})}t["#a"]&&t["#a"]?.forEach((u,f)=>{if(typeof u=="string")if(!/^\d+:[0-9a-f]{64}:.*$/.test(u))n.error(GuardrailCheckId.FILTER_INVALID_A_TAG,`Filter[${e}].#a[${f}] has invalid format: "${u}". Must be "kind:pubkey:d-tag".`,'Example: "30023:fa984bd7dbb282f07e16e7ae87b26a2a7b9b90b7246a44771f0cf5ae58018f52:my-article"',!1);else{const x=Number.parseInt(u.split(":")[0],10);(x<3e4||x>39999)&&n.error(GuardrailCheckId.FILTER_INVALID_A_TAG,`Filter[${e}].#a[${f}] uses non-addressable kind ${x}: "${u}". #a filters are only for addressable events (kinds 30000-39999).`,`Addressable events include:
    30000-30039: Parameterized Replaceable Events (profiles, settings, etc.)
    30040-39999: Other addressable events

For regular events (kind ${x}), use:
    #e filter for specific event IDs
    kinds + authors filters for event queries`,!1)}}),t["#t"]&&t["#t"]?.forEach((u,f)=>{typeof u=="string"&&u.startsWith("#")&&n.error(GuardrailCheckId.FILTER_HASHTAG_WITH_PREFIX,`Filter[${e}].#t[${f}] contains hashtag with # prefix: "${u}". Hashtag values should NOT include the # symbol.`,`Remove the # prefix from hashtag filters:
    { "#t": ["nostr"] }
    { "#t": ["#nostr"] }`,!1)})}function queryFullyFilled(t){return!!(filterIncludesIds(t.filter)&&resultHasAllRequestedIds(t))}function filterIncludesIds(t){return!!t.ids}function resultHasAllRequestedIds(t){const e=t.filter.ids;return!!e&&e.length===t.eventFirstSeen.size}function filterFromId(t){let e;if(t.match(NIP33_A_REGEX)){const[r,n,s]=t.split(":"),o={authors:[n],kinds:[Number.parseInt(r)]};return s&&(o["#d"]=[s]),o}if(t.match(BECH32_REGEX))try{switch(e=nip19_exports$1.decode(t),e.type){case"nevent":{const r={ids:[e.data.id]};return e.data.author&&(r.authors=[e.data.author]),e.data.kind&&(r.kinds=[e.data.kind]),r}case"note":return{ids:[e.data]};case"naddr":{const r={authors:[e.data.pubkey],kinds:[e.data.kind]};return e.data.identifier&&(r["#d"]=[e.data.identifier]),r}}}catch(r){console.error("Error decoding",t,r)}return{ids:[t]}}function isNip33AValue(t){return t.match(NIP33_A_REGEX)!==null}var NIP33_A_REGEX=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,BECH32_REGEX=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;function relaysFromBech32(t,e){try{const r=nip19_exports$1.decode(t);if(["naddr","nevent"].includes(r?.type)){const n=r.data;if(n?.relays)return n.relays.map(s=>new NDKRelay(s,e.relayAuthDefaultPolicy,e))}}catch{}return[]}var defaultOpts={closeOnEose:!1,cacheUsage:"CACHE_FIRST",dontSaveToCache:!1,groupable:!0,groupableDelay:100,groupableDelayType:"at-most",cacheUnconstrainFilter:["limit","since","until"],includeMuted:!1},NDKSubscription=class extends libExports.EventEmitter{subId;filters;opts;pool;skipVerification=!1;skipValidation=!1;exclusiveRelay=!1;relayFilters;relaySet;ndk;debug;eventFirstSeen=new Map;eosesSeen=new Set;lastEventReceivedAt;mostRecentCacheEventTimestamp;internalId;closeOnEose;poolMonitor;skipOptimisticPublishEvent=!1;cacheUnconstrainFilter;constructor(t,e,r,n){super(),this.ndk=t,this.opts={...defaultOpts,...r||{}},this.pool=this.opts.pool||t.pool;const s=Array.isArray(e)?e:[e],o=t.filterValidationMode==="validate"?"validate":t.filterValidationMode==="fix"?"fix":"ignore";if(this.filters=processFilters(s,o,t.debug,t),this.filters.length===0)throw new Error("Subscription must have at least one filter");this.subId=n||this.opts.subId,this.internalId=Math.random().toString(36).substring(7),this.debug=t.debug.extend(`subscription[${this.opts.subId??this.internalId}]`),this.opts.relaySet?this.relaySet=this.opts.relaySet:this.opts.relayUrls&&(this.relaySet=NDKRelaySet.fromRelayUrls(this.opts.relayUrls,this.ndk)),this.skipVerification=this.opts.skipVerification||!1,this.skipValidation=this.opts.skipValidation||!1,this.closeOnEose=this.opts.closeOnEose||!1,this.skipOptimisticPublishEvent=this.opts.skipOptimisticPublishEvent||!1,this.cacheUnconstrainFilter=this.opts.cacheUnconstrainFilter,this.exclusiveRelay=this.opts.exclusiveRelay||!1,this.opts.onEvent&&this.on("event",this.opts.onEvent),this.opts.onEose&&this.on("eose",this.opts.onEose),this.opts.onClose&&this.on("close",this.opts.onClose)}relaysMissingEose(){return this.relayFilters?Array.from(this.relayFilters?.keys()).filter(e=>!this.eosesSeen.has(this.pool.getRelay(e,!1,!1))):[]}get filter(){return this.filters[0]}get groupableDelay(){if(this.isGroupable())return this.opts?.groupableDelay}get groupableDelayType(){return this.opts?.groupableDelayType||"at-most"}isGroupable(){return this.opts?.groupable||!1}shouldQueryCache(){return this.opts.addSinceFromCache?!0:this.opts?.cacheUsage==="ONLY_RELAY"?!1:(this.filters.some(e=>e.kinds?.some(r=>kindIsEphemeral(r))),!0)}shouldQueryRelays(){return this.opts?.cacheUsage!=="ONLY_CACHE"}shouldWaitForCache(){return this.opts.addSinceFromCache?!0:!!this.opts.closeOnEose&&!!this.ndk.cacheAdapter?.locking&&this.opts.cacheUsage!=="PARALLEL"}start(t=!0){let e;const r=s=>{for(const o of s)o.created_at&&(!this.mostRecentCacheEventTimestamp||o.created_at>this.mostRecentCacheEventTimestamp)&&(this.mostRecentCacheEventTimestamp=o.created_at),this.eventReceived(o,void 0,!0,!1);t||(e=s)},n=()=>{this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)};return this.shouldQueryCache()?(e=this.startWithCache(),e instanceof Promise?this.shouldWaitForCache()?(e.then(s=>{if(r(s),queryFullyFilled(this)){this.emit("eose",this);return}n()}),null):(e.then(s=>{r(s),this.shouldQueryRelays()||this.emit("eose",this)}),this.shouldQueryRelays()&&n(),null):(r(e),queryFullyFilled(this)?this.emit("eose",this):n(),e)):(n(),null)}startPoolMonitor(){this.debug.extend("pool-monitor"),this.poolMonitor=t=>{if(this.relayFilters?.has(t.url))return;calculateRelaySetsFromFilters(this.ndk,this.filters,this.pool,this.opts.relayGoalPerAuthor).get(t.url)&&(this.relayFilters?.set(t.url,this.filters),t.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}onStopped;stop(){this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),this.onStopped?.()}hasAuthorsFilter(){return this.filters.some(t=>t.authors?.length)}startWithCache(){return this.ndk.cacheAdapter?.query?this.ndk.cacheAdapter.query(this):[]}startWithRelays(){let t=this.filters;if(this.opts.addSinceFromCache&&this.mostRecentCacheEventTimestamp){const e=this.mostRecentCacheEventTimestamp+1;t=t.map(r=>({...r,since:Math.max(r.since||0,e)}))}if(!this.relaySet||this.relaySet.relays.size===0)this.relayFilters=calculateRelaySetsFromFilters(this.ndk,t,this.pool,this.opts.relayGoalPerAuthor);else{this.relayFilters=new Map;for(const e of this.relaySet.relays)this.relayFilters.set(e.url,t)}for(const[e,r]of this.relayFilters)this.pool.getRelay(e,!0,!0,r).subscribe(this,r)}refreshRelayConnections(){if(this.relaySet&&this.relaySet.relays.size>0)return;const t=calculateRelaySetsFromFilters(this.ndk,this.filters,this.pool,this.opts.relayGoalPerAuthor);for(const[e,r]of t)this.relayFilters?.has(e)||(this.relayFilters?.set(e,r),this.pool.getRelay(e,!0,!0,r).subscribe(this,r))}eventReceived(t,e,r=!1,n=!1){const s=t.id,o=this.eventFirstSeen.has(s);let c;if(t instanceof NDKEvent&&(c=t),o){const u=Date.now()-(this.eventFirstSeen.get(s)||0);if(this.emit("event:dup",t,e,u,this,r,n),this.opts?.onEventDup&&this.opts.onEventDup(t,e,u,this,r,n),!r&&!n&&e&&this.ndk.cacheAdapter?.setEventDup&&!this.opts.dontSaveToCache&&(c??=t instanceof NDKEvent?t:new NDKEvent(this.ndk,t),this.ndk.cacheAdapter.setEventDup(c,e)),e){const f=verifiedSignatures.get(s);if(f&&typeof f=="string")if(t.sig===f)e.addValidatedEvent();else{const x=t instanceof NDKEvent?t:new NDKEvent(this.ndk,t);this.ndk.reportInvalidSignature(x,e)}}}else{if(c??=new NDKEvent(this.ndk,t),c.ndk=this.ndk,c.relay=e,!r&&!n){if(!this.skipValidation&&!c.isValid){this.debug("Event failed validation %s from relay %s",s,e?.url);return}if(e)if(e.shouldValidateEvent()&&!this.skipVerification)if(c.relay=e,this.ndk.asyncSigVerification)c.verifySignature(!0);else{if(!c.verifySignature(!0)){this.debug("Event failed signature validation",t),this.ndk.reportInvalidSignature(c,e);return}e.addValidatedEvent()}else e.addNonValidatedEvent();this.ndk.cacheAdapter&&!this.opts.dontSaveToCache&&this.ndk.cacheAdapter.setEvent(c,this.filters,e)}if(!this.opts.includeMuted&&this.ndk.muteFilter&&this.ndk.muteFilter(c)){this.debug("Event muted, skipping");return}(!n||this.skipOptimisticPublishEvent!==!0)&&(this.emitEvent(this.opts?.wrap??!1,c,e,r,n),this.eventFirstSeen.set(s,Date.now()))}this.lastEventReceivedAt=Date.now()}emitEvent(t,e,r,n,s){const o=t?wrapEvent(e):e;o instanceof Promise?o.then(c=>this.emitEvent(!1,c,r,n,s)):o&&this.emit("event",o,r,this,n,s)}closedReceived(t,e){this.emit("closed",t,e)}eoseTimeout;eosed=!1;eoseReceived(t){this.debug("EOSE received from %s",t.url),this.eosesSeen.add(t);let e=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const r=this.eosesSeen.size===this.relayFilters?.size,n=queryFullyFilled(this),s=o=>{this.debug("Performing EOSE: %s %d",o,this.eosed),!this.eosed&&(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.emit("eose",this),this.eosed=!0,this.opts?.closeOnEose&&this.stop())};if(n||r)s("query filled or seen all");else if(this.relayFilters){let o=1e3;const c=new Set(this.pool.connectedRelays().map(x=>x.url)),u=Array.from(this.relayFilters.keys()).filter(x=>c.has(x));if(u.length===0){this.debug("No connected relays, waiting for all relays to connect",Array.from(this.relayFilters.keys()).join(", "));return}const f=this.eosesSeen.size/u.length;if(this.debug("Percentage of relays that have sent EOSE",{subId:this.subId,percentageOfRelaysThatHaveSentEose:f,seen:this.eosesSeen.size,total:u.length}),this.eosesSeen.size>=2&&f>=.5){if(o=o*(1-f),o===0){s("time to wait was 0");return}this.eoseTimeout&&clearTimeout(this.eoseTimeout);const x=()=>{e=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,e!==void 0&&e<20?this.eoseTimeout=setTimeout(x,o):s(`send eose timeout: ${o}`)};this.eoseTimeout=setTimeout(x,o)}}}},kindIsEphemeral=t=>t>=2e4&&t<3e4;async function follows(t,e,r=3){if(!this.ndk)throw new Error("NDK not set");const n=await this.ndk.fetchEvent({kinds:[r],authors:[this.pubkey]},t||{groupable:!1});if(n){const s=new Set;return n.tags.forEach(o=>{o[0]==="p"&&o[1]&&isValidPubkey(o[1])&&s.add(o[1])}),e&&this.ndk?.outboxTracker?.trackUsers(Array.from(s)),[...s].reduce((o,c)=>{const u=new NDKUser({pubkey:c});return u.ndk=this.ndk,o.add(u),o},new Set)}return new Set}var NIP05_REGEX=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function getNip05For(t,e,r=fetch,n={}){return await t.queuesNip05.add({id:e,func:async()=>{if(t.cacheAdapter?.loadNip05){const f=await t.cacheAdapter.loadNip05(e);if(f!=="missing"){if(f){const x=new NDKUser({pubkey:f.pubkey,relayUrls:f.relays,nip46Urls:f.nip46});return x.ndk=t,x}if(n.cache!=="no-cache")return null}}const s=e.match(NIP05_REGEX);if(!s)return null;const[o,c="_",u]=s;try{const f=await r(`https://${u}/.well-known/nostr.json?name=${c}`,n),{names:x,relays:p,nip46:g}=parseNIP05Result(await f.json()),y=x[c.toLowerCase()];let b=null;return y&&(b={pubkey:y,relays:p?.[y],nip46:g?.[y]}),t?.cacheAdapter?.saveNip05&&t.cacheAdapter.saveNip05(e,b),b}catch(f){return t?.cacheAdapter?.saveNip05&&t?.cacheAdapter.saveNip05(e,null),console.error("Failed to fetch NIP05 for",e,f),null}}})}function parseNIP05Result(t){const e={names:{}};for(const[r,n]of Object.entries(t.names))typeof r=="string"&&typeof n=="string"&&(e.names[r.toLowerCase()]=n);if(t.relays){e.relays={};for(const[r,n]of Object.entries(t.relays))typeof r=="string"&&Array.isArray(n)&&(e.relays[r]=n.filter(s=>typeof s=="string"))}if(t.nip46){e.nip46={};for(const[r,n]of Object.entries(t.nip46))typeof r=="string"&&Array.isArray(n)&&(e.nip46[r]=n.filter(s=>typeof s=="string"))}return e}function profileFromEvent(t){const e={};let r;try{r=JSON.parse(t.content)}catch(n){throw new Error(`Failed to parse profile event: ${n}`)}e.profileEvent=JSON.stringify(t.rawEvent());for(const n of Object.keys(r))switch(n){case"name":e.name=r.name;break;case"display_name":e.displayName=r.display_name;break;case"image":case"picture":e.picture=r.picture||r.image,e.image=e.picture;break;case"banner":e.banner=r.banner;break;case"bio":e.bio=r.bio;break;case"nip05":e.nip05=r.nip05;break;case"lud06":e.lud06=r.lud06;break;case"lud16":e.lud16=r.lud16;break;case"about":e.about=r.about;break;case"website":e.website=r.website;break;default:e[n]=r[n];break}return e.created_at=t.created_at,e}function serializeProfile(t){const e={};for(const[r,n]of Object.entries(t))switch(r){case"username":case"name":e.name=n;break;case"displayName":e.display_name=n;break;case"image":case"picture":e.picture=n;break;case"bio":case"about":e.about=n;break;default:e[r]=n;break}return JSON.stringify(e)}var NDKUser=class ch{ndk;profile;profileEvent;_npub;_pubkey;relayUrls=[];nip46Urls=[];constructor(e){if(e.npub&&(this._npub=e.npub),e.hexpubkey&&(this._pubkey=e.hexpubkey),e.pubkey&&(this._pubkey=e.pubkey),e.relayUrls&&(this.relayUrls=e.relayUrls),e.nip46Urls&&(this.nip46Urls=e.nip46Urls),e.nprofile)try{const r=nip19_exports$1.decode(e.nprofile);r.type==="nprofile"&&(this._pubkey=r.data.pubkey,r.data.relays&&r.data.relays.length>0&&this.relayUrls.push(...r.data.relays))}catch(r){console.error("Failed to decode nprofile",r)}}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=nip19_exports$1.npubEncode(this.pubkey)}return this._npub}get nprofile(){const e=this.profileEvent?.onRelays?.map(r=>r.url);return nip19_exports$1.nprofileEncode({pubkey:this.pubkey,relays:e})}set npub(e){this._npub=e}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=nip19_exports$1.decode(this.npub).data}return this._pubkey}set pubkey(e){this._pubkey=e}filter(){return{"#p":[this.pubkey]}}async getZapInfo(e){if(!this.ndk)throw new Error("No NDK instance found");const r=async c=>{if(!e)return c;let u;const f=new Promise((x,p)=>{u=setTimeout(()=>p(new Error("Timeout")),e)});try{const x=await Promise.race([c,f]);return u&&clearTimeout(u),x}catch(x){if(x instanceof Error&&x.message==="Timeout")try{return await c}catch{return}return}},[n,s]=await Promise.all([r(this.fetchProfile()),r(this.ndk.fetchEvent({kinds:[10019],authors:[this.pubkey]}))]),o=new Map;if(s){const c=NDKCashuMintList.from(s);c.mints.length>0&&o.set("nip61",{mints:c.mints,relays:c.relays,p2pk:c.p2pk})}if(n){const{lud06:c,lud16:u}=n;o.set("nip57",{lud06:c,lud16:u})}return o}static async fromNip05(e,r,n=!1){if(!r)throw new Error("No NDK instance found");const s={};n&&(s.cache="no-cache");const o=await getNip05For(r,e,r?.httpFetch,s);if(o){const c=new ch({pubkey:o.pubkey,relayUrls:o.relays,nip46Urls:o.nip46});return c.ndk=r,c}}async fetchProfile(e,r=!1){if(!this.ndk)throw new Error("NDK not set");let n=null;if(this.ndk.cacheAdapter&&(this.ndk.cacheAdapter.fetchProfile||this.ndk.cacheAdapter.fetchProfileSync)&&e?.cacheUsage!=="ONLY_RELAY"){let s=null;if(this.ndk.cacheAdapter.fetchProfileSync?s=this.ndk.cacheAdapter.fetchProfileSync(this.pubkey):this.ndk.cacheAdapter.fetchProfile&&(s=await this.ndk.cacheAdapter.fetchProfile(this.pubkey)),s)return this.profile=s,s}return e??={},e.cacheUsage??="ONLY_RELAY",e.closeOnEose??=!0,e.groupable??=!0,e.groupableDelay??=250,n||(n=await this.ndk.fetchEvent({kinds:[0],authors:[this.pubkey]},e)),n?(this.profile=profileFromEvent(n),r&&this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile):null}follows=follows.bind(this);async followSet(e,r,n=3){const s=await this.follows(e,r,n);return new Set(Array.from(s).map(o=>o.pubkey))}tagReference(){return["p",this.pubkey]}referenceTags(e){const r=[["p",this.pubkey]];return e&&r[0].push("",e),r}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner(),await new NDKEvent(this.ndk,{kind:0,content:serializeProfile(this.profile)}).publish()}async follow(e,r,n=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),r||(r=await this.follows(void 0,void 0,n));const s=typeof e=="string"?e:e.pubkey;if(Array.from(r).some(u=>typeof u=="string"?u===s:u.pubkey===s))return!1;r.add(e);const c=new NDKEvent(this.ndk,{kind:n});for(const u of r)typeof u=="string"?c.tags.push(["p",u]):c.tag(u);return await c.publish(),!0}async unfollow(e,r,n=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),r||(r=await this.follows(void 0,void 0,n));const s=typeof e=="string"?e:e.pubkey,o=new Set;let c=!1;for(const f of r)(typeof f=="string"?f:f.pubkey)!==s?o.add(f):c=!0;if(!c)return!1;const u=new NDKEvent(this.ndk,{kind:n});for(const f of o)typeof f=="string"?u.tags.push(["p",f]):u.tag(f);return await u.publish()}async validateNip05(e){if(!this.ndk)throw new Error("No NDK instance found");const r=await getNip05For(this.ndk,e);return r===null?null:r.pubkey===this.pubkey}},signerRegistry=new Map;function registerSigner(t,e){signerRegistry.set(t,e)}var NDKPrivateKeySigner=class Fc{_user;_privateKey;_pubkey;constructor(e,r){if(typeof e=="string")if(e.startsWith("nsec1")){const{type:n,data:s}=nip19_exports$1.decode(e);if(n==="nsec")this._privateKey=s;else throw new Error("Invalid private key provided.")}else if(e.length===64)this._privateKey=hexToBytes$7(e);else throw new Error("Invalid private key provided.");else this._privateKey=e;this._pubkey=getPublicKey(this._privateKey),r&&(this._user=r.getUser({pubkey:this._pubkey})),this._user??=new NDKUser({pubkey:this._pubkey})}get privateKey(){if(!this._privateKey)throw new Error("Not ready");return bytesToHex$5(this._privateKey)}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}get nsec(){if(!this._privateKey)throw new Error("Not ready");return nip19_exports$1.nsecEncode(this._privateKey)}get npub(){if(!this._pubkey)throw new Error("Not ready");return nip19_exports$1.npubEncode(this._pubkey)}encryptToNcryptsec(e,r=16,n=2){if(!this._privateKey)throw new Error("Private key not available");return encrypt$1(this._privateKey,e,r,n)}static generate(){const e=generateSecretKey();return new Fc(e)}static fromNcryptsec(e,r,n){const s=decrypt$1(e,r);return new Fc(s,n)}async blockUntilReady(){return this._user}async user(){return this._user}get userSync(){return this._user}async sign(e){if(!this._privateKey)throw Error("Attempted to sign without a private key");return finalizeEvent(e,this._privateKey).sig}async encryptionEnabled(e){const r=[];return(!e||e==="nip04")&&r.push("nip04"),(!e||e==="nip44")&&r.push("nip44"),r}async encrypt(e,r,n){if(!this._privateKey||!this.privateKey)throw Error("Attempted to encrypt without a private key");const s=e.pubkey;if(n==="nip44"){const o=nip44_exports.v2.utils.getConversationKey(this._privateKey,s);return await nip44_exports.v2.encrypt(r,o)}return await nip04_exports.encrypt(this._privateKey,s,r)}async decrypt(e,r,n){if(!this._privateKey||!this.privateKey)throw Error("Attempted to decrypt without a private key");const s=e.pubkey;if(n==="nip44"){const o=nip44_exports.v2.utils.getConversationKey(this._privateKey,s);return await nip44_exports.v2.decrypt(r,o)}return await nip04_exports.decrypt(this._privateKey,s,r)}toPayload(){if(!this._privateKey)throw new Error("Private key not available");const e={type:"private-key",payload:this.privateKey};return JSON.stringify(e)}static async fromPayload(e,r){const n=JSON.parse(e);if(n.type!=="private-key")throw new Error(`Invalid payload type: expected 'private-key', got ${n.type}`);if(!n.payload||typeof n.payload!="string")throw new Error("Invalid payload content for private-key signer");return new Fc(n.payload,r)}};registerSigner("private-key",NDKPrivateKeySigner);function dedup(t,e){return t.created_at>e.created_at?t:e}async function getRelayListForUser(t,e){return(await getRelayListForUsers([t],e)).get(t)}async function getRelayListForUsers(t,e,r=!1,n=1e3,s){const o=e.outboxPool||e.pool,c=new Set;for(const y of o.relays.values())c.add(y);if(s)for(const y of s.values())for(const b of y){const R=o.getRelay(b,!0,!0);R&&c.add(R)}const u=new Map,f=new Map,x=new NDKRelaySet(c,e);if(e.cacheAdapter?.locking&&!r){const y=await e.fetchEvents({kinds:[3,10002],authors:Array.from(new Set(t))},{cacheUsage:"ONLY_CACHE",subId:"ndk-relay-list-fetch"});for(const b of y)b.kind===10002&&u.set(b.pubkey,NDKRelayList.from(b));for(const b of y)if(b.kind===3){if(u.has(b.pubkey))continue;const R=relayListFromKind3(e,b);R&&f.set(b.pubkey,R)}t=t.filter(b=>!u.has(b)&&!f.has(b))}if(t.length===0)return u;const p=new Map,g=new Map;return new Promise(y=>{let b=!1;(async()=>{const D={closeOnEose:!0,pool:o,groupable:!0,subId:"ndk-relay-list-fetch",addSinceFromCache:!0,relaySet:x};x&&(D.relaySet=x),e.subscribe({kinds:[3,10002],authors:t},D,{onEvent:O=>{if(O.kind===10002){const $e=p.get(O.pubkey);if($e&&$e.created_at>O.created_at)return;p.set(O.pubkey,O)}else if(O.kind===3){const $e=g.get(O.pubkey);if($e&&$e.created_at>O.created_at)return;g.set(O.pubkey,O)}},onEose:()=>{if(!b){b=!0,e.debug(`[getRelayListForUsers] EOSE - relayListEvents: ${p.size}, contactListEvents: ${g.size}`);for(const O of p.values())u.set(O.pubkey,NDKRelayList.from(O));for(const O of t){if(u.has(O))continue;const $e=g.get(O);if(!$e)continue;const ze=relayListFromKind3(e,$e);ze&&u.set(O,ze)}e.debug(`[getRelayListForUsers] Returning ${u.size} relay lists for ${t.length} pubkeys`),y(u)}}});const k=Array.from(c).some(O=>O.status<=2),Re=Array.from(c).some(O=>O.status===4);let Fe=n;(k||Re)&&(Fe=n+3e3),e.debug(`[getRelayListForUsers] Setting fallback timeout to ${Fe}ms (disconnected: ${k}, connecting: ${Re})`,{pubkeys:t}),setTimeout(()=>{b||(b=!0,e.debug(`[getRelayListForUsers] Timeout reached, returning ${u.size} relay lists`),y(u))},Fe)})()})}var OutboxItem=class{type;relayUrlScores;readRelays;writeRelays;constructor(t){this.type=t,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},OutboxTracker=class extends libExports.EventEmitter{data;ndk;debug;constructor(t){super(),this.ndk=t,this.debug=t.debug.extend("outbox-tracker"),this.data=new distExports$2.LRUCache({maxSize:1e5,entryExpirationTimeInMS:120*1e3})}async trackUsers(t,e=!1){const r=[];for(let n=0;n<t.length;n+=400){const s=t.slice(n,n+400),o=s.map(u=>getKeyFromItem(u)).filter(u=>!this.data.has(u));if(o.length===0)continue;for(const u of o)this.data.set(u,new OutboxItem("user"));const c=new Map;for(const u of s)u instanceof NDKUser&&u.relayUrls.length>0&&c.set(u.pubkey,u.relayUrls);r.push(new Promise(u=>{getRelayListForUsers(o,this.ndk,e,1e3,c).then(f=>{this.debug(`Received relay lists for ${f.size} pubkeys out of ${o.length} requested`);for(const[x,p]of f){let g=this.data.get(x);if(g??=new OutboxItem("user"),p){if(g.readRelays=new Set(normalize(p.readRelayUrls)),g.writeRelays=new Set(normalize(p.writeRelayUrls)),this.ndk.relayConnectionFilter){for(const y of g.readRelays)this.ndk.relayConnectionFilter(y)||g.readRelays.delete(y);for(const y of g.writeRelays)this.ndk.relayConnectionFilter(y)||g.writeRelays.delete(y)}this.data.set(x,g),this.emit("user:relay-list-updated",x,g),this.debug(`Adding ${g.readRelays.size} read relays and ${g.writeRelays.size} write relays for ${x}`,p?.rawEvent())}}}).finally(u)}))}return Promise.all(r)}track(t,e,r=!0){const n=getKeyFromItem(t);e??=getTypeFromItem(t);let s=this.data.get(n);return s||(s=new OutboxItem(e),t instanceof NDKUser&&this.trackUsers([t])),s}};function getKeyFromItem(t){return t instanceof NDKUser?t.pubkey:t}function getTypeFromItem(t){return t instanceof NDKUser?"user":"kind"}function correctRelaySet(t,e){const r=e.connectedRelays();if(!Array.from(t.relays).some(s=>r.map(o=>o.url).includes(s.url)))for(const s of r)t.addRelay(s);if(r.length===0)for(const s of e.relays.values())t.addRelay(s);return t}var NDKSubscriptionManager=class{subscriptions;seenEvents=new distExports$2.LRUCache({maxSize:1e4,entryExpirationTimeInMS:300*1e3});constructor(){this.subscriptions=new Map}add(t){this.subscriptions.set(t.internalId,t),t.onStopped,t.onStopped=()=>{this.subscriptions.delete(t.internalId)},t.on("close",()=>{this.subscriptions.delete(t.internalId)})}seenEvent(t,e){const r=this.seenEvents.get(t)||[];r.some(n=>n.url===e.url)||r.push(e),this.seenEvents.set(t,r)}dispatchEvent(t,e,r=!1){e&&this.seenEvent(t.id,e);const n=this.subscriptions.values(),s=[];for(const o of n)matchFilters(o.filters,t)&&s.push(o);for(const o of s){if(o.exclusiveRelay&&o.relaySet){let c=!1;if(r?c=!o.skipOptimisticPublishEvent:e?c=o.relaySet.relays.has(e):c=(this.seenEvents.get(t.id)||[]).some(f=>o.relaySet.relays.has(f)),!c){o.debug.extend("exclusive-relay")("Rejected event %s from %s (relay not in exclusive set)",t.id,e?.url||(r?"optimistic":"cache"));continue}}o.eventReceived(t,e,!1,r)}}},debug6=createDebug5("ndk:active-user");async function getUserRelayList(t){if(!this.autoConnectUserRelays)return;const e=await getRelayListForUser(t.pubkey,this);if(e){for(const r of e.relays){let n=this.pool.relays.get(r);n||(n=new NDKRelay(r,this.relayAuthDefaultPolicy,this),this.pool.addRelay(n))}return debug6("Connected to %d user relays",e.relays.length),e}}async function setActiveUser(t){if(!this.autoConnectUserRelays)return;const e=this.outboxPool||this.pool;e.connectedRelays.length>0?await getUserRelayList.call(this,t):e.once("connect",async()=>{await getUserRelayList.call(this,t)})}function getEntity(t){try{const e=nip19_exports$1.decode(t);return e.type==="npub"?npub(this,e.data):e.type==="nprofile"?nprofile(this,e.data):e}catch{return null}}function npub(t,e){return t.getUser({pubkey:e})}function nprofile(t,e){const r=t.getUser({pubkey:e.pubkey});return e.relays&&(r.relayUrls=e.relays),r}function isValidHint(t){if(!t||t==="")return!1;try{return new URL(t),!0}catch{return!1}}async function fetchEventFromTag(t,e,r,n={type:"timeout"}){const s=this.debug.extend("fetch-event-from-tag"),[o,c,u]=t;r={},s("fetching event from tag",t,r,n);const f=getRelaysForSync(this,e.pubkey);if(f&&f.size>0){s("fetching event from author relays %o",Array.from(f));const D=NDKRelaySet.fromRelayUrls(Array.from(f),this),k=await this.fetchEvent(c,r,D);if(k)return k}else s("no author relays found for %s",e.pubkey,e);const x=calculateRelaySetsFromFilters(this,[{ids:[c]}],this.pool);s("fetching event without relay hint",x);const p=await this.fetchEvent(c,r);if(p)return p;if(u&&u!==""){const D=await this.fetchEvent(c,r,this.pool.getRelay(u,!0,!0,[{ids:[c]}]));if(D)return D}let g;const y=isValidHint(u)?this.pool.getRelay(u,!1,!0,[{ids:[c]}]):void 0,b=new Promise(D=>{this.fetchEvent(c,r,y).then(D)});if(!isValidHint(u)||n.type==="none")return b;const R=new Promise(async D=>{const k=n.relaySet,Re=n.timeout??1500,Fe=new Promise(O=>setTimeout(O,Re));if(n.type==="timeout"&&await Fe,g)D(g);else{s("fallback fetch triggered");const O=await this.fetchEvent(c,r,k);D(O)}});switch(n.type){case"timeout":return Promise.race([b,R]);case"eose":return g=await b,g||R}}var Queue=class{queue=[];maxConcurrency;processing=new Set;promises=new Map;constructor(t,e){this.maxConcurrency=e}add(t){if(this.promises.has(t.id))return this.promises.get(t.id);const e=new Promise((r,n)=>{this.queue.push({...t,func:()=>t.func().then(s=>(r(s),s),s=>{throw n(s),s})}),this.process()});return this.promises.set(t.id,e),e.finally(()=>{this.promises.delete(t.id),this.processing.delete(t.id),this.process()}),e}process(){if(this.processing.size>=this.maxConcurrency||this.queue.length===0)return;const t=this.queue.shift();!t||this.processing.has(t.id)||(this.processing.add(t.id),t.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},DEFAULT_OUTBOX_RELAYS=["wss://purplepag.es/","wss://nos.lol/"],NDK=class extends libExports.EventEmitter{_explicitRelayUrls;pool;outboxPool;_signer;_activeUser;cacheAdapter;debug;devWriteRelaySet;outboxTracker;muteFilter;relayConnectionFilter;clientName;clientNip89;queuesZapConfig;queuesNip05;asyncSigVerification=!1;initialValidationRatio=1;lowestValidationRatio=.1;validationRatioFn;filterValidationMode="validate";subManager;aiGuardrails;_signatureVerificationFunction;_signatureVerificationWorker;signatureVerificationTimeMs=0;publishingFailureHandled=!1;pools=[];relayAuthDefaultPolicy;httpFetch;netDebug;autoConnectUserRelays=!0;_wallet;walletConfig;constructor(t={}){super(),this.debug=t.debug||createDebug5("ndk"),this.netDebug=t.netDebug,this._explicitRelayUrls=t.explicitRelayUrls||[],this.subManager=new NDKSubscriptionManager,this.pool=new NDKPool(t.explicitRelayUrls||[],this),this.pool.name="Main",this.pool.on("relay:auth",async(e,r)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(e,r)}),this.autoConnectUserRelays=t.autoConnectUserRelays??!0,this.clientName=t.clientName,this.clientNip89=t.clientNip89,this.relayAuthDefaultPolicy=t.relayAuthDefaultPolicy,t.enableOutboxModel!==!1&&(this.outboxPool=new NDKPool(t.outboxRelayUrls||DEFAULT_OUTBOX_RELAYS,this,{debug:this.debug.extend("outbox-pool"),name:"Outbox Pool"}),this.outboxTracker=new OutboxTracker(this),this.outboxTracker.on("user:relay-list-updated",(e,r)=>{this.debug(`Outbox relay list updated for ${e}`);for(const n of this.subManager.subscriptions.values())n.filters.some(o=>o.authors?.includes(e))&&typeof n.refreshRelayConnections=="function"&&(this.debug(`Refreshing relay connections for subscription ${n.internalId}`),n.refreshRelayConnections())})),this.signer=t.signer,this.cacheAdapter=t.cacheAdapter,this.muteFilter=t.muteFilter,this.relayConnectionFilter=t.relayConnectionFilter,t.devWriteRelayUrls&&(this.devWriteRelaySet=NDKRelaySet.fromRelayUrls(t.devWriteRelayUrls,this)),this.queuesZapConfig=new Queue("zaps",3),this.queuesNip05=new Queue("nip05",10),t.signatureVerificationWorker&&(this.signatureVerificationWorker=t.signatureVerificationWorker),t.signatureVerificationFunction&&(this.signatureVerificationFunction=t.signatureVerificationFunction),this.initialValidationRatio=t.initialValidationRatio||1,this.lowestValidationRatio=t.lowestValidationRatio||.1,this.validationRatioFn=t.validationRatioFn||this.defaultValidationRatioFn,this.filterValidationMode=t.filterValidationMode||"validate",this.aiGuardrails=new AIGuardrails(t.aiGuardrails||!1),this.aiGuardrails.ndkInstantiated(this);try{this.httpFetch=fetch}catch{}}set explicitRelayUrls(t){this._explicitRelayUrls=t.map(normalizeRelayUrl),this.pool.relayUrls=t}get explicitRelayUrls(){return this._explicitRelayUrls||[]}set signatureVerificationWorker(t){this._signatureVerificationWorker=t,t?(signatureVerificationInit(t),this.asyncSigVerification=!0):this.asyncSigVerification=!1}set signatureVerificationFunction(t){this._signatureVerificationFunction=t,this.asyncSigVerification=!!t}get signatureVerificationFunction(){return this._signatureVerificationFunction}addExplicitRelay(t,e,r=!0){let n;return typeof t=="string"?n=new NDKRelay(t,e,this):n=t,this.pool.addRelay(n,r),this.explicitRelayUrls?.push(n.url),n}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(t){const e=this._activeUser?.pubkey!==t?.pubkey;this._activeUser=t,e&&this.emit("activeUser:change",t),t&&e&&setActiveUser.call(this,t)}get signer(){return this._signer}set signer(t){this._signer=t,t&&this.emit("signer:ready",t),t?.user().then(e=>{e.ndk=this,this.activeUser=e})}async connect(t){this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await this._signer.relays?.(this)),this._signer.relays&&(await this._signer.relays(this)).forEach(n=>this.pool.addRelay(n)));const e=[this.pool.connect(t)];return this.outboxPool&&e.push(this.outboxPool.connect(t)),this.cacheAdapter?.initializeAsync&&e.push(this.cacheAdapter.initializeAsync(this)),Promise.allSettled(e).then(()=>{})}reportInvalidSignature(t,e){this.debug(`Invalid signature detected for event ${t.id}${e?` from relay ${e.url}`:""}`),this.emit("event:invalid-sig",t,e)}defaultValidationRatioFn(t,e,r){if(e<10)return this.initialValidationRatio;const n=Math.min(e/100,1),s=this.initialValidationRatio*(1-n)+this.lowestValidationRatio*n;return Math.max(s,this.lowestValidationRatio)}getUser(t){if(typeof t=="string")if(t.startsWith("npub1")){const{type:r,data:n}=nip19_exports$1.decode(t);if(r!=="npub")throw new Error(`Invalid npub: ${t}`);return this.getUser({pubkey:n})}else if(t.startsWith("nprofile1")){const{type:r,data:n}=nip19_exports$1.decode(t);if(r!=="nprofile")throw new Error(`Invalid nprofile: ${t}`);return this.getUser({pubkey:n.pubkey,relayUrls:n.relays})}else return this.getUser({pubkey:t});const e=new NDKUser(t);return e.ndk=this,e}async getUserFromNip05(t,e=!1){return NDKUser.fromNip05(t,this,e)}async fetchUser(t,e=!1){if(isValidNip05(t))return NDKUser.fromNip05(t,this,e);if(t.startsWith("npub1")){const{type:r,data:n}=nip19_exports$1.decode(t);if(r!=="npub")throw new Error(`Invalid npub: ${t}`);const s=new NDKUser({pubkey:n});return s.ndk=this,s}else if(t.startsWith("nprofile1")){const{type:r,data:n}=nip19_exports$1.decode(t);if(r!=="nprofile")throw new Error(`Invalid nprofile: ${t}`);const s=new NDKUser({pubkey:n.pubkey,relayUrls:n.relays});return s.ndk=this,s}else{const r=new NDKUser({pubkey:t});return r.ndk=this,r}}subscribe(t,e,r=!0,n=!0){let s=e?.relaySet,o=n;r instanceof NDKRelaySet?(console.warn("relaySet is deprecated, use opts.relaySet instead. This will be removed in version v2.14.0"),s=r,o=n):(typeof r=="boolean"||typeof r=="object")&&(o=r);let c;const u={relaySet:s,...e};o&&typeof o=="object"&&(o.onEvent&&(u.onEvent=o.onEvent),o.onEose&&(u.onEose=o.onEose),o.onClose&&(u.onClose=o.onClose),o.onEvents&&(c=o.onEvents));const f=new NDKSubscription(this,t,u);this.subManager.add(f),this.aiGuardrails?.subscription?.created(Array.isArray(t)?t:[t],u);const x=f.pool;if(f.relaySet)for(const p of f.relaySet.relays)x.useTemporaryRelay(p,void 0,f.filters);if(this.outboxPool&&f.hasAuthorsFilter()){const p=f.filters.filter(g=>g.authors&&g.authors?.length>0).flatMap(g=>g.authors);this.outboxTracker?.trackUsers(p)}return o&&setTimeout(async()=>{this.cacheAdapter?.initializeAsync&&!this.cacheAdapter.ready&&await this.cacheAdapter.initializeAsync(this);const p=f.start(!c);p&&p.length>0&&c&&c(p)},0),f}fetchEventFromTag=fetchEventFromTag.bind(this);fetchEventSync(t){if(!this.cacheAdapter)throw new Error("Cache adapter not set");let e;typeof t=="string"?e=[filterFromId(t)]:e=t;const r=new NDKSubscription(this,e),n=this.cacheAdapter.query(r);if(n instanceof Promise)throw new Error("Cache adapter is async");return n.map(s=>(s.ndk=this,s))}async fetchEvent(t,e,r){let n,s;if(r instanceof NDKRelay?s=new NDKRelaySet(new Set([r]),this):r instanceof NDKRelaySet&&(s=r),!r&&typeof t=="string"&&!isNip33AValue(t)){const o=relaysFromBech32(t,this);o.length>0&&(s=new NDKRelaySet(new Set(o),this),s=correctRelaySet(s,this.pool))}if(typeof t=="string"?n=[filterFromId(t)]:Array.isArray(t)?n=t:n=[t],typeof t!="string"&&this.aiGuardrails?.ndk?.fetchingEvents(n),n.length===0)throw new Error(`Invalid filter: ${JSON.stringify(t)}`);return new Promise((o,c)=>{let u=null;const f={...e||{},closeOnEose:!0};s&&(f.relaySet=s);const x=setTimeout(()=>{p.stop(),this.aiGuardrails._nextCallDisabled=null,o(u)},1e4),p=this.subscribe(n,f,{onEvent:g=>{g.ndk=this,g.isReplaceable()?(!u||u.created_at<g.created_at)&&(u=g):(clearTimeout(x),this.aiGuardrails._nextCallDisabled=null,o(g))},onEose:()=>{clearTimeout(x),this.aiGuardrails._nextCallDisabled=null,o(u)}})})}async fetchEvents(t,e,r){return this.aiGuardrails?.ndk?.fetchingEvents(t,e),new Promise(n=>{const s=new Map,o={...e||{},closeOnEose:!0};r&&(o.relaySet=r);const c=u=>{let f;u instanceof NDKEvent?f=u:f=new NDKEvent(void 0,u);const x=f.deduplicationKey(),p=s.get(x);p&&(f=dedup(p,f)),f.ndk=this,s.set(x,f)};this.subscribe(t,{...o,onEvent:c,onEose:()=>{this.aiGuardrails._nextCallDisabled=null,n(new Set(s.values()))}})})}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}getEntity=getEntity.bind(this);guardrailOff(t){return t?typeof t=="string"?this.aiGuardrails._nextCallDisabled=new Set([t]):this.aiGuardrails._nextCallDisabled=new Set(t):this.aiGuardrails._nextCallDisabled="all",this}set wallet(t){if(!t){this._wallet=void 0,this.walletConfig=void 0;return}this._wallet=t,this.walletConfig??={},this.walletConfig.lnPay=t?.lnPay?.bind(t),this.walletConfig.cashuPay=t?.cashuPay?.bind(t)}get wallet(){return this._wallet}},nip19_exports={};__reExport(nip19_exports,nip19_star);var nip49_exports={};__reExport(nip49_exports,nip49_star);function disconnect(t,e){return e??=createDebug5("ndk:relay:auth-policies:disconnect"),async r=>{e?.(`Relay ${r.url} requested authentication, disconnecting`),t.removeRelay(r.url)}}async function signAndAuth(t,e,r,n,s,o){try{await t.sign(r),s(t)}catch(c){n?.(`Failed to publish auth event to relay ${e.url}`,c),o(t)}}function signIn({ndk:t,signer:e,debug:r}={}){return r??=createDebug5("ndk:auth-policies:signIn"),async(n,s)=>{r?.(`Relay ${n.url} requested authentication, signing in`);const o=new NDKEvent(t);return o.kind=22242,o.tags=[["relay",n.url],["challenge",s]],e??=t?.signer,new Promise(async(c,u)=>{e?await signAndAuth(o,n,e,r,c,u):t?.once("signer:ready",async f=>{await signAndAuth(o,n,f,r,c,u)})})}}var NDKRelayAuthPolicies={disconnect,signIn};async function ndkSignerFromPayload(t,e){let r;try{r=JSON.parse(t)}catch(s){console.error("Failed to parse signer payload string",t,s);return}if(!r||typeof r.type!="string"){console.error("Failed to parse signer payload string",t,new Error("Missing type field"));return}const n=signerRegistry.get(r.type);if(!n)throw new Error(`Unknown signer type: ${r.type}`);try{return await n.fromPayload(t,e)}catch(s){const o=s instanceof Error?s.message:String(s);throw new Error(`Failed to deserialize signer type ${r.type}: ${o}`)}}var NDKNip07Signer=class lh{_userPromise;encryptionQueue=[];encryptionProcessing=!1;debug;waitTimeout;_pubkey;ndk;_user;constructor(e=1e3,r){this.debug=createDebug5("ndk:nip07"),this.waitTimeout=e,this.ndk=r}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}async blockUntilReady(){await this.waitForExtension();const e=await window.nostr?.getPublicKey();if(!e)throw new Error("User rejected access");this._pubkey=e;let r;return this.ndk?r=this.ndk.getUser({pubkey:e}):r=new NDKUser({pubkey:e}),this._user=r,r}async user(){return this._userPromise||(this._userPromise=this.blockUntilReady()),this._userPromise}get userSync(){if(!this._user)throw new Error("User not ready");return this._user}async sign(e){await this.waitForExtension();const r=await window.nostr?.signEvent(e);if(!r)throw new Error("Failed to sign event");return r.sig}async relays(e){await this.waitForExtension();const r=await window.nostr?.getRelays?.()||{},n=[];for(const s of Object.keys(r))r[s].read&&r[s].write&&n.push(s);return n.map(s=>new NDKRelay(s,e?.relayAuthDefaultPolicy,e))}async encryptionEnabled(e){const r=[];return(!e||e==="nip04")&&window.nostr?.nip04&&r.push("nip04"),(!e||e==="nip44")&&window.nostr?.nip44&&r.push("nip44"),r}async encrypt(e,r,n="nip04"){if(!await this.encryptionEnabled(n))throw new Error(`${n}encryption is not available from your browser extension`);await this.waitForExtension();const s=e.pubkey;return this.queueEncryption(n,"encrypt",s,r)}async decrypt(e,r,n="nip04"){if(!await this.encryptionEnabled(n))throw new Error(`${n}encryption is not available from your browser extension`);await this.waitForExtension();const s=e.pubkey;return this.queueEncryption(n,"decrypt",s,r)}async queueEncryption(e,r,n,s){return new Promise((o,c)=>{this.encryptionQueue.push({scheme:e,method:r,counterpartyHexpubkey:n,value:s,resolve:o,reject:c}),this.encryptionProcessing||this.processEncryptionQueue()})}async processEncryptionQueue(e,r=0){if(!e&&this.encryptionQueue.length===0){this.encryptionProcessing=!1;return}this.encryptionProcessing=!0;const n=e||this.encryptionQueue.shift();if(!n){this.encryptionProcessing=!1;return}const{scheme:s,method:o,counterpartyHexpubkey:c,value:u,resolve:f,reject:x}=n;this.debug("Processing encryption queue item",{method:o,counterpartyHexpubkey:c,value:u});try{const p=await window.nostr?.[s]?.[o](c,u);if(!p)throw new Error("Failed to encrypt/decrypt");f(p)}catch(p){const g=p instanceof Error?p.message:String(p);if(g.includes("call already executing")&&r<5){this.debug("Retrying encryption queue item",{method:o,counterpartyHexpubkey:c,value:u,retries:r}),setTimeout(()=>{this.processEncryptionQueue(n,r+1)},50*r);return}x(p instanceof Error?p:new Error(g))}this.processEncryptionQueue()}waitForExtension(){return new Promise((e,r)=>{if(window.nostr){e();return}let n;const s=setInterval(()=>{window.nostr&&(clearTimeout(n),clearInterval(s),e())},100);n=setTimeout(()=>{clearInterval(s),r(new Error("NIP-07 extension not available"))},this.waitTimeout)})}toPayload(){return JSON.stringify({type:"nip07",payload:""})}static async fromPayload(e,r){const n=JSON.parse(e);if(n.type!=="nip07")throw new Error(`Invalid payload type: expected 'nip07', got ${n.type}`);return new lh(void 0,r)}};registerSigner("nip07",NDKNip07Signer);var NDKNostrRpc=class extends libExports.EventEmitter{ndk;signer;relaySet;debug;encryptionType="nip04";pool;constructor(t,e,r,n){if(super(),this.ndk=t,this.signer=e,n){this.pool=new NDKPool(n,t,{debug:r.extend("rpc-pool"),name:"Nostr RPC"}),this.relaySet=new NDKRelaySet(new Set,t,this.pool);for(const s of n){const o=this.pool.getRelay(s,!1,!1);o.authPolicy=NDKRelayAuthPolicies.signIn({ndk:t,signer:e,debug:r}),this.relaySet.addRelay(o),o.connect()}}this.debug=r.extend("rpc")}subscribe(t){return new Promise(e=>{const r=this.ndk.subscribe(t,{closeOnEose:!1,groupable:!1,cacheUsage:"ONLY_RELAY",pool:this.pool,relaySet:this.relaySet,onEvent:async n=>{try{const s=await this.parseEvent(n);s.method?this.emit("request",s):(this.emit(`response-${s.id}`,s),this.emit("response",s))}catch(s){this.debug("error parsing event",s,n.rawEvent())}},onEose:()=>{this.debug("eosed"),e(r)}})})}async parseEvent(t){this.encryptionType==="nip44"&&t.content.includes("?iv=")?this.encryptionType="nip04":this.encryptionType==="nip04"&&!t.content.includes("?iv=")&&(this.encryptionType="nip44");const e=this.ndk.getUser({pubkey:t.pubkey});e.ndk=this.ndk;let r;try{r=await this.signer.decrypt(e,t.content,this.encryptionType)}catch{const p=this.encryptionType==="nip04"?"nip44":"nip04";r=await this.signer.decrypt(e,t.content,p),this.encryptionType=p}const n=JSON.parse(r),{id:s,method:o,params:c,result:u,error:f}=n;return o?{id:s,pubkey:t.pubkey,method:o,params:c,event:t}:{id:s,result:u,error:f,event:t}}async sendResponse(t,e,r,n=24133,s){const o={id:t,result:r};s&&(o.error=s);const c=await this.signer.user(),u=this.ndk.getUser({pubkey:e}),f=new NDKEvent(this.ndk,{kind:n,content:JSON.stringify(o),tags:[["p",e]],pubkey:c.pubkey});f.content=await this.signer.encrypt(u,f.content,this.encryptionType),await f.sign(this.signer),await f.publish(this.relaySet)}async sendRequest(t,e,r=[],n=24133,s){const o=Math.random().toString(36).substring(7),c=await this.signer.user(),u=this.ndk.getUser({pubkey:t}),f={id:o,method:e,params:r},x=new Promise(()=>{const g=y=>{y.result==="auth_url"?(this.once(`response-${o}`,g),this.emit("authUrl",y.error)):s&&s(y)};this.once(`response-${o}`,g)}),p=new NDKEvent(this.ndk,{kind:n,content:JSON.stringify(f),tags:[["p",t]],pubkey:c.pubkey});return p.content=await this.signer.encrypt(u,p.content,this.encryptionType),await p.sign(this.signer),await p.publish(this.relaySet),x}};function nostrConnectGenerateSecret(){return Math.random().toString(36).substring(2,15)}function generateNostrConnectUri(t,e,r,n){const s={name:n?.name?encodeURIComponent(n.name):"",url:n?.url?encodeURIComponent(n.url):"",image:n?.image?encodeURIComponent(n.image):"",perms:n?.perms?encodeURIComponent(n.perms):""};let o=`nostrconnect://${t}?image=${s.image}&url=${s.url}&name=${s.name}&perms=${s.perms}&secret=${encodeURIComponent(e)}`;return r&&(o+=`&relay=${encodeURIComponent(r)}`),o}var NDKNip46Signer=class Tc extends libExports.EventEmitter{ndk;_user;bunkerPubkey;userPubkey;get pubkey(){if(!this.userPubkey)throw new Error("Not ready");return this.userPubkey}secret;localSigner;nip05;rpc;debug;relayUrls;subscription;nostrConnectUri;nostrConnectSecret;constructor(e,r,n,s,o){super(),this.ndk=e,this.debug=e.debug.extend("nip46:signer"),this.relayUrls=s,n?typeof n=="string"?this.localSigner=new NDKPrivateKeySigner(n):this.localSigner=n:this.localSigner=NDKPrivateKeySigner.generate(),r===!1||(r?r.startsWith("bunker://")?this.bunkerFlowInit(r):this.nip05Init(r):this.nostrconnectFlowInit(o)),this.rpc=new NDKNostrRpc(this.ndk,this.localSigner,this.debug,this.relayUrls)}static bunker(e,r,n){return new Tc(e,r,n)}static nostrconnect(e,r,n,s){return new Tc(e,void 0,n,[r],s)}nostrconnectFlowInit(e){this.nostrConnectSecret=nostrConnectGenerateSecret();const r=this.localSigner.pubkey;this.nostrConnectUri=generateNostrConnectUri(r,this.nostrConnectSecret,this.relayUrls?.[0],e)}bunkerFlowInit(e){const r=new URL(e),n=r.hostname||r.pathname.replace(/^\/\//,""),s=r.searchParams.get("pubkey"),o=r.searchParams.getAll("relay"),c=r.searchParams.get("secret");this.bunkerPubkey=n,this.userPubkey=s,this.relayUrls=o,this.secret=c}nip05Init(e){this.nip05=e}async startListening(){if(this.subscription)return;const e=await this.localSigner.user();if(!e)throw new Error("Local signer not ready");this.subscription=await this.rpc.subscribe({kinds:[24133],"#p":[e.pubkey]})}async user(){return this._user?this._user:this.blockUntilReady()}get userSync(){if(!this._user)throw new Error("Remote user not ready synchronously");return this._user}async blockUntilReadyNostrConnect(){return new Promise((e,r)=>{const n=s=>{s.result===this.nostrConnectSecret&&(this._user=s.event.author,this.userPubkey=s.event.pubkey,this.bunkerPubkey=s.event.pubkey,this.rpc.off("response",n),e(this._user))};this.startListening(),this.rpc.on("response",n)})}async blockUntilReady(){if(!this.bunkerPubkey&&!this.nostrConnectSecret&&!this.nip05)throw new Error("Bunker pubkey not set");if(this.nostrConnectSecret)return this.blockUntilReadyNostrConnect();if(this.nip05&&!this.userPubkey){const e=await NDKUser.fromNip05(this.nip05,this.ndk);e&&(this._user=e,this.userPubkey=e.pubkey,this.relayUrls=e.nip46Urls,this.rpc=new NDKNostrRpc(this.ndk,this.localSigner,this.debug,this.relayUrls))}if(!this.bunkerPubkey&&this.userPubkey)this.bunkerPubkey=this.userPubkey;else if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");return await this.startListening(),this.rpc.on("authUrl",(...e)=>{this.emit("authUrl",...e)}),new Promise((e,r)=>{const n=[this.userPubkey??""];if(this.secret&&n.push(this.secret),!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"connect",n,24133,s=>{s.result==="ack"?this.getPublicKey().then(o=>{this.userPubkey=o,this._user=this.ndk.getUser({pubkey:o}),e(this._user)}):r(s.error)})})}stop(){this.subscription?.stop(),this.subscription=void 0}async getPublicKey(){return this.userPubkey?this.userPubkey:new Promise((e,r)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"get_public_key",[],24133,n=>{e(n.result)})})}async encryptionEnabled(e){return e?[e]:Promise.resolve(["nip04","nip44"])}async encrypt(e,r,n="nip04"){return this.encryption(e,r,n,"encrypt")}async decrypt(e,r,n="nip04"){return this.encryption(e,r,n,"decrypt")}async encryption(e,r,n,s){return new Promise((c,u)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,`${n}_${s}`,[e.pubkey,r],24133,f=>{f.error?u(f.error):c(f.result)})})}async sign(e){return new Promise((n,s)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"sign_event",[JSON.stringify(e)],24133,o=>{if(o.error)s(o.error);else{const c=JSON.parse(o.result);n(c.sig)}})})}async createAccount(e,r,n){await this.startListening();const s=[];return e&&s.push(e),r&&s.push(r),n&&s.push(n),new Promise((o,c)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"create_account",s,24133,u=>{if(u.error)c(u.error);else{const f=u.result;o(f)}})})}toPayload(){if(!this.bunkerPubkey||!this.userPubkey)throw new Error("NIP-46 signer is not fully initialized for serialization");const e={type:"nip46",payload:{bunkerPubkey:this.bunkerPubkey,userPubkey:this.userPubkey,relayUrls:this.relayUrls,secret:this.secret,localSignerPayload:this.localSigner.toPayload(),nip05:this.nip05||null}};return JSON.stringify(e)}static async fromPayload(e,r){if(!r)throw new Error("NDK instance is required to deserialize NIP-46 signer");const n=JSON.parse(e);if(n.type!=="nip46")throw new Error(`Invalid payload type: expected 'nip46', got ${n.type}`);const s=n.payload;if(!s||typeof s!="object"||!s.localSignerPayload)throw new Error("Invalid payload content for nip46 signer");const o=await ndkSignerFromPayload(s.localSignerPayload,r);if(!o)throw new Error("Failed to deserialize local signer for NIP-46");if(!(o instanceof NDKPrivateKeySigner))throw new Error("Local signer must be an instance of NDKPrivateKeySigner");let c;return c=new Tc(r,!1,o,s.relayUrls),c.userPubkey=s.userPubkey,c.bunkerPubkey=s.bunkerPubkey,c.relayUrls=s.relayUrls,c.secret=s.secret,s.userPubkey&&(c._user=new NDKUser({pubkey:s.userPubkey}),c._user&&(c._user.ndk=r)),c}};registerSigner("nip46",NDKNip46Signer);createDebug5("ndk:zapper:ln");createDebug5("ndk:zapper");const index$1=Object.freeze(Object.defineProperty({__proto__:null,BECH32_REGEX,NDKAppHandlerEvent,NDKArticle,NDKBlossomList,NDKCashuMintAnnouncement,NDKCashuMintList,NDKClassified,NDKDVMJobFeedback,NDKDraft,NDKEvent,NDKFedimintMint,NDKFollowPack,NDKHighlight,NDKImage,NDKList,NDKMintRecommendation,NDKNip07Signer,NDKNip46Signer,NDKNostrRpc,NDKNutzap,NDKPool,NDKPrivateKeySigner,NDKProject,NDKProjectTemplate,NDKPublishError,NDKRelay,NDKRelayAuthPolicies,NDKRelayList,NDKRelaySet,NDKRelayStatus,NDKRepost,NDKSimpleGroupMemberList,NDKSimpleGroupMetadata,NDKStory,NDKStorySticker,NDKSubscription,NDKSubscriptionReceipt,NDKSubscriptionStart,NDKSubscriptionTier,NDKTask,NDKThread,NDKUser,NDKVideo,NDKWiki,NDKWikiMergeRequest,NIP33_A_REGEX,calculateRelaySetFromEvent,default:NDK,defaultOpts,deserialize,eventHasETagMarkers,fetchRelayInformation,filterFingerprint,filterFromId,generateContentTags,generateHashtags,getRelayListForUser,getRelayListForUsers,getReplyTag,getRootTag,imetaTagToTag,isNip33AValue,isValidHex64,isValidNip05,isValidPubkey,mapImetaTag,mergeFilters,mergeTags,ndkSignerFromPayload,newAmount,nip19:nip19_exports,nip49:nip49_exports,normalize,normalizeRelayUrl,normalizeUrl,parseTagToSubscriptionAmount,possibleIntervalFrequencies,processFilters,profileFromEvent,queryFullyFilled,registerSigner,relayListFromKind3,relaysFromBech32,serialize,serializeProfile,strToDimension,strToPosition,tryNormalizeRelayUrl,wrapEvent},Symbol.toStringTag,{value:"Module"})),DEFAULT_RELAYS=[{url:"wss://relay.primal.net",status:"disconnected",failedAttempts:0},{url:"wss://relay.damus.io",status:"disconnected",failedAttempts:0},{url:"wss://nos.lol",status:"disconnected",failedAttempts:0}],useRelayStore=create()(persist((t,e)=>({relays:DEFAULT_RELAYS,addRelay:r=>{const n=r.trim();if(!n.startsWith("wss://")&&!n.startsWith("ws://")){console.error("[RelayStore] Invalid relay URL:",r);return}if(e().relays.find(o=>o.url===n)){console.warn("[RelayStore] Relay already exists:",n);return}t(o=>({relays:[...o.relays,{url:n,status:"disconnected",failedAttempts:0}]}))},removeRelay:r=>{t(n=>({relays:n.relays.filter(s=>s.url!==r)}))},updateRelayStatus:(r,n)=>{t(s=>({relays:s.relays.map(o=>o.url===r?{...o,status:n,lastConnected:n==="connected"?Date.now():o.lastConnected}:o)}))},incrementFailedAttempts:r=>{t(n=>({relays:n.relays.map(s=>s.url===r?{...s,failedAttempts:s.failedAttempts+1}:s)}))},resetFailedAttempts:r=>{t(n=>({relays:n.relays.map(s=>s.url===r?{...s,failedAttempts:0}:s)}))},getRelay:r=>e().relays.find(n=>n.url===r),isOnline:()=>e().relays.some(r=>r.status==="connected")}),{name:"amber-relays",storage:createJSONStorage(()=>({getItem:async t=>{const{storage:e}=await __vitePreload(async()=>{const{storage:r}=await import("./storage-D7x1dBXQ.js");return{storage:r}},[],import.meta.url);return e.getItem(t)},setItem:async(t,e)=>{const{storage:r}=await __vitePreload(async()=>{const{storage:n}=await import("./storage-D7x1dBXQ.js");return{storage:n}},[],import.meta.url);return r.setItem(t,e)},removeItem:async t=>{const{storage:e}=await __vitePreload(async()=>{const{storage:r}=await import("./storage-D7x1dBXQ.js");return{storage:r}},[],import.meta.url);return e.removeItem(t)}}))})),BroadcastModal=({eventJson:t,onClose:e,onBroadcast:r,onSuccess:n})=>{const[s,o]=reactExports.useState(!1),[c,u]=reactExports.useState(!1),[f,x]=reactExports.useState(null),[p,g]=reactExports.useState(null),[y,b]=reactExports.useState(!1),[R,D]=reactExports.useState(!1),k=()=>{try{const Fe=nip19_exports$1.npubEncode(t.pubkey);navigator.clipboard.writeText(Fe),D(!0),setTimeout(()=>D(!1),2e3)}catch(Fe){console.error(Fe)}};React.useEffect(()=>{(async()=>{if(t.pubkey){b(!0);try{const O=useRelayStore.getState().relays.map($e=>$e.url);if(O.length>0){const $e=new NDK({explicitRelayUrls:O});await $e.connect();const ze=$e.getUser({hexpubkey:t.pubkey});await ze.fetchProfile(),ze.profile&&g(ze.profile)}}catch(O){console.error("Failed to fetch profile",O)}finally{b(!1)}}})()},[t.pubkey]);const Re=async()=>{o(!0),x(null);try{await r(),u(!0),n?.(),setTimeout(e,2e3)}catch(Fe){x(Fe.message),o(!1)}};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 overflow-y-auto",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-md w-full border border-slate-800 shadow-2xl my-8 animate-in fade-in zoom-in duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-slate-800 rounded-full",children:jsxRuntimeExports.jsx(Radio,{className:"w-6 h-6 text-green-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Broadcast Event"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-400",children:"Publish to relays"})]})]}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-2 hover:bg-slate-800 rounded-lg text-slate-500 hover:text-white transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 rounded-xl p-4 border border-slate-800 mb-6 space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-slate-800 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-800 overflow-hidden shrink-0 border border-slate-700 flex items-center justify-center",children:y?jsxRuntimeExports.jsx(Loader,{className:"w-5 h-5 text-slate-500 animate-spin"}):p?.image?jsxRuntimeExports.jsx("img",{src:p.image,alt:p.name,className:"w-full h-full object-cover"}):jsxRuntimeExports.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-500",children:jsxRuntimeExports.jsx(User,{className:"w-6 h-6"})})}),jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-1",children:[y?jsxRuntimeExports.jsx("div",{className:"h-4 w-24 bg-slate-800 rounded animate-pulse mb-1"}):p?.displayName?jsxRuntimeExports.jsx("p",{className:"text-white font-bold text-sm truncate",children:p.displayName}):null,jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[y?jsxRuntimeExports.jsx("div",{className:"h-3 w-32 bg-slate-800 rounded animate-pulse"}):jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-400 truncate font-mono",children:[p?.name?`@${p.name}`:"",jsxRuntimeExports.jsx("span",{className:p?.name?"ml-2 opacity-70":"",children:(()=>{try{const Fe=nip19_exports$1.npubEncode(t.pubkey);return`${Fe.slice(0,5)}...${Fe.slice(-5)}`}catch{return t.pubkey.slice(0,10)+"..."}})()})]}),!y&&jsxRuntimeExports.jsx("button",{onClick:k,className:"text-slate-500 hover:text-white transition-colors",title:"Copy Npub",children:R?jsxRuntimeExports.jsx(Check,{className:"w-3 h-3 text-green-500"}):jsxRuntimeExports.jsx(Copy,{className:"w-3 h-3"})})]}),!y&&p?.nip05&&jsxRuntimeExports.jsx("p",{className:"text-[10px] text-amber-500 truncate",children:p.nip05})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Kind"}),jsxRuntimeExports.jsx("span",{className:"text-amber-500 font-mono text-sm",children:t.kind})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider block mb-2",children:"Content"}),jsxRuntimeExports.jsx("div",{className:"bg-slate-900 rounded p-2 text-xs text-slate-300 font-mono whitespace-pre-wrap break-words max-h-32 overflow-y-auto border border-slate-800",children:t.content||"<No Content>"})]}),jsxRuntimeExports.jsxs("div",{className:"pt-2 border-t border-slate-800 flex items-center gap-2 text-green-400 text-xs font-mono",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-3 h-3"}),"Valid Signature"]})]}),f&&jsxRuntimeExports.jsxs("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg flex items-center gap-2 text-red-400 text-sm",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4"}),f]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:e,disabled:s||c,className:"flex-1 py-3 bg-slate-800 hover:bg-slate-700 disabled:opacity-50 text-white font-bold rounded-xl transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Re,disabled:s||c,className:`flex-1 py-3 font-bold rounded-xl transition-colors flex items-center justify-center gap-2 ${c?"bg-green-500 text-slate-950":"bg-green-600 hover:bg-green-700 text-white"}`,children:s?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader,{className:"w-4 h-4 animate-spin"}),"Broadcasting..."]}):c?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4"}),"Sent!"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Send,{className:"w-4 h-4"}),"Broadcast"]})})]})]})})},DEFAULT_EVENT={kind:1,created_at:Math.floor(Date.now()/1e3),tags:[],content:"This is a test event for offline signing. You can edit this text to make it larger and test animated QRs.",pubkey:""},EventCreator=({onClose:t,onBroadcastSuccess:e})=>{const[r,n]=reactExports.useState(JSON.stringify(DEFAULT_EVENT,null,2)),[s,o]=reactExports.useState(null),[c,u]=reactExports.useState(!1),[f,x]=reactExports.useState(null),[p,g]=reactExports.useState(null),y=reactExports.useRef(null);reactExports.useEffect(()=>{const q={...DEFAULT_EVENT,created_at:Math.floor(Date.now()/1e3)};n(JSON.stringify(q,null,2))},[]),reactExports.useEffect(()=>{try{const q=JSON.parse(r);typeof q.content=="string"?o(q.content):o(null)}catch{}},[r]);const b=q=>{n(q.target.value),c&&u(!1),x(null)},R=q=>{const W=q.target.value;o(W);try{const We=JSON.parse(r);We.content=W,n(JSON.stringify(We,null,2)),c&&u(!1),x(null)}catch{}},D=(q,W,We,Xe,it)=>{try{JSON.parse(q);const{currentKeypairId:Ve,wallets:v,currentWalletId:I}=useWalletStore.getState(),P=v.find(je=>je.id===I)?.keypairs.find(je=>je.id===Ve);let _e="";try{if(P?.npub){const{data:je}=nip19_exports$1.decode(P.npub);_e=je}}catch(je){console.error("Failed to decode npub",je)}if(!_e){x("No active keypair found");return}const Le=Math.random().toString(36).substring(7),Ye=useRequestStore.getState();Ye.requests.forEach(je=>{je.internal&&Ye.removeRequest(je.id)}),useRequestStore.getState().addRequest({id:Le,requestEventId:"internal-"+Le,requestorPubkey:_e,method:"sign_event",params:[q],timestamp:Date.now()/1e3,source:"client",internal:!0,title:We,description:it,confirmLabel:Xe,onSuccess:je=>{W(je),x(null)},onError:je=>{x("Signing failed: "+je.message)}})}catch{x("Invalid JSON")}},k=()=>{try{const q=JSON.parse(r);q.created_at=Math.floor(Date.now()/1e3);const W=JSON.stringify(q,null,2);D(W,We=>{n(JSON.stringify(JSON.parse(We),null,2));const Xe=new Blob([We],{type:"application/json"}),it=URL.createObjectURL(Xe),Ve=document.createElement("a");Ve.href=it,Ve.download=`nostr-event-${Date.now()}.json`,document.body.appendChild(Ve),Ve.click(),document.body.removeChild(Ve),URL.revokeObjectURL(it)},"Export Event","Sign & Export","You are opting to sign this event and export it as a JSON file.")}catch{x("Invalid JSON")}},Re=()=>{if(c){u(!1);return}try{const q=JSON.parse(r);q.created_at=Math.floor(Date.now()/1e3);const W=JSON.stringify(q,null,2);D(W,We=>{n(JSON.stringify(JSON.parse(We),null,2)),u(!0)},"Generate QR","Sign & Generate QR","You are opting to sign this event to display it as a QR code.")}catch{x("Invalid JSON")}},Fe=()=>{try{const q=JSON.parse(r),{wallets:W,currentWalletId:We,currentKeypairId:Xe}=useWalletStore.getState(),Ve=W.find(Ce=>Ce.id===We)?.keypairs.find(Ce=>Ce.id===Xe);let v="";if(Ve?.npub)try{const{data:Ce}=nip19_exports$1.decode(Ve.npub);v=Ce}catch(Ce){console.error(Ce)}if(!v){x("No active keypair found to sign with");return}q.pubkey=v,q.created_at=Math.floor(Date.now()/1e3),delete q.id,delete q.sig;const I=JSON.stringify(q,null,2);n(I),D(I,Ce=>{const P=JSON.parse(Ce);n(JSON.stringify(P,null,2)),g(P)},"Broadcast","Sign & Broadcast","You are opting to sign this event with YOUR key and broadcast it to the network.")}catch{x("Invalid JSON")}},O=()=>{y.current?.click()},$e=q=>{const W=q.target.files?.[0];if(!W)return;const We=new FileReader;We.onload=Xe=>{try{const it=Xe.target?.result,Ve=JSON.parse(it);if(Ve.sig){g(Ve),n(JSON.stringify(Ve,null,2)),x(null),y.current&&(y.current.value="");return}n(JSON.stringify(Ve,null,2)),x(null),c&&u(!1)}catch{x("Failed to parse JSON file")}y.current&&(y.current.value="")},We.readAsText(W)},ze=async()=>{if(!p)return;const q=useRelayStore.getState().relays.map(We=>We.url);if(q.length===0)throw new Error("No relays connected");const W=new NDK({explicitRelayUrls:q});try{await Promise.race([W.connect(),new Promise((We,Xe)=>setTimeout(()=>Xe(new Error("Broadcast connection timed out")),5e3))])}catch(We){console.warn("Broadcast connection timed out/failed, checking for partial connections...",We);let Xe=0;if(W.pool.relays.forEach(it=>{(it.status===1||it.status===5)&&Xe++}),Xe===0)throw console.error("No relays connected for broadcast"),We}try{await new NDKEvent(W,p).publish(),e&&e()}catch(We){throw console.error("Broadcast failed:",We),We}};return jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 border border-slate-800 shadow-xl mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-bold text-amber-500 flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xl",children:""})," Event Creator"]}),t&&jsxRuntimeExports.jsx("button",{onClick:t,className:"text-slate-500 hover:text-slate-300",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("textarea",{value:r,onChange:b,className:"w-full h-48 bg-slate-950 text-slate-300 font-mono text-xs p-4 rounded-xl border border-slate-800 focus:border-amber-500/50 outline-none resize-none",spellCheck:!1,placeholder:"Paste Nostr event JSON here..."}),jsxRuntimeExports.jsx("div",{className:"absolute top-2 right-2 flex gap-2",children:jsxRuntimeExports.jsx("button",{onClick:()=>{navigator.clipboard.writeText(r)},className:"p-1.5 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-400 hover:text-white transition-colors",title:"Copy JSON",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500 select-none",children:"COPY"})})}),f&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-4 right-4 text-red-500 text-xs font-bold bg-slate-900/90 px-2 py-1 rounded",children:f})]}),s!==null&&jsxRuntimeExports.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2 px-1",children:[jsxRuntimeExports.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Content Editor"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-600",children:"Syncs with JSON"})]}),jsxRuntimeExports.jsx("textarea",{value:s,onChange:R,className:"w-full h-32 bg-slate-950 text-slate-200 font-sans text-sm p-4 rounded-xl border border-slate-800 focus:border-amber-500/50 outline-none resize-y",placeholder:"Edit event content here..."})]}),jsxRuntimeExports.jsx("input",{type:"file",ref:y,className:"hidden",accept:".json",onChange:$e}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs("button",{onClick:O,className:"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(Upload,{className:"w-4 h-4 text-emerald-500"}),"Import JSON"]}),jsxRuntimeExports.jsxs("button",{onClick:k,className:"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(Download,{className:"w-4 h-4 text-blue-500"}),"Sign & Export"]})]}),jsxRuntimeExports.jsxs("button",{onClick:Fe,className:"w-full py-4 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2 border-2 border-slate-700 hover:border-green-500/50",children:[jsxRuntimeExports.jsx(Radio,{className:"w-5 h-5 text-green-500"}),"Sign & Broadcast"]}),jsxRuntimeExports.jsxs("button",{onClick:Re,className:"w-full py-4 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2 border-2 border-slate-700 hover:border-amber-500/50",children:[jsxRuntimeExports.jsx(QrCode,{className:"w-5 h-5 text-amber-500"}),c?"Hide QR Code":"Sign & Generate QR"]})]}),c&&jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-xl flex flex-col items-center gap-2 animate-in fade-in zoom-in duration-200",children:[jsxRuntimeExports.jsx("div",{className:"w-full max-w-[300px]",children:jsxRuntimeExports.jsx(AnimatedQRCode,{data:r,type:"bytes"})}),jsxRuntimeExports.jsx("p",{className:"text-slate-900 text-xs font-bold mt-4",children:"Scan with Offline Device"})]})]}),p&&jsxRuntimeExports.jsx(BroadcastModal,{eventJson:p,onClose:()=>g(null),onBroadcast:ze,onSuccess:e})]})},global$1=globalThis||void 0||self;var ExceptionCode;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(ExceptionCode||(ExceptionCode={}));class CapacitorException extends Error{constructor(e,r,n){super(e),this.message=e,this.code=r,this.data=n}}const getPlatformId=t=>{var e,r;return t?.androidBridge?"android":!((r=(e=t?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||r===void 0)&&r.bridge?"ios":"web"},createCapacitor=t=>{const e=t.CapacitorCustomPlatform||null,r=t.Capacitor||{},n=r.Plugins=r.Plugins||{},s=()=>e!==null?e.name:getPlatformId(t),o=()=>s()!=="web",c=g=>{const y=x.get(g);return!!(y?.platforms.has(s())||u(g))},u=g=>{var y;return(y=r.PluginHeaders)===null||y===void 0?void 0:y.find(b=>b.name===g)},f=g=>t.console.error(g),x=new Map,p=(g,y={})=>{const b=x.get(g);if(b)return console.warn(`Capacitor plugin "${g}" already registered. Cannot register plugins twice.`),b.proxy;const R=s(),D=u(g);let k;const Re=async()=>(!k&&R in y?k=typeof y[R]=="function"?k=await y[R]():k=y[R]:e!==null&&!k&&"web"in y&&(k=typeof y.web=="function"?k=await y.web():k=y.web),k),Fe=(We,Xe)=>{var it,Ve;if(D){const v=D?.methods.find(I=>Xe===I.name);if(v)return v.rtype==="promise"?I=>r.nativePromise(g,Xe.toString(),I):(I,Ce)=>r.nativeCallback(g,Xe.toString(),I,Ce);if(We)return(it=We[Xe])===null||it===void 0?void 0:it.bind(We)}else{if(We)return(Ve=We[Xe])===null||Ve===void 0?void 0:Ve.bind(We);throw new CapacitorException(`"${g}" plugin is not implemented on ${R}`,ExceptionCode.Unimplemented)}},O=We=>{let Xe;const it=(...Ve)=>{const v=Re().then(I=>{const Ce=Fe(I,We);if(Ce){const P=Ce(...Ve);return Xe=P?.remove,P}else throw new CapacitorException(`"${g}.${We}()" is not implemented on ${R}`,ExceptionCode.Unimplemented)});return We==="addListener"&&(v.remove=async()=>Xe()),v};return it.toString=()=>`${We.toString()}() { [capacitor code] }`,Object.defineProperty(it,"name",{value:We,writable:!1,configurable:!1}),it},$e=O("addListener"),ze=O("removeListener"),q=(We,Xe)=>{const it=$e({eventName:We},Xe),Ve=async()=>{const I=await it;ze({eventName:We,callbackId:I},Xe)},v=new Promise(I=>it.then(()=>I({remove:Ve})));return v.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await Ve()},v},W=new Proxy({},{get(We,Xe){switch(Xe){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return D?q:$e;case"removeListener":return ze;default:return O(Xe)}}});return n[g]=W,x.set(g,{name:g,proxy:W,platforms:new Set([...Object.keys(y),...D?[R]:[]])}),W};return r.convertFileSrc||(r.convertFileSrc=g=>g),r.getPlatform=s,r.handleError=f,r.isNativePlatform=o,r.isPluginAvailable=c,r.registerPlugin=p,r.Exception=CapacitorException,r.DEBUG=!!r.DEBUG,r.isLoggingEnabled=!!r.isLoggingEnabled,r},initCapacitorGlobal=t=>t.Capacitor=createCapacitor(t),Capacitor=initCapacitorGlobal(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global$1<"u"?global$1:{}),registerPlugin=Capacitor.registerPlugin;class WebPlugin{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,r){let n=!1;this.listeners[e]||(this.listeners[e]=[],n=!0),this.listeners[e].push(r);const o=this.windowListeners[e];o&&!o.registered&&this.addWindowListener(o),n&&this.sendRetainedArgumentsForEvent(e);const c=async()=>this.removeListener(e,r);return Promise.resolve({remove:c})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,r,n){const s=this.listeners[e];if(!s){if(n){let o=this.retainedEventArguments[e];o||(o=[]),o.push(r),this.retainedEventArguments[e]=o}return}s.forEach(o=>o(r))}hasListeners(e){var r;return!!(!((r=this.listeners[e])===null||r===void 0)&&r.length)}registerWindowListener(e,r){this.windowListeners[r]={registered:!1,windowEventName:e,pluginEventName:r,handler:n=>{this.notifyListeners(r,n)}}}unimplemented(e="not implemented"){return new Capacitor.Exception(e,ExceptionCode.Unimplemented)}unavailable(e="not available"){return new Capacitor.Exception(e,ExceptionCode.Unavailable)}async removeListener(e,r){const n=this.listeners[e];if(!n)return;const s=n.indexOf(r);this.listeners[e].splice(s,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const r=this.retainedEventArguments[e];r&&(delete this.retainedEventArguments[e],r.forEach(n=>{this.notifyListeners(e,n)}))}}const encode$k=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),decode$j=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class CapacitorCookiesPluginWeb extends WebPlugin{async getCookies(){const e=document.cookie,r={};return e.split(";").forEach(n=>{if(n.length<=0)return;let[s,o]=n.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=decode$j(s).trim(),o=decode$j(o).trim(),r[s]=o}),r}async setCookie(e){try{const r=encode$k(e.key),n=encode$k(e.value),s=`; expires=${(e.expires||"").replace("expires=","")}`,o=(e.path||"/").replace("path=",""),c=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${r}=${n||""}${s}; path=${o}; ${c};`}catch(r){return Promise.reject(r)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(r){return Promise.reject(r)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const r of e)document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}registerPlugin("CapacitorCookies",{web:()=>new CapacitorCookiesPluginWeb});const readBlobAsBase64=async t=>new Promise((e,r)=>{const n=new FileReader;n.onload=()=>{const s=n.result;e(s.indexOf(",")>=0?s.split(",")[1]:s)},n.onerror=s=>r(s),n.readAsDataURL(t)}),normalizeHttpHeaders=(t={})=>{const e=Object.keys(t);return Object.keys(t).map(s=>s.toLocaleLowerCase()).reduce((s,o,c)=>(s[o]=t[e[c]],s),{})},buildUrlParams=(t,e=!0)=>t?Object.entries(t).reduce((n,s)=>{const[o,c]=s;let u,f;return Array.isArray(c)?(f="",c.forEach(x=>{u=e?encodeURIComponent(x):x,f+=`${o}=${u}&`}),f.slice(0,-1)):(u=e?encodeURIComponent(c):c,f=`${o}=${u}`),`${n}&${f}`},"").substr(1):null,buildRequestInit=(t,e={})=>{const r=Object.assign({method:t.method||"GET",headers:t.headers},e),s=normalizeHttpHeaders(t.headers)["content-type"]||"";if(typeof t.data=="string")r.body=t.data;else if(s.includes("application/x-www-form-urlencoded")){const o=new URLSearchParams;for(const[c,u]of Object.entries(t.data||{}))o.set(c,u);r.body=o.toString()}else if(s.includes("multipart/form-data")||t.data instanceof FormData){const o=new FormData;if(t.data instanceof FormData)t.data.forEach((u,f)=>{o.append(f,u)});else for(const u of Object.keys(t.data))o.append(u,t.data[u]);r.body=o;const c=new Headers(r.headers);c.delete("content-type"),r.headers=c}else(s.includes("application/json")||typeof t.data=="object")&&(r.body=JSON.stringify(t.data));return r};class CapacitorHttpPluginWeb extends WebPlugin{async request(e){const r=buildRequestInit(e,e.webFetchExtra),n=buildUrlParams(e.params,e.shouldEncodeUrlParams),s=n?`${e.url}?${n}`:e.url,o=await fetch(s,r),c=o.headers.get("content-type")||"";let{responseType:u="text"}=o.ok?e:{};c.includes("application/json")&&(u="json");let f,x;switch(u){case"arraybuffer":case"blob":x=await o.blob(),f=await readBlobAsBase64(x);break;case"json":f=await o.json();break;case"document":case"text":default:f=await o.text()}const p={};return o.headers.forEach((g,y)=>{p[y]=g}),{data:f,headers:p,status:o.status,url:o.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}registerPlugin("CapacitorHttp",{web:()=>new CapacitorHttpPluginWeb});var SystemBarsStyle;(function(t){t.Dark="DARK",t.Light="LIGHT",t.Default="DEFAULT"})(SystemBarsStyle||(SystemBarsStyle={}));var SystemBarType;(function(t){t.StatusBar="StatusBar",t.NavigationBar="NavigationBar"})(SystemBarType||(SystemBarType={}));class SystemBarsPluginWeb extends WebPlugin{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}registerPlugin("SystemBars",{web:()=>new SystemBarsPluginWeb});const NativeSignerPlugin=Capacitor.isNativePlatform()?registerPlugin("NativeSigner"):null;function isNativeSignerAvailable(){return Capacitor.isNativePlatform()&&Capacitor.getPlatform()==="android"}async function setNativeAppForeground(t){if(!(!isNativeSignerAvailable()||!NativeSignerPlugin))try{await NativeSignerPlugin.setAppForeground({inForeground:t}),console.log(`[nativeSigner] App foreground set to: ${t}`)}catch(e){console.warn("[nativeSigner] Failed to set app foreground:",e)}}async function setNativeWalletUnlocked(t){if(!(!isNativeSignerAvailable()||!NativeSignerPlugin))try{await NativeSignerPlugin.setWalletUnlocked({unlocked:t}),console.log(`[nativeSigner] Wallet unlocked set to: ${t}`)}catch(e){console.warn("[nativeSigner] Failed to set wallet unlocked:",e)}}async function startNativeSigner(t,e){if(!NativeSignerPlugin)return console.log("[NativeSigner] Not available on this platform"),!1;try{return await NativeSignerPlugin.startSigner({privateKey:t,relays:e}),console.log("[NativeSigner] Started successfully with",e.length,"relays"),!0}catch(r){return console.error("[NativeSigner] Failed to start:",r),!1}}async function setNativeAutoApproveAll(t,e){NativeSignerPlugin&&await NativeSignerPlugin.setAutoApproveAll({appPubkey:t,autoApprove:e})}async function setNativeKnownSender(t,e){NativeSignerPlugin&&await NativeSignerPlugin.setKnownSender({appPubkey:t,known:e})}async function setNativeApprovedKinds(t,e){NativeSignerPlugin&&await NativeSignerPlugin.setApprovedKinds({appPubkey:t,kinds:e.join(",")})}async function setNativeBlockedKinds(t,e){NativeSignerPlugin&&await NativeSignerPlugin.setBlockedKinds({appPubkey:t,kinds:e.join(",")})}let requestReceivedListener=null,autoApprovedListener=null,errorListener=null;async function addNativeSignerListeners(t){NativeSignerPlugin&&(removeNativeSignerListeners(),t.onRequestReceived&&(requestReceivedListener=(await NativeSignerPlugin.addListener("requestReceived",t.onRequestReceived)).remove),t.onRequestAutoApproved&&(autoApprovedListener=(await NativeSignerPlugin.addListener("requestAutoApproved",t.onRequestAutoApproved)).remove),t.onError&&(errorListener=(await NativeSignerPlugin.addListener("error",r=>t.onError(r.error))).remove))}function removeNativeSignerListeners(){requestReceivedListener&&(requestReceivedListener(),requestReceivedListener=null),autoApprovedListener&&(autoApprovedListener(),autoApprovedListener=null),errorListener&&(errorListener(),errorListener=null)}async function startSilentAudio(){if(!isNativeSignerAvailable()||!NativeSignerPlugin)return!1;try{return await NativeSignerPlugin.startSilentAudio(),console.log("[nativeSigner] Silent audio started"),!0}catch(t){return console.error("[nativeSigner] Failed to start silent audio:",t),!1}}async function stopSilentAudio(){if(!isNativeSignerAvailable()||!NativeSignerPlugin)return!1;try{return await NativeSignerPlugin.stopSilentAudio(),console.log("[nativeSigner] Silent audio stopped"),!0}catch(t){return console.error("[nativeSigner] Failed to stop silent audio:",t),!1}}async function isSilentAudioRunning(){if(!isNativeSignerAvailable()||!NativeSignerPlugin)return!1;try{return(await NativeSignerPlugin.isSilentAudioRunning()).running}catch(t){return console.error("[nativeSigner] Failed to check silent audio status:",t),!1}}function syncConnectionRulesToNative(t,e,r){const n=r.filter(c=>c.connectionId===t),s=[],o=[];n.forEach(c=>{c.policy==="reject"?o.push(...c.kinds):s.push(...c.kinds)}),setNativeApprovedKinds(e,s).catch(c=>{console.warn("[ConnectionsStore] Failed to sync approved kinds to native:",c)}),setNativeBlockedKinds(e,o).catch(c=>{console.warn("[ConnectionsStore] Failed to sync blocked kinds to native:",c)}),console.log("[ConnectionsStore] Synced rules to native:",{signerPubkey:e.substring(0,8)+"...",approvedKinds:s,blockedKinds:o})}const useConnectionsStore=create()(persist((t,e)=>({connections:[],autoApprovalRules:[],addConnection:r=>t(n=>({connections:[...n.connections,r]})),updateConnectionStatus:(r,n)=>t(s=>({connections:s.connections.map(o=>o.id===r?{...o,status:n}:o)})),updateConnection:(r,n)=>t(s=>({connections:s.connections.map(o=>o.id===r?{...o,...n}:o)})),removeConnection:r=>t(n=>({connections:n.connections.filter(s=>s.id!==r),autoApprovalRules:n.autoApprovalRules.filter(s=>s.connectionId!==r)})),getConnection:r=>e().connections.find(n=>n.id===r),addRule:r=>t(n=>{console.log("[ConnectionsStore] addRule called with:",r);const o=[...n.autoApprovalRules.filter(u=>u.connectionId!==r.connectionId||!u.kinds.some(f=>r.kinds.includes(f))),r];console.log("[ConnectionsStore] New rules after add:",o);const c=n.connections.find(u=>u.id===r.connectionId);return c&&setTimeout(()=>syncConnectionRulesToNative(r.connectionId,c.signerPubkey,o),0),{autoApprovalRules:o}}),removeRule:r=>t(n=>{const s=n.autoApprovalRules.find(c=>c.id===r),o=n.autoApprovalRules.filter(c=>c.id!==r);if(s){const c=n.connections.find(u=>u.id===s.connectionId);c&&setTimeout(()=>syncConnectionRulesToNative(s.connectionId,c.signerPubkey,o),0)}return{autoApprovalRules:o}}),getRulesForConnection:r=>e().autoApprovalRules.filter(n=>n.connectionId===r)}),{name:"amber-connections",storage:createJSONStorage(()=>({getItem:async t=>{const{storage:e}=await __vitePreload(async()=>{const{storage:r}=await import("./storage-D7x1dBXQ.js");return{storage:r}},[],import.meta.url);return e.getItem(t)},setItem:async(t,e)=>{const{storage:r}=await __vitePreload(async()=>{const{storage:n}=await import("./storage-D7x1dBXQ.js");return{storage:n}},[],import.meta.url);return r.setItem(t,e)},removeItem:async t=>{const{storage:e}=await __vitePreload(async()=>{const{storage:r}=await import("./storage-D7x1dBXQ.js");return{storage:r}},[],import.meta.url);return e.removeItem(t)}}))})),recentlyProcessedEvents=new Map,DEDUP_WINDOW_MS=5e3,useActivityLogStore=create()(persist(t=>({entries:[],maxEntries:100,addEntry:e=>t(r=>{if(e.eventId){const o=recentlyProcessedEvents.get(e.eventId);if(o&&Date.now()-o<DEDUP_WINDOW_MS)return console.log(`[ActivityLog] Skipping duplicate entry for event ${e.eventId.substring(0,8)}... (action: ${e.action})`),r;recentlyProcessedEvents.set(e.eventId,Date.now());const c=Date.now();for(const[u,f]of recentlyProcessedEvents)c-f>DEDUP_WINDOW_MS*2&&recentlyProcessedEvents.delete(u)}const s=[{...e,id:crypto.randomUUID(),timestamp:Date.now()},...r.entries];return s.length>r.maxEntries&&s.splice(r.maxEntries),{entries:s}}),clearLog:()=>t({entries:[]})}),{name:"amber-activity-log"})),hexToBytes$1=t=>{const e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++)e[r]=parseInt(t.substr(r*2,2),16);return e},processedEventIds$1=new Set,MAX_PROCESSED_IDS$1=500;class SignerService{ndk;signer;privateKey;sub;lastEventTime=0;useNativeSigner=!1;nativeSignerActive=!1;constructor(e){this.privateKey=e,this.signer=new NDKPrivateKeySigner(e),this.useNativeSigner=isNativeSignerAvailable(),this.initializeNDK()}initializeNDK(){const e=useRelayStore.getState().relays.map(n=>n.url),r=["wss://relay.nsec.app","wss://relay.primal.net","wss://relay.damus.io","wss://nos.lol","wss://relay.nostr.band"];this.ndk=new NDK({explicitRelayUrls:e.length>0?e:r}),this.ndk.signer=this.signer}async connect(e=!1){let r=!1;if(this.useNativeSigner){console.log("[SignerService] Using native signer for background support");const s=useRelayStore.getState().relays.map(f=>f.url),o=["wss://relay.nsec.app","wss://relay.primal.net","wss://relay.damus.io","wss://nos.lol","wss://relay.nostr.band"],c=s.length>0?s:o;await startNativeSigner(this.privateKey,c)&&(r=!0,this.nativeSignerActive=!0,console.log("[SignerService] Native signer started - JS subscription DISABLED"),await setNativeAppForeground(!0),await addNativeSignerListeners({onRequestReceived:f=>{console.log("[SignerService] Native request received:",f.method),useRequestStore.getState().addRequest({id:f.requestId,method:f.method,params:JSON.parse(f.params||"[]"),appPubkey:f.appPubkey,createdAt:Date.now(),eventId:f.requestId,relayUrl:"native"})},onError:f=>{console.error("[SignerService] Native signer error:",f)}}))}if(this.sub&&(console.log("[SignerService] Stopping existing subscription before reconnecting..."),this.sub.stop(),this.sub=null),e){console.log("[SignerService] FORCE connecting: DESTROYING and RECREATING NDK instance...");try{this.ndk.pool.relays.forEach(s=>{try{s.disconnect()}catch(o){console.error("Error disconnecting relay:",o)}})}catch(s){console.error("[SignerService] Error during pool cleanup:",s)}await new Promise(s=>setTimeout(s,500)),this.initializeNDK(),console.log("[SignerService] NDK instance recreated.")}console.log("[SignerService] Attempting to connect to relays...");const n=useRelayStore.getState().relays.map(s=>s.url);n.forEach(s=>{useRelayStore.getState().updateRelayStatus(s,"connecting")});try{await new Promise(o=>setTimeout(o,500));try{await Promise.race([this.ndk.connect(),new Promise((o,c)=>setTimeout(()=>c(new Error("Connection timeout")),1e4))]),console.log("[SignerService] NDK connected successfully!")}catch(o){console.warn("[SignerService] NDK connect failed/timed out:",o);let c=0;if(this.ndk.pool.relays.forEach(u=>{u.status===NDKRelayStatus.CONNECTED&&c++}),c===0)throw console.error("[SignerService] No connected relays. Aborting."),o;console.log(`[SignerService] Proceeding with partial connection (${c} relays connected).`)}n.forEach(o=>{const c=Array.from(this.ndk.pool.relays.values()).find(u=>u.url.includes(o)||o.includes(u.url));c&&c.status===NDKRelayStatus.CONNECTED&&(useRelayStore.getState().updateRelayStatus(o,"connected"),useRelayStore.getState().resetFailedAttempts(o))}),this.ndk.pool.relays.forEach(o=>{o.status===NDKRelayStatus.CONNECTED&&(useRelayStore.getState().updateRelayStatus(o.url,"connected"),useRelayStore.getState().resetFailedAttempts(o.url))});const s=await this.signer.user();r&&(console.log("[SignerService] Native signer active for background support"),console.log("[SignerService] JS subscription will ALSO be created for foreground redundancy")),console.log("[SignerService] Listening for NIP-46 requests to:",s.pubkey),this.sub=this.ndk.subscribe({kinds:[24133],"#p":[s.pubkey],since:Math.floor(Date.now()/1e3)-60},{closeOnEose:!1}),this.sub.on("event",async o=>{if(this.lastEventTime=Date.now(),processedEventIds$1.has(o.id)){console.log(`[SignerService]  Skipping already-processed event: ${o.id.slice(0,8)}...`);return}if(processedEventIds$1.add(o.id),processedEventIds$1.size>MAX_PROCESSED_IDS$1){const c=processedEventIds$1.values().next().value;c&&processedEventIds$1.delete(c)}console.log("[SignerService] Received NIP-46 event (Health Updated):",o.id);try{let c;try{console.log("[SignerService] Trying NIP-44 decryption...");const R=nip44_exports.v2.utils.getConversationKey(hexToBytes$1(this.privateKey),o.pubkey);c=nip44_exports.v2.decrypt(o.content,R),console.log("[SignerService] NIP-44 decryption successful!")}catch(R){console.log("[SignerService] NIP-46 failed, trying NIP-04...",R),c=await nip04_exports.decrypt(this.privateKey,o.pubkey,o.content),console.log("[SignerService] NIP-04 decryption successful!")}console.log("[SignerService] Decrypted content:",c);const u=JSON.parse(c),{id:f,method:x,params:p}=u;console.log("[SignerService] Parsed request:",{id:f,method:x,params:p});const g={id:f,requestEventId:o.id,requestorPubkey:o.pubkey,method:x,params:p,timestamp:o.created_at||Date.now()/1e3};let y=!1,b;if(x==="sign_event")try{const R=p[0];b=JSON.parse(R).kind}catch(R){console.error("[SignerService] Failed to parse sign_event params",R)}else x==="nip04_decrypt"?b=-4:x==="nip04_encrypt"&&(b=-5);if(b!==void 0){const R=useConnectionsStore.getState(),D=R.connections.find(k=>k.signerPubkey===o.pubkey);if(D){const Re=R.getRulesForConnection(D.id).filter($e=>$e.kinds.includes(b));if(Re.some($e=>$e.policy==="reject")){console.log(`[SignerService]  Auto-blocking kind ${b} for ${D.name||"app"}`),y=!0,await this.rejectRequest(f,o.id,o.pubkey,"Request blocked by user policy");return}if(D.autoApproveAll){console.log(`[SignerService]  Auto-approving kind ${b} for ${D.name||"app"} (autoApproveAll enabled)`),y=!0,await this.approveRequest(f,o.id,o.pubkey,x,p);return}if(Re.some($e=>$e.policy==="approve")){console.log(`[SignerService]  Auto-approving kind ${b} for ${D.name||"app"}`),y=!0,await this.approveRequest(f,o.id,o.pubkey,x,p);return}}}if(x==="get_public_key")try{const D=useConnectionsStore.getState().connections.find(k=>k.signerPubkey===o.pubkey);if(D){console.log(`[SignerService] Auto-approving get_public_key for ${D.name||"app"}`),y=!0,await this.approveRequest(f,o.id,o.pubkey,x,p);return}}catch(R){console.error("[SignerService] Error checking get_public_key auto-approval:",R)}y||(console.log("[SignerService] Adding request to store and showing notification"),useRequestStore.getState().addRequest(g))}catch(c){console.error("Failed to parse NIP-46 request",c)}})}catch(s){throw console.error("[SignerService] Connection failed:",s),n.forEach(o=>{useRelayStore.getState().updateRelayStatus(o,"error"),useRelayStore.getState().incrementFailedAttempts(o)}),s}}async signEventInternal(e){const r=new NDKEvent(this.ndk,JSON.parse(e));return await r.sign(this.signer),JSON.stringify(r.rawEvent())}async approveRequest(e,r,n,s,o){try{let c=null;switch(s){case"connect":c="ack";break;case"get_public_key":c=(await this.signer.user()).pubkey;break;case"sign_event":const y=o[0],b=new NDKEvent(this.ndk,JSON.parse(y));await b.sign(this.signer),c=JSON.stringify(b.rawEvent());break;case"nip04_decrypt":const R=o[0],D=o[1];c=await nip04_exports.decrypt(this.privateKey,R,D);break;case"nip04_encrypt":const k=o[0],Re=o[1];c=await nip04_exports.encrypt(this.privateKey,k,Re);break;default:throw new Error(`Unknown method: ${s}`)}const u=JSON.stringify({id:e,result:c,error:null}),f=nip44_exports.v2.utils.getConversationKey(hexToBytes$1(this.privateKey),n),x=nip44_exports.v2.encrypt(u,f),p=new NDKEvent(this.ndk);p.kind=24133,p.tags=[["p",n],["e",r]],p.content=x,await p.sign(this.signer),console.log("========== JS NIP-46 RESPONSE =========="),console.log("[SignerService]  Response plaintext:",u),console.log("[SignerService]  Response event:"),console.log("   id:",p.id),console.log("   pubkey:",p.pubkey),console.log("   created_at:",p.created_at),console.log("   kind:",p.kind),console.log("   tags:",JSON.stringify(p.tags)),console.log("   content (first 100):",x.substring(0,100)),console.log("   sig:",p.sig?.substring(0,32)+"..."),console.log("=============================================="),console.log("[SignerService]  Full event JSON:",JSON.stringify(p.rawEvent())),await p.publish(),console.log("[SignerService] Sent encrypted response for:",s),useActivityLogStore.getState().addEntry({action:"approved",method:s,appName:"Bunker Client",appPubkey:n,event:s==="sign_event"&&o[0]?typeof o[0]=="string"?JSON.parse(o[0]):o[0]:void 0,eventId:r}),useRequestStore.getState().removeRequest(e)}catch(c){console.error("Error approving request:",c),this.rejectRequest(e,r,n,c.message)}}async rejectRequest(e,r,n,s="User rejected"){const o=JSON.stringify({id:e,result:null,error:s}),c=nip44_exports.v2.utils.getConversationKey(hexToBytes$1(this.privateKey),n),u=nip44_exports.v2.encrypt(o,c),f=new NDKEvent(this.ndk);f.kind=24133,f.tags=[["p",n],["e",r]],f.content=u,await f.sign(this.signer),console.log(`[SignerService]  ABOUT TO SEND REJECTION for ${e}:`,{error:s,to:n.slice(0,8),stackTrace:new Error().stack?.split(`
`).slice(1,4).join(`
`)}),await f.publish(),console.log("[SignerService] Sent encrypted rejection"),useRequestStore.getState().removeRequest(e)}async getBunkerURI(){return`bunker://${(await this.signer.user()).pubkey}?relay=wss://relay.damus.io`}disconnect(){this.sub&&this.sub.stop()}async addRelay(e){console.log("[SignerService] Adding new relay:",e);const r=this.ndk.addExplicitRelay(e);useRelayStore.getState().updateRelayStatus(e,"connecting");try{await r.connect(),console.log("[SignerService] New relay connected:",e),useRelayStore.getState().updateRelayStatus(e,"connected"),useRelayStore.getState().resetFailedAttempts(e)}catch(n){console.error("[SignerService] Failed to connect to new relay:",n),useRelayStore.getState().updateRelayStatus(e,"error"),useRelayStore.getState().incrementFailedAttempts(e)}}hasActiveSubscription(){return this.nativeSignerActive?!0:this.sub!==null&&this.sub!==void 0}isSubscriptionHealthy(){if(Date.now()-this.lastEventTime<6e4)return!0;let e=0;const r=[];return this.ndk.pool.relays.forEach(n=>{r.push(`${n.url}: ${n.status}`),(n.status===NDKRelayStatus.CONNECTED||n.status===1)&&e++}),e===0&&console.log("[SignerService] Health Check Details:",r,"Enum CONNECTED:",NDKRelayStatus.CONNECTED),e>0}async reconnectSubscription(e=!1){console.log(`[SignerService] Attempting to reconnect subscription... (Force: ${e})`);try{return await this.connect(e),!0}catch(r){return console.error("[SignerService] Failed to reconnect subscription:",r),!1}}}const parseRequestForUI=(t,e)=>{const{method:r,params:n}=t,s=e||"The app",o=c=>t.description||c;if(r==="get_public_key")return{title:t.title||"Connection Request",description:o(`${s} wants to connect to your signer. It will be able to read your public key.`),primaryAction:"Connect",riskLevel:"low",icon:"connect"};if(r==="nip04_encrypt")return{title:"Send Private Message",description:`${s} wants to encrypt a private message.`,contentPreview:typeof n[1]=="string"?n[1]:"Unknown content",primaryAction:"Encrypt",riskLevel:"medium",icon:"encrypt"};if(r==="nip04_decrypt")return{title:"Read Private Message",description:`${s} wants to decrypt a private message sent to you.`,primaryAction:"Decrypt",riskLevel:"medium",icon:"decrypt"};if(r==="sign_event")try{const c=JSON.parse(n[0]),u=c.kind,f=c.content||"";if(u===1)return{title:t.title||"Post a Note",description:o(`${s} wants to publish a public note to your profile.`),contentPreview:f,primaryAction:"Post",riskLevel:"low",icon:"post"};if(u===7){let x="";return f==="+"?x="":f==="-"?x="":f&&(x=f),{title:"React to Post",description:`${s} wants to react with ${x} to a post.`,primaryAction:"React",riskLevel:"low",icon:"reaction"}}if(u===0)return{title:"Update Profile",description:`${s} wants to update your public profile (name, picture, etc).`,contentPreview:"Profile Data Update",primaryAction:"Update",riskLevel:"medium",icon:"profile"};if(u===3){const x=c.tags.filter(p=>p[0]==="p").length;return{title:"Update Follow List",description:`${s} wants to update your following list (${x} people).`,primaryAction:"Update",riskLevel:"medium",icon:"profile"}}return u===6?{title:"Repost",description:`${s} wants to share a post to your profile.`,primaryAction:"Repost",riskLevel:"low",icon:"post"}:u===9734?{title:"Send Zap",description:`${s} wants to request a Zap (Tip) payment.`,primaryAction:"Zap",riskLevel:"medium",icon:"zap"}:{title:t.title||`Publish Event (Kind ${u})`,description:o(`${s} wants to publish a standard Nostr event.`),contentPreview:f?f.length>100?f.slice(0,100)+"...":f:"No content",primaryAction:"Sign",riskLevel:"medium",icon:"unknown"}}catch(c){return console.error("Failed to parse event for UI",c),{title:"Sign Malformed Event",description:"The app wants to sign a specific event, but the data seems invalid.",primaryAction:"Sign",riskLevel:"high",icon:"unknown"}}return{title:"Unknown Request",description:`Request method: ${r}`,primaryAction:"Approve",riskLevel:"high",icon:"unknown"}},RequestModal=({request:t,onApprove:e,onReject:r})=>{const[n,s]=reactExports.useState(!1),[o,c]=reactExports.useState(!1),[u,f]=reactExports.useState(!1);React.useEffect(()=>{s(!1),c(!1),f(!1)},[t.id]);const g=useConnectionsStore(k=>k.connections).find(k=>k.signerPubkey===t.requestorPubkey)?.name,y=parseRequestForUI(t,g),b=()=>{switch(y.icon){case"post":return jsxRuntimeExports.jsx(MessageSquare,{className:"w-6 h-6 text-amber-500"});case"reaction":return jsxRuntimeExports.jsx(MessageSquare,{className:"w-6 h-6 text-red-500"});case"zap":return jsxRuntimeExports.jsx(Zap,{className:"w-6 h-6 text-yellow-500"});case"profile":return jsxRuntimeExports.jsx(User,{className:"w-6 h-6 text-blue-500"});case"connect":return jsxRuntimeExports.jsx(Link,{className:"w-6 h-6 text-green-500"});case"encrypt":return jsxRuntimeExports.jsx(Lock,{className:"w-6 h-6 text-indigo-500"});case"decrypt":return jsxRuntimeExports.jsx(Lock,{className:"w-6 h-6 text-indigo-500"});default:return jsxRuntimeExports.jsx(FileText,{className:"w-6 h-6 text-slate-400"})}},R=k=>{s(!0),e(k)},D=(k=!1)=>{c(!0),r(k)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 overflow-y-auto",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-md w-full border border-slate-800 shadow-2xl my-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-slate-800 rounded-full",children:b()}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:t.title||y.title}),!t.internal&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-slate-400",children:["from ",t.requestorPubkey.slice(0,8),"..."]})]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>f(!u),className:"p-2 hover:bg-slate-800 rounded-lg text-slate-500 hover:text-white transition-colors",title:u?"Show Simple View":"Show Advanced Details",children:u?jsxRuntimeExports.jsx(Code,{className:"w-5 h-5 text-amber-500"}):jsxRuntimeExports.jsx(Code,{className:"w-5 h-5"})})]}),!u&&jsxRuntimeExports.jsx("div",{className:"space-y-6",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 rounded-xl p-4 border border-slate-800",children:[jsxRuntimeExports.jsx("p",{className:"text-slate-300 text-sm leading-relaxed mb-3",children:y.description}),y.contentPreview&&jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-lg p-3 border border-slate-800",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase mb-1",children:"Preview"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-white font-mono whitespace-pre-wrap break-words max-h-32 overflow-y-auto",children:y.contentPreview})]})]})}),u&&jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 rounded-lg p-4 mb-6 border border-slate-800 animate-in fade-in duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Method"}),jsxRuntimeExports.jsx("p",{className:"text-amber-400 font-mono text-sm",children:t.method})]}),jsxRuntimeExports.jsxs("div",{className:"mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Request ID"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 font-mono text-xs",children:t.id})]}),t.method==="sign_event"&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Raw Event JSON"}),jsxRuntimeExports.jsx("pre",{className:"text-xs text-slate-300 overflow-auto max-h-48 mt-1 p-2 bg-slate-900 rounded border border-slate-800 font-mono",children:JSON.stringify(JSON.parse(t.params[0]),null,2)})]})]}),(t.method==="sign_event"||t.method==="nip04_decrypt"||t.method==="nip04_encrypt")&&!t.internal?jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-6",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>D(!0),disabled:n||o,className:"w-full bg-rose-800 hover:bg-rose-600 disabled:opacity-50 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[o?jsxRuntimeExports.jsx(Loader,{className:"w-4 h-4 animate-spin"}):jsxRuntimeExports.jsx(Ban,{className:"w-4 h-4"}),o?"Blocking...":"Auto-Block"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>D(!1),disabled:n||o,className:"w-full bg-slate-700 hover:bg-slate-600 disabled:bg-slate-800 disabled:opacity-50 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[o?jsxRuntimeExports.jsx(Loader,{className:"w-4 h-4 animate-spin"}):jsxRuntimeExports.jsx(Ban,{className:"w-4 h-4"}),o?"Rejecting...":"Block"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>R(!0),disabled:n||o,className:"w-full bg-amber-700 hover:bg-amber-600 disabled:opacity-50 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[n?jsxRuntimeExports.jsx(Loader,{className:"w-4 h-4 animate-spin"}):jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4"}),n?"Approving...":"Auto-Approve"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>R(!1),disabled:n||o,className:"w-full bg-amber-500 hover:bg-amber-400 disabled:bg-amber-600 disabled:opacity-50 text-slate-950 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[n?jsxRuntimeExports.jsx(Loader,{className:"w-4 h-4 animate-spin"}):jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4"}),t.confirmLabel||(n?"Approving...":"Approve")]})]}):jsxRuntimeExports.jsxs("div",{className:"flex gap-3 mt-6",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>D(!1),disabled:n||o,className:"flex-1 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-800 disabled:opacity-50 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[o?jsxRuntimeExports.jsx(Loader,{className:"w-4 h-4 animate-spin"}):jsxRuntimeExports.jsx(Ban,{className:"w-4 h-4"}),o?t.internal?"Cancelling...":"Rejecting...":t.cancelLabel||(t.internal?"Cancel":"Block")]}),jsxRuntimeExports.jsxs("button",{onClick:()=>R(!1),disabled:n||o,className:"flex-1 bg-amber-500 hover:bg-amber-400 disabled:bg-amber-600 disabled:opacity-50 text-slate-950 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[n?jsxRuntimeExports.jsx(Loader,{className:"w-4 h-4 animate-spin"}):jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4"}),t.confirmLabel||(n?"Approving...":"Approve")]})]})]})})},OfflineSigner=({event:t,onClose:e})=>{const{decryptedKey:r}=useAuthStore(),[n,s]=reactExports.useState(null),[o,c]=reactExports.useState(null),u={id:"offline",pubkey:t.pubkey,method:"sign_event",params:[JSON.stringify(t)],encryptedNsec:"",requestorPubkey:t.pubkey},f=parseRequestForUI(u,"Offline Request"),x=async()=>{if(!r){c("Wallet is locked. Please unlock it first.");return}try{const p=new NDKPrivateKeySigner(r),g=new NDKEvent(void 0,t);await g.sign(p);const y=JSON.stringify(g.rawEvent());s(y)}catch(p){console.error("Signing failed:",p),c("Failed to sign event: "+p.message)}};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/95 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl max-w-lg w-full border border-slate-800 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-slate-800 flex justify-between items-center bg-slate-900/50 backdrop-blur-md",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(ShieldCheck,{className:"w-5 h-5 text-amber-500"}),jsxRuntimeExports.jsx("h2",{className:"font-bold text-white",children:"Offline Signer"})]}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-2 hover:bg-slate-800 rounded-full transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-slate-400"})})]}),jsxRuntimeExports.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:n?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center animate-in fade-in zoom-in duration-300",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-bold text-green-400 mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Check,{className:"w-5 h-5"}),"Signed Successfully"]}),jsxRuntimeExports.jsx("div",{className:"w-full mb-6",children:jsxRuntimeExports.jsx(AnimatedQRCode,{data:n})}),jsxRuntimeExports.jsx("p",{className:"text-center text-slate-500 text-sm mb-6",children:"Scan this animated QR code with your watch-only app to broadcast the event."}),jsxRuntimeExports.jsx("button",{onClick:e,className:"w-full py-3 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition-colors",children:"Done"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"mb-6 text-center",children:[jsxRuntimeExports.jsx("div",{className:"text-xl font-bold text-white mb-2",children:f.title}),jsxRuntimeExports.jsx("div",{className:"text-slate-400 text-sm",children:f.description})]}),jsxRuntimeExports.jsx("div",{className:"bg-slate-950 rounded-xl p-4 border border-slate-800 mb-6 font-mono text-xs text-slate-300 overflow-x-auto",children:jsxRuntimeExports.jsx("pre",{children:JSON.stringify(t,null,2)})}),o&&jsxRuntimeExports.jsxs("div",{className:"mb-6 p-3 bg-red-500/10 border border-red-500/20 rounded-lg flex items-center gap-2 text-red-400 text-sm",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4"}),o]}),jsxRuntimeExports.jsxs("button",{onClick:x,className:"w-full py-3 bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold rounded-xl transition-all shadow-lg shadow-amber-500/20 flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(Check,{className:"w-5 h-5"}),"Sign & Display QR"]})]})})]})})},hexToBytes=t=>{const e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++)e[r]=parseInt(t.substr(r*2,2),16);return e},processedEventIds=new Set,MAX_PROCESSED_IDS=500;class ClientService{ndk;signer;privateKey;sub;connectionId;signerPubkey;secret;startedVia;originalRelayUrls;constructor(e,r,n){if(e.startsWith("nsec"))try{console.log("[ClientService] Detected nsec, converting to hex...");const{data:s}=nip19_exports$1.decode(e);this.privateKey=Buffer.from(s).toString("hex"),console.log("[ClientService] Converted nsec to hex successfully")}catch(s){console.error("[ClientService] Failed to decode nsec key:",s),this.privateKey=e}else this.privateKey=e;this.connectionId=r,this.signerPubkey=n.signerPubkey,this.secret=n.secret,this.startedVia=n.startedVia,this.originalRelayUrls=n.relays,console.log("[ClientService] Constructor called for connection:",r),console.log("[ClientService] Relays passed to constructor:",JSON.stringify(n.relays)),console.log("[ClientService] Relays count:",n.relays?.length),this.signer=new NDKPrivateKeySigner(this.privateKey),this.ndk=new NDK({explicitRelayUrls:n.relays}),this.ndk.signer=this.signer,console.log("[ClientService] NDK pool relay count after construction:",this.ndk.pool.relays.size)}static parseNostrConnectURI(e){try{const r=new URL(e),n=r.hostname||r.pathname.replace("//",""),s=r.searchParams.getAll("relay").map(decodeURIComponent),o=r.searchParams.get("secret")||void 0,c=r.searchParams.get("name")||void 0,u=r.searchParams.get("url")?decodeURIComponent(r.searchParams.get("url")):void 0;if(!n||s.length===0)throw new Error("Invalid nostrconnect URI: missing pubkey or relays");return{signerPubkey:n,relays:s,secret:o,name:c,appUrl:u}}catch(r){throw new Error(`Failed to parse nostrconnect URI: ${r}`)}}async connect(){console.log("[ClientService]  connect() called for connection:",this.connectionId),console.log("[ClientService] startedVia:",this.startedVia,"secret:",this.secret?"present":"absent"),useConnectionsStore.getState().updateConnectionStatus(this.connectionId,"connecting");try{try{await Promise.race([this.ndk.connect(),new Promise((s,o)=>setTimeout(()=>o(new Error("Connection timeout")),1e4))])}catch(s){console.warn("[ClientService] Main connect failed, checking for partial connection...",s);let o=0;if(this.ndk.pool.relays.forEach(c=>{(c.status===1||c.status===5)&&o++}),o===0)throw s;console.log(`[ClientService] Proceeding with partial connection (${o} relays).`)}const e=await this.signer.user();console.log("[ClientService] Connected! Our pubkey:",e.pubkey),useConnectionsStore.getState().updateConnectionStatus(this.connectionId,"connected");const r={kinds:[24133],"#p":[e.pubkey],since:Math.floor(Date.now()/1e3)};console.log("[ClientService] Subscription filter:",JSON.stringify(r));const n=NDKRelaySet.fromRelayUrls(this.originalRelayUrls,this.ndk);if(console.log("[ClientService] Creating subscription on",this.originalRelayUrls.length,"ORIGINAL relays:",this.originalRelayUrls),this.sub=this.ndk.subscribe(r,{closeOnEose:!1,relaySet:n}),console.log("[ClientService] Listening for requests from:",this.signerPubkey),console.log("[ClientService] Our pubkey (receiving events tagged with):",e.pubkey),this.secret&&this.startedVia==="nostrconnect"){console.log("[ClientService] Sending proactive connect RESPONSE with secret:",this.secret),console.log("[ClientService] Target pubkey:",this.signerPubkey.slice(0,16)+"..."),console.log("[ClientService] DEBUG: NDK configured relay count:",this.ndk.pool.relays.size),this.ndk.pool.relays.forEach((c,u)=>{console.log("[ClientService] DEBUG: Relay:",u,"status:",c.status)});const s=async(c=1)=>{try{const u=JSON.stringify({id:"connect_"+Math.random().toString(36).substring(7),result:this.secret,error:null}),f=nip44_exports.v2.utils.getConversationKey(hexToBytes(this.privateKey),this.signerPubkey),x=nip44_exports.v2.encrypt(u,f),p=new NDKEvent(this.ndk);p.kind=24133,p.tags=[["p",this.signerPubkey]],p.content=x,await p.sign(this.signer),console.log("[ClientService] Connect response event:"),console.log("[ClientService]   Author (us):",p.pubkey),console.log("[ClientService]   Kind:",p.kind),console.log("[ClientService]   P-tag (Jumble):",p.tags.find(b=>b[0]==="p")?.[1]),console.log("[ClientService]   Event ID:",p.id);const g=new Set;this.ndk.pool.relays.forEach((b,R)=>{this.originalRelayUrls.includes(R)&&g.add(b)}),console.log(`[ClientService] Publishing to ${g.size} ORIGINAL relays (ignoring ${this.ndk.pool.relays.size-g.size} extra relays)`);const y=[];for(const b of g)try{await b.publish(p),y.push(b.url)}catch(R){console.warn(`[ClientService] Failed to publish to ${b.url}:`,R)}return y.length>0?(console.log(`[ClientService]  Proactive connect RESPONSE sent to ${y.length} relays:`,y),!0):(console.warn(`[ClientService]  Attempt ${c}: Response published to 0 relays`),!1)}catch(u){return console.error(`[ClientService]  Attempt ${c} failed:`,u),!1}};let o=await s(1);o||(console.log("[ClientService] Retrying connect response in 1s..."),await new Promise(c=>setTimeout(c,1e3)),o=await s(2)),o||(console.log("[ClientService] Retrying connect response in 2s..."),await new Promise(c=>setTimeout(c,2e3)),o=await s(3)),o||console.error("[ClientService]  Failed to send connect response after 3 attempts")}this.sub.on("event",async s=>{console.log("[ClientService]  EVENT RECEIVED!"),console.log("[ClientService] Event from:",s.pubkey),console.log("[ClientService] Event kind:",s.kind),console.log("[ClientService] Event tags:",s.tags),console.log("[ClientService] Event content (encrypted):",s.content.substring(0,50)+"..."),console.log("[ClientService] Event created_at:",s.created_at,"Current time:",Math.floor(Date.now()/1e3));const o=s.created_at||0,c=Math.floor(Date.now()/1e3);if(c-o>60){console.log(`[ClientService]  Ignoring stale event from ${c-o}s ago`);return}const u=s.id||s.rawEvent().id;if(processedEventIds.has(u)){console.log(`[ClientService]  Skipping already-processed event: ${u.slice(0,8)}...`);return}if(processedEventIds.add(u),processedEventIds.size>MAX_PROCESSED_IDS){const x=processedEventIds.values().next().value;x&&processedEventIds.delete(x)}const f=s.pubkey===this.signerPubkey;f||console.warn(`[ClientService] Event from unknown pubkey: ${s.pubkey} (expected ${this.signerPubkey}). Attempting to decrypt and verify...`);try{let x,p="nip44";try{const D=nip44_exports.v2.utils.getConversationKey(hexToBytes(this.privateKey),s.pubkey);x=nip44_exports.v2.decrypt(s.content,D),console.log("[ClientService]  Decrypted with NIP-44")}catch{x=await nip04_exports.decrypt(this.privateKey,s.pubkey,s.content),p="nip04",console.log("[ClientService]  Decrypted with NIP-04")}const g=JSON.parse(x),{id:y,method:b,params:R}=g;if(!f)if(console.log(`[ClientService]  Request from different pubkey: method=${b}, params=${JSON.stringify(R?.slice(0,1))}`),b==="connect"&&R[0]===this.secret){console.log("[ClientService]  Key rotation detected! Updating signer pubkey to:",s.pubkey),this.signerPubkey=s.pubkey;const{updateConnection:D}=useConnectionsStore.getState();D(this.connectionId,{signerPubkey:s.pubkey})}else console.warn(`[ClientService]  Accepting request from alternate pubkey (method: ${b})`);if(console.log(`[ClientService]  Processing request: method=${b}, id=${y}, from=${f?"expected key":"alternate key"}`),b==="connect"||b==="get_public_key"||b==="ping"){console.log(`[ClientService] Auto-approving ${b} request`),await this.approveRequest(y,s.id,s.pubkey,b,R||[],p);return}if(b==="sign_event")try{const D=R[0],Re=JSON.parse(D).kind;console.log("[ClientService] Checking auto-approval for kind:",Re),console.log("[ClientService] Connection ID:",this.connectionId);const Fe=useConnectionsStore.getState(),O=Fe.connections.find($e=>$e.id===this.connectionId);if(console.log("[ClientService] Found connection:",O?{id:O.id,name:O.name}:"NOT FOUND"),O){const $e=Fe.getRulesForConnection(O.id);console.log("[ClientService] Rules for this connection:",$e);const ze=$e.filter(We=>We.kinds.includes(Re));console.log("[ClientService] Matching rules:",ze),console.log("[ClientService] DEBUG: Event kind is:",Re,"type:",typeof Re),console.log("[ClientService] DEBUG: Rules map:",$e.map(We=>({kinds:We.kinds,policy:We.policy,kindTypes:We.kinds.map(Xe=>typeof Xe)})));const q=ze.some(We=>We.policy==="reject");if(console.log("[ClientService] DEBUG: shouldBlock:",q,"autoApproveAll:",O.autoApproveAll),q){console.log(`[ClientService]  Auto-blocking kind ${Re} for ${O.name||"app"}`),await this.rejectRequest(y,s.id,s.pubkey,"Request blocked by user policy");return}if(O.autoApproveAll){console.log(`[ClientService]  Auto-approve-all enabled, approving kind ${Re} for ${O.name||"app"}`),await this.approveRequest(y,s.id,s.pubkey,b,R,p);return}if(ze.some(We=>We.policy==="approve")){console.log(`[ClientService]  Auto-approving kind ${Re} for ${O.name||"app"}`),await this.approveRequest(y,s.id,s.pubkey,b,R,p);return}console.log("[ClientService]  No matching rule found, showing modal")}else console.log("[ClientService]  Connection not found in store")}catch(D){console.error("[ClientService] Error checking auto-approval:",D)}if(b==="nip04_decrypt"||b==="nip04_encrypt")try{const D=b==="nip04_decrypt"?-4:-5;console.log(`[ClientService] Checking auto-approval for ${b} (kind: ${D})`),console.log("[ClientService] Connection ID:",this.connectionId);const k=useConnectionsStore.getState(),Re=k.connections.find(Fe=>Fe.id===this.connectionId);if(console.log("[ClientService] Found connection:",Re?{id:Re.id,name:Re.name}:"NOT FOUND"),Re){const Fe=k.getRulesForConnection(Re.id);console.log("[ClientService] Rules for this connection:",Fe);const O=Fe.filter(q=>q.kinds.includes(D));if(console.log("[ClientService] Matching rules:",O),O.some(q=>q.policy==="reject")){console.log(`[ClientService]  Auto-blocking ${b} for ${Re.name||"app"}`),await this.rejectRequest(y,s.id,s.pubkey,"Request blocked by user policy");return}if(Re.autoApproveAll){console.log(`[ClientService]  Auto-approve-all enabled, approving ${b} for ${Re.name||"app"}`),await this.approveRequest(y,s.id,s.pubkey,b,R,p);return}if(O.some(q=>q.policy==="approve")){console.log(`[ClientService]  Auto-approving ${b} for ${Re.name||"app"}`),await this.approveRequest(y,s.id,s.pubkey,b,R,p);return}console.log(`[ClientService]  No matching rule found for ${b}, showing modal`)}else console.log("[ClientService]  Connection not found in store")}catch(D){console.error("[ClientService] Error checking auto-approval:",D)}useRequestStore.getState().addRequest({id:y,requestEventId:s.id,requestorPubkey:s.pubkey,method:b,params:R,timestamp:s.created_at||Date.now()/1e3,source:"client",connectionId:this.connectionId,encryptionMethod:p}),console.log("[ClientService] Added request to queue:",b)}catch(x){console.error("[ClientService] Failed to process:",x)}}),console.log("[ClientService]  Subscription created and event handler attached"),console.log("[ClientService] Connected and listening for requests"),useConnectionsStore.getState().updateConnectionStatus(this.connectionId,"connected")}catch(e){throw console.error("[ClientService] Connection failed:",e),useConnectionsStore.getState().updateConnectionStatus(this.connectionId,"error"),e}}async approveRequest(e,r,n,s,o,c="nip04"){if(console.log(`[ClientService]  approveRequest called for ${s} (id: ${e}) using ${c}`),!useConnectionsStore.getState().connections.find(f=>f.id===this.connectionId)){console.error(`[ClientService]  Connection ${this.connectionId} no longer exists! Aborting response to prevent orphaned reply.`);return}try{if(s==="connect"){const R=this.secret||o[0];console.log(`[ClientService]  Sending connect RESPONSE. Stored secret: ${this.secret?"YES":"NO"}, Param secret: ${o[0]?"YES":"NO"}, Using: ${R||"ack"}`);const D=JSON.stringify({id:e,result:R||"ack",error:null});console.log("[ClientService] Connect Response content:",D);let k;if(c==="nip04")k=await nip04_exports.encrypt(this.privateKey,n,D);else{const O=nip44_exports.v2.utils.getConversationKey(hexToBytes(this.privateKey),n);k=nip44_exports.v2.encrypt(D,O)}const Re=new NDKEvent(this.ndk);Re.kind=24133,Re.tags=[["p",n]],Re.content=k,console.log("[ClientService] Sending connect response event to:",n),await Re.sign(this.signer),console.log("[ClientService]  PUBLISHING PROACTIVE CONNECT:",{to:this.signerPubkey.slice(0,8),secret:this.secret});const Fe=await Re.publish();console.log("[ClientService]  Sent connect response to relays:",Array.from(Fe).map(O=>O.url)),useRequestStore.getState().removeRequest(e);return}let f;if(s==="get_public_key")f=(await this.signer.user()).pubkey;else if(s==="sign_event"){console.log("[ClientService] Signing event:",o[0]);const R=typeof o[0]=="string"?JSON.parse(o[0]):o[0],D=new NDKEvent(this.ndk,R);await D.sign(this.signer),f=JSON.stringify(D.rawEvent()),console.log("[ClientService] Event signed successfully")}else if(s==="nip04_decrypt"){const R=o[0],D=o[1];f=await nip04_exports.decrypt(this.privateKey,R,D)}else if(s==="nip04_encrypt"){const R=o[0],D=o[1];f=await nip04_exports.encrypt(this.privateKey,R,D)}else throw new Error(`Unknown method: ${s}`);const x=JSON.stringify({id:e,result:f,error:null});console.log("[ClientService] Response content:",x);let p;if(c==="nip04")p=await nip04_exports.encrypt(this.privateKey,n,x);else{const R=nip44_exports.v2.utils.getConversationKey(hexToBytes(this.privateKey),n);p=nip44_exports.v2.encrypt(x,R)}const g=new NDKEvent(this.ndk);g.kind=24133,g.tags=r?[["p",n],["e",r]]:[["p",n]],g.content=p,console.log("[ClientService] Sending response event:",{kind:g.kind,tags:g.tags,to:n}),console.log("[ClientService]  Response triggered from:",new Error().stack?.split(`
`)[2]?.trim()),await g.sign(this.signer),console.log("[ClientService]  PUBLISHING APPROVAL RESPONSE:",{requestId:e,method:s,to:n.slice(0,8),hasError:x.includes('"error":null')?"NO":"YES",contentPreview:x.slice(0,100)});const y=await g.publish();console.log("[ClientService] Published response to relays:",Array.from(y).map(R=>R.url)),console.log("[ClientService]  Sent approval for:",s);const b=useConnectionsStore.getState().connections.find(R=>R.id===this.connectionId);useActivityLogStore.getState().addEntry({action:"approved",method:s,appName:b?.name,appPubkey:n,event:s==="sign_event"&&o[0]?typeof o[0]=="string"?JSON.parse(o[0]):o[0]:void 0,eventId:r}),useRequestStore.getState().removeRequest(e)}catch(f){console.error("[ClientService] Error approving:",f);try{const x=JSON.stringify({id:e,result:null,error:f.message||"Unknown error"});let p;if(c==="nip04")p=await nip04_exports.encrypt(this.privateKey,n,x);else{const y=nip44_exports.v2.utils.getConversationKey(hexToBytes(this.privateKey),n);p=nip44_exports.v2.encrypt(x,y)}const g=new NDKEvent(this.ndk);g.kind=24133,g.tags=[["p",n]],g.content=p,await g.sign(this.signer),await g.publish(),console.log("[ClientService] Error response published")}catch(x){console.error("[ClientService] Failed to send error response:",x)}}}async rejectRequest(e,r,n,s="User rejected"){console.log(`[ClientService]  rejectRequest called for (id: ${e})`);const o=JSON.stringify({id:e,result:null,error:s}),c=nip44_exports.v2.utils.getConversationKey(hexToBytes(this.privateKey),n),u=nip44_exports.v2.encrypt(o,c),f=new NDKEvent(this.ndk);f.kind=24133,f.tags=r?[["p",n],["e",r]]:[["p",n]],f.content=u,await f.sign(this.signer),console.log(`[ClientService]  ABOUT TO SEND REJECTION for ${e}:`,{error:s,to:n.slice(0,8),stackTrace:new Error().stack?.split(`
`).slice(1,4).join(`
`)}),await f.publish(),console.log("[ClientService] Sent rejection");const x=useConnectionsStore.getState().connections.find(p=>p.id===this.connectionId);useActivityLogStore.getState().addEntry({action:"rejected",method:"unknown",appName:x?.name,appPubkey:n,error:s,eventId:r}),useRequestStore.getState().removeRequest(e)}disconnect(){this.sub&&this.sub.stop();try{this.ndk.pool&&this.ndk.pool.close()}catch(e){console.warn("[ClientService] Failed to close NDK pool:",e)}useConnectionsStore.getState().updateConnectionStatus(this.connectionId,"disconnected"),console.log("[ClientService] Disconnected")}}var jsQR$2={exports:{}},jsQR$1=jsQR$2.exports,hasRequiredJsQR;function requireJsQR(){return hasRequiredJsQR||(hasRequiredJsQR=1,(function(t,e){(function(n,s){t.exports=s()})(typeof self<"u"?self:jsQR$1,function(){return(function(r){var n={};function s(o){if(n[o])return n[o].exports;var c=n[o]={i:o,l:!1,exports:{}};return r[o].call(c.exports,c,c.exports,s),c.l=!0,c.exports}return s.m=r,s.c=n,s.d=function(o,c,u){s.o(o,c)||Object.defineProperty(o,c,{configurable:!1,enumerable:!0,get:u})},s.n=function(o){var c=o&&o.__esModule?function(){return o.default}:function(){return o};return s.d(c,"a",c),c},s.o=function(o,c){return Object.prototype.hasOwnProperty.call(o,c)},s.p="",s(s.s=3)})([(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function c(u,f){this.width=f,this.height=u.length/f,this.data=u}return c.createEmpty=function(u,f){return new c(new Uint8ClampedArray(u*f),u)},c.prototype.get=function(u,f){return u<0||u>=this.width||f<0||f>=this.height?!1:!!this.data[f*this.width+u]},c.prototype.set=function(u,f,x){this.data[f*this.width+u]=x?1:0},c.prototype.setRegion=function(u,f,x,p,g){for(var y=f;y<f+p;y++)for(var b=u;b<u+x;b++)this.set(b,y,!!g)},c})();n.BitMatrix=o}),(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(2);function c(f,x){return f^x}n.addOrSubtractGF=c;var u=(function(){function f(x,p,g){this.primitive=x,this.size=p,this.generatorBase=g,this.expTable=new Array(this.size),this.logTable=new Array(this.size);for(var y=1,b=0;b<this.size;b++)this.expTable[b]=y,y=y*2,y>=this.size&&(y=(y^this.primitive)&this.size-1);for(var b=0;b<this.size-1;b++)this.logTable[this.expTable[b]]=b;this.zero=new o.default(this,Uint8ClampedArray.from([0])),this.one=new o.default(this,Uint8ClampedArray.from([1]))}return f.prototype.multiply=function(x,p){return x===0||p===0?0:this.expTable[(this.logTable[x]+this.logTable[p])%(this.size-1)]},f.prototype.inverse=function(x){if(x===0)throw new Error("Can't invert 0");return this.expTable[this.size-this.logTable[x]-1]},f.prototype.buildMonomial=function(x,p){if(x<0)throw new Error("Invalid monomial degree less than 0");if(p===0)return this.zero;var g=new Uint8ClampedArray(x+1);return g[0]=p,new o.default(this,g)},f.prototype.log=function(x){if(x===0)throw new Error("Can't take log(0)");return this.logTable[x]},f.prototype.exp=function(x){return this.expTable[x]},f})();n.default=u}),(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(1),c=(function(){function u(f,x){if(x.length===0)throw new Error("No coefficients.");this.field=f;var p=x.length;if(p>1&&x[0]===0){for(var g=1;g<p&&x[g]===0;)g++;if(g===p)this.coefficients=f.zero.coefficients;else{this.coefficients=new Uint8ClampedArray(p-g);for(var y=0;y<this.coefficients.length;y++)this.coefficients[y]=x[g+y]}}else this.coefficients=x}return u.prototype.degree=function(){return this.coefficients.length-1},u.prototype.isZero=function(){return this.coefficients[0]===0},u.prototype.getCoefficient=function(f){return this.coefficients[this.coefficients.length-1-f]},u.prototype.addOrSubtract=function(f){var x;if(this.isZero())return f;if(f.isZero())return this;var p=this.coefficients,g=f.coefficients;p.length>g.length&&(x=[g,p],p=x[0],g=x[1]);for(var y=new Uint8ClampedArray(g.length),b=g.length-p.length,R=0;R<b;R++)y[R]=g[R];for(var R=b;R<g.length;R++)y[R]=o.addOrSubtractGF(p[R-b],g[R]);return new u(this.field,y)},u.prototype.multiply=function(f){if(f===0)return this.field.zero;if(f===1)return this;for(var x=this.coefficients.length,p=new Uint8ClampedArray(x),g=0;g<x;g++)p[g]=this.field.multiply(this.coefficients[g],f);return new u(this.field,p)},u.prototype.multiplyPoly=function(f){if(this.isZero()||f.isZero())return this.field.zero;for(var x=this.coefficients,p=x.length,g=f.coefficients,y=g.length,b=new Uint8ClampedArray(p+y-1),R=0;R<p;R++)for(var D=x[R],k=0;k<y;k++)b[R+k]=o.addOrSubtractGF(b[R+k],this.field.multiply(D,g[k]));return new u(this.field,b)},u.prototype.multiplyByMonomial=function(f,x){if(f<0)throw new Error("Invalid degree less than 0");if(x===0)return this.field.zero;for(var p=this.coefficients.length,g=new Uint8ClampedArray(p+f),y=0;y<p;y++)g[y]=this.field.multiply(this.coefficients[y],x);return new u(this.field,g)},u.prototype.evaluateAt=function(f){var x=0;if(f===0)return this.getCoefficient(0);var p=this.coefficients.length;if(f===1)return this.coefficients.forEach(function(y){x=o.addOrSubtractGF(x,y)}),x;x=this.coefficients[0];for(var g=1;g<p;g++)x=o.addOrSubtractGF(this.field.multiply(f,x),this.coefficients[g]);return x},u})();n.default=c}),(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(4),c=s(5),u=s(11),f=s(12);function x(y){var b=f.locate(y);if(!b)return null;for(var R=0,D=b;R<D.length;R++){var k=D[R],Re=u.extract(y,k),Fe=c.decode(Re.matrix);if(Fe)return{binaryData:Fe.bytes,data:Fe.text,chunks:Fe.chunks,version:Fe.version,location:{topRightCorner:Re.mappingFunction(k.dimension,0),topLeftCorner:Re.mappingFunction(0,0),bottomRightCorner:Re.mappingFunction(k.dimension,k.dimension),bottomLeftCorner:Re.mappingFunction(0,k.dimension),topRightFinderPattern:k.topRight,topLeftFinderPattern:k.topLeft,bottomLeftFinderPattern:k.bottomLeft,bottomRightAlignmentPattern:k.alignmentPattern}}}return null}var p={inversionAttempts:"attemptBoth"};function g(y,b,R,D){D===void 0&&(D={});var k=p;Object.keys(k||{}).forEach(function(W){k[W]=D[W]||k[W]});var Re=k.inversionAttempts==="attemptBoth"||k.inversionAttempts==="invertFirst",Fe=k.inversionAttempts==="onlyInvert"||k.inversionAttempts==="invertFirst",O=o.binarize(y,b,R,Re),$e=O.binarized,ze=O.inverted,q=x(Fe?ze:$e);return!q&&(k.inversionAttempts==="attemptBoth"||k.inversionAttempts==="invertFirst")&&(q=x(Fe?$e:ze)),q}g.default=g,n.default=g}),(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(0),c=8,u=24;function f(g,y,b){return g<y?y:g>b?b:g}var x=(function(){function g(y,b){this.width=y,this.data=new Uint8ClampedArray(y*b)}return g.prototype.get=function(y,b){return this.data[b*this.width+y]},g.prototype.set=function(y,b,R){this.data[b*this.width+y]=R},g})();function p(g,y,b,R){if(g.length!==y*b*4)throw new Error("Malformed data passed to binarizer.");for(var D=new x(y,b),k=0;k<y;k++)for(var Re=0;Re<b;Re++){var Fe=g[(Re*y+k)*4+0],O=g[(Re*y+k)*4+1],$e=g[(Re*y+k)*4+2];D.set(k,Re,.2126*Fe+.7152*O+.0722*$e)}for(var ze=Math.ceil(y/c),q=Math.ceil(b/c),W=new x(ze,q),We=0;We<q;We++)for(var Xe=0;Xe<ze;Xe++){for(var it=0,Ve=1/0,v=0,Re=0;Re<c;Re++)for(var k=0;k<c;k++){var I=D.get(Xe*c+k,We*c+Re);it+=I,Ve=Math.min(Ve,I),v=Math.max(v,I)}var Ce=it/Math.pow(c,2);if(v-Ve<=u&&(Ce=Ve/2,We>0&&Xe>0)){var P=(W.get(Xe,We-1)+2*W.get(Xe-1,We)+W.get(Xe-1,We-1))/4;Ve<P&&(Ce=P)}W.set(Xe,We,Ce)}var _e=o.BitMatrix.createEmpty(y,b),Le=null;R&&(Le=o.BitMatrix.createEmpty(y,b));for(var We=0;We<q;We++)for(var Xe=0;Xe<ze;Xe++){for(var Ye=f(Xe,2,ze-3),je=f(We,2,q-3),it=0,K=-2;K<=2;K++)for(var L=-2;L<=2;L++)it+=W.get(Ye+K,je+L);for(var st=it/25,K=0;K<c;K++)for(var L=0;L<c;L++){var k=Xe*c+K,Re=We*c+L,dt=D.get(k,Re);_e.set(k,Re,dt<=st),R&&Le.set(k,Re,!(dt<=st))}}return R?{binarized:_e,inverted:Le}:{binarized:_e}}n.binarize=p}),(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(0),c=s(6),u=s(9),f=s(10);function x($e,ze){for(var q=$e^ze,W=0;q;)W++,q&=q-1;return W}function p($e,ze){return ze<<1|$e}var g=[{bits:21522,formatInfo:{errorCorrectionLevel:1,dataMask:0}},{bits:20773,formatInfo:{errorCorrectionLevel:1,dataMask:1}},{bits:24188,formatInfo:{errorCorrectionLevel:1,dataMask:2}},{bits:23371,formatInfo:{errorCorrectionLevel:1,dataMask:3}},{bits:17913,formatInfo:{errorCorrectionLevel:1,dataMask:4}},{bits:16590,formatInfo:{errorCorrectionLevel:1,dataMask:5}},{bits:20375,formatInfo:{errorCorrectionLevel:1,dataMask:6}},{bits:19104,formatInfo:{errorCorrectionLevel:1,dataMask:7}},{bits:30660,formatInfo:{errorCorrectionLevel:0,dataMask:0}},{bits:29427,formatInfo:{errorCorrectionLevel:0,dataMask:1}},{bits:32170,formatInfo:{errorCorrectionLevel:0,dataMask:2}},{bits:30877,formatInfo:{errorCorrectionLevel:0,dataMask:3}},{bits:26159,formatInfo:{errorCorrectionLevel:0,dataMask:4}},{bits:25368,formatInfo:{errorCorrectionLevel:0,dataMask:5}},{bits:27713,formatInfo:{errorCorrectionLevel:0,dataMask:6}},{bits:26998,formatInfo:{errorCorrectionLevel:0,dataMask:7}},{bits:5769,formatInfo:{errorCorrectionLevel:3,dataMask:0}},{bits:5054,formatInfo:{errorCorrectionLevel:3,dataMask:1}},{bits:7399,formatInfo:{errorCorrectionLevel:3,dataMask:2}},{bits:6608,formatInfo:{errorCorrectionLevel:3,dataMask:3}},{bits:1890,formatInfo:{errorCorrectionLevel:3,dataMask:4}},{bits:597,formatInfo:{errorCorrectionLevel:3,dataMask:5}},{bits:3340,formatInfo:{errorCorrectionLevel:3,dataMask:6}},{bits:2107,formatInfo:{errorCorrectionLevel:3,dataMask:7}},{bits:13663,formatInfo:{errorCorrectionLevel:2,dataMask:0}},{bits:12392,formatInfo:{errorCorrectionLevel:2,dataMask:1}},{bits:16177,formatInfo:{errorCorrectionLevel:2,dataMask:2}},{bits:14854,formatInfo:{errorCorrectionLevel:2,dataMask:3}},{bits:9396,formatInfo:{errorCorrectionLevel:2,dataMask:4}},{bits:8579,formatInfo:{errorCorrectionLevel:2,dataMask:5}},{bits:11994,formatInfo:{errorCorrectionLevel:2,dataMask:6}},{bits:11245,formatInfo:{errorCorrectionLevel:2,dataMask:7}}],y=[function($e){return($e.y+$e.x)%2===0},function($e){return $e.y%2===0},function($e){return $e.x%3===0},function($e){return($e.y+$e.x)%3===0},function($e){return(Math.floor($e.y/2)+Math.floor($e.x/3))%2===0},function($e){return $e.x*$e.y%2+$e.x*$e.y%3===0},function($e){return($e.y*$e.x%2+$e.y*$e.x%3)%2===0},function($e){return(($e.y+$e.x)%2+$e.y*$e.x%3)%2===0}];function b($e){var ze=17+4*$e.versionNumber,q=o.BitMatrix.createEmpty(ze,ze);q.setRegion(0,0,9,9,!0),q.setRegion(ze-8,0,8,9,!0),q.setRegion(0,ze-8,9,8,!0);for(var W=0,We=$e.alignmentPatternCenters;W<We.length;W++)for(var Xe=We[W],it=0,Ve=$e.alignmentPatternCenters;it<Ve.length;it++){var v=Ve[it];Xe===6&&v===6||Xe===6&&v===ze-7||Xe===ze-7&&v===6||q.setRegion(Xe-2,v-2,5,5,!0)}return q.setRegion(6,9,1,ze-17,!0),q.setRegion(9,6,ze-17,1,!0),$e.versionNumber>6&&(q.setRegion(ze-11,0,3,6,!0),q.setRegion(0,ze-11,6,3,!0)),q}function R($e,ze,q){for(var W=y[q.dataMask],We=$e.height,Xe=b(ze),it=[],Ve=0,v=0,I=!0,Ce=We-1;Ce>0;Ce-=2){Ce===6&&Ce--;for(var P=0;P<We;P++)for(var _e=I?We-1-P:P,Le=0;Le<2;Le++){var Ye=Ce-Le;if(!Xe.get(Ye,_e)){v++;var je=$e.get(Ye,_e);W({y:_e,x:Ye})&&(je=!je),Ve=p(je,Ve),v===8&&(it.push(Ve),v=0,Ve=0)}}I=!I}return it}function D($e){var ze=$e.height,q=Math.floor((ze-17)/4);if(q<=6)return f.VERSIONS[q-1];for(var W=0,We=5;We>=0;We--)for(var Xe=ze-9;Xe>=ze-11;Xe--)W=p($e.get(Xe,We),W);for(var it=0,Xe=5;Xe>=0;Xe--)for(var We=ze-9;We>=ze-11;We--)it=p($e.get(Xe,We),it);for(var Ve=1/0,v,I=0,Ce=f.VERSIONS;I<Ce.length;I++){var P=Ce[I];if(P.infoBits===W||P.infoBits===it)return P;var _e=x(W,P.infoBits);_e<Ve&&(v=P,Ve=_e),_e=x(it,P.infoBits),_e<Ve&&(v=P,Ve=_e)}if(Ve<=3)return v}function k($e){for(var ze=0,q=0;q<=8;q++)q!==6&&(ze=p($e.get(q,8),ze));for(var W=7;W>=0;W--)W!==6&&(ze=p($e.get(8,W),ze));for(var We=$e.height,Xe=0,W=We-1;W>=We-7;W--)Xe=p($e.get(8,W),Xe);for(var q=We-8;q<We;q++)Xe=p($e.get(q,8),Xe);for(var it=1/0,Ve=null,v=0,I=g;v<I.length;v++){var Ce=I[v],P=Ce.bits,_e=Ce.formatInfo;if(P===ze||P===Xe)return _e;var Le=x(ze,P);Le<it&&(Ve=_e,it=Le),ze!==Xe&&(Le=x(Xe,P),Le<it&&(Ve=_e,it=Le))}return it<=3?Ve:null}function Re($e,ze,q){var W=ze.errorCorrectionLevels[q],We=[],Xe=0;if(W.ecBlocks.forEach(function(je){for(var K=0;K<je.numBlocks;K++)We.push({numDataCodewords:je.dataCodewordsPerBlock,codewords:[]}),Xe+=je.dataCodewordsPerBlock+W.ecCodewordsPerBlock}),$e.length<Xe)return null;$e=$e.slice(0,Xe);for(var it=W.ecBlocks[0].dataCodewordsPerBlock,Ve=0;Ve<it;Ve++)for(var v=0,I=We;v<I.length;v++){var Ce=I[v];Ce.codewords.push($e.shift())}if(W.ecBlocks.length>1)for(var P=W.ecBlocks[0].numBlocks,_e=W.ecBlocks[1].numBlocks,Ve=0;Ve<_e;Ve++)We[P+Ve].codewords.push($e.shift());for(;$e.length>0;)for(var Le=0,Ye=We;Le<Ye.length;Le++){var Ce=Ye[Le];Ce.codewords.push($e.shift())}return We}function Fe($e){var ze=D($e);if(!ze)return null;var q=k($e);if(!q)return null;var W=R($e,ze,q),We=Re(W,ze,q.errorCorrectionLevel);if(!We)return null;for(var Xe=We.reduce(function(Le,Ye){return Le+Ye.numDataCodewords},0),it=new Uint8ClampedArray(Xe),Ve=0,v=0,I=We;v<I.length;v++){var Ce=I[v],P=u.decode(Ce.codewords,Ce.codewords.length-Ce.numDataCodewords);if(!P)return null;for(var _e=0;_e<Ce.numDataCodewords;_e++)it[Ve++]=P[_e]}try{return c.decode(it,ze.versionNumber)}catch{return null}}function O($e){if($e==null)return null;var ze=Fe($e);if(ze)return ze;for(var q=0;q<$e.width;q++)for(var W=q+1;W<$e.height;W++)$e.get(q,W)!==$e.get(W,q)&&($e.set(q,W,!$e.get(q,W)),$e.set(W,q,!$e.get(W,q)));return Fe($e)}n.decode=O}),(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(7),c=s(8),u;(function(D){D.Numeric="numeric",D.Alphanumeric="alphanumeric",D.Byte="byte",D.Kanji="kanji",D.ECI="eci"})(u=n.Mode||(n.Mode={}));var f;(function(D){D[D.Terminator=0]="Terminator",D[D.Numeric=1]="Numeric",D[D.Alphanumeric=2]="Alphanumeric",D[D.Byte=4]="Byte",D[D.Kanji=8]="Kanji",D[D.ECI=7]="ECI"})(f||(f={}));function x(D,k){for(var Re=[],Fe="",O=[10,12,14][k],$e=D.readBits(O);$e>=3;){var ze=D.readBits(10);if(ze>=1e3)throw new Error("Invalid numeric value above 999");var q=Math.floor(ze/100),W=Math.floor(ze/10)%10,We=ze%10;Re.push(48+q,48+W,48+We),Fe+=q.toString()+W.toString()+We.toString(),$e-=3}if($e===2){var ze=D.readBits(7);if(ze>=100)throw new Error("Invalid numeric value above 99");var q=Math.floor(ze/10),W=ze%10;Re.push(48+q,48+W),Fe+=q.toString()+W.toString()}else if($e===1){var ze=D.readBits(4);if(ze>=10)throw new Error("Invalid numeric value above 9");Re.push(48+ze),Fe+=ze.toString()}return{bytes:Re,text:Fe}}var p=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function g(D,k){for(var Re=[],Fe="",O=[9,11,13][k],$e=D.readBits(O);$e>=2;){var ze=D.readBits(11),q=Math.floor(ze/45),W=ze%45;Re.push(p[q].charCodeAt(0),p[W].charCodeAt(0)),Fe+=p[q]+p[W],$e-=2}if($e===1){var q=D.readBits(6);Re.push(p[q].charCodeAt(0)),Fe+=p[q]}return{bytes:Re,text:Fe}}function y(D,k){for(var Re=[],Fe="",O=[8,16,16][k],$e=D.readBits(O),ze=0;ze<$e;ze++){var q=D.readBits(8);Re.push(q)}try{Fe+=decodeURIComponent(Re.map(function(W){return"%"+("0"+W.toString(16)).substr(-2)}).join(""))}catch{}return{bytes:Re,text:Fe}}function b(D,k){for(var Re=[],Fe="",O=[8,10,12][k],$e=D.readBits(O),ze=0;ze<$e;ze++){var q=D.readBits(13),W=Math.floor(q/192)<<8|q%192;W<7936?W+=33088:W+=49472,Re.push(W>>8,W&255),Fe+=String.fromCharCode(c.shiftJISTable[W])}return{bytes:Re,text:Fe}}function R(D,k){for(var Re,Fe,O,$e,ze=new o.BitStream(D),q=k<=9?0:k<=26?1:2,W={text:"",bytes:[],chunks:[],version:k};ze.available()>=4;){var We=ze.readBits(4);if(We===f.Terminator)return W;if(We===f.ECI)ze.readBits(1)===0?W.chunks.push({type:u.ECI,assignmentNumber:ze.readBits(7)}):ze.readBits(1)===0?W.chunks.push({type:u.ECI,assignmentNumber:ze.readBits(14)}):ze.readBits(1)===0?W.chunks.push({type:u.ECI,assignmentNumber:ze.readBits(21)}):W.chunks.push({type:u.ECI,assignmentNumber:-1});else if(We===f.Numeric){var Xe=x(ze,q);W.text+=Xe.text,(Re=W.bytes).push.apply(Re,Xe.bytes),W.chunks.push({type:u.Numeric,text:Xe.text})}else if(We===f.Alphanumeric){var it=g(ze,q);W.text+=it.text,(Fe=W.bytes).push.apply(Fe,it.bytes),W.chunks.push({type:u.Alphanumeric,text:it.text})}else if(We===f.Byte){var Ve=y(ze,q);W.text+=Ve.text,(O=W.bytes).push.apply(O,Ve.bytes),W.chunks.push({type:u.Byte,bytes:Ve.bytes,text:Ve.text})}else if(We===f.Kanji){var v=b(ze,q);W.text+=v.text,($e=W.bytes).push.apply($e,v.bytes),W.chunks.push({type:u.Kanji,bytes:v.bytes,text:v.text})}}if(ze.available()===0||ze.readBits(ze.available())===0)return W}n.decode=R}),(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function c(u){this.byteOffset=0,this.bitOffset=0,this.bytes=u}return c.prototype.readBits=function(u){if(u<1||u>32||u>this.available())throw new Error("Cannot read "+u.toString()+" bits");var f=0;if(this.bitOffset>0){var x=8-this.bitOffset,p=u<x?u:x,g=x-p,y=255>>8-p<<g;f=(this.bytes[this.byteOffset]&y)>>g,u-=p,this.bitOffset+=p,this.bitOffset===8&&(this.bitOffset=0,this.byteOffset++)}if(u>0){for(;u>=8;)f=f<<8|this.bytes[this.byteOffset]&255,this.byteOffset++,u-=8;if(u>0){var g=8-u,y=255>>g<<g;f=f<<u|(this.bytes[this.byteOffset]&y)>>g,this.bitOffset+=u}}return f},c.prototype.available=function(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset},c})();n.BitStream=o}),(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.shiftJISTable={32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:165,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:8254,33088:12288,33089:12289,33090:12290,33091:65292,33092:65294,33093:12539,33094:65306,33095:65307,33096:65311,33097:65281,33098:12443,33099:12444,33100:180,33101:65344,33102:168,33103:65342,33104:65507,33105:65343,33106:12541,33107:12542,33108:12445,33109:12446,33110:12291,33111:20189,33112:12293,33113:12294,33114:12295,33115:12540,33116:8213,33117:8208,33118:65295,33119:92,33120:12316,33121:8214,33122:65372,33123:8230,33124:8229,33125:8216,33126:8217,33127:8220,33128:8221,33129:65288,33130:65289,33131:12308,33132:12309,33133:65339,33134:65341,33135:65371,33136:65373,33137:12296,33138:12297,33139:12298,33140:12299,33141:12300,33142:12301,33143:12302,33144:12303,33145:12304,33146:12305,33147:65291,33148:8722,33149:177,33150:215,33152:247,33153:65309,33154:8800,33155:65308,33156:65310,33157:8806,33158:8807,33159:8734,33160:8756,33161:9794,33162:9792,33163:176,33164:8242,33165:8243,33166:8451,33167:65509,33168:65284,33169:162,33170:163,33171:65285,33172:65283,33173:65286,33174:65290,33175:65312,33176:167,33177:9734,33178:9733,33179:9675,33180:9679,33181:9678,33182:9671,33183:9670,33184:9633,33185:9632,33186:9651,33187:9650,33188:9661,33189:9660,33190:8251,33191:12306,33192:8594,33193:8592,33194:8593,33195:8595,33196:12307,33208:8712,33209:8715,33210:8838,33211:8839,33212:8834,33213:8835,33214:8746,33215:8745,33224:8743,33225:8744,33226:172,33227:8658,33228:8660,33229:8704,33230:8707,33242:8736,33243:8869,33244:8978,33245:8706,33246:8711,33247:8801,33248:8786,33249:8810,33250:8811,33251:8730,33252:8765,33253:8733,33254:8757,33255:8747,33256:8748,33264:8491,33265:8240,33266:9839,33267:9837,33268:9834,33269:8224,33270:8225,33271:182,33276:9711,33359:65296,33360:65297,33361:65298,33362:65299,33363:65300,33364:65301,33365:65302,33366:65303,33367:65304,33368:65305,33376:65313,33377:65314,33378:65315,33379:65316,33380:65317,33381:65318,33382:65319,33383:65320,33384:65321,33385:65322,33386:65323,33387:65324,33388:65325,33389:65326,33390:65327,33391:65328,33392:65329,33393:65330,33394:65331,33395:65332,33396:65333,33397:65334,33398:65335,33399:65336,33400:65337,33401:65338,33409:65345,33410:65346,33411:65347,33412:65348,33413:65349,33414:65350,33415:65351,33416:65352,33417:65353,33418:65354,33419:65355,33420:65356,33421:65357,33422:65358,33423:65359,33424:65360,33425:65361,33426:65362,33427:65363,33428:65364,33429:65365,33430:65366,33431:65367,33432:65368,33433:65369,33434:65370,33439:12353,33440:12354,33441:12355,33442:12356,33443:12357,33444:12358,33445:12359,33446:12360,33447:12361,33448:12362,33449:12363,33450:12364,33451:12365,33452:12366,33453:12367,33454:12368,33455:12369,33456:12370,33457:12371,33458:12372,33459:12373,33460:12374,33461:12375,33462:12376,33463:12377,33464:12378,33465:12379,33466:12380,33467:12381,33468:12382,33469:12383,33470:12384,33471:12385,33472:12386,33473:12387,33474:12388,33475:12389,33476:12390,33477:12391,33478:12392,33479:12393,33480:12394,33481:12395,33482:12396,33483:12397,33484:12398,33485:12399,33486:12400,33487:12401,33488:12402,33489:12403,33490:12404,33491:12405,33492:12406,33493:12407,33494:12408,33495:12409,33496:12410,33497:12411,33498:12412,33499:12413,33500:12414,33501:12415,33502:12416,33503:12417,33504:12418,33505:12419,33506:12420,33507:12421,33508:12422,33509:12423,33510:12424,33511:12425,33512:12426,33513:12427,33514:12428,33515:12429,33516:12430,33517:12431,33518:12432,33519:12433,33520:12434,33521:12435,33600:12449,33601:12450,33602:12451,33603:12452,33604:12453,33605:12454,33606:12455,33607:12456,33608:12457,33609:12458,33610:12459,33611:12460,33612:12461,33613:12462,33614:12463,33615:12464,33616:12465,33617:12466,33618:12467,33619:12468,33620:12469,33621:12470,33622:12471,33623:12472,33624:12473,33625:12474,33626:12475,33627:12476,33628:12477,33629:12478,33630:12479,33631:12480,33632:12481,33633:12482,33634:12483,33635:12484,33636:12485,33637:12486,33638:12487,33639:12488,33640:12489,33641:12490,33642:12491,33643:12492,33644:12493,33645:12494,33646:12495,33647:12496,33648:12497,33649:12498,33650:12499,33651:12500,33652:12501,33653:12502,33654:12503,33655:12504,33656:12505,33657:12506,33658:12507,33659:12508,33660:12509,33661:12510,33662:12511,33664:12512,33665:12513,33666:12514,33667:12515,33668:12516,33669:12517,33670:12518,33671:12519,33672:12520,33673:12521,33674:12522,33675:12523,33676:12524,33677:12525,33678:12526,33679:12527,33680:12528,33681:12529,33682:12530,33683:12531,33684:12532,33685:12533,33686:12534,33695:913,33696:914,33697:915,33698:916,33699:917,33700:918,33701:919,33702:920,33703:921,33704:922,33705:923,33706:924,33707:925,33708:926,33709:927,33710:928,33711:929,33712:931,33713:932,33714:933,33715:934,33716:935,33717:936,33718:937,33727:945,33728:946,33729:947,33730:948,33731:949,33732:950,33733:951,33734:952,33735:953,33736:954,33737:955,33738:956,33739:957,33740:958,33741:959,33742:960,33743:961,33744:963,33745:964,33746:965,33747:966,33748:967,33749:968,33750:969,33856:1040,33857:1041,33858:1042,33859:1043,33860:1044,33861:1045,33862:1025,33863:1046,33864:1047,33865:1048,33866:1049,33867:1050,33868:1051,33869:1052,33870:1053,33871:1054,33872:1055,33873:1056,33874:1057,33875:1058,33876:1059,33877:1060,33878:1061,33879:1062,33880:1063,33881:1064,33882:1065,33883:1066,33884:1067,33885:1068,33886:1069,33887:1070,33888:1071,33904:1072,33905:1073,33906:1074,33907:1075,33908:1076,33909:1077,33910:1105,33911:1078,33912:1079,33913:1080,33914:1081,33915:1082,33916:1083,33917:1084,33918:1085,33920:1086,33921:1087,33922:1088,33923:1089,33924:1090,33925:1091,33926:1092,33927:1093,33928:1094,33929:1095,33930:1096,33931:1097,33932:1098,33933:1099,33934:1100,33935:1101,33936:1102,33937:1103,33951:9472,33952:9474,33953:9484,33954:9488,33955:9496,33956:9492,33957:9500,33958:9516,33959:9508,33960:9524,33961:9532,33962:9473,33963:9475,33964:9487,33965:9491,33966:9499,33967:9495,33968:9507,33969:9523,33970:9515,33971:9531,33972:9547,33973:9504,33974:9519,33975:9512,33976:9527,33977:9535,33978:9501,33979:9520,33980:9509,33981:9528,33982:9538,34975:20124,34976:21782,34977:23043,34978:38463,34979:21696,34980:24859,34981:25384,34982:23030,34983:36898,34984:33909,34985:33564,34986:31312,34987:24746,34988:25569,34989:28197,34990:26093,34991:33894,34992:33446,34993:39925,34994:26771,34995:22311,34996:26017,34997:25201,34998:23451,34999:22992,35e3:34427,35001:39156,35002:32098,35003:32190,35004:39822,35005:25110,35006:31903,35007:34999,35008:23433,35009:24245,35010:25353,35011:26263,35012:26696,35013:38343,35014:38797,35015:26447,35016:20197,35017:20234,35018:20301,35019:20381,35020:20553,35021:22258,35022:22839,35023:22996,35024:23041,35025:23561,35026:24799,35027:24847,35028:24944,35029:26131,35030:26885,35031:28858,35032:30031,35033:30064,35034:31227,35035:32173,35036:32239,35037:32963,35038:33806,35039:34915,35040:35586,35041:36949,35042:36986,35043:21307,35044:20117,35045:20133,35046:22495,35047:32946,35048:37057,35049:30959,35050:19968,35051:22769,35052:28322,35053:36920,35054:31282,35055:33576,35056:33419,35057:39983,35058:20801,35059:21360,35060:21693,35061:21729,35062:22240,35063:23035,35064:24341,35065:39154,35066:28139,35067:32996,35068:34093,35136:38498,35137:38512,35138:38560,35139:38907,35140:21515,35141:21491,35142:23431,35143:28879,35144:32701,35145:36802,35146:38632,35147:21359,35148:40284,35149:31418,35150:19985,35151:30867,35152:33276,35153:28198,35154:22040,35155:21764,35156:27421,35157:34074,35158:39995,35159:23013,35160:21417,35161:28006,35162:29916,35163:38287,35164:22082,35165:20113,35166:36939,35167:38642,35168:33615,35169:39180,35170:21473,35171:21942,35172:23344,35173:24433,35174:26144,35175:26355,35176:26628,35177:27704,35178:27891,35179:27945,35180:29787,35181:30408,35182:31310,35183:38964,35184:33521,35185:34907,35186:35424,35187:37613,35188:28082,35189:30123,35190:30410,35191:39365,35192:24742,35193:35585,35194:36234,35195:38322,35196:27022,35197:21421,35198:20870,35200:22290,35201:22576,35202:22852,35203:23476,35204:24310,35205:24616,35206:25513,35207:25588,35208:27839,35209:28436,35210:28814,35211:28948,35212:29017,35213:29141,35214:29503,35215:32257,35216:33398,35217:33489,35218:34199,35219:36960,35220:37467,35221:40219,35222:22633,35223:26044,35224:27738,35225:29989,35226:20985,35227:22830,35228:22885,35229:24448,35230:24540,35231:25276,35232:26106,35233:27178,35234:27431,35235:27572,35236:29579,35237:32705,35238:35158,35239:40236,35240:40206,35241:40644,35242:23713,35243:27798,35244:33659,35245:20740,35246:23627,35247:25014,35248:33222,35249:26742,35250:29281,35251:20057,35252:20474,35253:21368,35254:24681,35255:28201,35256:31311,35257:38899,35258:19979,35259:21270,35260:20206,35261:20309,35262:20285,35263:20385,35264:20339,35265:21152,35266:21487,35267:22025,35268:22799,35269:23233,35270:23478,35271:23521,35272:31185,35273:26247,35274:26524,35275:26550,35276:27468,35277:27827,35278:28779,35279:29634,35280:31117,35281:31166,35282:31292,35283:31623,35284:33457,35285:33499,35286:33540,35287:33655,35288:33775,35289:33747,35290:34662,35291:35506,35292:22057,35293:36008,35294:36838,35295:36942,35296:38686,35297:34442,35298:20420,35299:23784,35300:25105,35301:29273,35302:30011,35303:33253,35304:33469,35305:34558,35306:36032,35307:38597,35308:39187,35309:39381,35310:20171,35311:20250,35312:35299,35313:22238,35314:22602,35315:22730,35316:24315,35317:24555,35318:24618,35319:24724,35320:24674,35321:25040,35322:25106,35323:25296,35324:25913,35392:39745,35393:26214,35394:26800,35395:28023,35396:28784,35397:30028,35398:30342,35399:32117,35400:33445,35401:34809,35402:38283,35403:38542,35404:35997,35405:20977,35406:21182,35407:22806,35408:21683,35409:23475,35410:23830,35411:24936,35412:27010,35413:28079,35414:30861,35415:33995,35416:34903,35417:35442,35418:37799,35419:39608,35420:28012,35421:39336,35422:34521,35423:22435,35424:26623,35425:34510,35426:37390,35427:21123,35428:22151,35429:21508,35430:24275,35431:25313,35432:25785,35433:26684,35434:26680,35435:27579,35436:29554,35437:30906,35438:31339,35439:35226,35440:35282,35441:36203,35442:36611,35443:37101,35444:38307,35445:38548,35446:38761,35447:23398,35448:23731,35449:27005,35450:38989,35451:38990,35452:25499,35453:31520,35454:27179,35456:27263,35457:26806,35458:39949,35459:28511,35460:21106,35461:21917,35462:24688,35463:25324,35464:27963,35465:28167,35466:28369,35467:33883,35468:35088,35469:36676,35470:19988,35471:39993,35472:21494,35473:26907,35474:27194,35475:38788,35476:26666,35477:20828,35478:31427,35479:33970,35480:37340,35481:37772,35482:22107,35483:40232,35484:26658,35485:33541,35486:33841,35487:31909,35488:21e3,35489:33477,35490:29926,35491:20094,35492:20355,35493:20896,35494:23506,35495:21002,35496:21208,35497:21223,35498:24059,35499:21914,35500:22570,35501:23014,35502:23436,35503:23448,35504:23515,35505:24178,35506:24185,35507:24739,35508:24863,35509:24931,35510:25022,35511:25563,35512:25954,35513:26577,35514:26707,35515:26874,35516:27454,35517:27475,35518:27735,35519:28450,35520:28567,35521:28485,35522:29872,35523:29976,35524:30435,35525:30475,35526:31487,35527:31649,35528:31777,35529:32233,35530:32566,35531:32752,35532:32925,35533:33382,35534:33694,35535:35251,35536:35532,35537:36011,35538:36996,35539:37969,35540:38291,35541:38289,35542:38306,35543:38501,35544:38867,35545:39208,35546:33304,35547:20024,35548:21547,35549:23736,35550:24012,35551:29609,35552:30284,35553:30524,35554:23721,35555:32747,35556:36107,35557:38593,35558:38929,35559:38996,35560:39e3,35561:20225,35562:20238,35563:21361,35564:21916,35565:22120,35566:22522,35567:22855,35568:23305,35569:23492,35570:23696,35571:24076,35572:24190,35573:24524,35574:25582,35575:26426,35576:26071,35577:26082,35578:26399,35579:26827,35580:26820,35648:27231,35649:24112,35650:27589,35651:27671,35652:27773,35653:30079,35654:31048,35655:23395,35656:31232,35657:32e3,35658:24509,35659:35215,35660:35352,35661:36020,35662:36215,35663:36556,35664:36637,35665:39138,35666:39438,35667:39740,35668:20096,35669:20605,35670:20736,35671:22931,35672:23452,35673:25135,35674:25216,35675:25836,35676:27450,35677:29344,35678:30097,35679:31047,35680:32681,35681:34811,35682:35516,35683:35696,35684:25516,35685:33738,35686:38816,35687:21513,35688:21507,35689:21931,35690:26708,35691:27224,35692:35440,35693:30759,35694:26485,35695:40653,35696:21364,35697:23458,35698:33050,35699:34384,35700:36870,35701:19992,35702:20037,35703:20167,35704:20241,35705:21450,35706:21560,35707:23470,35708:24339,35709:24613,35710:25937,35712:26429,35713:27714,35714:27762,35715:27875,35716:28792,35717:29699,35718:31350,35719:31406,35720:31496,35721:32026,35722:31998,35723:32102,35724:26087,35725:29275,35726:21435,35727:23621,35728:24040,35729:25298,35730:25312,35731:25369,35732:28192,35733:34394,35734:35377,35735:36317,35736:37624,35737:28417,35738:31142,35739:39770,35740:20136,35741:20139,35742:20140,35743:20379,35744:20384,35745:20689,35746:20807,35747:31478,35748:20849,35749:20982,35750:21332,35751:21281,35752:21375,35753:21483,35754:21932,35755:22659,35756:23777,35757:24375,35758:24394,35759:24623,35760:24656,35761:24685,35762:25375,35763:25945,35764:27211,35765:27841,35766:29378,35767:29421,35768:30703,35769:33016,35770:33029,35771:33288,35772:34126,35773:37111,35774:37857,35775:38911,35776:39255,35777:39514,35778:20208,35779:20957,35780:23597,35781:26241,35782:26989,35783:23616,35784:26354,35785:26997,35786:29577,35787:26704,35788:31873,35789:20677,35790:21220,35791:22343,35792:24062,35793:37670,35794:26020,35795:27427,35796:27453,35797:29748,35798:31105,35799:31165,35800:31563,35801:32202,35802:33465,35803:33740,35804:34943,35805:35167,35806:35641,35807:36817,35808:37329,35809:21535,35810:37504,35811:20061,35812:20534,35813:21477,35814:21306,35815:29399,35816:29590,35817:30697,35818:33510,35819:36527,35820:39366,35821:39368,35822:39378,35823:20855,35824:24858,35825:34398,35826:21936,35827:31354,35828:20598,35829:23507,35830:36935,35831:38533,35832:20018,35833:27355,35834:37351,35835:23633,35836:23624,35904:25496,35905:31391,35906:27795,35907:38772,35908:36705,35909:31402,35910:29066,35911:38536,35912:31874,35913:26647,35914:32368,35915:26705,35916:37740,35917:21234,35918:21531,35919:34219,35920:35347,35921:32676,35922:36557,35923:37089,35924:21350,35925:34952,35926:31041,35927:20418,35928:20670,35929:21009,35930:20804,35931:21843,35932:22317,35933:29674,35934:22411,35935:22865,35936:24418,35937:24452,35938:24693,35939:24950,35940:24935,35941:25001,35942:25522,35943:25658,35944:25964,35945:26223,35946:26690,35947:28179,35948:30054,35949:31293,35950:31995,35951:32076,35952:32153,35953:32331,35954:32619,35955:33550,35956:33610,35957:34509,35958:35336,35959:35427,35960:35686,35961:36605,35962:38938,35963:40335,35964:33464,35965:36814,35966:39912,35968:21127,35969:25119,35970:25731,35971:28608,35972:38553,35973:26689,35974:20625,35975:27424,35976:27770,35977:28500,35978:31348,35979:32080,35980:34880,35981:35363,35982:26376,35983:20214,35984:20537,35985:20518,35986:20581,35987:20860,35988:21048,35989:21091,35990:21927,35991:22287,35992:22533,35993:23244,35994:24314,35995:25010,35996:25080,35997:25331,35998:25458,35999:26908,36e3:27177,36001:29309,36002:29356,36003:29486,36004:30740,36005:30831,36006:32121,36007:30476,36008:32937,36009:35211,36010:35609,36011:36066,36012:36562,36013:36963,36014:37749,36015:38522,36016:38997,36017:39443,36018:40568,36019:20803,36020:21407,36021:21427,36022:24187,36023:24358,36024:28187,36025:28304,36026:29572,36027:29694,36028:32067,36029:33335,36030:35328,36031:35578,36032:38480,36033:20046,36034:20491,36035:21476,36036:21628,36037:22266,36038:22993,36039:23396,36040:24049,36041:24235,36042:24359,36043:25144,36044:25925,36045:26543,36046:28246,36047:29392,36048:31946,36049:34996,36050:32929,36051:32993,36052:33776,36053:34382,36054:35463,36055:36328,36056:37431,36057:38599,36058:39015,36059:40723,36060:20116,36061:20114,36062:20237,36063:21320,36064:21577,36065:21566,36066:23087,36067:24460,36068:24481,36069:24735,36070:26791,36071:27278,36072:29786,36073:30849,36074:35486,36075:35492,36076:35703,36077:37264,36078:20062,36079:39881,36080:20132,36081:20348,36082:20399,36083:20505,36084:20502,36085:20809,36086:20844,36087:21151,36088:21177,36089:21246,36090:21402,36091:21475,36092:21521,36160:21518,36161:21897,36162:22353,36163:22434,36164:22909,36165:23380,36166:23389,36167:23439,36168:24037,36169:24039,36170:24055,36171:24184,36172:24195,36173:24218,36174:24247,36175:24344,36176:24658,36177:24908,36178:25239,36179:25304,36180:25511,36181:25915,36182:26114,36183:26179,36184:26356,36185:26477,36186:26657,36187:26775,36188:27083,36189:27743,36190:27946,36191:28009,36192:28207,36193:28317,36194:30002,36195:30343,36196:30828,36197:31295,36198:31968,36199:32005,36200:32024,36201:32094,36202:32177,36203:32789,36204:32771,36205:32943,36206:32945,36207:33108,36208:33167,36209:33322,36210:33618,36211:34892,36212:34913,36213:35611,36214:36002,36215:36092,36216:37066,36217:37237,36218:37489,36219:30783,36220:37628,36221:38308,36222:38477,36224:38917,36225:39321,36226:39640,36227:40251,36228:21083,36229:21163,36230:21495,36231:21512,36232:22741,36233:25335,36234:28640,36235:35946,36236:36703,36237:40633,36238:20811,36239:21051,36240:21578,36241:22269,36242:31296,36243:37239,36244:40288,36245:40658,36246:29508,36247:28425,36248:33136,36249:29969,36250:24573,36251:24794,36252:39592,36253:29403,36254:36796,36255:27492,36256:38915,36257:20170,36258:22256,36259:22372,36260:22718,36261:23130,36262:24680,36263:25031,36264:26127,36265:26118,36266:26681,36267:26801,36268:28151,36269:30165,36270:32058,36271:33390,36272:39746,36273:20123,36274:20304,36275:21449,36276:21766,36277:23919,36278:24038,36279:24046,36280:26619,36281:27801,36282:29811,36283:30722,36284:35408,36285:37782,36286:35039,36287:22352,36288:24231,36289:25387,36290:20661,36291:20652,36292:20877,36293:26368,36294:21705,36295:22622,36296:22971,36297:23472,36298:24425,36299:25165,36300:25505,36301:26685,36302:27507,36303:28168,36304:28797,36305:37319,36306:29312,36307:30741,36308:30758,36309:31085,36310:25998,36311:32048,36312:33756,36313:35009,36314:36617,36315:38555,36316:21092,36317:22312,36318:26448,36319:32618,36320:36001,36321:20916,36322:22338,36323:38442,36324:22586,36325:27018,36326:32948,36327:21682,36328:23822,36329:22524,36330:30869,36331:40442,36332:20316,36333:21066,36334:21643,36335:25662,36336:26152,36337:26388,36338:26613,36339:31364,36340:31574,36341:32034,36342:37679,36343:26716,36344:39853,36345:31545,36346:21273,36347:20874,36348:21047,36416:23519,36417:25334,36418:25774,36419:25830,36420:26413,36421:27578,36422:34217,36423:38609,36424:30352,36425:39894,36426:25420,36427:37638,36428:39851,36429:30399,36430:26194,36431:19977,36432:20632,36433:21442,36434:23665,36435:24808,36436:25746,36437:25955,36438:26719,36439:29158,36440:29642,36441:29987,36442:31639,36443:32386,36444:34453,36445:35715,36446:36059,36447:37240,36448:39184,36449:26028,36450:26283,36451:27531,36452:20181,36453:20180,36454:20282,36455:20351,36456:21050,36457:21496,36458:21490,36459:21987,36460:22235,36461:22763,36462:22987,36463:22985,36464:23039,36465:23376,36466:23629,36467:24066,36468:24107,36469:24535,36470:24605,36471:25351,36472:25903,36473:23388,36474:26031,36475:26045,36476:26088,36477:26525,36478:27490,36480:27515,36481:27663,36482:29509,36483:31049,36484:31169,36485:31992,36486:32025,36487:32043,36488:32930,36489:33026,36490:33267,36491:35222,36492:35422,36493:35433,36494:35430,36495:35468,36496:35566,36497:36039,36498:36060,36499:38604,36500:39164,36501:27503,36502:20107,36503:20284,36504:20365,36505:20816,36506:23383,36507:23546,36508:24904,36509:25345,36510:26178,36511:27425,36512:28363,36513:27835,36514:29246,36515:29885,36516:30164,36517:30913,36518:31034,36519:32780,36520:32819,36521:33258,36522:33940,36523:36766,36524:27728,36525:40575,36526:24335,36527:35672,36528:40235,36529:31482,36530:36600,36531:23437,36532:38635,36533:19971,36534:21489,36535:22519,36536:22833,36537:23241,36538:23460,36539:24713,36540:28287,36541:28422,36542:30142,36543:36074,36544:23455,36545:34048,36546:31712,36547:20594,36548:26612,36549:33437,36550:23649,36551:34122,36552:32286,36553:33294,36554:20889,36555:23556,36556:25448,36557:36198,36558:26012,36559:29038,36560:31038,36561:32023,36562:32773,36563:35613,36564:36554,36565:36974,36566:34503,36567:37034,36568:20511,36569:21242,36570:23610,36571:26451,36572:28796,36573:29237,36574:37196,36575:37320,36576:37675,36577:33509,36578:23490,36579:24369,36580:24825,36581:20027,36582:21462,36583:23432,36584:25163,36585:26417,36586:27530,36587:29417,36588:29664,36589:31278,36590:33131,36591:36259,36592:37202,36593:39318,36594:20754,36595:21463,36596:21610,36597:23551,36598:25480,36599:27193,36600:32172,36601:38656,36602:22234,36603:21454,36604:21608,36672:23447,36673:23601,36674:24030,36675:20462,36676:24833,36677:25342,36678:27954,36679:31168,36680:31179,36681:32066,36682:32333,36683:32722,36684:33261,36685:33311,36686:33936,36687:34886,36688:35186,36689:35728,36690:36468,36691:36655,36692:36913,36693:37195,36694:37228,36695:38598,36696:37276,36697:20160,36698:20303,36699:20805,36700:21313,36701:24467,36702:25102,36703:26580,36704:27713,36705:28171,36706:29539,36707:32294,36708:37325,36709:37507,36710:21460,36711:22809,36712:23487,36713:28113,36714:31069,36715:32302,36716:31899,36717:22654,36718:29087,36719:20986,36720:34899,36721:36848,36722:20426,36723:23803,36724:26149,36725:30636,36726:31459,36727:33308,36728:39423,36729:20934,36730:24490,36731:26092,36732:26991,36733:27529,36734:28147,36736:28310,36737:28516,36738:30462,36739:32020,36740:24033,36741:36981,36742:37255,36743:38918,36744:20966,36745:21021,36746:25152,36747:26257,36748:26329,36749:28186,36750:24246,36751:32210,36752:32626,36753:26360,36754:34223,36755:34295,36756:35576,36757:21161,36758:21465,36759:22899,36760:24207,36761:24464,36762:24661,36763:37604,36764:38500,36765:20663,36766:20767,36767:21213,36768:21280,36769:21319,36770:21484,36771:21736,36772:21830,36773:21809,36774:22039,36775:22888,36776:22974,36777:23100,36778:23477,36779:23558,36780:23567,36781:23569,36782:23578,36783:24196,36784:24202,36785:24288,36786:24432,36787:25215,36788:25220,36789:25307,36790:25484,36791:25463,36792:26119,36793:26124,36794:26157,36795:26230,36796:26494,36797:26786,36798:27167,36799:27189,36800:27836,36801:28040,36802:28169,36803:28248,36804:28988,36805:28966,36806:29031,36807:30151,36808:30465,36809:30813,36810:30977,36811:31077,36812:31216,36813:31456,36814:31505,36815:31911,36816:32057,36817:32918,36818:33750,36819:33931,36820:34121,36821:34909,36822:35059,36823:35359,36824:35388,36825:35412,36826:35443,36827:35937,36828:36062,36829:37284,36830:37478,36831:37758,36832:37912,36833:38556,36834:38808,36835:19978,36836:19976,36837:19998,36838:20055,36839:20887,36840:21104,36841:22478,36842:22580,36843:22732,36844:23330,36845:24120,36846:24773,36847:25854,36848:26465,36849:26454,36850:27972,36851:29366,36852:30067,36853:31331,36854:33976,36855:35698,36856:37304,36857:37664,36858:22065,36859:22516,36860:39166,36928:25325,36929:26893,36930:27542,36931:29165,36932:32340,36933:32887,36934:33394,36935:35302,36936:39135,36937:34645,36938:36785,36939:23611,36940:20280,36941:20449,36942:20405,36943:21767,36944:23072,36945:23517,36946:23529,36947:24515,36948:24910,36949:25391,36950:26032,36951:26187,36952:26862,36953:27035,36954:28024,36955:28145,36956:30003,36957:30137,36958:30495,36959:31070,36960:31206,36961:32051,36962:33251,36963:33455,36964:34218,36965:35242,36966:35386,36967:36523,36968:36763,36969:36914,36970:37341,36971:38663,36972:20154,36973:20161,36974:20995,36975:22645,36976:22764,36977:23563,36978:29978,36979:23613,36980:33102,36981:35338,36982:36805,36983:38499,36984:38765,36985:31525,36986:35535,36987:38920,36988:37218,36989:22259,36990:21416,36992:36887,36993:21561,36994:22402,36995:24101,36996:25512,36997:27700,36998:28810,36999:30561,37e3:31883,37001:32736,37002:34928,37003:36930,37004:37204,37005:37648,37006:37656,37007:38543,37008:29790,37009:39620,37010:23815,37011:23913,37012:25968,37013:26530,37014:36264,37015:38619,37016:25454,37017:26441,37018:26905,37019:33733,37020:38935,37021:38592,37022:35070,37023:28548,37024:25722,37025:23544,37026:19990,37027:28716,37028:30045,37029:26159,37030:20932,37031:21046,37032:21218,37033:22995,37034:24449,37035:24615,37036:25104,37037:25919,37038:25972,37039:26143,37040:26228,37041:26866,37042:26646,37043:27491,37044:28165,37045:29298,37046:29983,37047:30427,37048:31934,37049:32854,37050:22768,37051:35069,37052:35199,37053:35488,37054:35475,37055:35531,37056:36893,37057:37266,37058:38738,37059:38745,37060:25993,37061:31246,37062:33030,37063:38587,37064:24109,37065:24796,37066:25114,37067:26021,37068:26132,37069:26512,37070:30707,37071:31309,37072:31821,37073:32318,37074:33034,37075:36012,37076:36196,37077:36321,37078:36447,37079:30889,37080:20999,37081:25305,37082:25509,37083:25666,37084:25240,37085:35373,37086:31363,37087:31680,37088:35500,37089:38634,37090:32118,37091:33292,37092:34633,37093:20185,37094:20808,37095:21315,37096:21344,37097:23459,37098:23554,37099:23574,37100:24029,37101:25126,37102:25159,37103:25776,37104:26643,37105:26676,37106:27849,37107:27973,37108:27927,37109:26579,37110:28508,37111:29006,37112:29053,37113:26059,37114:31359,37115:31661,37116:32218,37184:32330,37185:32680,37186:33146,37187:33307,37188:33337,37189:34214,37190:35438,37191:36046,37192:36341,37193:36984,37194:36983,37195:37549,37196:37521,37197:38275,37198:39854,37199:21069,37200:21892,37201:28472,37202:28982,37203:20840,37204:31109,37205:32341,37206:33203,37207:31950,37208:22092,37209:22609,37210:23720,37211:25514,37212:26366,37213:26365,37214:26970,37215:29401,37216:30095,37217:30094,37218:30990,37219:31062,37220:31199,37221:31895,37222:32032,37223:32068,37224:34311,37225:35380,37226:38459,37227:36961,37228:40736,37229:20711,37230:21109,37231:21452,37232:21474,37233:20489,37234:21930,37235:22766,37236:22863,37237:29245,37238:23435,37239:23652,37240:21277,37241:24803,37242:24819,37243:25436,37244:25475,37245:25407,37246:25531,37248:25805,37249:26089,37250:26361,37251:24035,37252:27085,37253:27133,37254:28437,37255:29157,37256:20105,37257:30185,37258:30456,37259:31379,37260:31967,37261:32207,37262:32156,37263:32865,37264:33609,37265:33624,37266:33900,37267:33980,37268:34299,37269:35013,37270:36208,37271:36865,37272:36973,37273:37783,37274:38684,37275:39442,37276:20687,37277:22679,37278:24974,37279:33235,37280:34101,37281:36104,37282:36896,37283:20419,37284:20596,37285:21063,37286:21363,37287:24687,37288:25417,37289:26463,37290:28204,37291:36275,37292:36895,37293:20439,37294:23646,37295:36042,37296:26063,37297:32154,37298:21330,37299:34966,37300:20854,37301:25539,37302:23384,37303:23403,37304:23562,37305:25613,37306:26449,37307:36956,37308:20182,37309:22810,37310:22826,37311:27760,37312:35409,37313:21822,37314:22549,37315:22949,37316:24816,37317:25171,37318:26561,37319:33333,37320:26965,37321:38464,37322:39364,37323:39464,37324:20307,37325:22534,37326:23550,37327:32784,37328:23729,37329:24111,37330:24453,37331:24608,37332:24907,37333:25140,37334:26367,37335:27888,37336:28382,37337:32974,37338:33151,37339:33492,37340:34955,37341:36024,37342:36864,37343:36910,37344:38538,37345:40667,37346:39899,37347:20195,37348:21488,37349:22823,37350:31532,37351:37261,37352:38988,37353:40441,37354:28381,37355:28711,37356:21331,37357:21828,37358:23429,37359:25176,37360:25246,37361:25299,37362:27810,37363:28655,37364:29730,37365:35351,37366:37944,37367:28609,37368:35582,37369:33592,37370:20967,37371:34552,37372:21482,37440:21481,37441:20294,37442:36948,37443:36784,37444:22890,37445:33073,37446:24061,37447:31466,37448:36799,37449:26842,37450:35895,37451:29432,37452:40008,37453:27197,37454:35504,37455:20025,37456:21336,37457:22022,37458:22374,37459:25285,37460:25506,37461:26086,37462:27470,37463:28129,37464:28251,37465:28845,37466:30701,37467:31471,37468:31658,37469:32187,37470:32829,37471:32966,37472:34507,37473:35477,37474:37723,37475:22243,37476:22727,37477:24382,37478:26029,37479:26262,37480:27264,37481:27573,37482:30007,37483:35527,37484:20516,37485:30693,37486:22320,37487:24347,37488:24677,37489:26234,37490:27744,37491:30196,37492:31258,37493:32622,37494:33268,37495:34584,37496:36933,37497:39347,37498:31689,37499:30044,37500:31481,37501:31569,37502:33988,37504:36880,37505:31209,37506:31378,37507:33590,37508:23265,37509:30528,37510:20013,37511:20210,37512:23449,37513:24544,37514:25277,37515:26172,37516:26609,37517:27880,37518:34411,37519:34935,37520:35387,37521:37198,37522:37619,37523:39376,37524:27159,37525:28710,37526:29482,37527:33511,37528:33879,37529:36015,37530:19969,37531:20806,37532:20939,37533:21899,37534:23541,37535:24086,37536:24115,37537:24193,37538:24340,37539:24373,37540:24427,37541:24500,37542:25074,37543:25361,37544:26274,37545:26397,37546:28526,37547:29266,37548:30010,37549:30522,37550:32884,37551:33081,37552:33144,37553:34678,37554:35519,37555:35548,37556:36229,37557:36339,37558:37530,37559:38263,37560:38914,37561:40165,37562:21189,37563:25431,37564:30452,37565:26389,37566:27784,37567:29645,37568:36035,37569:37806,37570:38515,37571:27941,37572:22684,37573:26894,37574:27084,37575:36861,37576:37786,37577:30171,37578:36890,37579:22618,37580:26626,37581:25524,37582:27131,37583:20291,37584:28460,37585:26584,37586:36795,37587:34086,37588:32180,37589:37716,37590:26943,37591:28528,37592:22378,37593:22775,37594:23340,37595:32044,37596:29226,37597:21514,37598:37347,37599:40372,37600:20141,37601:20302,37602:20572,37603:20597,37604:21059,37605:35998,37606:21576,37607:22564,37608:23450,37609:24093,37610:24213,37611:24237,37612:24311,37613:24351,37614:24716,37615:25269,37616:25402,37617:25552,37618:26799,37619:27712,37620:30855,37621:31118,37622:31243,37623:32224,37624:33351,37625:35330,37626:35558,37627:36420,37628:36883,37696:37048,37697:37165,37698:37336,37699:40718,37700:27877,37701:25688,37702:25826,37703:25973,37704:28404,37705:30340,37706:31515,37707:36969,37708:37841,37709:28346,37710:21746,37711:24505,37712:25764,37713:36685,37714:36845,37715:37444,37716:20856,37717:22635,37718:22825,37719:23637,37720:24215,37721:28155,37722:32399,37723:29980,37724:36028,37725:36578,37726:39003,37727:28857,37728:20253,37729:27583,37730:28593,37731:3e4,37732:38651,37733:20814,37734:21520,37735:22581,37736:22615,37737:22956,37738:23648,37739:24466,37740:26007,37741:26460,37742:28193,37743:30331,37744:33759,37745:36077,37746:36884,37747:37117,37748:37709,37749:30757,37750:30778,37751:21162,37752:24230,37753:22303,37754:22900,37755:24594,37756:20498,37757:20826,37758:20908,37760:20941,37761:20992,37762:21776,37763:22612,37764:22616,37765:22871,37766:23445,37767:23798,37768:23947,37769:24764,37770:25237,37771:25645,37772:26481,37773:26691,37774:26812,37775:26847,37776:30423,37777:28120,37778:28271,37779:28059,37780:28783,37781:29128,37782:24403,37783:30168,37784:31095,37785:31561,37786:31572,37787:31570,37788:31958,37789:32113,37790:21040,37791:33891,37792:34153,37793:34276,37794:35342,37795:35588,37796:35910,37797:36367,37798:36867,37799:36879,37800:37913,37801:38518,37802:38957,37803:39472,37804:38360,37805:20685,37806:21205,37807:21516,37808:22530,37809:23566,37810:24999,37811:25758,37812:27934,37813:30643,37814:31461,37815:33012,37816:33796,37817:36947,37818:37509,37819:23776,37820:40199,37821:21311,37822:24471,37823:24499,37824:28060,37825:29305,37826:30563,37827:31167,37828:31716,37829:27602,37830:29420,37831:35501,37832:26627,37833:27233,37834:20984,37835:31361,37836:26932,37837:23626,37838:40182,37839:33515,37840:23493,37841:37193,37842:28702,37843:22136,37844:23663,37845:24775,37846:25958,37847:27788,37848:35930,37849:36929,37850:38931,37851:21585,37852:26311,37853:37389,37854:22856,37855:37027,37856:20869,37857:20045,37858:20970,37859:34201,37860:35598,37861:28760,37862:25466,37863:37707,37864:26978,37865:39348,37866:32260,37867:30071,37868:21335,37869:26976,37870:36575,37871:38627,37872:27741,37873:20108,37874:23612,37875:24336,37876:36841,37877:21250,37878:36049,37879:32905,37880:34425,37881:24319,37882:26085,37883:20083,37884:20837,37952:22914,37953:23615,37954:38894,37955:20219,37956:22922,37957:24525,37958:35469,37959:28641,37960:31152,37961:31074,37962:23527,37963:33905,37964:29483,37965:29105,37966:24180,37967:24565,37968:25467,37969:25754,37970:29123,37971:31896,37972:20035,37973:24316,37974:20043,37975:22492,37976:22178,37977:24745,37978:28611,37979:32013,37980:33021,37981:33075,37982:33215,37983:36786,37984:35223,37985:34468,37986:24052,37987:25226,37988:25773,37989:35207,37990:26487,37991:27874,37992:27966,37993:29750,37994:30772,37995:23110,37996:32629,37997:33453,37998:39340,37999:20467,38e3:24259,38001:25309,38002:25490,38003:25943,38004:26479,38005:30403,38006:29260,38007:32972,38008:32954,38009:36649,38010:37197,38011:20493,38012:22521,38013:23186,38014:26757,38016:26995,38017:29028,38018:29437,38019:36023,38020:22770,38021:36064,38022:38506,38023:36889,38024:34687,38025:31204,38026:30695,38027:33833,38028:20271,38029:21093,38030:21338,38031:25293,38032:26575,38033:27850,38034:30333,38035:31636,38036:31893,38037:33334,38038:34180,38039:36843,38040:26333,38041:28448,38042:29190,38043:32283,38044:33707,38045:39361,38046:40614,38047:20989,38048:31665,38049:30834,38050:31672,38051:32903,38052:31560,38053:27368,38054:24161,38055:32908,38056:30033,38057:30048,38058:20843,38059:37474,38060:28300,38061:30330,38062:37271,38063:39658,38064:20240,38065:32624,38066:25244,38067:31567,38068:38309,38069:40169,38070:22138,38071:22617,38072:34532,38073:38588,38074:20276,38075:21028,38076:21322,38077:21453,38078:21467,38079:24070,38080:25644,38081:26001,38082:26495,38083:27710,38084:27726,38085:29256,38086:29359,38087:29677,38088:30036,38089:32321,38090:33324,38091:34281,38092:36009,38093:31684,38094:37318,38095:29033,38096:38930,38097:39151,38098:25405,38099:26217,38100:30058,38101:30436,38102:30928,38103:34115,38104:34542,38105:21290,38106:21329,38107:21542,38108:22915,38109:24199,38110:24444,38111:24754,38112:25161,38113:25209,38114:25259,38115:26e3,38116:27604,38117:27852,38118:30130,38119:30382,38120:30865,38121:31192,38122:32203,38123:32631,38124:32933,38125:34987,38126:35513,38127:36027,38128:36991,38129:38750,38130:39131,38131:27147,38132:31800,38133:20633,38134:23614,38135:24494,38136:26503,38137:27608,38138:29749,38139:30473,38140:32654,38208:40763,38209:26570,38210:31255,38211:21305,38212:30091,38213:39661,38214:24422,38215:33181,38216:33777,38217:32920,38218:24380,38219:24517,38220:30050,38221:31558,38222:36924,38223:26727,38224:23019,38225:23195,38226:32016,38227:30334,38228:35628,38229:20469,38230:24426,38231:27161,38232:27703,38233:28418,38234:29922,38235:31080,38236:34920,38237:35413,38238:35961,38239:24287,38240:25551,38241:30149,38242:31186,38243:33495,38244:37672,38245:37618,38246:33948,38247:34541,38248:39981,38249:21697,38250:24428,38251:25996,38252:27996,38253:28693,38254:36007,38255:36051,38256:38971,38257:25935,38258:29942,38259:19981,38260:20184,38261:22496,38262:22827,38263:23142,38264:23500,38265:20904,38266:24067,38267:24220,38268:24598,38269:25206,38270:25975,38272:26023,38273:26222,38274:28014,38275:29238,38276:31526,38277:33104,38278:33178,38279:33433,38280:35676,38281:36e3,38282:36070,38283:36212,38284:38428,38285:38468,38286:20398,38287:25771,38288:27494,38289:33310,38290:33889,38291:34154,38292:37096,38293:23553,38294:26963,38295:39080,38296:33914,38297:34135,38298:20239,38299:21103,38300:24489,38301:24133,38302:26381,38303:31119,38304:33145,38305:35079,38306:35206,38307:28149,38308:24343,38309:25173,38310:27832,38311:20175,38312:29289,38313:39826,38314:20998,38315:21563,38316:22132,38317:22707,38318:24996,38319:25198,38320:28954,38321:22894,38322:31881,38323:31966,38324:32027,38325:38640,38326:25991,38327:32862,38328:19993,38329:20341,38330:20853,38331:22592,38332:24163,38333:24179,38334:24330,38335:26564,38336:20006,38337:34109,38338:38281,38339:38491,38340:31859,38341:38913,38342:20731,38343:22721,38344:30294,38345:30887,38346:21029,38347:30629,38348:34065,38349:31622,38350:20559,38351:22793,38352:29255,38353:31687,38354:32232,38355:36794,38356:36820,38357:36941,38358:20415,38359:21193,38360:23081,38361:24321,38362:38829,38363:20445,38364:33303,38365:37610,38366:22275,38367:25429,38368:27497,38369:29995,38370:35036,38371:36628,38372:31298,38373:21215,38374:22675,38375:24917,38376:25098,38377:26286,38378:27597,38379:31807,38380:33769,38381:20515,38382:20472,38383:21253,38384:21574,38385:22577,38386:22857,38387:23453,38388:23792,38389:23791,38390:23849,38391:24214,38392:25265,38393:25447,38394:25918,38395:26041,38396:26379,38464:27861,38465:27873,38466:28921,38467:30770,38468:32299,38469:32990,38470:33459,38471:33804,38472:34028,38473:34562,38474:35090,38475:35370,38476:35914,38477:37030,38478:37586,38479:39165,38480:40179,38481:40300,38482:20047,38483:20129,38484:20621,38485:21078,38486:22346,38487:22952,38488:24125,38489:24536,38490:24537,38491:25151,38492:26292,38493:26395,38494:26576,38495:26834,38496:20882,38497:32033,38498:32938,38499:33192,38500:35584,38501:35980,38502:36031,38503:37502,38504:38450,38505:21536,38506:38956,38507:21271,38508:20693,38509:21340,38510:22696,38511:25778,38512:26420,38513:29287,38514:30566,38515:31302,38516:37350,38517:21187,38518:27809,38519:27526,38520:22528,38521:24140,38522:22868,38523:26412,38524:32763,38525:20961,38526:30406,38528:25705,38529:30952,38530:39764,38531:40635,38532:22475,38533:22969,38534:26151,38535:26522,38536:27598,38537:21737,38538:27097,38539:24149,38540:33180,38541:26517,38542:39850,38543:26622,38544:40018,38545:26717,38546:20134,38547:20451,38548:21448,38549:25273,38550:26411,38551:27819,38552:36804,38553:20397,38554:32365,38555:40639,38556:19975,38557:24930,38558:28288,38559:28459,38560:34067,38561:21619,38562:26410,38563:39749,38564:24051,38565:31637,38566:23724,38567:23494,38568:34588,38569:28234,38570:34001,38571:31252,38572:33032,38573:22937,38574:31885,38575:27665,38576:30496,38577:21209,38578:22818,38579:28961,38580:29279,38581:30683,38582:38695,38583:40289,38584:26891,38585:23167,38586:23064,38587:20901,38588:21517,38589:21629,38590:26126,38591:30431,38592:36855,38593:37528,38594:40180,38595:23018,38596:29277,38597:28357,38598:20813,38599:26825,38600:32191,38601:32236,38602:38754,38603:40634,38604:25720,38605:27169,38606:33538,38607:22916,38608:23391,38609:27611,38610:29467,38611:30450,38612:32178,38613:32791,38614:33945,38615:20786,38616:26408,38617:40665,38618:30446,38619:26466,38620:21247,38621:39173,38622:23588,38623:25147,38624:31870,38625:36016,38626:21839,38627:24758,38628:32011,38629:38272,38630:21249,38631:20063,38632:20918,38633:22812,38634:29242,38635:32822,38636:37326,38637:24357,38638:30690,38639:21380,38640:24441,38641:32004,38642:34220,38643:35379,38644:36493,38645:38742,38646:26611,38647:34222,38648:37971,38649:24841,38650:24840,38651:27833,38652:30290,38720:35565,38721:36664,38722:21807,38723:20305,38724:20778,38725:21191,38726:21451,38727:23461,38728:24189,38729:24736,38730:24962,38731:25558,38732:26377,38733:26586,38734:28263,38735:28044,38736:29494,38737:29495,38738:30001,38739:31056,38740:35029,38741:35480,38742:36938,38743:37009,38744:37109,38745:38596,38746:34701,38747:22805,38748:20104,38749:20313,38750:19982,38751:35465,38752:36671,38753:38928,38754:20653,38755:24188,38756:22934,38757:23481,38758:24248,38759:25562,38760:25594,38761:25793,38762:26332,38763:26954,38764:27096,38765:27915,38766:28342,38767:29076,38768:29992,38769:31407,38770:32650,38771:32768,38772:33865,38773:33993,38774:35201,38775:35617,38776:36362,38777:36965,38778:38525,38779:39178,38780:24958,38781:25233,38782:27442,38784:27779,38785:28020,38786:32716,38787:32764,38788:28096,38789:32645,38790:34746,38791:35064,38792:26469,38793:33713,38794:38972,38795:38647,38796:27931,38797:32097,38798:33853,38799:37226,38800:20081,38801:21365,38802:23888,38803:27396,38804:28651,38805:34253,38806:34349,38807:35239,38808:21033,38809:21519,38810:23653,38811:26446,38812:26792,38813:29702,38814:29827,38815:30178,38816:35023,38817:35041,38818:37324,38819:38626,38820:38520,38821:24459,38822:29575,38823:31435,38824:33870,38825:25504,38826:30053,38827:21129,38828:27969,38829:28316,38830:29705,38831:30041,38832:30827,38833:31890,38834:38534,38835:31452,38836:40845,38837:20406,38838:24942,38839:26053,38840:34396,38841:20102,38842:20142,38843:20698,38844:20001,38845:20940,38846:23534,38847:26009,38848:26753,38849:28092,38850:29471,38851:30274,38852:30637,38853:31260,38854:31975,38855:33391,38856:35538,38857:36988,38858:37327,38859:38517,38860:38936,38861:21147,38862:32209,38863:20523,38864:21400,38865:26519,38866:28107,38867:29136,38868:29747,38869:33256,38870:36650,38871:38563,38872:40023,38873:40607,38874:29792,38875:22593,38876:28057,38877:32047,38878:39006,38879:20196,38880:20278,38881:20363,38882:20919,38883:21169,38884:23994,38885:24604,38886:29618,38887:31036,38888:33491,38889:37428,38890:38583,38891:38646,38892:38666,38893:40599,38894:40802,38895:26278,38896:27508,38897:21015,38898:21155,38899:28872,38900:35010,38901:24265,38902:24651,38903:24976,38904:28451,38905:29001,38906:31806,38907:32244,38908:32879,38976:34030,38977:36899,38978:37676,38979:21570,38980:39791,38981:27347,38982:28809,38983:36034,38984:36335,38985:38706,38986:21172,38987:23105,38988:24266,38989:24324,38990:26391,38991:27004,38992:27028,38993:28010,38994:28431,38995:29282,38996:29436,38997:31725,38998:32769,38999:32894,39e3:34635,39001:37070,39002:20845,39003:40595,39004:31108,39005:32907,39006:37682,39007:35542,39008:20525,39009:21644,39010:35441,39011:27498,39012:36036,39013:33031,39014:24785,39015:26528,39016:40434,39017:20121,39018:20120,39019:39952,39020:35435,39021:34241,39022:34152,39023:26880,39024:28286,39025:30871,39026:33109,39071:24332,39072:19984,39073:19989,39074:20010,39075:20017,39076:20022,39077:20028,39078:20031,39079:20034,39080:20054,39081:20056,39082:20098,39083:20101,39084:35947,39085:20106,39086:33298,39087:24333,39088:20110,39089:20126,39090:20127,39091:20128,39092:20130,39093:20144,39094:20147,39095:20150,39096:20174,39097:20173,39098:20164,39099:20166,39100:20162,39101:20183,39102:20190,39103:20205,39104:20191,39105:20215,39106:20233,39107:20314,39108:20272,39109:20315,39110:20317,39111:20311,39112:20295,39113:20342,39114:20360,39115:20367,39116:20376,39117:20347,39118:20329,39119:20336,39120:20369,39121:20335,39122:20358,39123:20374,39124:20760,39125:20436,39126:20447,39127:20430,39128:20440,39129:20443,39130:20433,39131:20442,39132:20432,39133:20452,39134:20453,39135:20506,39136:20520,39137:20500,39138:20522,39139:20517,39140:20485,39141:20252,39142:20470,39143:20513,39144:20521,39145:20524,39146:20478,39147:20463,39148:20497,39149:20486,39150:20547,39151:20551,39152:26371,39153:20565,39154:20560,39155:20552,39156:20570,39157:20566,39158:20588,39159:20600,39160:20608,39161:20634,39162:20613,39163:20660,39164:20658,39232:20681,39233:20682,39234:20659,39235:20674,39236:20694,39237:20702,39238:20709,39239:20717,39240:20707,39241:20718,39242:20729,39243:20725,39244:20745,39245:20737,39246:20738,39247:20758,39248:20757,39249:20756,39250:20762,39251:20769,39252:20794,39253:20791,39254:20796,39255:20795,39256:20799,39257:20800,39258:20818,39259:20812,39260:20820,39261:20834,39262:31480,39263:20841,39264:20842,39265:20846,39266:20864,39267:20866,39268:22232,39269:20876,39270:20873,39271:20879,39272:20881,39273:20883,39274:20885,39275:20886,39276:20900,39277:20902,39278:20898,39279:20905,39280:20906,39281:20907,39282:20915,39283:20913,39284:20914,39285:20912,39286:20917,39287:20925,39288:20933,39289:20937,39290:20955,39291:20960,39292:34389,39293:20969,39294:20973,39296:20976,39297:20981,39298:20990,39299:20996,39300:21003,39301:21012,39302:21006,39303:21031,39304:21034,39305:21038,39306:21043,39307:21049,39308:21071,39309:21060,39310:21067,39311:21068,39312:21086,39313:21076,39314:21098,39315:21108,39316:21097,39317:21107,39318:21119,39319:21117,39320:21133,39321:21140,39322:21138,39323:21105,39324:21128,39325:21137,39326:36776,39327:36775,39328:21164,39329:21165,39330:21180,39331:21173,39332:21185,39333:21197,39334:21207,39335:21214,39336:21219,39337:21222,39338:39149,39339:21216,39340:21235,39341:21237,39342:21240,39343:21241,39344:21254,39345:21256,39346:30008,39347:21261,39348:21264,39349:21263,39350:21269,39351:21274,39352:21283,39353:21295,39354:21297,39355:21299,39356:21304,39357:21312,39358:21318,39359:21317,39360:19991,39361:21321,39362:21325,39363:20950,39364:21342,39365:21353,39366:21358,39367:22808,39368:21371,39369:21367,39370:21378,39371:21398,39372:21408,39373:21414,39374:21413,39375:21422,39376:21424,39377:21430,39378:21443,39379:31762,39380:38617,39381:21471,39382:26364,39383:29166,39384:21486,39385:21480,39386:21485,39387:21498,39388:21505,39389:21565,39390:21568,39391:21548,39392:21549,39393:21564,39394:21550,39395:21558,39396:21545,39397:21533,39398:21582,39399:21647,39400:21621,39401:21646,39402:21599,39403:21617,39404:21623,39405:21616,39406:21650,39407:21627,39408:21632,39409:21622,39410:21636,39411:21648,39412:21638,39413:21703,39414:21666,39415:21688,39416:21669,39417:21676,39418:21700,39419:21704,39420:21672,39488:21675,39489:21698,39490:21668,39491:21694,39492:21692,39493:21720,39494:21733,39495:21734,39496:21775,39497:21780,39498:21757,39499:21742,39500:21741,39501:21754,39502:21730,39503:21817,39504:21824,39505:21859,39506:21836,39507:21806,39508:21852,39509:21829,39510:21846,39511:21847,39512:21816,39513:21811,39514:21853,39515:21913,39516:21888,39517:21679,39518:21898,39519:21919,39520:21883,39521:21886,39522:21912,39523:21918,39524:21934,39525:21884,39526:21891,39527:21929,39528:21895,39529:21928,39530:21978,39531:21957,39532:21983,39533:21956,39534:21980,39535:21988,39536:21972,39537:22036,39538:22007,39539:22038,39540:22014,39541:22013,39542:22043,39543:22009,39544:22094,39545:22096,39546:29151,39547:22068,39548:22070,39549:22066,39550:22072,39552:22123,39553:22116,39554:22063,39555:22124,39556:22122,39557:22150,39558:22144,39559:22154,39560:22176,39561:22164,39562:22159,39563:22181,39564:22190,39565:22198,39566:22196,39567:22210,39568:22204,39569:22209,39570:22211,39571:22208,39572:22216,39573:22222,39574:22225,39575:22227,39576:22231,39577:22254,39578:22265,39579:22272,39580:22271,39581:22276,39582:22281,39583:22280,39584:22283,39585:22285,39586:22291,39587:22296,39588:22294,39589:21959,39590:22300,39591:22310,39592:22327,39593:22328,39594:22350,39595:22331,39596:22336,39597:22351,39598:22377,39599:22464,39600:22408,39601:22369,39602:22399,39603:22409,39604:22419,39605:22432,39606:22451,39607:22436,39608:22442,39609:22448,39610:22467,39611:22470,39612:22484,39613:22482,39614:22483,39615:22538,39616:22486,39617:22499,39618:22539,39619:22553,39620:22557,39621:22642,39622:22561,39623:22626,39624:22603,39625:22640,39626:27584,39627:22610,39628:22589,39629:22649,39630:22661,39631:22713,39632:22687,39633:22699,39634:22714,39635:22750,39636:22715,39637:22712,39638:22702,39639:22725,39640:22739,39641:22737,39642:22743,39643:22745,39644:22744,39645:22757,39646:22748,39647:22756,39648:22751,39649:22767,39650:22778,39651:22777,39652:22779,39653:22780,39654:22781,39655:22786,39656:22794,39657:22800,39658:22811,39659:26790,39660:22821,39661:22828,39662:22829,39663:22834,39664:22840,39665:22846,39666:31442,39667:22869,39668:22864,39669:22862,39670:22874,39671:22872,39672:22882,39673:22880,39674:22887,39675:22892,39676:22889,39744:22904,39745:22913,39746:22941,39747:20318,39748:20395,39749:22947,39750:22962,39751:22982,39752:23016,39753:23004,39754:22925,39755:23001,39756:23002,39757:23077,39758:23071,39759:23057,39760:23068,39761:23049,39762:23066,39763:23104,39764:23148,39765:23113,39766:23093,39767:23094,39768:23138,39769:23146,39770:23194,39771:23228,39772:23230,39773:23243,39774:23234,39775:23229,39776:23267,39777:23255,39778:23270,39779:23273,39780:23254,39781:23290,39782:23291,39783:23308,39784:23307,39785:23318,39786:23346,39787:23248,39788:23338,39789:23350,39790:23358,39791:23363,39792:23365,39793:23360,39794:23377,39795:23381,39796:23386,39797:23387,39798:23397,39799:23401,39800:23408,39801:23411,39802:23413,39803:23416,39804:25992,39805:23418,39806:23424,39808:23427,39809:23462,39810:23480,39811:23491,39812:23495,39813:23497,39814:23508,39815:23504,39816:23524,39817:23526,39818:23522,39819:23518,39820:23525,39821:23531,39822:23536,39823:23542,39824:23539,39825:23557,39826:23559,39827:23560,39828:23565,39829:23571,39830:23584,39831:23586,39832:23592,39833:23608,39834:23609,39835:23617,39836:23622,39837:23630,39838:23635,39839:23632,39840:23631,39841:23409,39842:23660,39843:23662,39844:20066,39845:23670,39846:23673,39847:23692,39848:23697,39849:23700,39850:22939,39851:23723,39852:23739,39853:23734,39854:23740,39855:23735,39856:23749,39857:23742,39858:23751,39859:23769,39860:23785,39861:23805,39862:23802,39863:23789,39864:23948,39865:23786,39866:23819,39867:23829,39868:23831,39869:23900,39870:23839,39871:23835,39872:23825,39873:23828,39874:23842,39875:23834,39876:23833,39877:23832,39878:23884,39879:23890,39880:23886,39881:23883,39882:23916,39883:23923,39884:23926,39885:23943,39886:23940,39887:23938,39888:23970,39889:23965,39890:23980,39891:23982,39892:23997,39893:23952,39894:23991,39895:23996,39896:24009,39897:24013,39898:24019,39899:24018,39900:24022,39901:24027,39902:24043,39903:24050,39904:24053,39905:24075,39906:24090,39907:24089,39908:24081,39909:24091,39910:24118,39911:24119,39912:24132,39913:24131,39914:24128,39915:24142,39916:24151,39917:24148,39918:24159,39919:24162,39920:24164,39921:24135,39922:24181,39923:24182,39924:24186,39925:40636,39926:24191,39927:24224,39928:24257,39929:24258,39930:24264,39931:24272,39932:24271,4e4:24278,40001:24291,40002:24285,40003:24282,40004:24283,40005:24290,40006:24289,40007:24296,40008:24297,40009:24300,40010:24305,40011:24307,40012:24304,40013:24308,40014:24312,40015:24318,40016:24323,40017:24329,40018:24413,40019:24412,40020:24331,40021:24337,40022:24342,40023:24361,40024:24365,40025:24376,40026:24385,40027:24392,40028:24396,40029:24398,40030:24367,40031:24401,40032:24406,40033:24407,40034:24409,40035:24417,40036:24429,40037:24435,40038:24439,40039:24451,40040:24450,40041:24447,40042:24458,40043:24456,40044:24465,40045:24455,40046:24478,40047:24473,40048:24472,40049:24480,40050:24488,40051:24493,40052:24508,40053:24534,40054:24571,40055:24548,40056:24568,40057:24561,40058:24541,40059:24755,40060:24575,40061:24609,40062:24672,40064:24601,40065:24592,40066:24617,40067:24590,40068:24625,40069:24603,40070:24597,40071:24619,40072:24614,40073:24591,40074:24634,40075:24666,40076:24641,40077:24682,40078:24695,40079:24671,40080:24650,40081:24646,40082:24653,40083:24675,40084:24643,40085:24676,40086:24642,40087:24684,40088:24683,40089:24665,40090:24705,40091:24717,40092:24807,40093:24707,40094:24730,40095:24708,40096:24731,40097:24726,40098:24727,40099:24722,40100:24743,40101:24715,40102:24801,40103:24760,40104:24800,40105:24787,40106:24756,40107:24560,40108:24765,40109:24774,40110:24757,40111:24792,40112:24909,40113:24853,40114:24838,40115:24822,40116:24823,40117:24832,40118:24820,40119:24826,40120:24835,40121:24865,40122:24827,40123:24817,40124:24845,40125:24846,40126:24903,40127:24894,40128:24872,40129:24871,40130:24906,40131:24895,40132:24892,40133:24876,40134:24884,40135:24893,40136:24898,40137:24900,40138:24947,40139:24951,40140:24920,40141:24921,40142:24922,40143:24939,40144:24948,40145:24943,40146:24933,40147:24945,40148:24927,40149:24925,40150:24915,40151:24949,40152:24985,40153:24982,40154:24967,40155:25004,40156:24980,40157:24986,40158:24970,40159:24977,40160:25003,40161:25006,40162:25036,40163:25034,40164:25033,40165:25079,40166:25032,40167:25027,40168:25030,40169:25018,40170:25035,40171:32633,40172:25037,40173:25062,40174:25059,40175:25078,40176:25082,40177:25076,40178:25087,40179:25085,40180:25084,40181:25086,40182:25088,40183:25096,40184:25097,40185:25101,40186:25100,40187:25108,40188:25115,40256:25118,40257:25121,40258:25130,40259:25134,40260:25136,40261:25138,40262:25139,40263:25153,40264:25166,40265:25182,40266:25187,40267:25179,40268:25184,40269:25192,40270:25212,40271:25218,40272:25225,40273:25214,40274:25234,40275:25235,40276:25238,40277:25300,40278:25219,40279:25236,40280:25303,40281:25297,40282:25275,40283:25295,40284:25343,40285:25286,40286:25812,40287:25288,40288:25308,40289:25292,40290:25290,40291:25282,40292:25287,40293:25243,40294:25289,40295:25356,40296:25326,40297:25329,40298:25383,40299:25346,40300:25352,40301:25327,40302:25333,40303:25424,40304:25406,40305:25421,40306:25628,40307:25423,40308:25494,40309:25486,40310:25472,40311:25515,40312:25462,40313:25507,40314:25487,40315:25481,40316:25503,40317:25525,40318:25451,40320:25449,40321:25534,40322:25577,40323:25536,40324:25542,40325:25571,40326:25545,40327:25554,40328:25590,40329:25540,40330:25622,40331:25652,40332:25606,40333:25619,40334:25638,40335:25654,40336:25885,40337:25623,40338:25640,40339:25615,40340:25703,40341:25711,40342:25718,40343:25678,40344:25898,40345:25749,40346:25747,40347:25765,40348:25769,40349:25736,40350:25788,40351:25818,40352:25810,40353:25797,40354:25799,40355:25787,40356:25816,40357:25794,40358:25841,40359:25831,40360:33289,40361:25824,40362:25825,40363:25260,40364:25827,40365:25839,40366:25900,40367:25846,40368:25844,40369:25842,40370:25850,40371:25856,40372:25853,40373:25880,40374:25884,40375:25861,40376:25892,40377:25891,40378:25899,40379:25908,40380:25909,40381:25911,40382:25910,40383:25912,40384:30027,40385:25928,40386:25942,40387:25941,40388:25933,40389:25944,40390:25950,40391:25949,40392:25970,40393:25976,40394:25986,40395:25987,40396:35722,40397:26011,40398:26015,40399:26027,40400:26039,40401:26051,40402:26054,40403:26049,40404:26052,40405:26060,40406:26066,40407:26075,40408:26073,40409:26080,40410:26081,40411:26097,40412:26482,40413:26122,40414:26115,40415:26107,40416:26483,40417:26165,40418:26166,40419:26164,40420:26140,40421:26191,40422:26180,40423:26185,40424:26177,40425:26206,40426:26205,40427:26212,40428:26215,40429:26216,40430:26207,40431:26210,40432:26224,40433:26243,40434:26248,40435:26254,40436:26249,40437:26244,40438:26264,40439:26269,40440:26305,40441:26297,40442:26313,40443:26302,40444:26300,40512:26308,40513:26296,40514:26326,40515:26330,40516:26336,40517:26175,40518:26342,40519:26345,40520:26352,40521:26357,40522:26359,40523:26383,40524:26390,40525:26398,40526:26406,40527:26407,40528:38712,40529:26414,40530:26431,40531:26422,40532:26433,40533:26424,40534:26423,40535:26438,40536:26462,40537:26464,40538:26457,40539:26467,40540:26468,40541:26505,40542:26480,40543:26537,40544:26492,40545:26474,40546:26508,40547:26507,40548:26534,40549:26529,40550:26501,40551:26551,40552:26607,40553:26548,40554:26604,40555:26547,40556:26601,40557:26552,40558:26596,40559:26590,40560:26589,40561:26594,40562:26606,40563:26553,40564:26574,40565:26566,40566:26599,40567:27292,40568:26654,40569:26694,40570:26665,40571:26688,40572:26701,40573:26674,40574:26702,40576:26803,40577:26667,40578:26713,40579:26723,40580:26743,40581:26751,40582:26783,40583:26767,40584:26797,40585:26772,40586:26781,40587:26779,40588:26755,40589:27310,40590:26809,40591:26740,40592:26805,40593:26784,40594:26810,40595:26895,40596:26765,40597:26750,40598:26881,40599:26826,40600:26888,40601:26840,40602:26914,40603:26918,40604:26849,40605:26892,40606:26829,40607:26836,40608:26855,40609:26837,40610:26934,40611:26898,40612:26884,40613:26839,40614:26851,40615:26917,40616:26873,40617:26848,40618:26863,40619:26920,40620:26922,40621:26906,40622:26915,40623:26913,40624:26822,40625:27001,40626:26999,40627:26972,40628:27e3,40629:26987,40630:26964,40631:27006,40632:26990,40633:26937,40634:26996,40635:26941,40636:26969,40637:26928,40638:26977,40639:26974,40640:26973,40641:27009,40642:26986,40643:27058,40644:27054,40645:27088,40646:27071,40647:27073,40648:27091,40649:27070,40650:27086,40651:23528,40652:27082,40653:27101,40654:27067,40655:27075,40656:27047,40657:27182,40658:27025,40659:27040,40660:27036,40661:27029,40662:27060,40663:27102,40664:27112,40665:27138,40666:27163,40667:27135,40668:27402,40669:27129,40670:27122,40671:27111,40672:27141,40673:27057,40674:27166,40675:27117,40676:27156,40677:27115,40678:27146,40679:27154,40680:27329,40681:27171,40682:27155,40683:27204,40684:27148,40685:27250,40686:27190,40687:27256,40688:27207,40689:27234,40690:27225,40691:27238,40692:27208,40693:27192,40694:27170,40695:27280,40696:27277,40697:27296,40698:27268,40699:27298,40700:27299,40768:27287,40769:34327,40770:27323,40771:27331,40772:27330,40773:27320,40774:27315,40775:27308,40776:27358,40777:27345,40778:27359,40779:27306,40780:27354,40781:27370,40782:27387,40783:27397,40784:34326,40785:27386,40786:27410,40787:27414,40788:39729,40789:27423,40790:27448,40791:27447,40792:30428,40793:27449,40794:39150,40795:27463,40796:27459,40797:27465,40798:27472,40799:27481,40800:27476,40801:27483,40802:27487,40803:27489,40804:27512,40805:27513,40806:27519,40807:27520,40808:27524,40809:27523,40810:27533,40811:27544,40812:27541,40813:27550,40814:27556,40815:27562,40816:27563,40817:27567,40818:27570,40819:27569,40820:27571,40821:27575,40822:27580,40823:27590,40824:27595,40825:27603,40826:27615,40827:27628,40828:27627,40829:27635,40830:27631,40832:40638,40833:27656,40834:27667,40835:27668,40836:27675,40837:27684,40838:27683,40839:27742,40840:27733,40841:27746,40842:27754,40843:27778,40844:27789,40845:27802,40846:27777,40847:27803,40848:27774,40849:27752,40850:27763,40851:27794,40852:27792,40853:27844,40854:27889,40855:27859,40856:27837,40857:27863,40858:27845,40859:27869,40860:27822,40861:27825,40862:27838,40863:27834,40864:27867,40865:27887,40866:27865,40867:27882,40868:27935,40869:34893,40870:27958,40871:27947,40872:27965,40873:27960,40874:27929,40875:27957,40876:27955,40877:27922,40878:27916,40879:28003,40880:28051,40881:28004,40882:27994,40883:28025,40884:27993,40885:28046,40886:28053,40887:28644,40888:28037,40889:28153,40890:28181,40891:28170,40892:28085,40893:28103,40894:28134,40895:28088,40896:28102,40897:28140,40898:28126,40899:28108,40900:28136,40901:28114,40902:28101,40903:28154,40904:28121,40905:28132,40906:28117,40907:28138,40908:28142,40909:28205,40910:28270,40911:28206,40912:28185,40913:28274,40914:28255,40915:28222,40916:28195,40917:28267,40918:28203,40919:28278,40920:28237,40921:28191,40922:28227,40923:28218,40924:28238,40925:28196,40926:28415,40927:28189,40928:28216,40929:28290,40930:28330,40931:28312,40932:28361,40933:28343,40934:28371,40935:28349,40936:28335,40937:28356,40938:28338,40939:28372,40940:28373,40941:28303,40942:28325,40943:28354,40944:28319,40945:28481,40946:28433,40947:28748,40948:28396,40949:28408,40950:28414,40951:28479,40952:28402,40953:28465,40954:28399,40955:28466,40956:28364,161:65377,162:65378,163:65379,164:65380,165:65381,166:65382,167:65383,168:65384,169:65385,170:65386,171:65387,172:65388,173:65389,174:65390,175:65391,176:65392,177:65393,178:65394,179:65395,180:65396,181:65397,182:65398,183:65399,184:65400,185:65401,186:65402,187:65403,188:65404,189:65405,190:65406,191:65407,192:65408,193:65409,194:65410,195:65411,196:65412,197:65413,198:65414,199:65415,200:65416,201:65417,202:65418,203:65419,204:65420,205:65421,206:65422,207:65423,208:65424,209:65425,210:65426,211:65427,212:65428,213:65429,214:65430,215:65431,216:65432,217:65433,218:65434,219:65435,220:65436,221:65437,222:65438,223:65439,57408:28478,57409:28435,57410:28407,57411:28550,57412:28538,57413:28536,57414:28545,57415:28544,57416:28527,57417:28507,57418:28659,57419:28525,57420:28546,57421:28540,57422:28504,57423:28558,57424:28561,57425:28610,57426:28518,57427:28595,57428:28579,57429:28577,57430:28580,57431:28601,57432:28614,57433:28586,57434:28639,57435:28629,57436:28652,57437:28628,57438:28632,57439:28657,57440:28654,57441:28635,57442:28681,57443:28683,57444:28666,57445:28689,57446:28673,57447:28687,57448:28670,57449:28699,57450:28698,57451:28532,57452:28701,57453:28696,57454:28703,57455:28720,57456:28734,57457:28722,57458:28753,57459:28771,57460:28825,57461:28818,57462:28847,57463:28913,57464:28844,57465:28856,57466:28851,57467:28846,57468:28895,57469:28875,57470:28893,57472:28889,57473:28937,57474:28925,57475:28956,57476:28953,57477:29029,57478:29013,57479:29064,57480:29030,57481:29026,57482:29004,57483:29014,57484:29036,57485:29071,57486:29179,57487:29060,57488:29077,57489:29096,57490:29100,57491:29143,57492:29113,57493:29118,57494:29138,57495:29129,57496:29140,57497:29134,57498:29152,57499:29164,57500:29159,57501:29173,57502:29180,57503:29177,57504:29183,57505:29197,57506:29200,57507:29211,57508:29224,57509:29229,57510:29228,57511:29232,57512:29234,57513:29243,57514:29244,57515:29247,57516:29248,57517:29254,57518:29259,57519:29272,57520:29300,57521:29310,57522:29314,57523:29313,57524:29319,57525:29330,57526:29334,57527:29346,57528:29351,57529:29369,57530:29362,57531:29379,57532:29382,57533:29380,57534:29390,57535:29394,57536:29410,57537:29408,57538:29409,57539:29433,57540:29431,57541:20495,57542:29463,57543:29450,57544:29468,57545:29462,57546:29469,57547:29492,57548:29487,57549:29481,57550:29477,57551:29502,57552:29518,57553:29519,57554:40664,57555:29527,57556:29546,57557:29544,57558:29552,57559:29560,57560:29557,57561:29563,57562:29562,57563:29640,57564:29619,57565:29646,57566:29627,57567:29632,57568:29669,57569:29678,57570:29662,57571:29858,57572:29701,57573:29807,57574:29733,57575:29688,57576:29746,57577:29754,57578:29781,57579:29759,57580:29791,57581:29785,57582:29761,57583:29788,57584:29801,57585:29808,57586:29795,57587:29802,57588:29814,57589:29822,57590:29835,57591:29854,57592:29863,57593:29898,57594:29903,57595:29908,57596:29681,57664:29920,57665:29923,57666:29927,57667:29929,57668:29934,57669:29938,57670:29936,57671:29937,57672:29944,57673:29943,57674:29956,57675:29955,57676:29957,57677:29964,57678:29966,57679:29965,57680:29973,57681:29971,57682:29982,57683:29990,57684:29996,57685:30012,57686:30020,57687:30029,57688:30026,57689:30025,57690:30043,57691:30022,57692:30042,57693:30057,57694:30052,57695:30055,57696:30059,57697:30061,57698:30072,57699:30070,57700:30086,57701:30087,57702:30068,57703:30090,57704:30089,57705:30082,57706:30100,57707:30106,57708:30109,57709:30117,57710:30115,57711:30146,57712:30131,57713:30147,57714:30133,57715:30141,57716:30136,57717:30140,57718:30129,57719:30157,57720:30154,57721:30162,57722:30169,57723:30179,57724:30174,57725:30206,57726:30207,57728:30204,57729:30209,57730:30192,57731:30202,57732:30194,57733:30195,57734:30219,57735:30221,57736:30217,57737:30239,57738:30247,57739:30240,57740:30241,57741:30242,57742:30244,57743:30260,57744:30256,57745:30267,57746:30279,57747:30280,57748:30278,57749:30300,57750:30296,57751:30305,57752:30306,57753:30312,57754:30313,57755:30314,57756:30311,57757:30316,57758:30320,57759:30322,57760:30326,57761:30328,57762:30332,57763:30336,57764:30339,57765:30344,57766:30347,57767:30350,57768:30358,57769:30355,57770:30361,57771:30362,57772:30384,57773:30388,57774:30392,57775:30393,57776:30394,57777:30402,57778:30413,57779:30422,57780:30418,57781:30430,57782:30433,57783:30437,57784:30439,57785:30442,57786:34351,57787:30459,57788:30472,57789:30471,57790:30468,57791:30505,57792:30500,57793:30494,57794:30501,57795:30502,57796:30491,57797:30519,57798:30520,57799:30535,57800:30554,57801:30568,57802:30571,57803:30555,57804:30565,57805:30591,57806:30590,57807:30585,57808:30606,57809:30603,57810:30609,57811:30624,57812:30622,57813:30640,57814:30646,57815:30649,57816:30655,57817:30652,57818:30653,57819:30651,57820:30663,57821:30669,57822:30679,57823:30682,57824:30684,57825:30691,57826:30702,57827:30716,57828:30732,57829:30738,57830:31014,57831:30752,57832:31018,57833:30789,57834:30862,57835:30836,57836:30854,57837:30844,57838:30874,57839:30860,57840:30883,57841:30901,57842:30890,57843:30895,57844:30929,57845:30918,57846:30923,57847:30932,57848:30910,57849:30908,57850:30917,57851:30922,57852:30956,57920:30951,57921:30938,57922:30973,57923:30964,57924:30983,57925:30994,57926:30993,57927:31001,57928:31020,57929:31019,57930:31040,57931:31072,57932:31063,57933:31071,57934:31066,57935:31061,57936:31059,57937:31098,57938:31103,57939:31114,57940:31133,57941:31143,57942:40779,57943:31146,57944:31150,57945:31155,57946:31161,57947:31162,57948:31177,57949:31189,57950:31207,57951:31212,57952:31201,57953:31203,57954:31240,57955:31245,57956:31256,57957:31257,57958:31264,57959:31263,57960:31104,57961:31281,57962:31291,57963:31294,57964:31287,57965:31299,57966:31319,57967:31305,57968:31329,57969:31330,57970:31337,57971:40861,57972:31344,57973:31353,57974:31357,57975:31368,57976:31383,57977:31381,57978:31384,57979:31382,57980:31401,57981:31432,57982:31408,57984:31414,57985:31429,57986:31428,57987:31423,57988:36995,57989:31431,57990:31434,57991:31437,57992:31439,57993:31445,57994:31443,57995:31449,57996:31450,57997:31453,57998:31457,57999:31458,58e3:31462,58001:31469,58002:31472,58003:31490,58004:31503,58005:31498,58006:31494,58007:31539,58008:31512,58009:31513,58010:31518,58011:31541,58012:31528,58013:31542,58014:31568,58015:31610,58016:31492,58017:31565,58018:31499,58019:31564,58020:31557,58021:31605,58022:31589,58023:31604,58024:31591,58025:31600,58026:31601,58027:31596,58028:31598,58029:31645,58030:31640,58031:31647,58032:31629,58033:31644,58034:31642,58035:31627,58036:31634,58037:31631,58038:31581,58039:31641,58040:31691,58041:31681,58042:31692,58043:31695,58044:31668,58045:31686,58046:31709,58047:31721,58048:31761,58049:31764,58050:31718,58051:31717,58052:31840,58053:31744,58054:31751,58055:31763,58056:31731,58057:31735,58058:31767,58059:31757,58060:31734,58061:31779,58062:31783,58063:31786,58064:31775,58065:31799,58066:31787,58067:31805,58068:31820,58069:31811,58070:31828,58071:31823,58072:31808,58073:31824,58074:31832,58075:31839,58076:31844,58077:31830,58078:31845,58079:31852,58080:31861,58081:31875,58082:31888,58083:31908,58084:31917,58085:31906,58086:31915,58087:31905,58088:31912,58089:31923,58090:31922,58091:31921,58092:31918,58093:31929,58094:31933,58095:31936,58096:31941,58097:31938,58098:31960,58099:31954,58100:31964,58101:31970,58102:39739,58103:31983,58104:31986,58105:31988,58106:31990,58107:31994,58108:32006,58176:32002,58177:32028,58178:32021,58179:32010,58180:32069,58181:32075,58182:32046,58183:32050,58184:32063,58185:32053,58186:32070,58187:32115,58188:32086,58189:32078,58190:32114,58191:32104,58192:32110,58193:32079,58194:32099,58195:32147,58196:32137,58197:32091,58198:32143,58199:32125,58200:32155,58201:32186,58202:32174,58203:32163,58204:32181,58205:32199,58206:32189,58207:32171,58208:32317,58209:32162,58210:32175,58211:32220,58212:32184,58213:32159,58214:32176,58215:32216,58216:32221,58217:32228,58218:32222,58219:32251,58220:32242,58221:32225,58222:32261,58223:32266,58224:32291,58225:32289,58226:32274,58227:32305,58228:32287,58229:32265,58230:32267,58231:32290,58232:32326,58233:32358,58234:32315,58235:32309,58236:32313,58237:32323,58238:32311,58240:32306,58241:32314,58242:32359,58243:32349,58244:32342,58245:32350,58246:32345,58247:32346,58248:32377,58249:32362,58250:32361,58251:32380,58252:32379,58253:32387,58254:32213,58255:32381,58256:36782,58257:32383,58258:32392,58259:32393,58260:32396,58261:32402,58262:32400,58263:32403,58264:32404,58265:32406,58266:32398,58267:32411,58268:32412,58269:32568,58270:32570,58271:32581,58272:32588,58273:32589,58274:32590,58275:32592,58276:32593,58277:32597,58278:32596,58279:32600,58280:32607,58281:32608,58282:32616,58283:32617,58284:32615,58285:32632,58286:32642,58287:32646,58288:32643,58289:32648,58290:32647,58291:32652,58292:32660,58293:32670,58294:32669,58295:32666,58296:32675,58297:32687,58298:32690,58299:32697,58300:32686,58301:32694,58302:32696,58303:35697,58304:32709,58305:32710,58306:32714,58307:32725,58308:32724,58309:32737,58310:32742,58311:32745,58312:32755,58313:32761,58314:39132,58315:32774,58316:32772,58317:32779,58318:32786,58319:32792,58320:32793,58321:32796,58322:32801,58323:32808,58324:32831,58325:32827,58326:32842,58327:32838,58328:32850,58329:32856,58330:32858,58331:32863,58332:32866,58333:32872,58334:32883,58335:32882,58336:32880,58337:32886,58338:32889,58339:32893,58340:32895,58341:32900,58342:32902,58343:32901,58344:32923,58345:32915,58346:32922,58347:32941,58348:20880,58349:32940,58350:32987,58351:32997,58352:32985,58353:32989,58354:32964,58355:32986,58356:32982,58357:33033,58358:33007,58359:33009,58360:33051,58361:33065,58362:33059,58363:33071,58364:33099,58432:38539,58433:33094,58434:33086,58435:33107,58436:33105,58437:33020,58438:33137,58439:33134,58440:33125,58441:33126,58442:33140,58443:33155,58444:33160,58445:33162,58446:33152,58447:33154,58448:33184,58449:33173,58450:33188,58451:33187,58452:33119,58453:33171,58454:33193,58455:33200,58456:33205,58457:33214,58458:33208,58459:33213,58460:33216,58461:33218,58462:33210,58463:33225,58464:33229,58465:33233,58466:33241,58467:33240,58468:33224,58469:33242,58470:33247,58471:33248,58472:33255,58473:33274,58474:33275,58475:33278,58476:33281,58477:33282,58478:33285,58479:33287,58480:33290,58481:33293,58482:33296,58483:33302,58484:33321,58485:33323,58486:33336,58487:33331,58488:33344,58489:33369,58490:33368,58491:33373,58492:33370,58493:33375,58494:33380,58496:33378,58497:33384,58498:33386,58499:33387,58500:33326,58501:33393,58502:33399,58503:33400,58504:33406,58505:33421,58506:33426,58507:33451,58508:33439,58509:33467,58510:33452,58511:33505,58512:33507,58513:33503,58514:33490,58515:33524,58516:33523,58517:33530,58518:33683,58519:33539,58520:33531,58521:33529,58522:33502,58523:33542,58524:33500,58525:33545,58526:33497,58527:33589,58528:33588,58529:33558,58530:33586,58531:33585,58532:33600,58533:33593,58534:33616,58535:33605,58536:33583,58537:33579,58538:33559,58539:33560,58540:33669,58541:33690,58542:33706,58543:33695,58544:33698,58545:33686,58546:33571,58547:33678,58548:33671,58549:33674,58550:33660,58551:33717,58552:33651,58553:33653,58554:33696,58555:33673,58556:33704,58557:33780,58558:33811,58559:33771,58560:33742,58561:33789,58562:33795,58563:33752,58564:33803,58565:33729,58566:33783,58567:33799,58568:33760,58569:33778,58570:33805,58571:33826,58572:33824,58573:33725,58574:33848,58575:34054,58576:33787,58577:33901,58578:33834,58579:33852,58580:34138,58581:33924,58582:33911,58583:33899,58584:33965,58585:33902,58586:33922,58587:33897,58588:33862,58589:33836,58590:33903,58591:33913,58592:33845,58593:33994,58594:33890,58595:33977,58596:33983,58597:33951,58598:34009,58599:33997,58600:33979,58601:34010,58602:34e3,58603:33985,58604:33990,58605:34006,58606:33953,58607:34081,58608:34047,58609:34036,58610:34071,58611:34072,58612:34092,58613:34079,58614:34069,58615:34068,58616:34044,58617:34112,58618:34147,58619:34136,58620:34120,58688:34113,58689:34306,58690:34123,58691:34133,58692:34176,58693:34212,58694:34184,58695:34193,58696:34186,58697:34216,58698:34157,58699:34196,58700:34203,58701:34282,58702:34183,58703:34204,58704:34167,58705:34174,58706:34192,58707:34249,58708:34234,58709:34255,58710:34233,58711:34256,58712:34261,58713:34269,58714:34277,58715:34268,58716:34297,58717:34314,58718:34323,58719:34315,58720:34302,58721:34298,58722:34310,58723:34338,58724:34330,58725:34352,58726:34367,58727:34381,58728:20053,58729:34388,58730:34399,58731:34407,58732:34417,58733:34451,58734:34467,58735:34473,58736:34474,58737:34443,58738:34444,58739:34486,58740:34479,58741:34500,58742:34502,58743:34480,58744:34505,58745:34851,58746:34475,58747:34516,58748:34526,58749:34537,58750:34540,58752:34527,58753:34523,58754:34543,58755:34578,58756:34566,58757:34568,58758:34560,58759:34563,58760:34555,58761:34577,58762:34569,58763:34573,58764:34553,58765:34570,58766:34612,58767:34623,58768:34615,58769:34619,58770:34597,58771:34601,58772:34586,58773:34656,58774:34655,58775:34680,58776:34636,58777:34638,58778:34676,58779:34647,58780:34664,58781:34670,58782:34649,58783:34643,58784:34659,58785:34666,58786:34821,58787:34722,58788:34719,58789:34690,58790:34735,58791:34763,58792:34749,58793:34752,58794:34768,58795:38614,58796:34731,58797:34756,58798:34739,58799:34759,58800:34758,58801:34747,58802:34799,58803:34802,58804:34784,58805:34831,58806:34829,58807:34814,58808:34806,58809:34807,58810:34830,58811:34770,58812:34833,58813:34838,58814:34837,58815:34850,58816:34849,58817:34865,58818:34870,58819:34873,58820:34855,58821:34875,58822:34884,58823:34882,58824:34898,58825:34905,58826:34910,58827:34914,58828:34923,58829:34945,58830:34942,58831:34974,58832:34933,58833:34941,58834:34997,58835:34930,58836:34946,58837:34967,58838:34962,58839:34990,58840:34969,58841:34978,58842:34957,58843:34980,58844:34992,58845:35007,58846:34993,58847:35011,58848:35012,58849:35028,58850:35032,58851:35033,58852:35037,58853:35065,58854:35074,58855:35068,58856:35060,58857:35048,58858:35058,58859:35076,58860:35084,58861:35082,58862:35091,58863:35139,58864:35102,58865:35109,58866:35114,58867:35115,58868:35137,58869:35140,58870:35131,58871:35126,58872:35128,58873:35148,58874:35101,58875:35168,58876:35166,58944:35174,58945:35172,58946:35181,58947:35178,58948:35183,58949:35188,58950:35191,58951:35198,58952:35203,58953:35208,58954:35210,58955:35219,58956:35224,58957:35233,58958:35241,58959:35238,58960:35244,58961:35247,58962:35250,58963:35258,58964:35261,58965:35263,58966:35264,58967:35290,58968:35292,58969:35293,58970:35303,58971:35316,58972:35320,58973:35331,58974:35350,58975:35344,58976:35340,58977:35355,58978:35357,58979:35365,58980:35382,58981:35393,58982:35419,58983:35410,58984:35398,58985:35400,58986:35452,58987:35437,58988:35436,58989:35426,58990:35461,58991:35458,58992:35460,58993:35496,58994:35489,58995:35473,58996:35493,58997:35494,58998:35482,58999:35491,59e3:35524,59001:35533,59002:35522,59003:35546,59004:35563,59005:35571,59006:35559,59008:35556,59009:35569,59010:35604,59011:35552,59012:35554,59013:35575,59014:35550,59015:35547,59016:35596,59017:35591,59018:35610,59019:35553,59020:35606,59021:35600,59022:35607,59023:35616,59024:35635,59025:38827,59026:35622,59027:35627,59028:35646,59029:35624,59030:35649,59031:35660,59032:35663,59033:35662,59034:35657,59035:35670,59036:35675,59037:35674,59038:35691,59039:35679,59040:35692,59041:35695,59042:35700,59043:35709,59044:35712,59045:35724,59046:35726,59047:35730,59048:35731,59049:35734,59050:35737,59051:35738,59052:35898,59053:35905,59054:35903,59055:35912,59056:35916,59057:35918,59058:35920,59059:35925,59060:35938,59061:35948,59062:35960,59063:35962,59064:35970,59065:35977,59066:35973,59067:35978,59068:35981,59069:35982,59070:35988,59071:35964,59072:35992,59073:25117,59074:36013,59075:36010,59076:36029,59077:36018,59078:36019,59079:36014,59080:36022,59081:36040,59082:36033,59083:36068,59084:36067,59085:36058,59086:36093,59087:36090,59088:36091,59089:36100,59090:36101,59091:36106,59092:36103,59093:36111,59094:36109,59095:36112,59096:40782,59097:36115,59098:36045,59099:36116,59100:36118,59101:36199,59102:36205,59103:36209,59104:36211,59105:36225,59106:36249,59107:36290,59108:36286,59109:36282,59110:36303,59111:36314,59112:36310,59113:36300,59114:36315,59115:36299,59116:36330,59117:36331,59118:36319,59119:36323,59120:36348,59121:36360,59122:36361,59123:36351,59124:36381,59125:36382,59126:36368,59127:36383,59128:36418,59129:36405,59130:36400,59131:36404,59132:36426,59200:36423,59201:36425,59202:36428,59203:36432,59204:36424,59205:36441,59206:36452,59207:36448,59208:36394,59209:36451,59210:36437,59211:36470,59212:36466,59213:36476,59214:36481,59215:36487,59216:36485,59217:36484,59218:36491,59219:36490,59220:36499,59221:36497,59222:36500,59223:36505,59224:36522,59225:36513,59226:36524,59227:36528,59228:36550,59229:36529,59230:36542,59231:36549,59232:36552,59233:36555,59234:36571,59235:36579,59236:36604,59237:36603,59238:36587,59239:36606,59240:36618,59241:36613,59242:36629,59243:36626,59244:36633,59245:36627,59246:36636,59247:36639,59248:36635,59249:36620,59250:36646,59251:36659,59252:36667,59253:36665,59254:36677,59255:36674,59256:36670,59257:36684,59258:36681,59259:36678,59260:36686,59261:36695,59262:36700,59264:36706,59265:36707,59266:36708,59267:36764,59268:36767,59269:36771,59270:36781,59271:36783,59272:36791,59273:36826,59274:36837,59275:36834,59276:36842,59277:36847,59278:36999,59279:36852,59280:36869,59281:36857,59282:36858,59283:36881,59284:36885,59285:36897,59286:36877,59287:36894,59288:36886,59289:36875,59290:36903,59291:36918,59292:36917,59293:36921,59294:36856,59295:36943,59296:36944,59297:36945,59298:36946,59299:36878,59300:36937,59301:36926,59302:36950,59303:36952,59304:36958,59305:36968,59306:36975,59307:36982,59308:38568,59309:36978,59310:36994,59311:36989,59312:36993,59313:36992,59314:37002,59315:37001,59316:37007,59317:37032,59318:37039,59319:37041,59320:37045,59321:37090,59322:37092,59323:25160,59324:37083,59325:37122,59326:37138,59327:37145,59328:37170,59329:37168,59330:37194,59331:37206,59332:37208,59333:37219,59334:37221,59335:37225,59336:37235,59337:37234,59338:37259,59339:37257,59340:37250,59341:37282,59342:37291,59343:37295,59344:37290,59345:37301,59346:37300,59347:37306,59348:37312,59349:37313,59350:37321,59351:37323,59352:37328,59353:37334,59354:37343,59355:37345,59356:37339,59357:37372,59358:37365,59359:37366,59360:37406,59361:37375,59362:37396,59363:37420,59364:37397,59365:37393,59366:37470,59367:37463,59368:37445,59369:37449,59370:37476,59371:37448,59372:37525,59373:37439,59374:37451,59375:37456,59376:37532,59377:37526,59378:37523,59379:37531,59380:37466,59381:37583,59382:37561,59383:37559,59384:37609,59385:37647,59386:37626,59387:37700,59388:37678,59456:37657,59457:37666,59458:37658,59459:37667,59460:37690,59461:37685,59462:37691,59463:37724,59464:37728,59465:37756,59466:37742,59467:37718,59468:37808,59469:37804,59470:37805,59471:37780,59472:37817,59473:37846,59474:37847,59475:37864,59476:37861,59477:37848,59478:37827,59479:37853,59480:37840,59481:37832,59482:37860,59483:37914,59484:37908,59485:37907,59486:37891,59487:37895,59488:37904,59489:37942,59490:37931,59491:37941,59492:37921,59493:37946,59494:37953,59495:37970,59496:37956,59497:37979,59498:37984,59499:37986,59500:37982,59501:37994,59502:37417,59503:38e3,59504:38005,59505:38007,59506:38013,59507:37978,59508:38012,59509:38014,59510:38017,59511:38015,59512:38274,59513:38279,59514:38282,59515:38292,59516:38294,59517:38296,59518:38297,59520:38304,59521:38312,59522:38311,59523:38317,59524:38332,59525:38331,59526:38329,59527:38334,59528:38346,59529:28662,59530:38339,59531:38349,59532:38348,59533:38357,59534:38356,59535:38358,59536:38364,59537:38369,59538:38373,59539:38370,59540:38433,59541:38440,59542:38446,59543:38447,59544:38466,59545:38476,59546:38479,59547:38475,59548:38519,59549:38492,59550:38494,59551:38493,59552:38495,59553:38502,59554:38514,59555:38508,59556:38541,59557:38552,59558:38549,59559:38551,59560:38570,59561:38567,59562:38577,59563:38578,59564:38576,59565:38580,59566:38582,59567:38584,59568:38585,59569:38606,59570:38603,59571:38601,59572:38605,59573:35149,59574:38620,59575:38669,59576:38613,59577:38649,59578:38660,59579:38662,59580:38664,59581:38675,59582:38670,59583:38673,59584:38671,59585:38678,59586:38681,59587:38692,59588:38698,59589:38704,59590:38713,59591:38717,59592:38718,59593:38724,59594:38726,59595:38728,59596:38722,59597:38729,59598:38748,59599:38752,59600:38756,59601:38758,59602:38760,59603:21202,59604:38763,59605:38769,59606:38777,59607:38789,59608:38780,59609:38785,59610:38778,59611:38790,59612:38795,59613:38799,59614:38800,59615:38812,59616:38824,59617:38822,59618:38819,59619:38835,59620:38836,59621:38851,59622:38854,59623:38856,59624:38859,59625:38876,59626:38893,59627:40783,59628:38898,59629:31455,59630:38902,59631:38901,59632:38927,59633:38924,59634:38968,59635:38948,59636:38945,59637:38967,59638:38973,59639:38982,59640:38991,59641:38987,59642:39019,59643:39023,59644:39024,59712:39025,59713:39028,59714:39027,59715:39082,59716:39087,59717:39089,59718:39094,59719:39108,59720:39107,59721:39110,59722:39145,59723:39147,59724:39171,59725:39177,59726:39186,59727:39188,59728:39192,59729:39201,59730:39197,59731:39198,59732:39204,59733:39200,59734:39212,59735:39214,59736:39229,59737:39230,59738:39234,59739:39241,59740:39237,59741:39248,59742:39243,59743:39249,59744:39250,59745:39244,59746:39253,59747:39319,59748:39320,59749:39333,59750:39341,59751:39342,59752:39356,59753:39391,59754:39387,59755:39389,59756:39384,59757:39377,59758:39405,59759:39406,59760:39409,59761:39410,59762:39419,59763:39416,59764:39425,59765:39439,59766:39429,59767:39394,59768:39449,59769:39467,59770:39479,59771:39493,59772:39490,59773:39488,59774:39491,59776:39486,59777:39509,59778:39501,59779:39515,59780:39511,59781:39519,59782:39522,59783:39525,59784:39524,59785:39529,59786:39531,59787:39530,59788:39597,59789:39600,59790:39612,59791:39616,59792:39631,59793:39633,59794:39635,59795:39636,59796:39646,59797:39647,59798:39650,59799:39651,59800:39654,59801:39663,59802:39659,59803:39662,59804:39668,59805:39665,59806:39671,59807:39675,59808:39686,59809:39704,59810:39706,59811:39711,59812:39714,59813:39715,59814:39717,59815:39719,59816:39720,59817:39721,59818:39722,59819:39726,59820:39727,59821:39730,59822:39748,59823:39747,59824:39759,59825:39757,59826:39758,59827:39761,59828:39768,59829:39796,59830:39827,59831:39811,59832:39825,59833:39830,59834:39831,59835:39839,59836:39840,59837:39848,59838:39860,59839:39872,59840:39882,59841:39865,59842:39878,59843:39887,59844:39889,59845:39890,59846:39907,59847:39906,59848:39908,59849:39892,59850:39905,59851:39994,59852:39922,59853:39921,59854:39920,59855:39957,59856:39956,59857:39945,59858:39955,59859:39948,59860:39942,59861:39944,59862:39954,59863:39946,59864:39940,59865:39982,59866:39963,59867:39973,59868:39972,59869:39969,59870:39984,59871:40007,59872:39986,59873:40006,59874:39998,59875:40026,59876:40032,59877:40039,59878:40054,59879:40056,59880:40167,59881:40172,59882:40176,59883:40201,59884:40200,59885:40171,59886:40195,59887:40198,59888:40234,59889:40230,59890:40367,59891:40227,59892:40223,59893:40260,59894:40213,59895:40210,59896:40257,59897:40255,59898:40254,59899:40262,59900:40264,59968:40285,59969:40286,59970:40292,59971:40273,59972:40272,59973:40281,59974:40306,59975:40329,59976:40327,59977:40363,59978:40303,59979:40314,59980:40346,59981:40356,59982:40361,59983:40370,59984:40388,59985:40385,59986:40379,59987:40376,59988:40378,59989:40390,59990:40399,59991:40386,59992:40409,59993:40403,59994:40440,59995:40422,59996:40429,59997:40431,59998:40445,59999:40474,6e4:40475,60001:40478,60002:40565,60003:40569,60004:40573,60005:40577,60006:40584,60007:40587,60008:40588,60009:40594,60010:40597,60011:40593,60012:40605,60013:40613,60014:40617,60015:40632,60016:40618,60017:40621,60018:38753,60019:40652,60020:40654,60021:40655,60022:40656,60023:40660,60024:40668,60025:40670,60026:40669,60027:40672,60028:40677,60029:40680,60030:40687,60032:40692,60033:40694,60034:40695,60035:40697,60036:40699,60037:40700,60038:40701,60039:40711,60040:40712,60041:30391,60042:40725,60043:40737,60044:40748,60045:40766,60046:40778,60047:40786,60048:40788,60049:40803,60050:40799,60051:40800,60052:40801,60053:40806,60054:40807,60055:40812,60056:40810,60057:40823,60058:40818,60059:40822,60060:40853,60061:40860,60062:40864,60063:22575,60064:27079,60065:36953,60066:29796,60067:20956,60068:29081}}),(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(1),c=s(2);function u(g,y,b,R){var D;y.degree()<b.degree()&&(D=[b,y],y=D[0],b=D[1]);for(var k=y,Re=b,Fe=g.zero,O=g.one;Re.degree()>=R/2;){var $e=k,ze=Fe;if(k=Re,Fe=O,k.isZero())return null;Re=$e;for(var q=g.zero,W=k.getCoefficient(k.degree()),We=g.inverse(W);Re.degree()>=k.degree()&&!Re.isZero();){var Xe=Re.degree()-k.degree(),it=g.multiply(Re.getCoefficient(Re.degree()),We);q=q.addOrSubtract(g.buildMonomial(Xe,it)),Re=Re.addOrSubtract(k.multiplyByMonomial(Xe,it))}if(O=q.multiplyPoly(Fe).addOrSubtract(ze),Re.degree()>=k.degree())return null}var Ve=O.getCoefficient(0);if(Ve===0)return null;var v=g.inverse(Ve);return[O.multiply(v),Re.multiply(v)]}function f(g,y){var b=y.degree();if(b===1)return[y.getCoefficient(1)];for(var R=new Array(b),D=0,k=1;k<g.size&&D<b;k++)y.evaluateAt(k)===0&&(R[D]=g.inverse(k),D++);return D!==b?null:R}function x(g,y,b){for(var R=b.length,D=new Array(R),k=0;k<R;k++){for(var Re=g.inverse(b[k]),Fe=1,O=0;O<R;O++)k!==O&&(Fe=g.multiply(Fe,o.addOrSubtractGF(1,g.multiply(b[O],Re))));D[k]=g.multiply(y.evaluateAt(Re),g.inverse(Fe)),g.generatorBase!==0&&(D[k]=g.multiply(D[k],Re))}return D}function p(g,y){var b=new Uint8ClampedArray(g.length);b.set(g);for(var R=new o.default(285,256,0),D=new c.default(R,b),k=new Uint8ClampedArray(y),Re=!1,Fe=0;Fe<y;Fe++){var O=D.evaluateAt(R.exp(Fe+R.generatorBase));k[k.length-1-Fe]=O,O!==0&&(Re=!0)}if(!Re)return b;var $e=new c.default(R,k),ze=u(R,R.buildMonomial(y,1),$e,y);if(ze===null)return null;var q=f(R,ze[0]);if(q==null)return null;for(var W=x(R,ze[1],q),We=0;We<q.length;We++){var Xe=b.length-1-R.log(q[We]);if(Xe<0)return null;b[Xe]=o.addOrSubtractGF(b[Xe],W[We])}return b}n.decode=p}),(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.VERSIONS=[{infoBits:null,versionNumber:1,alignmentPatternCenters:[],errorCorrectionLevels:[{ecCodewordsPerBlock:7,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:10,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:16}]},{ecCodewordsPerBlock:13,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:13}]},{ecCodewordsPerBlock:17,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:9}]}]},{infoBits:null,versionNumber:2,alignmentPatternCenters:[6,18],errorCorrectionLevels:[{ecCodewordsPerBlock:10,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:34}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:28}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:22}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:16}]}]},{infoBits:null,versionNumber:3,alignmentPatternCenters:[6,22],errorCorrectionLevels:[{ecCodewordsPerBlock:15,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:55}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:13}]}]},{infoBits:null,versionNumber:4,alignmentPatternCenters:[6,26],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:80}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:32}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:9}]}]},{infoBits:null,versionNumber:5,alignmentPatternCenters:[6,30],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:43}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:15},{numBlocks:2,dataCodewordsPerBlock:16}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:11},{numBlocks:2,dataCodewordsPerBlock:12}]}]},{infoBits:null,versionNumber:6,alignmentPatternCenters:[6,34],errorCorrectionLevels:[{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:68}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:27}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:15}]}]},{infoBits:31892,versionNumber:7,alignmentPatternCenters:[6,22,38],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:78}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:31}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:4,dataCodewordsPerBlock:15}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:13},{numBlocks:1,dataCodewordsPerBlock:14}]}]},{infoBits:34236,versionNumber:8,alignmentPatternCenters:[6,24,42],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:97}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:38},{numBlocks:2,dataCodewordsPerBlock:39}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:18},{numBlocks:2,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:14},{numBlocks:2,dataCodewordsPerBlock:15}]}]},{infoBits:39577,versionNumber:9,alignmentPatternCenters:[6,26,46],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:36},{numBlocks:2,dataCodewordsPerBlock:37}]},{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:16},{numBlocks:4,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:12},{numBlocks:4,dataCodewordsPerBlock:13}]}]},{infoBits:42195,versionNumber:10,alignmentPatternCenters:[6,28,50],errorCorrectionLevels:[{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:68},{numBlocks:2,dataCodewordsPerBlock:69}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:43},{numBlocks:1,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:19},{numBlocks:2,dataCodewordsPerBlock:20}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:15},{numBlocks:2,dataCodewordsPerBlock:16}]}]},{infoBits:48118,versionNumber:11,alignmentPatternCenters:[6,30,54],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:81}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:50},{numBlocks:4,dataCodewordsPerBlock:51}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:22},{numBlocks:4,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:12},{numBlocks:8,dataCodewordsPerBlock:13}]}]},{infoBits:51042,versionNumber:12,alignmentPatternCenters:[6,32,58],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:92},{numBlocks:2,dataCodewordsPerBlock:93}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:36},{numBlocks:2,dataCodewordsPerBlock:37}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:20},{numBlocks:6,dataCodewordsPerBlock:21}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:14},{numBlocks:4,dataCodewordsPerBlock:15}]}]},{infoBits:55367,versionNumber:13,alignmentPatternCenters:[6,34,62],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:107}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:37},{numBlocks:1,dataCodewordsPerBlock:38}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:20},{numBlocks:4,dataCodewordsPerBlock:21}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:11},{numBlocks:4,dataCodewordsPerBlock:12}]}]},{infoBits:58893,versionNumber:14,alignmentPatternCenters:[6,26,46,66],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:115},{numBlocks:1,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:40},{numBlocks:5,dataCodewordsPerBlock:41}]},{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:16},{numBlocks:5,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:12},{numBlocks:5,dataCodewordsPerBlock:13}]}]},{infoBits:63784,versionNumber:15,alignmentPatternCenters:[6,26,48,70],errorCorrectionLevels:[{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:87},{numBlocks:1,dataCodewordsPerBlock:88}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:41},{numBlocks:5,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:24},{numBlocks:7,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:12},{numBlocks:7,dataCodewordsPerBlock:13}]}]},{infoBits:68472,versionNumber:16,alignmentPatternCenters:[6,26,50,74],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:98},{numBlocks:1,dataCodewordsPerBlock:99}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:45},{numBlocks:3,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:19},{numBlocks:2,dataCodewordsPerBlock:20}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:15},{numBlocks:13,dataCodewordsPerBlock:16}]}]},{infoBits:70749,versionNumber:17,alignmentPatternCenters:[6,30,54,78],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:107},{numBlocks:5,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:46},{numBlocks:1,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:22},{numBlocks:15,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:17,dataCodewordsPerBlock:15}]}]},{infoBits:76311,versionNumber:18,alignmentPatternCenters:[6,30,56,82],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:120},{numBlocks:1,dataCodewordsPerBlock:121}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:9,dataCodewordsPerBlock:43},{numBlocks:4,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:22},{numBlocks:1,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:19,dataCodewordsPerBlock:15}]}]},{infoBits:79154,versionNumber:19,alignmentPatternCenters:[6,30,58,86],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:113},{numBlocks:4,dataCodewordsPerBlock:114}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:44},{numBlocks:11,dataCodewordsPerBlock:45}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:21},{numBlocks:4,dataCodewordsPerBlock:22}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:9,dataCodewordsPerBlock:13},{numBlocks:16,dataCodewordsPerBlock:14}]}]},{infoBits:84390,versionNumber:20,alignmentPatternCenters:[6,34,62,90],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:107},{numBlocks:5,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:41},{numBlocks:13,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:24},{numBlocks:5,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:15},{numBlocks:10,dataCodewordsPerBlock:16}]}]},{infoBits:87683,versionNumber:21,alignmentPatternCenters:[6,28,50,72,94],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:116},{numBlocks:4,dataCodewordsPerBlock:117}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:22},{numBlocks:6,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:16},{numBlocks:6,dataCodewordsPerBlock:17}]}]},{infoBits:92361,versionNumber:22,alignmentPatternCenters:[6,26,50,74,98],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:111},{numBlocks:7,dataCodewordsPerBlock:112}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:24},{numBlocks:16,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:34,dataCodewordsPerBlock:13}]}]},{infoBits:96236,versionNumber:23,alignmentPatternCenters:[6,30,54,74,102],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:121},{numBlocks:5,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:47},{numBlocks:14,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:16,dataCodewordsPerBlock:15},{numBlocks:14,dataCodewordsPerBlock:16}]}]},{infoBits:102084,versionNumber:24,alignmentPatternCenters:[6,28,54,80,106],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:117},{numBlocks:4,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:45},{numBlocks:14,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:24},{numBlocks:16,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:30,dataCodewordsPerBlock:16},{numBlocks:2,dataCodewordsPerBlock:17}]}]},{infoBits:102881,versionNumber:25,alignmentPatternCenters:[6,32,58,84,110],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:106},{numBlocks:4,dataCodewordsPerBlock:107}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:47},{numBlocks:13,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:24},{numBlocks:22,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:15},{numBlocks:13,dataCodewordsPerBlock:16}]}]},{infoBits:110507,versionNumber:26,alignmentPatternCenters:[6,30,58,86,114],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:114},{numBlocks:2,dataCodewordsPerBlock:115}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:46},{numBlocks:4,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:28,dataCodewordsPerBlock:22},{numBlocks:6,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:33,dataCodewordsPerBlock:16},{numBlocks:4,dataCodewordsPerBlock:17}]}]},{infoBits:110734,versionNumber:27,alignmentPatternCenters:[6,34,62,90,118],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:122},{numBlocks:4,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:45},{numBlocks:3,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:23},{numBlocks:26,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:15},{numBlocks:28,dataCodewordsPerBlock:16}]}]},{infoBits:117786,versionNumber:28,alignmentPatternCenters:[6,26,50,74,98,122],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:117},{numBlocks:10,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:45},{numBlocks:23,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:24},{numBlocks:31,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:15},{numBlocks:31,dataCodewordsPerBlock:16}]}]},{infoBits:119615,versionNumber:29,alignmentPatternCenters:[6,30,54,78,102,126],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:116},{numBlocks:7,dataCodewordsPerBlock:117}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:21,dataCodewordsPerBlock:45},{numBlocks:7,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:23},{numBlocks:37,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:15},{numBlocks:26,dataCodewordsPerBlock:16}]}]},{infoBits:126325,versionNumber:30,alignmentPatternCenters:[6,26,52,78,104,130],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:115},{numBlocks:10,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:47},{numBlocks:10,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:24},{numBlocks:25,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:23,dataCodewordsPerBlock:15},{numBlocks:25,dataCodewordsPerBlock:16}]}]},{infoBits:127568,versionNumber:31,alignmentPatternCenters:[6,30,56,82,108,134],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:115},{numBlocks:3,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:46},{numBlocks:29,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:42,dataCodewordsPerBlock:24},{numBlocks:1,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:23,dataCodewordsPerBlock:15},{numBlocks:28,dataCodewordsPerBlock:16}]}]},{infoBits:133589,versionNumber:32,alignmentPatternCenters:[6,34,60,86,112,138],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:115}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:46},{numBlocks:23,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:24},{numBlocks:35,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:15},{numBlocks:35,dataCodewordsPerBlock:16}]}]},{infoBits:136944,versionNumber:33,alignmentPatternCenters:[6,30,58,86,114,142],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:115},{numBlocks:1,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:14,dataCodewordsPerBlock:46},{numBlocks:21,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:29,dataCodewordsPerBlock:24},{numBlocks:19,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:15},{numBlocks:46,dataCodewordsPerBlock:16}]}]},{infoBits:141498,versionNumber:34,alignmentPatternCenters:[6,34,62,90,118,146],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:115},{numBlocks:6,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:14,dataCodewordsPerBlock:46},{numBlocks:23,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:44,dataCodewordsPerBlock:24},{numBlocks:7,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:59,dataCodewordsPerBlock:16},{numBlocks:1,dataCodewordsPerBlock:17}]}]},{infoBits:145311,versionNumber:35,alignmentPatternCenters:[6,30,54,78,102,126,150],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:121},{numBlocks:7,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:47},{numBlocks:26,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:39,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:15},{numBlocks:41,dataCodewordsPerBlock:16}]}]},{infoBits:150283,versionNumber:36,alignmentPatternCenters:[6,24,50,76,102,128,154],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:121},{numBlocks:14,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:47},{numBlocks:34,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:46,dataCodewordsPerBlock:24},{numBlocks:10,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:15},{numBlocks:64,dataCodewordsPerBlock:16}]}]},{infoBits:152622,versionNumber:37,alignmentPatternCenters:[6,28,54,80,106,132,158],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:122},{numBlocks:4,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:29,dataCodewordsPerBlock:46},{numBlocks:14,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:49,dataCodewordsPerBlock:24},{numBlocks:10,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:24,dataCodewordsPerBlock:15},{numBlocks:46,dataCodewordsPerBlock:16}]}]},{infoBits:158308,versionNumber:38,alignmentPatternCenters:[6,32,58,84,110,136,162],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:122},{numBlocks:18,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:46},{numBlocks:32,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:48,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:42,dataCodewordsPerBlock:15},{numBlocks:32,dataCodewordsPerBlock:16}]}]},{infoBits:161089,versionNumber:39,alignmentPatternCenters:[6,26,54,82,110,138,166],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:20,dataCodewordsPerBlock:117},{numBlocks:4,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:40,dataCodewordsPerBlock:47},{numBlocks:7,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:43,dataCodewordsPerBlock:24},{numBlocks:22,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:15},{numBlocks:67,dataCodewordsPerBlock:16}]}]},{infoBits:167017,versionNumber:40,alignmentPatternCenters:[6,30,58,86,114,142,170],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:118},{numBlocks:6,dataCodewordsPerBlock:119}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:18,dataCodewordsPerBlock:47},{numBlocks:31,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:34,dataCodewordsPerBlock:24},{numBlocks:34,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:20,dataCodewordsPerBlock:15},{numBlocks:61,dataCodewordsPerBlock:16}]}]}]}),(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(0);function c(p,g,y,b){var R=p.x-g.x+y.x-b.x,D=p.y-g.y+y.y-b.y;if(R===0&&D===0)return{a11:g.x-p.x,a12:g.y-p.y,a13:0,a21:y.x-g.x,a22:y.y-g.y,a23:0,a31:p.x,a32:p.y,a33:1};var k=g.x-y.x,Re=b.x-y.x,Fe=g.y-y.y,O=b.y-y.y,$e=k*O-Re*Fe,ze=(R*O-Re*D)/$e,q=(k*D-R*Fe)/$e;return{a11:g.x-p.x+ze*g.x,a12:g.y-p.y+ze*g.y,a13:ze,a21:b.x-p.x+q*b.x,a22:b.y-p.y+q*b.y,a23:q,a31:p.x,a32:p.y,a33:1}}function u(p,g,y,b){var R=c(p,g,y,b);return{a11:R.a22*R.a33-R.a23*R.a32,a12:R.a13*R.a32-R.a12*R.a33,a13:R.a12*R.a23-R.a13*R.a22,a21:R.a23*R.a31-R.a21*R.a33,a22:R.a11*R.a33-R.a13*R.a31,a23:R.a13*R.a21-R.a11*R.a23,a31:R.a21*R.a32-R.a22*R.a31,a32:R.a12*R.a31-R.a11*R.a32,a33:R.a11*R.a22-R.a12*R.a21}}function f(p,g){return{a11:p.a11*g.a11+p.a21*g.a12+p.a31*g.a13,a12:p.a12*g.a11+p.a22*g.a12+p.a32*g.a13,a13:p.a13*g.a11+p.a23*g.a12+p.a33*g.a13,a21:p.a11*g.a21+p.a21*g.a22+p.a31*g.a23,a22:p.a12*g.a21+p.a22*g.a22+p.a32*g.a23,a23:p.a13*g.a21+p.a23*g.a22+p.a33*g.a23,a31:p.a11*g.a31+p.a21*g.a32+p.a31*g.a33,a32:p.a12*g.a31+p.a22*g.a32+p.a32*g.a33,a33:p.a13*g.a31+p.a23*g.a32+p.a33*g.a33}}function x(p,g){for(var y=u({x:3.5,y:3.5},{x:g.dimension-3.5,y:3.5},{x:g.dimension-6.5,y:g.dimension-6.5},{x:3.5,y:g.dimension-3.5}),b=c(g.topLeft,g.topRight,g.alignmentPattern,g.bottomLeft),R=f(b,y),D=o.BitMatrix.createEmpty(g.dimension,g.dimension),k=function(q,W){var We=R.a13*q+R.a23*W+R.a33;return{x:(R.a11*q+R.a21*W+R.a31)/We,y:(R.a12*q+R.a22*W+R.a32)/We}},Re=0;Re<g.dimension;Re++)for(var Fe=0;Fe<g.dimension;Fe++){var O=Fe+.5,$e=Re+.5,ze=k(O,$e);D.set(Fe,Re,p.get(Math.floor(ze.x),Math.floor(ze.y)))}return{matrix:D,mappingFunction:k}}n.extract=x}),(function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=4,c=.5,u=1.5,f=function(O,$e){return Math.sqrt(Math.pow($e.x-O.x,2)+Math.pow($e.y-O.y,2))};function x(O){return O.reduce(function($e,ze){return $e+ze})}function p(O,$e,ze){var q,W,We,Xe,it=f(O,$e),Ve=f($e,ze),v=f(O,ze),I,Ce,P;return Ve>=it&&Ve>=v?(q=[$e,O,ze],I=q[0],Ce=q[1],P=q[2]):v>=Ve&&v>=it?(W=[O,$e,ze],I=W[0],Ce=W[1],P=W[2]):(We=[O,ze,$e],I=We[0],Ce=We[1],P=We[2]),(P.x-Ce.x)*(I.y-Ce.y)-(P.y-Ce.y)*(I.x-Ce.x)<0&&(Xe=[P,I],I=Xe[0],P=Xe[1]),{bottomLeft:I,topLeft:Ce,topRight:P}}function g(O,$e,ze,q){var W=(x(b(O,ze,q,5))/7+x(b(O,$e,q,5))/7+x(b(ze,O,q,5))/7+x(b($e,O,q,5))/7)/4;if(W<1)throw new Error("Invalid module size");var We=Math.round(f(O,$e)/W),Xe=Math.round(f(O,ze)/W),it=Math.floor((We+Xe)/2)+7;switch(it%4){case 0:it++;break;case 2:it--;break}return{dimension:it,moduleSize:W}}function y(O,$e,ze,q){var W=[{x:Math.floor(O.x),y:Math.floor(O.y)}],We=Math.abs($e.y-O.y)>Math.abs($e.x-O.x),Xe,it,Ve,v;We?(Xe=Math.floor(O.y),it=Math.floor(O.x),Ve=Math.floor($e.y),v=Math.floor($e.x)):(Xe=Math.floor(O.x),it=Math.floor(O.y),Ve=Math.floor($e.x),v=Math.floor($e.y));for(var I=Math.abs(Ve-Xe),Ce=Math.abs(v-it),P=Math.floor(-I/2),_e=Xe<Ve?1:-1,Le=it<v?1:-1,Ye=!0,je=Xe,K=it;je!==Ve+_e;je+=_e){var L=We?K:je,st=We?je:K;if(ze.get(L,st)!==Ye&&(Ye=!Ye,W.push({x:L,y:st}),W.length===q+1))break;if(P+=Ce,P>0){if(K===v)break;K+=Le,P-=I}}for(var dt=[],Je=0;Je<q;Je++)W[Je]&&W[Je+1]?dt.push(f(W[Je],W[Je+1])):dt.push(0);return dt}function b(O,$e,ze,q){var W,We=$e.y-O.y,Xe=$e.x-O.x,it=y(O,$e,ze,Math.ceil(q/2)),Ve=y(O,{x:O.x-Xe,y:O.y-We},ze,Math.ceil(q/2)),v=it.shift()+Ve.shift()-1;return(W=Ve.concat(v)).concat.apply(W,it)}function R(O,$e){var ze=x(O)/x($e),q=0;return $e.forEach(function(W,We){q+=Math.pow(O[We]-W*ze,2)}),{averageSize:ze,error:q}}function D(O,$e,ze){try{var q=b(O,{x:-1,y:O.y},ze,$e.length),W=b(O,{x:O.x,y:-1},ze,$e.length),We={x:Math.max(0,O.x-O.y)-1,y:Math.max(0,O.y-O.x)-1},Xe=b(O,We,ze,$e.length),it={x:Math.min(ze.width,O.x+O.y)+1,y:Math.min(ze.height,O.y+O.x)+1},Ve=b(O,it,ze,$e.length),v=R(q,$e),I=R(W,$e),Ce=R(Xe,$e),P=R(Ve,$e),_e=Math.sqrt(v.error*v.error+I.error*I.error+Ce.error*Ce.error+P.error*P.error),Le=(v.averageSize+I.averageSize+Ce.averageSize+P.averageSize)/4,Ye=(Math.pow(v.averageSize-Le,2)+Math.pow(I.averageSize-Le,2)+Math.pow(Ce.averageSize-Le,2)+Math.pow(P.averageSize-Le,2))/Le;return _e+Ye}catch{return 1/0}}function k(O,$e){for(var ze=Math.round($e.x);O.get(ze,Math.round($e.y));)ze--;for(var q=Math.round($e.x);O.get(q,Math.round($e.y));)q++;for(var W=(ze+q)/2,We=Math.round($e.y);O.get(Math.round(W),We);)We--;for(var Xe=Math.round($e.y);O.get(Math.round(W),Xe);)Xe++;var it=(We+Xe)/2;return{x:W,y:it}}function Re(O){for(var $e=[],ze=[],q=[],W=[],We=function(L){for(var st=0,dt=!1,Je=[0,0,0,0,0],pt=function(cr){var fr=O.get(cr,L);if(fr===dt)st++;else{Je=[Je[1],Je[2],Je[3],Je[4],st],st=1,dt=fr;var ir=x(Je)/7,ft=Math.abs(Je[0]-ir)<ir&&Math.abs(Je[1]-ir)<ir&&Math.abs(Je[2]-3*ir)<3*ir&&Math.abs(Je[3]-ir)<ir&&Math.abs(Je[4]-ir)<ir&&!fr,nr=x(Je.slice(-3))/3,lr=Math.abs(Je[2]-nr)<nr&&Math.abs(Je[3]-nr)<nr&&Math.abs(Je[4]-nr)<nr&&fr;if(ft){var er=cr-Je[3]-Je[4],pr=er-Je[2],Er={startX:pr,endX:er,y:L},xr=ze.filter(function(hr){return pr>=hr.bottom.startX&&pr<=hr.bottom.endX||er>=hr.bottom.startX&&pr<=hr.bottom.endX||pr<=hr.bottom.startX&&er>=hr.bottom.endX&&Je[2]/(hr.bottom.endX-hr.bottom.startX)<u&&Je[2]/(hr.bottom.endX-hr.bottom.startX)>c});xr.length>0?xr[0].bottom=Er:ze.push({top:Er,bottom:Er})}if(lr){var wr=cr-Je[4],Br=wr-Je[3],Er={startX:Br,y:L,endX:wr},xr=W.filter(function(_r){return Br>=_r.bottom.startX&&Br<=_r.bottom.endX||wr>=_r.bottom.startX&&Br<=_r.bottom.endX||Br<=_r.bottom.startX&&wr>=_r.bottom.endX&&Je[2]/(_r.bottom.endX-_r.bottom.startX)<u&&Je[2]/(_r.bottom.endX-_r.bottom.startX)>c});xr.length>0?xr[0].bottom=Er:W.push({top:Er,bottom:Er})}}},rr=-1;rr<=O.width;rr++)pt(rr);$e.push.apply($e,ze.filter(function(cr){return cr.bottom.y!==L&&cr.bottom.y-cr.top.y>=2})),ze=ze.filter(function(cr){return cr.bottom.y===L}),q.push.apply(q,W.filter(function(cr){return cr.bottom.y!==L})),W=W.filter(function(cr){return cr.bottom.y===L})},Xe=0;Xe<=O.height;Xe++)We(Xe);$e.push.apply($e,ze.filter(function(L){return L.bottom.y-L.top.y>=2})),q.push.apply(q,W);var it=$e.filter(function(L){return L.bottom.y-L.top.y>=2}).map(function(L){var st=(L.top.startX+L.top.endX+L.bottom.startX+L.bottom.endX)/4,dt=(L.top.y+L.bottom.y+1)/2;if(O.get(Math.round(st),Math.round(dt))){var Je=[L.top.endX-L.top.startX,L.bottom.endX-L.bottom.startX,L.bottom.y-L.top.y+1],pt=x(Je)/Je.length,rr=D({x:Math.round(st),y:Math.round(dt)},[1,1,3,1,1],O);return{score:rr,x:st,y:dt,size:pt}}}).filter(function(L){return!!L}).sort(function(L,st){return L.score-st.score}).map(function(L,st,dt){if(st>o)return null;var Je=dt.filter(function(rr,cr){return st!==cr}).map(function(rr){return{x:rr.x,y:rr.y,score:rr.score+Math.pow(rr.size-L.size,2)/L.size,size:rr.size}}).sort(function(rr,cr){return rr.score-cr.score});if(Je.length<2)return null;var pt=L.score+Je[0].score+Je[1].score;return{points:[L].concat(Je.slice(0,2)),score:pt}}).filter(function(L){return!!L}).sort(function(L,st){return L.score-st.score});if(it.length===0)return null;var Ve=p(it[0].points[0],it[0].points[1],it[0].points[2]),v=Ve.topRight,I=Ve.topLeft,Ce=Ve.bottomLeft,P=Fe(O,q,v,I,Ce),_e=[];P&&_e.push({alignmentPattern:{x:P.alignmentPattern.x,y:P.alignmentPattern.y},bottomLeft:{x:Ce.x,y:Ce.y},dimension:P.dimension,topLeft:{x:I.x,y:I.y},topRight:{x:v.x,y:v.y}});var Le=k(O,v),Ye=k(O,I),je=k(O,Ce),K=Fe(O,q,Le,Ye,je);return K&&_e.push({alignmentPattern:{x:K.alignmentPattern.x,y:K.alignmentPattern.y},bottomLeft:{x:je.x,y:je.y},topLeft:{x:Ye.x,y:Ye.y},topRight:{x:Le.x,y:Le.y},dimension:K.dimension}),_e.length===0?null:_e}n.locate=Re;function Fe(O,$e,ze,q,W){var We,Xe,it;try{We=g(q,ze,W,O),Xe=We.dimension,it=We.moduleSize}catch{return null}var Ve={x:ze.x-q.x+W.x,y:ze.y-q.y+W.y},v=(f(q,W)+f(q,ze))/2/it,I=1-3/v,Ce={x:q.x+I*(Ve.x-q.x),y:q.y+I*(Ve.y-q.y)},P=$e.map(function(Le){var Ye=(Le.top.startX+Le.top.endX+Le.bottom.startX+Le.bottom.endX)/4,je=(Le.top.y+Le.bottom.y+1)/2;if(O.get(Math.floor(Ye),Math.floor(je))){var K=[Le.top.endX-Le.top.startX,Le.bottom.endX-Le.bottom.startX,Le.bottom.y-Le.top.y+1];x(K)/K.length;var L=D({x:Math.floor(Ye),y:Math.floor(je)},[1,1,1],O),st=L+f({x:Ye,y:je},Ce);return{x:Ye,y:je,score:st}}}).filter(function(Le){return!!Le}).sort(function(Le,Ye){return Le.score-Ye.score}),_e=v>=15&&P.length?P[0]:Ce;return{alignmentPattern:_e,dimension:Xe}}})]).default})})(jsQR$2)),jsQR$2.exports}var jsQRExports=requireJsQR();const jsQR=getDefaultExportFromCjs$1(jsQRExports),ConnectSigner=({onBroadcastSuccess:t,bunkerURI:e,scannerOpen:r,onScannerClose:n,onBitcoinAddressScanned:s,onNpubScanned:o,onLightningInvoiceScanned:c})=>{const{decryptedKey:u}=useAuthStore(),{addConnection:f,removeConnection:x}=useConnectionsStore(),{currentKeypairId:p}=useWalletStore(),[g,y]=reactExports.useState(""),[b,R]=reactExports.useState(null),[D,k]=reactExports.useState(!1),[Re,Fe]=reactExports.useState(null),[O,$e]=reactExports.useState(null),[ze,q]=reactExports.useState(!1),[W,We]=reactExports.useState(""),[Xe,it]=reactExports.useState(!0),[Ve,v]=reactExports.useState(!1),I=r??Ve,Ce=Nr=>{r!==void 0?n&&n():v(Nr)},P=reactExports.useRef(null),_e=reactExports.useRef(null),[,Le]=reactExports.useState(""),[Ye,je]=reactExports.useState(null),[K,L]=reactExports.useState(!1),[st,dt]=reactExports.useState("connect"),[Je,pt]=reactExports.useState(null),[rr,cr]=reactExports.useState(null),[fr,ir]=reactExports.useState(null),ft=reactExports.useRef(null),nr=Nr=>{const or=Nr.startsWith("bitcoin:")?Nr.split(":")[1].split("?")[0]:Nr;return!!(/^1[a-km-zA-HJ-NP-Z1-9]{25,34}$/.test(or)||/^3[a-km-zA-HJ-NP-Z1-9]{25,34}$/.test(or)||/^bc1q[a-z0-9]{38,59}$/i.test(or)||/^bc1p[a-z0-9]{58}$/i.test(or))},lr=Nr=>Nr.startsWith("bitcoin:")?Nr.split(":")[1].split("?")[0]:Nr,er=Nr=>/^npub1[a-z0-9]{58}$/i.test(Nr),pr=Nr=>{const or=Nr.toLowerCase().trim();return or.startsWith("lnbc")||or.startsWith("lntb")},Er=async Nr=>{if(!u){R("Please unlock your vault first");return}if(!p){R("No active address selected");return}R(null),k(!0);try{const or=Nr||g,tr=ClientService.parseNostrConnectURI(or);console.log("Parsed URI:",tr);const mr=useConnectionsStore.getState().connections.find(sr=>sr.keypairId!==p?!1:!!(sr.appUrl&&tr.appUrl&&sr.appUrl===tr.appUrl||!sr.appUrl&&!tr.appUrl&&sr.name&&tr.name&&sr.name===tr.name));if(mr){k(!1),We(or),$e({connectionId:mr.id,name:mr.name||mr.appUrl||"Unknown App"});return}k(!1),Fe({uri:or,name:tr.name||"Unknown App",pubkey:tr.signerPubkey,appUrl:tr.appUrl})}catch(or){k(!1),R(or.message)}},xr=()=>{if(Re)try{const Nr=ClientService.parseNostrConnectURI(Re.uri),or=Math.random().toString(36).substring(7),tr={id:or,keypairId:p,signerPubkey:Nr.signerPubkey,relays:Nr.relays,secret:Nr.secret,name:Nr.name,appUrl:Nr.appUrl,status:"connecting",startedVia:"nostrconnect",connectedAt:Date.now()};f(tr),setNativeKnownSender(Nr.signerPubkey,!0).catch(yr=>{console.warn("[ConnectSigner] Failed to sync known sender to native signer:",yr)}),Re.rulesToCopy&&Re.rulesToCopy.length>0&&(console.log("[ConnectSigner] Copying",Re.rulesToCopy.length,"rules to new connection"),Re.rulesToCopy.forEach(yr=>{useConnectionsStore.getState().addRule({...yr,id:Math.random().toString(36).substring(7),connectionId:or,createdAt:Date.now()})}),console.log("[ConnectSigner]  Rules copied successfully")),y(""),Fe(null)}catch(Nr){R(Nr.message)}},wr=async()=>{if(!fr)return;const Nr=useRelayStore.getState().relays.map(tr=>tr.url);if(Nr.length===0)throw new Error("No relays connected");const or=new NDK({explicitRelayUrls:Nr});try{await Promise.race([or.connect(),new Promise((tr,yr)=>setTimeout(()=>yr(new Error("Broadcast connection timed out")),5e3))])}catch(tr){console.warn("Broadcast connection timed out/failed, checking for partial connections...",tr);let yr=0;if(or.pool.relays.forEach(mr=>{(mr.status===1||mr.status===5)&&yr++}),yr===0)throw console.error("No relays connected for broadcast"),tr;console.log(`Proceeding with broadcast via ${yr} relays`)}try{const tr=new NDKEvent(or,fr);await tr.publish(),console.log("Published event:",tr.id)}catch(tr){throw console.error("Broadcast failed:",tr),tr}},Br=async()=>{if(O){q(!0);try{const Nr=Xe?useConnectionsStore.getState().getRulesForConnection(O.connectionId):[];console.log("[ConnectSigner] Replacing connection, preserve rules:",Xe,"Old rules count:",Nr.length),x(O.connectionId),await new Promise(yr=>setTimeout(yr,100));const or=W||g,tr=ClientService.parseNostrConnectURI(or);$e(null),We(""),Fe({uri:or,name:tr.name||"Unknown App",pubkey:tr.signerPubkey,appUrl:tr.appUrl,rulesToCopy:Nr})}finally{q(!1),it(!0)}}},hr=Nr=>{Nr.sig?(console.log("[Offline] Signed Event detected, showing broadcast modal"),ir(Nr)):(console.log("[Offline] Unsigned Event detected, showing offline signer"),cr(Nr)),Ce(!1)},Cr=async Nr=>{const or=Nr.target.files?.[0];if(!or){console.log("[QR Upload] No file selected"),Le("No file selected");return}if(or.type==="application/json"||or.name.endsWith(".json")){console.log("[Offline] JSON file detected:",or.name);const tr=new FileReader;tr.onload=yr=>{try{const mr=yr.target?.result,sr=JSON.parse(mr);sr.kind!==void 0&&sr.content!==void 0?(console.log("[Offline] JSON Event Found via file:",sr),hr(sr),Ce(!1)):R("File is valid JSON but not a Nostr event")}catch{R("Invalid JSON file")}},tr.readAsText(or);return}console.log("[QR Upload] File selected:",or.name,or.type),R(null),Le(`File selected: ${or.name} (${(or.size/1024).toFixed(1)}KB)`);try{const tr=new Image,yr=new FileReader;yr.onload=mr=>{if(mr.target?.result){console.log("[QR Upload] File loaded, setting image source"),Le("File loaded, processing image...");const sr=mr.target.result;tr.src=sr,je(sr)}},yr.onerror=()=>{console.error("[QR Upload] FileReader error"),R("Failed to read image file"),Le("ERROR: Failed to read file")},tr.onload=async()=>{console.log("[QR Upload] Image loaded, dimensions:",tr.width,"x",tr.height),Le(`Image loaded: ${tr.width}x${tr.height}px`);const mr=document.createElement("canvas"),sr=mr.getContext("2d",{willReadFrequently:!0});if(!sr){R("Canvas not supported"),Le("ERROR: Canvas not supported");return}const Ar=(Qe,lt,ar=!1)=>{mr.width=Qe,mr.height=lt,sr.drawImage(tr,0,0,Qe,lt);const br=sr.getImageData(0,0,Qe,lt),Sr=jsQR(br.data,Qe,lt,{inversionAttempts:ar?"invertFirst":"dontInvert"});return Sr?Sr.data:null};let ht=Ar(tr.width,tr.height);if(!ht&&(tr.width>800||tr.height>800)){const Qe=800/Math.max(tr.width,tr.height);console.log("[QR Upload] Retrying with scale:",Qe),ht=Ar(Math.floor(tr.width*Qe),Math.floor(tr.height*Qe))}if(ht||(console.log("[QR Upload] Retrying with inversion"),ht=Ar(tr.width,tr.height,!0)),ht)if(console.log("[QR Upload] QR code found:",ht),Le(`QR code found! Data: ${ht.substring(0,50)}...`),ht.startsWith("nostrconnect://")||ht.startsWith("bunker://"))y(ht),Ce(!1),await Er(ht);else if(ht.toLowerCase().startsWith("ur:"))try{if(ft.current||(ft.current=new distExports$3.URDecoder),ft.current.receivePart(ht),ft.current.isComplete()){const lt=ft.current.resultUR().decodeCBOR();let ar;Buffer$1.isBuffer(lt)?ar=JSON.parse(lt.toString("utf8")):ar=lt,console.log("[Offline] UR Decode Complete:",ar),hr(ar),Ce(!1),ft.current=null}else Le(`Scanning... ${Math.floor(ft.current.estimatedPercentComplete()*100)}%`)}catch(Qe){console.error("[Offline] UR Decode Error:",Qe),Le("UR Error: "+Qe.message)}else if(ht.trim().startsWith("{"))try{const Qe=JSON.parse(ht);Qe.kind!==void 0&&Qe.content!==void 0?(console.log("[Offline] JSON Event Found:",Qe),hr(Qe),Ce(!1)):R("QR is JSON but not a valid Nostr event")}catch{R("Invalid QR format")}else R("QR code found but not a valid nostrconnect://, bunker://, or Event"),Le(`ERROR: Invalid URI format. Found: ${ht.substring(0,30)}...`),console.log("[QR Upload] Invalid format:",ht);else R("No QR code detected. Try cropping the image to just the QR code."),Le("ERROR: No QR code detected after multiple attempts"),console.log("[QR Upload] No QR code found")},tr.onerror=()=>{console.error("[QR Upload] Image load error"),R("Failed to load image"),Le("ERROR: Failed to load image")},yr.readAsDataURL(or)}catch(tr){console.error("[QR Upload] Error:",tr);const yr="Failed to process image: "+tr.message;R(yr),Le("ERROR: "+yr)}},_r=()=>{navigator.clipboard.writeText(e),L(!0),setTimeout(()=>L(!1),2e3)};reactExports.useEffect(()=>{(I||Re||O)&&window.history.pushState({modal:"connect-signer"},"");const or=()=>{I&&Ce(!1),Re&&Fe(null),O&&$e(null)};return window.addEventListener("popstate",or),()=>{window.removeEventListener("popstate",or)}},[I,Re,O]);const Tr=(Nr,or)=>{if(!I){console.log("[Camera] Stopping scan loop"),or.getTracks().forEach(sr=>sr.stop());return}const tr=document.createElement("canvas"),yr=tr.getContext("2d",{willReadFrequently:!0}),mr=async()=>{if(Nr.readyState===Nr.HAVE_ENOUGH_DATA&&yr){tr.height=Nr.videoHeight,tr.width=Nr.videoWidth,yr.drawImage(Nr,0,0,tr.width,tr.height);const sr=yr.getImageData(0,0,tr.width,tr.height),Ar=jsQR(sr.data,sr.width,sr.height,{inversionAttempts:"dontInvert"});if(Ar){console.log("[Camera] QR Found:",Ar.data);const ht=Ar.data;if(ht.startsWith("nostrconnect://")||ht.startsWith("bunker://")){or.getTracks().forEach(Qe=>Qe.stop()),Ce(!1),y(ht),await Er(ht);return}else if(nr(ht)){or.getTracks().forEach(lt=>lt.stop()),Ce(!1);const Qe=lr(ht);console.log("[Camera] Bitcoin address detected:",Qe),s&&s(Qe);return}else if(er(ht)){or.getTracks().forEach(Qe=>Qe.stop()),Ce(!1),console.log("[Camera] npub detected:",ht),pt(ht);return}else if(pr(ht)){or.getTracks().forEach(Qe=>Qe.stop()),Ce(!1),console.log("[Camera] Lightning invoice detected:",ht.slice(0,20)+"..."),c&&c(ht.trim());return}else if(ht.toLowerCase().startsWith("ur:"))try{if(ft.current||(ft.current=new distExports$3.URDecoder),ft.current.receivePart(ht),ft.current.isComplete()){const lt=ft.current.resultUR().decodeCBOR();let ar;Buffer$1.isBuffer(lt)?ar=JSON.parse(lt.toString("utf8")):ar=lt,console.log("[Camera] UR Decode Complete:",ar),or.getTracks().forEach(br=>br.stop()),Ce(!1),hr(ar),ft.current=null;return}else Le(`Scanning... ${Math.floor(ft.current.estimatedPercentComplete()*100)}%`)}catch(Qe){console.error("[Camera] UR Decode Error:",Qe);try{if(ft.current=new distExports$3.URDecoder,ft.current.receivePart(ht),ft.current.isComplete()){const ar=ft.current.resultUR().decodeCBOR();let br;Buffer$1.isBuffer(ar)?br=JSON.parse(ar.toString("utf8")):br=ar,console.log("[Camera] UR Decode Complete (Recovery):",br),or.getTracks().forEach(Sr=>Sr.stop()),Ce(!1),hr(br),ft.current=null;return}Le("New QR Detected...")}catch(lt){console.error("[Camera] Retry failed:",lt),Le(`Frame Error: ${lt.message}`)}}else if(ht.trim().startsWith("{"))try{const Qe=JSON.parse(ht);if(Qe.kind!==void 0&&Qe.content!==void 0){console.log("[Camera] JSON Event Found:",Qe),or.getTracks().forEach(lt=>lt.stop()),Ce(!1),hr(Qe);return}}catch{}}}document.getElementById("qr-modal")?requestAnimationFrame(mr):(console.log("[Camera] Modal closed, stopping tracks"),or.getTracks().forEach(sr=>sr.stop()))};requestAnimationFrame(mr)};return reactExports.useEffect(()=>{let Nr=null,or=!0;return I&&st==="connect"&&(async()=>{if(I){console.log("[Camera] Starting camera initialization..."),Le("Requesting camera access...");try{const yr=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(!or){yr.getTracks().forEach(sr=>sr.stop());return}Nr=yr,console.log("[Camera] Stream obtained:",yr.id,yr.active),Le("Camera access granted. Starting video...");const mr=_e.current;if(mr){console.log("[Camera] Video element found"),mr.srcObject=yr,mr.setAttribute("playsinline","true"),mr.onloadedmetadata=()=>{console.log("[Camera] Video metadata loaded:",mr.videoWidth,"x",mr.videoHeight),Le(`Video ready: ${mr.videoWidth}x${mr.videoHeight}`)},mr.onplay=()=>{console.log("[Camera] Video playing")};try{await mr.play(),console.log("[Camera] Video play promise resolved"),Tr(mr,yr)}catch(sr){console.error("[Camera] Play failed:",sr),Le("ERROR: Video play failed: "+sr.message)}}else console.error("[Camera] Video element NOT found in ref"),Le("ERROR: Video element not found")}catch(yr){console.error("[Camera] Access failed:",yr),Le("ERROR: Camera access failed: "+yr.message)}}})(),()=>{or=!1,Nr&&(console.log("[Camera] Cleaning up stream"),Nr.getTracks().forEach(yr=>yr.stop()))}},[I,st]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[b&&jsxRuntimeExports.jsx("div",{className:"text-red-400 text-sm bg-red-400/10 p-3 rounded-lg mb-4",children:b}),Je&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-sm w-full border border-slate-800 shadow-2xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white text-center mb-2",children:"Send to Nostr Address"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-sm text-center mb-4",children:"Choose payment method:"}),jsxRuntimeExports.jsx("div",{className:"bg-slate-950 rounded-lg p-3 mb-6 border border-slate-800",children:jsxRuntimeExports.jsxs("p",{className:"text-slate-300 text-sm font-mono break-all text-center",children:[Je.slice(0,12),"...",Je.slice(-8)]})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>{const Nr=Je;pt(null),o&&o(Nr,"bitcoin")},className:"w-full bg-orange-500 hover:bg-orange-400 text-white font-bold py-3 px-4 rounded-xl transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-lg",children:""}),"Send Bitcoin"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{const Nr=Je;pt(null),o&&o(Nr,"ecash")},className:"w-full bg-purple-500 hover:bg-purple-400 text-white font-bold py-3 px-4 rounded-xl transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-lg",children:""}),"Send eCash"]}),jsxRuntimeExports.jsx("button",{onClick:()=>pt(null),className:"w-full text-slate-400 hover:text-white py-2 transition-colors text-sm",children:"Cancel"})]})]})}),Re&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-md w-full border border-slate-800 shadow-2xl",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-amber-500/10 rounded-full",children:jsxRuntimeExports.jsx(QrCode,{className:"w-6 h-6 text-amber-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Approve Connection"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-400",children:"Do you want to connect to this app?"})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 rounded-lg p-4 mb-6 border border-slate-800 space-y-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"App Name"}),jsxRuntimeExports.jsx("p",{className:"text-white font-medium",children:Re.name})]}),Re.appUrl&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Website"}),jsxRuntimeExports.jsx("p",{className:"text-amber-400 truncate",children:Re.appUrl})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"App Pubkey"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 font-mono text-xs break-all",children:Re.pubkey})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>window.history.back(),className:"flex-1 bg-slate-800 hover:bg-slate-700 text-white font-bold py-3 px-4 rounded-lg transition-colors",children:"Cancel"}),jsxRuntimeExports.jsxs("button",{onClick:xr,className:"flex-1 bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4"}),"Connect"]})]})]})}),O&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-md w-full border border-slate-800 shadow-2xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Replace Existing Connection?"}),jsxRuntimeExports.jsxs("p",{className:"text-slate-300 mb-4",children:["You already have a connection to ",jsxRuntimeExports.jsx("span",{className:"text-amber-400 font-semibold",children:O.name}),". Do you want to replace it with this new connection?"]}),jsxRuntimeExports.jsx("div",{className:"mb-6",children:jsxRuntimeExports.jsx("button",{onClick:()=>it(!Xe),className:"w-full p-4 bg-slate-800/50 hover:bg-slate-800/70 rounded-lg border border-slate-700/50 transition-colors",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-4",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-slate-300 text-left flex-1",children:"Keep existing auto-approval rules"}),jsxRuntimeExports.jsx("div",{className:`relative w-14 h-7 rounded-md transition-all duration-300 ${Xe?"bg-gradient-to-r from-amber-500 to-amber-600":"bg-gradient-to-r from-slate-600 to-slate-700"}`,children:jsxRuntimeExports.jsx("div",{className:`absolute top-0.5 left-0.5 w-6 h-6 bg-white rounded-md shadow-lg transition-all duration-300 flex items-center justify-center ${Xe?"translate-x-7":"translate-x-0"}`,children:Xe?jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-slate-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]})})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>window.history.back(),disabled:ze,className:"flex-1 bg-slate-800 hover:bg-slate-700 disabled:bg-slate-700 disabled:opacity-50 text-white font-bold py-3 px-4 rounded-lg transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Br,disabled:ze,className:"flex-1 bg-amber-500 hover:bg-amber-600 disabled:bg-amber-600 disabled:opacity-50 text-slate-950 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:ze?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader,{className:"w-4 h-4 animate-spin"}),"Replacing..."]}):"Replace"})]})]})}),I&&jsxRuntimeExports.jsx("div",{id:"qr-modal",className:"fixed inset-0 bg-black/95 flex items-center justify-center p-4 z-50 overflow-y-auto h-full",children:jsxRuntimeExports.jsxs("div",{className:"relative w-full max-w-md bg-slate-900 rounded-xl p-4 border border-slate-800 my-auto",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-white mb-4 text-center",children:"Scan QR Code"}),jsxRuntimeExports.jsx("div",{className:"relative aspect-square bg-black rounded-lg overflow-hidden mb-4",children:st==="connect"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("video",{ref:_e,id:"qr-video",className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 border-2 border-amber-500/50 rounded-lg pointer-events-none"})]}):jsxRuntimeExports.jsx("div",{className:"w-full h-full flex items-center justify-center bg-white",children:jsxRuntimeExports.jsx(QRCodeSVG,{value:e,size:250})})}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-1 bg-slate-950 p-1 rounded-lg border border-slate-800",children:[jsxRuntimeExports.jsx("button",{onClick:()=>dt("bunker"),className:`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-all ${st==="bunker"?"bg-amber-500 text-slate-950":"text-slate-400 hover:text-white"}`,children:"Bunker"}),jsxRuntimeExports.jsx("button",{onClick:()=>dt("connect"),className:`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-all ${st==="connect"?"bg-amber-500 text-slate-950":"text-slate-400 hover:text-white"}`,children:"Connect"})]}),st==="bunker"&&jsxRuntimeExports.jsxs("div",{className:"flex gap-2 items-center",children:[jsxRuntimeExports.jsx("input",{type:"text",value:e,readOnly:!0,className:"flex-1 bg-slate-950 border border-slate-800 rounded-lg px-3 py-2 text-slate-300 text-sm font-mono truncate"}),jsxRuntimeExports.jsx("button",{onClick:_r,className:"p-2 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors",title:"Copy URI",children:K?jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-5 h-5 text-green-400"}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),st==="connect"&&jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("input",{type:"text",value:g,onChange:Nr=>y(Nr.target.value),placeholder:"nostrconnect://...",className:"flex-1 bg-slate-950 border border-slate-800 rounded-lg px-3 py-2 text-white text-sm font-mono focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none"}),jsxRuntimeExports.jsx("button",{onClick:()=>{Ce(!1),Er()},disabled:D||!g,className:"bg-amber-500 hover:bg-amber-400 disabled:opacity-50 text-slate-950 px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2",children:D?jsxRuntimeExports.jsx(Loader,{className:"w-4 h-4 animate-spin"}):"Connect"})]}),jsxRuntimeExports.jsx("p",{className:"text-center text-slate-400 text-xs pt-2",children:"Camera not working? Upload an image instead."}),Ye&&jsxRuntimeExports.jsxs("div",{className:"relative max-h-32 overflow-hidden rounded-lg",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Uploaded Image:"}),jsxRuntimeExports.jsx("img",{src:Ye,alt:"Uploaded QR",className:"w-full object-contain bg-black/50"})]}),jsxRuntimeExports.jsx("input",{type:"file",ref:P,onChange:Cr,accept:"image/*,application/json,.json",capture:"environment",className:"hidden"}),jsxRuntimeExports.jsxs("button",{onClick:()=>P.current?.click(),className:"w-full bg-slate-800 hover:bg-slate-700 text-white font-medium py-2.5 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm",children:[jsxRuntimeExports.jsx(QrCode,{className:"w-4 h-4"}),"Upload QR Image / JSON File"]}),jsxRuntimeExports.jsx("button",{onClick:()=>Ce(!1),className:"w-full bg-red-500/10 hover:bg-red-500/20 text-red-400 font-medium py-2.5 px-4 rounded-lg transition-colors text-sm",children:"Cancel"})]})]})}),rr&&jsxRuntimeExports.jsx(OfflineSigner,{event:rr,onClose:()=>cr(null)}),fr&&jsxRuntimeExports.jsx(BroadcastModal,{eventJson:fr,onClose:()=>ir(null),onBroadcast:wr,onSuccess:t})]})};class ProfileService{static ndk=null;static connecting=null;static getNDK(){return this.ndk||(this.ndk=new NDK({explicitRelayUrls:["wss://relay.primal.net","wss://nos.lol","wss://relay.nostr.band","wss://relay.damus.io","wss://purplepag.es","wss://relay.snort.social","wss://eden.nostr.land"]})),this.ndk}static async ensureConnection(){const e=this.getNDK();if(this.connecting)console.log("[ProfileService] Waiting for existing connection...");else{if(e.pool.connectedRelays().length>0){console.log("[ProfileService] Already connected to",e.pool.connectedRelays().length,"relays");return}console.log("[ProfileService] Initiating new NDK connection..."),this.connecting=e.connect().then(()=>{console.log("[ProfileService] NDK connection established"),this.connecting=null}).catch(n=>{console.warn("[ProfileService] Connection promise failed:",n),this.connecting=null})}const r=new Promise((n,s)=>setTimeout(()=>s(new Error("Connection timeout")),5e3));try{this.connecting&&await Promise.race([this.connecting,r]),console.log("[ProfileService] NDK ready for use")}catch{console.warn("[ProfileService] Connection timed out or failed, attempting to fetch anyway...")}}static async fetchProfile(e){try{console.log("[ProfileService] Starting fetchProfile for",e);const r=this.getNDK();await this.ensureConnection();let n,s;e.startsWith("npub")?(n=new NDKUser({npub:e}).pubkey,s=e):(n=e,s=new NDKUser({pubkey:e}).npub),console.log("[ProfileService] Pubkey:",n),console.log("[ProfileService] Fetching Kind 0 events...");const o=r.fetchEvents({kinds:[0],authors:[n],limit:1}),c=new Promise((b,R)=>setTimeout(()=>R(new Error("Fetch timeout after 10 seconds")),1e4)),u=await Promise.race([o,c]);if(console.log("[ProfileService] Received",u.size,"events"),u.size===0)return console.log("[ProfileService] No Kind 0 event found for",e),null;const f=Array.from(u)[0];console.log("[ProfileService] Raw event:",f),console.log("[ProfileService] Event content:",f.content);const x=JSON.parse(f.content);console.log("[ProfileService] Parsed content:",x);const p=x.display_name||x.displayName||x.name||void 0,g=x.picture||x.image||void 0,y={name:p,picture:g,about:x.about,banner:x.banner,lud16:x.lud16,nip05:x.nip05,website:x.website,npub:s};return console.log("[ProfileService] Returning profile:",y),y}catch(r){return console.error("[ProfileService] Failed to fetch profile:",r),console.error("[ProfileService] Error stack:",r instanceof Error?r.stack:"No stack"),this.connecting=null,null}}static async fetchContacts(e){try{console.log("[ProfileService] Fetching contacts for:",e);const r=this.getNDK();await this.ensureConnection(),console.log("[ProfileService] NDK connected");const s=await r.getUser({npub:e}).follows();if(console.log("[ProfileService] Found",s.size,"follows"),s.size===0)return[];const c=Array.from(s).map(p=>p.pubkey).slice(0,100);if(console.log("[ProfileService] Fetching profiles for",c.length,"contacts"),c.length===0)return[];const u=await r.fetchEvents({kinds:[0],authors:c});console.log("[ProfileService] Received",u.size,"profile events");const f=new Map;for(const p of u)try{const g=JSON.parse(p.content),y=new NDKUser({pubkey:p.pubkey}).npub;f.set(y,{name:g.name,picture:g.picture||g.image,about:g.about,nip05:g.nip05,lud16:g.lud16,banner:g.banner,website:g.website,npub:y})}catch{}const x=Array.from(f.values());return console.log("[ProfileService] Returning",x.length,"contacts"),x}catch(r){return console.error("[ProfileService] Error fetching contacts:",r),[]}}static async publishProfile(e,r){try{const n=new NDKPrivateKeySigner(e),s=new NDK({explicitRelayUrls:["wss://relay.primal.net","wss://nos.lol","wss://relay.damus.io"],signer:n});await Promise.race([s.connect(),new Promise((c,u)=>setTimeout(()=>u(new Error("Connection timeout")),5e3))]);const o=new NDKEvent(s);o.kind=0,o.content=JSON.stringify({name:r.name||"",picture:r.picture||"",about:r.about||"",banner:r.banner||"",lud16:r.lud16||"",nip05:r.nip05||"",website:r.website||""}),await o.sign(n),await Promise.race([o.publish(),new Promise((c,u)=>setTimeout(()=>u(new Error("Publish timeout - check relay connectivity")),1e4))]),console.log("Profile published successfully")}catch(n){throw console.error("Failed to publish profile:",n),n}}}const profile=Object.freeze(Object.defineProperty({__proto__:null,ProfileService},Symbol.toStringTag,{value:"Module"})),ViewPrivateKeyModal=({encryptedNsec:t,onClose:e})=>{const[r,n]=reactExports.useState(""),[s,o]=reactExports.useState(null),[c,u]=reactExports.useState(null),[f,x]=reactExports.useState(!1),[p,g]=reactExports.useState(!1),[y,b]=reactExports.useState(!1),R=async k=>{k.preventDefault(),u(null),x(!0);try{const Re=await CryptoService.decrypt(t,r);o(Re),n("")}catch{u("Incorrect password")}finally{x(!1)}},D=()=>{s&&(navigator.clipboard.writeText(s),g(!0),setTimeout(()=>g(!1),2e3))};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",onClick:e,children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-md w-full border border-slate-800 shadow-2xl",onClick:k=>k.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"View Private Key"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-1 text-slate-400 hover:text-white transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),s?jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 border border-slate-800 rounded-lg p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Private Key (nsec)"}),jsxRuntimeExports.jsx("button",{onClick:()=>b(!y),className:"text-slate-400 hover:text-white transition-colors",children:y?jsxRuntimeExports.jsx(EyeOff,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(Eye,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsx("div",{className:"font-mono text-sm break-all text-white",children:y?s:"".repeat(63)})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:D,className:"flex-1 flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 text-white font-bold py-3 px-4 rounded-lg transition-colors",children:p?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"}),"Copied!"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4"}),"Copy"]})}),jsxRuntimeExports.jsx("button",{onClick:e,className:"flex-1 bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold py-3 px-4 rounded-lg transition-colors",children:"Close"})]})]}):jsxRuntimeExports.jsxs("form",{onSubmit:R,className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-amber-500/10 border border-amber-500/20 rounded-lg p-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-200/80",children:" Never share your private key with anyone. Anyone with this key can control this account."})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Enter your password to reveal the private key"}),jsxRuntimeExports.jsx("input",{type:"password",inputMode:"numeric",value:r,onChange:k=>n(k.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",placeholder:"Password",required:!0,autoFocus:!0})]}),c&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm",children:c}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:e,className:"flex-1 bg-slate-800 hover:bg-slate-700 text-white font-bold py-3 px-4 rounded-lg transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:f,className:"flex-1 bg-amber-500 hover:bg-amber-600 disabled:bg-amber-600 disabled:opacity-50 text-slate-950 font-bold py-3 px-4 rounded-lg transition-colors",children:f?"Decrypting...":"Reveal"})]})]})]})})},ProfileEditor=({keypair:t,walletId:e,onBack:r})=>{const{updateKeypair:n,getWallet:s}=useWalletStore(),[o,c]=reactExports.useState({name:t.profile?.name||"",picture:t.profile?.picture||"",about:t.profile?.about||"",banner:t.profile?.banner||"",lud16:t.profile?.lud16||"",nip05:t.profile?.nip05||"",website:t.profile?.website||""}),[u,f]=reactExports.useState(""),[x,p]=reactExports.useState(!1),[g,y]=reactExports.useState(!1),[b,R]=reactExports.useState(null),[D,k]=reactExports.useState(!1),Re=s(e);reactExports.useEffect(()=>{(async()=>{y(!0);try{const $e=await ProfileService.fetchProfile(t.npub);$e&&c($e)}catch($e){console.error("Failed to fetch profile:",$e)}finally{y(!1)}})()},[t.npub]);const Fe=async O=>{O.preventDefault(),R(null),k(!1),p(!0);try{if(!Re)throw new Error("Wallet not found");const $e=await CryptoService.decrypt(t.encryptedNsec,u),ze=CryptoService.nsecToHex($e);await ProfileService.publishProfile(ze,o),n(e,t.id,{profile:{...o,lastFetched:Date.now()}}),k(!0),f(""),setTimeout(()=>{r()},1500)}catch($e){console.error("Failed to publish profile:",$e),R("Failed to publish profile. Please check your password and try again.")}finally{p(!1)}};return jsxRuntimeExports.jsxs("div",{className:"max-w-2xl mx-auto p-6",children:[jsxRuntimeExports.jsxs("button",{onClick:r,className:"flex items-center text-slate-400 hover:text-white mb-6 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]}),jsxRuntimeExports.jsxs("div",{className:"mb-8",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold flex items-center gap-2 mb-2",children:"Edit Profile"}),jsxRuntimeExports.jsxs("p",{className:"text-slate-400 text-sm",children:["Update your Nostr profile (kind:0) for ",t.npub.slice(0,12),"..."]})]}),g&&jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 bg-slate-950/90 backdrop-blur-sm flex flex-col items-center justify-center z-50",children:[jsxRuntimeExports.jsxs("div",{className:"relative w-16 h-16 mb-4",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-slate-700"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-transparent border-t-amber-500 animate-spin"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-3 rounded-full bg-amber-500/20 animate-pulse"})]}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-white mb-2",children:"Loading Profile"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-400",children:"Fetching latest data from relays..."})]}),jsxRuntimeExports.jsxs("form",{onSubmit:Fe,className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-900 rounded-xl border border-slate-800",children:[jsxRuntimeExports.jsxs("div",{className:"w-16 h-16 rounded-lg bg-slate-800 flex items-center justify-center overflow-hidden flex-shrink-0",children:[o.picture?jsxRuntimeExports.jsx("img",{src:o.picture,alt:"Profile",className:"w-full h-full object-cover",onError:O=>{O.currentTarget.style.display="none",O.currentTarget.nextElementSibling?.classList.remove("hidden")}}):null,jsxRuntimeExports.jsx(User,{className:`w-8 h-8 text-slate-600 ${o.picture?"hidden":""}`})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Profile Preview"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 truncate",children:o.name||"No name set"})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Display Name"}),jsxRuntimeExports.jsx("input",{type:"text",value:o.name||"",onChange:O=>c({...o,name:O.target.value}),className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",placeholder:"Your name"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Bio"}),jsxRuntimeExports.jsx("textarea",{value:o.about||"",onChange:O=>c({...o,about:O.target.value}),className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all resize-none",placeholder:"Tell us about yourself",rows:3})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Profile Picture URL"}),jsxRuntimeExports.jsx("input",{type:"url",value:o.picture||"",onChange:O=>c({...o,picture:O.target.value}),className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",placeholder:"https://example.com/avatar.jpg"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Banner Image URL"}),jsxRuntimeExports.jsx("input",{type:"url",value:o.banner||"",onChange:O=>c({...o,banner:O.target.value}),className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",placeholder:"https://example.com/banner.jpg"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Lightning Address"}),jsxRuntimeExports.jsx("input",{type:"text",value:o.lud16||"",onChange:O=>c({...o,lud16:O.target.value}),className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",placeholder:"you@getalby.com"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"NIP-05 Identifier"}),jsxRuntimeExports.jsx("input",{type:"text",value:o.nip05||"",onChange:O=>c({...o,nip05:O.target.value}),className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",placeholder:"you@example.com"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Website"}),jsxRuntimeExports.jsx("input",{type:"url",value:o.website||"",onChange:O=>c({...o,website:O.target.value}),className:"w-full bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",placeholder:"https://yourwebsite.com"})]})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 bg-slate-900 rounded-xl border border-slate-800",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Wallet PIN"}),jsxRuntimeExports.jsx("input",{type:"password",value:u,onChange:O=>f(O.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all",placeholder:"Enter PIN to publish",required:!0}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Your password is required to sign and publish the profile update."})]}),b&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm",children:b}),D&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-green-500/10 border border-green-500/20 rounded-lg text-green-400 text-sm",children:"Profile published successfully! Redirecting..."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-3 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:x||!u,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-amber-500 hover:bg-amber-600 disabled:bg-amber-600 disabled:opacity-50 text-slate-950 rounded-lg transition-colors font-bold",children:x?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader,{className:"w-4 h-4 animate-spin"}),"Publishing..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Save,{className:"w-4 h-4"}),"Save Profile"]})})]})]})]})},PasswordModal=({isOpen:t,onClose:e,onSubmit:r,title:n,description:s,submitLabel:o="Confirm",error:c})=>{const[u,f]=reactExports.useState("");reactExports.useEffect(()=>{t&&f("")},[t]);const x=p=>{p.preventDefault(),u&&r(u)};return t?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-800 max-w-md w-full p-6 shadow-xl",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Lock,{className:"w-5 h-5 text-amber-500"}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold",children:n})]}),jsxRuntimeExports.jsx("button",{onClick:e,className:"text-slate-400 hover:text-white transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),s&&jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-sm mb-4",children:s}),jsxRuntimeExports.jsxs("form",{onSubmit:x,children:[jsxRuntimeExports.jsx("input",{type:"password",value:u,onChange:p=>f(p.target.value),placeholder:"Enter password",inputMode:"numeric",className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 mb-3 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none",autoFocus:!0,required:!0}),c&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm mb-3",children:c}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-3 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors text-sm font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 bg-amber-500 hover:bg-amber-600 text-slate-950 rounded-lg transition-colors text-sm font-bold",children:o})]})]})]})}):null},InputModal=({isOpen:t,onClose:e,onSubmit:r,title:n,description:s,placeholder:o="Enter value",initialValue:c="",submitLabel:u="Save"})=>{const[f,x]=reactExports.useState(c);reactExports.useEffect(()=>{t&&x(c)},[t,c]);const p=g=>{g.preventDefault(),f.trim()&&r(f.trim())};return t?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-800 max-w-md w-full p-6 shadow-xl",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Pen,{className:"w-5 h-5 text-amber-500"}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold",children:n})]}),jsxRuntimeExports.jsx("button",{onClick:e,className:"text-slate-400 hover:text-white transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),s&&jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-sm mb-4",children:s}),jsxRuntimeExports.jsxs("form",{onSubmit:p,children:[jsxRuntimeExports.jsx("input",{type:"text",value:f,onChange:g=>x(g.target.value),placeholder:o,className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 mb-4 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none",autoFocus:!0,required:!0}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-3 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors text-sm font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 bg-amber-500 hover:bg-amber-600 text-slate-950 rounded-lg transition-colors text-sm font-bold",children:u})]})]})]})}):null},BackupModal=({isOpen:t,onClose:e,mnemonic:r,onDownload:n})=>{const[s,o]=reactExports.useState(!1),[c,u]=reactExports.useState(!1);if(!t)return null;const f=()=>{navigator.clipboard.writeText(r),o(!0),setTimeout(()=>o(!1),2e3)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-md overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Wallet Backup"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-1 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"text-center",children:jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-sm mb-4",children:"These are your recovery words. Write them down and keep them safe."})}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800 relative group",children:[jsxRuntimeExports.jsx("div",{className:`grid grid-cols-3 gap-2 ${c?"":"blur-sm select-none"}`,children:r.split(" ").map((x,p)=>jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 p-1",children:[jsxRuntimeExports.jsxs("span",{className:"text-slate-500 text-xs w-4",children:[p+1,"."]}),jsxRuntimeExports.jsx("span",{className:"font-mono font-medium text-amber-50",children:x})]},p))}),jsxRuntimeExports.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>u(!c),className:"p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors",title:c?"Hide seed phrase":"Show seed phrase",children:c?jsxRuntimeExports.jsx(EyeOff,{className:"w-4 h-4 text-slate-400"}):jsxRuntimeExports.jsx(Eye,{className:"w-4 h-4 text-slate-400"})}),jsxRuntimeExports.jsx("button",{onClick:f,className:"p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors",title:"Copy to clipboard",children:s?jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 text-green-500"}):jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4 text-slate-400"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/20 rounded-lg p-4 flex items-start gap-3",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-200/80",children:"Anyone with these words can access your funds. Never share them."})]}),jsxRuntimeExports.jsxs("button",{onClick:n,className:"w-full py-3 px-4 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition-colors border border-slate-700 flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(Download,{className:"w-4 h-4"}),"Download Encrypted Backup"]})]})]})})},KeypairManager=({walletId:t,onBack:e})=>{const{getWallet:r,addKeypair:n,updateKeypair:s,removeKeypair:o,setCurrentKeypair:c,currentKeypairId:u,updateWallet:f,removeWallet:x,currentWalletId:p,setCurrentWallet:g,wallets:y}=useWalletStore(),{unlock:b}=useAuthStore(),[R,D]=reactExports.useState(""),[k,Re]=reactExports.useState(!1),[Fe,O]=reactExports.useState(null),[$e,ze]=reactExports.useState(null),[q,W]=reactExports.useState(null),[We,Xe]=reactExports.useState(null),[it,Ve]=reactExports.useState(null),[v,I]=reactExports.useState(!1),[Ce,P]=reactExports.useState(null),[_e,Le]=reactExports.useState(!1),[Ye,je]=reactExports.useState(null),[K,L]=reactExports.useState(!1),[st,dt]=reactExports.useState(!1),[Je,pt]=reactExports.useState(!1),[rr,cr]=reactExports.useState(""),[fr,ir]=reactExports.useState(null),[ft,nr]=reactExports.useState(!1),[lr,er]=reactExports.useState(null),[pr,Er]=reactExports.useState(null),xr=r(t);if(!xr)return jsxRuntimeExports.jsx("div",{children:"Wallet not found"});reactExports.useEffect(()=>{(async()=>{for(const sr of xr.keypairs){if(sr.profile?.lastFetched&&Date.now()-sr.profile.lastFetched<1e4){console.log("[KeypairManager] Skipping profile fetch for",sr.npub,"- fetched recently");continue}try{console.log("[KeypairManager] Fetching profile for",sr.npub);const Ar=await ProfileService.fetchProfile(sr.npub);Ar&&s(xr.id,sr.id,{profile:{...Ar,lastFetched:Date.now()}})}catch(Ar){console.error(`Failed to fetch profile for ${sr.npub}:`,Ar)}}})()},[xr.id]);const wr=async mr=>{mr.preventDefault(),Ve(null),I(!0);try{if(Fe==="add"){if(xr.type==="imported")throw new Error("Cannot derive new addresses for imported wallets");const sr=await CryptoService.decrypt(xr.encryptedSeed,R);let Ar=0;xr.keypairs.forEach(Sr=>{if(Sr.derivationPath){const Rr=Sr.derivationPath.match(/(\d+)$/);if(Rr){const Lr=parseInt(Rr[1]);Lr>=Ar&&(Ar=Lr+1)}}});const{nsec:ht,npub:Qe,path:lt}=CryptoService.deriveKeypair(sr,Ar),ar=await CryptoService.encrypt(ht,R),br={id:crypto.randomUUID(),walletId:xr.id,name:`Address ${Ar+1}`,derivationPath:lt,encryptedNsec:ar,npub:Qe,createdAt:Date.now(),connections:[]};n(xr.id,br),Re(!1),D(""),O(null),setTimeout(async()=>{try{const Sr=await ProfileService.fetchProfile(Qe);Sr&&s(xr.id,br.id,{profile:{...Sr,lastFetched:Date.now()}})}catch(Sr){console.error("Failed to fetch profile for new keypair:",Sr)}},100)}else if(Fe==="switch"&&$e){const sr=await CryptoService.decrypt($e.encryptedNsec,R),Ar=CryptoService.nsecToHex(sr),{isUnlocked:ht,publicKey:Qe}=useAuthStore.getState();ht&&Qe&&useEcashStore.getState().saveSession(Qe),xr.id!==p&&g(xr.id),c($e.id);const lt=CryptoService.getPublicKeyHex(sr);b(Ar,lt,R),useEcashStore.getState().loadSession(lt),Re(!1),D(""),O(null),ze(null)}}catch{Ve("Incorrect password or operation failed")}finally{I(!1)}},Br=()=>{O("add"),Re(!0),Ve(null)},hr=async mr=>{try{console.log("[KeypairManager] Manually refreshing profile for",mr.npub);const sr=await ProfileService.fetchProfile(mr.npub);sr?(s(xr.id,mr.id,{profile:{...sr,lastFetched:Date.now()}}),Er({message:"Profile refreshed!",type:"success"})):Er({message:"No profile found",type:"error"})}catch(sr){console.error("Failed to refresh profile:",sr),Er({message:"Failed to refresh profile",type:"error"})}},Cr=async mr=>{const{password:sr}=useAuthStore.getState();if(sr)try{const Ar=await CryptoService.decrypt(mr.encryptedNsec,sr),ht=CryptoService.nsecToHex(Ar),Qe=CryptoService.getPublicKeyHex(Ar),{isUnlocked:lt,publicKey:ar}=useAuthStore.getState();lt&&ar&&useEcashStore.getState().saveSession(ar),c(mr.id),b(ht,Qe,sr),useEcashStore.getState().loadSession(Qe);return}catch{console.error("[KeypairManager] Cached password failed, prompting for password")}ze(mr),O("switch"),Re(!0),Ve(null)},_r=(mr,sr)=>{navigator.clipboard.writeText(mr),P(sr),setTimeout(()=>P(null),2e3)},Tr=mr=>{mr&&mr!==xr.name&&(f(xr.id,{name:mr}),Er({message:"Address Book renamed successfully!",type:"success"})),L(!1)},Nr=mr=>{mr&&Ye&&(s(xr.id,Ye.id,{name:mr}),Er({message:"Address renamed successfully!",type:"success"})),Le(!1),je(null)},or=async mr=>{try{const{CryptoService:sr}=await __vitePreload(async()=>{const{CryptoService:ht}=await Promise.resolve().then(()=>crypto$2);return{CryptoService:ht}},void 0,import.meta.url),Ar=await sr.decrypt(xr.encryptedSeed,mr);cr(Ar),D(mr),dt(!1),pt(!0),ir(null)}catch(sr){console.error("Failed to export backup:",sr),ir("Failed to decrypt wallet. Incorrect password.")}},tr=async()=>{try{const{CryptoService:mr}=await __vitePreload(async()=>{const{CryptoService:ar}=await Promise.resolve().then(()=>crypto$2);return{CryptoService:ar}},void 0,import.meta.url),sr=await mr.encrypt(rr,R),Ar=JSON.stringify({wallet:xr.name,encrypted:sr,timestamp:Date.now()},null,2),ht=new Blob([Ar],{type:"application/json"}),Qe=URL.createObjectURL(ht),lt=document.createElement("a");lt.href=Qe,lt.download=`${xr.name.toLowerCase().replace(/\s+/g,"-")}-backup-encrypted.json`,document.body.appendChild(lt),lt.click(),document.body.removeChild(lt),URL.revokeObjectURL(Qe),Er({message:"Encrypted backup downloaded successfully!",type:"success"})}catch(mr){console.error("Failed to download backup:",mr),Er({message:"Failed to generate backup file",type:"error"})}},yr=async mr=>{try{const{CryptoService:sr}=await __vitePreload(async()=>{const{CryptoService:Qe}=await Promise.resolve().then(()=>crypto$2);return{CryptoService:Qe}},void 0,import.meta.url);xr.type==="mnemonic"&&xr.encryptedSeed?await sr.decrypt(xr.encryptedSeed,mr):xr.keypairs.length>0&&await sr.decrypt(xr.keypairs[0].encryptedNsec,mr);const{lock:Ar}=useAuthStore.getState(),ht=y.filter(Qe=>Qe.id!==xr.id);x(xr.id),ht.length===0?Ar():e()}catch(sr){console.error("Failed to delete wallet:",sr),er("Incorrect password. Cannot delete wallet.")}};return We?jsxRuntimeExports.jsx(ProfileEditor,{keypair:We,walletId:t,onBack:()=>Xe(null)}):jsxRuntimeExports.jsxs("div",{className:"max-w-2xl mx-auto p-6",children:[jsxRuntimeExports.jsxs("button",{onClick:e,className:"flex items-center text-slate-400 hover:text-white mb-6 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Address Books"]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold",children:xr.name}),jsxRuntimeExports.jsx("button",{onClick:()=>L(!0),className:"p-1.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",title:"Rename address book",children:jsxRuntimeExports.jsx(Pen,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-sm",children:"Manage your addresses"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[xr.id!==p&&jsxRuntimeExports.jsxs("button",{onClick:()=>{Re(!0),O("switch"),ze(xr.keypairs[0])},className:"flex items-center gap-2 px-4 py-2 bg-amber-500 hover:bg-amber-600 text-slate-950 rounded-lg transition-colors text-sm font-bold",children:[jsxRuntimeExports.jsx(ArrowRightLeft,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Activate Wallet"})]}),xr.type==="mnemonic"&&xr.encryptedSeed&&jsxRuntimeExports.jsxs("button",{onClick:()=>{ir(null),dt(!0)},className:"flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors text-sm font-medium",children:[jsxRuntimeExports.jsx(Download,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Export Backup"})]}),xr.type==="mnemonic"&&jsxRuntimeExports.jsxs("button",{onClick:Br,className:"flex items-center gap-2 px-4 py-2 bg-amber-500 hover:bg-amber-600 text-slate-950 rounded-lg transition-colors text-sm font-bold",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Add Address"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{er(null),nr(!0)},className:"flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-red-500/10 hover:text-red-500 text-slate-400 rounded-lg transition-colors text-sm font-medium",title:"Delete Wallet",children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]}),k&&jsxRuntimeExports.jsx("div",{className:"mb-6 p-4 bg-slate-900 rounded-xl border border-slate-800",children:jsxRuntimeExports.jsxs("form",{onSubmit:wr,children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:Fe==="add"?"Enter wallet PIN to add new address":"Enter wallet PIN to switch address"}),jsxRuntimeExports.jsx("input",{type:"password",value:R,onChange:mr=>D(mr.target.value),inputMode:"numeric",className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 mb-3 focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none",placeholder:"Password",required:!0,autoFocus:!0}),it&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm mb-3",children:it}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{Re(!1),D(""),Ve(null),O(null),ze(null)},className:"flex-1 px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors text-sm",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:v,className:"flex-1 px-4 py-2 bg-amber-500 hover:bg-amber-600 text-slate-950 rounded-lg transition-colors text-sm font-bold disabled:opacity-50",children:v?"Processing...":"Confirm"})]})]})}),jsxRuntimeExports.jsx("div",{className:"grid gap-4",children:xr.keypairs.map(mr=>{const sr=mr.npub.length>16?`${mr.npub.slice(0,8)}...${mr.npub.slice(-6)}`:mr.npub;return jsxRuntimeExports.jsxs("div",{className:`p-4 rounded-xl border transition-all ${u===mr.id?"bg-amber-500/10 border-amber-500/50":"bg-slate-900 border-slate-800 hover:border-slate-700"}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[jsxRuntimeExports.jsxs("div",{className:`relative rounded-lg flex-shrink-0 cursor-pointer group ${u===mr.id?"bg-amber-500 text-slate-950":"bg-slate-800 text-slate-400"}`,onClick:Ar=>{Ar.stopPropagation();const ht=Ar.currentTarget;ht.classList.add("opacity-50"),hr(mr).finally(()=>ht.classList.remove("opacity-50"))},title:"Click to refresh profile",children:[mr.profile?.picture?jsxRuntimeExports.jsx("img",{src:mr.profile.picture,alt:mr.profile.name||"Profile",className:"w-10 h-10 rounded-lg object-cover",onError:Ar=>{Ar.currentTarget.style.display="none",Ar.currentTarget.nextElementSibling?.classList.remove("hidden")}}):null,jsxRuntimeExports.jsx("div",{className:`w-10 h-10 flex items-center justify-center ${mr.profile?.picture?"hidden":""}`,children:jsxRuntimeExports.jsx(User,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100 rounded-lg",children:jsxRuntimeExports.jsx(RefreshCw,{className:"w-4 h-4 text-white"})})]}),jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-lg truncate",children:mr.profile?.name||mr.name}),jsxRuntimeExports.jsx("button",{onClick:()=>{je(mr),Le(!0)},className:"p-1 text-slate-500 hover:text-white hover:bg-slate-800 rounded transition-colors",title:"Rename address",children:jsxRuntimeExports.jsx(Pen,{className:"w-3 h-3"})}),u===mr.id&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-500 text-xs rounded-full flex-shrink-0",children:"Active"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400 mt-1",children:[jsxRuntimeExports.jsx("span",{className:"font-mono bg-slate-950 px-2 py-0.5 rounded text-xs",children:sr}),jsxRuntimeExports.jsx("button",{onClick:()=>_r(mr.npub,mr.id),className:"text-slate-500 hover:text-white transition-colors flex-shrink-0 p-1 hover:bg-slate-800 rounded",title:"Copy npub",children:Ce===mr.id?jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 text-green-500"}):jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("button",{onClick:()=>W(mr),className:"text-slate-500 hover:text-white transition-colors flex-shrink-0 p-1 hover:bg-slate-800 rounded",title:"View private key",children:jsxRuntimeExports.jsx(Eye,{className:"w-4 h-4"})})]}),mr.derivationPath&&jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mt-1 font-mono truncate",children:mr.derivationPath})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t border-slate-800",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>Xe(mr),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors text-sm",children:[jsxRuntimeExports.jsx(Settings$1,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Edit Profile"})]}),u!==mr.id&&xr.id===p&&jsxRuntimeExports.jsxs("button",{onClick:()=>Cr(mr),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 text-sm font-medium rounded-lg transition-colors",children:[jsxRuntimeExports.jsx(ArrowRightLeft,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Switch"})]}),xr.keypairs.length>1&&jsxRuntimeExports.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this address?")&&o(xr.id,mr.id)},className:"px-3 py-2 text-slate-400 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",title:"Delete address",children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]},mr.id)})}),q&&jsxRuntimeExports.jsx(ViewPrivateKeyModal,{encryptedNsec:q.encryptedNsec,onClose:()=>W(null)}),jsxRuntimeExports.jsx(InputModal,{isOpen:_e,onClose:()=>{Le(!1),je(null)},onSubmit:Nr,title:"Rename Address",description:"Enter a new name for this address",placeholder:"Address name",initialValue:Ye?.name||"",submitLabel:"Rename"}),jsxRuntimeExports.jsx(InputModal,{isOpen:K,onClose:()=>L(!1),onSubmit:Tr,title:"Rename Address Book",description:"Enter a new name for your address book",placeholder:"Address book name",initialValue:xr.name,submitLabel:"Rename"}),jsxRuntimeExports.jsx(PasswordModal,{isOpen:st,onClose:()=>{dt(!1),ir(null)},onSubmit:or,title:"Export Encrypted Backup",description:"Enter your wallet PIN to export an encrypted backup file",submitLabel:"Export",error:fr}),jsxRuntimeExports.jsx(BackupModal,{isOpen:Je,onClose:()=>{pt(!1),cr(""),D("")},mnemonic:rr,onDownload:tr}),jsxRuntimeExports.jsx(PasswordModal,{isOpen:ft,onClose:()=>{nr(!1),er(null)},onSubmit:yr,title:"Delete Address Book",description:`Are you sure you want to delete "${xr.name}"? This action cannot be undone. Enter your password to confirm.`,submitLabel:"Delete Address Book",error:lr}),pr&&jsxRuntimeExports.jsx(Toast,{message:pr.message,type:pr.type,isOpen:!!pr,onClose:()=>Er(null)})]})},WalletManager=({onBack:t})=>{const[e,r]=reactExports.useState("list"),[n,s]=reactExports.useState(null),{wallets:o,currentWalletId:c,setCurrentWallet:u}=useWalletStore(),{lock:f}=useAuthStore(),x=()=>{e==="list"&&t?t():(r("list"),s(null))},p=y=>{u(y),f()},g=y=>{s(y),r("keypairs")};return e==="create"?jsxRuntimeExports.jsx(CreateWallet,{onBack:x,onComplete:x}):e==="import"?jsxRuntimeExports.jsx(ImportWallet,{onBack:x,onComplete:x}):e==="keypairs"&&n?jsxRuntimeExports.jsx(KeypairManager,{walletId:n,onBack:x}):jsxRuntimeExports.jsxs("div",{className:"max-w-2xl mx-auto p-6",children:[t&&e==="list"&&jsxRuntimeExports.jsxs("button",{onClick:t,className:"flex items-center text-slate-400 hover:text-white mb-6 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Connections"]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8",children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[jsxRuntimeExports.jsx(Notebook,{className:"w-6 h-6 text-amber-500"}),"Address Books"]})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>r("import"),className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors text-sm font-medium",children:[jsxRuntimeExports.jsx(Download,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"sm:inline",children:"Import"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>r("create"),className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-amber-500 hover:bg-amber-600 text-slate-950 rounded-lg transition-colors text-sm font-bold",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"sm:inline",children:"Create"})]})]})]}),jsxRuntimeExports.jsx("div",{className:"grid gap-4",children:o.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12 bg-slate-900/50 rounded-xl border border-slate-800 border-dashed",children:[jsxRuntimeExports.jsx(Notebook,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-medium text-slate-300 mb-2",children:"No Address Books Found"}),jsxRuntimeExports.jsx("p",{className:"text-slate-500 max-w-xs mx-auto mb-6",children:"Create a new address book or import an existing one to get started."}),jsxRuntimeExports.jsxs("div",{className:"flex justify-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>r("create"),className:"px-4 py-2 bg-amber-500 hover:bg-amber-600 text-slate-950 rounded-lg font-bold transition-colors",children:"Create New"}),jsxRuntimeExports.jsx("button",{onClick:()=>r("import"),className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors",children:"Import"})]})]}):o.map(y=>jsxRuntimeExports.jsx("div",{className:`p-4 rounded-xl border transition-all ${c===y.id?"bg-amber-500/10 border-amber-500/50":"bg-slate-900 border-slate-800 hover:border-slate-700"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[jsxRuntimeExports.jsx("div",{className:`p-2 rounded-lg ${c===y.id?"bg-amber-500 text-slate-950":"bg-slate-800 text-slate-400"}`,children:y.type==="imported"?jsxRuntimeExports.jsx(Key,{className:"w-5 h-5"}):jsxRuntimeExports.jsx(Notebook,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2",children:[y.name,c===y.id&&jsxRuntimeExports.jsxs("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-500 text-xs rounded-full flex items-center gap-1",children:[jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"})," Active"]})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-3 text-sm text-slate-400 mt-1",children:jsxRuntimeExports.jsxs("span",{children:[y.keypairs.length," address",y.keypairs.length!==1?"es":""]})})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>g(y.id),className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",title:"Manage Keys",children:jsxRuntimeExports.jsx(Settings$1,{className:"w-4 h-4"})}),c!==y.id&&jsxRuntimeExports.jsx("button",{onClick:()=>p(y.id),className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",title:"Switch to this wallet",children:jsxRuntimeExports.jsx(ArrowRightLeft,{className:"w-4 h-4"})})]})]})},y.id))})]})},RelayManager=({onClose:t})=>{const{relays:e,addRelay:r,removeRelay:n}=useRelayStore(),[s,o]=reactExports.useState(""),[c,u]=reactExports.useState(null),f=async()=>{if(u(null),!s.trim()){u("Please enter a relay URL");return}if(!s.startsWith("wss://")&&!s.startsWith("ws://")){u("Relay URL must start with wss:// or ws://");return}const b=s.trim();r(b),o(""),window.dispatchEvent(new CustomEvent("add-relay",{detail:{url:b}}))},x=b=>{if(e.length<=1){u("Cannot remove the last relay");return}n(b)},p=b=>{switch(b.status){case"connected":return jsxRuntimeExports.jsx(Wifi,{className:"w-4 h-4 text-green-500"});case"connecting":return jsxRuntimeExports.jsx(Loader,{className:"w-4 h-4 text-yellow-500 animate-spin"});case"disconnected":case"error":return jsxRuntimeExports.jsx(WifiOff,{className:"w-4 h-4 text-red-500"})}},g=b=>{switch(b.status){case"connected":return"Connected";case"connecting":return"Connecting...";case"disconnected":return"Disconnected";case"error":return"Error"}},y=b=>{switch(b.status){case"connected":return"text-green-500";case"connecting":return"text-yellow-500";case"disconnected":case"error":return"text-red-500"}};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",onClick:t,children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-2xl w-full border border-slate-800 shadow-2xl max-h-[80vh] flex flex-col",onClick:b=>b.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-white",children:"Relay Management"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Manage your Nostr relay connections"})]}),jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",title:"Close",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-slate-400"})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Add New Relay"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsx("input",{type:"text",value:s,onChange:b=>o(b.target.value),onKeyDown:b=>b.key==="Enter"&&f(),placeholder:"wss://relay.example.com",className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none"}),jsxRuntimeExports.jsxs("button",{onClick:f,className:"w-full px-4 py-2 bg-amber-500 hover:bg-amber-600 text-slate-950 rounded-lg font-bold transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"}),"Add Relay"]})]}),c&&jsxRuntimeExports.jsx("p",{className:"text-red-400 text-sm mt-2",children:c})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto",children:[jsxRuntimeExports.jsxs("h3",{className:"text-sm font-medium text-slate-400 mb-3",children:["Active Relays (",e.length,")"]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:e.map(b=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-950 rounded-xl border border-slate-800 hover:border-slate-700 transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[p(b),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"font-mono text-sm text-white truncate",children:b.url}),jsxRuntimeExports.jsxs("div",{className:`text-xs ${y(b)} mt-0.5`,children:[g(b),b.lastConnected&&b.status==="connected"&&jsxRuntimeExports.jsxs("span",{className:"text-slate-500 ml-2",children:[" Last: ",new Date(b.lastConnected).toLocaleTimeString()]}),b.failedAttempts>0&&jsxRuntimeExports.jsxs("span",{className:"text-slate-500 ml-2",children:[" Failed attempts: ",b.failedAttempts]})]})]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>x(b.url),className:"p-2 text-slate-400 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors ml-2",title:"Remove relay",disabled:e.length<=1,children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]},b.url))})]}),jsxRuntimeExports.jsx("div",{className:"mt-6 p-4 bg-slate-950 rounded-lg border border-slate-800",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-400",children:[jsxRuntimeExports.jsx("strong",{className:"text-slate-300",children:"Note:"})," Relays are used to communicate with Nostr apps. The PWA will automatically attempt to reconnect to disconnected relays every 5 seconds."]})})]})})},BottomNav=({currentView:t,onChange:e,onScan:r})=>jsxRuntimeExports.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-800 pb-safe",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-around items-center h-16 max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>e("connections"),className:`flex flex-col items-center justify-center w-full h-full transition-colors ${t==="connections"?"text-amber-500":"text-slate-500 hover:text-slate-400"}`,children:[jsxRuntimeExports.jsx(FilePenLine,{className:"w-6 h-6 mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:"Connections"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>r?.(),className:"flex flex-col items-center justify-center w-full h-full transition-colors text-slate-500 hover:text-amber-400",children:[jsxRuntimeExports.jsx(ScanLine,{className:"w-6 h-6 mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:"Scan"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>e("wallet"),className:`flex flex-col items-center justify-center w-full h-full transition-colors ${t==="wallet"?"text-amber-500":"text-slate-500 hover:text-slate-400"}`,children:[jsxRuntimeExports.jsx(Wallet,{className:"w-6 h-6 mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:"Wallet"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>e("ids"),className:`flex flex-col items-center justify-center w-full h-full transition-colors ${t==="ids"?"text-amber-500":"text-slate-500 hover:text-slate-400"}`,children:[jsxRuntimeExports.jsx(AtSign,{className:"w-6 h-6 mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:"IDs"})]})]})}),bitcoin$1={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128};function check$d(t){if(t.length<8||t.length>72||t[0]!==48||t[1]!==t.length-2||t[2]!==2)return!1;const e=t[3];if(e===0||5+e>=t.length||t[4+e]!==2)return!1;const r=t[5+e];return!(r===0||6+e+r!==t.length||t[4]&128||e>1&&t[4]===0&&!(t[5]&128)||t[e+6]&128||r>1&&t[e+6]===0&&!(t[e+7]&128))}function decode$i(t){if(t.length<8)throw new Error("DER sequence length is too short");if(t.length>72)throw new Error("DER sequence length is too long");if(t[0]!==48)throw new Error("Expected DER sequence");if(t[1]!==t.length-2)throw new Error("DER sequence length is invalid");if(t[2]!==2)throw new Error("Expected DER integer");const e=t[3];if(e===0)throw new Error("R length is zero");if(5+e>=t.length)throw new Error("R length is too long");if(t[4+e]!==2)throw new Error("Expected DER integer (2)");const r=t[5+e];if(r===0)throw new Error("S length is zero");if(6+e+r!==t.length)throw new Error("S length is invalid");if(t[4]&128)throw new Error("R value is negative");if(e>1&&t[4]===0&&!(t[5]&128))throw new Error("R value excessively padded");if(t[e+6]&128)throw new Error("S value is negative");if(r>1&&t[e+6]===0&&!(t[e+7]&128))throw new Error("S value excessively padded");return{r:t.slice(4,4+e),s:t.slice(6+e)}}function encode$j(t,e){const r=t.length,n=e.length;if(r===0)throw new Error("R length is zero");if(n===0)throw new Error("S length is zero");if(r>33)throw new Error("R length is too long");if(n>33)throw new Error("S length is too long");if(t[0]&128)throw new Error("R value is negative");if(e[0]&128)throw new Error("S value is negative");if(r>1&&t[0]===0&&!(t[1]&128))throw new Error("R value excessively padded");if(n>1&&e[0]===0&&!(e[1]&128))throw new Error("S value excessively padded");const s=new Uint8Array(6+r+n);return s[0]=48,s[1]=s.length-2,s[2]=2,s[3]=t.length,s.set(t,4),s[4+r]=2,s[5+r]=e.length,s.set(e,6+r),s}var OPS$7;(function(t){t[t.OP_FALSE=0]="OP_FALSE",t[t.OP_0=0]="OP_0",t[t.OP_PUSHDATA1=76]="OP_PUSHDATA1",t[t.OP_PUSHDATA2=77]="OP_PUSHDATA2",t[t.OP_PUSHDATA4=78]="OP_PUSHDATA4",t[t.OP_1NEGATE=79]="OP_1NEGATE",t[t.OP_RESERVED=80]="OP_RESERVED",t[t.OP_TRUE=81]="OP_TRUE",t[t.OP_1=81]="OP_1",t[t.OP_2=82]="OP_2",t[t.OP_3=83]="OP_3",t[t.OP_4=84]="OP_4",t[t.OP_5=85]="OP_5",t[t.OP_6=86]="OP_6",t[t.OP_7=87]="OP_7",t[t.OP_8=88]="OP_8",t[t.OP_9=89]="OP_9",t[t.OP_10=90]="OP_10",t[t.OP_11=91]="OP_11",t[t.OP_12=92]="OP_12",t[t.OP_13=93]="OP_13",t[t.OP_14=94]="OP_14",t[t.OP_15=95]="OP_15",t[t.OP_16=96]="OP_16",t[t.OP_NOP=97]="OP_NOP",t[t.OP_VER=98]="OP_VER",t[t.OP_IF=99]="OP_IF",t[t.OP_NOTIF=100]="OP_NOTIF",t[t.OP_VERIF=101]="OP_VERIF",t[t.OP_VERNOTIF=102]="OP_VERNOTIF",t[t.OP_ELSE=103]="OP_ELSE",t[t.OP_ENDIF=104]="OP_ENDIF",t[t.OP_VERIFY=105]="OP_VERIFY",t[t.OP_RETURN=106]="OP_RETURN",t[t.OP_TOALTSTACK=107]="OP_TOALTSTACK",t[t.OP_FROMALTSTACK=108]="OP_FROMALTSTACK",t[t.OP_2DROP=109]="OP_2DROP",t[t.OP_2DUP=110]="OP_2DUP",t[t.OP_3DUP=111]="OP_3DUP",t[t.OP_2OVER=112]="OP_2OVER",t[t.OP_2ROT=113]="OP_2ROT",t[t.OP_2SWAP=114]="OP_2SWAP",t[t.OP_IFDUP=115]="OP_IFDUP",t[t.OP_DEPTH=116]="OP_DEPTH",t[t.OP_DROP=117]="OP_DROP",t[t.OP_DUP=118]="OP_DUP",t[t.OP_NIP=119]="OP_NIP",t[t.OP_OVER=120]="OP_OVER",t[t.OP_PICK=121]="OP_PICK",t[t.OP_ROLL=122]="OP_ROLL",t[t.OP_ROT=123]="OP_ROT",t[t.OP_SWAP=124]="OP_SWAP",t[t.OP_TUCK=125]="OP_TUCK",t[t.OP_CAT=126]="OP_CAT",t[t.OP_SUBSTR=127]="OP_SUBSTR",t[t.OP_LEFT=128]="OP_LEFT",t[t.OP_RIGHT=129]="OP_RIGHT",t[t.OP_SIZE=130]="OP_SIZE",t[t.OP_INVERT=131]="OP_INVERT",t[t.OP_AND=132]="OP_AND",t[t.OP_OR=133]="OP_OR",t[t.OP_XOR=134]="OP_XOR",t[t.OP_EQUAL=135]="OP_EQUAL",t[t.OP_EQUALVERIFY=136]="OP_EQUALVERIFY",t[t.OP_RESERVED1=137]="OP_RESERVED1",t[t.OP_RESERVED2=138]="OP_RESERVED2",t[t.OP_1ADD=139]="OP_1ADD",t[t.OP_1SUB=140]="OP_1SUB",t[t.OP_2MUL=141]="OP_2MUL",t[t.OP_2DIV=142]="OP_2DIV",t[t.OP_NEGATE=143]="OP_NEGATE",t[t.OP_ABS=144]="OP_ABS",t[t.OP_NOT=145]="OP_NOT",t[t.OP_0NOTEQUAL=146]="OP_0NOTEQUAL",t[t.OP_ADD=147]="OP_ADD",t[t.OP_SUB=148]="OP_SUB",t[t.OP_MUL=149]="OP_MUL",t[t.OP_DIV=150]="OP_DIV",t[t.OP_MOD=151]="OP_MOD",t[t.OP_LSHIFT=152]="OP_LSHIFT",t[t.OP_RSHIFT=153]="OP_RSHIFT",t[t.OP_BOOLAND=154]="OP_BOOLAND",t[t.OP_BOOLOR=155]="OP_BOOLOR",t[t.OP_NUMEQUAL=156]="OP_NUMEQUAL",t[t.OP_NUMEQUALVERIFY=157]="OP_NUMEQUALVERIFY",t[t.OP_NUMNOTEQUAL=158]="OP_NUMNOTEQUAL",t[t.OP_LESSTHAN=159]="OP_LESSTHAN",t[t.OP_GREATERTHAN=160]="OP_GREATERTHAN",t[t.OP_LESSTHANOREQUAL=161]="OP_LESSTHANOREQUAL",t[t.OP_GREATERTHANOREQUAL=162]="OP_GREATERTHANOREQUAL",t[t.OP_MIN=163]="OP_MIN",t[t.OP_MAX=164]="OP_MAX",t[t.OP_WITHIN=165]="OP_WITHIN",t[t.OP_RIPEMD160=166]="OP_RIPEMD160",t[t.OP_SHA1=167]="OP_SHA1",t[t.OP_SHA256=168]="OP_SHA256",t[t.OP_HASH160=169]="OP_HASH160",t[t.OP_HASH256=170]="OP_HASH256",t[t.OP_CODESEPARATOR=171]="OP_CODESEPARATOR",t[t.OP_CHECKSIG=172]="OP_CHECKSIG",t[t.OP_CHECKSIGVERIFY=173]="OP_CHECKSIGVERIFY",t[t.OP_CHECKMULTISIG=174]="OP_CHECKMULTISIG",t[t.OP_CHECKMULTISIGVERIFY=175]="OP_CHECKMULTISIGVERIFY",t[t.OP_NOP1=176]="OP_NOP1",t[t.OP_CHECKLOCKTIMEVERIFY=177]="OP_CHECKLOCKTIMEVERIFY",t[t.OP_NOP2=177]="OP_NOP2",t[t.OP_CHECKSEQUENCEVERIFY=178]="OP_CHECKSEQUENCEVERIFY",t[t.OP_NOP3=178]="OP_NOP3",t[t.OP_NOP4=179]="OP_NOP4",t[t.OP_NOP5=180]="OP_NOP5",t[t.OP_NOP6=181]="OP_NOP6",t[t.OP_NOP7=182]="OP_NOP7",t[t.OP_NOP8=183]="OP_NOP8",t[t.OP_NOP9=184]="OP_NOP9",t[t.OP_NOP10=185]="OP_NOP10",t[t.OP_CHECKSIGADD=186]="OP_CHECKSIGADD",t[t.OP_PUBKEYHASH=253]="OP_PUBKEYHASH",t[t.OP_PUBKEY=254]="OP_PUBKEY",t[t.OP_INVALIDOPCODE=255]="OP_INVALIDOPCODE"})(OPS$7||(OPS$7={}));const HEX_STRINGS$2="0123456789abcdefABCDEF",HEX_CODES=HEX_STRINGS$2.split("").map(t=>t.codePointAt(0)),HEX_CODEPOINTS=Array(256).fill(!0).map((t,e)=>{const r=String.fromCodePoint(e),n=HEX_STRINGS$2.indexOf(r);return n<0?void 0:n<16?n:n-6}),ENCODER=new TextEncoder,DECODER=new TextDecoder;function toUtf8(t){return DECODER.decode(t)}function fromUtf8(t){return ENCODER.encode(t)}function concat$1(t){const e=t.reduce((s,o)=>s+o.length,0),r=new Uint8Array(e);let n=0;for(const s of t)r.set(s,n),n+=s.length;return r}function toHex(t){const e=t||new Uint8Array;return e.length>512?_toHexLengthPerf(e):_toHexIterPerf(e)}function _toHexIterPerf(t){let e="";for(let r=0;r<t.length;++r)e+=HEX_STRINGS$2[HEX_CODEPOINTS[HEX_CODES[t[r]>>4]]],e+=HEX_STRINGS$2[HEX_CODEPOINTS[HEX_CODES[t[r]&15]]];return e}function _toHexLengthPerf(t){const e=new Uint8Array(t.length*2);for(let r=0;r<t.length;++r)e[r*2]=HEX_CODES[t[r]>>4],e[r*2+1]=HEX_CODES[t[r]&15];return DECODER.decode(e)}function fromHex(t){const e=ENCODER.encode(t||""),r=new Uint8Array(Math.floor(e.length/2));let n;for(n=0;n<r.length;n++){const s=HEX_CODEPOINTS[e[n*2]],o=HEX_CODEPOINTS[e[n*2+1]];if(s===void 0||o===void 0)break;r[n]=s<<4|o}return n===r.length?r:r.slice(0,n)}function toBase64(t){return btoa(String.fromCharCode(...t))}function fromBase64(t){const e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r}function compare(t,e){const r=Math.min(t.length,e.length);for(let n=0;n<r;++n)if(t[n]!==e[n])return t[n]<e[n]?-1:1;return t.length===e.length?0:t.length>e.length?1:-1}function writeUInt8(t,e,r){if(e+1>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r>255)throw new Error(`The value of "value" is out of range. It must be >= 0 and <= 255. Received ${r}`);return t[e]=r,e+1}function writeUInt16$1(t,e,r,n){if(e+2>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(n=n.toUpperCase(),r>65535)throw new Error(`The value of "value" is out of range. It must be >= 0 and <= 65535. Received ${r}`);return n==="LE"?(t[e]=r&255,t[e+1]=r>>8&255):(t[e]=r>>8&255,t[e+1]=r&255),e+2}function writeUInt32$2(t,e,r,n){if(e+4>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(n=n.toUpperCase(),r>4294967295)throw new Error(`The value of "value" is out of range. It must be >= 0 and <= ${4294967295}. Received ${r}`);return n==="LE"?(t[e]=r&255,t[e+1]=r>>8&255,t[e+2]=r>>16&255,t[e+3]=r>>24&255):(t[e]=r>>24&255,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=r&255),e+4}function writeUInt64$1(t,e,r,n){if(e+8>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(n=n.toUpperCase(),r>0xffffffffffffffffn)throw new Error(`The value of "value" is out of range. It must be >= 0 and <= ${0xffffffffffffffffn}. Received ${r}`);return n==="LE"?(t[e]=Number(r&0xffn),t[e+1]=Number(r>>8n&0xffn),t[e+2]=Number(r>>16n&0xffn),t[e+3]=Number(r>>24n&0xffn),t[e+4]=Number(r>>32n&0xffn),t[e+5]=Number(r>>40n&0xffn),t[e+6]=Number(r>>48n&0xffn),t[e+7]=Number(r>>56n&0xffn)):(t[e]=Number(r>>56n&0xffn),t[e+1]=Number(r>>48n&0xffn),t[e+2]=Number(r>>40n&0xffn),t[e+3]=Number(r>>32n&0xffn),t[e+4]=Number(r>>24n&0xffn),t[e+5]=Number(r>>16n&0xffn),t[e+6]=Number(r>>8n&0xffn),t[e+7]=Number(r&0xffn)),e+8}function readUInt8(t,e){if(e+1>t.length)throw new Error("Offset is outside the bounds of Uint8Array");return t[e]}function readUInt16$1(t,e,r){if(e+2>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r=r.toUpperCase(),r==="LE"){let n=0;return n=(n<<8)+t[e+1],n=(n<<8)+t[e],n}else{let n=0;return n=(n<<8)+t[e],n=(n<<8)+t[e+1],n}}function readUInt32$1(t,e,r){if(e+4>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r=r.toUpperCase(),r==="LE"){let n=0;return n=(n<<8)+t[e+3]>>>0,n=(n<<8)+t[e+2]>>>0,n=(n<<8)+t[e+1]>>>0,n=(n<<8)+t[e]>>>0,n}else{let n=0;return n=(n<<8)+t[e]>>>0,n=(n<<8)+t[e+1]>>>0,n=(n<<8)+t[e+2]>>>0,n=(n<<8)+t[e+3]>>>0,n}}function writeInt32(t,e,r,n){if(e+4>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r>2147483647||r<-2147483648)throw new Error(`The value of "value" is out of range. It must be >= -2147483648 and <= 2147483647. Received ${r}`);return n=n.toUpperCase(),n==="LE"?(t[e]=r&255,t[e+1]=r>>8&255,t[e+2]=r>>16&255,t[e+3]=r>>24&255):(t[e]=r>>24&255,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=r&255),e+4}function writeInt64(t,e,r,n){if(e+8>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r>0x7fffffffffffffffn||r<-0x8000000000000000n)throw new Error(`The value of "value" is out of range. It must be >= ${-0x8000000000000000n} and <= ${0x7fffffffffffffffn}. Received ${r}`);return n=n.toUpperCase(),n==="LE"?(t[e]=Number(r&0xffn),t[e+1]=Number(r>>8n&0xffn),t[e+2]=Number(r>>16n&0xffn),t[e+3]=Number(r>>24n&0xffn),t[e+4]=Number(r>>32n&0xffn),t[e+5]=Number(r>>40n&0xffn),t[e+6]=Number(r>>48n&0xffn),t[e+7]=Number(r>>56n&0xffn)):(t[e]=Number(r>>56n&0xffn),t[e+1]=Number(r>>48n&0xffn),t[e+2]=Number(r>>40n&0xffn),t[e+3]=Number(r>>32n&0xffn),t[e+4]=Number(r>>24n&0xffn),t[e+5]=Number(r>>16n&0xffn),t[e+6]=Number(r>>8n&0xffn),t[e+7]=Number(r&0xffn)),e+8}function readInt32(t,e,r){if(e+4>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r=r.toUpperCase(),r==="LE"){const n=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24>>>0);return t[e+3]<=127?n:n-4294967296}else{const n=(t[e]<<24>>>0)+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3];return t[e]<=127?n:n-4294967296}}function readInt64(t,e,r){if(e+8>t.length)throw new Error("Offset is outside the bounds of Uint8Array");r=r.toUpperCase();let n=0n;if(r==="LE")return n=(n<<8n)+BigInt(t[e+7]),n=(n<<8n)+BigInt(t[e+6]),n=(n<<8n)+BigInt(t[e+5]),n=(n<<8n)+BigInt(t[e+4]),n=(n<<8n)+BigInt(t[e+3]),n=(n<<8n)+BigInt(t[e+2]),n=(n<<8n)+BigInt(t[e+1]),n=(n<<8n)+BigInt(t[e]),t[e+7]<=127?n:n-0x10000000000000000n;{let s=0n;return s=(s<<8n)+BigInt(t[e]),s=(s<<8n)+BigInt(t[e+1]),s=(s<<8n)+BigInt(t[e+2]),s=(s<<8n)+BigInt(t[e+3]),s=(s<<8n)+BigInt(t[e+4]),s=(s<<8n)+BigInt(t[e+5]),s=(s<<8n)+BigInt(t[e+6]),s=(s<<8n)+BigInt(t[e+7]),t[e]<=127?s:s-0x10000000000000000n}}function encodingLength$1(t){return t<OPS$7.OP_PUSHDATA1?1:t<=255?2:t<=65535?3:5}function encode$i(t,e,r){const n=encodingLength$1(e);return n===1?writeUInt8(t,r,e):n===2?(writeUInt8(t,r,OPS$7.OP_PUSHDATA1),writeUInt8(t,r+1,e)):n===3?(writeUInt8(t,r,OPS$7.OP_PUSHDATA2),writeUInt16$1(t,r+1,e,"LE")):(writeUInt8(t,r,OPS$7.OP_PUSHDATA4),writeUInt32$2(t,r+1,e,"LE")),n}function decode$h(t,e){const r=readUInt8(t,e);let n,s;if(r<OPS$7.OP_PUSHDATA1)n=r,s=1;else if(r===OPS$7.OP_PUSHDATA1){if(e+2>t.length)return null;n=readUInt8(t,e+1),s=2}else if(r===OPS$7.OP_PUSHDATA2){if(e+3>t.length)return null;n=readUInt16$1(t,e+1,"LE"),s=3}else{if(e+5>t.length)return null;if(r!==OPS$7.OP_PUSHDATA4)throw new Error("Unexpected opcode");n=readUInt32$1(t,e+1,"LE"),s=5}return{opcode:r,number:n,size:s}}function scriptNumSize(t){return t>2147483647?5:t>8388607?4:t>32767?3:t>127?2:t>0?1:0}function encode$h(t){let e=Math.abs(t);const r=scriptNumSize(e),n=new Uint8Array(r),s=t<0;for(let o=0;o<r;++o)writeUInt8(n,o,e&255),e>>=8;return n[r-1]&128?writeUInt8(n,r-1,s?128:0):s&&(n[r-1]|=128),n}var store$1;function getGlobalConfig$1(t){return{lang:t?.lang??store$1?.lang,message:t?.message,abortEarly:t?.abortEarly??store$1?.abortEarly,abortPipeEarly:t?.abortPipeEarly??store$1?.abortPipeEarly}}var store2$1;function getGlobalMessage$1(t){return store2$1?.get(t)}var store3$1;function getSchemaMessage$1(t){return store3$1?.get(t)}var store4$1;function getSpecificMessage$1(t,e){return store4$1?.get(t)?.get(e)}function _stringify$1(t){const e=typeof t;return e==="string"?`"${t}"`:e==="number"||e==="bigint"||e==="boolean"?`${t}`:e==="object"||e==="function"?(t&&Object.getPrototypeOf(t)?.constructor?.name)??"null":e}function _addIssue$1(t,e,r,n,s){const o=s&&"input"in s?s.input:r.value,c=s?.expected??t.expects??null,u=s?.received??_stringify$1(o),f={kind:t.kind,type:t.type,input:o,expected:c,received:u,message:`Invalid ${e}: ${c?`Expected ${c} but r`:"R"}eceived ${u}`,requirement:t.requirement,path:s?.path,issues:s?.issues,lang:n.lang,abortEarly:n.abortEarly,abortPipeEarly:n.abortPipeEarly},x=t.kind==="schema",p=s?.message??t.message??getSpecificMessage$1(t.reference,f.lang)??(x?getSchemaMessage$1(f.lang):null)??n.message??getGlobalMessage$1(f.lang);p&&(f.message=typeof p=="function"?p(f):p),x&&(r.typed=!1),r.issues?r.issues.push(f):r.issues=[f]}function _joinExpects(t,e){const r=[...new Set(t)];return r.length>1?`(${r.join(` ${e} `)})`:r[0]??"never"}var ValiError$1=class extends Error{issues;constructor(e){super(e[0].message),this.name="ValiError",this.issues=e}};function everyItem(t,e){return{kind:"validation",type:"every_item",reference:everyItem,async:!1,expects:null,requirement:t,message:e,_run(r,n){return r.typed&&!r.value.every(this.requirement)&&_addIssue$1(this,"item",r,n),r}}}function integer$1(t){return{kind:"validation",type:"integer",reference:integer$1,async:!1,expects:null,requirement:Number.isInteger,message:t,_run(e,r){return e.typed&&!this.requirement(e.value)&&_addIssue$1(this,"integer",e,r),e}}}function length$1(t,e){return{kind:"validation",type:"length",reference:length$1,async:!1,expects:`${t}`,requirement:t,message:e,_run(r,n){return r.typed&&r.value.length!==this.requirement&&_addIssue$1(this,"length",r,n,{received:`${r.value.length}`}),r}}}function maxValue$1(t,e){return{kind:"validation",type:"max_value",reference:maxValue$1,async:!1,expects:`<=${t instanceof Date?t.toJSON():_stringify$1(t)}`,requirement:t,message:e,_run(r,n){return r.typed&&r.value>this.requirement&&_addIssue$1(this,"value",r,n,{received:r.value instanceof Date?r.value.toJSON():_stringify$1(r.value)}),r}}}function minValue$1(t,e){return{kind:"validation",type:"min_value",reference:minValue$1,async:!1,expects:`>=${t instanceof Date?t.toJSON():_stringify$1(t)}`,requirement:t,message:e,_run(r,n){return r.typed&&r.value<this.requirement&&_addIssue$1(this,"value",r,n,{received:r.value instanceof Date?r.value.toJSON():_stringify$1(r.value)}),r}}}function regex$1(t,e){return{kind:"validation",type:"regex",reference:regex$1,async:!1,expects:`${t}`,requirement:t,message:e,_run(r,n){return r.typed&&!this.requirement.test(r.value)&&_addIssue$1(this,"format",r,n),r}}}function getDefault$1(t,e,r){return typeof t.default=="function"?t.default(e,r):t.default}function is(t,e){return!t._run({typed:!1,value:e},{abortEarly:!0}).issues}function any(){return{kind:"schema",type:"any",reference:any,expects:"any",async:!1,_run(t){return t.typed=!0,t}}}function array(t,e){return{kind:"schema",type:"array",reference:array,expects:"Array",async:!1,item:t,message:e,_run(r,n){const s=r.value;if(Array.isArray(s)){r.typed=!0,r.value=[];for(let o=0;o<s.length;o++){const c=s[o],u=this.item._run({typed:!1,value:c},n);if(u.issues){const f={type:"array",origin:"value",input:s,key:o,value:c};for(const x of u.issues)x.path?x.path.unshift(f):x.path=[f],r.issues?.push(x);if(r.issues||(r.issues=u.issues),n.abortEarly){r.typed=!1;break}}u.typed||(r.typed=!1),r.value.push(u.value)}}else _addIssue$1(this,"type",r,n);return r}}}function bigint(t){return{kind:"schema",type:"bigint",reference:bigint,expects:"bigint",async:!1,message:t,_run(e,r){return typeof e.value=="bigint"?e.typed=!0:_addIssue$1(this,"type",e,r),e}}}function custom(t,e){return{kind:"schema",type:"custom",reference:custom,expects:"unknown",async:!1,check:t,message:e,_run(r,n){return this.check(r.value)?r.typed=!0:_addIssue$1(this,"type",r,n),r}}}function instance$1(t,e){return{kind:"schema",type:"instance",reference:instance$1,expects:t.name,async:!1,class:t,message:e,_run(r,n){return r.value instanceof this.class?r.typed=!0:_addIssue$1(this,"type",r,n),r}}}function nullable(t,...e){const r={kind:"schema",type:"nullable",reference:nullable,expects:`(${t.expects} | null)`,async:!1,wrapped:t,_run(n,s){return n.value===null&&("default"in this&&(n.value=getDefault$1(this,n,s)),n.value===null)?(n.typed=!0,n):this.wrapped._run(n,s)}};return 0 in e&&(r.default=e[0]),r}function nullish(t,...e){const r={kind:"schema",type:"nullish",reference:nullish,expects:`(${t.expects} | null | undefined)`,async:!1,wrapped:t,_run(n,s){return(n.value===null||n.value===void 0)&&("default"in this&&(n.value=getDefault$1(this,n,s)),n.value===null||n.value===void 0)?(n.typed=!0,n):this.wrapped._run(n,s)}};return 0 in e&&(r.default=e[0]),r}function number$1(t){return{kind:"schema",type:"number",reference:number$1,expects:"number",async:!1,message:t,_run(e,r){return typeof e.value=="number"&&!isNaN(e.value)?e.typed=!0:_addIssue$1(this,"type",e,r),e}}}function object$1(t,e){return{kind:"schema",type:"object",reference:object$1,expects:"Object",async:!1,entries:t,message:e,_run(r,n){const s=r.value;if(s&&typeof s=="object"){r.typed=!0,r.value={};for(const o in this.entries){const c=s[o],u=this.entries[o]._run({typed:!1,value:c},n);if(u.issues){const f={type:"object",origin:"value",input:s,key:o,value:c};for(const x of u.issues)x.path?x.path.unshift(f):x.path=[f],r.issues?.push(x);if(r.issues||(r.issues=u.issues),n.abortEarly){r.typed=!1;break}}u.typed||(r.typed=!1),(u.value!==void 0||o in s)&&(r.value[o]=u.value)}}else _addIssue$1(this,"type",r,n);return r}}}function optional$1(t,...e){const r={kind:"schema",type:"optional",reference:optional$1,expects:`(${t.expects} | undefined)`,async:!1,wrapped:t,_run(n,s){return n.value===void 0&&("default"in this&&(n.value=getDefault$1(this,n,s)),n.value===void 0)?(n.typed=!0,n):this.wrapped._run(n,s)}};return 0 in e&&(r.default=e[0]),r}function string$1(t){return{kind:"schema",type:"string",reference:string$1,expects:"string",async:!1,message:t,_run(e,r){return typeof e.value=="string"?e.typed=!0:_addIssue$1(this,"type",e,r),e}}}function tuple(t,e){return{kind:"schema",type:"tuple",reference:tuple,expects:"Array",async:!1,items:t,message:e,_run(r,n){const s=r.value;if(Array.isArray(s)){r.typed=!0,r.value=[];for(let o=0;o<this.items.length;o++){const c=s[o],u=this.items[o]._run({typed:!1,value:c},n);if(u.issues){const f={type:"array",origin:"value",input:s,key:o,value:c};for(const x of u.issues)x.path?x.path.unshift(f):x.path=[f],r.issues?.push(x);if(r.issues||(r.issues=u.issues),n.abortEarly){r.typed=!1;break}}u.typed||(r.typed=!1),r.value.push(u.value)}}else _addIssue$1(this,"type",r,n);return r}}}function _subIssues$1(t){let e;if(t)for(const r of t)e?e.push(...r.issues):e=r.issues;return e}function union$1(t,e){return{kind:"schema",type:"union",reference:union$1,expects:_joinExpects(t.map(r=>r.expects),"|"),async:!1,options:t,message:e,_run(r,n){let s,o,c;for(const u of this.options){const f=u._run({typed:!1,value:r.value},n);if(f.typed)if(f.issues)o?o.push(f):o=[f];else{s=f;break}else c?c.push(f):c=[f]}if(s)return s;if(o){if(o.length===1)return o[0];_addIssue$1(this,"type",r,n,{issues:_subIssues$1(o)}),r.typed=!0}else{if(c?.length===1)return c[0];_addIssue$1(this,"type",r,n,{issues:_subIssues$1(c)})}return r}}}function parse$1(t,e,r){const n=t._run({typed:!1,value:e},getGlobalConfig$1(r));if(n.issues)throw new ValiError$1(n.issues);return n.value}function partial(t,e){const r={};for(const n in t.entries)r[n]=optional$1(t.entries[n]);return{...t,entries:r}}function pipe$1(...t){return{...t[0],pipe:t,_run(e,r){for(const n of t)if(n.kind!=="metadata"){if(e.issues&&(n.kind==="schema"||n.kind==="transformation")){e.typed=!1;break}(!e.issues||!r.abortEarly&&!r.abortPipeEarly)&&(e=n._run(e,r))}return e}}}const ZERO32=new Uint8Array(32),EC_P=fromHex("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),NBufferSchemaFactory=t=>pipe$1(instance$1(Uint8Array),length$1(t));function stacksEqual(t,e){return t.length!==e.length?!1:t.every((r,n)=>compare(r,e[n])===0)}function isPoint(t){if(!(t instanceof Uint8Array)||t.length<33)return!1;const e=t[0],r=t.slice(1,33);if(compare(ZERO32,r)===0||compare(r,EC_P)>=0)return!1;if((e===2||e===3)&&t.length===33)return!0;const n=t.slice(33);return compare(ZERO32,n)===0||compare(n,EC_P)>=0?!1:e===4&&t.length===65}const TAPLEAF_VERSION_MASK=254;function isTapleaf(t){return!t||!("output"in t)||!(t.output instanceof Uint8Array)?!1:t.version!==void 0?(t.version&TAPLEAF_VERSION_MASK)===t.version:!0}function isTaptree(t){return Array.isArray(t)?t.length!==2?!1:t.every(e=>isTaptree(e)):isTapleaf(t)}const Buffer256bitSchema=NBufferSchemaFactory(32),Hash160bitSchema=NBufferSchemaFactory(20),Hash256bitSchema=NBufferSchemaFactory(32),BufferSchema=instance$1(Uint8Array);pipe$1(string$1(),regex$1(/^([0-9a-f]{2})+$/i));const UInt8Schema=pipe$1(number$1(),integer$1(),minValue$1(0),maxValue$1(255)),UInt32Schema=pipe$1(number$1(),integer$1(),minValue$1(0),maxValue$1(4294967295)),SatoshiSchema=pipe$1(bigint(),minValue$1(0n),maxValue$1(0x7fffffffffffffffn)),NullablePartial=t=>object$1(Object.entries(t).reduce((e,r)=>({...e,[r[0]]:nullish(r[1])}),{})),ZERO$1=new Uint8Array(1);function toDER(t){let e=0;for(;t[e]===0;)++e;return e===t.length?ZERO$1:(t=t.slice(e),t[0]&128?concat$1([ZERO$1,t]):t)}function fromDER(t){t[0]===0&&(t=t.slice(1));const e=new Uint8Array(32),r=Math.max(0,32-t.length);return e.set(t,r),e}function decode$g(t){const e=readUInt8(t,t.length-1);if(!isDefinedHashType(e))throw new Error("Invalid hashType "+e);const r=decode$i(t.subarray(0,-1)),n=fromDER(r.r),s=fromDER(r.s);return{signature:concat$1([n,s]),hashType:e}}function encode$g(t,e){if(parse$1(object$1({signature:NBufferSchemaFactory(64),hashType:UInt8Schema}),{signature:t,hashType:e}),!isDefinedHashType(e))throw new Error("Invalid hashType "+e);const r=new Uint8Array(1);writeUInt8(r,0,e);const n=toDER(t.slice(0,32)),s=toDER(t.slice(32,64));return concat$1([encode$j(n,s),r])}const scriptSignature=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$g,encode:encode$g},Symbol.toStringTag,{value:"Module"})),OP_INT_BASE$1=OPS$7.OP_RESERVED,StackSchema=array(union$1([instance$1(Uint8Array),number$1()]));function isOPInt(t){return is(number$1(),t)&&(t===OPS$7.OP_0||t>=OPS$7.OP_1&&t<=OPS$7.OP_16||t===OPS$7.OP_1NEGATE)}function isPushOnlyChunk(t){return is(BufferSchema,t)||isOPInt(t)}function isPushOnly(t){return is(pipe$1(any(),everyItem(isPushOnlyChunk)),t)}function countNonPushOnlyOPs(t){return t.length-t.filter(isPushOnlyChunk).length}function asMinimalOP(t){if(t.length===0)return OPS$7.OP_0;if(t.length===1){if(t[0]>=1&&t[0]<=16)return OP_INT_BASE$1+t[0];if(t[0]===129)return OPS$7.OP_1NEGATE}}function chunksIsBuffer(t){return t instanceof Uint8Array}function chunksIsArray(t){return is(StackSchema,t)}function singleChunkIsBuffer(t){return t instanceof Uint8Array}function compile(t){if(chunksIsBuffer(t))return t;parse$1(StackSchema,t);const e=t.reduce((s,o)=>singleChunkIsBuffer(o)?o.length===1&&asMinimalOP(o)!==void 0?s+1:s+encodingLength$1(o.length)+o.length:s+1,0),r=new Uint8Array(e);let n=0;if(t.forEach(s=>{if(singleChunkIsBuffer(s)){const o=asMinimalOP(s);if(o!==void 0){writeUInt8(r,n,o),n+=1;return}n+=encode$i(r,s.length,n),r.set(s,n),n+=s.length}else writeUInt8(r,n,s),n+=1}),n!==r.length)throw new Error("Could not decode chunks");return r}function decompile(t){if(chunksIsArray(t))return t;parse$1(BufferSchema,t);const e=[];let r=0;for(;r<t.length;){const n=t[r];if(n>OPS$7.OP_0&&n<=OPS$7.OP_PUSHDATA4){const s=decode$h(t,r);if(s===null||(r+=s.size,r+s.number>t.length))return null;const o=t.slice(r,r+s.number);r+=s.number;const c=asMinimalOP(o);c!==void 0?e.push(c):e.push(o)}else e.push(n),r+=1}return e}function toASM(t){if(chunksIsBuffer(t)&&(t=decompile(t)),!t)throw new Error("Could not convert invalid chunks to ASM");return t.map(e=>{if(singleChunkIsBuffer(e)){const r=asMinimalOP(e);if(r===void 0)return toHex(e);e=r}return OPS$7[e]}).join(" ")}function toStack(t){return t=decompile(t),parse$1(custom(isPushOnly),t),t.map(e=>singleChunkIsBuffer(e)?e:e===OPS$7.OP_0?new Uint8Array(0):encode$h(e-OP_INT_BASE$1))}function isCanonicalPubKey(t){return isPoint(t)}function isDefinedHashType(t){const e=t&-129;return e>0&&e<4}function isCanonicalScriptSignature(t){return!(t instanceof Uint8Array)||!isDefinedHashType(t[t.length-1])?!1:check$d(t.slice(0,-1))}const signature=scriptSignature;function prop(t,e,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get(){const n=r.call(this);return this[e]=n,n},set(n){Object.defineProperty(this,e,{configurable:!0,enumerable:!0,value:n,writable:!0})}})}function value(t){let e;return()=>(e!==void 0||(e=t()),e)}const OPS$6=OPS$7,OP_INT_BASE=OPS$6.OP_RESERVED;function p2ms(t,e){if(!t.input&&!t.output&&!(t.pubkeys&&t.m!==void 0)&&!t.signatures)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{});function r(f){return isCanonicalScriptSignature(f)||(e.allowIncomplete&&f===OPS$6.OP_0)!==void 0}parse$1(partial(object$1({network:object$1({}),m:number$1(),n:number$1(),output:BufferSchema,pubkeys:array(custom(isPoint),"Received invalid pubkey"),signatures:array(custom(r),"Expected signature to be of type isAcceptableSignature"),input:BufferSchema})),t);const s={network:t.network||bitcoin$1};let o=[],c=!1;function u(f){c||(c=!0,o=decompile(f),s.m=o[0]-OP_INT_BASE,s.n=o[o.length-2]-OP_INT_BASE,s.pubkeys=o.slice(1,-2))}if(prop(s,"output",()=>{if(t.m&&s.n&&t.pubkeys)return compile([].concat(OP_INT_BASE+t.m,t.pubkeys,OP_INT_BASE+s.n,OPS$6.OP_CHECKMULTISIG))}),prop(s,"m",()=>{if(s.output)return u(s.output),s.m}),prop(s,"n",()=>{if(s.pubkeys)return s.pubkeys.length}),prop(s,"pubkeys",()=>{if(t.output)return u(t.output),s.pubkeys}),prop(s,"signatures",()=>{if(t.input)return decompile(t.input).slice(1)}),prop(s,"input",()=>{if(t.signatures)return compile([OPS$6.OP_0].concat(t.signatures))}),prop(s,"witness",()=>{if(s.input)return[]}),prop(s,"name",()=>{if(!(!s.m||!s.n))return`p2ms(${s.m} of ${s.n})`}),e.validate){if(t.output){if(u(t.output),parse$1(number$1(),o[0],{message:"Output is invalid"}),parse$1(number$1(),o[o.length-2],{message:"Output is invalid"}),o[o.length-1]!==OPS$6.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(s.m<=0||s.n>16||s.m>s.n||s.n!==o.length-3)throw new TypeError("Output is invalid");if(!s.pubkeys.every(f=>isPoint(f)))throw new TypeError("Output is invalid");if(t.m!==void 0&&t.m!==s.m)throw new TypeError("m mismatch");if(t.n!==void 0&&t.n!==s.n)throw new TypeError("n mismatch");if(t.pubkeys&&!stacksEqual(t.pubkeys,s.pubkeys))throw new TypeError("Pubkeys mismatch")}if(t.pubkeys){if(t.n!==void 0&&t.n!==t.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(s.n=t.pubkeys.length,s.n<s.m)throw new TypeError("Pubkey count cannot be less than m")}if(t.signatures){if(t.signatures.length<s.m)throw new TypeError("Not enough signatures provided");if(t.signatures.length>s.m)throw new TypeError("Too many signatures provided")}if(t.input){if(t.input[0]!==OPS$6.OP_0)throw new TypeError("Input is invalid");if(s.signatures.length===0||!s.signatures.every(r))throw new TypeError("Input has invalid signature(s)");if(t.signatures&&!stacksEqual(t.signatures,s.signatures))throw new TypeError("Signature mismatch");if(t.m!==void 0&&t.m!==t.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(s,t)}const OPS$5=OPS$7;function p2pk(t,e){if(!t.input&&!t.output&&!t.pubkey&&!t.input&&!t.signature)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),parse$1(partial(object$1({network:object$1({}),output:BufferSchema,pubkey:custom(isPoint,"invalid pubkey"),signature:custom(isCanonicalScriptSignature,"Expected signature to be of type isCanonicalScriptSignature"),input:BufferSchema})),t);const r=value(()=>decompile(t.input)),s={name:"p2pk",network:t.network||bitcoin$1};if(prop(s,"output",()=>{if(t.pubkey)return compile([t.pubkey,OPS$5.OP_CHECKSIG])}),prop(s,"pubkey",()=>{if(t.output)return t.output.slice(1,-1)}),prop(s,"signature",()=>{if(t.input)return r()[0]}),prop(s,"input",()=>{if(t.signature)return compile([t.signature])}),prop(s,"witness",()=>{if(s.input)return[]}),e.validate){if(t.output){if(t.output[t.output.length-1]!==OPS$5.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!isPoint(s.pubkey))throw new TypeError("Output pubkey is invalid");if(t.pubkey&&compare(t.pubkey,s.pubkey)!==0)throw new TypeError("Pubkey mismatch")}if(t.signature&&t.input&&compare(t.input,s.input)!==0)throw new TypeError("Signature mismatch");if(t.input){if(r().length!==1)throw new TypeError("Input is invalid");if(!isCanonicalScriptSignature(s.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(s,t)}const ripemd160=ripemd160$2;function hash160(t){return ripemd160(sha256$5(t))}function hash256(t){return sha256$5(sha256$5(t))}const TAGGED_HASH_PREFIXES={"BIP0340/challenge":Uint8Array.from([123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124,123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124]),"BIP0340/aux":Uint8Array.from([241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144,241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144]),"BIP0340/nonce":Uint8Array.from([7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47,7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47]),TapLeaf:Uint8Array.from([174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238,174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238]),TapBranch:Uint8Array.from([25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21,25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21]),TapSighash:Uint8Array.from([244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49,244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49]),TapTweak:Uint8Array.from([232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233,232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233]),"KeyAgg list":Uint8Array.from([72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240,72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240]),"KeyAgg coefficient":Uint8Array.from([191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129,191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129])};function taggedHash(t,e){return sha256$5(concat$1([TAGGED_HASH_PREFIXES[t],e]))}function base(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let x=0;x<e.length;x++)e[x]=255;for(let x=0;x<t.length;x++){const p=t.charAt(x),g=p.charCodeAt(0);if(e[g]!==255)throw new TypeError(p+" is ambiguous");e[g]=x}const r=t.length,n=t.charAt(0),s=Math.log(r)/Math.log(256),o=Math.log(256)/Math.log(r);function c(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";let p=0,g=0,y=0;const b=x.length;for(;y!==b&&x[y]===0;)y++,p++;const R=(b-y)*o+1>>>0,D=new Uint8Array(R);for(;y!==b;){let Fe=x[y],O=0;for(let $e=R-1;(Fe!==0||O<g)&&$e!==-1;$e--,O++)Fe+=256*D[$e]>>>0,D[$e]=Fe%r>>>0,Fe=Fe/r>>>0;if(Fe!==0)throw new Error("Non-zero carry");g=O,y++}let k=R-g;for(;k!==R&&D[k]===0;)k++;let Re=n.repeat(p);for(;k<R;++k)Re+=t.charAt(D[k]);return Re}function u(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;let p=0,g=0,y=0;for(;x[p]===n;)g++,p++;const b=(x.length-p)*s+1>>>0,R=new Uint8Array(b);for(;p<x.length;){const Fe=x.charCodeAt(p);if(Fe>255)return;let O=e[Fe];if(O===255)return;let $e=0;for(let ze=b-1;(O!==0||$e<y)&&ze!==-1;ze--,$e++)O+=r*R[ze]>>>0,R[ze]=O%256>>>0,O=O/256>>>0;if(O!==0)throw new Error("Non-zero carry");y=$e,p++}let D=b-y;for(;D!==b&&R[D]===0;)D++;const k=new Uint8Array(g+(b-D));let Re=g;for(;D!==b;)k[Re++]=R[D++];return k}function f(x){const p=u(x);if(p)return p;throw new Error("Non-base"+r+" character")}return{encode:c,decodeUnsafe:u,decode:f}}var ALPHABET="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const base58=base(ALPHABET);function bs58checkBase(t){function e(o){var c=Uint8Array.from(o),u=t(c),f=c.length+4,x=new Uint8Array(f);return x.set(c,0),x.set(u.subarray(0,4),c.length),base58.encode(x)}function r(o){var c=o.slice(0,-4),u=o.slice(-4),f=t(c);if(!(u[0]^f[0]|u[1]^f[1]|u[2]^f[2]|u[3]^f[3]))return c}function n(o){var c=base58.decodeUnsafe(o);if(c!=null)return r(c)}function s(o){var c=base58.decode(o),u=r(c);if(u==null)throw new Error("Invalid checksum");return u}return{encode:e,decode:s,decodeUnsafe:n}}function sha256x2(t){return sha256$5(sha256$5(t))}const bs58Check=bs58checkBase(sha256x2),OPS$4=OPS$7;function p2pkh(t,e){if(!t.address&&!t.hash&&!t.output&&!t.pubkey&&!t.input)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),parse$1(partial(object$1({network:object$1({}),address:string$1(),hash:Hash160bitSchema,output:NBufferSchemaFactory(25),pubkey:custom(isPoint),signature:custom(isCanonicalScriptSignature),input:BufferSchema})),t);const r=value(()=>{const c=bs58Check.decode(t.address),u=readUInt8(c,0),f=c.slice(1);return{version:u,hash:f}}),n=value(()=>decompile(t.input)),s=t.network||bitcoin$1,o={name:"p2pkh",network:s};if(prop(o,"address",()=>{if(!o.hash)return;const c=new Uint8Array(21);return writeUInt8(c,0,s.pubKeyHash),c.set(o.hash,1),bs58Check.encode(c)}),prop(o,"hash",()=>{if(t.output)return t.output.slice(3,23);if(t.address)return r().hash;if(t.pubkey||o.pubkey)return hash160(t.pubkey||o.pubkey)}),prop(o,"output",()=>{if(o.hash)return compile([OPS$4.OP_DUP,OPS$4.OP_HASH160,o.hash,OPS$4.OP_EQUALVERIFY,OPS$4.OP_CHECKSIG])}),prop(o,"pubkey",()=>{if(t.input)return n()[1]}),prop(o,"signature",()=>{if(t.input)return n()[0]}),prop(o,"input",()=>{if(t.pubkey&&t.signature)return compile([t.signature,t.pubkey])}),prop(o,"witness",()=>{if(o.input)return[]}),e.validate){let c=Uint8Array.from([]);if(t.address){if(r().version!==s.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(r().hash.length!==20)throw new TypeError("Invalid address");c=r().hash}if(t.hash){if(c.length>0&&compare(c,t.hash)!==0)throw new TypeError("Hash mismatch");c=t.hash}if(t.output){if(t.output.length!==25||t.output[0]!==OPS$4.OP_DUP||t.output[1]!==OPS$4.OP_HASH160||t.output[2]!==20||t.output[23]!==OPS$4.OP_EQUALVERIFY||t.output[24]!==OPS$4.OP_CHECKSIG)throw new TypeError("Output is invalid");const u=t.output.slice(3,23);if(c.length>0&&compare(c,u)!==0)throw new TypeError("Hash mismatch");c=u}if(t.pubkey){const u=hash160(t.pubkey);if(c.length>0&&compare(c,u)!==0)throw new TypeError("Hash mismatch");c=u}if(t.input){const u=n();if(u.length!==2)throw new TypeError("Input is invalid");if(!isCanonicalScriptSignature(u[0]))throw new TypeError("Input has invalid signature");if(!isPoint(u[1]))throw new TypeError("Input has invalid pubkey");if(t.signature&&compare(t.signature,u[0])!==0)throw new TypeError("Signature mismatch");if(t.pubkey&&compare(t.pubkey,u[1])!==0)throw new TypeError("Pubkey mismatch");const f=hash160(u[1]);if(c.length>0&&compare(c,f)!==0)throw new TypeError("Hash mismatch")}}return Object.assign(o,t)}const OPS$3=OPS$7;function p2sh(t,e){if(!t.address&&!t.hash&&!t.output&&!t.redeem&&!t.input)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),parse$1(partial(object$1({network:object$1({}),address:string$1(),hash:NBufferSchemaFactory(20),output:NBufferSchemaFactory(23),redeem:partial(object$1({network:object$1({}),output:BufferSchema,input:BufferSchema,witness:array(BufferSchema)})),input:BufferSchema,witness:array(BufferSchema)})),t);let r=t.network;r||(r=t.redeem&&t.redeem.network||bitcoin$1);const n={network:r},s=value(()=>{const u=bs58Check.decode(t.address),f=readUInt8(u,0),x=u.slice(1);return{version:f,hash:x}}),o=value(()=>decompile(t.input)),c=value(()=>{const u=o(),f=u[u.length-1];return{network:r,output:f===OPS$3.OP_FALSE?Uint8Array.from([]):f,input:compile(u.slice(0,-1)),witness:t.witness||[]}});if(prop(n,"address",()=>{if(!n.hash)return;const u=new Uint8Array(21);return writeUInt8(u,0,n.network.scriptHash),u.set(n.hash,1),bs58Check.encode(u)}),prop(n,"hash",()=>{if(t.output)return t.output.slice(2,22);if(t.address)return s().hash;if(n.redeem&&n.redeem.output)return hash160(n.redeem.output)}),prop(n,"output",()=>{if(n.hash)return compile([OPS$3.OP_HASH160,n.hash,OPS$3.OP_EQUAL])}),prop(n,"redeem",()=>{if(t.input)return c()}),prop(n,"input",()=>{if(!(!t.redeem||!t.redeem.input||!t.redeem.output))return compile([].concat(decompile(t.redeem.input),t.redeem.output))}),prop(n,"witness",()=>{if(n.redeem&&n.redeem.witness)return n.redeem.witness;if(n.input)return[]}),prop(n,"name",()=>{const u=["p2sh"];return n.redeem!==void 0&&n.redeem.name!==void 0&&u.push(n.redeem.name),u.join("-")}),e.validate){let u=Uint8Array.from([]);if(t.address){if(s().version!==r.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(s().hash.length!==20)throw new TypeError("Invalid address");u=s().hash}if(t.hash){if(u.length>0&&compare(u,t.hash)!==0)throw new TypeError("Hash mismatch");u=t.hash}if(t.output){if(t.output.length!==23||t.output[0]!==OPS$3.OP_HASH160||t.output[1]!==20||t.output[22]!==OPS$3.OP_EQUAL)throw new TypeError("Output is invalid");const x=t.output.slice(2,22);if(u.length>0&&compare(u,x)!==0)throw new TypeError("Hash mismatch");u=x}const f=x=>{if(x.output){const p=decompile(x.output);if(!p||p.length<1)throw new TypeError("Redeem.output too short");if(x.output.byteLength>520)throw new TypeError("Redeem.output unspendable if larger than 520 bytes");if(countNonPushOnlyOPs(p)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const g=hash160(x.output);if(u.length>0&&compare(u,g)!==0)throw new TypeError("Hash mismatch");u=g}if(x.input){const p=x.input.length>0,g=x.witness&&x.witness.length>0;if(!p&&!g)throw new TypeError("Empty input");if(p&&g)throw new TypeError("Input and witness provided");if(p){const y=decompile(x.input);if(!isPushOnly(y))throw new TypeError("Non push-only scriptSig")}}};if(t.input){const x=o();if(!x||x.length<1)throw new TypeError("Input too short");if(!(c().output instanceof Uint8Array))throw new TypeError("Input is invalid");f(c())}if(t.redeem){if(t.redeem.network&&t.redeem.network!==r)throw new TypeError("Network mismatch");if(t.input){const x=c();if(t.redeem.output&&compare(t.redeem.output,x.output)!==0)throw new TypeError("Redeem.output mismatch");if(t.redeem.input&&compare(t.redeem.input,x.input)!==0)throw new TypeError("Redeem.input mismatch")}f(t.redeem)}if(t.witness&&t.redeem&&t.redeem.witness&&!stacksEqual(t.redeem.witness,t.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(n,t)}var dist$1={},hasRequiredDist$1;function requireDist$1(){if(hasRequiredDist$1)return dist$1;hasRequiredDist$1=1,Object.defineProperty(dist$1,"__esModule",{value:!0}),dist$1.bech32m=dist$1.bech32=void 0;const t="qpzry9x8gf2tvdw0s3jn54khce6mua7l",e={};for(let x=0;x<t.length;x++){const p=t.charAt(x);e[p]=x}function r(x){const p=x>>25;return(x&33554431)<<5^-(p>>0&1)&996825010^-(p>>1&1)&642813549^-(p>>2&1)&513874426^-(p>>3&1)&1027748829^-(p>>4&1)&705979059}function n(x){let p=1;for(let g=0;g<x.length;++g){const y=x.charCodeAt(g);if(y<33||y>126)return"Invalid prefix ("+x+")";p=r(p)^y>>5}p=r(p);for(let g=0;g<x.length;++g){const y=x.charCodeAt(g);p=r(p)^y&31}return p}function s(x,p,g,y){let b=0,R=0;const D=(1<<g)-1,k=[];for(let Re=0;Re<x.length;++Re)for(b=b<<p|x[Re],R+=p;R>=g;)R-=g,k.push(b>>R&D);if(y)R>0&&k.push(b<<g-R&D);else{if(R>=p)return"Excess padding";if(b<<g-R&D)return"Non-zero padding"}return k}function o(x){return s(x,8,5,!0)}function c(x){const p=s(x,5,8,!1);if(Array.isArray(p))return p}function u(x){const p=s(x,5,8,!1);if(Array.isArray(p))return p;throw new Error(p)}function f(x){let p;x==="bech32"?p=1:p=734539939;function g(D,k,Re){if(Re=Re||90,D.length+7+k.length>Re)throw new TypeError("Exceeds length limit");D=D.toLowerCase();let Fe=n(D);if(typeof Fe=="string")throw new Error(Fe);let O=D+"1";for(let $e=0;$e<k.length;++$e){const ze=k[$e];if(ze>>5!==0)throw new Error("Non 5-bit word");Fe=r(Fe)^ze,O+=t.charAt(ze)}for(let $e=0;$e<6;++$e)Fe=r(Fe);Fe^=p;for(let $e=0;$e<6;++$e){const ze=Fe>>(5-$e)*5&31;O+=t.charAt(ze)}return O}function y(D,k){if(k=k||90,D.length<8)return D+" too short";if(D.length>k)return"Exceeds length limit";const Re=D.toLowerCase(),Fe=D.toUpperCase();if(D!==Re&&D!==Fe)return"Mixed-case string "+D;D=Re;const O=D.lastIndexOf("1");if(O===-1)return"No separator character for "+D;if(O===0)return"Missing prefix for "+D;const $e=D.slice(0,O),ze=D.slice(O+1);if(ze.length<6)return"Data too short";let q=n($e);if(typeof q=="string")return q;const W=[];for(let We=0;We<ze.length;++We){const Xe=ze.charAt(We),it=e[Xe];if(it===void 0)return"Unknown character "+Xe;q=r(q)^it,!(We+6>=ze.length)&&W.push(it)}return q!==p?"Invalid checksum for "+D:{prefix:$e,words:W}}function b(D,k){const Re=y(D,k);if(typeof Re=="object")return Re}function R(D,k){const Re=y(D,k);if(typeof Re=="object")return Re;throw new Error(Re)}return{decodeUnsafe:b,decode:R,encode:g,toWords:o,fromWordsUnsafe:c,fromWords:u}}return dist$1.bech32=f("bech32"),dist$1.bech32m=f("bech32m"),dist$1}var distExports$1=requireDist$1();const OPS$2=OPS$7,EMPTY_BUFFER$3=new Uint8Array(0);function p2wpkh(t,e){if(!t.address&&!t.hash&&!t.output&&!t.pubkey&&!t.witness)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),parse$1(partial(object$1({address:string$1(),hash:NBufferSchemaFactory(20),input:NBufferSchemaFactory(0),network:object$1({}),output:NBufferSchemaFactory(22),pubkey:custom(isPoint,"Not a valid pubkey"),signature:custom(isCanonicalScriptSignature),witness:array(BufferSchema)})),t);const r=value(()=>{const o=distExports$1.bech32.decode(t.address),c=o.words.shift(),u=distExports$1.bech32.fromWords(o.words);return{version:c,prefix:o.prefix,data:Uint8Array.from(u)}}),n=t.network||bitcoin$1,s={name:"p2wpkh",network:n};if(prop(s,"address",()=>{if(!s.hash)return;const o=distExports$1.bech32.toWords(s.hash);return o.unshift(0),distExports$1.bech32.encode(n.bech32,o)}),prop(s,"hash",()=>{if(t.output)return t.output.slice(2,22);if(t.address)return r().data;if(t.pubkey||s.pubkey)return hash160(t.pubkey||s.pubkey)}),prop(s,"output",()=>{if(s.hash)return compile([OPS$2.OP_0,s.hash])}),prop(s,"pubkey",()=>{if(t.pubkey)return t.pubkey;if(t.witness)return t.witness[1]}),prop(s,"signature",()=>{if(t.witness)return t.witness[0]}),prop(s,"input",()=>{if(s.witness)return EMPTY_BUFFER$3}),prop(s,"witness",()=>{if(t.pubkey&&t.signature)return[t.signature,t.pubkey]}),e.validate){let o=Uint8Array.from([]);if(t.address){if(n&&n.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(r().version!==0)throw new TypeError("Invalid address version");if(r().data.length!==20)throw new TypeError("Invalid address data");o=r().data}if(t.hash){if(o.length>0&&compare(o,t.hash)!==0)throw new TypeError("Hash mismatch");o=t.hash}if(t.output){if(t.output.length!==22||t.output[0]!==OPS$2.OP_0||t.output[1]!==20)throw new TypeError("Output is invalid");if(o.length>0&&compare(o,t.output.slice(2))!==0)throw new TypeError("Hash mismatch");o=t.output.slice(2)}if(t.pubkey){const c=hash160(t.pubkey);if(o.length>0&&compare(o,c)!==0)throw new TypeError("Hash mismatch");if(o=c,!isPoint(t.pubkey)||t.pubkey.length!==33)throw new TypeError("Invalid pubkey for p2wpkh")}if(t.witness){if(t.witness.length!==2)throw new TypeError("Witness is invalid");if(!isCanonicalScriptSignature(t.witness[0]))throw new TypeError("Witness has invalid signature");if(!isPoint(t.witness[1])||t.witness[1].length!==33)throw new TypeError("Witness has invalid pubkey");if(t.signature&&compare(t.signature,t.witness[0])!==0)throw new TypeError("Signature mismatch");if(t.pubkey&&compare(t.pubkey,t.witness[1])!==0)throw new TypeError("Pubkey mismatch");const c=hash160(t.witness[1]);if(o.length>0&&compare(o,c)!==0)throw new TypeError("Hash mismatch")}}return Object.assign(s,t)}const OPS$1=OPS$7,EMPTY_BUFFER$2=new Uint8Array(0);function chunkHasUncompressedPubkey(t){return!!(t instanceof Uint8Array&&t.length===65&&t[0]===4&&isPoint(t))}function p2wsh(t,e){if(!t.address&&!t.hash&&!t.output&&!t.redeem&&!t.witness)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),parse$1(NullablePartial({network:object$1({}),address:string$1(),hash:Buffer256bitSchema,output:NBufferSchemaFactory(34),redeem:NullablePartial({input:BufferSchema,network:object$1({}),output:BufferSchema,witness:array(BufferSchema)}),input:NBufferSchemaFactory(0),witness:array(BufferSchema)}),t);const r=value(()=>{const c=distExports$1.bech32.decode(t.address),u=c.words.shift(),f=distExports$1.bech32.fromWords(c.words);return{version:u,prefix:c.prefix,data:Uint8Array.from(f)}}),n=value(()=>decompile(t.redeem.input));let s=t.network;s||(s=t.redeem&&t.redeem.network||bitcoin$1);const o={network:s};if(prop(o,"address",()=>{if(!o.hash)return;const c=distExports$1.bech32.toWords(o.hash);return c.unshift(0),distExports$1.bech32.encode(s.bech32,c)}),prop(o,"hash",()=>{if(t.output)return t.output.slice(2);if(t.address)return r().data;if(o.redeem&&o.redeem.output)return sha256$5(o.redeem.output)}),prop(o,"output",()=>{if(o.hash)return compile([OPS$1.OP_0,o.hash])}),prop(o,"redeem",()=>{if(t.witness)return{output:t.witness[t.witness.length-1],input:EMPTY_BUFFER$2,witness:t.witness.slice(0,-1)}}),prop(o,"input",()=>{if(o.witness)return EMPTY_BUFFER$2}),prop(o,"witness",()=>{if(t.redeem&&t.redeem.input&&t.redeem.input.length>0&&t.redeem.output&&t.redeem.output.length>0){const c=toStack(n());return o.redeem=Object.assign({witness:c},t.redeem),o.redeem.input=EMPTY_BUFFER$2,[].concat(c,t.redeem.output)}if(t.redeem&&t.redeem.output&&t.redeem.witness)return[].concat(t.redeem.witness,t.redeem.output)}),prop(o,"name",()=>{const c=["p2wsh"];return o.redeem!==void 0&&o.redeem.name!==void 0&&c.push(o.redeem.name),c.join("-")}),e.validate){let c=Uint8Array.from([]);if(t.address){if(r().prefix!==s.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(r().version!==0)throw new TypeError("Invalid address version");if(r().data.length!==32)throw new TypeError("Invalid address data");c=r().data}if(t.hash){if(c.length>0&&compare(c,t.hash)!==0)throw new TypeError("Hash mismatch");c=t.hash}if(t.output){if(t.output.length!==34||t.output[0]!==OPS$1.OP_0||t.output[1]!==32)throw new TypeError("Output is invalid");const u=t.output.slice(2);if(c.length>0&&compare(c,u)!==0)throw new TypeError("Hash mismatch");c=u}if(t.redeem){if(t.redeem.network&&t.redeem.network!==s)throw new TypeError("Network mismatch");if(t.redeem.input&&t.redeem.input.length>0&&t.redeem.witness&&t.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(t.redeem.output){const u=decompile(t.redeem.output);if(!u||u.length<1)throw new TypeError("Redeem.output is invalid");if(t.redeem.output.byteLength>3600)throw new TypeError("Redeem.output unspendable if larger than 3600 bytes");if(countNonPushOnlyOPs(u)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const f=sha256$5(t.redeem.output);if(c.length>0&&compare(c,f)!==0)throw new TypeError("Hash mismatch");c=f}if(t.redeem.input&&!isPushOnly(n()))throw new TypeError("Non push-only scriptSig");if(t.witness&&t.redeem.witness&&!stacksEqual(t.witness,t.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(t.redeem.input&&n().some(chunkHasUncompressedPubkey)||t.redeem.output&&(decompile(t.redeem.output)||[]).some(chunkHasUncompressedPubkey))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(t.witness&&t.witness.length>0){const u=t.witness[t.witness.length-1];if(t.redeem&&t.redeem.output&&compare(t.redeem.output,u)!==0)throw new TypeError("Witness and redeem.output mismatch");if(t.witness.some(chunkHasUncompressedPubkey)||(decompile(u)||[]).some(chunkHasUncompressedPubkey))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(o,t)}const _ECCLIB_CACHE={};function initEccLib(t,e){t?t!==_ECCLIB_CACHE.eccLib&&(verifyEcc(t),_ECCLIB_CACHE.eccLib=t):_ECCLIB_CACHE.eccLib=t}function getEccLib(){if(!_ECCLIB_CACHE.eccLib)throw new Error("No ECC Library provided. You must call initEccLib() with a valid TinySecp256k1Interface instance");return _ECCLIB_CACHE.eccLib}const h$1=t=>fromHex(t);function verifyEcc(t){assert$1(typeof t.isXOnlyPoint=="function"),assert$1(t.isXOnlyPoint(h$1("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),assert$1(t.isXOnlyPoint(h$1("fffffffffffffffffffffffffffffffffffffffffffffffffffffffeeffffc2e"))),assert$1(t.isXOnlyPoint(h$1("f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9"))),assert$1(t.isXOnlyPoint(h$1("0000000000000000000000000000000000000000000000000000000000000001"))),assert$1(!t.isXOnlyPoint(h$1("0000000000000000000000000000000000000000000000000000000000000000"))),assert$1(!t.isXOnlyPoint(h$1("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"))),assert$1(typeof t.xOnlyPointAddTweak=="function"),tweakAddVectors.forEach(e=>{const r=t.xOnlyPointAddTweak(h$1(e.pubkey),h$1(e.tweak));e.result===null?assert$1(r===null):(assert$1(r!==null),assert$1(r.parity===e.parity),assert$1(compare(r.xOnlyPubkey,h$1(e.result))===0))})}function assert$1(t){if(!t)throw new Error("ecc library invalid")}const tweakAddVectors=[{pubkey:"79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798",tweak:"fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140",parity:-1,result:null},{pubkey:"1617d38ed8d8657da4d4761e8057bc396ea9e4b9d29776d4be096016dbd2509b",tweak:"a8397a935f0dfceba6ba9618f6451ef4d80637abf4e6af2669fbc9de6a8fd2ac",parity:1,result:"e478f99dab91052ab39a33ea35fd5e6e4933f4d28023cd597c9a1f6760346adf"},{pubkey:"2c0b7cf95324a07d05398b240174dc0c2be444d96b159aa6c7f7b1e668680991",tweak:"823c3cd2142744b075a87eade7e1b8678ba308d566226a0056ca2b7a76f86b47",parity:0,result:"9534f8dc8c6deda2dc007655981c78b49c5d96c778fbf363462a11ec9dfd948c"}],HEX_STRINGS$1="0123456789abcdefABCDEF";HEX_STRINGS$1.split("").map(t=>t.codePointAt(0));Array(256).fill(!0).map((t,e)=>{const r=String.fromCodePoint(e),n=HEX_STRINGS$1.indexOf(r);return n<0?void 0:n<16?n:n-6});new TextEncoder;new TextDecoder;function writeUInt16(t,e,r,n){if(e+2>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(n=n.toUpperCase(),r>65535)throw new Error(`The value of "value" is out of range. It must be >= 0 and <= 65535. Received ${r}`);n==="LE"?(t[e]=r&255,t[e+1]=r>>8&255):(t[e]=r>>8&255,t[e+1]=r&255)}function writeUInt32$1(t,e,r,n){if(e+4>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(n=n.toUpperCase(),r>4294967295)throw new Error(`The value of "value" is out of range. It must be >= 0 and <= ${4294967295}. Received ${r}`);n==="LE"?(t[e]=r&255,t[e+1]=r>>8&255,t[e+2]=r>>16&255,t[e+3]=r>>24&255):(t[e]=r>>24&255,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=r&255)}function writeUInt64(t,e,r,n){if(e+8>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(n=n.toUpperCase(),r>0xffffffffffffffffn)throw new Error(`The value of "value" is out of range. It must be >= 0 and <= ${0xffffffffffffffffn}. Received ${r}`);n==="LE"?(t[e]=Number(r&0xffn),t[e+1]=Number(r>>8n&0xffn),t[e+2]=Number(r>>16n&0xffn),t[e+3]=Number(r>>24n&0xffn),t[e+4]=Number(r>>32n&0xffn),t[e+5]=Number(r>>40n&0xffn),t[e+6]=Number(r>>48n&0xffn),t[e+7]=Number(r>>56n&0xffn)):(t[e]=Number(r>>56n&0xffn),t[e+1]=Number(r>>48n&0xffn),t[e+2]=Number(r>>40n&0xffn),t[e+3]=Number(r>>32n&0xffn),t[e+4]=Number(r>>24n&0xffn),t[e+5]=Number(r>>16n&0xffn),t[e+6]=Number(r>>8n&0xffn),t[e+7]=Number(r&0xffn))}function readUInt16(t,e,r){if(e+2>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r=r.toUpperCase(),r==="LE"){let n=0;return n=(n<<8)+t[e+1],n=(n<<8)+t[e],n}else{let n=0;return n=(n<<8)+t[e],n=(n<<8)+t[e+1],n}}function readUInt32(t,e,r){if(e+4>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r=r.toUpperCase(),r==="LE"){let n=0;return n=(n<<8)+t[e+3]>>>0,n=(n<<8)+t[e+2]>>>0,n=(n<<8)+t[e+1]>>>0,n=(n<<8)+t[e]>>>0,n}else{let n=0;return n=(n<<8)+t[e]>>>0,n=(n<<8)+t[e+1]>>>0,n=(n<<8)+t[e+2]>>>0,n=(n<<8)+t[e+3]>>>0,n}}function readUInt64(t,e,r){if(e+8>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r=r.toUpperCase(),r==="LE"){let n=0n;return n=(n<<8n)+BigInt(t[e+7]),n=(n<<8n)+BigInt(t[e+6]),n=(n<<8n)+BigInt(t[e+5]),n=(n<<8n)+BigInt(t[e+4]),n=(n<<8n)+BigInt(t[e+3]),n=(n<<8n)+BigInt(t[e+2]),n=(n<<8n)+BigInt(t[e+1]),n=(n<<8n)+BigInt(t[e]),n}else{let n=0n;return n=(n<<8n)+BigInt(t[e]),n=(n<<8n)+BigInt(t[e+1]),n=(n<<8n)+BigInt(t[e+2]),n=(n<<8n)+BigInt(t[e+3]),n=(n<<8n)+BigInt(t[e+4]),n=(n<<8n)+BigInt(t[e+5]),n=(n<<8n)+BigInt(t[e+6]),n=(n<<8n)+BigInt(t[e+7]),n}}const checkUInt64=t=>{if(t<0||t>0xffffffffffffffffn)throw new RangeError("value out of range")};function checkUInt53(t){if(t<0||t>Number.MAX_SAFE_INTEGER||t%1!==0)throw new RangeError("value out of range")}function checkUint53OrUint64(t){typeof t=="number"?checkUInt53(t):checkUInt64(t)}function encode$f(t,e,r){checkUint53OrUint64(t),r===void 0&&(r=0),e===void 0&&(e=new Uint8Array(encodingLength(t)));let n=0;return t<253?(e.set([Number(t)],r),n=1):t<=65535?(e.set([253],r),writeUInt16(e,r+1,Number(t),"LE"),n=3):t<=4294967295?(e.set([254],r),writeUInt32$1(e,r+1,Number(t),"LE"),n=5):(e.set([255],r),writeUInt64(e,r+1,BigInt(t),"LE"),n=9),{buffer:e,bytes:n}}function decode$f(t,e){e===void 0&&(e=0);const r=t.at(e);if(r===void 0)throw new Error("buffer too small");if(r<253)return{numberValue:r,bigintValue:BigInt(r),bytes:1};if(r===253){const n=readUInt16(t,e+1,"LE");return{numberValue:n,bigintValue:BigInt(n),bytes:3}}else if(r===254){const n=readUInt32(t,e+1,"LE");return{numberValue:n,bigintValue:BigInt(n),bytes:5}}else{const n=readUInt64(t,e+1,"LE");return{numberValue:n<=Number.MAX_SAFE_INTEGER?Number(n):null,bigintValue:n,bytes:9}}}function encodingLength(t){return checkUint53OrUint64(t),t<253?1:t<=65535?3:t<=4294967295?5:9}const MAX_JS_NUMBER=9007199254740991;function verifuint(t,e){if(typeof t!="number"&&typeof t!="bigint")throw new Error("cannot write a non-number as a number");if(t<0&&t<BigInt(0))throw new Error("specified a negative value for writing an unsigned value");if(t>e&&t>BigInt(e))throw new Error("RangeError: value out of range");if(Math.floor(Number(t))!==Number(t))throw new Error("value has a fractional component")}function reverseBuffer(t){if(t.length<1)return t;let e=t.length-1,r=0;for(let n=0;n<t.length/2;n++)r=t[n],t[n]=t[e],t[e]=r,e--;return t}function cloneBuffer(t){const e=new Uint8Array(t.length);return e.set(t),e}class BufferWriter{buffer;offset;static withCapacity(e){return new BufferWriter(new Uint8Array(e))}constructor(e,r=0){this.buffer=e,this.offset=r,parse$1(tuple([BufferSchema,UInt32Schema]),[e,r])}writeUInt8(e){this.offset=writeUInt8(this.buffer,this.offset,e)}writeInt32(e){this.offset=writeInt32(this.buffer,this.offset,e,"LE")}writeInt64(e){this.offset=writeInt64(this.buffer,this.offset,BigInt(e),"LE")}writeUInt32(e){this.offset=writeUInt32$2(this.buffer,this.offset,e,"LE")}writeUInt64(e){this.offset=writeUInt64$1(this.buffer,this.offset,BigInt(e),"LE")}writeVarInt(e){const{bytes:r}=encode$f(e,this.buffer,this.offset);this.offset+=r}writeSlice(e){if(this.buffer.length<this.offset+e.length)throw new Error("Cannot write slice out of bounds");this.buffer.set(e,this.offset),this.offset+=e.length}writeVarSlice(e){this.writeVarInt(e.length),this.writeSlice(e)}writeVector(e){this.writeVarInt(e.length),e.forEach(r=>this.writeVarSlice(r))}end(){if(this.buffer.length===this.offset)return this.buffer;throw new Error(`buffer size ${this.buffer.length}, offset ${this.offset}`)}}class BufferReader{buffer;offset;constructor(e,r=0){this.buffer=e,this.offset=r,parse$1(tuple([BufferSchema,UInt32Schema]),[e,r])}readUInt8(){const e=readUInt8(this.buffer,this.offset);return this.offset++,e}readInt32(){const e=readInt32(this.buffer,this.offset,"LE");return this.offset+=4,e}readUInt32(){const e=readUInt32$1(this.buffer,this.offset,"LE");return this.offset+=4,e}readInt64(){const e=readInt64(this.buffer,this.offset,"LE");return this.offset+=8,e}readVarInt(){const{bigintValue:e,bytes:r}=decode$f(this.buffer,this.offset);return this.offset+=r,e}readSlice(e){verifuint(e,MAX_JS_NUMBER);const r=Number(e);if(this.buffer.length<this.offset+r)throw new Error("Cannot read slice out of bounds");const n=this.buffer.slice(this.offset,this.offset+r);return this.offset+=r,n}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const e=this.readVarInt(),r=[];for(let n=0;n<e;n++)r.push(this.readVarSlice());return r}}const LEAF_VERSION_TAPSCRIPT=192,MAX_TAPTREE_DEPTH=128,isHashBranch=t=>"left"in t&&"right"in t;function rootHashFromPath(t,e){if(t.length<33)throw new TypeError(`The control-block length is too small. Got ${t.length}, expected min 33.`);const r=(t.length-33)/32;let n=e;for(let s=0;s<r;s++){const o=t.slice(33+32*s,65+32*s);compare(n,o)<0?n=tapBranchHash(n,o):n=tapBranchHash(o,n)}return n}function toHashTree(t){if(isTapleaf(t))return{hash:tapleafHash(t)};const e=[toHashTree(t[0]),toHashTree(t[1])];e.sort((s,o)=>compare(s.hash,o.hash));const[r,n]=e;return{hash:tapBranchHash(r.hash,n.hash),left:r,right:n}}function findScriptPath(t,e){if(isHashBranch(t)){const r=findScriptPath(t.left,e);if(r!==void 0)return[...r,t.right.hash];const n=findScriptPath(t.right,e);if(n!==void 0)return[...n,t.left.hash]}else if(compare(t.hash,e)===0)return[]}function tapleafHash(t){const e=t.version||LEAF_VERSION_TAPSCRIPT;return taggedHash("TapLeaf",concat$1([Uint8Array.from([e]),serializeScript(t.output)]))}function tapTweakHash(t,e){return taggedHash("TapTweak",concat$1(e?[t,e]:[t]))}function tweakKey(t,e){if(!(t instanceof Uint8Array)||t.length!==32||e&&e.length!==32)return null;const r=tapTweakHash(t,e),n=getEccLib().xOnlyPointAddTweak(t,r);return!n||n.xOnlyPubkey===null?null:{parity:n.parity,x:Uint8Array.from(n.xOnlyPubkey)}}function tapBranchHash(t,e){return taggedHash("TapBranch",concat$1([t,e]))}function serializeScript(t){const e=encodingLength(t.length),r=new Uint8Array(e);return encode$f(t.length,r),concat$1([r,t])}const OPS=OPS$7,TAPROOT_WITNESS_VERSION=1,ANNEX_PREFIX=80;function p2tr(t,e){if(!t.address&&!t.output&&!t.pubkey&&!t.internalPubkey&&!(t.witness&&t.witness.length>1))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),parse$1(partial(object$1({address:string$1(),input:NBufferSchemaFactory(0),network:object$1({}),output:NBufferSchemaFactory(34),internalPubkey:NBufferSchemaFactory(32),hash:NBufferSchemaFactory(32),pubkey:NBufferSchemaFactory(32),signature:union$1([NBufferSchemaFactory(64),NBufferSchemaFactory(65)]),witness:array(BufferSchema),scriptTree:custom(isTaptree,"Taptree is not of type isTaptree"),redeem:partial(object$1({output:BufferSchema,redeemVersion:number$1(),witness:array(BufferSchema)})),redeemVersion:number$1()})),t);const r=value(()=>fromBech32(t.address)),n=value(()=>{if(!(!t.witness||!t.witness.length))return t.witness.length>=2&&t.witness[t.witness.length-1][0]===ANNEX_PREFIX?t.witness.slice(0,-1):t.witness.slice()}),s=value(()=>{if(t.scriptTree)return toHashTree(t.scriptTree);if(t.hash)return{hash:t.hash}}),o=t.network||bitcoin$1,c={name:"p2tr",network:o};if(prop(c,"address",()=>{if(!c.pubkey)return;const u=distExports$1.bech32m.toWords(c.pubkey);return u.unshift(TAPROOT_WITNESS_VERSION),distExports$1.bech32m.encode(o.bech32,u)}),prop(c,"hash",()=>{const u=s();if(u)return u.hash;const f=n();if(f&&f.length>1){const x=f[f.length-1],p=x[0]&TAPLEAF_VERSION_MASK,g=f[f.length-2],y=tapleafHash({output:g,version:p});return rootHashFromPath(x,y)}return null}),prop(c,"output",()=>{if(c.pubkey)return compile([OPS.OP_1,c.pubkey])}),prop(c,"redeemVersion",()=>t.redeemVersion?t.redeemVersion:t.redeem&&t.redeem.redeemVersion!==void 0&&t.redeem.redeemVersion!==null?t.redeem.redeemVersion:LEAF_VERSION_TAPSCRIPT),prop(c,"redeem",()=>{const u=n();if(!(!u||u.length<2))return{output:u[u.length-2],witness:u.slice(0,-2),redeemVersion:u[u.length-1][0]&TAPLEAF_VERSION_MASK}}),prop(c,"pubkey",()=>{if(t.pubkey)return t.pubkey;if(t.output)return t.output.slice(2);if(t.address)return r().data;if(c.internalPubkey){const u=tweakKey(c.internalPubkey,c.hash);if(u)return u.x}}),prop(c,"internalPubkey",()=>{if(t.internalPubkey)return t.internalPubkey;const u=n();if(u&&u.length>1)return u[u.length-1].slice(1,33)}),prop(c,"signature",()=>{if(t.signature)return t.signature;const u=n();if(!(!u||u.length!==1))return u[0]}),prop(c,"witness",()=>{if(t.witness)return t.witness;const u=s();if(u&&t.redeem&&t.redeem.output&&t.internalPubkey){const f=tapleafHash({output:t.redeem.output,version:c.redeemVersion}),x=findScriptPath(u,f);if(!x)return;const p=tweakKey(t.internalPubkey,u.hash);if(!p)return;const g=concat$1([Uint8Array.from([c.redeemVersion|p.parity]),t.internalPubkey].concat(x));return[t.redeem.output,g]}if(t.signature)return[t.signature]}),e.validate){let u=Uint8Array.from([]);if(t.address){if(o&&o.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(r().version!==TAPROOT_WITNESS_VERSION)throw new TypeError("Invalid address version");if(r().data.length!==32)throw new TypeError("Invalid address data");u=r().data}if(t.pubkey){if(u.length>0&&compare(u,t.pubkey)!==0)throw new TypeError("Pubkey mismatch");u=t.pubkey}if(t.output){if(t.output.length!==34||t.output[0]!==OPS.OP_1||t.output[1]!==32)throw new TypeError("Output is invalid");if(u.length>0&&compare(u,t.output.slice(2))!==0)throw new TypeError("Pubkey mismatch");u=t.output.slice(2)}if(t.internalPubkey){const p=tweakKey(t.internalPubkey,c.hash);if(u.length>0&&compare(u,p.x)!==0)throw new TypeError("Pubkey mismatch");u=p.x}if(u&&u.length&&!getEccLib().isXOnlyPoint(u))throw new TypeError("Invalid pubkey for p2tr");const f=s();if(t.hash&&f&&compare(t.hash,f.hash)!==0)throw new TypeError("Hash mismatch");if(t.redeem&&t.redeem.output&&f){const p=tapleafHash({output:t.redeem.output,version:c.redeemVersion});if(!findScriptPath(f,p))throw new TypeError("Redeem script not in tree")}const x=n();if(t.redeem&&c.redeem){if(t.redeem.redeemVersion&&t.redeem.redeemVersion!==c.redeem.redeemVersion)throw new TypeError("Redeem.redeemVersion and witness mismatch");if(t.redeem.output){if(decompile(t.redeem.output).length===0)throw new TypeError("Redeem.output is invalid");if(c.redeem.output&&compare(t.redeem.output,c.redeem.output)!==0)throw new TypeError("Redeem.output and witness mismatch")}if(t.redeem.witness&&c.redeem.witness&&!stacksEqual(t.redeem.witness,c.redeem.witness))throw new TypeError("Redeem.witness and witness mismatch")}if(x&&x.length)if(x.length===1){if(t.signature&&compare(t.signature,x[0])!==0)throw new TypeError("Signature mismatch")}else{const p=x[x.length-1];if(p.length<33)throw new TypeError(`The control-block length is too small. Got ${p.length}, expected min 33.`);if((p.length-33)%32!==0)throw new TypeError(`The control-block length of ${p.length} is incorrect!`);const g=(p.length-33)/32;if(g>128)throw new TypeError(`The script path is too long. Got ${g}, expected max 128.`);const y=p.slice(1,33);if(t.internalPubkey&&compare(t.internalPubkey,y)!==0)throw new TypeError("Internal pubkey mismatch");if(!getEccLib().isXOnlyPoint(y))throw new TypeError("Invalid internalPubkey for p2tr witness");const b=p[0]&TAPLEAF_VERSION_MASK,R=x[x.length-2],D=tapleafHash({output:R,version:b}),k=rootHashFromPath(p,D),Re=tweakKey(y,k);if(!Re)throw new TypeError("Invalid outputKey for p2tr witness");if(u.length&&compare(u,Re.x)!==0)throw new TypeError("Pubkey mismatch for p2tr witness");if(Re.parity!==(p[0]&1))throw new Error("Incorrect parity")}}return Object.assign(c,t)}const FUTURE_SEGWIT_MAX_SIZE=40,FUTURE_SEGWIT_MIN_SIZE=2,FUTURE_SEGWIT_MAX_VERSION=16,FUTURE_SEGWIT_MIN_VERSION=2,FUTURE_SEGWIT_VERSION_DIFF=80,FUTURE_SEGWIT_VERSION_WARNING="WARNING: Sending to a future segwit version address can lead to loss of funds. End users MUST be warned carefully in the GUI and asked if they wish to proceed with caution. Wallets should verify the segwit version from the output of fromBech32, then decide when it is safe to use which version of segwit.",WARNING_STATES=[!1,!1];function _toFutureSegwitAddress(t,e){const r=t.slice(2);if(r.length<FUTURE_SEGWIT_MIN_SIZE||r.length>FUTURE_SEGWIT_MAX_SIZE)throw new TypeError("Invalid program length for segwit address");const n=t[0]-FUTURE_SEGWIT_VERSION_DIFF;if(n<FUTURE_SEGWIT_MIN_VERSION||n>FUTURE_SEGWIT_MAX_VERSION)throw new TypeError("Invalid version for segwit address");if(t[1]!==r.length)throw new TypeError("Invalid script for segwit address");return WARNING_STATES[0]===!1&&(console.warn(FUTURE_SEGWIT_VERSION_WARNING),WARNING_STATES[0]=!0),toBech32(r,n,e.bech32)}function fromBase58Check(t){const e=bs58Check.decode(t);if(e.length<21)throw new TypeError(t+" is too short");if(e.length>21)throw new TypeError(t+" is too long");const r=readUInt8(e,0),n=e.slice(1);return{version:r,hash:n}}function fromBech32(t){let e,r;try{e=distExports$1.bech32.decode(t)}catch{}if(e){if(r=e.words[0],r!==0)throw new TypeError(t+" uses wrong encoding")}else if(e=distExports$1.bech32m.decode(t),r=e.words[0],r===0)throw new TypeError(t+" uses wrong encoding");const n=distExports$1.bech32.fromWords(e.words.slice(1));return{version:r,prefix:e.prefix,data:Uint8Array.from(n)}}function toBech32(t,e,r){const n=distExports$1.bech32.toWords(t);return n.unshift(e),e===0?distExports$1.bech32.encode(r,n):distExports$1.bech32m.encode(r,n)}function fromOutputScript(t,e){e=e||bitcoin$1;try{return p2pkh({output:t,network:e}).address}catch{}try{return p2sh({output:t,network:e}).address}catch{}try{return p2wpkh({output:t,network:e}).address}catch{}try{return p2wsh({output:t,network:e}).address}catch{}try{return p2tr({output:t,network:e}).address}catch{}try{return _toFutureSegwitAddress(t,e)}catch{}throw new Error(toASM(t)+" has no matching Address")}function toOutputScript(t,e){e=e||bitcoin$1;let r,n;try{r=fromBase58Check(t)}catch{}if(r){if(r.version===e.pubKeyHash)return p2pkh({hash:r.hash}).output;if(r.version===e.scriptHash)return p2sh({hash:r.hash}).output}else{try{n=fromBech32(t)}catch{}if(n){if(n.prefix!==e.bech32)throw new Error(t+" has an invalid prefix");if(n.version===0){if(n.data.length===20)return p2wpkh({hash:n.data}).output;if(n.data.length===32)return p2wsh({hash:n.data}).output}else if(n.version===1){if(n.data.length===32)return p2tr({pubkey:n.data}).output}else if(n.version>=FUTURE_SEGWIT_MIN_VERSION&&n.version<=FUTURE_SEGWIT_MAX_VERSION&&n.data.length>=FUTURE_SEGWIT_MIN_SIZE&&n.data.length<=FUTURE_SEGWIT_MAX_SIZE)return WARNING_STATES[1]===!1&&(console.warn(FUTURE_SEGWIT_VERSION_WARNING),WARNING_STATES[1]=!0),compile([n.version+FUTURE_SEGWIT_VERSION_DIFF,n.data])}}throw new Error(t+" has no matching Script")}function varSliceSize(t){const e=t.length;return encodingLength(e)+e}function vectorSize(t){const e=t.length;return encodingLength(e)+t.reduce((r,n)=>r+varSliceSize(n),0)}const EMPTY_BUFFER$1=new Uint8Array(0),EMPTY_WITNESS=[],ZERO=fromHex("0000000000000000000000000000000000000000000000000000000000000000"),ONE=fromHex("0000000000000000000000000000000000000000000000000000000000000001"),VALUE_UINT64_MAX=fromHex("ffffffffffffffff"),BLANK_OUTPUT={script:EMPTY_BUFFER$1,valueBuffer:VALUE_UINT64_MAX};function isOutput(t){return t.value!==void 0}class Transaction{static DEFAULT_SEQUENCE=4294967295;static SIGHASH_DEFAULT=0;static SIGHASH_ALL=1;static SIGHASH_NONE=2;static SIGHASH_SINGLE=3;static SIGHASH_ANYONECANPAY=128;static SIGHASH_OUTPUT_MASK=3;static SIGHASH_INPUT_MASK=128;static ADVANCED_TRANSACTION_MARKER=0;static ADVANCED_TRANSACTION_FLAG=1;static fromBuffer(e,r){const n=new BufferReader(e),s=new Transaction;s.version=n.readUInt32();const o=n.readUInt8(),c=n.readUInt8();let u=!1;o===Transaction.ADVANCED_TRANSACTION_MARKER&&c===Transaction.ADVANCED_TRANSACTION_FLAG?u=!0:n.offset-=2;const f=n.readVarInt();for(let p=0;p<f;++p)s.ins.push({hash:n.readSlice(32),index:n.readUInt32(),script:n.readVarSlice(),sequence:n.readUInt32(),witness:EMPTY_WITNESS});const x=n.readVarInt();for(let p=0;p<x;++p)s.outs.push({value:n.readInt64(),script:n.readVarSlice()});if(u){for(let p=0;p<f;++p)s.ins[p].witness=n.readVector();if(!s.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(s.locktime=n.readUInt32(),r)return s;if(n.offset!==e.length)throw new Error("Transaction has unexpected data");return s}static fromHex(e){return Transaction.fromBuffer(fromHex(e),!1)}static isCoinbaseHash(e){parse$1(Hash256bitSchema,e);for(let r=0;r<32;++r)if(e[r]!==0)return!1;return!0}version=1;locktime=0;ins=[];outs=[];isCoinbase(){return this.ins.length===1&&Transaction.isCoinbaseHash(this.ins[0].hash)}addInput(e,r,n,s){return parse$1(tuple([Hash256bitSchema,UInt32Schema,nullable(optional$1(UInt32Schema)),nullable(optional$1(BufferSchema))]),[e,r,n,s]),n==null&&(n=Transaction.DEFAULT_SEQUENCE),this.ins.push({hash:e,index:r,script:s||EMPTY_BUFFER$1,sequence:n,witness:EMPTY_WITNESS})-1}addOutput(e,r){return parse$1(tuple([BufferSchema,SatoshiSchema]),[e,r]),this.outs.push({script:e,value:r})-1}hasWitnesses(){return this.ins.some(e=>e.witness.length!==0)}stripWitnesses(){this.ins.forEach(e=>{e.witness=EMPTY_WITNESS})}weight(){const e=this.byteLength(!1),r=this.byteLength(!0);return e*3+r}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(e=!0){const r=e&&this.hasWitnesses();return(r?10:8)+encodingLength(this.ins.length)+encodingLength(this.outs.length)+this.ins.reduce((n,s)=>n+40+varSliceSize(s.script),0)+this.outs.reduce((n,s)=>n+8+varSliceSize(s.script),0)+(r?this.ins.reduce((n,s)=>n+vectorSize(s.witness),0):0)}clone(){const e=new Transaction;return e.version=this.version,e.locktime=this.locktime,e.ins=this.ins.map(r=>({hash:r.hash,index:r.index,script:r.script,sequence:r.sequence,witness:r.witness})),e.outs=this.outs.map(r=>({script:r.script,value:r.value})),e}hashForSignature(e,r,n){if(parse$1(tuple([UInt32Schema,BufferSchema,number$1()]),[e,r,n]),e>=this.ins.length)return ONE;const s=compile(decompile(r).filter(u=>u!==OPS$7.OP_CODESEPARATOR)),o=this.clone();if((n&31)===Transaction.SIGHASH_NONE)o.outs=[],o.ins.forEach((u,f)=>{f!==e&&(u.sequence=0)});else if((n&31)===Transaction.SIGHASH_SINGLE){if(e>=this.outs.length)return ONE;o.outs.length=e+1;for(let u=0;u<e;u++)o.outs[u]=BLANK_OUTPUT;o.ins.forEach((u,f)=>{f!==e&&(u.sequence=0)})}n&Transaction.SIGHASH_ANYONECANPAY?(o.ins=[o.ins[e]],o.ins[0].script=s):(o.ins.forEach(u=>{u.script=EMPTY_BUFFER$1}),o.ins[e].script=s);const c=new Uint8Array(o.byteLength(!1)+4);return writeInt32(c,c.length-4,n,"LE"),o.__toBuffer(c,0,!1),hash256(c)}hashForWitnessV1(e,r,n,s,o,c){if(parse$1(tuple([UInt32Schema,array(BufferSchema),array(SatoshiSchema),UInt32Schema]),[e,r,n,s]),n.length!==this.ins.length||r.length!==this.ins.length)throw new Error("Must supply prevout script and value for all inputs");const u=s===Transaction.SIGHASH_DEFAULT?Transaction.SIGHASH_ALL:s&Transaction.SIGHASH_OUTPUT_MASK,x=(s&Transaction.SIGHASH_INPUT_MASK)===Transaction.SIGHASH_ANYONECANPAY,p=u===Transaction.SIGHASH_NONE,g=u===Transaction.SIGHASH_SINGLE;let y=EMPTY_BUFFER$1,b=EMPTY_BUFFER$1,R=EMPTY_BUFFER$1,D=EMPTY_BUFFER$1,k=EMPTY_BUFFER$1;if(!x){let $e=BufferWriter.withCapacity(36*this.ins.length);this.ins.forEach(ze=>{$e.writeSlice(ze.hash),$e.writeUInt32(ze.index)}),y=sha256$5($e.end()),$e=BufferWriter.withCapacity(8*this.ins.length),n.forEach(ze=>$e.writeInt64(ze)),b=sha256$5($e.end()),$e=BufferWriter.withCapacity(r.map(varSliceSize).reduce((ze,q)=>ze+q)),r.forEach(ze=>$e.writeVarSlice(ze)),R=sha256$5($e.end()),$e=BufferWriter.withCapacity(4*this.ins.length),this.ins.forEach(ze=>$e.writeUInt32(ze.sequence)),D=sha256$5($e.end())}if(p||g){if(g&&e<this.outs.length){const $e=this.outs[e],ze=BufferWriter.withCapacity(8+varSliceSize($e.script));ze.writeInt64($e.value),ze.writeVarSlice($e.script),k=sha256$5(ze.end())}}else{if(!this.outs.length)throw new Error("Add outputs to the transaction before signing.");const $e=this.outs.map(q=>8+varSliceSize(q.script)).reduce((q,W)=>q+W),ze=BufferWriter.withCapacity($e);this.outs.forEach(q=>{ze.writeInt64(q.value),ze.writeVarSlice(q.script)}),k=sha256$5(ze.end())}const Re=(o?2:0)+(c?1:0),Fe=174-(x?49:0)-(p?32:0)+(c?32:0)+(o?37:0),O=BufferWriter.withCapacity(Fe);if(O.writeUInt8(s),O.writeUInt32(this.version),O.writeUInt32(this.locktime),O.writeSlice(y),O.writeSlice(b),O.writeSlice(R),O.writeSlice(D),p||g||O.writeSlice(k),O.writeUInt8(Re),x){const $e=this.ins[e];O.writeSlice($e.hash),O.writeUInt32($e.index),O.writeInt64(n[e]),O.writeVarSlice(r[e]),O.writeUInt32($e.sequence)}else O.writeUInt32(e);if(c){const $e=BufferWriter.withCapacity(varSliceSize(c));$e.writeVarSlice(c),O.writeSlice(sha256$5($e.end()))}return g&&O.writeSlice(k),o&&(O.writeSlice(o),O.writeUInt8(0),O.writeUInt32(4294967295)),taggedHash("TapSighash",concat$1([Uint8Array.from([0]),O.end()]))}hashForWitnessV0(e,r,n,s){parse$1(tuple([UInt32Schema,BufferSchema,SatoshiSchema,UInt32Schema]),[e,r,n,s]);let o=Uint8Array.from([]),c,u=ZERO,f=ZERO,x=ZERO;if(s&Transaction.SIGHASH_ANYONECANPAY||(o=new Uint8Array(36*this.ins.length),c=new BufferWriter(o,0),this.ins.forEach(g=>{c.writeSlice(g.hash),c.writeUInt32(g.index)}),f=hash256(o)),!(s&Transaction.SIGHASH_ANYONECANPAY)&&(s&31)!==Transaction.SIGHASH_SINGLE&&(s&31)!==Transaction.SIGHASH_NONE&&(o=new Uint8Array(4*this.ins.length),c=new BufferWriter(o,0),this.ins.forEach(g=>{c.writeUInt32(g.sequence)}),x=hash256(o)),(s&31)!==Transaction.SIGHASH_SINGLE&&(s&31)!==Transaction.SIGHASH_NONE){const g=this.outs.reduce((y,b)=>y+8+varSliceSize(b.script),0);o=new Uint8Array(g),c=new BufferWriter(o,0),this.outs.forEach(y=>{c.writeInt64(y.value),c.writeVarSlice(y.script)}),u=hash256(o)}else if((s&31)===Transaction.SIGHASH_SINGLE&&e<this.outs.length){const g=this.outs[e];o=new Uint8Array(8+varSliceSize(g.script)),c=new BufferWriter(o,0),c.writeInt64(g.value),c.writeVarSlice(g.script),u=hash256(o)}o=new Uint8Array(156+varSliceSize(r)),c=new BufferWriter(o,0);const p=this.ins[e];return c.writeUInt32(this.version),c.writeSlice(f),c.writeSlice(x),c.writeSlice(p.hash),c.writeUInt32(p.index),c.writeVarSlice(r),c.writeInt64(n),c.writeUInt32(p.sequence),c.writeSlice(u),c.writeUInt32(this.locktime),c.writeUInt32(s),hash256(o)}getHash(e){return e&&this.isCoinbase()?new Uint8Array(32):hash256(this.__toBuffer(void 0,void 0,e))}getId(){return toHex(reverseBuffer(this.getHash(!1)))}toBuffer(e,r){return this.__toBuffer(e,r,!0)}toHex(){return toHex(this.toBuffer(void 0,void 0))}setInputScript(e,r){parse$1(tuple([number$1(),BufferSchema]),[e,r]),this.ins[e].script=r}setWitness(e,r){parse$1(tuple([number$1(),array(BufferSchema)]),[e,r]),this.ins[e].witness=r}__toBuffer(e,r,n=!1){e||(e=new Uint8Array(this.byteLength(n)));const s=new BufferWriter(e,r||0);s.writeUInt32(this.version);const o=n&&this.hasWitnesses();return o&&(s.writeUInt8(Transaction.ADVANCED_TRANSACTION_MARKER),s.writeUInt8(Transaction.ADVANCED_TRANSACTION_FLAG)),s.writeVarInt(this.ins.length),this.ins.forEach(c=>{s.writeSlice(c.hash),s.writeUInt32(c.index),s.writeVarSlice(c.script),s.writeUInt32(c.sequence)}),s.writeVarInt(this.outs.length),this.outs.forEach(c=>{isOutput(c)?s.writeInt64(c.value):s.writeSlice(c.valueBuffer),s.writeVarSlice(c.script)}),o&&this.ins.forEach(c=>{s.writeVector(c.witness)}),s.writeUInt32(this.locktime),r!==void 0?e.slice(r,s.offset):e}}var GlobalTypes;(function(t){t[t.UNSIGNED_TX=0]="UNSIGNED_TX",t[t.GLOBAL_XPUB=1]="GLOBAL_XPUB"})(GlobalTypes||(GlobalTypes={}));var InputTypes;(function(t){t[t.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",t[t.WITNESS_UTXO=1]="WITNESS_UTXO",t[t.PARTIAL_SIG=2]="PARTIAL_SIG",t[t.SIGHASH_TYPE=3]="SIGHASH_TYPE",t[t.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",t[t.WITNESS_SCRIPT=5]="WITNESS_SCRIPT",t[t.BIP32_DERIVATION=6]="BIP32_DERIVATION",t[t.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",t[t.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",t[t.POR_COMMITMENT=9]="POR_COMMITMENT",t[t.TAP_KEY_SIG=19]="TAP_KEY_SIG",t[t.TAP_SCRIPT_SIG=20]="TAP_SCRIPT_SIG",t[t.TAP_LEAF_SCRIPT=21]="TAP_LEAF_SCRIPT",t[t.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION",t[t.TAP_INTERNAL_KEY=23]="TAP_INTERNAL_KEY",t[t.TAP_MERKLE_ROOT=24]="TAP_MERKLE_ROOT"})(InputTypes||(InputTypes={}));var OutputTypes;(function(t){t[t.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",t[t.WITNESS_SCRIPT=1]="WITNESS_SCRIPT",t[t.BIP32_DERIVATION=2]="BIP32_DERIVATION",t[t.TAP_INTERNAL_KEY=5]="TAP_INTERNAL_KEY",t[t.TAP_TREE=6]="TAP_TREE",t[t.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION"})(OutputTypes||(OutputTypes={}));const range$3=t=>[...Array(t).keys()];function decode$e(t){if(t.key[0]!==GlobalTypes.GLOBAL_XPUB)throw new Error("Decode Error: could not decode globalXpub with key 0x"+toHex(t.key));if(t.key.length!==79||![2,3].includes(t.key[46]))throw new Error("Decode Error: globalXpub has invalid extended pubkey in key 0x"+toHex(t.key));if(t.value.length/4%1!==0)throw new Error("Decode Error: Global GLOBAL_XPUB value length should be multiple of 4");const e=t.key.slice(1),r={masterFingerprint:t.value.slice(0,4),extendedPubkey:e,path:"m"};for(const n of range$3(t.value.length/4-1)){const s=readUInt32$1(t.value,n*4+4,"LE"),o=!!(s&2147483648),c=s&2147483647;r.path+="/"+c.toString(10)+(o?"'":"")}return r}function encode$e(t){const e=new Uint8Array([GlobalTypes.GLOBAL_XPUB]),r=concat$1([e,t.extendedPubkey]),n=t.path.split("/"),s=new Uint8Array(n.length*4);s.set(t.masterFingerprint,0);let o=4;return n.slice(1).forEach(c=>{const u=c.slice(-1)==="'";let f=2147483647&parseInt(u?c.slice(0,-1):c,10);u&&(f+=2147483648),writeUInt32$2(s,o,f,"LE"),o+=4}),{key:r,value:s}}const expected$c="{ masterFingerprint: Uint8Array; extendedPubkey: Uint8Array; path: string; }";function check$c(t){const e=t.extendedPubkey,r=t.masterFingerprint,n=t.path;return e instanceof Uint8Array&&e.length===78&&[2,3].indexOf(e[45])>-1&&r instanceof Uint8Array&&r.length===4&&typeof n=="string"&&!!n.match(/^m(\/\d+'?)*$/)}function canAddToArray$3(t,e,r){const n=toHex(e.extendedPubkey);return r.has(n)?!1:(r.add(n),t.filter(s=>compare(s.extendedPubkey,e.extendedPubkey)).length===0)}const globalXpub=Object.freeze(Object.defineProperty({__proto__:null,canAddToArray:canAddToArray$3,check:check$c,decode:decode$e,encode:encode$e,expected:expected$c},Symbol.toStringTag,{value:"Module"}));function encode$d(t){return{key:new Uint8Array([GlobalTypes.UNSIGNED_TX]),value:t.toBuffer()}}const unsignedTx=Object.freeze(Object.defineProperty({__proto__:null,encode:encode$d},Symbol.toStringTag,{value:"Module"}));function decode$d(t){if(t.key[0]!==InputTypes.FINAL_SCRIPTSIG)throw new Error("Decode Error: could not decode finalScriptSig with key 0x"+toHex(t.key));return t.value}function encode$c(t){return{key:new Uint8Array([InputTypes.FINAL_SCRIPTSIG]),value:t}}const expected$b="Uint8Array";function check$b(t){return t instanceof Uint8Array}function canAdd$8(t,e){return!!t&&!!e&&t.finalScriptSig===void 0}const finalScriptSig=Object.freeze(Object.defineProperty({__proto__:null,canAdd:canAdd$8,check:check$b,decode:decode$d,encode:encode$c,expected:expected$b},Symbol.toStringTag,{value:"Module"}));function decode$c(t){if(t.key[0]!==InputTypes.FINAL_SCRIPTWITNESS)throw new Error("Decode Error: could not decode finalScriptWitness with key 0x"+toHex(t.key));return t.value}function encode$b(t){return{key:new Uint8Array([InputTypes.FINAL_SCRIPTWITNESS]),value:t}}const expected$a="Uint8Array";function check$a(t){return t instanceof Uint8Array}function canAdd$7(t,e){return!!t&&!!e&&t.finalScriptWitness===void 0}const finalScriptWitness=Object.freeze(Object.defineProperty({__proto__:null,canAdd:canAdd$7,check:check$a,decode:decode$c,encode:encode$b,expected:expected$a},Symbol.toStringTag,{value:"Module"}));function decode$b(t){if(t.key[0]!==InputTypes.NON_WITNESS_UTXO)throw new Error("Decode Error: could not decode nonWitnessUtxo with key 0x"+toHex(t.key));return t.value}function encode$a(t){return{key:new Uint8Array([InputTypes.NON_WITNESS_UTXO]),value:t}}const expected$9="Uint8Array";function check$9(t){return t instanceof Uint8Array}function canAdd$6(t,e){return!!t&&!!e&&t.nonWitnessUtxo===void 0}const nonWitnessUtxo=Object.freeze(Object.defineProperty({__proto__:null,canAdd:canAdd$6,check:check$9,decode:decode$b,encode:encode$a,expected:expected$9},Symbol.toStringTag,{value:"Module"}));function decode$a(t){if(t.key[0]!==InputTypes.PARTIAL_SIG)throw new Error("Decode Error: could not decode partialSig with key 0x"+toHex(t.key));if(!(t.key.length===34||t.key.length===66)||![2,3,4].includes(t.key[1]))throw new Error("Decode Error: partialSig has invalid pubkey in key 0x"+toHex(t.key));return{pubkey:t.key.slice(1),signature:t.value}}function encode$9(t){const e=new Uint8Array([InputTypes.PARTIAL_SIG]);return{key:concat$1([e,t.pubkey]),value:t.signature}}const expected$8="{ pubkey: Uint8Array; signature: Uint8Array; }";function check$8(t){return t.pubkey instanceof Uint8Array&&t.signature instanceof Uint8Array&&[33,65].includes(t.pubkey.length)&&[2,3,4].includes(t.pubkey[0])&&isDerSigWithSighash(t.signature)}function isDerSigWithSighash(t){if(!(t instanceof Uint8Array)||t.length<9||t[0]!==48||t.length!==t[1]+3||t[2]!==2)return!1;const e=t[3];if(e>33||e<1||t[3+e+1]!==2)return!1;const r=t[3+e+2];return!(r>33||r<1||t.length!==3+e+2+r+2)}function canAddToArray$2(t,e,r){const n=toHex(e.pubkey);return r.has(n)?!1:(r.add(n),t.filter(s=>compare(s.pubkey,e.pubkey)===0).length===0)}const partialSig=Object.freeze(Object.defineProperty({__proto__:null,canAddToArray:canAddToArray$2,check:check$8,decode:decode$a,encode:encode$9,expected:expected$8},Symbol.toStringTag,{value:"Module"}));function decode$9(t){if(t.key[0]!==InputTypes.POR_COMMITMENT)throw new Error("Decode Error: could not decode porCommitment with key 0x"+toHex(t.key));return toUtf8(t.value)}function encode$8(t){return{key:new Uint8Array([InputTypes.POR_COMMITMENT]),value:fromUtf8(t)}}const expected$7="string";function check$7(t){return typeof t=="string"}function canAdd$5(t,e){return!!t&&!!e&&t.porCommitment===void 0}const porCommitment=Object.freeze(Object.defineProperty({__proto__:null,canAdd:canAdd$5,check:check$7,decode:decode$9,encode:encode$8,expected:expected$7},Symbol.toStringTag,{value:"Module"}));function decode$8(t){if(t.key[0]!==InputTypes.SIGHASH_TYPE)throw new Error("Decode Error: could not decode sighashType with key 0x"+toHex(t.key));return Number(readUInt32$1(t.value,0,"LE"))}function encode$7(t){const e=Uint8Array.from([InputTypes.SIGHASH_TYPE]),r=new Uint8Array(4);return writeUInt32$2(r,0,t,"LE"),{key:e,value:r}}const expected$6="number";function check$6(t){return typeof t=="number"}function canAdd$4(t,e){return!!t&&!!e&&t.sighashType===void 0}const sighashType=Object.freeze(Object.defineProperty({__proto__:null,canAdd:canAdd$4,check:check$6,decode:decode$8,encode:encode$7,expected:expected$6},Symbol.toStringTag,{value:"Module"}));function decode$7(t){if(t.key[0]!==InputTypes.TAP_KEY_SIG||t.key.length!==1)throw new Error("Decode Error: could not decode tapKeySig with key 0x"+toHex(t.key));if(!check$5(t.value))throw new Error("Decode Error: tapKeySig not a valid 64-65-byte BIP340 signature");return t.value}function encode$6(t){return{key:Uint8Array.from([InputTypes.TAP_KEY_SIG]),value:t}}const expected$5="Uint8Array";function check$5(t){return t instanceof Uint8Array&&(t.length===64||t.length===65)}function canAdd$3(t,e){return!!t&&!!e&&t.tapKeySig===void 0}const tapKeySig=Object.freeze(Object.defineProperty({__proto__:null,canAdd:canAdd$3,check:check$5,decode:decode$7,encode:encode$6,expected:expected$5},Symbol.toStringTag,{value:"Module"}));function decode$6(t){if(t.key[0]!==InputTypes.TAP_LEAF_SCRIPT)throw new Error("Decode Error: could not decode tapLeafScript with key 0x"+toHex(t.key));if((t.key.length-2)%32!==0)throw new Error("Decode Error: tapLeafScript has invalid control block in key 0x"+toHex(t.key));const e=t.value[t.value.length-1];if((t.key[1]&254)!==e)throw new Error("Decode Error: tapLeafScript bad leaf version in key 0x"+toHex(t.key));const r=t.value.slice(0,-1);return{controlBlock:t.key.slice(1),script:r,leafVersion:e}}function encode$5(t){const e=Uint8Array.from([InputTypes.TAP_LEAF_SCRIPT]),r=Uint8Array.from([t.leafVersion]);return{key:concat$1([e,t.controlBlock]),value:concat$1([t.script,r])}}const expected$4="{ controlBlock: Uint8Array; leafVersion: number, script: Uint8Array; }";function check$4(t){return t.controlBlock instanceof Uint8Array&&(t.controlBlock.length-1)%32===0&&(t.controlBlock[0]&254)===t.leafVersion&&t.script instanceof Uint8Array}function canAddToArray$1(t,e,r){const n=toHex(e.controlBlock);return r.has(n)?!1:(r.add(n),t.filter(s=>compare(s.controlBlock,e.controlBlock)===0).length===0)}const tapLeafScript=Object.freeze(Object.defineProperty({__proto__:null,canAddToArray:canAddToArray$1,check:check$4,decode:decode$6,encode:encode$5,expected:expected$4},Symbol.toStringTag,{value:"Module"}));function decode$5(t){if(t.key[0]!==InputTypes.TAP_MERKLE_ROOT||t.key.length!==1)throw new Error("Decode Error: could not decode tapMerkleRoot with key 0x"+toHex(t.key));if(!check$3(t.value))throw new Error("Decode Error: tapMerkleRoot not a 32-byte hash");return t.value}function encode$4(t){return{key:Uint8Array.from([InputTypes.TAP_MERKLE_ROOT]),value:t}}const expected$3="Uint8Array";function check$3(t){return t instanceof Uint8Array&&t.length===32}function canAdd$2(t,e){return!!t&&!!e&&t.tapMerkleRoot===void 0}const tapMerkleRoot=Object.freeze(Object.defineProperty({__proto__:null,canAdd:canAdd$2,check:check$3,decode:decode$5,encode:encode$4,expected:expected$3},Symbol.toStringTag,{value:"Module"}));function decode$4(t){if(t.key[0]!==InputTypes.TAP_SCRIPT_SIG)throw new Error("Decode Error: could not decode tapScriptSig with key 0x"+toHex(t.key));if(t.key.length!==65)throw new Error("Decode Error: tapScriptSig has invalid key 0x"+toHex(t.key));if(t.value.length!==64&&t.value.length!==65)throw new Error("Decode Error: tapScriptSig has invalid signature in key 0x"+toHex(t.key));const e=t.key.slice(1,33),r=t.key.slice(33);return{pubkey:e,leafHash:r,signature:t.value}}function encode$3(t){const e=Uint8Array.from([InputTypes.TAP_SCRIPT_SIG]);return{key:concat$1([e,t.pubkey,t.leafHash]),value:t.signature}}const expected$2="{ pubkey: Uint8Array; leafHash: Uint8Array; signature: Uint8Array; }";function check$2(t){return t.pubkey instanceof Uint8Array&&t.leafHash instanceof Uint8Array&&t.signature instanceof Uint8Array&&t.pubkey.length===32&&t.leafHash.length===32&&(t.signature.length===64||t.signature.length===65)}function canAddToArray(t,e,r){const n=toHex(e.pubkey)+toHex(e.leafHash);return r.has(n)?!1:(r.add(n),t.filter(s=>compare(s.pubkey,e.pubkey)===0&&compare(s.leafHash,e.leafHash)===0).length===0)}const tapScriptSig=Object.freeze(Object.defineProperty({__proto__:null,canAddToArray,check:check$2,decode:decode$4,encode:encode$3,expected:expected$2},Symbol.toStringTag,{value:"Module"}));function decode$3(t){if(t.key[0]!==InputTypes.WITNESS_UTXO)throw new Error("Decode Error: could not decode witnessUtxo with key 0x"+toHex(t.key));const e=readInt64(t.value,0,"LE");let r=8;const{numberValue:n,bytes:s}=decode$f(t.value,r);r+=s;const o=t.value.slice(r);if(o.length!==n)throw new Error("Decode Error: WITNESS_UTXO script is not proper length");return{script:o,value:e}}function encode$2(t){const{script:e,value:r}=t,n=encodingLength(e.length),s=new Uint8Array(8+n+e.length);return writeInt64(s,0,BigInt(r),"LE"),encode$f(e.length,s,8),s.set(e,8+n),{key:Uint8Array.from([InputTypes.WITNESS_UTXO]),value:s}}const expected$1="{ script: Uint8Array; value: bigint; }";function check$1(t){return t.script instanceof Uint8Array&&typeof t.value=="bigint"}function canAdd$1(t,e){return!!t&&!!e&&t.witnessUtxo===void 0}const witnessUtxo=Object.freeze(Object.defineProperty({__proto__:null,canAdd:canAdd$1,check:check$1,decode:decode$3,encode:encode$2,expected:expected$1},Symbol.toStringTag,{value:"Module"}));function decode$2(t){if(t.key[0]!==OutputTypes.TAP_TREE||t.key.length!==1)throw new Error("Decode Error: could not decode tapTree with key 0x"+toHex(t.key));let e=0;const r=[];for(;e<t.value.length;){const n=t.value[e++],s=t.value[e++],{numberValue:o,bytes:c}=decode$f(t.value,e);e+=c,r.push({depth:n,leafVersion:s,script:t.value.slice(e,e+o)}),e+=o}return{leaves:r}}function encode$1(t){const e=Uint8Array.from([OutputTypes.TAP_TREE]),r=[].concat(...t.leaves.map(n=>[Uint8Array.of(n.depth,n.leafVersion),encode$f(BigInt(n.script.length)).buffer,n.script]));return{key:e,value:concat$1(r)}}const expected="{ leaves: [{ depth: number; leafVersion: number, script: Uint8Array; }] }";function check(t){return Array.isArray(t.leaves)&&t.leaves.every(e=>e.depth>=0&&e.depth<=128&&(e.leafVersion&254)===e.leafVersion&&e.script instanceof Uint8Array)}function canAdd(t,e){return!!t&&!!e&&t.tapTree===void 0}const tapTree=Object.freeze(Object.defineProperty({__proto__:null,canAdd,check,decode:decode$2,encode:encode$1,expected},Symbol.toStringTag,{value:"Module"})),range$2=t=>[...Array(t).keys()],isValidDERKey=t=>t.length===33&&[2,3].includes(t[0])||t.length===65&&t[0]===4;function makeConverter$4(t,e=isValidDERKey){function r(u){if(u.key[0]!==t)throw new Error("Decode Error: could not decode bip32Derivation with key 0x"+toHex(u.key));const f=u.key.slice(1);if(!e(f))throw new Error("Decode Error: bip32Derivation has invalid pubkey in key 0x"+toHex(u.key));if(u.value.length/4%1!==0)throw new Error("Decode Error: Input BIP32_DERIVATION value length should be multiple of 4");const x={masterFingerprint:u.value.slice(0,4),pubkey:f,path:"m"};for(const p of range$2(u.value.length/4-1)){const g=readUInt32$1(u.value,p*4+4,"LE"),y=!!(g&2147483648),b=g&2147483647;x.path+="/"+b.toString(10)+(y?"'":"")}return x}function n(u){const f=Uint8Array.from([t]),x=concat$1([f,u.pubkey]),p=u.path.split("/"),g=new Uint8Array(p.length*4);g.set(u.masterFingerprint,0);let y=4;return p.slice(1).forEach(b=>{const R=b.slice(-1)==="'";let D=2147483647&parseInt(R?b.slice(0,-1):b,10);R&&(D+=2147483648),writeUInt32$2(g,y,D,"LE"),y+=4}),{key:x,value:g}}const s="{ masterFingerprint: Uint8Array; pubkey: Uint8Array; path: string; }";function o(u){return u.pubkey instanceof Uint8Array&&u.masterFingerprint instanceof Uint8Array&&typeof u.path=="string"&&e(u.pubkey)&&u.masterFingerprint.length===4}function c(u,f,x){const p=toHex(f.pubkey);return x.has(p)?!1:(x.add(p),u.filter(g=>compare(g.pubkey,f.pubkey)===0).length===0)}return{decode:r,encode:n,check:o,expected:s,canAddToArray:c}}function makeChecker(t){return e;function e(r){let n;if(t.includes(r.key[0])&&(n=r.key.slice(1),!(n.length===33||n.length===65)||![2,3,4].includes(n[0])))throw new Error("Format Error: invalid pubkey in key 0x"+toHex(r.key));return n}}function makeConverter$3(t){function e(c){if(c.key[0]!==t)throw new Error("Decode Error: could not decode redeemScript with key 0x"+toHex(c.key));return c.value}function r(c){return{key:Uint8Array.from([t]),value:c}}const n="Uint8Array";function s(c){return c instanceof Uint8Array}function o(c,u){return!!c&&!!u&&c.redeemScript===void 0}return{decode:e,encode:r,check:s,expected:n,canAdd:o}}const isValidBIP340Key=t=>t.length===32;function makeConverter$2(t){const e=makeConverter$4(t,isValidBIP340Key);function r(c){const{numberValue:u,bytes:f}=decode$f(c.value),x=e.decode({key:c.key,value:c.value.slice(f+Number(u)*32)}),p=new Array(Number(u));for(let g=0,y=f;g<u;g++,y+=32)p[g]=c.value.slice(y,y+32);return{...x,leafHashes:p}}function n(c){const u=e.encode(c),f=encodingLength(c.leafHashes.length),x=new Uint8Array(f);encode$f(c.leafHashes.length,x);const p=concat$1([x,...c.leafHashes,u.value]);return{...u,value:p}}const s="{ masterFingerprint: Uint8Array; pubkey: Uint8Array; path: string; leafHashes: Uint8Array[]; }";function o(c){return Array.isArray(c.leafHashes)&&c.leafHashes.every(u=>u instanceof Uint8Array&&u.length===32)&&e.check(c)}return{decode:r,encode:n,check:o,expected:s,canAddToArray:e.canAddToArray}}function makeConverter$1(t){function e(c){if(c.key[0]!==t||c.key.length!==1)throw new Error("Decode Error: could not decode tapInternalKey with key 0x"+toHex(c.key));if(c.value.length!==32)throw new Error("Decode Error: tapInternalKey not a 32-byte x-only pubkey");return c.value}function r(c){return{key:Uint8Array.from([t]),value:c}}const n="Uint8Array";function s(c){return c instanceof Uint8Array&&c.length===32}function o(c,u){return!!c&&!!u&&c.tapInternalKey===void 0}return{decode:e,encode:r,check:s,expected:n,canAdd:o}}function makeConverter(t){function e(c){if(c.key[0]!==t)throw new Error("Decode Error: could not decode witnessScript with key 0x"+toHex(c.key));return c.value}function r(c){return{key:Uint8Array.from([t]),value:c}}const n="Uint8Array";function s(c){return c instanceof Uint8Array}function o(c,u){return!!c&&!!u&&c.witnessScript===void 0}return{decode:e,encode:r,check:s,expected:n,canAdd:o}}const globals={unsignedTx,globalXpub,checkPubkey:makeChecker([])},inputs={nonWitnessUtxo,partialSig,sighashType,finalScriptSig,finalScriptWitness,porCommitment,witnessUtxo,bip32Derivation:makeConverter$4(InputTypes.BIP32_DERIVATION),redeemScript:makeConverter$3(InputTypes.REDEEM_SCRIPT),witnessScript:makeConverter(InputTypes.WITNESS_SCRIPT),checkPubkey:makeChecker([InputTypes.PARTIAL_SIG,InputTypes.BIP32_DERIVATION]),tapKeySig,tapScriptSig,tapLeafScript,tapBip32Derivation:makeConverter$2(InputTypes.TAP_BIP32_DERIVATION),tapInternalKey:makeConverter$1(InputTypes.TAP_INTERNAL_KEY),tapMerkleRoot},outputs={bip32Derivation:makeConverter$4(OutputTypes.BIP32_DERIVATION),redeemScript:makeConverter$3(OutputTypes.REDEEM_SCRIPT),witnessScript:makeConverter(OutputTypes.WITNESS_SCRIPT),checkPubkey:makeChecker([OutputTypes.BIP32_DERIVATION]),tapBip32Derivation:makeConverter$2(OutputTypes.TAP_BIP32_DERIVATION),tapTree,tapInternalKey:makeConverter$1(OutputTypes.TAP_INTERNAL_KEY)},converter=Object.freeze(Object.defineProperty({__proto__:null,globals,inputs,outputs},Symbol.toStringTag,{value:"Module"})),range$1=t=>[...Array(t).keys()];function keyValsToBuffer(t){const e=t.map(keyValToBuffer);return e.push(Uint8Array.from([0])),concat$1(e)}function keyValToBuffer(t){const e=t.key.length,r=t.value.length,n=encodingLength(e),s=encodingLength(r),o=new Uint8Array(n+e+s+r);return encode$f(e,o,0),o.set(t.key,n),encode$f(r,o,n+e),o.set(t.value,n+e+s),o}function psbtFromBuffer(t,e){let r=0;function n(){const{numberValue:k,bytes:Re}=decode$f(t,r);r+=Re;const Fe=t.slice(r,r+Number(k));return r+=Number(k),Fe}function s(){const k=readUInt32$1(t,r,"BE");return r+=4,k}function o(){const k=readUInt8(t,r);return r+=1,k}function c(){const k=n(),Re=n();return{key:k,value:Re}}function u(){if(r>=t.length)throw new Error("Format Error: Unexpected End of PSBT");const k=readUInt8(t,r)===0;return k&&r++,k}if(s()!==1886610036)throw new Error("Format Error: Invalid Magic Number");if(o()!==255)throw new Error("Format Error: Magic Number must be followed by 0xff separator");const f=[],x={};for(;!u();){const k=c(),Re=toHex(k.key);if(x[Re])throw new Error("Format Error: Keys must be unique for global keymap: key "+Re);x[Re]=1,f.push(k)}const p=f.filter(k=>k.key[0]===GlobalTypes.UNSIGNED_TX);if(p.length!==1)throw new Error("Format Error: Only one UNSIGNED_TX allowed");const g=e(p[0].value),{inputCount:y,outputCount:b}=g.getInputOutputCounts(),R=[],D=[];for(const k of range$1(y)){const Re={},Fe=[];for(;!u();){const O=c(),$e=toHex(O.key);if(Re[$e])throw new Error("Format Error: Keys must be unique for each input: input index "+k+" key "+$e);Re[$e]=1,Fe.push(O)}R.push(Fe)}for(const k of range$1(b)){const Re={},Fe=[];for(;!u();){const O=c(),$e=toHex(O.key);if(Re[$e])throw new Error("Format Error: Keys must be unique for each output: output index "+k+" key "+$e);Re[$e]=1,Fe.push(O)}D.push(Fe)}return psbtFromKeyVals(g,{globalMapKeyVals:f,inputKeyVals:R,outputKeyVals:D})}function checkKeyBuffer(t,e,r){if(compare(e,Uint8Array.from([r])))throw new Error(`Format Error: Invalid ${t} key: ${toHex(e)}`)}function psbtFromKeyVals(t,{globalMapKeyVals:e,inputKeyVals:r,outputKeyVals:n}){const s={unsignedTx:t};let o=0;for(const p of e)switch(p.key[0]){case GlobalTypes.UNSIGNED_TX:if(checkKeyBuffer("global",p.key,GlobalTypes.UNSIGNED_TX),o>0)throw new Error("Format Error: GlobalMap has multiple UNSIGNED_TX");o++;break;case GlobalTypes.GLOBAL_XPUB:s.globalXpub===void 0&&(s.globalXpub=[]),s.globalXpub.push(globals.globalXpub.decode(p));break;default:s.unknownKeyVals||(s.unknownKeyVals=[]),s.unknownKeyVals.push(p)}const c=r.length,u=n.length,f=[],x=[];for(const p of range$1(c)){const g={};for(const y of r[p])switch(inputs.checkPubkey(y),y.key[0]){case InputTypes.NON_WITNESS_UTXO:if(checkKeyBuffer("input",y.key,InputTypes.NON_WITNESS_UTXO),g.nonWitnessUtxo!==void 0)throw new Error("Format Error: Input has multiple NON_WITNESS_UTXO");g.nonWitnessUtxo=inputs.nonWitnessUtxo.decode(y);break;case InputTypes.WITNESS_UTXO:if(checkKeyBuffer("input",y.key,InputTypes.WITNESS_UTXO),g.witnessUtxo!==void 0)throw new Error("Format Error: Input has multiple WITNESS_UTXO");g.witnessUtxo=inputs.witnessUtxo.decode(y);break;case InputTypes.PARTIAL_SIG:g.partialSig===void 0&&(g.partialSig=[]),g.partialSig.push(inputs.partialSig.decode(y));break;case InputTypes.SIGHASH_TYPE:if(checkKeyBuffer("input",y.key,InputTypes.SIGHASH_TYPE),g.sighashType!==void 0)throw new Error("Format Error: Input has multiple SIGHASH_TYPE");g.sighashType=inputs.sighashType.decode(y);break;case InputTypes.REDEEM_SCRIPT:if(checkKeyBuffer("input",y.key,InputTypes.REDEEM_SCRIPT),g.redeemScript!==void 0)throw new Error("Format Error: Input has multiple REDEEM_SCRIPT");g.redeemScript=inputs.redeemScript.decode(y);break;case InputTypes.WITNESS_SCRIPT:if(checkKeyBuffer("input",y.key,InputTypes.WITNESS_SCRIPT),g.witnessScript!==void 0)throw new Error("Format Error: Input has multiple WITNESS_SCRIPT");g.witnessScript=inputs.witnessScript.decode(y);break;case InputTypes.BIP32_DERIVATION:g.bip32Derivation===void 0&&(g.bip32Derivation=[]),g.bip32Derivation.push(inputs.bip32Derivation.decode(y));break;case InputTypes.FINAL_SCRIPTSIG:checkKeyBuffer("input",y.key,InputTypes.FINAL_SCRIPTSIG),g.finalScriptSig=inputs.finalScriptSig.decode(y);break;case InputTypes.FINAL_SCRIPTWITNESS:checkKeyBuffer("input",y.key,InputTypes.FINAL_SCRIPTWITNESS),g.finalScriptWitness=inputs.finalScriptWitness.decode(y);break;case InputTypes.POR_COMMITMENT:checkKeyBuffer("input",y.key,InputTypes.POR_COMMITMENT),g.porCommitment=inputs.porCommitment.decode(y);break;case InputTypes.TAP_KEY_SIG:checkKeyBuffer("input",y.key,InputTypes.TAP_KEY_SIG),g.tapKeySig=inputs.tapKeySig.decode(y);break;case InputTypes.TAP_SCRIPT_SIG:g.tapScriptSig===void 0&&(g.tapScriptSig=[]),g.tapScriptSig.push(inputs.tapScriptSig.decode(y));break;case InputTypes.TAP_LEAF_SCRIPT:g.tapLeafScript===void 0&&(g.tapLeafScript=[]),g.tapLeafScript.push(inputs.tapLeafScript.decode(y));break;case InputTypes.TAP_BIP32_DERIVATION:g.tapBip32Derivation===void 0&&(g.tapBip32Derivation=[]),g.tapBip32Derivation.push(inputs.tapBip32Derivation.decode(y));break;case InputTypes.TAP_INTERNAL_KEY:checkKeyBuffer("input",y.key,InputTypes.TAP_INTERNAL_KEY),g.tapInternalKey=inputs.tapInternalKey.decode(y);break;case InputTypes.TAP_MERKLE_ROOT:checkKeyBuffer("input",y.key,InputTypes.TAP_MERKLE_ROOT),g.tapMerkleRoot=inputs.tapMerkleRoot.decode(y);break;default:g.unknownKeyVals||(g.unknownKeyVals=[]),g.unknownKeyVals.push(y)}f.push(g)}for(const p of range$1(u)){const g={};for(const y of n[p])switch(outputs.checkPubkey(y),y.key[0]){case OutputTypes.REDEEM_SCRIPT:if(checkKeyBuffer("output",y.key,OutputTypes.REDEEM_SCRIPT),g.redeemScript!==void 0)throw new Error("Format Error: Output has multiple REDEEM_SCRIPT");g.redeemScript=outputs.redeemScript.decode(y);break;case OutputTypes.WITNESS_SCRIPT:if(checkKeyBuffer("output",y.key,OutputTypes.WITNESS_SCRIPT),g.witnessScript!==void 0)throw new Error("Format Error: Output has multiple WITNESS_SCRIPT");g.witnessScript=outputs.witnessScript.decode(y);break;case OutputTypes.BIP32_DERIVATION:g.bip32Derivation===void 0&&(g.bip32Derivation=[]),g.bip32Derivation.push(outputs.bip32Derivation.decode(y));break;case OutputTypes.TAP_INTERNAL_KEY:checkKeyBuffer("output",y.key,OutputTypes.TAP_INTERNAL_KEY),g.tapInternalKey=outputs.tapInternalKey.decode(y);break;case OutputTypes.TAP_TREE:checkKeyBuffer("output",y.key,OutputTypes.TAP_TREE),g.tapTree=outputs.tapTree.decode(y);break;case OutputTypes.TAP_BIP32_DERIVATION:g.tapBip32Derivation===void 0&&(g.tapBip32Derivation=[]),g.tapBip32Derivation.push(outputs.tapBip32Derivation.decode(y));break;default:g.unknownKeyVals||(g.unknownKeyVals=[]),g.unknownKeyVals.push(y)}x.push(g)}return{globalMap:s,inputs:f,outputs:x}}function psbtToBuffer({globalMap:t,inputs:e,outputs:r}){const{globalKeyVals:n,inputKeyVals:s,outputKeyVals:o}=psbtToKeyVals({globalMap:t,inputs:e,outputs:r}),c=keyValsToBuffer(n),u=g=>g.length===0?[Uint8Array.from([0])]:g.map(keyValsToBuffer),f=u(s),x=u(o),p=new Uint8Array(5);return p.set([112,115,98,116,255],0),concat$1([p,c].concat(f,x))}const sortKeyVals=(t,e)=>compare(t.key,e.key);function keyValsFromMap(t,e){const r=new Set,n=Object.entries(t).reduce((o,[c,u])=>{if(c==="unknownKeyVals")return o;const f=e[c];if(f===void 0)return o;const x=(Array.isArray(u)?u:[u]).map(f.encode);return x.map(g=>toHex(g.key)).forEach(g=>{if(r.has(g))throw new Error("Serialize Error: Duplicate key: "+g);r.add(g)}),o.concat(x)},[]),s=t.unknownKeyVals?t.unknownKeyVals.filter(o=>!r.has(toHex(o.key))):[];return n.concat(s).sort(sortKeyVals)}function psbtToKeyVals({globalMap:t,inputs:e,outputs:r}){return{globalKeyVals:keyValsFromMap(t,globals),inputKeyVals:e.map(n=>keyValsFromMap(n,inputs)),outputKeyVals:r.map(n=>keyValsFromMap(n,outputs))}}function combine(t){const e=t[0],r=psbtToKeyVals(e),n=t.slice(1);if(n.length===0)throw new Error("Combine: Nothing to combine");const s=getTx(e);if(s===void 0)throw new Error("Combine: Self missing transaction");const o=getKeySet(r.globalKeyVals),c=r.inputKeyVals.map(getKeySet),u=r.outputKeyVals.map(getKeySet);for(const f of n){const x=getTx(f);if(x===void 0||compare(x.toBuffer(),s.toBuffer())!==0)throw new Error("Combine: One of the Psbts does not have the same transaction.");const p=psbtToKeyVals(f);getKeySet(p.globalKeyVals).forEach(keyPusher(o,r.globalKeyVals,p.globalKeyVals)),p.inputKeyVals.map(getKeySet).forEach((R,D)=>R.forEach(keyPusher(c[D],r.inputKeyVals[D],p.inputKeyVals[D]))),p.outputKeyVals.map(getKeySet).forEach((R,D)=>R.forEach(keyPusher(u[D],r.outputKeyVals[D],p.outputKeyVals[D])))}return psbtFromKeyVals(s,{globalMapKeyVals:r.globalKeyVals,inputKeyVals:r.inputKeyVals,outputKeyVals:r.outputKeyVals})}function keyPusher(t,e,r){return n=>{if(t.has(n))return;const s=r.filter(o=>toHex(o.key)===n)[0];e.push(s),t.add(n)}}function getTx(t){return t.globalMap.unsignedTx}function getKeySet(t){const e=new Set;return t.forEach(r=>{const n=toHex(r.key);if(e.has(n))throw new Error("Combine: KeyValue Map keys should be unique");e.add(n)}),e}function checkForInput(t,e){const r=t[e];if(r===void 0)throw new Error(`No input #${e}`);return r}function checkForOutput(t,e){const r=t[e];if(r===void 0)throw new Error(`No output #${e}`);return r}function checkHasKey(t,e,r){if(t.key[0]<r)throw new Error("Use the method for your specific key instead of addUnknownKeyVal*");if(e&&e.filter(n=>compare(n.key,t.key)===0).length!==0)throw new Error(`Duplicate Key: ${toHex(t.key)}`)}function getEnumLength(t){let e=0;return Object.keys(t).forEach(r=>{Number(isNaN(Number(r)))&&e++}),e}function inputCheckUncleanFinalized(t,e){let r=!1;if(e.nonWitnessUtxo||e.witnessUtxo){const n=!!e.redeemScript,s=!!e.witnessScript,o=!n||!!e.finalScriptSig,c=!s||!!e.finalScriptWitness,u=!!e.finalScriptSig||!!e.finalScriptWitness;r=o&&c&&u}if(r===!1)throw new Error(`Input #${t} has too much or too little data to clean`)}function throwForUpdateMaker(t,e,r,n){throw new Error(`Data for ${t} key ${e} is incorrect: Expected ${r} and got ${JSON.stringify(n)}`)}function updateMaker(t){return(e,r)=>{for(const n of Object.keys(e)){const s=e[n],{canAdd:o,canAddToArray:c,check:u,expected:f}=converter[t+"s"][n]||{},x=!!c;if(u)if(x){if(!Array.isArray(s)||r[n]&&!Array.isArray(r[n]))throw new Error(`Key type ${n} must be an array`);s.every(u)||throwForUpdateMaker(t,n,f,s);const p=r[n]||[],g=new Set;if(!s.every(y=>c(p,y,g)))throw new Error("Can not add duplicate data to array");r[n]=p.concat(s)}else{if(u(s)||throwForUpdateMaker(t,n,f,s),!o(r,s))throw new Error(`Can not add duplicate data to ${t}`);r[n]=s}}}}const updateGlobal=updateMaker("global"),updateInput=updateMaker("input"),updateOutput=updateMaker("output");function addInputAttributes(t,e){const r=t.length-1,n=checkForInput(t,r);updateInput(e,n)}function addOutputAttributes(t,e){const r=t.length-1,n=checkForOutput(t,r);updateOutput(e,n)}let Psbt$1=class{constructor(e){this.inputs=[],this.outputs=[],this.globalMap={unsignedTx:e}}static fromBase64(e,r){const n=fromBase64(e);return this.fromBuffer(n,r)}static fromHex(e,r){const n=fromHex(e);return this.fromBuffer(n,r)}static fromBuffer(e,r){const n=psbtFromBuffer(e,r),s=new this(n.globalMap.unsignedTx);return Object.assign(s,n),s}toBase64(){const e=this.toBuffer();return toBase64(e)}toHex(){const e=this.toBuffer();return toHex(e)}toBuffer(){return psbtToBuffer(this)}updateGlobal(e){return updateGlobal(e,this.globalMap),this}updateInput(e,r){const n=checkForInput(this.inputs,e);return updateInput(r,n),this}updateOutput(e,r){const n=checkForOutput(this.outputs,e);return updateOutput(r,n),this}addUnknownKeyValToGlobal(e){return checkHasKey(e,this.globalMap.unknownKeyVals,getEnumLength(GlobalTypes)),this.globalMap.unknownKeyVals||(this.globalMap.unknownKeyVals=[]),this.globalMap.unknownKeyVals.push(e),this}addUnknownKeyValToInput(e,r){const n=checkForInput(this.inputs,e);return checkHasKey(r,n.unknownKeyVals,getEnumLength(InputTypes)),n.unknownKeyVals||(n.unknownKeyVals=[]),n.unknownKeyVals.push(r),this}addUnknownKeyValToOutput(e,r){const n=checkForOutput(this.outputs,e);return checkHasKey(r,n.unknownKeyVals,getEnumLength(OutputTypes)),n.unknownKeyVals||(n.unknownKeyVals=[]),n.unknownKeyVals.push(r),this}addInput(e){this.globalMap.unsignedTx.addInput(e),this.inputs.push({unknownKeyVals:[]});const r=e.unknownKeyVals||[],n=this.inputs.length-1;if(!Array.isArray(r))throw new Error("unknownKeyVals must be an Array");return r.forEach(s=>this.addUnknownKeyValToInput(n,s)),addInputAttributes(this.inputs,e),this}addOutput(e){this.globalMap.unsignedTx.addOutput(e),this.outputs.push({unknownKeyVals:[]});const r=e.unknownKeyVals||[],n=this.outputs.length-1;if(!Array.isArray(r))throw new Error("unknownKeyVals must be an Array");return r.forEach(s=>this.addUnknownKeyValToOutput(n,s)),addOutputAttributes(this.outputs,e),this}clearFinalizedInput(e){const r=checkForInput(this.inputs,e);inputCheckUncleanFinalized(e,r);for(const n of Object.keys(r))["witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknownKeyVals"].includes(n)||delete r[n];return this}combine(...e){const r=combine([this].concat(e));return Object.assign(this,r),this}getTransaction(){return this.globalMap.unsignedTx.toBuffer()}};function isPaymentFactory(t){return e=>{try{return t({output:e}),!0}catch{return!1}}}const isP2MS=isPaymentFactory(p2ms),isP2PK=isPaymentFactory(p2pk),isP2PKH=isPaymentFactory(p2pkh),isP2WPKH=isPaymentFactory(p2wpkh),isP2WSHScript=isPaymentFactory(p2wsh),isP2SHScript=isPaymentFactory(p2sh),isP2TR=isPaymentFactory(p2tr);function witnessStackToScriptWitness(t){let e=new Uint8Array(0);function r(c){e=concat$1([e,c])}function n(c){const u=e.length,f=encodingLength(c);e=concat$1([e,new Uint8Array(f)]),encode$f(c,e,u)}function s(c){n(c.length),r(c)}function o(c){n(c.length),c.forEach(s)}return o(t),e}function pubkeyPositionInScript(t,e){const r=hash160(t),n=t.slice(1,33),s=decompile(e);if(s===null)throw new Error("Unknown script error");return s.findIndex(o=>typeof o=="number"?!1:compare(t,o)===0||compare(r,o)===0||compare(n,o)===0)}function pubkeyInScript(t,e){return pubkeyPositionInScript(t,e)!==-1}function checkInputForSig(t,e){return extractPartialSigs(t).some(n=>signatureBlocksAction(n,signature.decode,e))}function signatureBlocksAction(t,e,r){const{hashType:n}=e(t),s=[];switch(n&Transaction.SIGHASH_ANYONECANPAY&&s.push("addInput"),n&31){case Transaction.SIGHASH_ALL:break;case Transaction.SIGHASH_SINGLE:case Transaction.SIGHASH_NONE:s.push("addOutput"),s.push("setInputSequence");break}return s.indexOf(r)===-1}function extractPartialSigs(t){let e=[];if((t.partialSig||[]).length===0){if(!t.finalScriptSig&&!t.finalScriptWitness)return[];e=getPsigsFromInputFinalScripts(t)}else e=t.partialSig;return e.map(r=>r.signature)}function getPsigsFromInputFinalScripts(t){const e=t.finalScriptSig?decompile(t.finalScriptSig)||[]:[],r=t.finalScriptWitness?decompile(t.finalScriptWitness)||[]:[];return e.concat(r).filter(n=>n instanceof Uint8Array&&isCanonicalScriptSignature(n)).map(n=>({signature:n}))}const toXOnly$1=t=>t.length===32?t:t.slice(1,33);function tapScriptFinalizer(t,e,r){const n=findTapLeafToFinalize(e,t,r);try{const o=sortSignatures(e,n).concat(n.script).concat(n.controlBlock);return{finalScriptWitness:witnessStackToScriptWitness(o)}}catch(s){throw new Error(`Can not finalize taproot input #${t}: ${s}`)}}function serializeTaprootSignature(t,e){const r=Uint8Array.from(e?[e]:[]);return concat$1([t,r])}function isTaprootInput(t){return t&&!!(t.tapInternalKey||t.tapMerkleRoot||t.tapLeafScript&&t.tapLeafScript.length||t.tapBip32Derivation&&t.tapBip32Derivation.length||t.witnessUtxo&&isP2TR(t.witnessUtxo.script))}function isTaprootOutput(t,e){return t&&!!(t.tapInternalKey||t.tapTree||t.tapBip32Derivation&&t.tapBip32Derivation.length||e)}function checkTaprootInputFields(t,e,r){checkMixedTaprootAndNonTaprootInputFields(t,e,r),checkIfTapLeafInTree(t,e,r)}function checkTaprootOutputFields(t,e,r){checkMixedTaprootAndNonTaprootOutputFields(t,e,r),checkTaprootScriptPubkey(t,e)}function checkTaprootScriptPubkey(t,e){if(!e.tapTree&&!e.tapInternalKey)return;const r=e.tapInternalKey||t.tapInternalKey,n=e.tapTree||t.tapTree;if(r){const{script:s}=t,o=getTaprootScripPubkey(r,n);if(s&&compare(o,s)!==0)throw new Error("Error adding output. Script or address mismatch.")}}function getTaprootScripPubkey(t,e){const r=e&&tapTreeFromList(e.leaves),{output:n}=p2tr({internalPubkey:t,scriptTree:r});return n}function tapTreeFromList(t=[]){return t.length===1&&t[0].depth===0?{output:t[0].script,version:t[0].leafVersion}:instertLeavesInTree(t)}function checkTaprootInputForSigs(t,e){return extractTaprootSigs(t).some(n=>signatureBlocksAction(n,decodeSchnorrSignature,e))}function decodeSchnorrSignature(t){return{signature:t.slice(0,64),hashType:t.slice(64)[0]||Transaction.SIGHASH_DEFAULT}}function extractTaprootSigs(t){const e=[];if(t.tapKeySig&&e.push(t.tapKeySig),t.tapScriptSig&&e.push(...t.tapScriptSig.map(r=>r.signature)),!e.length){const r=getTapKeySigFromWitness(t.finalScriptWitness);r&&e.push(r)}return e}function getTapKeySigFromWitness(t){if(!t)return;const e=t.slice(2);if(e.length===64||e.length===65)return e}function instertLeavesInTree(t){let e;for(const r of t)if(e=instertLeafInTree(r,e),!e)throw new Error("No room left to insert tapleaf in tree");return e}function instertLeafInTree(t,e,r=0){if(r>MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");if(t.depth===r)return e?void 0:{output:t.script,version:t.leafVersion};if(isTapleaf(e))return;const n=instertLeafInTree(t,e&&e[0],r+1);if(n)return[n,e&&e[1]];const s=instertLeafInTree(t,e&&e[1],r+1);if(s)return[e&&e[0],s]}function checkMixedTaprootAndNonTaprootInputFields(t,e,r){const n=isTaprootInput(t)&&hasNonTaprootFields(e),s=hasNonTaprootFields(t)&&isTaprootInput(e),o=t===e&&isTaprootInput(e)&&hasNonTaprootFields(e);if(n||s||o)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}function checkMixedTaprootAndNonTaprootOutputFields(t,e,r){const n=isTaprootOutput(t)&&hasNonTaprootFields(e),s=hasNonTaprootFields(t)&&isTaprootOutput(e),o=t===e&&isTaprootOutput(e)&&hasNonTaprootFields(e);if(n||s||o)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}function checkIfTapLeafInTree(t,e,r){if(e.tapMerkleRoot){const n=(e.tapLeafScript||[]).every(o=>isTapLeafInTree(o,e.tapMerkleRoot)),s=(t.tapLeafScript||[]).every(o=>isTapLeafInTree(o,e.tapMerkleRoot));if(!n||!s)throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}else if(t.tapMerkleRoot&&!(e.tapLeafScript||[]).every(s=>isTapLeafInTree(s,t.tapMerkleRoot)))throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}function isTapLeafInTree(t,e){if(!e)return!0;const r=tapleafHash({output:t.script,version:t.leafVersion}),n=rootHashFromPath(t.controlBlock,r);return compare(n,e)===0}function sortSignatures(t,e){const r=tapleafHash({output:e.script,version:e.leafVersion});return(t.tapScriptSig||[]).filter(n=>compare(n.leafHash,r)===0).map(n=>addPubkeyPositionInScript(e.script,n)).sort((n,s)=>s.positionInScript-n.positionInScript).map(n=>n.signature)}function addPubkeyPositionInScript(t,e){return Object.assign({positionInScript:pubkeyPositionInScript(e.pubkey,t)},e)}function findTapLeafToFinalize(t,e,r){if(!t.tapScriptSig||!t.tapScriptSig.length)throw new Error(`Can not finalize taproot input #${e}. No tapleaf script signature provided.`);const n=(t.tapLeafScript||[]).sort((s,o)=>s.controlBlock.length-o.controlBlock.length).find(s=>canFinalizeLeaf(s,t.tapScriptSig,r));if(!n)throw new Error(`Can not finalize taproot input #${e}. Signature for tapleaf script not found.`);return n}function canFinalizeLeaf(t,e,r){const n=tapleafHash({output:t.script,version:t.leafVersion});return(!r||compare(n,r)===0)&&e.find(o=>compare(o.leafHash,n)===0)!==void 0}function hasNonTaprootFields(t){return t&&!!(t.redeemScript||t.witnessScript||t.bip32Derivation&&t.bip32Derivation.length)}const DEFAULT_OPTS={network:bitcoin$1,maximumFeeRate:5e3};class Psbt{data;static fromBase64(e,r={}){const n=fromBase64(e);return this.fromBuffer(n,r)}static fromHex(e,r={}){const n=fromHex(e);return this.fromBuffer(n,r)}static fromBuffer(e,r={}){const n=Psbt$1.fromBuffer(e,transactionFromBuffer),s=new Psbt(r,n);return checkTxForDupeIns(s.__CACHE.__TX,s.__CACHE),s}__CACHE;opts;constructor(e={},r=new Psbt$1(new PsbtTransaction)){this.data=r,this.opts=Object.assign({},DEFAULT_OPTS,e),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},this.data.inputs.length===0&&this.setVersion(2);const n=(s,o,c,u)=>Object.defineProperty(s,o,{enumerable:c,writable:u});n(this,"__CACHE",!1,!0),n(this,"opts",!1,!0)}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(e){this.setVersion(e)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(e){this.setLocktime(e)}get txInputs(){return this.__CACHE.__TX.ins.map(e=>({hash:cloneBuffer(e.hash),index:e.index,sequence:e.sequence}))}get txOutputs(){return this.__CACHE.__TX.outs.map(e=>{let r;try{r=fromOutputScript(e.script,this.opts.network)}catch{}return{script:cloneBuffer(e.script),value:e.value,address:r}})}combine(...e){return this.data.combine(...e.map(r=>r.data)),this}clone(){const e=Psbt.fromBuffer(this.data.toBuffer());return e.opts=JSON.parse(JSON.stringify(this.opts)),e}setMaximumFeeRate(e){check32Bit(e),this.opts.maximumFeeRate=e}setVersion(e){check32Bit(e),checkInputsForPartialSig(this.data.inputs,"setVersion");const r=this.__CACHE;return r.__TX.version=e,r.__EXTRACTED_TX=void 0,this}setLocktime(e){check32Bit(e),checkInputsForPartialSig(this.data.inputs,"setLocktime");const r=this.__CACHE;return r.__TX.locktime=e,r.__EXTRACTED_TX=void 0,this}setInputSequence(e,r){check32Bit(r),checkInputsForPartialSig(this.data.inputs,"setInputSequence");const n=this.__CACHE;if(n.__TX.ins.length<=e)throw new Error("Input index too high");return n.__TX.ins[e].sequence=r,n.__EXTRACTED_TX=void 0,this}addInputs(e){return e.forEach(r=>this.addInput(r)),this}addInput(e){if(arguments.length>1||!e||e.hash===void 0||e.index===void 0)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");checkTaprootInputFields(e,e,"addInput"),checkInputsForPartialSig(this.data.inputs,"addInput"),e.witnessScript&&checkInvalidP2WSH(e.witnessScript);const r=this.__CACHE;this.data.addInput(e);const n=r.__TX.ins[r.__TX.ins.length-1];checkTxInputCache(r,n);const s=this.data.inputs.length-1,o=this.data.inputs[s];return o.nonWitnessUtxo&&addNonWitnessTxCache(this.__CACHE,o,s),r.__FEE=void 0,r.__FEE_RATE=void 0,r.__EXTRACTED_TX=void 0,this}addOutputs(e){return e.forEach(r=>this.addOutput(r)),this}addOutput(e){if(arguments.length>1||!e||e.value===void 0||e.address===void 0&&e.script===void 0)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");checkInputsForPartialSig(this.data.inputs,"addOutput");const{address:r}=e;if(typeof r=="string"){const{network:s}=this.opts,o=toOutputScript(r,s);e=Object.assign({},e,{script:o})}checkTaprootOutputFields(e,e,"addOutput");const n=this.__CACHE;return this.data.addOutput(e),n.__FEE=void 0,n.__FEE_RATE=void 0,n.__EXTRACTED_TX=void 0,this}extractTransaction(e){if(!this.data.inputs.every(isFinalized))throw new Error("Not finalized");const r=this.__CACHE;if(e||checkFees(this,r,this.opts),r.__EXTRACTED_TX)return r.__EXTRACTED_TX;const n=r.__TX.clone();return inputFinalizeGetAmts(this.data.inputs,n,r,!0),n}getFeeRate(){return getTxCacheValue("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return getTxCacheValue("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return checkForInput(this.data.inputs,0),range(this.data.inputs.length).forEach(e=>this.finalizeInput(e)),this}finalizeInput(e,r){const n=checkForInput(this.data.inputs,e);return isTaprootInput(n)?this._finalizeTaprootInput(e,n,void 0,r):this._finalizeInput(e,n,r)}finalizeTaprootInput(e,r,n=tapScriptFinalizer){const s=checkForInput(this.data.inputs,e);if(isTaprootInput(s))return this._finalizeTaprootInput(e,s,r,n);throw new Error(`Cannot finalize input #${e}. Not Taproot.`)}_finalizeInput(e,r,n=getFinalScripts){const{script:s,isP2SH:o,isP2WSH:c,isSegwit:u}=getScriptFromInput(e,r,this.__CACHE);if(!s)throw new Error(`No script found for input #${e}`);checkPartialSigSighashes(r);const{finalScriptSig:f,finalScriptWitness:x}=n(e,r,s,u,o,c);if(f&&this.data.updateInput(e,{finalScriptSig:f}),x&&this.data.updateInput(e,{finalScriptWitness:x}),!f&&!x)throw new Error(`Unknown error finalizing input #${e}`);return this.data.clearFinalizedInput(e),this}_finalizeTaprootInput(e,r,n,s=tapScriptFinalizer){if(!r.witnessUtxo)throw new Error(`Cannot finalize input #${e}. Missing withness utxo.`);if(r.tapKeySig){const o=p2tr({output:r.witnessUtxo.script,signature:r.tapKeySig}),c=witnessStackToScriptWitness(o.witness);this.data.updateInput(e,{finalScriptWitness:c})}else{const{finalScriptWitness:o}=s(e,r,n);this.data.updateInput(e,{finalScriptWitness:o})}return this.data.clearFinalizedInput(e),this}getInputType(e){const r=checkForInput(this.data.inputs,e),n=getScriptFromUtxo(e,r,this.__CACHE),s=getMeaningfulScript(n,e,"input",r.redeemScript||redeemFromFinalScriptSig(r.finalScriptSig),r.witnessScript||redeemFromFinalWitnessScript(r.finalScriptWitness)),o=s.type==="raw"?"":s.type+"-",c=classifyScript(s.meaningfulScript);return o+c}inputHasPubkey(e,r){const n=checkForInput(this.data.inputs,e);return pubkeyInInput(r,n,e,this.__CACHE)}inputHasHDKey(e,r){const n=checkForInput(this.data.inputs,e),s=bip32DerivationIsMine(r);return!!n.bip32Derivation&&n.bip32Derivation.some(s)}outputHasPubkey(e,r){const n=checkForOutput(this.data.outputs,e);return pubkeyInOutput(r,n,e,this.__CACHE)}outputHasHDKey(e,r){const n=checkForOutput(this.data.outputs,e),s=bip32DerivationIsMine(r);return!!n.bip32Derivation&&n.bip32Derivation.some(s)}validateSignaturesOfAllInputs(e){return checkForInput(this.data.inputs,0),range(this.data.inputs.length).map(n=>this.validateSignaturesOfInput(n,e)).reduce((n,s)=>s===!0&&n,!0)}validateSignaturesOfInput(e,r,n){const s=this.data.inputs[e];return isTaprootInput(s)?this.validateSignaturesOfTaprootInput(e,r,n):this._validateSignaturesOfInput(e,r,n)}_validateSignaturesOfInput(e,r,n){const s=this.data.inputs[e],o=(s||{}).partialSig;if(!s||!o||o.length<1)throw new Error("No signatures to validate");if(typeof r!="function")throw new Error("Need validator function to validate signatures");const c=n?o.filter(g=>compare(g.pubkey,n)===0):o;if(c.length<1)throw new Error("No signatures for this pubkey");const u=[];let f,x,p;for(const g of c){const y=signature.decode(g.signature),{hash:b,script:R}=p!==y.hashType?getHashForSig(e,Object.assign({},s,{sighashType:y.hashType}),this.__CACHE,!0):{hash:f,script:x};p=y.hashType,f=b,x=R,checkScriptForPubkey(g.pubkey,R,"verify"),u.push(r(g.pubkey,b,y.signature))}return u.every(g=>g===!0)}validateSignaturesOfTaprootInput(e,r,n){const s=this.data.inputs[e],o=(s||{}).tapKeySig,c=(s||{}).tapScriptSig;if(!s&&!o&&!(c&&!c.length))throw new Error("No signatures to validate");if(typeof r!="function")throw new Error("Need validator function to validate signatures");n=n&&toXOnly$1(n);const u=n?getTaprootHashesForSig(e,s,this.data.inputs,n,this.__CACHE):getAllTaprootHashesForSig(e,s,this.data.inputs,this.__CACHE);if(!u.length)throw new Error("No signatures for this pubkey");const f=u.find(p=>!p.leafHash);let x=0;if(o&&f){if(!r(f.pubkey,f.hash,trimTaprootSig(o)))return!1;x++}if(c)for(const p of c){const g=u.find(y=>compare(y.pubkey,p.pubkey)===0);if(g){if(!r(p.pubkey,g.hash,trimTaprootSig(p.signature)))return!1;x++}}return x>0}signAllInputsHD(e,r=[Transaction.SIGHASH_ALL]){if(!e||!e.publicKey||!e.fingerprint)throw new Error("Need HDSigner to sign input");const n=[];for(const s of range(this.data.inputs.length))try{this.signInputHD(s,e,r),n.push(!0)}catch{n.push(!1)}if(n.every(s=>s===!1))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(e,r=[Transaction.SIGHASH_ALL]){return new Promise((n,s)=>{if(!e||!e.publicKey||!e.fingerprint)return s(new Error("Need HDSigner to sign input"));const o=[],c=[];for(const u of range(this.data.inputs.length))c.push(this.signInputHDAsync(u,e,r).then(()=>{o.push(!0)},()=>{o.push(!1)}));return Promise.all(c).then(()=>{if(o.every(u=>u===!1))return s(new Error("No inputs were signed"));n()})})}signInputHD(e,r,n=[Transaction.SIGHASH_ALL]){if(!r||!r.publicKey||!r.fingerprint)throw new Error("Need HDSigner to sign input");return getSignersFromHD(e,this.data.inputs,r).forEach(o=>this.signInput(e,o,n)),this}signInputHDAsync(e,r,n=[Transaction.SIGHASH_ALL]){return new Promise((s,o)=>{if(!r||!r.publicKey||!r.fingerprint)return o(new Error("Need HDSigner to sign input"));const u=getSignersFromHD(e,this.data.inputs,r).map(f=>this.signInputAsync(e,f,n));return Promise.all(u).then(()=>{s()}).catch(o)})}signAllInputs(e,r){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const n=[];for(const s of range(this.data.inputs.length))try{this.signInput(s,e,r),n.push(!0)}catch{n.push(!1)}if(n.every(s=>s===!1))throw new Error("No inputs were signed");return this}signAllInputsAsync(e,r){return new Promise((n,s)=>{if(!e||!e.publicKey)return s(new Error("Need Signer to sign input"));const o=[],c=[];for(const[u]of this.data.inputs.entries())c.push(this.signInputAsync(u,e,r).then(()=>{o.push(!0)},()=>{o.push(!1)}));return Promise.all(c).then(()=>{if(o.every(u=>u===!1))return s(new Error("No inputs were signed"));n()})})}signInput(e,r,n){if(!r||!r.publicKey)throw new Error("Need Signer to sign input");const s=checkForInput(this.data.inputs,e);return isTaprootInput(s)?this._signTaprootInput(e,s,r,void 0,n):this._signInput(e,r,n)}signTaprootInput(e,r,n,s){if(!r||!r.publicKey)throw new Error("Need Signer to sign input");const o=checkForInput(this.data.inputs,e);if(isTaprootInput(o))return this._signTaprootInput(e,o,r,n,s);throw new Error(`Input #${e} is not of type Taproot.`)}_signInput(e,r,n=[Transaction.SIGHASH_ALL]){const{hash:s,sighashType:o}=getHashAndSighashType(this.data.inputs,e,r.publicKey,this.__CACHE,n),c=[{pubkey:r.publicKey,signature:signature.encode(r.sign(s),o)}];return this.data.updateInput(e,{partialSig:c}),this}_signTaprootInput(e,r,n,s,o=[Transaction.SIGHASH_DEFAULT]){const c=this.checkTaprootHashesForSig(e,r,n,s,o),u=c.filter(x=>!x.leafHash).map(x=>serializeTaprootSignature(n.signSchnorr(x.hash),r.sighashType))[0],f=c.filter(x=>!!x.leafHash).map(x=>({pubkey:toXOnly$1(n.publicKey),signature:serializeTaprootSignature(n.signSchnorr(x.hash),r.sighashType),leafHash:x.leafHash}));return u&&this.data.updateInput(e,{tapKeySig:u}),f.length&&this.data.updateInput(e,{tapScriptSig:f}),this}signInputAsync(e,r,n){return Promise.resolve().then(()=>{if(!r||!r.publicKey)throw new Error("Need Signer to sign input");const s=checkForInput(this.data.inputs,e);return isTaprootInput(s)?this._signTaprootInputAsync(e,s,r,void 0,n):this._signInputAsync(e,r,n)})}signTaprootInputAsync(e,r,n,s){return Promise.resolve().then(()=>{if(!r||!r.publicKey)throw new Error("Need Signer to sign input");const o=checkForInput(this.data.inputs,e);if(isTaprootInput(o))return this._signTaprootInputAsync(e,o,r,n,s);throw new Error(`Input #${e} is not of type Taproot.`)})}_signInputAsync(e,r,n=[Transaction.SIGHASH_ALL]){const{hash:s,sighashType:o}=getHashAndSighashType(this.data.inputs,e,r.publicKey,this.__CACHE,n);return Promise.resolve(r.sign(s)).then(c=>{const u=[{pubkey:r.publicKey,signature:signature.encode(c,o)}];this.data.updateInput(e,{partialSig:u})})}async _signTaprootInputAsync(e,r,n,s,o=[Transaction.SIGHASH_DEFAULT]){const c=this.checkTaprootHashesForSig(e,r,n,s,o),u=[],f=c.filter(p=>!p.leafHash)[0];if(f){const p=Promise.resolve(n.signSchnorr(f.hash)).then(g=>({tapKeySig:serializeTaprootSignature(g,r.sighashType)}));u.push(p)}const x=c.filter(p=>!!p.leafHash);if(x.length){const p=x.map(g=>Promise.resolve(n.signSchnorr(g.hash)).then(y=>({tapScriptSig:[{pubkey:toXOnly$1(n.publicKey),signature:serializeTaprootSignature(y,r.sighashType),leafHash:g.leafHash}]})));u.push(...p)}return Promise.all(u).then(p=>{p.forEach(g=>this.data.updateInput(e,g))})}checkTaprootHashesForSig(e,r,n,s,o){if(typeof n.signSchnorr!="function")throw new Error(`Need Schnorr Signer to sign taproot input #${e}.`);const c=getTaprootHashesForSig(e,r,this.data.inputs,n.publicKey,this.__CACHE,s,o);if(!c||!c.length)throw new Error(`Can not sign for input #${e} with the key ${toHex(n.publicKey)}`);return c}toBuffer(){return checkCache(this.__CACHE),this.data.toBuffer()}toHex(){return checkCache(this.__CACHE),this.data.toHex()}toBase64(){return checkCache(this.__CACHE),this.data.toBase64()}updateGlobal(e){return this.data.updateGlobal(e),this}updateInput(e,r){return r.witnessScript&&checkInvalidP2WSH(r.witnessScript),checkTaprootInputFields(this.data.inputs[e],r,"updateInput"),this.data.updateInput(e,r),r.nonWitnessUtxo&&addNonWitnessTxCache(this.__CACHE,this.data.inputs[e],e),this}updateOutput(e,r){const n=this.data.outputs[e];return checkTaprootOutputFields(n,r,"updateOutput"),this.data.updateOutput(e,r),this}addUnknownKeyValToGlobal(e){return this.data.addUnknownKeyValToGlobal(e),this}addUnknownKeyValToInput(e,r){return this.data.addUnknownKeyValToInput(e,r),this}addUnknownKeyValToOutput(e,r){return this.data.addUnknownKeyValToOutput(e,r),this}clearFinalizedInput(e){return this.data.clearFinalizedInput(e),this}}const transactionFromBuffer=t=>new PsbtTransaction(t);class PsbtTransaction{tx;constructor(e=Uint8Array.from([2,0,0,0,0,0,0,0,0,0])){this.tx=Transaction.fromBuffer(e),checkTxEmpty(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(e){if(e.hash===void 0||e.index===void 0||!(e.hash instanceof Uint8Array)&&typeof e.hash!="string"||typeof e.index!="number")throw new Error("Error adding input.");const r=typeof e.hash=="string"?reverseBuffer(fromHex(e.hash)):e.hash;this.tx.addInput(r,e.index,e.sequence)}addOutput(e){if(e.script===void 0||e.value===void 0||!(e.script instanceof Uint8Array)||typeof e.value!="bigint")throw new Error("Error adding output.");this.tx.addOutput(e.script,e.value)}toBuffer(){return this.tx.toBuffer()}}function canFinalize(t,e,r){switch(r){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return hasSigs(1,t.partialSig);case"multisig":const n=p2ms({output:e});return hasSigs(n.m,t.partialSig,n.pubkeys);default:return!1}}function checkCache(t){if(t.__UNSAFE_SIGN_NONSEGWIT!==!1)throw new Error("Not BIP174 compliant, can not export")}function hasSigs(t,e,r){if(!e)return!1;let n;if(r?n=r.map(s=>{const o=compressPubkey(s);return e.find(c=>compare(c.pubkey,o)===0)}).filter(s=>!!s):n=e,n.length>t)throw new Error("Too many signatures");return n.length===t}function isFinalized(t){return!!t.finalScriptSig||!!t.finalScriptWitness}function bip32DerivationIsMine(t){return e=>!(compare(t.fingerprint,e.masterFingerprint)||compare(t.derivePath(e.path).publicKey,e.pubkey))}function check32Bit(t){if(typeof t!="number"||t!==Math.floor(t)||t>4294967295||t<0)throw new Error("Invalid 32 bit integer")}function checkFees(t,e,r){const n=e.__FEE_RATE||t.getFeeRate(),s=e.__EXTRACTED_TX.virtualSize(),o=n*s;if(n>=r.maximumFeeRate)throw new Error(`Warning: You are paying around ${(o/1e8).toFixed(8)} in fees, which is ${n} satoshi per byte for a transaction with a VSize of ${s} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}function checkInputsForPartialSig(t,e){t.forEach(r=>{if(isTaprootInput(r)?checkTaprootInputForSigs(r,e):checkInputForSig(r,e))throw new Error("Can not modify transaction, signatures exist.")})}function checkPartialSigSighashes(t){if(!t.sighashType||!t.partialSig)return;const{partialSig:e,sighashType:r}=t;e.forEach(n=>{const{hashType:s}=signature.decode(n.signature);if(r!==s)throw new Error("Signature sighash does not match input sighash type")})}function checkScriptForPubkey(t,e,r){if(!pubkeyInScript(t,e))throw new Error(`Can not ${r} for this input with the key ${toHex(t)}`)}function checkTxEmpty(t){if(!t.ins.every(r=>r.script&&r.script.length===0&&r.witness&&r.witness.length===0))throw new Error("Format Error: Transaction ScriptSigs are not empty")}function checkTxForDupeIns(t,e){t.ins.forEach(r=>{checkTxInputCache(e,r)})}function checkTxInputCache(t,e){const r=toHex(reverseBuffer(Uint8Array.from(e.hash)))+":"+e.index;if(t.__TX_IN_CACHE[r])throw new Error("Duplicate input detected.");t.__TX_IN_CACHE[r]=1}function scriptCheckerFactory(t,e){return(r,n,s,o)=>{const c=t({redeem:{output:s}}).output;if(compare(n,c))throw new Error(`${e} for ${o} #${r} doesn't match the scriptPubKey in the prevout`)}}const checkRedeemScript=scriptCheckerFactory(p2sh,"Redeem script"),checkWitnessScript=scriptCheckerFactory(p2wsh,"Witness script");function getTxCacheValue(t,e,r,n){if(!r.every(isFinalized))throw new Error(`PSBT must be finalized to calculate ${e}`);if(t==="__FEE_RATE"&&n.__FEE_RATE)return n.__FEE_RATE;if(t==="__FEE"&&n.__FEE)return n.__FEE;let s,o=!0;if(n.__EXTRACTED_TX?(s=n.__EXTRACTED_TX,o=!1):s=n.__TX.clone(),inputFinalizeGetAmts(r,s,n,o),t==="__FEE_RATE")return n.__FEE_RATE;if(t==="__FEE")return n.__FEE}function getFinalScripts(t,e,r,n,s,o){const c=classifyScript(r);if(!canFinalize(e,r,c))throw new Error(`Can not finalize input #${t}`);return prepareFinalScripts(r,c,e.partialSig,n,s,o)}function prepareFinalScripts(t,e,r,n,s,o){let c,u;const f=getPayment(t,e,r),x=o?p2wsh({redeem:f}):null,p=s?p2sh({redeem:x||f}):null;return n?(x?u=witnessStackToScriptWitness(x.witness):u=witnessStackToScriptWitness(f.witness),p&&(c=p.input)):p?c=p.input:c=f.input,{finalScriptSig:c,finalScriptWitness:u}}function getHashAndSighashType(t,e,r,n,s){const o=checkForInput(t,e),{hash:c,sighashType:u,script:f}=getHashForSig(e,o,n,!1,s);return checkScriptForPubkey(r,f,"sign"),{hash:c,sighashType:u}}function getHashForSig(t,e,r,n,s){const o=r.__TX,c=e.sighashType||Transaction.SIGHASH_ALL;checkSighashTypeAllowed(c,s);let u,f;if(e.nonWitnessUtxo){const g=nonWitnessUtxoTxFromCache(r,e,t),y=o.ins[t].hash,b=g.getHash();if(compare(y,b)!==0)throw new Error(`Non-witness UTXO hash for input #${t} doesn't match the hash specified in the prevout`);const R=o.ins[t].index;f=g.outs[R]}else if(e.witnessUtxo)f=e.witnessUtxo;else throw new Error("Need a Utxo input item for signing");const{meaningfulScript:x,type:p}=getMeaningfulScript(f.script,t,"input",e.redeemScript,e.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(p)>=0)u=o.hashForWitnessV0(t,x,f.value,c);else if(isP2WPKH(x)){const g=p2pkh({hash:x.slice(2)}).output;u=o.hashForWitnessV0(t,g,f.value,c)}else{if(e.nonWitnessUtxo===void 0&&r.__UNSAFE_SIGN_NONSEGWIT===!1)throw new Error(`Input #${t} has witnessUtxo but non-segwit script: ${toHex(x)}`);!n&&r.__UNSAFE_SIGN_NONSEGWIT!==!1&&console.warn(`Warning: Signing non-segwit inputs without the full parent transaction means there is a chance that a miner could feed you incorrect information to trick you into paying large fees. This behavior is the same as Psbt's predecessor (TransactionBuilder - now removed) when signing non-segwit scripts. You are not able to export this Psbt with toBuffer|toBase64|toHex since it is not BIP174 compliant.
*********************
PROCEED WITH CAUTION!
*********************`),u=o.hashForSignature(t,x,c)}return{script:x,sighashType:c,hash:u}}function getAllTaprootHashesForSig(t,e,r,n){const s=[];if(e.tapInternalKey){const c=getPrevoutTaprootKey(t,e,n);c&&s.push(c)}if(e.tapScriptSig){const c=e.tapScriptSig.map(u=>u.pubkey);s.push(...c)}return s.map(c=>getTaprootHashesForSig(t,e,r,c,n)).flat()}function getPrevoutTaprootKey(t,e,r){const{script:n}=getScriptAndAmountFromUtxo(t,e,r);return isP2TR(n)?n.subarray(2,34):null}function trimTaprootSig(t){return t.length===64?t:t.subarray(0,64)}function getTaprootHashesForSig(t,e,r,n,s,o,c){const u=s.__TX,f=e.sighashType||Transaction.SIGHASH_DEFAULT;checkSighashTypeAllowed(f,c);const x=r.map((R,D)=>getScriptAndAmountFromUtxo(D,R,s)),p=x.map(R=>R.script),g=x.map(R=>R.value),y=[];if(e.tapInternalKey&&!o){const R=getPrevoutTaprootKey(t,e,s)||Uint8Array.from([]);if(compare(toXOnly$1(n),R)===0){const D=u.hashForWitnessV1(t,p,g,f);y.push({pubkey:n,hash:D})}}const b=(e.tapLeafScript||[]).filter(R=>pubkeyInScript(n,R.script)).map(R=>{const D=tapleafHash({output:R.script,version:R.leafVersion});return Object.assign({hash:D},R)}).filter(R=>!o||compare(o,R.hash)===0).map(R=>{const D=u.hashForWitnessV1(t,p,g,f,R.hash);return{pubkey:n,hash:D,leafHash:R.hash}});return y.concat(b)}function checkSighashTypeAllowed(t,e){if(e&&e.indexOf(t)<0){const r=sighashTypeToString(t);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${r}`)}}function getPayment(t,e,r){let n;switch(e){case"multisig":const s=getSortedSigs(t,r);n=p2ms({output:t,signatures:s});break;case"pubkey":n=p2pk({output:t,signature:r[0].signature});break;case"pubkeyhash":n=p2pkh({output:t,pubkey:r[0].pubkey,signature:r[0].signature});break;case"witnesspubkeyhash":n=p2wpkh({output:t,pubkey:r[0].pubkey,signature:r[0].signature});break}return n}function getScriptFromInput(t,e,r){const n=r.__TX,s={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(s.isP2SH=!!e.redeemScript,s.isP2WSH=!!e.witnessScript,e.witnessScript)s.script=e.witnessScript;else if(e.redeemScript)s.script=e.redeemScript;else if(e.nonWitnessUtxo){const o=nonWitnessUtxoTxFromCache(r,e,t),c=n.ins[t].index;s.script=o.outs[c].script}else e.witnessUtxo&&(s.script=e.witnessUtxo.script);return(e.witnessScript||isP2WPKH(s.script))&&(s.isSegwit=!0),s}function getSignersFromHD(t,e,r){const n=checkForInput(e,t);if(!n.bip32Derivation||n.bip32Derivation.length===0)throw new Error("Need bip32Derivation to sign with HD");const s=n.bip32Derivation.map(c=>{if(compare(c.masterFingerprint,r.fingerprint)===0)return c}).filter(c=>!!c);if(s.length===0)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return s.map(c=>{const u=r.derivePath(c.path);if(compare(c.pubkey,u.publicKey)!==0)throw new Error("pubkey did not match bip32Derivation");return u})}function getSortedSigs(t,e){return p2ms({output:t}).pubkeys.map(n=>(e.filter(s=>compare(s.pubkey,n)===0)[0]||{}).signature).filter(n=>!!n)}function scriptWitnessToWitnessStack(t){let e=0;function r(c){return e+=c,t.slice(e-c,e)}function n(){const c=decode$f(t,e);return e+=encodingLength(c.bigintValue),c.numberValue}function s(){return r(n())}function o(){const c=n(),u=[];for(let f=0;f<c;f++)u.push(s());return u}return o()}function sighashTypeToString(t){let e=t&Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(t&31){case Transaction.SIGHASH_ALL:e+="SIGHASH_ALL";break;case Transaction.SIGHASH_SINGLE:e+="SIGHASH_SINGLE";break;case Transaction.SIGHASH_NONE:e+="SIGHASH_NONE";break}return e}function addNonWitnessTxCache(t,e,r){t.__NON_WITNESS_UTXO_BUF_CACHE[r]=e.nonWitnessUtxo;const n=Transaction.fromBuffer(e.nonWitnessUtxo);t.__NON_WITNESS_UTXO_TX_CACHE[r]=n;const s=t,o=r;delete e.nonWitnessUtxo,Object.defineProperty(e,"nonWitnessUtxo",{enumerable:!0,get(){const c=s.__NON_WITNESS_UTXO_BUF_CACHE[o],u=s.__NON_WITNESS_UTXO_TX_CACHE[o];if(c!==void 0)return c;{const f=u.toBuffer();return s.__NON_WITNESS_UTXO_BUF_CACHE[o]=f,f}},set(c){s.__NON_WITNESS_UTXO_BUF_CACHE[o]=c}})}function inputFinalizeGetAmts(t,e,r,n){let s=0n;t.forEach((f,x)=>{if(n&&f.finalScriptSig&&(e.ins[x].script=f.finalScriptSig),n&&f.finalScriptWitness&&(e.ins[x].witness=scriptWitnessToWitnessStack(f.finalScriptWitness)),f.witnessUtxo)s+=f.witnessUtxo.value;else if(f.nonWitnessUtxo){const p=nonWitnessUtxoTxFromCache(r,f,x),g=e.ins[x].index,y=p.outs[g];s+=y.value}});const o=e.outs.reduce((f,x)=>f+x.value,0n),c=s-o;if(c<0)throw new Error("Outputs are spending more than Inputs");const u=e.virtualSize();r.__FEE=c,r.__EXTRACTED_TX=e,r.__FEE_RATE=Math.floor(Number(c/BigInt(u)))}function nonWitnessUtxoTxFromCache(t,e,r){const n=t.__NON_WITNESS_UTXO_TX_CACHE;return n[r]||addNonWitnessTxCache(t,e,r),n[r]}function getScriptFromUtxo(t,e,r){const{script:n}=getScriptAndAmountFromUtxo(t,e,r);return n}function getScriptAndAmountFromUtxo(t,e,r){if(e.witnessUtxo!==void 0)return{script:e.witnessUtxo.script,value:e.witnessUtxo.value};if(e.nonWitnessUtxo!==void 0){const s=nonWitnessUtxoTxFromCache(r,e,t).outs[r.__TX.ins[t].index];return{script:s.script,value:s.value}}else throw new Error("Can't find pubkey in input without Utxo data")}function pubkeyInInput(t,e,r,n){const s=getScriptFromUtxo(r,e,n),{meaningfulScript:o}=getMeaningfulScript(s,r,"input",e.redeemScript,e.witnessScript);return pubkeyInScript(t,o)}function pubkeyInOutput(t,e,r,n){const s=n.__TX.outs[r].script,{meaningfulScript:o}=getMeaningfulScript(s,r,"output",e.redeemScript,e.witnessScript);return pubkeyInScript(t,o)}function redeemFromFinalScriptSig(t){if(!t)return;const e=decompile(t);if(!e)return;const r=e[e.length-1];if(!(!(r instanceof Uint8Array)||isPubkeyLike(r)||isSigLike(r)||!decompile(r)))return r}function redeemFromFinalWitnessScript(t){if(!t)return;const e=scriptWitnessToWitnessStack(t),r=e[e.length-1];if(!(isPubkeyLike(r)||!decompile(r)))return r}function compressPubkey(t){if(t.length===65){const e=t[64]&1,r=t.slice(0,33);return r[0]=2|e,r}return t.slice()}function isPubkeyLike(t){return t.length===33&&isCanonicalPubKey(t)}function isSigLike(t){return isCanonicalScriptSignature(t)}function getMeaningfulScript(t,e,r,n,s){const o=isP2SHScript(t),c=o&&n&&isP2WSHScript(n),u=isP2WSHScript(t);if(o&&n===void 0)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((u||c)&&s===void 0)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let f;return c?(f=s,checkRedeemScript(e,t,n,r),checkWitnessScript(e,n,s,r),checkInvalidP2WSH(f)):u?(f=s,checkWitnessScript(e,t,s,r),checkInvalidP2WSH(f)):o?(f=n,checkRedeemScript(e,t,n,r)):f=t,{meaningfulScript:f,type:c?"p2sh-p2wsh":o?"p2sh":u?"p2wsh":"raw"}}function checkInvalidP2WSH(t){if(isP2WPKH(t)||isP2SHScript(t))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function classifyScript(t){return isP2WPKH(t)?"witnesspubkeyhash":isP2PKH(t)?"pubkeyhash":isP2MS(t)?"multisig":isP2PK(t)?"pubkey":"nonstandard"}function range(t){return[...Array(t).keys()]}var dist={},secp256k1={},sha2={},_md={},utils$4={},crypto$1={},hasRequiredCrypto;function requireCrypto(){return hasRequiredCrypto||(hasRequiredCrypto=1,Object.defineProperty(crypto$1,"__esModule",{value:!0}),crypto$1.crypto=void 0,crypto$1.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0),crypto$1}var hasRequiredUtils$4;function requireUtils$4(){return hasRequiredUtils$4||(hasRequiredUtils$4=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.wrapXOFConstructorWithOpts=t.wrapConstructorWithOpts=t.wrapConstructor=t.Hash=t.nextTick=t.swap32IfBE=t.byteSwapIfBE=t.swap8IfBE=t.isLE=void 0,t.isBytes=r,t.anumber=n,t.abytes=s,t.ahash=o,t.aexists=c,t.aoutput=u,t.u8=f,t.u32=x,t.clean=p,t.createView=g,t.rotr=y,t.rotl=b,t.byteSwap=R,t.byteSwap32=D,t.bytesToHex=Fe,t.hexToBytes=ze,t.asyncLoop=W,t.utf8ToBytes=We,t.bytesToUtf8=Xe,t.toBytes=it,t.kdfInputToBytes=Ve,t.concatBytes=v,t.checkOpts=I,t.createHasher=P,t.createOptHasher=_e,t.createXOFer=Le,t.randomBytes=Ye;const e=requireCrypto();function r(je){return je instanceof Uint8Array||ArrayBuffer.isView(je)&&je.constructor.name==="Uint8Array"}function n(je){if(!Number.isSafeInteger(je)||je<0)throw new Error("positive integer expected, got "+je)}function s(je,...K){if(!r(je))throw new Error("Uint8Array expected");if(K.length>0&&!K.includes(je.length))throw new Error("Uint8Array expected of length "+K+", got length="+je.length)}function o(je){if(typeof je!="function"||typeof je.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");n(je.outputLen),n(je.blockLen)}function c(je,K=!0){if(je.destroyed)throw new Error("Hash instance has been destroyed");if(K&&je.finished)throw new Error("Hash#digest() has already been called")}function u(je,K){s(je);const L=K.outputLen;if(je.length<L)throw new Error("digestInto() expects output buffer of length at least "+L)}function f(je){return new Uint8Array(je.buffer,je.byteOffset,je.byteLength)}function x(je){return new Uint32Array(je.buffer,je.byteOffset,Math.floor(je.byteLength/4))}function p(...je){for(let K=0;K<je.length;K++)je[K].fill(0)}function g(je){return new DataView(je.buffer,je.byteOffset,je.byteLength)}function y(je,K){return je<<32-K|je>>>K}function b(je,K){return je<<K|je>>>32-K>>>0}t.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function R(je){return je<<24&4278190080|je<<8&16711680|je>>>8&65280|je>>>24&255}t.swap8IfBE=t.isLE?je=>je:je=>R(je),t.byteSwapIfBE=t.swap8IfBE;function D(je){for(let K=0;K<je.length;K++)je[K]=R(je[K]);return je}t.swap32IfBE=t.isLE?je=>je:D;const k=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Re=Array.from({length:256},(je,K)=>K.toString(16).padStart(2,"0"));function Fe(je){if(s(je),k)return je.toHex();let K="";for(let L=0;L<je.length;L++)K+=Re[je[L]];return K}const O={_0:48,_9:57,A:65,F:70,a:97,f:102};function $e(je){if(je>=O._0&&je<=O._9)return je-O._0;if(je>=O.A&&je<=O.F)return je-(O.A-10);if(je>=O.a&&je<=O.f)return je-(O.a-10)}function ze(je){if(typeof je!="string")throw new Error("hex string expected, got "+typeof je);if(k)return Uint8Array.fromHex(je);const K=je.length,L=K/2;if(K%2)throw new Error("hex string expected, got unpadded hex of length "+K);const st=new Uint8Array(L);for(let dt=0,Je=0;dt<L;dt++,Je+=2){const pt=$e(je.charCodeAt(Je)),rr=$e(je.charCodeAt(Je+1));if(pt===void 0||rr===void 0){const cr=je[Je]+je[Je+1];throw new Error('hex string expected, got non-hex character "'+cr+'" at index '+Je)}st[dt]=pt*16+rr}return st}const q=async()=>{};t.nextTick=q;async function W(je,K,L){let st=Date.now();for(let dt=0;dt<je;dt++){L(dt);const Je=Date.now()-st;Je>=0&&Je<K||(await(0,t.nextTick)(),st+=Je)}}function We(je){if(typeof je!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(je))}function Xe(je){return new TextDecoder().decode(je)}function it(je){return typeof je=="string"&&(je=We(je)),s(je),je}function Ve(je){return typeof je=="string"&&(je=We(je)),s(je),je}function v(...je){let K=0;for(let st=0;st<je.length;st++){const dt=je[st];s(dt),K+=dt.length}const L=new Uint8Array(K);for(let st=0,dt=0;st<je.length;st++){const Je=je[st];L.set(Je,dt),dt+=Je.length}return L}function I(je,K){if(K!==void 0&&{}.toString.call(K)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(je,K)}class Ce{}t.Hash=Ce;function P(je){const K=st=>je().update(it(st)).digest(),L=je();return K.outputLen=L.outputLen,K.blockLen=L.blockLen,K.create=()=>je(),K}function _e(je){const K=(st,dt)=>je(dt).update(it(st)).digest(),L=je({});return K.outputLen=L.outputLen,K.blockLen=L.blockLen,K.create=st=>je(st),K}function Le(je){const K=(st,dt)=>je(dt).update(it(st)).digest(),L=je({});return K.outputLen=L.outputLen,K.blockLen=L.blockLen,K.create=st=>je(st),K}t.wrapConstructor=P,t.wrapConstructorWithOpts=_e,t.wrapXOFConstructorWithOpts=Le;function Ye(je=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(je));if(e.crypto&&typeof e.crypto.randomBytes=="function")return Uint8Array.from(e.crypto.randomBytes(je));throw new Error("crypto.getRandomValues must be defined")}})(utils$4)),utils$4}var hasRequired_md;function require_md(){if(hasRequired_md)return _md;hasRequired_md=1,Object.defineProperty(_md,"__esModule",{value:!0}),_md.SHA512_IV=_md.SHA384_IV=_md.SHA224_IV=_md.SHA256_IV=_md.HashMD=void 0,_md.setBigUint64=e,_md.Chi=r,_md.Maj=n;const t=requireUtils$4();function e(o,c,u,f){if(typeof o.setBigUint64=="function")return o.setBigUint64(c,u,f);const x=BigInt(32),p=BigInt(4294967295),g=Number(u>>x&p),y=Number(u&p),b=f?4:0,R=f?0:4;o.setUint32(c+b,g,f),o.setUint32(c+R,y,f)}function r(o,c,u){return o&c^~o&u}function n(o,c,u){return o&c^o&u^c&u}class s extends t.Hash{constructor(c,u,f,x){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=c,this.outputLen=u,this.padOffset=f,this.isLE=x,this.buffer=new Uint8Array(c),this.view=(0,t.createView)(this.buffer)}update(c){(0,t.aexists)(this),c=(0,t.toBytes)(c),(0,t.abytes)(c);const{view:u,buffer:f,blockLen:x}=this,p=c.length;for(let g=0;g<p;){const y=Math.min(x-this.pos,p-g);if(y===x){const b=(0,t.createView)(c);for(;x<=p-g;g+=x)this.process(b,g);continue}f.set(c.subarray(g,g+y),this.pos),this.pos+=y,g+=y,this.pos===x&&(this.process(u,0),this.pos=0)}return this.length+=c.length,this.roundClean(),this}digestInto(c){(0,t.aexists)(this),(0,t.aoutput)(c,this),this.finished=!0;const{buffer:u,view:f,blockLen:x,isLE:p}=this;let{pos:g}=this;u[g++]=128,(0,t.clean)(this.buffer.subarray(g)),this.padOffset>x-g&&(this.process(f,0),g=0);for(let k=g;k<x;k++)u[k]=0;e(f,x-8,BigInt(this.length*8),p),this.process(f,0);const y=(0,t.createView)(c),b=this.outputLen;if(b%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const R=b/4,D=this.get();if(R>D.length)throw new Error("_sha2: outputLen bigger than state");for(let k=0;k<R;k++)y.setUint32(4*k,D[k],p)}digest(){const{buffer:c,outputLen:u}=this;this.digestInto(c);const f=c.slice(0,u);return this.destroy(),f}_cloneInto(c){c||(c=new this.constructor),c.set(...this.get());const{blockLen:u,buffer:f,length:x,finished:p,destroyed:g,pos:y}=this;return c.destroyed=g,c.finished=p,c.length=x,c.pos=y,x%u&&c.buffer.set(f),c}clone(){return this._cloneInto()}}return _md.HashMD=s,_md.SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),_md.SHA224_IV=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),_md.SHA384_IV=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),_md.SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),_md}var _u64={},hasRequired_u64;function require_u64(){if(hasRequired_u64)return _u64;hasRequired_u64=1,Object.defineProperty(_u64,"__esModule",{value:!0}),_u64.toBig=_u64.shrSL=_u64.shrSH=_u64.rotrSL=_u64.rotrSH=_u64.rotrBL=_u64.rotrBH=_u64.rotr32L=_u64.rotr32H=_u64.rotlSL=_u64.rotlSH=_u64.rotlBL=_u64.rotlBH=_u64.add5L=_u64.add5H=_u64.add4L=_u64.add4H=_u64.add3L=_u64.add3H=void 0,_u64.add=Re,_u64.fromBig=r,_u64.split=n;const t=BigInt(2**32-1),e=BigInt(32);function r(Xe,it=!1){return it?{h:Number(Xe&t),l:Number(Xe>>e&t)}:{h:Number(Xe>>e&t)|0,l:Number(Xe&t)|0}}function n(Xe,it=!1){const Ve=Xe.length;let v=new Uint32Array(Ve),I=new Uint32Array(Ve);for(let Ce=0;Ce<Ve;Ce++){const{h:P,l:_e}=r(Xe[Ce],it);[v[Ce],I[Ce]]=[P,_e]}return[v,I]}const s=(Xe,it)=>BigInt(Xe>>>0)<<e|BigInt(it>>>0);_u64.toBig=s;const o=(Xe,it,Ve)=>Xe>>>Ve;_u64.shrSH=o;const c=(Xe,it,Ve)=>Xe<<32-Ve|it>>>Ve;_u64.shrSL=c;const u=(Xe,it,Ve)=>Xe>>>Ve|it<<32-Ve;_u64.rotrSH=u;const f=(Xe,it,Ve)=>Xe<<32-Ve|it>>>Ve;_u64.rotrSL=f;const x=(Xe,it,Ve)=>Xe<<64-Ve|it>>>Ve-32;_u64.rotrBH=x;const p=(Xe,it,Ve)=>Xe>>>Ve-32|it<<64-Ve;_u64.rotrBL=p;const g=(Xe,it)=>it;_u64.rotr32H=g;const y=(Xe,it)=>Xe;_u64.rotr32L=y;const b=(Xe,it,Ve)=>Xe<<Ve|it>>>32-Ve;_u64.rotlSH=b;const R=(Xe,it,Ve)=>it<<Ve|Xe>>>32-Ve;_u64.rotlSL=R;const D=(Xe,it,Ve)=>it<<Ve-32|Xe>>>64-Ve;_u64.rotlBH=D;const k=(Xe,it,Ve)=>Xe<<Ve-32|it>>>64-Ve;_u64.rotlBL=k;function Re(Xe,it,Ve,v){const I=(it>>>0)+(v>>>0);return{h:Xe+Ve+(I/2**32|0)|0,l:I|0}}const Fe=(Xe,it,Ve)=>(Xe>>>0)+(it>>>0)+(Ve>>>0);_u64.add3L=Fe;const O=(Xe,it,Ve,v)=>it+Ve+v+(Xe/2**32|0)|0;_u64.add3H=O;const $e=(Xe,it,Ve,v)=>(Xe>>>0)+(it>>>0)+(Ve>>>0)+(v>>>0);_u64.add4L=$e;const ze=(Xe,it,Ve,v,I)=>it+Ve+v+I+(Xe/2**32|0)|0;_u64.add4H=ze;const q=(Xe,it,Ve,v,I)=>(Xe>>>0)+(it>>>0)+(Ve>>>0)+(v>>>0)+(I>>>0);_u64.add5L=q;const W=(Xe,it,Ve,v,I,Ce)=>it+Ve+v+I+Ce+(Xe/2**32|0)|0;_u64.add5H=W;const We={fromBig:r,split:n,toBig:s,shrSH:o,shrSL:c,rotrSH:u,rotrSL:f,rotrBH:x,rotrBL:p,rotr32H:g,rotr32L:y,rotlSH:b,rotlSL:R,rotlBH:D,rotlBL:k,add:Re,add3L:Fe,add3H:O,add4L:$e,add4H:ze,add5H:W,add5L:q};return _u64.default=We,_u64}var hasRequiredSha2;function requireSha2(){if(hasRequiredSha2)return sha2;hasRequiredSha2=1,Object.defineProperty(sha2,"__esModule",{value:!0}),sha2.sha512_224=sha2.sha512_256=sha2.sha384=sha2.sha512=sha2.sha224=sha2.sha256=sha2.SHA512_256=sha2.SHA512_224=sha2.SHA384=sha2.SHA512=sha2.SHA224=sha2.SHA256=void 0;const t=require_md(),e=require_u64(),r=requireUtils$4(),n=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),s=new Uint32Array(64);class o extends t.HashMD{constructor(O=32){super(64,O,8,!1),this.A=t.SHA256_IV[0]|0,this.B=t.SHA256_IV[1]|0,this.C=t.SHA256_IV[2]|0,this.D=t.SHA256_IV[3]|0,this.E=t.SHA256_IV[4]|0,this.F=t.SHA256_IV[5]|0,this.G=t.SHA256_IV[6]|0,this.H=t.SHA256_IV[7]|0}get(){const{A:O,B:$e,C:ze,D:q,E:W,F:We,G:Xe,H:it}=this;return[O,$e,ze,q,W,We,Xe,it]}set(O,$e,ze,q,W,We,Xe,it){this.A=O|0,this.B=$e|0,this.C=ze|0,this.D=q|0,this.E=W|0,this.F=We|0,this.G=Xe|0,this.H=it|0}process(O,$e){for(let I=0;I<16;I++,$e+=4)s[I]=O.getUint32($e,!1);for(let I=16;I<64;I++){const Ce=s[I-15],P=s[I-2],_e=(0,r.rotr)(Ce,7)^(0,r.rotr)(Ce,18)^Ce>>>3,Le=(0,r.rotr)(P,17)^(0,r.rotr)(P,19)^P>>>10;s[I]=Le+s[I-7]+_e+s[I-16]|0}let{A:ze,B:q,C:W,D:We,E:Xe,F:it,G:Ve,H:v}=this;for(let I=0;I<64;I++){const Ce=(0,r.rotr)(Xe,6)^(0,r.rotr)(Xe,11)^(0,r.rotr)(Xe,25),P=v+Ce+(0,t.Chi)(Xe,it,Ve)+n[I]+s[I]|0,Le=((0,r.rotr)(ze,2)^(0,r.rotr)(ze,13)^(0,r.rotr)(ze,22))+(0,t.Maj)(ze,q,W)|0;v=Ve,Ve=it,it=Xe,Xe=We+P|0,We=W,W=q,q=ze,ze=P+Le|0}ze=ze+this.A|0,q=q+this.B|0,W=W+this.C|0,We=We+this.D|0,Xe=Xe+this.E|0,it=it+this.F|0,Ve=Ve+this.G|0,v=v+this.H|0,this.set(ze,q,W,We,Xe,it,Ve,v)}roundClean(){(0,r.clean)(s)}destroy(){this.set(0,0,0,0,0,0,0,0),(0,r.clean)(this.buffer)}}sha2.SHA256=o;class c extends o{constructor(){super(28),this.A=t.SHA224_IV[0]|0,this.B=t.SHA224_IV[1]|0,this.C=t.SHA224_IV[2]|0,this.D=t.SHA224_IV[3]|0,this.E=t.SHA224_IV[4]|0,this.F=t.SHA224_IV[5]|0,this.G=t.SHA224_IV[6]|0,this.H=t.SHA224_IV[7]|0}}sha2.SHA224=c;const u=e.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(Fe=>BigInt(Fe))),f=u[0],x=u[1],p=new Uint32Array(80),g=new Uint32Array(80);class y extends t.HashMD{constructor(O=64){super(128,O,16,!1),this.Ah=t.SHA512_IV[0]|0,this.Al=t.SHA512_IV[1]|0,this.Bh=t.SHA512_IV[2]|0,this.Bl=t.SHA512_IV[3]|0,this.Ch=t.SHA512_IV[4]|0,this.Cl=t.SHA512_IV[5]|0,this.Dh=t.SHA512_IV[6]|0,this.Dl=t.SHA512_IV[7]|0,this.Eh=t.SHA512_IV[8]|0,this.El=t.SHA512_IV[9]|0,this.Fh=t.SHA512_IV[10]|0,this.Fl=t.SHA512_IV[11]|0,this.Gh=t.SHA512_IV[12]|0,this.Gl=t.SHA512_IV[13]|0,this.Hh=t.SHA512_IV[14]|0,this.Hl=t.SHA512_IV[15]|0}get(){const{Ah:O,Al:$e,Bh:ze,Bl:q,Ch:W,Cl:We,Dh:Xe,Dl:it,Eh:Ve,El:v,Fh:I,Fl:Ce,Gh:P,Gl:_e,Hh:Le,Hl:Ye}=this;return[O,$e,ze,q,W,We,Xe,it,Ve,v,I,Ce,P,_e,Le,Ye]}set(O,$e,ze,q,W,We,Xe,it,Ve,v,I,Ce,P,_e,Le,Ye){this.Ah=O|0,this.Al=$e|0,this.Bh=ze|0,this.Bl=q|0,this.Ch=W|0,this.Cl=We|0,this.Dh=Xe|0,this.Dl=it|0,this.Eh=Ve|0,this.El=v|0,this.Fh=I|0,this.Fl=Ce|0,this.Gh=P|0,this.Gl=_e|0,this.Hh=Le|0,this.Hl=Ye|0}process(O,$e){for(let L=0;L<16;L++,$e+=4)p[L]=O.getUint32($e),g[L]=O.getUint32($e+=4);for(let L=16;L<80;L++){const st=p[L-15]|0,dt=g[L-15]|0,Je=e.rotrSH(st,dt,1)^e.rotrSH(st,dt,8)^e.shrSH(st,dt,7),pt=e.rotrSL(st,dt,1)^e.rotrSL(st,dt,8)^e.shrSL(st,dt,7),rr=p[L-2]|0,cr=g[L-2]|0,fr=e.rotrSH(rr,cr,19)^e.rotrBH(rr,cr,61)^e.shrSH(rr,cr,6),ir=e.rotrSL(rr,cr,19)^e.rotrBL(rr,cr,61)^e.shrSL(rr,cr,6),ft=e.add4L(pt,ir,g[L-7],g[L-16]),nr=e.add4H(ft,Je,fr,p[L-7],p[L-16]);p[L]=nr|0,g[L]=ft|0}let{Ah:ze,Al:q,Bh:W,Bl:We,Ch:Xe,Cl:it,Dh:Ve,Dl:v,Eh:I,El:Ce,Fh:P,Fl:_e,Gh:Le,Gl:Ye,Hh:je,Hl:K}=this;for(let L=0;L<80;L++){const st=e.rotrSH(I,Ce,14)^e.rotrSH(I,Ce,18)^e.rotrBH(I,Ce,41),dt=e.rotrSL(I,Ce,14)^e.rotrSL(I,Ce,18)^e.rotrBL(I,Ce,41),Je=I&P^~I&Le,pt=Ce&_e^~Ce&Ye,rr=e.add5L(K,dt,pt,x[L],g[L]),cr=e.add5H(rr,je,st,Je,f[L],p[L]),fr=rr|0,ir=e.rotrSH(ze,q,28)^e.rotrBH(ze,q,34)^e.rotrBH(ze,q,39),ft=e.rotrSL(ze,q,28)^e.rotrBL(ze,q,34)^e.rotrBL(ze,q,39),nr=ze&W^ze&Xe^W&Xe,lr=q&We^q&it^We&it;je=Le|0,K=Ye|0,Le=P|0,Ye=_e|0,P=I|0,_e=Ce|0,{h:I,l:Ce}=e.add(Ve|0,v|0,cr|0,fr|0),Ve=Xe|0,v=it|0,Xe=W|0,it=We|0,W=ze|0,We=q|0;const er=e.add3L(fr,ft,lr);ze=e.add3H(er,cr,ir,nr),q=er|0}({h:ze,l:q}=e.add(this.Ah|0,this.Al|0,ze|0,q|0)),{h:W,l:We}=e.add(this.Bh|0,this.Bl|0,W|0,We|0),{h:Xe,l:it}=e.add(this.Ch|0,this.Cl|0,Xe|0,it|0),{h:Ve,l:v}=e.add(this.Dh|0,this.Dl|0,Ve|0,v|0),{h:I,l:Ce}=e.add(this.Eh|0,this.El|0,I|0,Ce|0),{h:P,l:_e}=e.add(this.Fh|0,this.Fl|0,P|0,_e|0),{h:Le,l:Ye}=e.add(this.Gh|0,this.Gl|0,Le|0,Ye|0),{h:je,l:K}=e.add(this.Hh|0,this.Hl|0,je|0,K|0),this.set(ze,q,W,We,Xe,it,Ve,v,I,Ce,P,_e,Le,Ye,je,K)}roundClean(){(0,r.clean)(p,g)}destroy(){(0,r.clean)(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}sha2.SHA512=y;class b extends y{constructor(){super(48),this.Ah=t.SHA384_IV[0]|0,this.Al=t.SHA384_IV[1]|0,this.Bh=t.SHA384_IV[2]|0,this.Bl=t.SHA384_IV[3]|0,this.Ch=t.SHA384_IV[4]|0,this.Cl=t.SHA384_IV[5]|0,this.Dh=t.SHA384_IV[6]|0,this.Dl=t.SHA384_IV[7]|0,this.Eh=t.SHA384_IV[8]|0,this.El=t.SHA384_IV[9]|0,this.Fh=t.SHA384_IV[10]|0,this.Fl=t.SHA384_IV[11]|0,this.Gh=t.SHA384_IV[12]|0,this.Gl=t.SHA384_IV[13]|0,this.Hh=t.SHA384_IV[14]|0,this.Hl=t.SHA384_IV[15]|0}}sha2.SHA384=b;const R=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),D=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class k extends y{constructor(){super(28),this.Ah=R[0]|0,this.Al=R[1]|0,this.Bh=R[2]|0,this.Bl=R[3]|0,this.Ch=R[4]|0,this.Cl=R[5]|0,this.Dh=R[6]|0,this.Dl=R[7]|0,this.Eh=R[8]|0,this.El=R[9]|0,this.Fh=R[10]|0,this.Fl=R[11]|0,this.Gh=R[12]|0,this.Gl=R[13]|0,this.Hh=R[14]|0,this.Hl=R[15]|0}}sha2.SHA512_224=k;class Re extends y{constructor(){super(32),this.Ah=D[0]|0,this.Al=D[1]|0,this.Bh=D[2]|0,this.Bl=D[3]|0,this.Ch=D[4]|0,this.Cl=D[5]|0,this.Dh=D[6]|0,this.Dl=D[7]|0,this.Eh=D[8]|0,this.El=D[9]|0,this.Fh=D[10]|0,this.Fl=D[11]|0,this.Gh=D[12]|0,this.Gl=D[13]|0,this.Hh=D[14]|0,this.Hl=D[15]|0}}return sha2.SHA512_256=Re,sha2.sha256=(0,r.createHasher)(()=>new o),sha2.sha224=(0,r.createHasher)(()=>new c),sha2.sha512=(0,r.createHasher)(()=>new y),sha2.sha384=(0,r.createHasher)(()=>new b),sha2.sha512_256=(0,r.createHasher)(()=>new Re),sha2.sha512_224=(0,r.createHasher)(()=>new k),sha2}var _shortw_utils={},weierstrass={},hmac={},hasRequiredHmac;function requireHmac(){return hasRequiredHmac||(hasRequiredHmac=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.hmac=t.HMAC=void 0;const e=requireUtils$4();class r extends e.Hash{constructor(o,c){super(),this.finished=!1,this.destroyed=!1,(0,e.ahash)(o);const u=(0,e.toBytes)(c);if(this.iHash=o.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const f=this.blockLen,x=new Uint8Array(f);x.set(u.length>f?o.create().update(u).digest():u);for(let p=0;p<x.length;p++)x[p]^=54;this.iHash.update(x),this.oHash=o.create();for(let p=0;p<x.length;p++)x[p]^=106;this.oHash.update(x),(0,e.clean)(x)}update(o){return(0,e.aexists)(this),this.iHash.update(o),this}digestInto(o){(0,e.aexists)(this),(0,e.abytes)(o,this.outputLen),this.finished=!0,this.iHash.digestInto(o),this.oHash.update(o),this.oHash.digestInto(o),this.destroy()}digest(){const o=new Uint8Array(this.oHash.outputLen);return this.digestInto(o),o}_cloneInto(o){o||(o=Object.create(Object.getPrototypeOf(this),{}));const{oHash:c,iHash:u,finished:f,destroyed:x,blockLen:p,outputLen:g}=this;return o=o,o.finished=f,o.destroyed=x,o.blockLen=p,o.outputLen=g,o.oHash=c._cloneInto(o.oHash),o.iHash=u._cloneInto(o.iHash),o}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}t.HMAC=r;const n=(s,o,c)=>new r(s,o).update(c).digest();t.hmac=n,t.hmac.create=(s,o)=>new r(s,o)})(hmac)),hmac}var utils$3={},hasRequiredUtils$3;function requireUtils$3(){return hasRequiredUtils$3||(hasRequiredUtils$3=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.notImplemented=t.bitMask=t.utf8ToBytes=t.randomBytes=t.isBytes=t.hexToBytes=t.concatBytes=t.bytesToUtf8=t.bytesToHex=t.anumber=t.abytes=void 0,t.abool=o,t._abool2=c,t._abytes2=u,t.numberToHexUnpadded=f,t.hexToNumber=x,t.bytesToNumberBE=p,t.bytesToNumberLE=g,t.numberToBytesBE=y,t.numberToBytesLE=b,t.numberToVarBytesBE=R,t.ensureBytes=D,t.equalBytes=k,t.copyBytes=Re,t.asciiToBytes=Fe,t.inRange=$e,t.aInRange=ze,t.bitLen=q,t.bitGet=W,t.bitSet=We,t.createHmacDrbg=it,t.validateObject=v,t.isHash=I,t._validateObject=Ce,t.memoized=_e;const e=requireUtils$4();var r=requireUtils$4();Object.defineProperty(t,"abytes",{enumerable:!0,get:function(){return r.abytes}}),Object.defineProperty(t,"anumber",{enumerable:!0,get:function(){return r.anumber}}),Object.defineProperty(t,"bytesToHex",{enumerable:!0,get:function(){return r.bytesToHex}}),Object.defineProperty(t,"bytesToUtf8",{enumerable:!0,get:function(){return r.bytesToUtf8}}),Object.defineProperty(t,"concatBytes",{enumerable:!0,get:function(){return r.concatBytes}}),Object.defineProperty(t,"hexToBytes",{enumerable:!0,get:function(){return r.hexToBytes}}),Object.defineProperty(t,"isBytes",{enumerable:!0,get:function(){return r.isBytes}}),Object.defineProperty(t,"randomBytes",{enumerable:!0,get:function(){return r.randomBytes}}),Object.defineProperty(t,"utf8ToBytes",{enumerable:!0,get:function(){return r.utf8ToBytes}});const n=BigInt(0),s=BigInt(1);function o(Le,Ye){if(typeof Ye!="boolean")throw new Error(Le+" boolean expected, got "+Ye)}function c(Le,Ye=""){if(typeof Le!="boolean"){const je=Ye&&`"${Ye}"`;throw new Error(je+"expected boolean, got type="+typeof Le)}return Le}function u(Le,Ye,je=""){const K=(0,e.isBytes)(Le),L=Le?.length,st=Ye!==void 0;if(!K||st&&L!==Ye){const dt=je&&`"${je}" `,Je=st?` of length ${Ye}`:"",pt=K?`length=${L}`:`type=${typeof Le}`;throw new Error(dt+"expected Uint8Array"+Je+", got "+pt)}return Le}function f(Le){const Ye=Le.toString(16);return Ye.length&1?"0"+Ye:Ye}function x(Le){if(typeof Le!="string")throw new Error("hex string expected, got "+typeof Le);return Le===""?n:BigInt("0x"+Le)}function p(Le){return x((0,e.bytesToHex)(Le))}function g(Le){return(0,e.abytes)(Le),x((0,e.bytesToHex)(Uint8Array.from(Le).reverse()))}function y(Le,Ye){return(0,e.hexToBytes)(Le.toString(16).padStart(Ye*2,"0"))}function b(Le,Ye){return y(Le,Ye).reverse()}function R(Le){return(0,e.hexToBytes)(f(Le))}function D(Le,Ye,je){let K;if(typeof Ye=="string")try{K=(0,e.hexToBytes)(Ye)}catch(st){throw new Error(Le+" must be hex string or Uint8Array, cause: "+st)}else if((0,e.isBytes)(Ye))K=Uint8Array.from(Ye);else throw new Error(Le+" must be hex string or Uint8Array");const L=K.length;if(typeof je=="number"&&L!==je)throw new Error(Le+" of length "+je+" expected, got "+L);return K}function k(Le,Ye){if(Le.length!==Ye.length)return!1;let je=0;for(let K=0;K<Le.length;K++)je|=Le[K]^Ye[K];return je===0}function Re(Le){return Uint8Array.from(Le)}function Fe(Le){return Uint8Array.from(Le,(Ye,je)=>{const K=Ye.charCodeAt(0);if(Ye.length!==1||K>127)throw new Error(`string contains non-ASCII character "${Le[je]}" with code ${K} at position ${je}`);return K})}const O=Le=>typeof Le=="bigint"&&n<=Le;function $e(Le,Ye,je){return O(Le)&&O(Ye)&&O(je)&&Ye<=Le&&Le<je}function ze(Le,Ye,je,K){if(!$e(Ye,je,K))throw new Error("expected valid "+Le+": "+je+" <= n < "+K+", got "+Ye)}function q(Le){let Ye;for(Ye=0;Le>n;Le>>=s,Ye+=1);return Ye}function W(Le,Ye){return Le>>BigInt(Ye)&s}function We(Le,Ye,je){return Le|(je?s:n)<<BigInt(Ye)}const Xe=Le=>(s<<BigInt(Le))-s;t.bitMask=Xe;function it(Le,Ye,je){if(typeof Le!="number"||Le<2)throw new Error("hashLen must be a number");if(typeof Ye!="number"||Ye<2)throw new Error("qByteLen must be a number");if(typeof je!="function")throw new Error("hmacFn must be a function");const K=ft=>new Uint8Array(ft),L=ft=>Uint8Array.of(ft);let st=K(Le),dt=K(Le),Je=0;const pt=()=>{st.fill(1),dt.fill(0),Je=0},rr=(...ft)=>je(dt,st,...ft),cr=(ft=K(0))=>{dt=rr(L(0),ft),st=rr(),ft.length!==0&&(dt=rr(L(1),ft),st=rr())},fr=()=>{if(Je++>=1e3)throw new Error("drbg: tried 1000 values");let ft=0;const nr=[];for(;ft<Ye;){st=rr();const lr=st.slice();nr.push(lr),ft+=st.length}return(0,e.concatBytes)(...nr)};return(ft,nr)=>{pt(),cr(ft);let lr;for(;!(lr=nr(fr()));)cr();return pt(),lr}}const Ve={bigint:Le=>typeof Le=="bigint",function:Le=>typeof Le=="function",boolean:Le=>typeof Le=="boolean",string:Le=>typeof Le=="string",stringOrUint8Array:Le=>typeof Le=="string"||(0,e.isBytes)(Le),isSafeInteger:Le=>Number.isSafeInteger(Le),array:Le=>Array.isArray(Le),field:(Le,Ye)=>Ye.Fp.isValid(Le),hash:Le=>typeof Le=="function"&&Number.isSafeInteger(Le.outputLen)};function v(Le,Ye,je={}){const K=(L,st,dt)=>{const Je=Ve[st];if(typeof Je!="function")throw new Error("invalid validator function");const pt=Le[L];if(!(dt&&pt===void 0)&&!Je(pt,Le))throw new Error("param "+String(L)+" is invalid. Expected "+st+", got "+pt)};for(const[L,st]of Object.entries(Ye))K(L,st,!1);for(const[L,st]of Object.entries(je))K(L,st,!0);return Le}function I(Le){return typeof Le=="function"&&Number.isSafeInteger(Le.outputLen)}function Ce(Le,Ye,je={}){if(!Le||typeof Le!="object")throw new Error("expected valid options object");function K(L,st,dt){const Je=Le[L];if(dt&&Je===void 0)return;const pt=typeof Je;if(pt!==st||Je===null)throw new Error(`param "${L}" is invalid: expected ${st}, got ${pt}`)}Object.entries(Ye).forEach(([L,st])=>K(L,st,!1)),Object.entries(je).forEach(([L,st])=>K(L,st,!0))}const P=()=>{throw new Error("not implemented")};t.notImplemented=P;function _e(Le){const Ye=new WeakMap;return(je,...K)=>{const L=Ye.get(je);if(L!==void 0)return L;const st=Le(je,...K);return Ye.set(je,st),st}}})(utils$3)),utils$3}var curve={},modular={},hasRequiredModular;function requireModular(){if(hasRequiredModular)return modular;hasRequiredModular=1,Object.defineProperty(modular,"__esModule",{value:!0}),modular.isNegativeLE=void 0,modular.mod=g,modular.pow=y,modular.pow2=b,modular.invert=R,modular.tonelliShanks=O,modular.FpSqrt=$e,modular.validateField=W,modular.FpPow=We,modular.FpInvertBatch=Xe,modular.FpDiv=it,modular.FpLegendre=Ve,modular.FpIsSquare=v,modular.nLength=I,modular.Field=Ce,modular.FpSqrtOdd=P,modular.FpSqrtEven=_e,modular.hashToPrivateScalar=Le,modular.getFieldBytesLength=Ye,modular.getMinHashLength=je,modular.mapHashToField=K;const t=requireUtils$3(),e=BigInt(0),r=BigInt(1),n=BigInt(2),s=BigInt(3),o=BigInt(4),c=BigInt(5),u=BigInt(7),f=BigInt(8),x=BigInt(9),p=BigInt(16);function g(L,st){const dt=L%st;return dt>=e?dt:st+dt}function y(L,st,dt){return We(Ce(dt),L,st)}function b(L,st,dt){let Je=L;for(;st-- >e;)Je*=Je,Je%=dt;return Je}function R(L,st){if(L===e)throw new Error("invert: expected non-zero number");if(st<=e)throw new Error("invert: expected positive modulus, got "+st);let dt=g(L,st),Je=st,pt=e,rr=r;for(;dt!==e;){const fr=Je/dt,ir=Je%dt,ft=pt-rr*fr;Je=dt,dt=ir,pt=rr,rr=ft}if(Je!==r)throw new Error("invert: does not exist");return g(pt,st)}function D(L,st,dt){if(!L.eql(L.sqr(st),dt))throw new Error("Cannot find square root")}function k(L,st){const dt=(L.ORDER+r)/o,Je=L.pow(st,dt);return D(L,Je,st),Je}function Re(L,st){const dt=(L.ORDER-c)/f,Je=L.mul(st,n),pt=L.pow(Je,dt),rr=L.mul(st,pt),cr=L.mul(L.mul(rr,n),pt),fr=L.mul(rr,L.sub(cr,L.ONE));return D(L,fr,st),fr}function Fe(L){const st=Ce(L),dt=O(L),Je=dt(st,st.neg(st.ONE)),pt=dt(st,Je),rr=dt(st,st.neg(Je)),cr=(L+u)/p;return(fr,ir)=>{let ft=fr.pow(ir,cr),nr=fr.mul(ft,Je);const lr=fr.mul(ft,pt),er=fr.mul(ft,rr),pr=fr.eql(fr.sqr(nr),ir),Er=fr.eql(fr.sqr(lr),ir);ft=fr.cmov(ft,nr,pr),nr=fr.cmov(er,lr,Er);const xr=fr.eql(fr.sqr(nr),ir),wr=fr.cmov(ft,nr,xr);return D(fr,wr,ir),wr}}function O(L){if(L<s)throw new Error("sqrt is not defined for small field");let st=L-r,dt=0;for(;st%n===e;)st/=n,dt++;let Je=n;const pt=Ce(L);for(;Ve(pt,Je)===1;)if(Je++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(dt===1)return k;let rr=pt.pow(Je,st);const cr=(st+r)/n;return function(ir,ft){if(ir.is0(ft))return ft;if(Ve(ir,ft)!==1)throw new Error("Cannot find square root");let nr=dt,lr=ir.mul(ir.ONE,rr),er=ir.pow(ft,st),pr=ir.pow(ft,cr);for(;!ir.eql(er,ir.ONE);){if(ir.is0(er))return ir.ZERO;let Er=1,xr=ir.sqr(er);for(;!ir.eql(xr,ir.ONE);)if(Er++,xr=ir.sqr(xr),Er===nr)throw new Error("Cannot find square root");const wr=r<<BigInt(nr-Er-1),Br=ir.pow(lr,wr);nr=Er,lr=ir.sqr(Br),er=ir.mul(er,lr),pr=ir.mul(pr,Br)}return pr}}function $e(L){return L%o===s?k:L%f===c?Re:L%p===x?Fe(L):O(L)}const ze=(L,st)=>(g(L,st)&r)===r;modular.isNegativeLE=ze;const q=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function W(L){const st={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},dt=q.reduce((Je,pt)=>(Je[pt]="function",Je),st);return(0,t._validateObject)(L,dt),L}function We(L,st,dt){if(dt<e)throw new Error("invalid exponent, negatives unsupported");if(dt===e)return L.ONE;if(dt===r)return st;let Je=L.ONE,pt=st;for(;dt>e;)dt&r&&(Je=L.mul(Je,pt)),pt=L.sqr(pt),dt>>=r;return Je}function Xe(L,st,dt=!1){const Je=new Array(st.length).fill(dt?L.ZERO:void 0),pt=st.reduce((cr,fr,ir)=>L.is0(fr)?cr:(Je[ir]=cr,L.mul(cr,fr)),L.ONE),rr=L.inv(pt);return st.reduceRight((cr,fr,ir)=>L.is0(fr)?cr:(Je[ir]=L.mul(cr,Je[ir]),L.mul(cr,fr)),rr),Je}function it(L,st,dt){return L.mul(st,typeof dt=="bigint"?R(dt,L.ORDER):L.inv(dt))}function Ve(L,st){const dt=(L.ORDER-r)/n,Je=L.pow(st,dt),pt=L.eql(Je,L.ONE),rr=L.eql(Je,L.ZERO),cr=L.eql(Je,L.neg(L.ONE));if(!pt&&!rr&&!cr)throw new Error("invalid Legendre symbol result");return pt?1:rr?0:-1}function v(L,st){return Ve(L,st)===1}function I(L,st){st!==void 0&&(0,t.anumber)(st);const dt=st!==void 0?st:L.toString(2).length,Je=Math.ceil(dt/8);return{nBitLength:dt,nByteLength:Je}}function Ce(L,st,dt=!1,Je={}){if(L<=e)throw new Error("invalid field: expected ORDER > 0, got "+L);let pt,rr,cr=!1,fr;if(typeof st=="object"&&st!=null){if(Je.sqrt||dt)throw new Error("cannot specify opts in two arguments");const er=st;er.BITS&&(pt=er.BITS),er.sqrt&&(rr=er.sqrt),typeof er.isLE=="boolean"&&(dt=er.isLE),typeof er.modFromBytes=="boolean"&&(cr=er.modFromBytes),fr=er.allowedLengths}else typeof st=="number"&&(pt=st),Je.sqrt&&(rr=Je.sqrt);const{nBitLength:ir,nByteLength:ft}=I(L,pt);if(ft>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let nr;const lr=Object.freeze({ORDER:L,isLE:dt,BITS:ir,BYTES:ft,MASK:(0,t.bitMask)(ir),ZERO:e,ONE:r,allowedLengths:fr,create:er=>g(er,L),isValid:er=>{if(typeof er!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof er);return e<=er&&er<L},is0:er=>er===e,isValidNot0:er=>!lr.is0(er)&&lr.isValid(er),isOdd:er=>(er&r)===r,neg:er=>g(-er,L),eql:(er,pr)=>er===pr,sqr:er=>g(er*er,L),add:(er,pr)=>g(er+pr,L),sub:(er,pr)=>g(er-pr,L),mul:(er,pr)=>g(er*pr,L),pow:(er,pr)=>We(lr,er,pr),div:(er,pr)=>g(er*R(pr,L),L),sqrN:er=>er*er,addN:(er,pr)=>er+pr,subN:(er,pr)=>er-pr,mulN:(er,pr)=>er*pr,inv:er=>R(er,L),sqrt:rr||(er=>(nr||(nr=$e(L)),nr(lr,er))),toBytes:er=>dt?(0,t.numberToBytesLE)(er,ft):(0,t.numberToBytesBE)(er,ft),fromBytes:(er,pr=!0)=>{if(fr){if(!fr.includes(er.length)||er.length>ft)throw new Error("Field.fromBytes: expected "+fr+" bytes, got "+er.length);const xr=new Uint8Array(ft);xr.set(er,dt?0:xr.length-er.length),er=xr}if(er.length!==ft)throw new Error("Field.fromBytes: expected "+ft+" bytes, got "+er.length);let Er=dt?(0,t.bytesToNumberLE)(er):(0,t.bytesToNumberBE)(er);if(cr&&(Er=g(Er,L)),!pr&&!lr.isValid(Er))throw new Error("invalid field element: outside of range 0..ORDER");return Er},invertBatch:er=>Xe(lr,er),cmov:(er,pr,Er)=>Er?pr:er});return Object.freeze(lr)}function P(L,st){if(!L.isOdd)throw new Error("Field doesn't have isOdd");const dt=L.sqrt(st);return L.isOdd(dt)?dt:L.neg(dt)}function _e(L,st){if(!L.isOdd)throw new Error("Field doesn't have isOdd");const dt=L.sqrt(st);return L.isOdd(dt)?L.neg(dt):dt}function Le(L,st,dt=!1){L=(0,t.ensureBytes)("privateHash",L);const Je=L.length,pt=I(st).nByteLength+8;if(pt<24||Je<pt||Je>1024)throw new Error("hashToPrivateScalar: expected "+pt+"-1024 bytes of input, got "+Je);const rr=dt?(0,t.bytesToNumberLE)(L):(0,t.bytesToNumberBE)(L);return g(rr,st-r)+r}function Ye(L){if(typeof L!="bigint")throw new Error("field order must be bigint");const st=L.toString(2).length;return Math.ceil(st/8)}function je(L){const st=Ye(L);return st+Math.ceil(st/2)}function K(L,st,dt=!1){const Je=L.length,pt=Ye(st),rr=je(st);if(Je<16||Je<rr||Je>1024)throw new Error("expected "+rr+"-1024 bytes of input, got "+Je);const cr=dt?(0,t.bytesToNumberLE)(L):(0,t.bytesToNumberBE)(L),fr=g(cr,st-r)+r;return dt?(0,t.numberToBytesLE)(fr,pt):(0,t.numberToBytesBE)(fr,pt)}return modular}var hasRequiredCurve;function requireCurve(){if(hasRequiredCurve)return curve;hasRequiredCurve=1,Object.defineProperty(curve,"__esModule",{value:!0}),curve.wNAF=void 0,curve.negateCt=s,curve.normalizeZ=o,curve.mulEndoUnsafe=k,curve.pippenger=Re,curve.precomputeMSMUnsafe=Fe,curve.validateBasic=O,curve._createCurveFields=ze;const t=requireUtils$3(),e=requireModular(),r=BigInt(0),n=BigInt(1);function s(q,W){const We=W.negate();return q?We:W}function o(q,W){const We=(0,e.FpInvertBatch)(q.Fp,W.map(Xe=>Xe.Z));return W.map((Xe,it)=>q.fromAffine(Xe.toAffine(We[it])))}function c(q,W){if(!Number.isSafeInteger(q)||q<=0||q>W)throw new Error("invalid window size, expected [1.."+W+"], got W="+q)}function u(q,W){c(q,W);const We=Math.ceil(W/q)+1,Xe=2**(q-1),it=2**q,Ve=(0,t.bitMask)(q),v=BigInt(q);return{windows:We,windowSize:Xe,mask:Ve,maxNumber:it,shiftBy:v}}function f(q,W,We){const{windowSize:Xe,mask:it,maxNumber:Ve,shiftBy:v}=We;let I=Number(q&it),Ce=q>>v;I>Xe&&(I-=Ve,Ce+=n);const P=W*Xe,_e=P+Math.abs(I)-1,Le=I===0,Ye=I<0,je=W%2!==0;return{nextN:Ce,offset:_e,isZero:Le,isNeg:Ye,isNegF:je,offsetF:P}}function x(q,W){if(!Array.isArray(q))throw new Error("array expected");q.forEach((We,Xe)=>{if(!(We instanceof W))throw new Error("invalid point at index "+Xe)})}function p(q,W){if(!Array.isArray(q))throw new Error("array of scalars expected");q.forEach((We,Xe)=>{if(!W.isValid(We))throw new Error("invalid scalar at index "+Xe)})}const g=new WeakMap,y=new WeakMap;function b(q){return y.get(q)||1}function R(q){if(q!==r)throw new Error("invalid wNAF")}class D{constructor(W,We){this.BASE=W.BASE,this.ZERO=W.ZERO,this.Fn=W.Fn,this.bits=We}_unsafeLadder(W,We,Xe=this.ZERO){let it=W;for(;We>r;)We&n&&(Xe=Xe.add(it)),it=it.double(),We>>=n;return Xe}precomputeWindow(W,We){const{windows:Xe,windowSize:it}=u(We,this.bits),Ve=[];let v=W,I=v;for(let Ce=0;Ce<Xe;Ce++){I=v,Ve.push(I);for(let P=1;P<it;P++)I=I.add(v),Ve.push(I);v=I.double()}return Ve}wNAF(W,We,Xe){if(!this.Fn.isValid(Xe))throw new Error("invalid scalar");let it=this.ZERO,Ve=this.BASE;const v=u(W,this.bits);for(let I=0;I<v.windows;I++){const{nextN:Ce,offset:P,isZero:_e,isNeg:Le,isNegF:Ye,offsetF:je}=f(Xe,I,v);Xe=Ce,_e?Ve=Ve.add(s(Ye,We[je])):it=it.add(s(Le,We[P]))}return R(Xe),{p:it,f:Ve}}wNAFUnsafe(W,We,Xe,it=this.ZERO){const Ve=u(W,this.bits);for(let v=0;v<Ve.windows&&Xe!==r;v++){const{nextN:I,offset:Ce,isZero:P,isNeg:_e}=f(Xe,v,Ve);if(Xe=I,!P){const Le=We[Ce];it=it.add(_e?Le.negate():Le)}}return R(Xe),it}getPrecomputes(W,We,Xe){let it=g.get(We);return it||(it=this.precomputeWindow(We,W),W!==1&&(typeof Xe=="function"&&(it=Xe(it)),g.set(We,it))),it}cached(W,We,Xe){const it=b(W);return this.wNAF(it,this.getPrecomputes(it,W,Xe),We)}unsafe(W,We,Xe,it){const Ve=b(W);return Ve===1?this._unsafeLadder(W,We,it):this.wNAFUnsafe(Ve,this.getPrecomputes(Ve,W,Xe),We,it)}createCache(W,We){c(We,this.bits),y.set(W,We),g.delete(W)}hasCache(W){return b(W)!==1}}curve.wNAF=D;function k(q,W,We,Xe){let it=W,Ve=q.ZERO,v=q.ZERO;for(;We>r||Xe>r;)We&n&&(Ve=Ve.add(it)),Xe&n&&(v=v.add(it)),it=it.double(),We>>=n,Xe>>=n;return{p1:Ve,p2:v}}function Re(q,W,We,Xe){x(We,q),p(Xe,W);const it=We.length,Ve=Xe.length;if(it!==Ve)throw new Error("arrays of points and scalars must have equal length");const v=q.ZERO,I=(0,t.bitLen)(BigInt(it));let Ce=1;I>12?Ce=I-3:I>4?Ce=I-2:I>0&&(Ce=2);const P=(0,t.bitMask)(Ce),_e=new Array(Number(P)+1).fill(v),Le=Math.floor((W.BITS-1)/Ce)*Ce;let Ye=v;for(let je=Le;je>=0;je-=Ce){_e.fill(v);for(let L=0;L<Ve;L++){const st=Xe[L],dt=Number(st>>BigInt(je)&P);_e[dt]=_e[dt].add(We[L])}let K=v;for(let L=_e.length-1,st=v;L>0;L--)st=st.add(_e[L]),K=K.add(st);if(Ye=Ye.add(K),je!==0)for(let L=0;L<Ce;L++)Ye=Ye.double()}return Ye}function Fe(q,W,We,Xe){c(Xe,W.BITS),x(We,q);const it=q.ZERO,Ve=2**Xe-1,v=Math.ceil(W.BITS/Xe),I=(0,t.bitMask)(Xe),Ce=We.map(P=>{const _e=[];for(let Le=0,Ye=P;Le<Ve;Le++)_e.push(Ye),Ye=Ye.add(P);return _e});return P=>{if(p(P,W),P.length>We.length)throw new Error("array of scalars must be smaller than array of points");let _e=it;for(let Le=0;Le<v;Le++){if(_e!==it)for(let je=0;je<Xe;je++)_e=_e.double();const Ye=BigInt(v*Xe-(Le+1)*Xe);for(let je=0;je<P.length;je++){const K=P[je],L=Number(K>>Ye&I);L&&(_e=_e.add(Ce[je][L-1]))}}return _e}}function O(q){return(0,e.validateField)(q.Fp),(0,t.validateObject)(q,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,e.nLength)(q.n,q.nBitLength),...q,p:q.Fp.ORDER})}function $e(q,W,We){if(W){if(W.ORDER!==q)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return(0,e.validateField)(W),W}else return(0,e.Field)(q,{isLE:We})}function ze(q,W,We={},Xe){if(Xe===void 0&&(Xe=q==="edwards"),!W||typeof W!="object")throw new Error(`expected valid ${q} CURVE object`);for(const Ce of["p","n","h"]){const P=W[Ce];if(!(typeof P=="bigint"&&P>r))throw new Error(`CURVE.${Ce} must be positive bigint`)}const it=$e(W.p,We.Fp,Xe),Ve=$e(W.n,We.Fn,Xe),I=["Gx","Gy","a",q==="weierstrass"?"b":"d"];for(const Ce of I)if(!it.isValid(W[Ce]))throw new Error(`CURVE.${Ce} must be valid field element of CURVE.Fp`);return W=Object.freeze(Object.assign({},W)),{CURVE:W,Fp:it,Fn:Ve}}return curve}var hasRequiredWeierstrass;function requireWeierstrass(){return hasRequiredWeierstrass||(hasRequiredWeierstrass=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DER=t.DERErr=void 0,t._splitEndoScalar=u,t._normFnElement=k,t.weierstrassN=Re,t.SWUFpSqrtRatio=O,t.mapToCurveSimpleSWU=$e,t.ecdh=q,t.ecdsa=W,t.weierstrassPoints=We,t._legacyHelperEquat=Ve,t.weierstrass=Ce;const e=requireHmac(),r=requireUtils$4(),n=requireUtils$3(),s=requireCurve(),o=requireModular(),c=(P,_e)=>(P+(P>=0?_e:-_e)/b)/_e;function u(P,_e,Le){const[[Ye,je],[K,L]]=_e,st=c(L*P,Le),dt=c(-je*P,Le);let Je=P-st*Ye-dt*K,pt=-st*je-dt*L;const rr=Je<g,cr=pt<g;rr&&(Je=-Je),cr&&(pt=-pt);const fr=(0,n.bitMask)(Math.ceil((0,n.bitLen)(Le)/2))+y;if(Je<g||Je>=fr||pt<g||pt>=fr)throw new Error("splitScalar (endomorphism): failed, k="+P);return{k1neg:rr,k1:Je,k2neg:cr,k2:pt}}function f(P){if(!["compact","recovered","der"].includes(P))throw new Error('Signature format must be "compact", "recovered", or "der"');return P}function x(P,_e){const Le={};for(let Ye of Object.keys(_e))Le[Ye]=P[Ye]===void 0?_e[Ye]:P[Ye];return(0,n._abool2)(Le.lowS,"lowS"),(0,n._abool2)(Le.prehash,"prehash"),Le.format!==void 0&&f(Le.format),Le}class p extends Error{constructor(_e=""){super(_e)}}t.DERErr=p,t.DER={Err:p,_tlv:{encode:(P,_e)=>{const{Err:Le}=t.DER;if(P<0||P>256)throw new Le("tlv.encode: wrong tag");if(_e.length&1)throw new Le("tlv.encode: unpadded data");const Ye=_e.length/2,je=(0,n.numberToHexUnpadded)(Ye);if(je.length/2&128)throw new Le("tlv.encode: long form length too big");const K=Ye>127?(0,n.numberToHexUnpadded)(je.length/2|128):"";return(0,n.numberToHexUnpadded)(P)+K+je+_e},decode(P,_e){const{Err:Le}=t.DER;let Ye=0;if(P<0||P>256)throw new Le("tlv.encode: wrong tag");if(_e.length<2||_e[Ye++]!==P)throw new Le("tlv.decode: wrong tlv");const je=_e[Ye++],K=!!(je&128);let L=0;if(!K)L=je;else{const dt=je&127;if(!dt)throw new Le("tlv.decode(long): indefinite length not supported");if(dt>4)throw new Le("tlv.decode(long): byte length is too big");const Je=_e.subarray(Ye,Ye+dt);if(Je.length!==dt)throw new Le("tlv.decode: length bytes not complete");if(Je[0]===0)throw new Le("tlv.decode(long): zero leftmost byte");for(const pt of Je)L=L<<8|pt;if(Ye+=dt,L<128)throw new Le("tlv.decode(long): not minimal encoding")}const st=_e.subarray(Ye,Ye+L);if(st.length!==L)throw new Le("tlv.decode: wrong value length");return{v:st,l:_e.subarray(Ye+L)}}},_int:{encode(P){const{Err:_e}=t.DER;if(P<g)throw new _e("integer: negative integers are not allowed");let Le=(0,n.numberToHexUnpadded)(P);if(Number.parseInt(Le[0],16)&8&&(Le="00"+Le),Le.length&1)throw new _e("unexpected DER parsing assertion: unpadded hex");return Le},decode(P){const{Err:_e}=t.DER;if(P[0]&128)throw new _e("invalid signature integer: negative");if(P[0]===0&&!(P[1]&128))throw new _e("invalid signature integer: unnecessary leading zero");return(0,n.bytesToNumberBE)(P)}},toSig(P){const{Err:_e,_int:Le,_tlv:Ye}=t.DER,je=(0,n.ensureBytes)("signature",P),{v:K,l:L}=Ye.decode(48,je);if(L.length)throw new _e("invalid signature: left bytes after parsing");const{v:st,l:dt}=Ye.decode(2,K),{v:Je,l:pt}=Ye.decode(2,dt);if(pt.length)throw new _e("invalid signature: left bytes after parsing");return{r:Le.decode(st),s:Le.decode(Je)}},hexFromSig(P){const{_tlv:_e,_int:Le}=t.DER,Ye=_e.encode(2,Le.encode(P.r)),je=_e.encode(2,Le.encode(P.s)),K=Ye+je;return _e.encode(48,K)}};const g=BigInt(0),y=BigInt(1),b=BigInt(2),R=BigInt(3),D=BigInt(4);function k(P,_e){const{BYTES:Le}=P;let Ye;if(typeof _e=="bigint")Ye=_e;else{let je=(0,n.ensureBytes)("private key",_e);try{Ye=P.fromBytes(je)}catch{throw new Error(`invalid private key: expected ui8a of size ${Le}, got ${typeof _e}`)}}if(!P.isValidNot0(Ye))throw new Error("invalid private key: out of range [1..N-1]");return Ye}function Re(P,_e={}){const Le=(0,s._createCurveFields)("weierstrass",P,_e),{Fp:Ye,Fn:je}=Le;let K=Le.CURVE;const{h:L,n:st}=K;(0,n._validateObject)(_e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:dt}=_e;if(dt&&(!Ye.is0(K.a)||typeof dt.beta!="bigint"||!Array.isArray(dt.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const Je=ze(Ye,je);function pt(){if(!Ye.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function rr(Nr,or,tr){const{x:yr,y:mr}=or.toAffine(),sr=Ye.toBytes(yr);if((0,n._abool2)(tr,"isCompressed"),tr){pt();const Ar=!Ye.isOdd(mr);return(0,n.concatBytes)(Fe(Ar),sr)}else return(0,n.concatBytes)(Uint8Array.of(4),sr,Ye.toBytes(mr))}function cr(Nr){(0,n._abytes2)(Nr,void 0,"Point");const{publicKey:or,publicKeyUncompressed:tr}=Je,yr=Nr.length,mr=Nr[0],sr=Nr.subarray(1);if(yr===or&&(mr===2||mr===3)){const Ar=Ye.fromBytes(sr);if(!Ye.isValid(Ar))throw new Error("bad point: is not on curve, wrong x");const ht=ft(Ar);let Qe;try{Qe=Ye.sqrt(ht)}catch(br){const Sr=br instanceof Error?": "+br.message:"";throw new Error("bad point: is not on curve, sqrt error"+Sr)}pt();const lt=Ye.isOdd(Qe);return(mr&1)===1!==lt&&(Qe=Ye.neg(Qe)),{x:Ar,y:Qe}}else if(yr===tr&&mr===4){const Ar=Ye.BYTES,ht=Ye.fromBytes(sr.subarray(0,Ar)),Qe=Ye.fromBytes(sr.subarray(Ar,Ar*2));if(!nr(ht,Qe))throw new Error("bad point: is not on curve");return{x:ht,y:Qe}}else throw new Error(`bad point: got length ${yr}, expected compressed=${or} or uncompressed=${tr}`)}const fr=_e.toBytes||rr,ir=_e.fromBytes||cr;function ft(Nr){const or=Ye.sqr(Nr),tr=Ye.mul(or,Nr);return Ye.add(Ye.add(tr,Ye.mul(Nr,K.a)),K.b)}function nr(Nr,or){const tr=Ye.sqr(or),yr=ft(Nr);return Ye.eql(tr,yr)}if(!nr(K.Gx,K.Gy))throw new Error("bad curve params: generator point");const lr=Ye.mul(Ye.pow(K.a,R),D),er=Ye.mul(Ye.sqr(K.b),BigInt(27));if(Ye.is0(Ye.add(lr,er)))throw new Error("bad curve params: a or b");function pr(Nr,or,tr=!1){if(!Ye.isValid(or)||tr&&Ye.is0(or))throw new Error(`bad point coordinate ${Nr}`);return or}function Er(Nr){if(!(Nr instanceof Cr))throw new Error("ProjectivePoint expected")}function xr(Nr){if(!dt||!dt.basises)throw new Error("no endo");return u(Nr,dt.basises,je.ORDER)}const wr=(0,n.memoized)((Nr,or)=>{const{X:tr,Y:yr,Z:mr}=Nr;if(Ye.eql(mr,Ye.ONE))return{x:tr,y:yr};const sr=Nr.is0();or==null&&(or=sr?Ye.ONE:Ye.inv(mr));const Ar=Ye.mul(tr,or),ht=Ye.mul(yr,or),Qe=Ye.mul(mr,or);if(sr)return{x:Ye.ZERO,y:Ye.ZERO};if(!Ye.eql(Qe,Ye.ONE))throw new Error("invZ was invalid");return{x:Ar,y:ht}}),Br=(0,n.memoized)(Nr=>{if(Nr.is0()){if(_e.allowInfinityPoint&&!Ye.is0(Nr.Y))return;throw new Error("bad point: ZERO")}const{x:or,y:tr}=Nr.toAffine();if(!Ye.isValid(or)||!Ye.isValid(tr))throw new Error("bad point: x or y not field elements");if(!nr(or,tr))throw new Error("bad point: equation left != right");if(!Nr.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function hr(Nr,or,tr,yr,mr){return tr=new Cr(Ye.mul(tr.X,Nr),tr.Y,tr.Z),or=(0,s.negateCt)(yr,or),tr=(0,s.negateCt)(mr,tr),or.add(tr)}class Cr{constructor(or,tr,yr){this.X=pr("x",or),this.Y=pr("y",tr,!0),this.Z=pr("z",yr),Object.freeze(this)}static CURVE(){return K}static fromAffine(or){const{x:tr,y:yr}=or||{};if(!or||!Ye.isValid(tr)||!Ye.isValid(yr))throw new Error("invalid affine point");if(or instanceof Cr)throw new Error("projective point not allowed");return Ye.is0(tr)&&Ye.is0(yr)?Cr.ZERO:new Cr(tr,yr,Ye.ONE)}static fromBytes(or){const tr=Cr.fromAffine(ir((0,n._abytes2)(or,void 0,"point")));return tr.assertValidity(),tr}static fromHex(or){return Cr.fromBytes((0,n.ensureBytes)("pointHex",or))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(or=8,tr=!0){return Tr.createCache(this,or),tr||this.multiply(R),this}assertValidity(){Br(this)}hasEvenY(){const{y:or}=this.toAffine();if(!Ye.isOdd)throw new Error("Field doesn't support isOdd");return!Ye.isOdd(or)}equals(or){Er(or);const{X:tr,Y:yr,Z:mr}=this,{X:sr,Y:Ar,Z:ht}=or,Qe=Ye.eql(Ye.mul(tr,ht),Ye.mul(sr,mr)),lt=Ye.eql(Ye.mul(yr,ht),Ye.mul(Ar,mr));return Qe&&lt}negate(){return new Cr(this.X,Ye.neg(this.Y),this.Z)}double(){const{a:or,b:tr}=K,yr=Ye.mul(tr,R),{X:mr,Y:sr,Z:Ar}=this;let ht=Ye.ZERO,Qe=Ye.ZERO,lt=Ye.ZERO,ar=Ye.mul(mr,mr),br=Ye.mul(sr,sr),Sr=Ye.mul(Ar,Ar),Rr=Ye.mul(mr,sr);return Rr=Ye.add(Rr,Rr),lt=Ye.mul(mr,Ar),lt=Ye.add(lt,lt),ht=Ye.mul(or,lt),Qe=Ye.mul(yr,Sr),Qe=Ye.add(ht,Qe),ht=Ye.sub(br,Qe),Qe=Ye.add(br,Qe),Qe=Ye.mul(ht,Qe),ht=Ye.mul(Rr,ht),lt=Ye.mul(yr,lt),Sr=Ye.mul(or,Sr),Rr=Ye.sub(ar,Sr),Rr=Ye.mul(or,Rr),Rr=Ye.add(Rr,lt),lt=Ye.add(ar,ar),ar=Ye.add(lt,ar),ar=Ye.add(ar,Sr),ar=Ye.mul(ar,Rr),Qe=Ye.add(Qe,ar),Sr=Ye.mul(sr,Ar),Sr=Ye.add(Sr,Sr),ar=Ye.mul(Sr,Rr),ht=Ye.sub(ht,ar),lt=Ye.mul(Sr,br),lt=Ye.add(lt,lt),lt=Ye.add(lt,lt),new Cr(ht,Qe,lt)}add(or){Er(or);const{X:tr,Y:yr,Z:mr}=this,{X:sr,Y:Ar,Z:ht}=or;let Qe=Ye.ZERO,lt=Ye.ZERO,ar=Ye.ZERO;const br=K.a,Sr=Ye.mul(K.b,R);let Rr=Ye.mul(tr,sr),Lr=Ye.mul(yr,Ar),Gr=Ye.mul(mr,ht),zr=Ye.add(tr,yr),Vr=Ye.add(sr,Ar);zr=Ye.mul(zr,Vr),Vr=Ye.add(Rr,Lr),zr=Ye.sub(zr,Vr),Vr=Ye.add(tr,mr);let Zr=Ye.add(sr,ht);return Vr=Ye.mul(Vr,Zr),Zr=Ye.add(Rr,Gr),Vr=Ye.sub(Vr,Zr),Zr=Ye.add(yr,mr),Qe=Ye.add(Ar,ht),Zr=Ye.mul(Zr,Qe),Qe=Ye.add(Lr,Gr),Zr=Ye.sub(Zr,Qe),ar=Ye.mul(br,Vr),Qe=Ye.mul(Sr,Gr),ar=Ye.add(Qe,ar),Qe=Ye.sub(Lr,ar),ar=Ye.add(Lr,ar),lt=Ye.mul(Qe,ar),Lr=Ye.add(Rr,Rr),Lr=Ye.add(Lr,Rr),Gr=Ye.mul(br,Gr),Vr=Ye.mul(Sr,Vr),Lr=Ye.add(Lr,Gr),Gr=Ye.sub(Rr,Gr),Gr=Ye.mul(br,Gr),Vr=Ye.add(Vr,Gr),Rr=Ye.mul(Lr,Vr),lt=Ye.add(lt,Rr),Rr=Ye.mul(Zr,Vr),Qe=Ye.mul(zr,Qe),Qe=Ye.sub(Qe,Rr),Rr=Ye.mul(zr,Lr),ar=Ye.mul(Zr,ar),ar=Ye.add(ar,Rr),new Cr(Qe,lt,ar)}subtract(or){return this.add(or.negate())}is0(){return this.equals(Cr.ZERO)}multiply(or){const{endo:tr}=_e;if(!je.isValidNot0(or))throw new Error("invalid scalar: out of range");let yr,mr;const sr=Ar=>Tr.cached(this,Ar,ht=>(0,s.normalizeZ)(Cr,ht));if(tr){const{k1neg:Ar,k1:ht,k2neg:Qe,k2:lt}=xr(or),{p:ar,f:br}=sr(ht),{p:Sr,f:Rr}=sr(lt);mr=br.add(Rr),yr=hr(tr.beta,ar,Sr,Ar,Qe)}else{const{p:Ar,f:ht}=sr(or);yr=Ar,mr=ht}return(0,s.normalizeZ)(Cr,[yr,mr])[0]}multiplyUnsafe(or){const{endo:tr}=_e,yr=this;if(!je.isValid(or))throw new Error("invalid scalar: out of range");if(or===g||yr.is0())return Cr.ZERO;if(or===y)return yr;if(Tr.hasCache(this))return this.multiply(or);if(tr){const{k1neg:mr,k1:sr,k2neg:Ar,k2:ht}=xr(or),{p1:Qe,p2:lt}=(0,s.mulEndoUnsafe)(Cr,yr,sr,ht);return hr(tr.beta,Qe,lt,mr,Ar)}else return Tr.unsafe(yr,or)}multiplyAndAddUnsafe(or,tr,yr){const mr=this.multiplyUnsafe(tr).add(or.multiplyUnsafe(yr));return mr.is0()?void 0:mr}toAffine(or){return wr(this,or)}isTorsionFree(){const{isTorsionFree:or}=_e;return L===y?!0:or?or(Cr,this):Tr.unsafe(this,st).is0()}clearCofactor(){const{clearCofactor:or}=_e;return L===y?this:or?or(Cr,this):this.multiplyUnsafe(L)}isSmallOrder(){return this.multiplyUnsafe(L).is0()}toBytes(or=!0){return(0,n._abool2)(or,"isCompressed"),this.assertValidity(),fr(Cr,this,or)}toHex(or=!0){return(0,n.bytesToHex)(this.toBytes(or))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(or=!0){return this.toBytes(or)}_setWindowSize(or){this.precompute(or)}static normalizeZ(or){return(0,s.normalizeZ)(Cr,or)}static msm(or,tr){return(0,s.pippenger)(Cr,je,or,tr)}static fromPrivateKey(or){return Cr.BASE.multiply(k(je,or))}}Cr.BASE=new Cr(K.Gx,K.Gy,Ye.ONE),Cr.ZERO=new Cr(Ye.ZERO,Ye.ONE,Ye.ZERO),Cr.Fp=Ye,Cr.Fn=je;const _r=je.BITS,Tr=new s.wNAF(Cr,_e.endo?Math.ceil(_r/2):_r);return Cr.BASE.precompute(8),Cr}function Fe(P){return Uint8Array.of(P?2:3)}function O(P,_e){const Le=P.ORDER;let Ye=g;for(let ir=Le-y;ir%b===g;ir/=b)Ye+=y;const je=Ye,K=b<<je-y-y,L=K*b,st=(Le-y)/L,dt=(st-y)/b,Je=L-y,pt=K,rr=P.pow(_e,st),cr=P.pow(_e,(st+y)/b);let fr=(ir,ft)=>{let nr=rr,lr=P.pow(ft,Je),er=P.sqr(lr);er=P.mul(er,ft);let pr=P.mul(ir,er);pr=P.pow(pr,dt),pr=P.mul(pr,lr),lr=P.mul(pr,ft),er=P.mul(pr,ir);let Er=P.mul(er,lr);pr=P.pow(Er,pt);let xr=P.eql(pr,P.ONE);lr=P.mul(er,cr),pr=P.mul(Er,nr),er=P.cmov(lr,er,xr),Er=P.cmov(pr,Er,xr);for(let wr=je;wr>y;wr--){let Br=wr-b;Br=b<<Br-y;let hr=P.pow(Er,Br);const Cr=P.eql(hr,P.ONE);lr=P.mul(er,nr),nr=P.mul(nr,nr),hr=P.mul(Er,nr),er=P.cmov(lr,er,Cr),Er=P.cmov(hr,Er,Cr)}return{isValid:xr,value:er}};if(P.ORDER%D===R){const ir=(P.ORDER-R)/D,ft=P.sqrt(P.neg(_e));fr=(nr,lr)=>{let er=P.sqr(lr);const pr=P.mul(nr,lr);er=P.mul(er,pr);let Er=P.pow(er,ir);Er=P.mul(Er,pr);const xr=P.mul(Er,ft),wr=P.mul(P.sqr(Er),lr),Br=P.eql(wr,nr);let hr=P.cmov(xr,Er,Br);return{isValid:Br,value:hr}}}return fr}function $e(P,_e){(0,o.validateField)(P);const{A:Le,B:Ye,Z:je}=_e;if(!P.isValid(Le)||!P.isValid(Ye)||!P.isValid(je))throw new Error("mapToCurveSimpleSWU: invalid opts");const K=O(P,je);if(!P.isOdd)throw new Error("Field does not have .isOdd()");return L=>{let st,dt,Je,pt,rr,cr,fr,ir;st=P.sqr(L),st=P.mul(st,je),dt=P.sqr(st),dt=P.add(dt,st),Je=P.add(dt,P.ONE),Je=P.mul(Je,Ye),pt=P.cmov(je,P.neg(dt),!P.eql(dt,P.ZERO)),pt=P.mul(pt,Le),dt=P.sqr(Je),cr=P.sqr(pt),rr=P.mul(cr,Le),dt=P.add(dt,rr),dt=P.mul(dt,Je),cr=P.mul(cr,pt),rr=P.mul(cr,Ye),dt=P.add(dt,rr),fr=P.mul(st,Je);const{isValid:ft,value:nr}=K(dt,cr);ir=P.mul(st,L),ir=P.mul(ir,nr),fr=P.cmov(fr,Je,ft),ir=P.cmov(ir,nr,ft);const lr=P.isOdd(L)===P.isOdd(ir);ir=P.cmov(P.neg(ir),ir,lr);const er=(0,o.FpInvertBatch)(P,[pt],!0)[0];return fr=P.mul(fr,er),{x:fr,y:ir}}}function ze(P,_e){return{secretKey:_e.BYTES,publicKey:1+P.BYTES,publicKeyUncompressed:1+2*P.BYTES,publicKeyHasPrefix:!0,signature:2*_e.BYTES}}function q(P,_e={}){const{Fn:Le}=P,Ye=_e.randomBytes||n.randomBytes,je=Object.assign(ze(P.Fp,Le),{seed:(0,o.getMinHashLength)(Le.ORDER)});function K(fr){try{return!!k(Le,fr)}catch{return!1}}function L(fr,ir){const{publicKey:ft,publicKeyUncompressed:nr}=je;try{const lr=fr.length;return ir===!0&&lr!==ft||ir===!1&&lr!==nr?!1:!!P.fromBytes(fr)}catch{return!1}}function st(fr=Ye(je.seed)){return(0,o.mapHashToField)((0,n._abytes2)(fr,je.seed,"seed"),Le.ORDER)}function dt(fr,ir=!0){return P.BASE.multiply(k(Le,fr)).toBytes(ir)}function Je(fr){const ir=st(fr);return{secretKey:ir,publicKey:dt(ir)}}function pt(fr){if(typeof fr=="bigint")return!1;if(fr instanceof P)return!0;const{secretKey:ir,publicKey:ft,publicKeyUncompressed:nr}=je;if(Le.allowedLengths||ir===ft)return;const lr=(0,n.ensureBytes)("key",fr).length;return lr===ft||lr===nr}function rr(fr,ir,ft=!0){if(pt(fr)===!0)throw new Error("first arg must be private key");if(pt(ir)===!1)throw new Error("second arg must be public key");const nr=k(Le,fr);return P.fromHex(ir).multiply(nr).toBytes(ft)}return Object.freeze({getPublicKey:dt,getSharedSecret:rr,keygen:Je,Point:P,utils:{isValidSecretKey:K,isValidPublicKey:L,randomSecretKey:st,isValidPrivateKey:K,randomPrivateKey:st,normPrivateKeyToScalar:fr=>k(Le,fr),precompute(fr=8,ir=P.BASE){return ir.precompute(fr,!1)}},lengths:je})}function W(P,_e,Le={}){(0,r.ahash)(_e),(0,n._validateObject)(Le,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const Ye=Le.randomBytes||n.randomBytes,je=Le.hmac||((tr,...yr)=>(0,e.hmac)(_e,tr,(0,n.concatBytes)(...yr))),{Fp:K,Fn:L}=P,{ORDER:st,BITS:dt}=L,{keygen:Je,getPublicKey:pt,getSharedSecret:rr,utils:cr,lengths:fr}=q(P,Le),ir={prehash:!1,lowS:typeof Le.lowS=="boolean"?Le.lowS:!1,format:void 0,extraEntropy:!1},ft="compact";function nr(tr){const yr=st>>y;return tr>yr}function lr(tr,yr){if(!L.isValidNot0(yr))throw new Error(`invalid signature ${tr}: out of range 1..Point.Fn.ORDER`);return yr}function er(tr,yr){f(yr);const mr=fr.signature,sr=yr==="compact"?mr:yr==="recovered"?mr+1:void 0;return(0,n._abytes2)(tr,sr,`${yr} signature`)}class pr{constructor(yr,mr,sr){this.r=lr("r",yr),this.s=lr("s",mr),sr!=null&&(this.recovery=sr),Object.freeze(this)}static fromBytes(yr,mr=ft){er(yr,mr);let sr;if(mr==="der"){const{r:lt,s:ar}=t.DER.toSig((0,n._abytes2)(yr));return new pr(lt,ar)}mr==="recovered"&&(sr=yr[0],mr="compact",yr=yr.subarray(1));const Ar=L.BYTES,ht=yr.subarray(0,Ar),Qe=yr.subarray(Ar,Ar*2);return new pr(L.fromBytes(ht),L.fromBytes(Qe),sr)}static fromHex(yr,mr){return this.fromBytes((0,n.hexToBytes)(yr),mr)}addRecoveryBit(yr){return new pr(this.r,this.s,yr)}recoverPublicKey(yr){const mr=K.ORDER,{r:sr,s:Ar,recovery:ht}=this;if(ht==null||![0,1,2,3].includes(ht))throw new Error("recovery id invalid");if(st*b<mr&&ht>1)throw new Error("recovery id is ambiguous for h>1 curve");const lt=ht===2||ht===3?sr+st:sr;if(!K.isValid(lt))throw new Error("recovery id 2 or 3 invalid");const ar=K.toBytes(lt),br=P.fromBytes((0,n.concatBytes)(Fe((ht&1)===0),ar)),Sr=L.inv(lt),Rr=xr((0,n.ensureBytes)("msgHash",yr)),Lr=L.create(-Rr*Sr),Gr=L.create(Ar*Sr),zr=P.BASE.multiplyUnsafe(Lr).add(br.multiplyUnsafe(Gr));if(zr.is0())throw new Error("point at infinify");return zr.assertValidity(),zr}hasHighS(){return nr(this.s)}toBytes(yr=ft){if(f(yr),yr==="der")return(0,n.hexToBytes)(t.DER.hexFromSig(this));const mr=L.toBytes(this.r),sr=L.toBytes(this.s);if(yr==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return(0,n.concatBytes)(Uint8Array.of(this.recovery),mr,sr)}return(0,n.concatBytes)(mr,sr)}toHex(yr){return(0,n.bytesToHex)(this.toBytes(yr))}assertValidity(){}static fromCompact(yr){return pr.fromBytes((0,n.ensureBytes)("sig",yr),"compact")}static fromDER(yr){return pr.fromBytes((0,n.ensureBytes)("sig",yr),"der")}normalizeS(){return this.hasHighS()?new pr(this.r,L.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return(0,n.bytesToHex)(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return(0,n.bytesToHex)(this.toBytes("compact"))}}const Er=Le.bits2int||function(yr){if(yr.length>8192)throw new Error("input is too large");const mr=(0,n.bytesToNumberBE)(yr),sr=yr.length*8-dt;return sr>0?mr>>BigInt(sr):mr},xr=Le.bits2int_modN||function(yr){return L.create(Er(yr))},wr=(0,n.bitMask)(dt);function Br(tr){return(0,n.aInRange)("num < 2^"+dt,tr,g,wr),L.toBytes(tr)}function hr(tr,yr){return(0,n._abytes2)(tr,void 0,"message"),yr?(0,n._abytes2)(_e(tr),void 0,"prehashed message"):tr}function Cr(tr,yr,mr){if(["recovered","canonical"].some(Lr=>Lr in mr))throw new Error("sign() legacy options not supported");const{lowS:sr,prehash:Ar,extraEntropy:ht}=x(mr,ir);tr=hr(tr,Ar);const Qe=xr(tr),lt=k(L,yr),ar=[Br(lt),Br(Qe)];if(ht!=null&&ht!==!1){const Lr=ht===!0?Ye(fr.secretKey):ht;ar.push((0,n.ensureBytes)("extraEntropy",Lr))}const br=(0,n.concatBytes)(...ar),Sr=Qe;function Rr(Lr){const Gr=Er(Lr);if(!L.isValidNot0(Gr))return;const zr=L.inv(Gr),Vr=P.BASE.multiply(Gr).toAffine(),Zr=L.create(Vr.x);if(Zr===g)return;const an=L.create(zr*L.create(Sr+Zr*lt));if(an===g)return;let nn=(Vr.x===Zr?0:2)|Number(Vr.y&y),Xn=an;return sr&&nr(an)&&(Xn=L.neg(an),nn^=1),new pr(Zr,Xn,nn)}return{seed:br,k2sig:Rr}}function _r(tr,yr,mr={}){tr=(0,n.ensureBytes)("message",tr);const{seed:sr,k2sig:Ar}=Cr(tr,yr,mr);return(0,n.createHmacDrbg)(_e.outputLen,L.BYTES,je)(sr,Ar)}function Tr(tr){let yr;const mr=typeof tr=="string"||(0,n.isBytes)(tr),sr=!mr&&tr!==null&&typeof tr=="object"&&typeof tr.r=="bigint"&&typeof tr.s=="bigint";if(!mr&&!sr)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(sr)yr=new pr(tr.r,tr.s);else if(mr){try{yr=pr.fromBytes((0,n.ensureBytes)("sig",tr),"der")}catch(Ar){if(!(Ar instanceof t.DER.Err))throw Ar}if(!yr)try{yr=pr.fromBytes((0,n.ensureBytes)("sig",tr),"compact")}catch{return!1}}return yr||!1}function Nr(tr,yr,mr,sr={}){const{lowS:Ar,prehash:ht,format:Qe}=x(sr,ir);if(mr=(0,n.ensureBytes)("publicKey",mr),yr=hr((0,n.ensureBytes)("message",yr),ht),"strict"in sr)throw new Error("options.strict was renamed to lowS");const lt=Qe===void 0?Tr(tr):pr.fromBytes((0,n.ensureBytes)("sig",tr),Qe);if(lt===!1)return!1;try{const ar=P.fromBytes(mr);if(Ar&&lt.hasHighS())return!1;const{r:br,s:Sr}=lt,Rr=xr(yr),Lr=L.inv(Sr),Gr=L.create(Rr*Lr),zr=L.create(br*Lr),Vr=P.BASE.multiplyUnsafe(Gr).add(ar.multiplyUnsafe(zr));return Vr.is0()?!1:L.create(Vr.x)===br}catch{return!1}}function or(tr,yr,mr={}){const{prehash:sr}=x(mr,ir);return yr=hr(yr,sr),pr.fromBytes(tr,"recovered").recoverPublicKey(yr).toBytes()}return Object.freeze({keygen:Je,getPublicKey:pt,getSharedSecret:rr,utils:cr,lengths:fr,Point:P,sign:_r,verify:Nr,recoverPublicKey:or,Signature:pr,hash:_e})}function We(P){const{CURVE:_e,curveOpts:Le}=Xe(P),Ye=Re(_e,Le);return v(P,Ye)}function Xe(P){const _e={a:P.a,b:P.b,p:P.Fp.ORDER,n:P.n,h:P.h,Gx:P.Gx,Gy:P.Gy},Le=P.Fp;let Ye=P.allowedPrivateKeyLengths?Array.from(new Set(P.allowedPrivateKeyLengths.map(L=>Math.ceil(L/2)))):void 0;const je=(0,o.Field)(_e.n,{BITS:P.nBitLength,allowedLengths:Ye,modFromBytes:P.wrapPrivateKey}),K={Fp:Le,Fn:je,allowInfinityPoint:P.allowInfinityPoint,endo:P.endo,isTorsionFree:P.isTorsionFree,clearCofactor:P.clearCofactor,fromBytes:P.fromBytes,toBytes:P.toBytes};return{CURVE:_e,curveOpts:K}}function it(P){const{CURVE:_e,curveOpts:Le}=Xe(P),Ye={hmac:P.hmac,randomBytes:P.randomBytes,lowS:P.lowS,bits2int:P.bits2int,bits2int_modN:P.bits2int_modN};return{CURVE:_e,curveOpts:Le,hash:P.hash,ecdsaOpts:Ye}}function Ve(P,_e,Le){function Ye(je){const K=P.sqr(je),L=P.mul(K,je);return P.add(P.add(L,P.mul(je,_e)),Le)}return Ye}function v(P,_e){const{Fp:Le,Fn:Ye}=_e;function je(L){return(0,n.inRange)(L,y,Ye.ORDER)}const K=Ve(Le,P.a,P.b);return Object.assign({},{CURVE:P,Point:_e,ProjectivePoint:_e,normPrivateKeyToScalar:L=>k(Ye,L),weierstrassEquation:K,isWithinCurveOrder:je})}function I(P,_e){const Le=_e.Point;return Object.assign({},_e,{ProjectivePoint:Le,CURVE:Object.assign({},P,(0,o.nLength)(Le.Fn.ORDER,Le.Fn.BITS))})}function Ce(P){const{CURVE:_e,curveOpts:Le,hash:Ye,ecdsaOpts:je}=it(P),K=Re(_e,Le),L=W(K,Ye,je);return I(P,L)}})(weierstrass)),weierstrass}var hasRequired_shortw_utils;function require_shortw_utils(){if(hasRequired_shortw_utils)return _shortw_utils;hasRequired_shortw_utils=1,Object.defineProperty(_shortw_utils,"__esModule",{value:!0}),_shortw_utils.getHash=e,_shortw_utils.createCurve=r;const t=requireWeierstrass();function e(n){return{hash:n}}function r(n,s){const o=c=>(0,t.weierstrass)({...n,hash:c});return{...o(s),create:o}}return _shortw_utils}var hashToCurve={},hasRequiredHashToCurve;function requireHashToCurve(){return hasRequiredHashToCurve||(hasRequiredHashToCurve=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t._DST_scalar=void 0,t.expand_message_xmd=f,t.expand_message_xof=x,t.hash_to_field=p,t.isogenyMap=g,t.createHasher=y;const e=requireUtils$3(),r=requireModular(),n=e.bytesToNumberBE;function s(b,R){if(c(b),c(R),b<0||b>=1<<8*R)throw new Error("invalid I2OSP input: "+b);const D=Array.from({length:R}).fill(0);for(let k=R-1;k>=0;k--)D[k]=b&255,b>>>=8;return new Uint8Array(D)}function o(b,R){const D=new Uint8Array(b.length);for(let k=0;k<b.length;k++)D[k]=b[k]^R[k];return D}function c(b){if(!Number.isSafeInteger(b))throw new Error("number expected")}function u(b){if(!(0,e.isBytes)(b)&&typeof b!="string")throw new Error("DST must be Uint8Array or string");return typeof b=="string"?(0,e.utf8ToBytes)(b):b}function f(b,R,D,k){(0,e.abytes)(b),c(D),R=u(R),R.length>255&&(R=k((0,e.concatBytes)((0,e.utf8ToBytes)("H2C-OVERSIZE-DST-"),R)));const{outputLen:Re,blockLen:Fe}=k,O=Math.ceil(D/Re);if(D>65535||O>255)throw new Error("expand_message_xmd: invalid lenInBytes");const $e=(0,e.concatBytes)(R,s(R.length,1)),ze=s(0,Fe),q=s(D,2),W=new Array(O),We=k((0,e.concatBytes)(ze,b,q,s(0,1),$e));W[0]=k((0,e.concatBytes)(We,s(1,1),$e));for(let it=1;it<=O;it++){const Ve=[o(We,W[it-1]),s(it+1,1),$e];W[it]=k((0,e.concatBytes)(...Ve))}return(0,e.concatBytes)(...W).slice(0,D)}function x(b,R,D,k,Re){if((0,e.abytes)(b),c(D),R=u(R),R.length>255){const Fe=Math.ceil(2*k/8);R=Re.create({dkLen:Fe}).update((0,e.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(R).digest()}if(D>65535||R.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return Re.create({dkLen:D}).update(b).update(s(D,2)).update(R).update(s(R.length,1)).digest()}function p(b,R,D){(0,e._validateObject)(D,{p:"bigint",m:"number",k:"number",hash:"function"});const{p:k,k:Re,m:Fe,hash:O,expand:$e,DST:ze}=D;if(!(0,e.isHash)(D.hash))throw new Error("expected valid hash");(0,e.abytes)(b),c(R);const q=k.toString(2).length,W=Math.ceil((q+Re)/8),We=R*Fe*W;let Xe;if($e==="xmd")Xe=f(b,ze,We,O);else if($e==="xof")Xe=x(b,ze,We,Re,O);else if($e==="_internal_pass")Xe=b;else throw new Error('expand must be "xmd" or "xof"');const it=new Array(R);for(let Ve=0;Ve<R;Ve++){const v=new Array(Fe);for(let I=0;I<Fe;I++){const Ce=W*(I+Ve*Fe),P=Xe.subarray(Ce,Ce+W);v[I]=(0,r.mod)(n(P),k)}it[Ve]=v}return it}function g(b,R){const D=R.map(k=>Array.from(k).reverse());return(k,Re)=>{const[Fe,O,$e,ze]=D.map(We=>We.reduce((Xe,it)=>b.add(b.mul(Xe,k),it))),[q,W]=(0,r.FpInvertBatch)(b,[O,ze],!0);return k=b.mul(Fe,q),Re=b.mul(Re,b.mul($e,W)),{x:k,y:Re}}}t._DST_scalar=(0,e.utf8ToBytes)("HashToScalar-");function y(b,R,D){if(typeof R!="function")throw new Error("mapToCurve() must be defined");function k(Fe){return b.fromAffine(R(Fe))}function Re(Fe){const O=Fe.clearCofactor();return O.equals(b.ZERO)?b.ZERO:(O.assertValidity(),O)}return{defaults:D,hashToCurve(Fe,O){const $e=Object.assign({},D,O),ze=p(Fe,2,$e),q=k(ze[0]),W=k(ze[1]);return Re(q.add(W))},encodeToCurve(Fe,O){const $e=D.encodeDST?{DST:D.encodeDST}:{},ze=Object.assign({},D,$e,O),q=p(Fe,1,ze),W=k(q[0]);return Re(W)},mapToCurve(Fe){if(!Array.isArray(Fe))throw new Error("expected array of bigints");for(const O of Fe)if(typeof O!="bigint")throw new Error("expected array of bigints");return Re(k(Fe))},hashToScalar(Fe,O){const $e=b.Fn.ORDER,ze=Object.assign({},D,{p:$e,m:1,DST:t._DST_scalar},O);return p(Fe,1,ze)[0][0]}}}})(hashToCurve)),hashToCurve}var hasRequiredSecp256k1;function requireSecp256k1(){return hasRequiredSecp256k1||(hasRequiredSecp256k1=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.encodeToCurve=t.hashToCurve=t.secp256k1_hasher=t.schnorr=t.secp256k1=void 0;const e=requireSha2(),r=requireUtils$4(),n=require_shortw_utils(),s=requireHashToCurve(),o=requireModular(),c=requireWeierstrass(),u=requireUtils$3(),f={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},x={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},p=BigInt(0),g=BigInt(1),y=BigInt(2);function b(I){const Ce=f.p,P=BigInt(3),_e=BigInt(6),Le=BigInt(11),Ye=BigInt(22),je=BigInt(23),K=BigInt(44),L=BigInt(88),st=I*I*I%Ce,dt=st*st*I%Ce,Je=(0,o.pow2)(dt,P,Ce)*dt%Ce,pt=(0,o.pow2)(Je,P,Ce)*dt%Ce,rr=(0,o.pow2)(pt,y,Ce)*st%Ce,cr=(0,o.pow2)(rr,Le,Ce)*rr%Ce,fr=(0,o.pow2)(cr,Ye,Ce)*cr%Ce,ir=(0,o.pow2)(fr,K,Ce)*fr%Ce,ft=(0,o.pow2)(ir,L,Ce)*ir%Ce,nr=(0,o.pow2)(ft,K,Ce)*fr%Ce,lr=(0,o.pow2)(nr,P,Ce)*dt%Ce,er=(0,o.pow2)(lr,je,Ce)*cr%Ce,pr=(0,o.pow2)(er,_e,Ce)*st%Ce,Er=(0,o.pow2)(pr,y,Ce);if(!R.eql(R.sqr(Er),I))throw new Error("Cannot find square root");return Er}const R=(0,o.Field)(f.p,{sqrt:b});t.secp256k1=(0,n.createCurve)({...f,Fp:R,lowS:!0,endo:x},e.sha256);const D={};function k(I,...Ce){let P=D[I];if(P===void 0){const _e=(0,e.sha256)((0,u.utf8ToBytes)(I));P=(0,u.concatBytes)(_e,_e),D[I]=P}return(0,e.sha256)((0,u.concatBytes)(P,...Ce))}const Re=I=>I.toBytes(!0).slice(1),Fe=t.secp256k1.Point,O=I=>I%y===p;function $e(I){const{Fn:Ce,BASE:P}=Fe,_e=(0,c._normFnElement)(Ce,I),Le=P.multiply(_e);return{scalar:O(Le.y)?_e:Ce.neg(_e),bytes:Re(Le)}}function ze(I){const Ce=R;if(!Ce.isValidNot0(I))throw new Error("invalid x: Fail if x  p");const P=Ce.create(I*I),_e=Ce.create(P*I+BigInt(7));let Le=Ce.sqrt(_e);O(Le)||(Le=Ce.neg(Le));const Ye=Fe.fromAffine({x:I,y:Le});return Ye.assertValidity(),Ye}const q=u.bytesToNumberBE;function W(...I){return Fe.Fn.create(q(k("BIP0340/challenge",...I)))}function We(I){return $e(I).bytes}function Xe(I,Ce,P=(0,r.randomBytes)(32)){const{Fn:_e}=Fe,Le=(0,u.ensureBytes)("message",I),{bytes:Ye,scalar:je}=$e(Ce),K=(0,u.ensureBytes)("auxRand",P,32),L=_e.toBytes(je^q(k("BIP0340/aux",K))),st=k("BIP0340/nonce",L,Ye,Le),{bytes:dt,scalar:Je}=$e(st),pt=W(dt,Ye,Le),rr=new Uint8Array(64);if(rr.set(dt,0),rr.set(_e.toBytes(_e.create(Je+pt*je)),32),!it(rr,Le,Ye))throw new Error("sign: Invalid signature produced");return rr}function it(I,Ce,P){const{Fn:_e,BASE:Le}=Fe,Ye=(0,u.ensureBytes)("signature",I,64),je=(0,u.ensureBytes)("message",Ce),K=(0,u.ensureBytes)("publicKey",P,32);try{const L=ze(q(K)),st=q(Ye.subarray(0,32));if(!(0,u.inRange)(st,g,f.p))return!1;const dt=q(Ye.subarray(32,64));if(!(0,u.inRange)(dt,g,f.n))return!1;const Je=W(_e.toBytes(st),Re(L),je),pt=Le.multiplyUnsafe(dt).add(L.multiplyUnsafe(_e.neg(Je))),{x:rr,y:cr}=pt.toAffine();return!(pt.is0()||!O(cr)||rr!==st)}catch{return!1}}t.schnorr=(()=>{const P=(Le=(0,r.randomBytes)(48))=>(0,o.mapHashToField)(Le,f.n);t.secp256k1.utils.randomSecretKey;function _e(Le){const Ye=P(Le);return{secretKey:Ye,publicKey:We(Ye)}}return{keygen:_e,getPublicKey:We,sign:Xe,verify:it,Point:Fe,utils:{randomSecretKey:P,randomPrivateKey:P,taggedHash:k,lift_x:ze,pointToBytes:Re,numberToBytesBE:u.numberToBytesBE,bytesToNumberBE:u.bytesToNumberBE,mod:o.mod},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})();const Ve=(0,s.isogenyMap)(R,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(I=>I.map(Ce=>BigInt(Ce)))),v=(0,c.mapToCurveSimpleSWU)(R,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:R.create(BigInt("-11"))});t.secp256k1_hasher=(0,s.createHasher)(t.secp256k1.Point,I=>{const{x:Ce,y:P}=v(R.create(I[0]));return Ve(Ce,P)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:R.ORDER,m:1,k:128,expand:"xmd",hash:e.sha256}),t.hashToCurve=t.secp256k1_hasher.hashToCurve,t.encodeToCurve=t.secp256k1_hasher.encodeToCurve})(secp256k1)),secp256k1}var utils$2={},hasRequiredUtils$2;function requireUtils$2(){if(hasRequiredUtils$2)return utils$2;hasRequiredUtils$2=1,Object.defineProperty(utils$2,"__esModule",{value:!0}),utils$2.isHash=utils$2.validateObject=utils$2.memoized=utils$2.notImplemented=utils$2.createHmacDrbg=utils$2.bitMask=utils$2.bitSet=utils$2.bitGet=utils$2.bitLen=utils$2.aInRange=utils$2.inRange=utils$2.asciiToBytes=utils$2.copyBytes=utils$2.equalBytes=utils$2.ensureBytes=utils$2.numberToVarBytesBE=utils$2.numberToBytesLE=utils$2.numberToBytesBE=utils$2.bytesToNumberLE=utils$2.bytesToNumberBE=utils$2.hexToNumber=utils$2.numberToHexUnpadded=utils$2.abool=utils$2.utf8ToBytes=utils$2.randomBytes=utils$2.isBytes=utils$2.hexToBytes=utils$2.concatBytes=utils$2.bytesToUtf8=utils$2.bytesToHex=utils$2.anumber=utils$2.abytes=void 0;const t=requireUtils$3();return utils$2.abytes=t.abytes,utils$2.anumber=t.anumber,utils$2.bytesToHex=t.bytesToHex,utils$2.bytesToUtf8=t.bytesToUtf8,utils$2.concatBytes=t.concatBytes,utils$2.hexToBytes=t.hexToBytes,utils$2.isBytes=t.isBytes,utils$2.randomBytes=t.randomBytes,utils$2.utf8ToBytes=t.utf8ToBytes,utils$2.abool=t.abool,utils$2.numberToHexUnpadded=t.numberToHexUnpadded,utils$2.hexToNumber=t.hexToNumber,utils$2.bytesToNumberBE=t.bytesToNumberBE,utils$2.bytesToNumberLE=t.bytesToNumberLE,utils$2.numberToBytesBE=t.numberToBytesBE,utils$2.numberToBytesLE=t.numberToBytesLE,utils$2.numberToVarBytesBE=t.numberToVarBytesBE,utils$2.ensureBytes=t.ensureBytes,utils$2.equalBytes=t.equalBytes,utils$2.copyBytes=t.copyBytes,utils$2.asciiToBytes=t.asciiToBytes,utils$2.inRange=t.inRange,utils$2.aInRange=t.aInRange,utils$2.bitLen=t.bitLen,utils$2.bitGet=t.bitGet,utils$2.bitSet=t.bitSet,utils$2.bitMask=t.bitMask,utils$2.createHmacDrbg=t.createHmacDrbg,utils$2.notImplemented=t.notImplemented,utils$2.memoized=t.memoized,utils$2.validateObject=t.validateObject,utils$2.isHash=t.isHash,utils$2}var hasRequiredDist;function requireDist(){if(hasRequiredDist)return dist;hasRequiredDist=1;var t=requireSecp256k1(),e=requireModular(),r=requireUtils$2();function n(sr){var Ar=Object.create(null);return sr&&Object.keys(sr).forEach(function(ht){if(ht!=="default"){var Qe=Object.getOwnPropertyDescriptor(sr,ht);Object.defineProperty(Ar,ht,Qe.get?Qe:{enumerable:!0,get:function(){return sr[ht]}})}}),Ar.default=sr,Object.freeze(Ar)}var s=n(e),o=n(r);const c=t.secp256k1.ProjectivePoint,u="Expected Private",f="Expected Point",x="Expected Tweak",p="Expected Hash",g="Expected Signature",y="Expected Extra Data (32 bytes)",b="Expected Scalar",R="Bad Recovery Id",D=32,k=32,Re=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,186,174,220,230,175,72,160,59,191,210,94,140,208,54,65,65]),Fe=32,O=new Uint8Array(32),$e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,69,81,35,25,80,183,95,196,64,45,161,114,47,201,186,238]),ze=BigInt(1);function q(sr){return sr instanceof Uint8Array}function W(sr,Ar){for(let ht=0;ht<32;++ht)if(sr[ht]!==Ar[ht])return sr[ht]<Ar[ht]?-1:1;return 0}function We(sr){return W(sr,O)===0}function Xe(sr){return!(!(sr instanceof Uint8Array)||sr.length!==k||W(sr,Re)>=0)}function it(sr){return sr instanceof Uint8Array&&sr.length===64&&W(sr.subarray(0,32),Re)<0&&W(sr.subarray(32,64),Re)<0}function Ve(sr){return q(sr)&&sr.length===64&&W(sr.subarray(0,32),$e)<0}function v(sr){return!(We(sr.subarray(0,32))||We(sr.subarray(32,64)))}function I(sr){return sr instanceof Uint8Array&&sr.length===D}function Ce(sr){return sr===void 0||sr instanceof Uint8Array&&sr.length===Fe}function P(sr){let Ar;if(typeof sr=="bigint")Ar=sr;else if(typeof sr=="number"&&Number.isSafeInteger(sr)&&sr>=0)Ar=BigInt(sr);else if(typeof sr=="string"){if(sr.length!==64)throw new Error("Expected 32 bytes of private scalar");Ar=o.hexToNumber(sr)}else if(sr instanceof Uint8Array){if(sr.length!==32)throw new Error("Expected 32 bytes of private scalar");Ar=o.bytesToNumberBE(sr)}else throw new TypeError("Expected valid private scalar");if(Ar<0)throw new Error("Expected private scalar >= 0");return Ar}function _e(sr){return t.secp256k1.utils.normPrivateKeyToScalar(sr)}function Le(sr,Ar){const ht=_e(sr),Qe=P(Ar),lt=o.numberToBytesBE(s.mod(ht+Qe,t.secp256k1.CURVE.n),32);return t.secp256k1.utils.isValidPrivateKey(lt)?lt:null}function Ye(sr,Ar){const ht=_e(sr),Qe=P(Ar),lt=o.numberToBytesBE(s.mod(ht-Qe,t.secp256k1.CURVE.n),32);return t.secp256k1.utils.isValidPrivateKey(lt)?lt:null}function je(sr){const Ar=_e(sr),ht=o.numberToBytesBE(t.secp256k1.CURVE.n-Ar,32);return t.secp256k1.utils.isValidPrivateKey(ht)?ht:null}function K(sr,Ar,ht){const Qe=pt(sr),lt=P(Ar),ar=c.BASE.multiplyAndAddUnsafe(Qe,lt,ze);if(!ar)throw new Error("Tweaked point at infinity");return ar.toRawBytes(ht)}function L(sr,Ar,ht){const Qe=pt(sr),lt=typeof Ar=="string"?Ar:o.bytesToHex(Ar),ar=o.hexToNumber(lt);return Qe.multiply(ar).toRawBytes(ht)}function st(sr,Ar){return sr===void 0?Ar!==void 0?fr(Ar):!0:!!sr}function dt(sr){try{return sr()}catch{return null}}function Je(sr){return t.schnorr.utils.lift_x(o.bytesToNumberBE(sr))}function pt(sr){return sr.length===32?Je(sr):c.fromHex(sr)}function rr(sr,Ar){if(sr.length===32!==Ar)return!1;try{return Ar?!!Je(sr):!!c.fromHex(sr)}catch{return!1}}function cr(sr){return rr(sr,!1)}function fr(sr){return rr(sr,!1)&&sr.length===33}function ir(sr){return t.secp256k1.utils.isValidPrivateKey(sr)}function ft(sr){return rr(sr,!0)}function nr(sr,Ar){if(!ft(sr))throw new Error(f);if(!Xe(Ar))throw new Error(x);return dt(()=>{const ht=K(sr,Ar,!0);return{parity:ht[0]%2===1?1:0,xOnlyPubkey:ht.slice(1)}})}function lr(sr){if(!cr(sr))throw new Error(f);return sr.slice(1,33)}function er(sr,Ar){if(!ir(sr))throw new Error(u);return dt(()=>t.secp256k1.getPublicKey(sr,st(Ar)))}function pr(sr){if(!ir(sr))throw new Error(u);return lr(er(sr))}function Er(sr,Ar){if(!cr(sr))throw new Error(f);return pt(sr).toRawBytes(st(Ar,sr))}function xr(sr,Ar,ht){if(!cr(sr))throw new Error(f);if(!Xe(Ar))throw new Error(x);return dt(()=>L(sr,Ar,st(ht,sr)))}function wr(sr,Ar,ht){if(!cr(sr)||!cr(Ar))throw new Error(f);return dt(()=>{const Qe=pt(sr),lt=pt(Ar);return Qe.equals(lt.negate())?null:Qe.add(lt).toRawBytes(st(ht,sr))})}function Br(sr,Ar,ht){if(!cr(sr))throw new Error(f);if(!Xe(Ar))throw new Error(x);return dt(()=>K(sr,Ar,st(ht,sr)))}function hr(sr,Ar){if(!ir(sr))throw new Error(u);if(!Xe(Ar))throw new Error(x);return dt(()=>Le(sr,Ar))}function Cr(sr,Ar){if(!ir(sr))throw new Error(u);if(!Xe(Ar))throw new Error(x);return dt(()=>Ye(sr,Ar))}function _r(sr){if(!ir(sr))throw new Error(u);return je(sr)}function Tr(sr,Ar,ht){if(!ir(Ar))throw new Error(u);if(!I(sr))throw new Error(b);if(!Ce(ht))throw new Error(y);return t.secp256k1.sign(sr,Ar,{extraEntropy:ht}).toCompactRawBytes()}function Nr(sr,Ar,ht){if(!ir(Ar))throw new Error(u);if(!I(sr))throw new Error(b);if(!Ce(ht))throw new Error(y);const Qe=t.secp256k1.sign(sr,Ar,{extraEntropy:ht});return{signature:Qe.toCompactRawBytes(),recoveryId:Qe.recovery}}function or(sr,Ar,ht){if(!ir(Ar))throw new Error(u);if(!I(sr))throw new Error(b);if(!Ce(ht))throw new Error(y);return t.schnorr.sign(sr,Ar,ht)}function tr(sr,Ar,ht,Qe){if(!I(sr))throw new Error(p);if(!it(Ar)||!v(Ar))throw new Error(g);if(ht&2&&!Ve(Ar))throw new Error(R);if(!ft(Ar.subarray(0,32)))throw new Error(g);const ar=t.secp256k1.Signature.fromCompact(Ar).addRecoveryBit(ht).recoverPublicKey(sr);if(!ar)throw new Error(g);return ar.toRawBytes(st(Qe))}function yr(sr,Ar,ht,Qe){if(!cr(Ar))throw new Error(f);if(!it(ht))throw new Error(g);if(!I(sr))throw new Error(b);return t.secp256k1.verify(ht,sr,Ar,{lowS:Qe})}function mr(sr,Ar,ht){if(!ft(Ar))throw new Error(f);if(!it(ht))throw new Error(g);if(!I(sr))throw new Error(b);return t.schnorr.verify(ht,sr,Ar)}return dist.isPoint=cr,dist.isPointCompressed=fr,dist.isPrivate=ir,dist.isXOnlyPoint=ft,dist.pointAdd=wr,dist.pointAddScalar=Br,dist.pointCompress=Er,dist.pointFromScalar=er,dist.pointMultiply=xr,dist.privateAdd=hr,dist.privateNegate=_r,dist.privateSub=Cr,dist.recover=tr,dist.sign=Tr,dist.signRecoverable=Nr,dist.signSchnorr=or,dist.verify=yr,dist.verifySchnorr=mr,dist.xOnlyPointAddTweak=nr,dist.xOnlyPointFromPoint=lr,dist.xOnlyPointFromScalar=pr,dist}var distExports=requireDist();const index=getDefaultExportFromCjs$1(distExports),ecc=_mergeNamespaces({__proto__:null,default:index},[distExports]),bitcoin={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128};var store;function getGlobalConfig(t){return{lang:t?.lang??store?.lang,message:t?.message,abortEarly:t?.abortEarly??store?.abortEarly,abortPipeEarly:t?.abortPipeEarly??store?.abortPipeEarly}}var store2;function getGlobalMessage(t){return store2?.get(t)}var store3;function getSchemaMessage(t){return store3?.get(t)}var store4;function getSpecificMessage(t,e){return store4?.get(t)?.get(e)}function _stringify(t){const e=typeof t;return e==="string"?`"${t}"`:e==="number"||e==="bigint"||e==="boolean"?`${t}`:e==="object"||e==="function"?(t&&Object.getPrototypeOf(t)?.constructor?.name)??"null":e}function _addIssue(t,e,r,n,s){const o=s&&"input"in s?s.input:r.value,c=s?.expected??t.expects??null,u=s?.received??_stringify(o),f={kind:t.kind,type:t.type,input:o,expected:c,received:u,message:`Invalid ${e}: ${c?`Expected ${c} but r`:"R"}eceived ${u}`,requirement:t.requirement,path:s?.path,issues:s?.issues,lang:n.lang,abortEarly:n.abortEarly,abortPipeEarly:n.abortPipeEarly},x=t.kind==="schema",p=s?.message??t.message??getSpecificMessage(t.reference,f.lang)??(x?getSchemaMessage(f.lang):null)??n.message??getGlobalMessage(f.lang);p&&(f.message=typeof p=="function"?p(f):p),x&&(r.typed=!1),r.issues?r.issues.push(f):r.issues=[f]}var ValiError=class extends Error{issues;constructor(t){super(t[0].message),this.name="ValiError",this.issues=t}};function integer(t){return{kind:"validation",type:"integer",reference:integer,async:!1,expects:null,requirement:Number.isInteger,message:t,_run(e,r){return e.typed&&!this.requirement(e.value)&&_addIssue(this,"integer",e,r),e}}}function length(t,e){return{kind:"validation",type:"length",reference:length,async:!1,expects:`${t}`,requirement:t,message:e,_run(r,n){return r.typed&&r.value.length!==this.requirement&&_addIssue(this,"length",r,n,{received:`${r.value.length}`}),r}}}function maxValue(t,e){return{kind:"validation",type:"max_value",reference:maxValue,async:!1,expects:`<=${t instanceof Date?t.toJSON():_stringify(t)}`,requirement:t,message:e,_run(r,n){return r.typed&&r.value>this.requirement&&_addIssue(this,"value",r,n,{received:r.value instanceof Date?r.value.toJSON():_stringify(r.value)}),r}}}function minValue(t,e){return{kind:"validation",type:"min_value",reference:minValue,async:!1,expects:`>=${t instanceof Date?t.toJSON():_stringify(t)}`,requirement:t,message:e,_run(r,n){return r.typed&&r.value<this.requirement&&_addIssue(this,"value",r,n,{received:r.value instanceof Date?r.value.toJSON():_stringify(r.value)}),r}}}function transform(t){return{kind:"transformation",type:"transform",reference:transform,async:!1,operation:t,_run(e){return e.value=this.operation(e.value),e}}}function getDefault(t,e,r){return typeof t.default=="function"?t.default(e,r):t.default}function boolean(t){return{kind:"schema",type:"boolean",reference:boolean,expects:"boolean",async:!1,message:t,_run(e,r){return typeof e.value=="boolean"?e.typed=!0:_addIssue(this,"type",e,r),e}}}function instance(t,e){return{kind:"schema",type:"instance",reference:instance,expects:t.name,async:!1,class:t,message:e,_run(r,n){return r.value instanceof this.class?r.typed=!0:_addIssue(this,"type",r,n),r}}}function number(t){return{kind:"schema",type:"number",reference:number,expects:"number",async:!1,message:t,_run(e,r){return typeof e.value=="number"&&!isNaN(e.value)?e.typed=!0:_addIssue(this,"type",e,r),e}}}function object(t,e){return{kind:"schema",type:"object",reference:object,expects:"Object",async:!1,entries:t,message:e,_run(r,n){const s=r.value;if(s&&typeof s=="object"){r.typed=!0,r.value={};for(const o in this.entries){const c=s[o],u=this.entries[o]._run({typed:!1,value:c},n);if(u.issues){const f={type:"object",origin:"value",input:s,key:o,value:c};for(const x of u.issues)x.path?x.path.unshift(f):x.path=[f],r.issues?.push(x);if(r.issues||(r.issues=u.issues),n.abortEarly){r.typed=!1;break}}u.typed||(r.typed=!1),(u.value!==void 0||o in s)&&(r.value[o]=u.value)}}else _addIssue(this,"type",r,n);return r}}}function optional(t,...e){const r={kind:"schema",type:"optional",reference:optional,expects:`${t.expects} | undefined`,async:!1,wrapped:t,_run(n,s){return n.value===void 0&&("default"in this&&(n.value=getDefault(this,n,s)),n.value===void 0)?(n.typed=!0,n):this.wrapped._run(n,s)}};return 0 in e&&(r.default=e[0]),r}function string(t){return{kind:"schema",type:"string",reference:string,expects:"string",async:!1,message:t,_run(e,r){return typeof e.value=="string"?e.typed=!0:_addIssue(this,"type",e,r),e}}}function _subIssues(t){let e;if(t)for(const r of t)e?e.push(...r.issues):e=r.issues;return e}function union(t,e){return{kind:"schema",type:"union",reference:union,expects:[...new Set(t.map(r=>r.expects))].join(" | ")||"never",async:!1,options:t,message:e,_run(r,n){let s,o,c;for(const u of this.options){const f=u._run({typed:!1,value:r.value},n);if(f.typed)if(f.issues)o?o.push(f):o=[f];else{s=f;break}else c?c.push(f):c=[f]}if(s)return s;if(o){if(o.length===1)return o[0];_addIssue(this,"type",r,n,{issues:_subIssues(o)}),r.typed=!0}else{if(c?.length===1)return c[0];_addIssue(this,"type",r,n,{issues:_subIssues(c)})}return r}}}function parse(t,e,r){const n=t._run({typed:!1,value:e},getGlobalConfig(r));if(n.issues)throw new ValiError(n.issues);return n.value}function pipe(...t){return{...t[0],pipe:t,_run(e,r){for(const n of t)if(n.kind!=="metadata"){if(e.issues&&(n.kind==="schema"||n.kind==="transformation")){e.typed=!1;break}(!e.issues||!r.abortEarly&&!r.abortPipeEarly)&&(e=n._run(e,r))}return e}}}const Uint32Schema=pipe(number(),integer(),minValue(0),maxValue(4294967295)),Uint8Schema=pipe(number(),integer(),minValue(0),maxValue(255)),NetworkSchema=object({messagePrefix:union([string(),instance(Uint8Array)]),bech32:string(),bip32:object({public:Uint32Schema,private:Uint32Schema}),pubKeyHash:Uint8Schema,scriptHash:Uint8Schema,wif:Uint8Schema}),Buffer256Bit=pipe(instance(Uint8Array),length(32));function decodeRaw(t,e){if(t.length===33)return{version:t[0],privateKey:t.slice(1,33),compressed:!1};if(t.length!==34)throw new Error("Invalid WIF length");if(t[33]!==1)throw new Error("Invalid compression flag");return{version:t[0],privateKey:t.slice(1,33),compressed:!0}}function encodeRaw(t,e,r){if(e.length!==32)throw new TypeError("Invalid privateKey length");var n=new Uint8Array(r?34:33),s=new DataView(n.buffer);return s.setUint8(0,t),n.set(e,1),r&&(n[33]=1),n}function decode$1(t,e){return decodeRaw(bs58Check.decode(t))}function encode(t){return bs58Check.encode(encodeRaw(t.version,t.privateKey,t.compressed))}const h=t=>Buffer.from(t,"hex");function testEcc(t){assert(t.isPoint(h("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),assert(!t.isPoint(h("030000000000000000000000000000000000000000000000000000000000000005"))),assert(t.isPrivate(h("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),assert(t.isPrivate(h("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140"))),assert(!t.isPrivate(h("0000000000000000000000000000000000000000000000000000000000000000"))),assert(!t.isPrivate(h("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"))),assert(!t.isPrivate(h("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364142"))),assert(Buffer.from(t.privateAdd(h("0000000000000000000000000000000000000000000000000000000000000001"),h("0000000000000000000000000000000000000000000000000000000000000000"))).equals(h("0000000000000000000000000000000000000000000000000000000000000001"))),assert(t.privateAdd(h("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd036413e"),h("0000000000000000000000000000000000000000000000000000000000000003"))===null),assert(Buffer.from(t.privateAdd(h("e211078564db65c3ce7704f08262b1f38f1ef412ad15b5ac2d76657a63b2c500"),h("b51fbb69051255d1becbd683de5848242a89c229348dd72896a87ada94ae8665"))).equals(h("9730c2ee69edbb958d42db7460bafa18fef9d955325aec99044c81c8282b0a24"))),assert(Buffer.from(t.privateNegate(h("0000000000000000000000000000000000000000000000000000000000000001"))).equals(h("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140"))),assert(Buffer.from(t.privateNegate(h("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd036413e"))).equals(h("0000000000000000000000000000000000000000000000000000000000000003"))),assert(Buffer.from(t.privateNegate(h("b1121e4088a66a28f5b6b0f5844943ecd9f610196d7bb83b25214b60452c09af"))).equals(h("4eede1bf775995d70a494f0a7bb6bc11e0b8cccd41cce8009ab1132c8b0a3792"))),assert(Buffer.from(t.pointCompress(h("0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8"),!0)).equals(h("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),assert(Buffer.from(t.pointCompress(h("0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8"),!1)).equals(h("0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8"))),assert(Buffer.from(t.pointCompress(h("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),!0)).equals(h("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),assert(Buffer.from(t.pointCompress(h("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),!1)).equals(h("0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8"))),assert(Buffer.from(t.pointFromScalar(h("b1121e4088a66a28f5b6b0f5844943ecd9f610196d7bb83b25214b60452c09af"))).equals(h("02b07ba9dca9523b7ef4bd97703d43d20399eb698e194704791a25ce77a400df99"))),assert(t.xOnlyPointAddTweak(h("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),h("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140"))===null);let e=t.xOnlyPointAddTweak(h("1617d38ed8d8657da4d4761e8057bc396ea9e4b9d29776d4be096016dbd2509b"),h("a8397a935f0dfceba6ba9618f6451ef4d80637abf4e6af2669fbc9de6a8fd2ac"));assert(Buffer.from(e.xOnlyPubkey).equals(h("e478f99dab91052ab39a33ea35fd5e6e4933f4d28023cd597c9a1f6760346adf"))&&e.parity===1),e=t.xOnlyPointAddTweak(h("2c0b7cf95324a07d05398b240174dc0c2be444d96b159aa6c7f7b1e668680991"),h("823c3cd2142744b075a87eade7e1b8678ba308d566226a0056ca2b7a76f86b47")),assert(Buffer.from(e.xOnlyPubkey).equals(h("9534f8dc8c6deda2dc007655981c78b49c5d96c778fbf363462a11ec9dfd948c"))&&e.parity===0),assert(Buffer.from(t.sign(h("5e9f0a0d593efdcf78ac923bc3313e4e7d408d574354ee2b3288c0da9fbba6ed"),h("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140"))).equals(h("54c4a33c6423d689378f160a7ff8b61330444abb58fb470f96ea16d99d4a2fed07082304410efa6b2943111b6a4e0aaa7b7db55a07e9861d1fb3cb1f421044a5"))),assert(t.verify(h("5e9f0a0d593efdcf78ac923bc3313e4e7d408d574354ee2b3288c0da9fbba6ed"),h("0379be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),h("54c4a33c6423d689378f160a7ff8b61330444abb58fb470f96ea16d99d4a2fed07082304410efa6b2943111b6a4e0aaa7b7db55a07e9861d1fb3cb1f421044a5"))),t.signSchnorr&&assert(Buffer.from(t.signSchnorr(h("7e2d58d8b3bcdf1abadec7829054f90dda9805aab56c77333024b9d0a508b75c"),h("c90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b14e5c9"),h("c87aa53824b4d7ae2eb035a2b5bbbccc080e76cdc6d1692c4b0b62d798e6d906"))).equals(h("5831aaeed7b44bb74e5eab94ba9d4294c49bcf2a60728d8b4c200f50dd313c1bab745879a5ad954a72c45a91c3a51d3c7adea98d82f8481e0e1e03674a6f3fb7"))),t.verifySchnorr&&assert(t.verifySchnorr(h("7e2d58d8b3bcdf1abadec7829054f90dda9805aab56c77333024b9d0a508b75c"),h("dd308afec5777e13121fa72b9cc1b7cc0139715309b086c960e18fd969774eb8"),h("5831aaeed7b44bb74e5eab94ba9d4294c49bcf2a60728d8b4c200f50dd313c1bab745879a5ad954a72c45a91c3a51d3c7adea98d82f8481e0e1e03674a6f3fb7")))}function assert(t){if(!t)throw new Error("ecc library invalid")}const HEX_STRINGS="0123456789abcdefABCDEF";HEX_STRINGS.split("").map(t=>t.codePointAt(0));Array(256).fill(!0).map((t,e)=>{const r=String.fromCodePoint(e),n=HEX_STRINGS.indexOf(r);return n<0?void 0:n<16?n:n-6});new TextEncoder;new TextDecoder;function concat(t){const e=t.reduce((s,o)=>s+o.length,0),r=new Uint8Array(e);let n=0;for(const s of t)r.set(s,n),n+=s.length;return r}function writeUInt32(t,e,r,n){if(e+4>t.length)throw new Error("Offset is outside the bounds of Uint8Array");if(n=n.toUpperCase(),r>4294967295)throw new Error(`The value of "value" is out of range. It must be >= 0 and <= ${4294967295}. Received ${r}`);n==="LE"?(t[e]=r&255,t[e+1]=r>>8&255,t[e+2]=r>>16&255,t[e+3]=r>>24&255):(t[e]=r>>24&255,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=r&255)}const ECPairOptionsSchema=optional(object({compressed:optional(boolean()),network:optional(NetworkSchema),rng:optional(pipe(instance(Function),transform(t=>e=>{const r=parse(optional(number()),e),n=t(r);return parse(instance(Uint8Array),n)})))})),toXOnly=t=>t.length===32?t:t.subarray(1,33);function ECPairFactory(t){testEcc(t);function e(u){return t.isPoint(u)}function r(u,f){if(parse(Buffer256Bit,u),!t.isPrivate(u))throw new TypeError("Private key not in range [1, n)");return parse(ECPairOptionsSchema,f),new c(u,void 0,f)}function n(u,f){if(!t.isPoint(u))throw new Error("Point not on the curve");return parse(ECPairOptionsSchema,f),new c(void 0,u,f)}function s(u,f){const x=decode$1(u),p=x.version;if(Array.isArray(f)){if(f=f.filter(g=>p===g.wif).pop(),!f)throw new Error("Unknown network version")}else if(f=f||bitcoin,p!==f.wif)throw new Error("Invalid network version");return r(x.privateKey,{compressed:x.compressed,network:f})}function o(u){parse(ECPairOptionsSchema,u),u===void 0&&(u={});const f=u.rng||(p=>crypto.getRandomValues(new Uint8Array(p)));let x;do x=f(32),parse(Buffer256Bit,x);while(!t.isPrivate(x));return r(x,u)}class c{__D;__Q;compressed;network;lowR;constructor(f,x,p){this.__D=f,this.__Q=x,this.lowR=!1,p===void 0&&(p={}),this.compressed=p.compressed===void 0?!0:p.compressed,this.network=p.network||bitcoin,x!==void 0&&(this.__Q=t.pointCompress(x,this.compressed))}get privateKey(){return this.__D}get publicKey(){if(!this.__Q){const f=t.pointFromScalar(this.__D,this.compressed);this.__Q=f}return this.__Q}toWIF(){if(!this.__D)throw new Error("Missing private key");return encode({compressed:this.compressed,privateKey:this.__D,version:this.network.wif})}tweak(f){return this.privateKey?this.tweakFromPrivateKey(f):this.tweakFromPublicKey(f)}sign(f,x){if(!this.__D)throw new Error("Missing private key");if(x===void 0&&(x=this.lowR),x===!1)return t.sign(f,this.__D);{let p=t.sign(f,this.__D);const g=new Uint8Array(32);let y=0;for(;p[0]>127;)y++,writeUInt32(g,0,y,"LE"),p=t.sign(f,this.__D,g);return p}}signSchnorr(f){if(!this.privateKey)throw new Error("Missing private key");if(!t.signSchnorr)throw new Error("signSchnorr not supported by ecc library");return t.signSchnorr(f,this.privateKey)}verify(f,x){return t.verify(f,this.publicKey,x)}verifySchnorr(f,x){if(!t.verifySchnorr)throw new Error("verifySchnorr not supported by ecc library");return t.verifySchnorr(f,this.publicKey.subarray(1,33),x)}tweakFromPublicKey(f){const x=toXOnly(this.publicKey),p=t.xOnlyPointAddTweak(x,f);if(!p||p.xOnlyPubkey===null)throw new Error("Cannot tweak public key!");const g=Uint8Array.from([p.parity===0?2:3]);return n(concat([g,p.xOnlyPubkey]),{network:this.network,compressed:this.compressed})}tweakFromPrivateKey(f){const p=this.publicKey[0]===3||this.publicKey[0]===4&&(this.publicKey[64]&1)===1?t.privateNegate(this.privateKey):this.privateKey,g=t.privateAdd(p,f);if(!g)throw new Error("Invalid tweaked private key!");return r(g,{network:this.network,compressed:this.compressed})}}return{isPoint:e,fromPrivateKey:r,fromPublicKey:n,fromWIF:s,makeRandom:o}}let ECPair=null;function getECPair(){return ECPair||(initEccLib(ecc),ECPair=ECPairFactory(ecc)),ECPair}function nostrPubkeyToBitcoinAddress(t){try{getECPair();const e=Buffer.from(t,"hex"),{address:r}=p2tr({internalPubkey:e,network:bitcoin$1});return r||""}catch(e){return console.error("Error generating Bitcoin address:",e),""}}function npubToBitcoinAddress(t){try{const e=nip19_exports$1.decode(t);if(e.type!=="npub")throw new Error("Invalid npub format");const r=e.data;return nostrPubkeyToBitcoinAddress(r)}catch(e){throw console.error("Error converting npub to Bitcoin address:",e),e}}async function fetchUTXOs(t){const e=await fetch(`https://blockstream.info/api/address/${t}/utxo`);if(!e.ok)throw new Error("Failed to fetch UTXOs");return e.json()}async function getFeeRates(){const t=await fetch("https://blockstream.info/api/fee-estimates");if(!t.ok)throw new Error("Failed to fetch fee estimates");const e=await t.json();return{fastestFee:Math.ceil(e[1]||1),halfHourFee:Math.ceil(e[3]||1),hourFee:Math.ceil(e[6]||1),economyFee:Math.ceil(e[144]||1),minimumFee:Math.ceil(e[504]||1)}}async function broadcastTransaction(t){const e=await fetch("https://blockstream.info/api/tx",{method:"POST",body:t});if(!e.ok){const r=await e.text();throw new Error(`Failed to broadcast transaction: ${r}`)}return e.text()}async function createBitcoinTransaction(t,e,r,n,s){const o=Buffer.from(t,"hex"),c=getECPair().fromPrivateKey(o),u=c.publicKey.slice(1,33),{address:f}=p2tr({internalPubkey:u,network:bitcoin$1});if(!f)throw new Error("Failed to generate change address");const x=new Psbt({network:bitcoin$1});let p=0;for(const Re of n)x.addInput({hash:Re.txid,index:Re.vout,witnessUtxo:{script:p2tr({internalPubkey:u,network:bitcoin$1}).output,value:BigInt(Re.value)},tapInternalKey:u}),p+=Re.value;const g=n.length*57.5+86+10.5,y=Math.ceil(g*s),b=p-r-y;if(b<0)throw new Error(`Insufficient funds. Need ${r+y} sats, have ${p} sats`);x.addOutput({address:e,value:BigInt(r)}),b>546&&x.addOutput({address:f,value:BigInt(b)});const D=c.tweak(taggedHash("TapTweak",u));for(let Re=0;Re<n.length;Re++)x.signInput(Re,D);return x.finalizeAllInputs(),{txHex:x.extractTransaction().toHex(),fee:y}}function satsToBTC(t){return(t/1e8).toFixed(8)}function btcToSats(t){return Math.round(t*1e8)}async function fetchTxHistory(t){const e=await fetch(`https://blockstream.info/api/address/${t}/txs`);if(!e.ok)throw new Error("Failed to fetch transaction history");return e.json()}var browser={},canPromise,hasRequiredCanPromise;function requireCanPromise(){return hasRequiredCanPromise||(hasRequiredCanPromise=1,canPromise=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),canPromise}var qrcode={},utils$1={},hasRequiredUtils$1;function requireUtils$1(){if(hasRequiredUtils$1)return utils$1;hasRequiredUtils$1=1;let t;const e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return utils$1.getSymbolSize=function(n){if(!n)throw new Error('"version" cannot be null or undefined');if(n<1||n>40)throw new Error('"version" should be in range from 1 to 40');return n*4+17},utils$1.getSymbolTotalCodewords=function(n){return e[n]},utils$1.getBCHDigit=function(r){let n=0;for(;r!==0;)n++,r>>>=1;return n},utils$1.setToSJISFunction=function(n){if(typeof n!="function")throw new Error('"toSJISFunc" is not a valid function.');t=n},utils$1.isKanjiModeEnabled=function(){return typeof t<"u"},utils$1.toSJIS=function(n){return t(n)},utils$1}var errorCorrectionLevel={},hasRequiredErrorCorrectionLevel;function requireErrorCorrectionLevel(){return hasRequiredErrorCorrectionLevel||(hasRequiredErrorCorrectionLevel=1,(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+r)}}t.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},t.from=function(n,s){if(t.isValid(n))return n;try{return e(n)}catch{return s}}})(errorCorrectionLevel)),errorCorrectionLevel}var bitBuffer,hasRequiredBitBuffer;function requireBitBuffer(){if(hasRequiredBitBuffer)return bitBuffer;hasRequiredBitBuffer=1;function t(){this.buffer=[],this.length=0}return t.prototype={get:function(e){const r=Math.floor(e/8);return(this.buffer[r]>>>7-e%8&1)===1},put:function(e,r){for(let n=0;n<r;n++)this.putBit((e>>>r-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const r=Math.floor(this.length/8);this.buffer.length<=r&&this.buffer.push(0),e&&(this.buffer[r]|=128>>>this.length%8),this.length++}},bitBuffer=t,bitBuffer}var bitMatrix,hasRequiredBitMatrix;function requireBitMatrix(){if(hasRequiredBitMatrix)return bitMatrix;hasRequiredBitMatrix=1;function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return t.prototype.set=function(e,r,n,s){const o=e*this.size+r;this.data[o]=n,s&&(this.reservedBit[o]=!0)},t.prototype.get=function(e,r){return this.data[e*this.size+r]},t.prototype.xor=function(e,r,n){this.data[e*this.size+r]^=n},t.prototype.isReserved=function(e,r){return this.reservedBit[e*this.size+r]},bitMatrix=t,bitMatrix}var alignmentPattern={},hasRequiredAlignmentPattern;function requireAlignmentPattern(){return hasRequiredAlignmentPattern||(hasRequiredAlignmentPattern=1,(function(t){const e=requireUtils$1().getSymbolSize;t.getRowColCoords=function(n){if(n===1)return[];const s=Math.floor(n/7)+2,o=e(n),c=o===145?26:Math.ceil((o-13)/(2*s-2))*2,u=[o-7];for(let f=1;f<s-1;f++)u[f]=u[f-1]-c;return u.push(6),u.reverse()},t.getPositions=function(n){const s=[],o=t.getRowColCoords(n),c=o.length;for(let u=0;u<c;u++)for(let f=0;f<c;f++)u===0&&f===0||u===0&&f===c-1||u===c-1&&f===0||s.push([o[u],o[f]]);return s}})(alignmentPattern)),alignmentPattern}var finderPattern={},hasRequiredFinderPattern;function requireFinderPattern(){if(hasRequiredFinderPattern)return finderPattern;hasRequiredFinderPattern=1;const t=requireUtils$1().getSymbolSize,e=7;return finderPattern.getPositions=function(n){const s=t(n);return[[0,0],[s-e,0],[0,s-e]]},finderPattern}var maskPattern={},hasRequiredMaskPattern;function requireMaskPattern(){return hasRequiredMaskPattern||(hasRequiredMaskPattern=1,(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(s){return s!=null&&s!==""&&!isNaN(s)&&s>=0&&s<=7},t.from=function(s){return t.isValid(s)?parseInt(s,10):void 0},t.getPenaltyN1=function(s){const o=s.size;let c=0,u=0,f=0,x=null,p=null;for(let g=0;g<o;g++){u=f=0,x=p=null;for(let y=0;y<o;y++){let b=s.get(g,y);b===x?u++:(u>=5&&(c+=e.N1+(u-5)),x=b,u=1),b=s.get(y,g),b===p?f++:(f>=5&&(c+=e.N1+(f-5)),p=b,f=1)}u>=5&&(c+=e.N1+(u-5)),f>=5&&(c+=e.N1+(f-5))}return c},t.getPenaltyN2=function(s){const o=s.size;let c=0;for(let u=0;u<o-1;u++)for(let f=0;f<o-1;f++){const x=s.get(u,f)+s.get(u,f+1)+s.get(u+1,f)+s.get(u+1,f+1);(x===4||x===0)&&c++}return c*e.N2},t.getPenaltyN3=function(s){const o=s.size;let c=0,u=0,f=0;for(let x=0;x<o;x++){u=f=0;for(let p=0;p<o;p++)u=u<<1&2047|s.get(x,p),p>=10&&(u===1488||u===93)&&c++,f=f<<1&2047|s.get(p,x),p>=10&&(f===1488||f===93)&&c++}return c*e.N3},t.getPenaltyN4=function(s){let o=0;const c=s.data.length;for(let f=0;f<c;f++)o+=s.data[f];return Math.abs(Math.ceil(o*100/c/5)-10)*e.N4};function r(n,s,o){switch(n){case t.Patterns.PATTERN000:return(s+o)%2===0;case t.Patterns.PATTERN001:return s%2===0;case t.Patterns.PATTERN010:return o%3===0;case t.Patterns.PATTERN011:return(s+o)%3===0;case t.Patterns.PATTERN100:return(Math.floor(s/2)+Math.floor(o/3))%2===0;case t.Patterns.PATTERN101:return s*o%2+s*o%3===0;case t.Patterns.PATTERN110:return(s*o%2+s*o%3)%2===0;case t.Patterns.PATTERN111:return(s*o%3+(s+o)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}t.applyMask=function(s,o){const c=o.size;for(let u=0;u<c;u++)for(let f=0;f<c;f++)o.isReserved(f,u)||o.xor(f,u,r(s,f,u))},t.getBestMask=function(s,o){const c=Object.keys(t.Patterns).length;let u=0,f=1/0;for(let x=0;x<c;x++){o(x),t.applyMask(x,s);const p=t.getPenaltyN1(s)+t.getPenaltyN2(s)+t.getPenaltyN3(s)+t.getPenaltyN4(s);t.applyMask(x,s),p<f&&(f=p,u=x)}return u}})(maskPattern)),maskPattern}var errorCorrectionCode={},hasRequiredErrorCorrectionCode;function requireErrorCorrectionCode(){if(hasRequiredErrorCorrectionCode)return errorCorrectionCode;hasRequiredErrorCorrectionCode=1;const t=requireErrorCorrectionLevel(),e=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],r=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return errorCorrectionCode.getBlocksCount=function(s,o){switch(o){case t.L:return e[(s-1)*4+0];case t.M:return e[(s-1)*4+1];case t.Q:return e[(s-1)*4+2];case t.H:return e[(s-1)*4+3];default:return}},errorCorrectionCode.getTotalCodewordsCount=function(s,o){switch(o){case t.L:return r[(s-1)*4+0];case t.M:return r[(s-1)*4+1];case t.Q:return r[(s-1)*4+2];case t.H:return r[(s-1)*4+3];default:return}},errorCorrectionCode}var polynomial={},galoisField={},hasRequiredGaloisField;function requireGaloisField(){if(hasRequiredGaloisField)return galoisField;hasRequiredGaloisField=1;const t=new Uint8Array(512),e=new Uint8Array(256);return(function(){let n=1;for(let s=0;s<255;s++)t[s]=n,e[n]=s,n<<=1,n&256&&(n^=285);for(let s=255;s<512;s++)t[s]=t[s-255]})(),galoisField.log=function(n){if(n<1)throw new Error("log("+n+")");return e[n]},galoisField.exp=function(n){return t[n]},galoisField.mul=function(n,s){return n===0||s===0?0:t[e[n]+e[s]]},galoisField}var hasRequiredPolynomial;function requirePolynomial(){return hasRequiredPolynomial||(hasRequiredPolynomial=1,(function(t){const e=requireGaloisField();t.mul=function(n,s){const o=new Uint8Array(n.length+s.length-1);for(let c=0;c<n.length;c++)for(let u=0;u<s.length;u++)o[c+u]^=e.mul(n[c],s[u]);return o},t.mod=function(n,s){let o=new Uint8Array(n);for(;o.length-s.length>=0;){const c=o[0];for(let f=0;f<s.length;f++)o[f]^=e.mul(s[f],c);let u=0;for(;u<o.length&&o[u]===0;)u++;o=o.slice(u)}return o},t.generateECPolynomial=function(n){let s=new Uint8Array([1]);for(let o=0;o<n;o++)s=t.mul(s,new Uint8Array([1,e.exp(o)]));return s}})(polynomial)),polynomial}var reedSolomonEncoder,hasRequiredReedSolomonEncoder;function requireReedSolomonEncoder(){if(hasRequiredReedSolomonEncoder)return reedSolomonEncoder;hasRequiredReedSolomonEncoder=1;const t=requirePolynomial();function e(r){this.genPoly=void 0,this.degree=r,this.degree&&this.initialize(this.degree)}return e.prototype.initialize=function(n){this.degree=n,this.genPoly=t.generateECPolynomial(this.degree)},e.prototype.encode=function(n){if(!this.genPoly)throw new Error("Encoder not initialized");const s=new Uint8Array(n.length+this.degree);s.set(n);const o=t.mod(s,this.genPoly),c=this.degree-o.length;if(c>0){const u=new Uint8Array(this.degree);return u.set(o,c),u}return o},reedSolomonEncoder=e,reedSolomonEncoder}var version={},mode={},versionCheck={},hasRequiredVersionCheck;function requireVersionCheck(){return hasRequiredVersionCheck||(hasRequiredVersionCheck=1,versionCheck.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),versionCheck}var regex={},hasRequiredRegex;function requireRegex(){if(hasRequiredRegex)return regex;hasRequiredRegex=1;const t="[0-9]+",e="[A-Z $%*+\\-./:]+";let r="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";r=r.replace(/u/g,"\\u");const n="(?:(?![A-Z0-9 $%*+\\-./:]|"+r+`)(?:.|[\r
]))+`;regex.KANJI=new RegExp(r,"g"),regex.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),regex.BYTE=new RegExp(n,"g"),regex.NUMERIC=new RegExp(t,"g"),regex.ALPHANUMERIC=new RegExp(e,"g");const s=new RegExp("^"+r+"$"),o=new RegExp("^"+t+"$"),c=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return regex.testKanji=function(f){return s.test(f)},regex.testNumeric=function(f){return o.test(f)},regex.testAlphanumeric=function(f){return c.test(f)},regex}var hasRequiredMode;function requireMode(){return hasRequiredMode||(hasRequiredMode=1,(function(t){const e=requireVersionCheck(),r=requireRegex();t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(o,c){if(!o.ccBits)throw new Error("Invalid mode: "+o);if(!e.isValid(c))throw new Error("Invalid version: "+c);return c>=1&&c<10?o.ccBits[0]:c<27?o.ccBits[1]:o.ccBits[2]},t.getBestModeForData=function(o){return r.testNumeric(o)?t.NUMERIC:r.testAlphanumeric(o)?t.ALPHANUMERIC:r.testKanji(o)?t.KANJI:t.BYTE},t.toString=function(o){if(o&&o.id)return o.id;throw new Error("Invalid mode")},t.isValid=function(o){return o&&o.bit&&o.ccBits};function n(s){if(typeof s!="string")throw new Error("Param is not a string");switch(s.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+s)}}t.from=function(o,c){if(t.isValid(o))return o;try{return n(o)}catch{return c}}})(mode)),mode}var hasRequiredVersion;function requireVersion(){return hasRequiredVersion||(hasRequiredVersion=1,(function(t){const e=requireUtils$1(),r=requireErrorCorrectionCode(),n=requireErrorCorrectionLevel(),s=requireMode(),o=requireVersionCheck(),c=7973,u=e.getBCHDigit(c);function f(y,b,R){for(let D=1;D<=40;D++)if(b<=t.getCapacity(D,R,y))return D}function x(y,b){return s.getCharCountIndicator(y,b)+4}function p(y,b){let R=0;return y.forEach(function(D){const k=x(D.mode,b);R+=k+D.getBitsLength()}),R}function g(y,b){for(let R=1;R<=40;R++)if(p(y,R)<=t.getCapacity(R,b,s.MIXED))return R}t.from=function(b,R){return o.isValid(b)?parseInt(b,10):R},t.getCapacity=function(b,R,D){if(!o.isValid(b))throw new Error("Invalid QR Code version");typeof D>"u"&&(D=s.BYTE);const k=e.getSymbolTotalCodewords(b),Re=r.getTotalCodewordsCount(b,R),Fe=(k-Re)*8;if(D===s.MIXED)return Fe;const O=Fe-x(D,b);switch(D){case s.NUMERIC:return Math.floor(O/10*3);case s.ALPHANUMERIC:return Math.floor(O/11*2);case s.KANJI:return Math.floor(O/13);case s.BYTE:default:return Math.floor(O/8)}},t.getBestVersionForData=function(b,R){let D;const k=n.from(R,n.M);if(Array.isArray(b)){if(b.length>1)return g(b,k);if(b.length===0)return 1;D=b[0]}else D=b;return f(D.mode,D.getLength(),k)},t.getEncodedBits=function(b){if(!o.isValid(b)||b<7)throw new Error("Invalid QR Code version");let R=b<<12;for(;e.getBCHDigit(R)-u>=0;)R^=c<<e.getBCHDigit(R)-u;return b<<12|R}})(version)),version}var formatInfo={},hasRequiredFormatInfo;function requireFormatInfo(){if(hasRequiredFormatInfo)return formatInfo;hasRequiredFormatInfo=1;const t=requireUtils$1(),e=1335,r=21522,n=t.getBCHDigit(e);return formatInfo.getEncodedBits=function(o,c){const u=o.bit<<3|c;let f=u<<10;for(;t.getBCHDigit(f)-n>=0;)f^=e<<t.getBCHDigit(f)-n;return(u<<10|f)^r},formatInfo}var segments={},numericData,hasRequiredNumericData;function requireNumericData(){if(hasRequiredNumericData)return numericData;hasRequiredNumericData=1;const t=requireMode();function e(r){this.mode=t.NUMERIC,this.data=r.toString()}return e.getBitsLength=function(n){return 10*Math.floor(n/3)+(n%3?n%3*3+1:0)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(n){let s,o,c;for(s=0;s+3<=this.data.length;s+=3)o=this.data.substr(s,3),c=parseInt(o,10),n.put(c,10);const u=this.data.length-s;u>0&&(o=this.data.substr(s),c=parseInt(o,10),n.put(c,u*3+1))},numericData=e,numericData}var alphanumericData,hasRequiredAlphanumericData;function requireAlphanumericData(){if(hasRequiredAlphanumericData)return alphanumericData;hasRequiredAlphanumericData=1;const t=requireMode(),e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function r(n){this.mode=t.ALPHANUMERIC,this.data=n}return r.getBitsLength=function(s){return 11*Math.floor(s/2)+6*(s%2)},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(s){let o;for(o=0;o+2<=this.data.length;o+=2){let c=e.indexOf(this.data[o])*45;c+=e.indexOf(this.data[o+1]),s.put(c,11)}this.data.length%2&&s.put(e.indexOf(this.data[o]),6)},alphanumericData=r,alphanumericData}var byteData,hasRequiredByteData;function requireByteData(){if(hasRequiredByteData)return byteData;hasRequiredByteData=1;const t=requireMode();function e(r){this.mode=t.BYTE,typeof r=="string"?this.data=new TextEncoder().encode(r):this.data=new Uint8Array(r)}return e.getBitsLength=function(n){return n*8},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(r){for(let n=0,s=this.data.length;n<s;n++)r.put(this.data[n],8)},byteData=e,byteData}var kanjiData,hasRequiredKanjiData;function requireKanjiData(){if(hasRequiredKanjiData)return kanjiData;hasRequiredKanjiData=1;const t=requireMode(),e=requireUtils$1();function r(n){this.mode=t.KANJI,this.data=n}return r.getBitsLength=function(s){return s*13},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(n){let s;for(s=0;s<this.data.length;s++){let o=e.toSJIS(this.data[s]);if(o>=33088&&o<=40956)o-=33088;else if(o>=57408&&o<=60351)o-=49472;else throw new Error("Invalid SJIS character: "+this.data[s]+`
Make sure your charset is UTF-8`);o=(o>>>8&255)*192+(o&255),n.put(o,13)}},kanjiData=r,kanjiData}var dijkstra={exports:{}},hasRequiredDijkstra;function requireDijkstra(){return hasRequiredDijkstra||(hasRequiredDijkstra=1,(function(t){var e={single_source_shortest_paths:function(r,n,s){var o={},c={};c[n]=0;var u=e.PriorityQueue.make();u.push(n,0);for(var f,x,p,g,y,b,R,D,k;!u.empty();){f=u.pop(),x=f.value,g=f.cost,y=r[x]||{};for(p in y)y.hasOwnProperty(p)&&(b=y[p],R=g+b,D=c[p],k=typeof c[p]>"u",(k||D>R)&&(c[p]=R,u.push(p,R),o[p]=x))}if(typeof s<"u"&&typeof c[s]>"u"){var Re=["Could not find a path from ",n," to ",s,"."].join("");throw new Error(Re)}return o},extract_shortest_path_from_predecessor_list:function(r,n){for(var s=[],o=n;o;)s.push(o),r[o],o=r[o];return s.reverse(),s},find_path:function(r,n,s){var o=e.single_source_shortest_paths(r,n,s);return e.extract_shortest_path_from_predecessor_list(o,s)},PriorityQueue:{make:function(r){var n=e.PriorityQueue,s={},o;r=r||{};for(o in n)n.hasOwnProperty(o)&&(s[o]=n[o]);return s.queue=[],s.sorter=r.sorter||n.default_sorter,s},default_sorter:function(r,n){return r.cost-n.cost},push:function(r,n){var s={value:r,cost:n};this.queue.push(s),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e})(dijkstra)),dijkstra.exports}var hasRequiredSegments;function requireSegments(){return hasRequiredSegments||(hasRequiredSegments=1,(function(t){const e=requireMode(),r=requireNumericData(),n=requireAlphanumericData(),s=requireByteData(),o=requireKanjiData(),c=requireRegex(),u=requireUtils$1(),f=requireDijkstra();function x(Re){return unescape(encodeURIComponent(Re)).length}function p(Re,Fe,O){const $e=[];let ze;for(;(ze=Re.exec(O))!==null;)$e.push({data:ze[0],index:ze.index,mode:Fe,length:ze[0].length});return $e}function g(Re){const Fe=p(c.NUMERIC,e.NUMERIC,Re),O=p(c.ALPHANUMERIC,e.ALPHANUMERIC,Re);let $e,ze;return u.isKanjiModeEnabled()?($e=p(c.BYTE,e.BYTE,Re),ze=p(c.KANJI,e.KANJI,Re)):($e=p(c.BYTE_KANJI,e.BYTE,Re),ze=[]),Fe.concat(O,$e,ze).sort(function(W,We){return W.index-We.index}).map(function(W){return{data:W.data,mode:W.mode,length:W.length}})}function y(Re,Fe){switch(Fe){case e.NUMERIC:return r.getBitsLength(Re);case e.ALPHANUMERIC:return n.getBitsLength(Re);case e.KANJI:return o.getBitsLength(Re);case e.BYTE:return s.getBitsLength(Re)}}function b(Re){return Re.reduce(function(Fe,O){const $e=Fe.length-1>=0?Fe[Fe.length-1]:null;return $e&&$e.mode===O.mode?(Fe[Fe.length-1].data+=O.data,Fe):(Fe.push(O),Fe)},[])}function R(Re){const Fe=[];for(let O=0;O<Re.length;O++){const $e=Re[O];switch($e.mode){case e.NUMERIC:Fe.push([$e,{data:$e.data,mode:e.ALPHANUMERIC,length:$e.length},{data:$e.data,mode:e.BYTE,length:$e.length}]);break;case e.ALPHANUMERIC:Fe.push([$e,{data:$e.data,mode:e.BYTE,length:$e.length}]);break;case e.KANJI:Fe.push([$e,{data:$e.data,mode:e.BYTE,length:x($e.data)}]);break;case e.BYTE:Fe.push([{data:$e.data,mode:e.BYTE,length:x($e.data)}])}}return Fe}function D(Re,Fe){const O={},$e={start:{}};let ze=["start"];for(let q=0;q<Re.length;q++){const W=Re[q],We=[];for(let Xe=0;Xe<W.length;Xe++){const it=W[Xe],Ve=""+q+Xe;We.push(Ve),O[Ve]={node:it,lastCount:0},$e[Ve]={};for(let v=0;v<ze.length;v++){const I=ze[v];O[I]&&O[I].node.mode===it.mode?($e[I][Ve]=y(O[I].lastCount+it.length,it.mode)-y(O[I].lastCount,it.mode),O[I].lastCount+=it.length):(O[I]&&(O[I].lastCount=it.length),$e[I][Ve]=y(it.length,it.mode)+4+e.getCharCountIndicator(it.mode,Fe))}}ze=We}for(let q=0;q<ze.length;q++)$e[ze[q]].end=0;return{map:$e,table:O}}function k(Re,Fe){let O;const $e=e.getBestModeForData(Re);if(O=e.from(Fe,$e),O!==e.BYTE&&O.bit<$e.bit)throw new Error('"'+Re+'" cannot be encoded with mode '+e.toString(O)+`.
 Suggested mode is: `+e.toString($e));switch(O===e.KANJI&&!u.isKanjiModeEnabled()&&(O=e.BYTE),O){case e.NUMERIC:return new r(Re);case e.ALPHANUMERIC:return new n(Re);case e.KANJI:return new o(Re);case e.BYTE:return new s(Re)}}t.fromArray=function(Fe){return Fe.reduce(function(O,$e){return typeof $e=="string"?O.push(k($e,null)):$e.data&&O.push(k($e.data,$e.mode)),O},[])},t.fromString=function(Fe,O){const $e=g(Fe,u.isKanjiModeEnabled()),ze=R($e),q=D(ze,O),W=f.find_path(q.map,"start","end"),We=[];for(let Xe=1;Xe<W.length-1;Xe++)We.push(q.table[W[Xe]].node);return t.fromArray(b(We))},t.rawSplit=function(Fe){return t.fromArray(g(Fe,u.isKanjiModeEnabled()))}})(segments)),segments}var hasRequiredQrcode;function requireQrcode(){if(hasRequiredQrcode)return qrcode;hasRequiredQrcode=1;const t=requireUtils$1(),e=requireErrorCorrectionLevel(),r=requireBitBuffer(),n=requireBitMatrix(),s=requireAlignmentPattern(),o=requireFinderPattern(),c=requireMaskPattern(),u=requireErrorCorrectionCode(),f=requireReedSolomonEncoder(),x=requireVersion(),p=requireFormatInfo(),g=requireMode(),y=requireSegments();function b(q,W){const We=q.size,Xe=o.getPositions(W);for(let it=0;it<Xe.length;it++){const Ve=Xe[it][0],v=Xe[it][1];for(let I=-1;I<=7;I++)if(!(Ve+I<=-1||We<=Ve+I))for(let Ce=-1;Ce<=7;Ce++)v+Ce<=-1||We<=v+Ce||(I>=0&&I<=6&&(Ce===0||Ce===6)||Ce>=0&&Ce<=6&&(I===0||I===6)||I>=2&&I<=4&&Ce>=2&&Ce<=4?q.set(Ve+I,v+Ce,!0,!0):q.set(Ve+I,v+Ce,!1,!0))}}function R(q){const W=q.size;for(let We=8;We<W-8;We++){const Xe=We%2===0;q.set(We,6,Xe,!0),q.set(6,We,Xe,!0)}}function D(q,W){const We=s.getPositions(W);for(let Xe=0;Xe<We.length;Xe++){const it=We[Xe][0],Ve=We[Xe][1];for(let v=-2;v<=2;v++)for(let I=-2;I<=2;I++)v===-2||v===2||I===-2||I===2||v===0&&I===0?q.set(it+v,Ve+I,!0,!0):q.set(it+v,Ve+I,!1,!0)}}function k(q,W){const We=q.size,Xe=x.getEncodedBits(W);let it,Ve,v;for(let I=0;I<18;I++)it=Math.floor(I/3),Ve=I%3+We-8-3,v=(Xe>>I&1)===1,q.set(it,Ve,v,!0),q.set(Ve,it,v,!0)}function Re(q,W,We){const Xe=q.size,it=p.getEncodedBits(W,We);let Ve,v;for(Ve=0;Ve<15;Ve++)v=(it>>Ve&1)===1,Ve<6?q.set(Ve,8,v,!0):Ve<8?q.set(Ve+1,8,v,!0):q.set(Xe-15+Ve,8,v,!0),Ve<8?q.set(8,Xe-Ve-1,v,!0):Ve<9?q.set(8,15-Ve-1+1,v,!0):q.set(8,15-Ve-1,v,!0);q.set(Xe-8,8,1,!0)}function Fe(q,W){const We=q.size;let Xe=-1,it=We-1,Ve=7,v=0;for(let I=We-1;I>0;I-=2)for(I===6&&I--;;){for(let Ce=0;Ce<2;Ce++)if(!q.isReserved(it,I-Ce)){let P=!1;v<W.length&&(P=(W[v]>>>Ve&1)===1),q.set(it,I-Ce,P),Ve--,Ve===-1&&(v++,Ve=7)}if(it+=Xe,it<0||We<=it){it-=Xe,Xe=-Xe;break}}}function O(q,W,We){const Xe=new r;We.forEach(function(Ce){Xe.put(Ce.mode.bit,4),Xe.put(Ce.getLength(),g.getCharCountIndicator(Ce.mode,q)),Ce.write(Xe)});const it=t.getSymbolTotalCodewords(q),Ve=u.getTotalCodewordsCount(q,W),v=(it-Ve)*8;for(Xe.getLengthInBits()+4<=v&&Xe.put(0,4);Xe.getLengthInBits()%8!==0;)Xe.putBit(0);const I=(v-Xe.getLengthInBits())/8;for(let Ce=0;Ce<I;Ce++)Xe.put(Ce%2?17:236,8);return $e(Xe,q,W)}function $e(q,W,We){const Xe=t.getSymbolTotalCodewords(W),it=u.getTotalCodewordsCount(W,We),Ve=Xe-it,v=u.getBlocksCount(W,We),I=Xe%v,Ce=v-I,P=Math.floor(Xe/v),_e=Math.floor(Ve/v),Le=_e+1,Ye=P-_e,je=new f(Ye);let K=0;const L=new Array(v),st=new Array(v);let dt=0;const Je=new Uint8Array(q.buffer);for(let ir=0;ir<v;ir++){const ft=ir<Ce?_e:Le;L[ir]=Je.slice(K,K+ft),st[ir]=je.encode(L[ir]),K+=ft,dt=Math.max(dt,ft)}const pt=new Uint8Array(Xe);let rr=0,cr,fr;for(cr=0;cr<dt;cr++)for(fr=0;fr<v;fr++)cr<L[fr].length&&(pt[rr++]=L[fr][cr]);for(cr=0;cr<Ye;cr++)for(fr=0;fr<v;fr++)pt[rr++]=st[fr][cr];return pt}function ze(q,W,We,Xe){let it;if(Array.isArray(q))it=y.fromArray(q);else if(typeof q=="string"){let P=W;if(!P){const _e=y.rawSplit(q);P=x.getBestVersionForData(_e,We)}it=y.fromString(q,P||40)}else throw new Error("Invalid data");const Ve=x.getBestVersionForData(it,We);if(!Ve)throw new Error("The amount of data is too big to be stored in a QR Code");if(!W)W=Ve;else if(W<Ve)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+Ve+`.
`);const v=O(W,We,it),I=t.getSymbolSize(W),Ce=new n(I);return b(Ce,W),R(Ce),D(Ce,W),Re(Ce,We,0),W>=7&&k(Ce,W),Fe(Ce,v),isNaN(Xe)&&(Xe=c.getBestMask(Ce,Re.bind(null,Ce,We))),c.applyMask(Xe,Ce),Re(Ce,We,Xe),{modules:Ce,version:W,errorCorrectionLevel:We,maskPattern:Xe,segments:it}}return qrcode.create=function(W,We){if(typeof W>"u"||W==="")throw new Error("No input text");let Xe=e.M,it,Ve;return typeof We<"u"&&(Xe=e.from(We.errorCorrectionLevel,e.M),it=x.from(We.version),Ve=c.from(We.maskPattern),We.toSJISFunc&&t.setToSJISFunction(We.toSJISFunc)),ze(W,it,Xe,Ve)},qrcode}var canvas={},utils={},hasRequiredUtils;function requireUtils(){return hasRequiredUtils||(hasRequiredUtils=1,(function(t){function e(r){if(typeof r=="number"&&(r=r.toString()),typeof r!="string")throw new Error("Color should be defined as hex string");let n=r.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+r);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(o){return[o,o]}))),n.length===6&&n.push("F","F");const s=parseInt(n.join(""),16);return{r:s>>24&255,g:s>>16&255,b:s>>8&255,a:s&255,hex:"#"+n.slice(0,6).join("")}}t.getOptions=function(n){n||(n={}),n.color||(n.color={});const s=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,o=n.width&&n.width>=21?n.width:void 0,c=n.scale||4;return{width:o,scale:o?4:c,margin:s,color:{dark:e(n.color.dark||"#000000ff"),light:e(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},t.getScale=function(n,s){return s.width&&s.width>=n+s.margin*2?s.width/(n+s.margin*2):s.scale},t.getImageWidth=function(n,s){const o=t.getScale(n,s);return Math.floor((n+s.margin*2)*o)},t.qrToImageData=function(n,s,o){const c=s.modules.size,u=s.modules.data,f=t.getScale(c,o),x=Math.floor((c+o.margin*2)*f),p=o.margin*f,g=[o.color.light,o.color.dark];for(let y=0;y<x;y++)for(let b=0;b<x;b++){let R=(y*x+b)*4,D=o.color.light;if(y>=p&&b>=p&&y<x-p&&b<x-p){const k=Math.floor((y-p)/f),Re=Math.floor((b-p)/f);D=g[u[k*c+Re]?1:0]}n[R++]=D.r,n[R++]=D.g,n[R++]=D.b,n[R]=D.a}}})(utils)),utils}var hasRequiredCanvas;function requireCanvas(){return hasRequiredCanvas||(hasRequiredCanvas=1,(function(t){const e=requireUtils();function r(s,o,c){s.clearRect(0,0,o.width,o.height),o.style||(o.style={}),o.height=c,o.width=c,o.style.height=c+"px",o.style.width=c+"px"}function n(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(o,c,u){let f=u,x=c;typeof f>"u"&&(!c||!c.getContext)&&(f=c,c=void 0),c||(x=n()),f=e.getOptions(f);const p=e.getImageWidth(o.modules.size,f),g=x.getContext("2d"),y=g.createImageData(p,p);return e.qrToImageData(y.data,o,f),r(g,x,p),g.putImageData(y,0,0),x},t.renderToDataURL=function(o,c,u){let f=u;typeof f>"u"&&(!c||!c.getContext)&&(f=c,c=void 0),f||(f={});const x=t.render(o,c,f),p=f.type||"image/png",g=f.rendererOpts||{};return x.toDataURL(p,g.quality)}})(canvas)),canvas}var svgTag={},hasRequiredSvgTag;function requireSvgTag(){if(hasRequiredSvgTag)return svgTag;hasRequiredSvgTag=1;const t=requireUtils();function e(s,o){const c=s.a/255,u=o+'="'+s.hex+'"';return c<1?u+" "+o+'-opacity="'+c.toFixed(2).slice(1)+'"':u}function r(s,o,c){let u=s+o;return typeof c<"u"&&(u+=" "+c),u}function n(s,o,c){let u="",f=0,x=!1,p=0;for(let g=0;g<s.length;g++){const y=Math.floor(g%o),b=Math.floor(g/o);!y&&!x&&(x=!0),s[g]?(p++,g>0&&y>0&&s[g-1]||(u+=x?r("M",y+c,.5+b+c):r("m",f,0),f=0,x=!1),y+1<o&&s[g+1]||(u+=r("h",p),p=0)):f++}return u}return svgTag.render=function(o,c,u){const f=t.getOptions(c),x=o.modules.size,p=o.modules.data,g=x+f.margin*2,y=f.color.light.a?"<path "+e(f.color.light,"fill")+' d="M0 0h'+g+"v"+g+'H0z"/>':"",b="<path "+e(f.color.dark,"stroke")+' d="'+n(p,x,f.margin)+'"/>',R='viewBox="0 0 '+g+" "+g+'"',k='<svg xmlns="http://www.w3.org/2000/svg" '+(f.width?'width="'+f.width+'" height="'+f.width+'" ':"")+R+' shape-rendering="crispEdges">'+y+b+`</svg>
`;return typeof u=="function"&&u(null,k),k},svgTag}var hasRequiredBrowser;function requireBrowser(){if(hasRequiredBrowser)return browser;hasRequiredBrowser=1;const t=requireCanPromise(),e=requireQrcode(),r=requireCanvas(),n=requireSvgTag();function s(o,c,u,f,x){const p=[].slice.call(arguments,1),g=p.length,y=typeof p[g-1]=="function";if(!y&&!t())throw new Error("Callback required as last argument");if(y){if(g<2)throw new Error("Too few arguments provided");g===2?(x=u,u=c,c=f=void 0):g===3&&(c.getContext&&typeof x>"u"?(x=f,f=void 0):(x=f,f=u,u=c,c=void 0))}else{if(g<1)throw new Error("Too few arguments provided");return g===1?(u=c,c=f=void 0):g===2&&!c.getContext&&(f=u,u=c,c=void 0),new Promise(function(b,R){try{const D=e.create(u,f);b(o(D,c,f))}catch(D){R(D)}})}try{const b=e.create(u,f);x(null,o(b,c,f))}catch(b){x(b)}}return browser.create=e.create,browser.toCanvas=s.bind(null,r.render),browser.toDataURL=s.bind(null,r.renderToDataURL),browser.toString=s.bind(null,function(o,c,u){return n.render(o,u)}),browser}var browserExports=requireBrowser();const QRCode=getDefaultExportFromCjs$1(browserExports),ReceiveModal=({isOpen:t,onClose:e,address:r})=>{const[n,s]=reactExports.useState(""),[o,c]=reactExports.useState(!1);if(reactExports.useEffect(()=>{t&&r&&QRCode.toDataURL(r,{width:300,margin:2,color:{dark:"#000000",light:"#ffffff"}}).then(f=>s(f)).catch(f=>console.error("Error generating QR code:",f))},[t,r]),!t)return null;const u=()=>{navigator.clipboard.writeText(r),c(!0),setTimeout(()=>c(!1),2e3)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-sm overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Receive Bitcoin"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-1 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 flex flex-col items-center",children:[n&&jsxRuntimeExports.jsx("div",{className:"bg-white p-4 rounded-xl mb-6",children:jsxRuntimeExports.jsx("img",{src:n,alt:"Bitcoin Address QR Code",className:"w-48 h-48"})}),jsxRuntimeExports.jsx("div",{className:"w-full bg-slate-950 p-4 rounded-xl border border-slate-800 flex items-center justify-between gap-3 mb-2",children:jsxRuntimeExports.jsx("p",{className:"font-mono text-sm text-slate-300 break-all text-center",children:r})}),jsxRuntimeExports.jsxs("button",{onClick:u,className:"flex items-center gap-2 text-slate-400 hover:text-white transition-colors text-sm",children:[o?jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 text-green-500"}):jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4"}),o?"Copied!":"Copy Address"]})]})]})})},SatoshiIcon=({className:t=""})=>jsxRuntimeExports.jsx("i",{className:`fak fa-satoshisymbol-solid ${t}`}),SendModal=({isOpen:t,onClose:e,utxos:r,onSuccess:n,initialRecipient:s="",initialFeeRate:o,hideFollowsSelector:c=!1,hideSendToSelf:u=!1})=>{const{decryptedKey:f}=useAuthStore(),[x,p]=reactExports.useState("details"),[g,y]=reactExports.useState(s),[b,R]=reactExports.useState(""),[D,k]=reactExports.useState(""),[Re,Fe]=reactExports.useState("sats"),[O,$e]=reactExports.useState(o||1),[ze,q]=reactExports.useState(null),[W,We]=reactExports.useState(null),[Xe,it]=reactExports.useState(""),[Ve,v]=reactExports.useState(0),{currentKeypairId:I,wallets:Ce,currentWalletId:P}=useWalletStore(),Le=Ce.find(xr=>xr.id===P)?.keypairs.find(xr=>xr.id===I),[Ye,je]=reactExports.useState([]),[K,L]=reactExports.useState(!1),[st,dt]=reactExports.useState(!1),[Je,pt]=reactExports.useState(null);reactExports.useEffect(()=>{t&&Le&&(console.log("[SendModal] Fetching contacts for keypair:",Le.npub),L(!0),pt(null),ProfileService.fetchContacts(Le.npub).then(xr=>{console.log("[SendModal] Received contacts:",xr.length),je(xr)}).catch(xr=>{console.error("[SendModal] Error fetching contacts:",xr),pt("Failed to fetch user follows")}).finally(()=>L(!1)))},[t,Le]),reactExports.useEffect(()=>{if(t){getFeeRates().then(q).catch(console.error),p("details"),y(s),k(""),We(null);const xr=s.trim();if(xr.startsWith("npub"))try{const wr=npubToBitcoinAddress(xr);R(wr)}catch{R("")}else xr.startsWith("bc1")||xr.startsWith("1")||xr.startsWith("3")?R(xr):R("")}},[t,s]),reactExports.useEffect(()=>{const xr=g.trim();if(xr.startsWith("npub"))try{const wr=npubToBitcoinAddress(xr);R(wr)}catch{R("")}else xr.startsWith("bc1")||xr.startsWith("1")||xr.startsWith("3")?R(xr):R("")},[g]);const rr=async()=>{if(We(null),!b){We("Invalid Bitcoin address or npub");return}const xr=Re==="btc"?btcToSats(parseFloat(D)):parseInt(D);if(isNaN(xr)||xr<=0){We("Invalid amount");return}if(!f){We("Wallet locked");return}try{const{txHex:wr,fee:Br}=await createBitcoinTransaction(f,b,xr,r,O);it(wr),v(Br),p("confirm")}catch(wr){console.error(wr),We(wr.message||"Failed to create transaction")}},cr=async()=>{p("broadcasting");try{await broadcastTransaction(Xe),p("success"),setTimeout(()=>{n(),e()},2e3)}catch(xr){console.error(xr),We(xr.message||"Failed to broadcast transaction"),p("confirm")}},fr=reactExports.useRef(null),[ir,ft]=reactExports.useState(!1),[nr,lr]=reactExports.useState(null),er=reactExports.useRef(null),pr=xr=>{const wr=xr.target.files?.[0];if(!wr)return;const Br=new FileReader;Br.onload=hr=>{const Cr=hr.target?.result;lr(Cr);const _r=new Image;_r.src=Cr,_r.onload=()=>{const Tr=document.createElement("canvas"),Nr=Tr.getContext("2d");if(!Nr)return;const or=(yr,mr,sr=!1)=>{Tr.width=yr,Tr.height=mr,Nr.drawImage(_r,0,0,yr,mr);const Ar=Nr.getImageData(0,0,yr,mr),ht=jsQR(Ar.data,yr,mr,{inversionAttempts:sr?"invertFirst":"dontInvert"});return ht?ht.data:null};let tr=or(_r.width,_r.height);if(!tr&&(_r.width>800||_r.height>800)){const yr=800/Math.max(_r.width,_r.height);tr=or(Math.floor(_r.width*yr),Math.floor(_r.height*yr))}if(tr||(tr=or(_r.width,_r.height,!0)),tr){console.log("[Upload] QR Found:",tr);const yr=tr.replace("bitcoin:","").split("?")[0];y(yr),ft(!1),lr(null)}else We("No QR code found in image")}},Br.readAsDataURL(wr)},Er=(xr,wr)=>{if(!ir){wr.getTracks().forEach(_r=>_r.stop());return}const Br=document.createElement("canvas"),hr=Br.getContext("2d",{willReadFrequently:!0}),Cr=()=>{if(xr.readyState===xr.HAVE_ENOUGH_DATA&&hr){Br.height=xr.videoHeight,Br.width=xr.videoWidth,hr.drawImage(xr,0,0,Br.width,Br.height);const _r=hr.getImageData(0,0,Br.width,Br.height),Tr=jsQR(_r.data,_r.width,_r.height,{inversionAttempts:"dontInvert"});if(Tr){console.log("[Camera] QR Found:",Tr.data);const or=Tr.data.replace("bitcoin:","").split("?")[0];y(or),wr.getTracks().forEach(tr=>tr.stop()),ft(!1);return}}document.getElementById("qr-modal")?requestAnimationFrame(Cr):wr.getTracks().forEach(_r=>_r.stop())};requestAnimationFrame(Cr)};return reactExports.useEffect(()=>{let xr=null,wr=!0;return ir&&(async()=>{if(ir)try{const hr=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(!wr){hr.getTracks().forEach(_r=>_r.stop());return}xr=hr;const Cr=fr.current;Cr&&(Cr.srcObject=hr,Cr.setAttribute("playsinline","true"),Cr.onloadedmetadata=()=>{Cr.play().catch(_r=>console.error("Play failed",_r)),Er(Cr,hr)})}catch(hr){console.error("Camera error:",hr),We("Failed to access camera"),ft(!1)}})(),()=>{wr=!1,xr&&xr.getTracks().forEach(hr=>hr.stop())}},[ir]),t?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsx("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-md overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-200",children:ir?jsxRuntimeExports.jsx("div",{id:"qr-modal",className:"fixed inset-0 bg-black/95 flex items-center justify-center p-4 z-50 overflow-y-auto",children:jsxRuntimeExports.jsxs("div",{className:"relative w-full max-w-md bg-slate-900 rounded-xl p-4 border border-slate-800 my-auto",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-white mb-4 text-center",children:"Scan BTC Address"}),jsxRuntimeExports.jsxs("div",{className:"relative aspect-square bg-black rounded-lg overflow-hidden mb-4",children:[jsxRuntimeExports.jsx("video",{ref:fr,className:"w-full h-full object-cover",playsInline:!0,muted:!0}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 border-2 border-amber-500/50 rounded-lg pointer-events-none"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx("p",{className:"text-center text-slate-400 text-sm",children:"Camera not working? Upload an image instead."}),nr&&jsxRuntimeExports.jsxs("div",{className:"relative max-h-48 overflow-hidden rounded-lg",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Uploaded Image:"}),jsxRuntimeExports.jsx("img",{src:nr,alt:"Uploaded QR",className:"w-full object-contain bg-black/50"})]}),jsxRuntimeExports.jsx("input",{type:"file",ref:er,onChange:pr,accept:"image/*",capture:"environment",className:"hidden"}),jsxRuntimeExports.jsxs("button",{onClick:()=>er.current?.click(),className:"w-full bg-slate-800 hover:bg-slate-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(QrCode,{className:"w-5 h-5"}),"Upload QR Image"]}),jsxRuntimeExports.jsx("button",{onClick:()=>ft(!1),className:"w-full bg-red-500/10 hover:bg-red-500/20 text-red-400 font-medium py-3 px-4 rounded-lg transition-colors",children:"Cancel"})]})]})}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Send Bitcoin"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-1 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-6",children:[x==="details"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Recipient"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 border border-slate-800 rounded-xl p-2 pr-2 focus-within:ring-2 focus-within:ring-amber-500 focus-within:border-transparent transition-all",children:[jsxRuntimeExports.jsx("input",{type:"text",value:g,onChange:xr=>y(xr.target.value),placeholder:"Bitcoin address or npub...",className:"flex-1 bg-transparent text-white outline-none font-mono text-sm px-2 min-w-0"}),jsxRuntimeExports.jsx("button",{onClick:()=>ft(!0),className:"p-2 hover:bg-slate-800 rounded-lg text-amber-500 transition-colors flex-shrink-0",title:"Scan QR Code",children:jsxRuntimeExports.jsx(QrCode,{className:"w-5 h-5"})})]}),g.startsWith("npub")&&b&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-green-500 mt-1 break-all",children:["Resolved: ",b]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[!u&&Le&&jsxRuntimeExports.jsxs("button",{onClick:()=>y(Le.npub),className:"px-3 py-2 bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 text-xs font-medium rounded-lg transition-colors flex items-center gap-2",children:[jsxRuntimeExports.jsx(ArrowRight,{className:"w-3.5 h-3.5"}),"Send to Myself"]}),!c&&Le&&jsxRuntimeExports.jsxs("button",{onClick:()=>dt(!st),className:`px-3 py-2 text-xs font-medium rounded-lg transition-colors flex items-center gap-2 ${st?"bg-amber-500/20 text-amber-400":"bg-amber-500/10 hover:bg-amber-500/20 text-amber-500"}`,children:[jsxRuntimeExports.jsx(User,{className:"w-3.5 h-3.5"}),st?"Hide Follows":"Select from Follows"]})]}),st&&jsxRuntimeExports.jsx("div",{className:"mt-2 max-h-48 overflow-y-auto bg-slate-950 border border-slate-800 rounded-xl p-2 space-y-2 custom-scrollbar",children:K?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center p-4 text-slate-400 gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin text-amber-500"}),jsxRuntimeExports.jsx("span",{className:"text-xs",children:"Currently fetching user follows..."})]}):Je?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center p-4 text-red-400 gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{className:"text-xs",children:Je})]}):Ye.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center p-4 text-slate-400 gap-2",children:[jsxRuntimeExports.jsx(User,{className:"w-5 h-5 opacity-50"}),jsxRuntimeExports.jsx("span",{className:"text-xs",children:"User not following anyone"})]}):Ye.map(xr=>{let wr="";try{wr=xr.npub?npubToBitcoinAddress(xr.npub):""}catch{return null}if(!wr)return null;const Br=xr.npub===g;return jsxRuntimeExports.jsxs("div",{onClick:()=>{y(xr.npub)},className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-colors group border ${Br?"bg-amber-500/10 border-amber-500/30":"hover:bg-slate-900 border-transparent"}`,children:[xr.picture?jsxRuntimeExports.jsx("img",{src:xr.picture,alt:xr.name,className:"w-8 h-8 rounded-full object-cover"}):jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center",children:jsxRuntimeExports.jsx(User,{className:"w-4 h-4 text-slate-500"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-sm text-white truncate",children:xr.name||"Unknown"}),xr.nip05&&jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-500 truncate",children:xr.nip05})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 mt-0.5",children:[jsxRuntimeExports.jsxs("span",{className:"font-mono truncate",children:[xr.npub.slice(0,8),"...",xr.npub.slice(-8)]}),jsxRuntimeExports.jsx("button",{onClick:hr=>{hr.stopPropagation(),navigator.clipboard.writeText(xr.npub)},className:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-white transition-colors",title:"Copy npub",children:jsxRuntimeExports.jsx(Copy,{className:"w-3 h-3"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 mt-0.5",children:[jsxRuntimeExports.jsx("span",{className:"font-mono truncate text-amber-500/70",children:wr.length>16?`${wr.slice(0,8)}...${wr.slice(-8)}`:wr}),jsxRuntimeExports.jsx("button",{onClick:hr=>{hr.stopPropagation(),navigator.clipboard.writeText(wr)},className:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-white transition-colors",title:"Copy Bitcoin Address",children:jsxRuntimeExports.jsx(Copy,{className:"w-3 h-3"})})]})]})]},xr.npub)})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-1",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400",children:"Amount"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-slate-500",children:["Available: ",r.reduce((xr,wr)=>xr+wr.value,0).toLocaleString()," sats"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 border border-slate-800 rounded-xl p-3 focus-within:ring-2 focus-within:ring-amber-500 focus:border-transparent transition-all",children:[Re==="sats"?jsxRuntimeExports.jsx(SatoshiIcon,{className:"text-xl text-amber-500 flex-shrink-0"}):jsxRuntimeExports.jsx("span",{className:"text-xl text-amber-500 flex-shrink-0",children:""}),jsxRuntimeExports.jsx("input",{type:"number",value:D,onChange:xr=>k(xr.target.value),placeholder:"0.00",className:"flex-1 bg-transparent text-white outline-none font-mono text-lg min-w-0"}),jsxRuntimeExports.jsx("button",{onClick:()=>{const xr=r.reduce((wr,Br)=>wr+Br.value,0);k(Re==="sats"?xr.toString():satsToBTC(xr).toString())},className:"px-2 py-1 bg-amber-500/10 hover:bg-amber-500/20 text-amber-500 text-xs font-bold rounded transition-colors",children:"MAX"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{const xr=parseFloat(D)||0;Re==="sats"?(k(satsToBTC(xr)),Fe("btc")):(k(btcToSats(xr).toString()),Fe("sats"))},className:"p-2 hover:bg-slate-800 rounded-lg transition-colors flex-shrink-0",title:"Toggle unit",children:jsxRuntimeExports.jsx(ArrowUpDown,{className:"w-4 h-4 text-slate-400"})}),jsxRuntimeExports.jsx("span",{className:"text-slate-400 font-medium text-sm flex-shrink-0",children:Re==="sats"?"sats":"BTC"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Fee Rate (sat/vB)"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-2",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>ze&&$e(ze.hourFee),className:`p-2 rounded-lg border text-xs transition-all ${O===ze?.hourFee?"bg-amber-500/10 border-amber-500 text-amber-500":"bg-slate-950 border-slate-800 text-slate-400 hover:border-slate-700"}`,children:[jsxRuntimeExports.jsx("div",{className:"font-bold",children:"Slow"}),jsxRuntimeExports.jsxs("div",{children:[ze?.hourFee||"-"," sat/vB"]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>ze&&$e(ze.halfHourFee),className:`p-2 rounded-lg border text-xs transition-all ${O===ze?.halfHourFee?"bg-amber-500/10 border-amber-500 text-amber-500":"bg-slate-950 border-slate-800 text-slate-400 hover:border-slate-700"}`,children:[jsxRuntimeExports.jsx("div",{className:"font-bold",children:"Normal"}),jsxRuntimeExports.jsxs("div",{children:[ze?.halfHourFee||"-"," sat/vB"]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>ze&&$e(ze.fastestFee),className:`p-2 rounded-lg border text-xs transition-all ${O===ze?.fastestFee?"bg-amber-500/10 border-amber-500 text-amber-500":"bg-slate-950 border-slate-800 text-slate-400 hover:border-slate-700"}`,children:[jsxRuntimeExports.jsx("div",{className:"font-bold",children:"Fast"}),jsxRuntimeExports.jsxs("div",{children:[ze?.fastestFee||"-"," sat/vB"]})]})]}),jsxRuntimeExports.jsx("input",{type:"number",value:O,onChange:xr=>$e(parseInt(xr.target.value)||1),className:"w-full bg-slate-950 border border-slate-800 rounded-xl p-3 text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition-all font-mono text-sm"})]}),W&&jsxRuntimeExports.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 flex-shrink-0"}),W]}),jsxRuntimeExports.jsxs("button",{onClick:rr,className:"w-full py-3 px-4 bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold rounded-xl transition-colors flex items-center justify-center gap-2",children:["Review Transaction",jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4"})]})]}),x==="confirm"&&jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800 space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-slate-400",children:"Amount"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-lg text-amber-500",children:""}),jsxRuntimeExports.jsxs("span",{className:"font-mono font-bold text-white",children:[Re==="btc"?D:satsToBTC(parseInt(D))," BTC"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-slate-400",children:"Fee"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx(SatoshiIcon,{className:"w-3.5 h-3.5 text-slate-400"}),jsxRuntimeExports.jsxs("span",{className:"font-mono text-slate-300",children:[Ve," sats"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-slate-800 pt-3",children:[jsxRuntimeExports.jsx("span",{className:"text-slate-400 block mb-1",children:"To"}),jsxRuntimeExports.jsx("span",{className:"font-mono text-xs text-slate-300 break-all",children:b})]})]}),W&&jsxRuntimeExports.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 flex-shrink-0"}),W]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>p("details"),className:"flex-1 py-3 px-4 bg-slate-800 hover:bg-slate-700 text-slate-300 font-medium rounded-xl transition-colors",children:"Back"}),jsxRuntimeExports.jsx("button",{onClick:cr,className:"flex-1 py-3 px-4 bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold rounded-xl transition-colors",children:"Confirm Send"})]})]}),x==="broadcasting"&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-12 h-12 text-amber-500 animate-spin mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-slate-300 font-medium",children:"Broadcasting transaction..."})]}),x==="success"&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(Check,{className:"w-8 h-8 text-green-500"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Sent!"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-center",children:"Your transaction has been broadcast successfully."})]})]})]})})}):null},TransactionDetailsModal=({isOpen:t,onClose:e,txid:r})=>{const[n,s]=reactExports.useState(!1);if(!t)return null;const o=()=>{navigator.clipboard.writeText(r),s(!0),setTimeout(()=>s(!1),2e3)},c=[{name:"Mempool.space",url:`https://mempool.space/tx/${r}`},{name:"Blockstream",url:`https://blockstream.info/tx/${r}`},{name:"Blockchain.com",url:`https://www.blockchain.com/explorer/transactions/btc/${r}`}];return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl border border-slate-800 w-full max-w-md overflow-hidden shadow-xl animate-in fade-in zoom-in duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-slate-800 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-lg text-white",children:"Transaction Details"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 space-y-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Transaction ID"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 rounded-lg p-3 border border-slate-800",children:[jsxRuntimeExports.jsx("code",{className:"text-sm text-slate-300 break-all font-mono flex-1",children:r}),jsxRuntimeExports.jsx("button",{onClick:o,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors flex-shrink-0",title:"Copy TXID",children:n?jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 text-green-500"}):jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4"})})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"View on Explorer"}),jsxRuntimeExports.jsx("div",{className:"grid gap-2",children:c.map(u=>jsxRuntimeExports.jsxs("a",{href:u.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors group",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-slate-200",children:u.name}),jsxRuntimeExports.jsx(ExternalLink,{className:"w-4 h-4 text-slate-500 group-hover:text-white transition-colors"})]},u.name))})]})]})]})})},BitcoinWallet=({initialRecipient:t="",initialFeeRate:e,autoOpenSend:r=!1,onSendComplete:n})=>{const{currentKeypairId:s,wallets:o,currentWalletId:c}=useWalletStore(),[u,f]=reactExports.useState(""),[x,p]=reactExports.useState(0),[g,y]=reactExports.useState([]),[b,R]=reactExports.useState([]),[D,k]=reactExports.useState(!1),[Re,Fe]=reactExports.useState(!1),[O,$e]=reactExports.useState(!1),[ze,q]=reactExports.useState(!1),[W,We]=reactExports.useState(null),[Xe,it]=reactExports.useState(t),v=o.find(P=>P.id===c)?.keypairs.find(P=>P.id===s),I=async()=>{if(u){k(!0);try{const[P,_e]=await Promise.all([fetchUTXOs(u),fetchTxHistory(u)]);y(P),R(_e);const Le=P.reduce((Ye,je)=>Ye+je.value,0);p(Le),Le>=1e6&&q(!0)}catch(P){console.error("Error fetching Bitcoin data:",P)}finally{k(!1)}}};reactExports.useEffect(()=>{if(v)try{const P=npubToBitcoinAddress(v.npub);f(P)}catch(P){console.error("Error deriving Bitcoin address:",P)}},[v]),reactExports.useEffect(()=>{I()},[u]),reactExports.useEffect(()=>{r&&t&&(it(t),$e(!0))},[r,t]);const Ce=P=>{let _e=0;return P.vin.forEach(Le=>{Le.prevout&&Le.prevout.scriptpubkey_address===u&&(_e-=Le.prevout.value)}),P.vout.forEach(Le=>{Le.scriptpubkey_address===u&&(_e+=Le.value)}),{netChange:_e,isReceive:_e>0,absAmount:Math.abs(_e)}};return v?jsxRuntimeExports.jsxs("div",{className:"",children:[jsxRuntimeExports.jsx("div",{className:"pb-4",children:jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-br from-amber-500/20 to-orange-600/20 border border-amber-500/20 rounded-2xl p-6 relative overflow-hidden",children:jsxRuntimeExports.jsxs("div",{className:"relative z-10",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-1",children:[jsxRuntimeExports.jsx("h2",{className:"text-slate-400 text-sm font-medium",children:"Total Balance"}),jsxRuntimeExports.jsx("button",{onClick:()=>q(!ze),className:"p-1.5 hover:bg-white/10 rounded-lg transition-colors",title:"Toggle display format",children:jsxRuntimeExports.jsx(ArrowUpDown,{className:"w-4 h-4 text-slate-400"})})]}),ze?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-baseline gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-3xl max-[400px]:text-2xl max-[300px]:text-xl text-amber-500",children:""}),jsxRuntimeExports.jsx("span",{className:"text-4xl max-[400px]:text-3xl max-[300px]:text-2xl font-bold text-white",children:satsToBTC(x)}),jsxRuntimeExports.jsx("span",{className:"text-amber-500 font-bold",children:"BTC"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 text-sm mt-1",children:[jsxRuntimeExports.jsx(SatoshiIcon,{className:"w-3.5 h-3.5"}),jsxRuntimeExports.jsxs("span",{children:[x.toLocaleString()," sats"]})]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-baseline gap-2",children:[jsxRuntimeExports.jsx(SatoshiIcon,{className:"text-3xl max-[400px]:text-2xl max-[300px]:text-xl text-amber-500"}),jsxRuntimeExports.jsx("span",{className:"text-4xl max-[400px]:text-3xl max-[300px]:text-2xl font-bold text-white",children:x.toLocaleString()}),jsxRuntimeExports.jsx("span",{className:"text-amber-500 font-bold",children:"sats"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 text-sm mt-1",children:[jsxRuntimeExports.jsx("span",{className:"text-base",children:""}),jsxRuntimeExports.jsxs("span",{children:[" ",satsToBTC(x)," BTC"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"mt-6 flex gap-3 flex-wrap",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>Fe(!0),className:"flex-1 bg-slate-900/50 hover:bg-slate-900/70 text-white py-2 px-4 rounded-xl font-medium transition-colors flex items-center justify-center gap-2 border border-white/10",children:[jsxRuntimeExports.jsx(ArrowDownLeft,{className:"w-4 h-4 text-green-400"}),"Receive"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>$e(!0),className:"flex-1 bg-amber-500 hover:bg-amber-600 text-slate-950 py-2 px-4 rounded-xl font-bold transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(ArrowUpRight,{className:"w-4 h-4"}),"Send"]})]})]})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"History"}),jsxRuntimeExports.jsx("button",{onClick:I,disabled:D,className:`p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors ${D?"animate-spin":""}`,children:jsxRuntimeExports.jsx(RefreshCw,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsx("div",{className:"space-y-3 overflow-y-auto pr-1",style:{maxHeight:"calc(100vh - 650px)"},children:b.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-8 text-slate-500",children:"No transactions found"}):b.map(P=>{const{isReceive:_e,absAmount:Le}=Ce(P);return jsxRuntimeExports.jsx("button",{onClick:()=>We(P.txid),className:"w-full text-left bg-slate-900 border border-slate-800 rounded-xl p-4 hover:border-slate-700 transition-colors",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`p-2 rounded-full ${_e?"bg-green-500/10 text-green-500":"bg-amber-500/10 text-amber-500"}`,children:_e?jsxRuntimeExports.jsx(ArrowDownLeft,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(ArrowUpRight,{className:"w-4 h-4"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"font-bold text-white",children:_e?"Received":"Sent"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-400",children:new Date((P.status.block_time||Date.now()/1e3)*1e3).toLocaleDateString()})]})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsxs("div",{className:`font-bold ${_e?"text-green-500":"text-white"}`,children:[_e?"+":"-",Le.toLocaleString()," sats"]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-end gap-1 text-xs text-slate-500",children:[jsxRuntimeExports.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${P.status.confirmed?"bg-green-500":"bg-amber-500"}`}),jsxRuntimeExports.jsx("span",{children:P.status.confirmed?"Confirmed":"Pending"})]})]})]})},P.txid)})})]}),jsxRuntimeExports.jsx(ReceiveModal,{isOpen:Re,onClose:()=>Fe(!1),address:u}),jsxRuntimeExports.jsx(SendModal,{isOpen:O,onClose:()=>{$e(!1),it(""),n&&n()},utxos:g,onSuccess:()=>{I(),n&&n()},initialRecipient:Xe,initialFeeRate:e}),jsxRuntimeExports.jsx(TransactionDetailsModal,{isOpen:!!W,onClose:()=>We(null),txid:W||""})]}):jsxRuntimeExports.jsx("div",{className:"p-4 text-center text-slate-400",children:"No active keypair"})};class CashuService{static mints=new Map;static getMint(e){return this.mints.has(e)||this.mints.set(e,new S(e)),this.mints.get(e)}static async getInitializedWallet(e){let n=useEcashStore.getState().mints[e]?.keys;n||(console.log(`keys not found in store for ${e}, fetching...`),n=await this.loadMint(e));const s=this.getMint(e),o=n;o&&o.keysets&&o.keysets.forEach(f=>{f.active===void 0&&(f.active=!0)});const c={keysets:o?.keysets,keys:o?.keysets,unit:"sat"};return new Ze(s,c)}static async loadMint(e){const r=this.getMint(e);try{const n=await r.getKeys();return useEcashStore.getState().addMint(e,n),n}catch(n){throw console.error("Failed to load mint:",e,n),n}}static async receiveToken(e,r=!1){try{const n=pe(e);let s=n.token;if(!s&&n.proofs&&n.mint&&(console.log(" Detected flat token structure, normalizing..."),s=[{mint:n.mint,proofs:n.proofs}]),!s)throw new Error('Invalid token structure: missing "token" array and not a valid flat token.');const o=[],{decryptedKey:c,publicKey:u}=useAuthStore.getState();for(const x of s){const p=x.mint;let g=!1;if(x.proofs.forEach(k=>{try{const Re=JSON.parse(k.secret);if(Array.isArray(Re)&&Re[0]==="P2PK"){const Fe=Re[1].data;c?(Fe.length===66?Fe.substring(2):Fe)!==u&&(console.warn(` Skipping Token: Locked to ${Fe.substring(0,6)}... (Not us)`),g=!0):console.error(" P2PK Token found but NO decrypted private key available in store!")}}catch{}}),g)continue;const y=await this.getInitializedWallet(p),b=Array.from(new Set(x.proofs.map(k=>k.id))),R=()=>y.keys instanceof Map?Array.from(y.keys.keys()):Object.keys(y.keys||{});let D=!1;for(const k of b){if(typeof k!="string")continue;if(!R().includes(k)){console.warn(` Warning: Wallet missing keys for keyset ${k}. Attempting to fetch...`);try{const Fe=await y.mint.getKeys(k),O=useEcashStore.getState().mints[p];if(O&&O.keys){const $e=O.keys;if($e.keysets&&!new Set($e.keysets.map(q=>q.id)).has(Fe.keysets[0].id)){const W={keysets:[...$e.keysets,Fe.keysets[0]]};useEcashStore.getState().addMint(p,W),console.log(` Fetched and saved keys for ${k} to store.`),D=!0}}}catch(Fe){console.error(` Failed to fetch keys for ${k}:`,Fe)}}}if(D){console.log(" Reloading wallet with updated keys...");const k=await this.getInitializedWallet(p),Re={};c&&(Re.privkey=c);const Fe=await k.receive(e,Re);o.push(...Fe)}else{const k={};c&&(k.privkey=c);const Re=await y.receive(e,k);o.push(...Re)}}useEcashStore.getState().addProofs(o,!0),console.log(` Received ${o.length} proofs totaling ${o.reduce((x,p)=>x+p.amount,0)} sats`);const f=o.filter(x=>{try{const p=JSON.parse(x.secret);return!(Array.isArray(p)&&p[0]==="P2PK")}catch{return!0}});if(f.length>0&&!r){const x=f.reduce((D,k)=>D+k.amount,0);console.log(` Detected ${f.length} UNLOCKED proofs (${x} sats total)`),console.log(" AUTO-RELOCK: Re-locking to your npub for security...");const{currentKeypairId:p,wallets:g,currentWalletId:y}=useWalletStore.getState(),R=g.find(D=>D.id===y)?.keypairs.find(D=>D.id===p);if(!R)console.warn(" Cannot re-lock: No active keypair found");else{const D=new Map;for(const k of f){const{mints:Re}=useEcashStore.getState();let Fe=null;for(const[O,$e]of Object.entries(Re)){const ze=$e.keys;if(ze?.keysets&&Array.isArray(ze.keysets)&&ze.keysets.some(W=>W.id===k.id)){Fe=O;break}}Fe?(D.has(Fe)||D.set(Fe,[]),D.get(Fe).push(k)):console.warn(` Could not find mint for proof ${k.secret.substring(0,10)}...`)}console.log(` Unlocked proofs grouped by ${D.size} mint(s)`);for(const[k,Re]of D){const Fe=Re.reduce((O,$e)=>O+$e.amount,0);console.log(` Re-locking ${Re.length} proofs (${Fe} sats) from ${k}...`);try{const O=await this.sendToken(Fe,k,R.npub,"Auto-locked for security"),$e=typeof O=="string"?O:O.token;console.log(` Created locked token: ${$e.substring(0,50)}...`),console.log(" Receiving locked token back into wallet...");const ze=await this.receiveToken($e,!0);console.log(` Re-locked ${ze.length} proofs (${ze.reduce((q,W)=>q+W.amount,0)} sats) successfully!`)}catch(O){console.error(` Failed to re-lock proofs from ${k}:`,O.message)}}console.log(" AUTO-RELOCK complete!")}}else console.log(r?" Skipping auto-relock (already processing locked token)":" All received proofs are already P2PK locked - no re-locking needed");return console.log(" Publishing receive state to NIP-60 (skip merge)..."),await useEcashStore.getState().publishProofsToNostr(!0),o}catch(n){throw console.error("Receive failed:",n),n}}static async consolidateProofs(e,r){console.log(` Consolidating ${r.length} proofs from ${e}...`);const n=await this.getInitializedWallet(e),s=He({mint:e,proofs:r}),o=await n.receive(s);return console.log(` Consolidated ${r.length} proofs  ${o.length} proofs`),o}static async transferBetweenMints(e,r,n){try{console.log(` Transferring ${e} sats from ${r} to ${n}...`),console.log(" Creating mint quote at destination...");const s=await this.getInitializedWallet(n),o=await s.createMintQuote(e);if(!o.request)throw new Error("Failed to create mint quote - no invoice received");console.log(` Mint quote created: ${o.quote}`),console.log(` Lightning invoice: ${o.request.substring(0,50)}...`),console.log(" Melting proofs at source mint...");const c=await this.meltTokens(r,o.request);console.log(` Melt successful! Spent ${c.amountSpent} sats`),console.log(" Claiming minted proofs at destination...");const u=await s.mintProofs(e,o.quote);return useEcashStore.getState().addProofs(u,!0),console.log(" Publishing updated wallet state to NIP-60..."),await useEcashStore.getState().publishProofsToNostr(!0),console.log(` Transfer complete! Received ${u.length} proofs at destination`),{success:!0,newProofs:u}}catch(s){return console.error(" Transfer failed:",s),{success:!1,error:s.message||"Unknown error"}}}static async checkProofStates(e,r){console.log(` Checking ${r.length} proofs at ${e}...`);const n=await this.getInitializedWallet(e);try{const s=await n.checkProofsStates(r),o=[],c=[];return r.forEach((u,f)=>{const x=s[f];x&&x.state==="SPENT"?o.push(u):c.push(u)}),console.log(` Check complete: ${c.length} valid, ${o.length} spent`),{valid:c,spent:o}}catch(s){return console.error(" Failed to check proof states:",s),{valid:r,spent:[]}}}static async sendToken(e,r,n,s,o=!1){console.log(` CashuService: Sending ${e} from ${r}${o?" (keeping proofs for later removal)":""}`);const c=await this.getInitializedWallet(r),u=useEcashStore.getState().proofs,f=new Set;c.keys&&c.keys.size>0?c.keys.forEach((Re,Fe)=>f.add(Fe)):console.warn(" Wallet keys map is empty, falling back to all keysets logic might be needed if this fails.");const x=u.filter(Re=>f.has(Re.id));if(console.log(` CashuService: Found ${x.length} proofs for this mint (out of ${u.length} total)`),console.log(" CashuService: Valid Keysets:",Array.from(f)),x.length===0)throw new Error("No proofs found for this specific mint");const p=x.reduce((Re,Fe)=>Re+Fe.amount,0);if(p<e)throw new Error(`Insufficient balance in this mint. Have: ${p}, Need: ${e}`);let g;if(n)try{const Re=nip19_exports$1.decode(n);Re.type==="npub"&&(g=Re.data,g.length===64&&(g="02"+g))}catch{throw new Error("Invalid Recipient Npub")}let y;try{console.log(" Initiating wallet.send..."),y=await c.send(e,x,{pubkey:g}),console.log(" Wallet send successful. Response keys:",Object.keys(y))}catch(Re){throw console.error(" Crash inside wallet.send:",Re),console.error(" Stack trace:",Re.stack),new Error(`Wallet send failed: ${Re.message}`)}const b=y.keep||y.returnChange||[],R=y.send||[];if(console.log(` Swap complete. Keep: ${b.length}, Send: ${R.length}`),o)console.log(" Removing original proofs from wallet (already spent at mint)..."),useEcashStore.getState().removeProofs(x,!0),useEcashStore.getState().addProofs(b,!0),console.log(" Original proofs removed, change added to wallet.");else try{console.log(" Updating store (removing inputs, adding keep)..."),useEcashStore.getState().removeProofs(x),useEcashStore.getState().addProofs(b),console.log(" Store updated."),console.log(" Publishing send state to NIP-60 (skip merge)..."),await useEcashStore.getState().publishProofsToNostr(!0)}catch(Re){throw console.error(" Store update failed:",Re),Re}console.log(" Encoding token...");const k=He({mint:r,proofs:R,memo:s,unit:"sat"},{version:3});return o?{token:k,usedProofs:x}:k}static getMintBalance(e){return 0}static async validateMint(e){try{return await this.getMint(e).getKeys(),"online"}catch{return"offline"}}static async getMintQuote(e,r){return await(await this.getInitializedWallet(e)).createMintQuote(r)}static async claimMintQuote(e,r,n){const o=await(await this.getInitializedWallet(e)).mintProofs(n,r);return useEcashStore.getState().addProofs(o),o}static async getMeltQuote(e,r){return await(await this.getInitializedWallet(e)).createMeltQuote(r)}static async meltTokens(e,r){const n=await this.getInitializedWallet(e),s=await n.createMeltQuote(r),o=useEcashStore.getState().proofs,{mints:c}=useEcashStore.getState();console.log(` meltTokens: Looking for proofs for mint: ${e}`),console.log(` Total proofs available: ${o.length}`),console.log(" Available mints:",Object.keys(c));const u=o.filter(b=>{const R=c[e]?.keys;if(!R)return!1;let D=!1;return R.keysets&&Array.isArray(R.keysets)?D=R.keysets.some(k=>k.id===b.id):R[b.id]&&(D=!0),console.log(`  Proof ${b.secret.substring(0,10)}... (keyset: ${b.id}) -> ${D?"MATCH":"NO MATCH"}`),D});console.log(` Found ${u.length} proofs for ${e}`);const f=u.reduce((b,R)=>b+R.amount,0),x=s.amount+s.fee_reserve;if(console.log(` Quote: amount=${s.amount} sats, fee_reserve=${s.fee_reserve} sats`),console.log(` Required: ${x} sats, Available: ${f} sats`),f<x)throw new Error(`Insufficient balance. Need ${x} sats, have ${f} sats`);let p=[],g=0;for(const b of u){if(g>=x)break;p.push(b),g+=b.amount}console.log(` Selected ${p.length} proofs totaling ${g} sats`);const y=await n.meltProofs(s,p);return useEcashStore.getState().removeProofs(p),y.change&&y.change.length>0&&useEcashStore.getState().addProofs(y.change),console.log(" Publishing melt state to NIP-60 (skip merge)..."),await useEcashStore.getState().publishProofsToNostr(!0),{quote:s,response:y,amountSpent:g,change:y.change}}}const KIND_NIP60_TOKEN=7375,KIND_NIP61_NUTZAP=9321;class Nip60Service{static async encryptWalletState(e,r,n){const{nip44:s}=await __vitePreload(async()=>{const{nip44:p}=await Promise.resolve().then(()=>index$3);return{nip44:p}},void 0,import.meta.url),o=new Uint8Array(r.match(/.{1,2}/g).map(p=>parseInt(p,16))),c=s.v2.utils.getConversationKey(o,n),u=e.history.sort((p,g)=>g.timestamp-p.timestamp).slice(0,1e3),f=JSON.stringify({proofs:e.proofs,history:u});return s.v2.encrypt(f,c)}static async decryptWalletState(e,r,n){const{nip44:s}=await __vitePreload(async()=>{const{nip44:x}=await Promise.resolve().then(()=>index$3);return{nip44:x}},void 0,import.meta.url),o=new Uint8Array(r.match(/.{1,2}/g).map(x=>parseInt(x,16))),c=s.v2.utils.getConversationKey(o,n),u=s.v2.decrypt(e,c),f=JSON.parse(u);return Array.isArray(f)?(console.log(" Detected old NIP-60 format (proofs only)"),{proofs:f,history:[]}):{proofs:f.proofs||[],history:f.history||[]}}static createProofEvent(e){return{kind:30078,content:e,tags:[["d","proofs"]],created_at:Math.floor(Date.now()/1e3)}}static async publishWalletState(e,r,n,s){try{console.log(` Publishing ${r.proofs.length} proofs + ${r.history.length} history entries to Nostr...`);const o=await this.encryptWalletState(r,n,s),c=this.createProofEvent(o),{NDKEvent:u}=await __vitePreload(async()=>{const{NDKEvent:p}=await Promise.resolve().then(()=>index$1);return{NDKEvent:p}},void 0,import.meta.url),f=new u(e,c);await f.sign();const x=await f.publish();console.log(` Wallet state published to ${x.size} relays`),x.size===0&&console.warn(" Published to 0 relays - wallet state may not sync")}catch(o){throw console.error(" Failed to publish wallet state:",o),o}}static subscribeToWalletState(e,r,n,s){console.log(" Subscribing to NIP-60 wallet state events...");let o=0;const c=e.subscribe({kinds:[30078],authors:[r],"#d":["proofs"]});return c.on("event",async u=>{try{if(u.created_at<=o){console.log(` Skipping older NIP-60 event (${u.created_at} <= ${o})`);return}console.log(" Received NIP-60 wallet state event:",u.id),o=u.created_at;const f=await this.decryptWalletState(u.content,n,r);console.log(` Decrypted ${f.proofs.length} proofs + ${f.history.length} history entries from Nostr`),s(f)}catch(f){console.error(" Failed to decrypt wallet state event:",f)}}),c}static createTokenEvent(e,r){return{kind:KIND_NIP60_TOKEN,content:e,tags:r?[["p",r]]:[],created_at:Math.floor(Date.now()/1e3)}}}class Nip61Service{static createNutZapEvent(e,r,n,s,o){const c=[["p",s],["amount",n.toString()],["mint",r],["u",r]];return o&&c.push(["desc",o]),{kind:KIND_NIP61_NUTZAP,content:e,tags:c,created_at:Math.floor(Date.now()/1e3)}}static parseNutZap(e){if(e.kind!==KIND_NIP61_NUTZAP)return console.log("NIP61: Invalid kind",e.kind),null;try{if(!e.content.startsWith("cashu"))return console.log("NIP61: Content does not start with cashu"),null;const n=e.tags.find(o=>o[0]==="amount"),s=e.tags.find(o=>o[0]==="mint"||o[0]==="u");return!n&&!s&&console.log("NIP61: Missing amount or mint tags. Proceeding with limited info."),{mint:s?s[1]:"",proofs:[],amount:n?parseInt(n[1]):0,memo:e.tags.find(o=>o[0]==="desc")?.[1]||"",sender:e.pubkey}}catch(r){return console.error("NIP61: Parse error",r),null}}}const nip61=Object.freeze(Object.defineProperty({__proto__:null,KIND_NIP60_TOKEN,KIND_NIP61_NUTZAP,Nip60Service,Nip61Service},Symbol.toStringTag,{value:"Module"})),KIND_MINT_INFO=38172,KIND_MINT_RECOMMENDATION=38e3;class Nip87Service{static parseMintInfo(e){try{const r=e.tags.find(n=>n[0]==="u");return!r||!r[1]?null:{url:r[1].replace(/\/$/,""),pubkey:e.pubkey}}catch{return null}}static subscribeToMints(e){console.log(" Nip87Service: Subscribing to mints (kinds 38172, 38000)...");const r=e.subscribe({kinds:[KIND_MINT_INFO,KIND_MINT_RECOMMENDATION],limit:500},{closeOnEose:!1});r.on("eose",()=>{console.log(" Nip87Service: EOSE reached for mint subscription")});let n=0,s=Date.now();return r.on("event",o=>{n++;const c=Date.now();c-s>5e3&&(console.log(` NIP-87: Received ${n} mint discovery events`),s=c);const u=useEcashStore.getState();if(o.kind===KIND_MINT_INFO){const f=this.parseMintInfo(o);f&&f.url&&!u.discoveredMints[f.url]&&!u.mints[f.url]&&u.addDiscoveredMint({url:f.url,status:"unknown",trustScore:0,reviews:0,lastSeen:Date.now()})}else if(o.kind===KIND_MINT_RECOMMENDATION){const f=o.tags.find(x=>x[0]==="u");if(f&&f[1]){const x=f[1].replace(/\/$/,"");u.discoveredMints[x]&&u.updateMintTrust(x,1)}}}),r}}const EcashReceiveModal=({isOpen:t,onClose:e})=>{const r=useWalletStore(v=>v.wallets.find(I=>I.id===v.currentWalletId)?.keypairs.find(I=>I.id===v.currentKeypairId)),{mints:n,addHistoryItem:s}=useEcashStore(),[o,c]=reactExports.useState("nutzap"),[u,f]=reactExports.useState(""),[x,p]=reactExports.useState(!1),[g,y]=reactExports.useState(null),[b,R]=reactExports.useState(100),[D,k]=reactExports.useState(""),[Re,Fe]=reactExports.useState(null),[O,$e]=reactExports.useState(!1),[ze,q]=reactExports.useState(!1),[W,We]=reactExports.useState(!1);reactExports.useEffect(()=>{if(t&&!D){const v=Object.values(n).filter(I=>I.active);v.length>0&&k(v[0].url)}},[t,n]),reactExports.useEffect(()=>{t||(We(!1),Fe(null),q(!1),y(null),f(""))},[t]),reactExports.useEffect(()=>{o!=="lightning"&&(We(!1),Fe(null),q(!1))},[o]);const Xe=async()=>{if(u){p(!0),y(null);try{const I=(await CashuService.receiveToken(u)).reduce((Ce,P)=>Ce+P.amount,0);y({type:"success",msg:`Successfully received ${I} sats!`}),f(""),setTimeout(e,2e3)}catch(v){y({type:"error",msg:v.message||"Failed to claim token"})}finally{p(!1)}}},it=async()=>{if(!(!D||b<=0)){$e(!0),We(!1);try{const v=await CashuService.getMintQuote(D,b);Fe(v),q(!0),Ve(D,v.quote)}catch(v){console.error(v),y({type:"error",msg:"Failed to generate invoice"})}finally{$e(!1)}}},Ve=async(v,I)=>{const Ce=setInterval(async()=>{try{const P=await CashuService.claimMintQuote(v,I,b);P&&P.length>0&&(clearInterval(Ce),q(!1),We(!0),s({id:`mint-${I}-${Date.now()}`,type:"receive",amount:b,timestamp:Math.floor(Date.now()/1e3),mint:v,isNutzap:!1}),setTimeout(e,2e3))}catch{}},3e3);setTimeout(()=>{clearInterval(Ce),ze&&q(!1)},3e5)};return!t||!r?null:jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-md overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Receive eCash"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-1 text-slate-400 hover:text-white rounded-lg",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex border-b border-slate-800",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{c("nutzap"),We(!1),Fe(null)},className:`flex-1 py-3 text-sm font-bold transition-colors border-b-2 ${o==="nutzap"?"border-purple-500 text-purple-400":"border-transparent text-slate-500 hover:text-slate-300"}`,children:"NutZap"}),jsxRuntimeExports.jsx("button",{onClick:()=>{c("lightning"),We(!1),Fe(null)},className:`flex-1 py-3 text-sm font-bold transition-colors border-b-2 ${o==="lightning"?"border-purple-500 text-purple-400":"border-transparent text-slate-500 hover:text-slate-300"}`,children:"Lightning"})]}),jsxRuntimeExports.jsxs("div",{className:"p-6",children:[o==="nutzap"?jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-white p-4 rounded-xl",children:jsxRuntimeExports.jsx(QRCodeSVG,{value:r.npub,size:180})}),jsxRuntimeExports.jsxs("p",{className:"text-slate-400 text-sm text-center",children:["Share this QR to receive ",jsxRuntimeExports.jsx("span",{className:"text-purple-400 font-bold",children:"NutZaps"}),"."]}),jsxRuntimeExports.jsxs("button",{onClick:()=>navigator.clipboard.writeText(r.npub),className:"flex items-center gap-2 px-3 py-1.5 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-300 text-xs font-mono transition-colors",children:[jsxRuntimeExports.jsx(Copy,{className:"w-3 h-3"}),r.npub.slice(0,10),"...",r.npub.slice(-10)]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-slate-800"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Import Token"}),jsxRuntimeExports.jsx("textarea",{value:u,onChange:v=>f(v.target.value),placeholder:"Paste cashuA... token here",className:"w-full h-24 bg-slate-950 border border-slate-800 rounded-xl p-3 text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all font-mono text-xs resize-none"}),jsxRuntimeExports.jsx("button",{onClick:Xe,disabled:x||!u,className:"w-full mt-3 py-3 px-4 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2",children:x?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):"Claim Token"})]})]}):jsxRuntimeExports.jsx("div",{className:"space-y-6",children:Re?jsxRuntimeExports.jsx("div",{className:"space-y-6 text-center",children:W?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-2 py-8 animate-in zoom-in",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-green-500/10 rounded-full flex items-center justify-center ring-4 ring-green-500/20 mb-2",children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-8 h-8 text-green-500"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-white",children:"Payment Received!"}),jsxRuntimeExports.jsxs("p",{className:"text-slate-400",children:["Successfully minted ",b," sats."]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"p-4 bg-white rounded-xl mx-auto w-fit",children:jsxRuntimeExports.jsx(QRCodeSVG,{value:Re.request,size:200})}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("h3",{className:"font-bold text-white text-lg",children:[b," sats"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 break-all bg-slate-950 p-2 rounded border border-slate-800 font-mono select-all",children:Re.request})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2 text-purple-400 text-sm animate-pulse",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Waiting for payment..."})]})]})}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Receive to Mint"}),Object.values(n).filter(v=>v.active).length===0?jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-xl text-red-300 text-sm",children:"No active mints found. Please add a mint in the wallet view first."}):jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("select",{value:D,onChange:v=>k(v.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white outline-none focus:border-purple-500 appearance-none pr-10",children:Object.values(n).filter(v=>v.active).map(v=>jsxRuntimeExports.jsx("option",{value:v.url,className:"bg-slate-800 text-white",children:v.url.replace("https://","").replace(/\/$/,"")},v.url))}),jsxRuntimeExports.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400",children:jsxRuntimeExports.jsx(ChevronDown,{className:"w-4 h-4"})})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Amount (sats)"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"number",value:b,onChange:v=>R(parseInt(v.target.value)||0),className:"w-full bg-slate-950 border border-slate-800 rounded-xl p-3 pl-3 pr-12 text-white outline-none focus:border-purple-500 font-mono text-lg"}),jsxRuntimeExports.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 text-sm font-bold",children:"SATS"})]})]}),jsxRuntimeExports.jsx("button",{onClick:it,disabled:O||!D||b<=0,className:"w-full py-3 px-4 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2",children:O?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Zap,{className:"w-4 h-4 fill-current"})," Generate Invoice"]})})]})}),g&&jsxRuntimeExports.jsxs("div",{className:`mt-4 p-3 rounded-lg text-sm flex items-center gap-2 ${g.type==="success"?"bg-green-500/10 text-green-400":"bg-red-500/10 text-red-400"}`,children:[g.type==="success"?jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4"}),g.msg]})]})]})})};class LnurlService{static isLightningAddress(e){return/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e.trim())}static parseLightningAddress(e){const[r,n]=e.split("@");return{username:r,domain:n}}static async resolveToInvoice(e,r){try{const{username:n,domain:s}=this.parseLightningAddress(e);console.log(` Resolving ${n}@${s} for ${r} sats`);const o=`https://${s}/.well-known/lnurlp/${n}`;console.log(` Fetching: ${o}`);const c=await fetch(o);if(!c.ok)throw new Error(`Failed to fetch Lightning address info: ${c.statusText}`);const u=await c.json();if(u.tag!=="payRequest")throw new Error("Invalid LNURL-pay response");const f=r*1e3;if(f<u.minSendable||f>u.maxSendable){const y=Math.ceil(u.minSendable/1e3),b=Math.floor(u.maxSendable/1e3);throw new Error(`Amount must be between ${y} and ${b} sats`)}const x=`${u.callback}?amount=${f}`;console.log(` Requesting invoice: ${x}`);const p=await fetch(x);if(!p.ok)throw new Error(`Failed to get invoice: ${p.statusText}`);const g=await p.json();if(!g.pr)throw new Error("No invoice returned from Lightning address");return console.log(" Lightning address resolved to invoice"),g.pr}catch(n){throw console.error(" Lightning address resolution failed:",n),new Error(`Failed to resolve ${e}: ${n.message}`)}}}var bech32,hasRequiredBech32;function requireBech32(){if(hasRequiredBech32)return bech32;hasRequiredBech32=1;for(var t="qpzry9x8gf2tvdw0s3jn54khce6mua7l",e={},r=0;r<t.length;r++){var n=t.charAt(r);if(e[n]!==void 0)throw new TypeError(n+" is ambiguous");e[n]=r}function s(D){var k=D>>25;return(D&33554431)<<5^-(k>>0&1)&996825010^-(k>>1&1)&642813549^-(k>>2&1)&513874426^-(k>>3&1)&1027748829^-(k>>4&1)&705979059}function o(D){for(var k=1,Re=0;Re<D.length;++Re){var Fe=D.charCodeAt(Re);if(Fe<33||Fe>126)return"Invalid prefix ("+D+")";k=s(k)^Fe>>5}for(k=s(k),Re=0;Re<D.length;++Re){var O=D.charCodeAt(Re);k=s(k)^O&31}return k}function c(D,k,Re){if(Re=Re||90,D.length+7+k.length>Re)throw new TypeError("Exceeds length limit");D=D.toLowerCase();var Fe=o(D);if(typeof Fe=="string")throw new Error(Fe);for(var O=D+"1",$e=0;$e<k.length;++$e){var ze=k[$e];if(ze>>5!==0)throw new Error("Non 5-bit word");Fe=s(Fe)^ze,O+=t.charAt(ze)}for($e=0;$e<6;++$e)Fe=s(Fe);for(Fe^=1,$e=0;$e<6;++$e){var q=Fe>>(5-$e)*5&31;O+=t.charAt(q)}return O}function u(D,k){if(k=k||90,D.length<8)return D+" too short";if(D.length>k)return"Exceeds length limit";var Re=D.toLowerCase(),Fe=D.toUpperCase();if(D!==Re&&D!==Fe)return"Mixed-case string "+D;D=Re;var O=D.lastIndexOf("1");if(O===-1)return"No separator character for "+D;if(O===0)return"Missing prefix for "+D;var $e=D.slice(0,O),ze=D.slice(O+1);if(ze.length<6)return"Data too short";var q=o($e);if(typeof q=="string")return q;for(var W=[],We=0;We<ze.length;++We){var Xe=ze.charAt(We),it=e[Xe];if(it===void 0)return"Unknown character "+Xe;q=s(q)^it,!(We+6>=ze.length)&&W.push(it)}return q!==1?"Invalid checksum for "+D:{prefix:$e,words:W}}function f(){var D=u.apply(null,arguments);if(typeof D=="object")return D}function x(D){var k=u.apply(null,arguments);if(typeof k=="object")return k;throw new Error(k)}function p(D,k,Re,Fe){for(var O=0,$e=0,ze=(1<<Re)-1,q=[],W=0;W<D.length;++W)for(O=O<<k|D[W],$e+=k;$e>=Re;)$e-=Re,q.push(O>>$e&ze);if(Fe)$e>0&&q.push(O<<Re-$e&ze);else{if($e>=k)return"Excess padding";if(O<<Re-$e&ze)return"Non-zero padding"}return q}function g(D){var k=p(D,8,5,!0);if(Array.isArray(k))return k}function y(D){var k=p(D,8,5,!0);if(Array.isArray(k))return k;throw new Error(k)}function b(D){var k=p(D,5,8,!1);if(Array.isArray(k))return k}function R(D){var k=p(D,5,8,!1);if(Array.isArray(k))return k;throw new Error(k)}return bech32={decodeUnsafe:f,decode:x,encode:c,toWordsUnsafe:g,toWords:y,fromWordsUnsafe:b,fromWords:R},bech32}var bech32Exports=requireBech32(),bn$1={exports:{}},bn=bn$1.exports,hasRequiredBn;function requireBn(){return hasRequiredBn||(hasRequiredBn=1,(function(t){(function(e,r){function n(Ve,v){if(!Ve)throw new Error(v||"Assertion failed")}function s(Ve,v){Ve.super_=v;var I=function(){};I.prototype=v.prototype,Ve.prototype=new I,Ve.prototype.constructor=Ve}function o(Ve,v,I){if(o.isBN(Ve))return Ve;this.negative=0,this.words=null,this.length=0,this.red=null,Ve!==null&&((v==="le"||v==="be")&&(I=v,v=10),this._init(Ve||0,v||10,I||"be"))}typeof e=="object"?e.exports=o:r.BN=o,o.BN=o,o.wordSize=26;var c;try{typeof window<"u"&&typeof window.Buffer<"u"?c=window.Buffer:c=requireDist$4().Buffer}catch{}o.isBN=function(v){return v instanceof o?!0:v!==null&&typeof v=="object"&&v.constructor.wordSize===o.wordSize&&Array.isArray(v.words)},o.max=function(v,I){return v.cmp(I)>0?v:I},o.min=function(v,I){return v.cmp(I)<0?v:I},o.prototype._init=function(v,I,Ce){if(typeof v=="number")return this._initNumber(v,I,Ce);if(typeof v=="object")return this._initArray(v,I,Ce);I==="hex"&&(I=16),n(I===(I|0)&&I>=2&&I<=36),v=v.toString().replace(/\s+/g,"");var P=0;v[0]==="-"&&(P++,this.negative=1),P<v.length&&(I===16?this._parseHex(v,P,Ce):(this._parseBase(v,I,P),Ce==="le"&&this._initArray(this.toArray(),I,Ce)))},o.prototype._initNumber=function(v,I,Ce){v<0&&(this.negative=1,v=-v),v<67108864?(this.words=[v&67108863],this.length=1):v<4503599627370496?(this.words=[v&67108863,v/67108864&67108863],this.length=2):(n(v<9007199254740992),this.words=[v&67108863,v/67108864&67108863,1],this.length=3),Ce==="le"&&this._initArray(this.toArray(),I,Ce)},o.prototype._initArray=function(v,I,Ce){if(n(typeof v.length=="number"),v.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(v.length/3),this.words=new Array(this.length);for(var P=0;P<this.length;P++)this.words[P]=0;var _e,Le,Ye=0;if(Ce==="be")for(P=v.length-1,_e=0;P>=0;P-=3)Le=v[P]|v[P-1]<<8|v[P-2]<<16,this.words[_e]|=Le<<Ye&67108863,this.words[_e+1]=Le>>>26-Ye&67108863,Ye+=24,Ye>=26&&(Ye-=26,_e++);else if(Ce==="le")for(P=0,_e=0;P<v.length;P+=3)Le=v[P]|v[P+1]<<8|v[P+2]<<16,this.words[_e]|=Le<<Ye&67108863,this.words[_e+1]=Le>>>26-Ye&67108863,Ye+=24,Ye>=26&&(Ye-=26,_e++);return this.strip()};function u(Ve,v){var I=Ve.charCodeAt(v);return I>=65&&I<=70?I-55:I>=97&&I<=102?I-87:I-48&15}function f(Ve,v,I){var Ce=u(Ve,I);return I-1>=v&&(Ce|=u(Ve,I-1)<<4),Ce}o.prototype._parseHex=function(v,I,Ce){this.length=Math.ceil((v.length-I)/6),this.words=new Array(this.length);for(var P=0;P<this.length;P++)this.words[P]=0;var _e=0,Le=0,Ye;if(Ce==="be")for(P=v.length-1;P>=I;P-=2)Ye=f(v,I,P)<<_e,this.words[Le]|=Ye&67108863,_e>=18?(_e-=18,Le+=1,this.words[Le]|=Ye>>>26):_e+=8;else{var je=v.length-I;for(P=je%2===0?I+1:I;P<v.length;P+=2)Ye=f(v,I,P)<<_e,this.words[Le]|=Ye&67108863,_e>=18?(_e-=18,Le+=1,this.words[Le]|=Ye>>>26):_e+=8}this.strip()};function x(Ve,v,I,Ce){for(var P=0,_e=Math.min(Ve.length,I),Le=v;Le<_e;Le++){var Ye=Ve.charCodeAt(Le)-48;P*=Ce,Ye>=49?P+=Ye-49+10:Ye>=17?P+=Ye-17+10:P+=Ye}return P}o.prototype._parseBase=function(v,I,Ce){this.words=[0],this.length=1;for(var P=0,_e=1;_e<=67108863;_e*=I)P++;P--,_e=_e/I|0;for(var Le=v.length-Ce,Ye=Le%P,je=Math.min(Le,Le-Ye)+Ce,K=0,L=Ce;L<je;L+=P)K=x(v,L,L+P,I),this.imuln(_e),this.words[0]+K<67108864?this.words[0]+=K:this._iaddn(K);if(Ye!==0){var st=1;for(K=x(v,L,v.length,I),L=0;L<Ye;L++)st*=I;this.imuln(st),this.words[0]+K<67108864?this.words[0]+=K:this._iaddn(K)}this.strip()},o.prototype.copy=function(v){v.words=new Array(this.length);for(var I=0;I<this.length;I++)v.words[I]=this.words[I];v.length=this.length,v.negative=this.negative,v.red=this.red},o.prototype.clone=function(){var v=new o(null);return this.copy(v),v},o.prototype._expand=function(v){for(;this.length<v;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},o.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var p=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],g=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],y=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];o.prototype.toString=function(v,I){v=v||10,I=I|0||1;var Ce;if(v===16||v==="hex"){Ce="";for(var P=0,_e=0,Le=0;Le<this.length;Le++){var Ye=this.words[Le],je=((Ye<<P|_e)&16777215).toString(16);_e=Ye>>>24-P&16777215,P+=2,P>=26&&(P-=26,Le--),_e!==0||Le!==this.length-1?Ce=p[6-je.length]+je+Ce:Ce=je+Ce}for(_e!==0&&(Ce=_e.toString(16)+Ce);Ce.length%I!==0;)Ce="0"+Ce;return this.negative!==0&&(Ce="-"+Ce),Ce}if(v===(v|0)&&v>=2&&v<=36){var K=g[v],L=y[v];Ce="";var st=this.clone();for(st.negative=0;!st.isZero();){var dt=st.modn(L).toString(v);st=st.idivn(L),st.isZero()?Ce=dt+Ce:Ce=p[K-dt.length]+dt+Ce}for(this.isZero()&&(Ce="0"+Ce);Ce.length%I!==0;)Ce="0"+Ce;return this.negative!==0&&(Ce="-"+Ce),Ce}n(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var v=this.words[0];return this.length===2?v+=this.words[1]*67108864:this.length===3&&this.words[2]===1?v+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-v:v},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(v,I){return n(typeof c<"u"),this.toArrayLike(c,v,I)},o.prototype.toArray=function(v,I){return this.toArrayLike(Array,v,I)},o.prototype.toArrayLike=function(v,I,Ce){var P=this.byteLength(),_e=Ce||Math.max(1,P);n(P<=_e,"byte array longer than desired length"),n(_e>0,"Requested array length <= 0"),this.strip();var Le=I==="le",Ye=new v(_e),je,K,L=this.clone();if(Le){for(K=0;!L.isZero();K++)je=L.andln(255),L.iushrn(8),Ye[K]=je;for(;K<_e;K++)Ye[K]=0}else{for(K=0;K<_e-P;K++)Ye[K]=0;for(K=0;!L.isZero();K++)je=L.andln(255),L.iushrn(8),Ye[_e-K-1]=je}return Ye},Math.clz32?o.prototype._countBits=function(v){return 32-Math.clz32(v)}:o.prototype._countBits=function(v){var I=v,Ce=0;return I>=4096&&(Ce+=13,I>>>=13),I>=64&&(Ce+=7,I>>>=7),I>=8&&(Ce+=4,I>>>=4),I>=2&&(Ce+=2,I>>>=2),Ce+I},o.prototype._zeroBits=function(v){if(v===0)return 26;var I=v,Ce=0;return(I&8191)===0&&(Ce+=13,I>>>=13),(I&127)===0&&(Ce+=7,I>>>=7),(I&15)===0&&(Ce+=4,I>>>=4),(I&3)===0&&(Ce+=2,I>>>=2),(I&1)===0&&Ce++,Ce},o.prototype.bitLength=function(){var v=this.words[this.length-1],I=this._countBits(v);return(this.length-1)*26+I};function b(Ve){for(var v=new Array(Ve.bitLength()),I=0;I<v.length;I++){var Ce=I/26|0,P=I%26;v[I]=(Ve.words[Ce]&1<<P)>>>P}return v}o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var v=0,I=0;I<this.length;I++){var Ce=this._zeroBits(this.words[I]);if(v+=Ce,Ce!==26)break}return v},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(v){return this.negative!==0?this.abs().inotn(v).iaddn(1):this.clone()},o.prototype.fromTwos=function(v){return this.testn(v-1)?this.notn(v).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return this.negative!==0},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(v){for(;this.length<v.length;)this.words[this.length++]=0;for(var I=0;I<v.length;I++)this.words[I]=this.words[I]|v.words[I];return this.strip()},o.prototype.ior=function(v){return n((this.negative|v.negative)===0),this.iuor(v)},o.prototype.or=function(v){return this.length>v.length?this.clone().ior(v):v.clone().ior(this)},o.prototype.uor=function(v){return this.length>v.length?this.clone().iuor(v):v.clone().iuor(this)},o.prototype.iuand=function(v){var I;this.length>v.length?I=v:I=this;for(var Ce=0;Ce<I.length;Ce++)this.words[Ce]=this.words[Ce]&v.words[Ce];return this.length=I.length,this.strip()},o.prototype.iand=function(v){return n((this.negative|v.negative)===0),this.iuand(v)},o.prototype.and=function(v){return this.length>v.length?this.clone().iand(v):v.clone().iand(this)},o.prototype.uand=function(v){return this.length>v.length?this.clone().iuand(v):v.clone().iuand(this)},o.prototype.iuxor=function(v){var I,Ce;this.length>v.length?(I=this,Ce=v):(I=v,Ce=this);for(var P=0;P<Ce.length;P++)this.words[P]=I.words[P]^Ce.words[P];if(this!==I)for(;P<I.length;P++)this.words[P]=I.words[P];return this.length=I.length,this.strip()},o.prototype.ixor=function(v){return n((this.negative|v.negative)===0),this.iuxor(v)},o.prototype.xor=function(v){return this.length>v.length?this.clone().ixor(v):v.clone().ixor(this)},o.prototype.uxor=function(v){return this.length>v.length?this.clone().iuxor(v):v.clone().iuxor(this)},o.prototype.inotn=function(v){n(typeof v=="number"&&v>=0);var I=Math.ceil(v/26)|0,Ce=v%26;this._expand(I),Ce>0&&I--;for(var P=0;P<I;P++)this.words[P]=~this.words[P]&67108863;return Ce>0&&(this.words[P]=~this.words[P]&67108863>>26-Ce),this.strip()},o.prototype.notn=function(v){return this.clone().inotn(v)},o.prototype.setn=function(v,I){n(typeof v=="number"&&v>=0);var Ce=v/26|0,P=v%26;return this._expand(Ce+1),I?this.words[Ce]=this.words[Ce]|1<<P:this.words[Ce]=this.words[Ce]&~(1<<P),this.strip()},o.prototype.iadd=function(v){var I;if(this.negative!==0&&v.negative===0)return this.negative=0,I=this.isub(v),this.negative^=1,this._normSign();if(this.negative===0&&v.negative!==0)return v.negative=0,I=this.isub(v),v.negative=1,I._normSign();var Ce,P;this.length>v.length?(Ce=this,P=v):(Ce=v,P=this);for(var _e=0,Le=0;Le<P.length;Le++)I=(Ce.words[Le]|0)+(P.words[Le]|0)+_e,this.words[Le]=I&67108863,_e=I>>>26;for(;_e!==0&&Le<Ce.length;Le++)I=(Ce.words[Le]|0)+_e,this.words[Le]=I&67108863,_e=I>>>26;if(this.length=Ce.length,_e!==0)this.words[this.length]=_e,this.length++;else if(Ce!==this)for(;Le<Ce.length;Le++)this.words[Le]=Ce.words[Le];return this},o.prototype.add=function(v){var I;return v.negative!==0&&this.negative===0?(v.negative=0,I=this.sub(v),v.negative^=1,I):v.negative===0&&this.negative!==0?(this.negative=0,I=v.sub(this),this.negative=1,I):this.length>v.length?this.clone().iadd(v):v.clone().iadd(this)},o.prototype.isub=function(v){if(v.negative!==0){v.negative=0;var I=this.iadd(v);return v.negative=1,I._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(v),this.negative=1,this._normSign();var Ce=this.cmp(v);if(Ce===0)return this.negative=0,this.length=1,this.words[0]=0,this;var P,_e;Ce>0?(P=this,_e=v):(P=v,_e=this);for(var Le=0,Ye=0;Ye<_e.length;Ye++)I=(P.words[Ye]|0)-(_e.words[Ye]|0)+Le,Le=I>>26,this.words[Ye]=I&67108863;for(;Le!==0&&Ye<P.length;Ye++)I=(P.words[Ye]|0)+Le,Le=I>>26,this.words[Ye]=I&67108863;if(Le===0&&Ye<P.length&&P!==this)for(;Ye<P.length;Ye++)this.words[Ye]=P.words[Ye];return this.length=Math.max(this.length,Ye),P!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(v){return this.clone().isub(v)};function R(Ve,v,I){I.negative=v.negative^Ve.negative;var Ce=Ve.length+v.length|0;I.length=Ce,Ce=Ce-1|0;var P=Ve.words[0]|0,_e=v.words[0]|0,Le=P*_e,Ye=Le&67108863,je=Le/67108864|0;I.words[0]=Ye;for(var K=1;K<Ce;K++){for(var L=je>>>26,st=je&67108863,dt=Math.min(K,v.length-1),Je=Math.max(0,K-Ve.length+1);Je<=dt;Je++){var pt=K-Je|0;P=Ve.words[pt]|0,_e=v.words[Je]|0,Le=P*_e+st,L+=Le/67108864|0,st=Le&67108863}I.words[K]=st|0,je=L|0}return je!==0?I.words[K]=je|0:I.length--,I.strip()}var D=function(v,I,Ce){var P=v.words,_e=I.words,Le=Ce.words,Ye=0,je,K,L,st=P[0]|0,dt=st&8191,Je=st>>>13,pt=P[1]|0,rr=pt&8191,cr=pt>>>13,fr=P[2]|0,ir=fr&8191,ft=fr>>>13,nr=P[3]|0,lr=nr&8191,er=nr>>>13,pr=P[4]|0,Er=pr&8191,xr=pr>>>13,wr=P[5]|0,Br=wr&8191,hr=wr>>>13,Cr=P[6]|0,_r=Cr&8191,Tr=Cr>>>13,Nr=P[7]|0,or=Nr&8191,tr=Nr>>>13,yr=P[8]|0,mr=yr&8191,sr=yr>>>13,Ar=P[9]|0,ht=Ar&8191,Qe=Ar>>>13,lt=_e[0]|0,ar=lt&8191,br=lt>>>13,Sr=_e[1]|0,Rr=Sr&8191,Lr=Sr>>>13,Gr=_e[2]|0,zr=Gr&8191,Vr=Gr>>>13,Zr=_e[3]|0,an=Zr&8191,nn=Zr>>>13,Xn=_e[4]|0,vn=Xn&8191,gn=Xn>>>13,Ai=_e[5]|0,dr=Ai&8191,yt=Ai>>>13,Ft=_e[6]|0,vr=Ft&8191,jr=Ft>>>13,Mr=_e[7]|0,Or=Mr&8191,Yr=Mr>>>13,An=_e[8]|0,tn=An&8191,Jr=An>>>13,rn=_e[9]|0,fn=rn&8191,_n=rn>>>13;Ce.negative=v.negative^I.negative,Ce.length=19,je=Math.imul(dt,ar),K=Math.imul(dt,br),K=K+Math.imul(Je,ar)|0,L=Math.imul(Je,br);var Bi=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(Bi>>>26)|0,Bi&=67108863,je=Math.imul(rr,ar),K=Math.imul(rr,br),K=K+Math.imul(cr,ar)|0,L=Math.imul(cr,br),je=je+Math.imul(dt,Rr)|0,K=K+Math.imul(dt,Lr)|0,K=K+Math.imul(Je,Rr)|0,L=L+Math.imul(Je,Lr)|0;var ko=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(ko>>>26)|0,ko&=67108863,je=Math.imul(ir,ar),K=Math.imul(ir,br),K=K+Math.imul(ft,ar)|0,L=Math.imul(ft,br),je=je+Math.imul(rr,Rr)|0,K=K+Math.imul(rr,Lr)|0,K=K+Math.imul(cr,Rr)|0,L=L+Math.imul(cr,Lr)|0,je=je+Math.imul(dt,zr)|0,K=K+Math.imul(dt,Vr)|0,K=K+Math.imul(Je,zr)|0,L=L+Math.imul(Je,Vr)|0;var jo=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(jo>>>26)|0,jo&=67108863,je=Math.imul(lr,ar),K=Math.imul(lr,br),K=K+Math.imul(er,ar)|0,L=Math.imul(er,br),je=je+Math.imul(ir,Rr)|0,K=K+Math.imul(ir,Lr)|0,K=K+Math.imul(ft,Rr)|0,L=L+Math.imul(ft,Lr)|0,je=je+Math.imul(rr,zr)|0,K=K+Math.imul(rr,Vr)|0,K=K+Math.imul(cr,zr)|0,L=L+Math.imul(cr,Vr)|0,je=je+Math.imul(dt,an)|0,K=K+Math.imul(dt,nn)|0,K=K+Math.imul(Je,an)|0,L=L+Math.imul(Je,nn)|0;var qi=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(qi>>>26)|0,qi&=67108863,je=Math.imul(Er,ar),K=Math.imul(Er,br),K=K+Math.imul(xr,ar)|0,L=Math.imul(xr,br),je=je+Math.imul(lr,Rr)|0,K=K+Math.imul(lr,Lr)|0,K=K+Math.imul(er,Rr)|0,L=L+Math.imul(er,Lr)|0,je=je+Math.imul(ir,zr)|0,K=K+Math.imul(ir,Vr)|0,K=K+Math.imul(ft,zr)|0,L=L+Math.imul(ft,Vr)|0,je=je+Math.imul(rr,an)|0,K=K+Math.imul(rr,nn)|0,K=K+Math.imul(cr,an)|0,L=L+Math.imul(cr,nn)|0,je=je+Math.imul(dt,vn)|0,K=K+Math.imul(dt,gn)|0,K=K+Math.imul(Je,vn)|0,L=L+Math.imul(Je,gn)|0;var Ts=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(Ts>>>26)|0,Ts&=67108863,je=Math.imul(Br,ar),K=Math.imul(Br,br),K=K+Math.imul(hr,ar)|0,L=Math.imul(hr,br),je=je+Math.imul(Er,Rr)|0,K=K+Math.imul(Er,Lr)|0,K=K+Math.imul(xr,Rr)|0,L=L+Math.imul(xr,Lr)|0,je=je+Math.imul(lr,zr)|0,K=K+Math.imul(lr,Vr)|0,K=K+Math.imul(er,zr)|0,L=L+Math.imul(er,Vr)|0,je=je+Math.imul(ir,an)|0,K=K+Math.imul(ir,nn)|0,K=K+Math.imul(ft,an)|0,L=L+Math.imul(ft,nn)|0,je=je+Math.imul(rr,vn)|0,K=K+Math.imul(rr,gn)|0,K=K+Math.imul(cr,vn)|0,L=L+Math.imul(cr,gn)|0,je=je+Math.imul(dt,dr)|0,K=K+Math.imul(dt,yt)|0,K=K+Math.imul(Je,dr)|0,L=L+Math.imul(Je,yt)|0;var Ci=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(Ci>>>26)|0,Ci&=67108863,je=Math.imul(_r,ar),K=Math.imul(_r,br),K=K+Math.imul(Tr,ar)|0,L=Math.imul(Tr,br),je=je+Math.imul(Br,Rr)|0,K=K+Math.imul(Br,Lr)|0,K=K+Math.imul(hr,Rr)|0,L=L+Math.imul(hr,Lr)|0,je=je+Math.imul(Er,zr)|0,K=K+Math.imul(Er,Vr)|0,K=K+Math.imul(xr,zr)|0,L=L+Math.imul(xr,Vr)|0,je=je+Math.imul(lr,an)|0,K=K+Math.imul(lr,nn)|0,K=K+Math.imul(er,an)|0,L=L+Math.imul(er,nn)|0,je=je+Math.imul(ir,vn)|0,K=K+Math.imul(ir,gn)|0,K=K+Math.imul(ft,vn)|0,L=L+Math.imul(ft,gn)|0,je=je+Math.imul(rr,dr)|0,K=K+Math.imul(rr,yt)|0,K=K+Math.imul(cr,dr)|0,L=L+Math.imul(cr,yt)|0,je=je+Math.imul(dt,vr)|0,K=K+Math.imul(dt,jr)|0,K=K+Math.imul(Je,vr)|0,L=L+Math.imul(Je,jr)|0;var Ss=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(Ss>>>26)|0,Ss&=67108863,je=Math.imul(or,ar),K=Math.imul(or,br),K=K+Math.imul(tr,ar)|0,L=Math.imul(tr,br),je=je+Math.imul(_r,Rr)|0,K=K+Math.imul(_r,Lr)|0,K=K+Math.imul(Tr,Rr)|0,L=L+Math.imul(Tr,Lr)|0,je=je+Math.imul(Br,zr)|0,K=K+Math.imul(Br,Vr)|0,K=K+Math.imul(hr,zr)|0,L=L+Math.imul(hr,Vr)|0,je=je+Math.imul(Er,an)|0,K=K+Math.imul(Er,nn)|0,K=K+Math.imul(xr,an)|0,L=L+Math.imul(xr,nn)|0,je=je+Math.imul(lr,vn)|0,K=K+Math.imul(lr,gn)|0,K=K+Math.imul(er,vn)|0,L=L+Math.imul(er,gn)|0,je=je+Math.imul(ir,dr)|0,K=K+Math.imul(ir,yt)|0,K=K+Math.imul(ft,dr)|0,L=L+Math.imul(ft,yt)|0,je=je+Math.imul(rr,vr)|0,K=K+Math.imul(rr,jr)|0,K=K+Math.imul(cr,vr)|0,L=L+Math.imul(cr,jr)|0,je=je+Math.imul(dt,Or)|0,K=K+Math.imul(dt,Yr)|0,K=K+Math.imul(Je,Or)|0,L=L+Math.imul(Je,Yr)|0;var _s=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(_s>>>26)|0,_s&=67108863,je=Math.imul(mr,ar),K=Math.imul(mr,br),K=K+Math.imul(sr,ar)|0,L=Math.imul(sr,br),je=je+Math.imul(or,Rr)|0,K=K+Math.imul(or,Lr)|0,K=K+Math.imul(tr,Rr)|0,L=L+Math.imul(tr,Lr)|0,je=je+Math.imul(_r,zr)|0,K=K+Math.imul(_r,Vr)|0,K=K+Math.imul(Tr,zr)|0,L=L+Math.imul(Tr,Vr)|0,je=je+Math.imul(Br,an)|0,K=K+Math.imul(Br,nn)|0,K=K+Math.imul(hr,an)|0,L=L+Math.imul(hr,nn)|0,je=je+Math.imul(Er,vn)|0,K=K+Math.imul(Er,gn)|0,K=K+Math.imul(xr,vn)|0,L=L+Math.imul(xr,gn)|0,je=je+Math.imul(lr,dr)|0,K=K+Math.imul(lr,yt)|0,K=K+Math.imul(er,dr)|0,L=L+Math.imul(er,yt)|0,je=je+Math.imul(ir,vr)|0,K=K+Math.imul(ir,jr)|0,K=K+Math.imul(ft,vr)|0,L=L+Math.imul(ft,jr)|0,je=je+Math.imul(rr,Or)|0,K=K+Math.imul(rr,Yr)|0,K=K+Math.imul(cr,Or)|0,L=L+Math.imul(cr,Yr)|0,je=je+Math.imul(dt,tn)|0,K=K+Math.imul(dt,Jr)|0,K=K+Math.imul(Je,tn)|0,L=L+Math.imul(Je,Jr)|0;var $s=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+($s>>>26)|0,$s&=67108863,je=Math.imul(ht,ar),K=Math.imul(ht,br),K=K+Math.imul(Qe,ar)|0,L=Math.imul(Qe,br),je=je+Math.imul(mr,Rr)|0,K=K+Math.imul(mr,Lr)|0,K=K+Math.imul(sr,Rr)|0,L=L+Math.imul(sr,Lr)|0,je=je+Math.imul(or,zr)|0,K=K+Math.imul(or,Vr)|0,K=K+Math.imul(tr,zr)|0,L=L+Math.imul(tr,Vr)|0,je=je+Math.imul(_r,an)|0,K=K+Math.imul(_r,nn)|0,K=K+Math.imul(Tr,an)|0,L=L+Math.imul(Tr,nn)|0,je=je+Math.imul(Br,vn)|0,K=K+Math.imul(Br,gn)|0,K=K+Math.imul(hr,vn)|0,L=L+Math.imul(hr,gn)|0,je=je+Math.imul(Er,dr)|0,K=K+Math.imul(Er,yt)|0,K=K+Math.imul(xr,dr)|0,L=L+Math.imul(xr,yt)|0,je=je+Math.imul(lr,vr)|0,K=K+Math.imul(lr,jr)|0,K=K+Math.imul(er,vr)|0,L=L+Math.imul(er,jr)|0,je=je+Math.imul(ir,Or)|0,K=K+Math.imul(ir,Yr)|0,K=K+Math.imul(ft,Or)|0,L=L+Math.imul(ft,Yr)|0,je=je+Math.imul(rr,tn)|0,K=K+Math.imul(rr,Jr)|0,K=K+Math.imul(cr,tn)|0,L=L+Math.imul(cr,Jr)|0,je=je+Math.imul(dt,fn)|0,K=K+Math.imul(dt,_n)|0,K=K+Math.imul(Je,fn)|0,L=L+Math.imul(Je,_n)|0;var Rs=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(Rs>>>26)|0,Rs&=67108863,je=Math.imul(ht,Rr),K=Math.imul(ht,Lr),K=K+Math.imul(Qe,Rr)|0,L=Math.imul(Qe,Lr),je=je+Math.imul(mr,zr)|0,K=K+Math.imul(mr,Vr)|0,K=K+Math.imul(sr,zr)|0,L=L+Math.imul(sr,Vr)|0,je=je+Math.imul(or,an)|0,K=K+Math.imul(or,nn)|0,K=K+Math.imul(tr,an)|0,L=L+Math.imul(tr,nn)|0,je=je+Math.imul(_r,vn)|0,K=K+Math.imul(_r,gn)|0,K=K+Math.imul(Tr,vn)|0,L=L+Math.imul(Tr,gn)|0,je=je+Math.imul(Br,dr)|0,K=K+Math.imul(Br,yt)|0,K=K+Math.imul(hr,dr)|0,L=L+Math.imul(hr,yt)|0,je=je+Math.imul(Er,vr)|0,K=K+Math.imul(Er,jr)|0,K=K+Math.imul(xr,vr)|0,L=L+Math.imul(xr,jr)|0,je=je+Math.imul(lr,Or)|0,K=K+Math.imul(lr,Yr)|0,K=K+Math.imul(er,Or)|0,L=L+Math.imul(er,Yr)|0,je=je+Math.imul(ir,tn)|0,K=K+Math.imul(ir,Jr)|0,K=K+Math.imul(ft,tn)|0,L=L+Math.imul(ft,Jr)|0,je=je+Math.imul(rr,fn)|0,K=K+Math.imul(rr,_n)|0,K=K+Math.imul(cr,fn)|0,L=L+Math.imul(cr,_n)|0;var Dn=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(Dn>>>26)|0,Dn&=67108863,je=Math.imul(ht,zr),K=Math.imul(ht,Vr),K=K+Math.imul(Qe,zr)|0,L=Math.imul(Qe,Vr),je=je+Math.imul(mr,an)|0,K=K+Math.imul(mr,nn)|0,K=K+Math.imul(sr,an)|0,L=L+Math.imul(sr,nn)|0,je=je+Math.imul(or,vn)|0,K=K+Math.imul(or,gn)|0,K=K+Math.imul(tr,vn)|0,L=L+Math.imul(tr,gn)|0,je=je+Math.imul(_r,dr)|0,K=K+Math.imul(_r,yt)|0,K=K+Math.imul(Tr,dr)|0,L=L+Math.imul(Tr,yt)|0,je=je+Math.imul(Br,vr)|0,K=K+Math.imul(Br,jr)|0,K=K+Math.imul(hr,vr)|0,L=L+Math.imul(hr,jr)|0,je=je+Math.imul(Er,Or)|0,K=K+Math.imul(Er,Yr)|0,K=K+Math.imul(xr,Or)|0,L=L+Math.imul(xr,Yr)|0,je=je+Math.imul(lr,tn)|0,K=K+Math.imul(lr,Jr)|0,K=K+Math.imul(er,tn)|0,L=L+Math.imul(er,Jr)|0,je=je+Math.imul(ir,fn)|0,K=K+Math.imul(ir,_n)|0,K=K+Math.imul(ft,fn)|0,L=L+Math.imul(ft,_n)|0;var Ki=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(Ki>>>26)|0,Ki&=67108863,je=Math.imul(ht,an),K=Math.imul(ht,nn),K=K+Math.imul(Qe,an)|0,L=Math.imul(Qe,nn),je=je+Math.imul(mr,vn)|0,K=K+Math.imul(mr,gn)|0,K=K+Math.imul(sr,vn)|0,L=L+Math.imul(sr,gn)|0,je=je+Math.imul(or,dr)|0,K=K+Math.imul(or,yt)|0,K=K+Math.imul(tr,dr)|0,L=L+Math.imul(tr,yt)|0,je=je+Math.imul(_r,vr)|0,K=K+Math.imul(_r,jr)|0,K=K+Math.imul(Tr,vr)|0,L=L+Math.imul(Tr,jr)|0,je=je+Math.imul(Br,Or)|0,K=K+Math.imul(Br,Yr)|0,K=K+Math.imul(hr,Or)|0,L=L+Math.imul(hr,Yr)|0,je=je+Math.imul(Er,tn)|0,K=K+Math.imul(Er,Jr)|0,K=K+Math.imul(xr,tn)|0,L=L+Math.imul(xr,Jr)|0,je=je+Math.imul(lr,fn)|0,K=K+Math.imul(lr,_n)|0,K=K+Math.imul(er,fn)|0,L=L+Math.imul(er,_n)|0;var zi=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(zi>>>26)|0,zi&=67108863,je=Math.imul(ht,vn),K=Math.imul(ht,gn),K=K+Math.imul(Qe,vn)|0,L=Math.imul(Qe,gn),je=je+Math.imul(mr,dr)|0,K=K+Math.imul(mr,yt)|0,K=K+Math.imul(sr,dr)|0,L=L+Math.imul(sr,yt)|0,je=je+Math.imul(or,vr)|0,K=K+Math.imul(or,jr)|0,K=K+Math.imul(tr,vr)|0,L=L+Math.imul(tr,jr)|0,je=je+Math.imul(_r,Or)|0,K=K+Math.imul(_r,Yr)|0,K=K+Math.imul(Tr,Or)|0,L=L+Math.imul(Tr,Yr)|0,je=je+Math.imul(Br,tn)|0,K=K+Math.imul(Br,Jr)|0,K=K+Math.imul(hr,tn)|0,L=L+Math.imul(hr,Jr)|0,je=je+Math.imul(Er,fn)|0,K=K+Math.imul(Er,_n)|0,K=K+Math.imul(xr,fn)|0,L=L+Math.imul(xr,_n)|0;var vs=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(vs>>>26)|0,vs&=67108863,je=Math.imul(ht,dr),K=Math.imul(ht,yt),K=K+Math.imul(Qe,dr)|0,L=Math.imul(Qe,yt),je=je+Math.imul(mr,vr)|0,K=K+Math.imul(mr,jr)|0,K=K+Math.imul(sr,vr)|0,L=L+Math.imul(sr,jr)|0,je=je+Math.imul(or,Or)|0,K=K+Math.imul(or,Yr)|0,K=K+Math.imul(tr,Or)|0,L=L+Math.imul(tr,Yr)|0,je=je+Math.imul(_r,tn)|0,K=K+Math.imul(_r,Jr)|0,K=K+Math.imul(Tr,tn)|0,L=L+Math.imul(Tr,Jr)|0,je=je+Math.imul(Br,fn)|0,K=K+Math.imul(Br,_n)|0,K=K+Math.imul(hr,fn)|0,L=L+Math.imul(hr,_n)|0;var ks=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(ks>>>26)|0,ks&=67108863,je=Math.imul(ht,vr),K=Math.imul(ht,jr),K=K+Math.imul(Qe,vr)|0,L=Math.imul(Qe,jr),je=je+Math.imul(mr,Or)|0,K=K+Math.imul(mr,Yr)|0,K=K+Math.imul(sr,Or)|0,L=L+Math.imul(sr,Yr)|0,je=je+Math.imul(or,tn)|0,K=K+Math.imul(or,Jr)|0,K=K+Math.imul(tr,tn)|0,L=L+Math.imul(tr,Jr)|0,je=je+Math.imul(_r,fn)|0,K=K+Math.imul(_r,_n)|0,K=K+Math.imul(Tr,fn)|0,L=L+Math.imul(Tr,_n)|0;var No=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(No>>>26)|0,No&=67108863,je=Math.imul(ht,Or),K=Math.imul(ht,Yr),K=K+Math.imul(Qe,Or)|0,L=Math.imul(Qe,Yr),je=je+Math.imul(mr,tn)|0,K=K+Math.imul(mr,Jr)|0,K=K+Math.imul(sr,tn)|0,L=L+Math.imul(sr,Jr)|0,je=je+Math.imul(or,fn)|0,K=K+Math.imul(or,_n)|0,K=K+Math.imul(tr,fn)|0,L=L+Math.imul(tr,_n)|0;var Vi=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(Vi>>>26)|0,Vi&=67108863,je=Math.imul(ht,tn),K=Math.imul(ht,Jr),K=K+Math.imul(Qe,tn)|0,L=Math.imul(Qe,Jr),je=je+Math.imul(mr,fn)|0,K=K+Math.imul(mr,_n)|0,K=K+Math.imul(sr,fn)|0,L=L+Math.imul(sr,_n)|0;var Gi=(Ye+je|0)+((K&8191)<<13)|0;Ye=(L+(K>>>13)|0)+(Gi>>>26)|0,Gi&=67108863,je=Math.imul(ht,fn),K=Math.imul(ht,_n),K=K+Math.imul(Qe,fn)|0,L=Math.imul(Qe,_n);var Do=(Ye+je|0)+((K&8191)<<13)|0;return Ye=(L+(K>>>13)|0)+(Do>>>26)|0,Do&=67108863,Le[0]=Bi,Le[1]=ko,Le[2]=jo,Le[3]=qi,Le[4]=Ts,Le[5]=Ci,Le[6]=Ss,Le[7]=_s,Le[8]=$s,Le[9]=Rs,Le[10]=Dn,Le[11]=Ki,Le[12]=zi,Le[13]=vs,Le[14]=ks,Le[15]=No,Le[16]=Vi,Le[17]=Gi,Le[18]=Do,Ye!==0&&(Le[19]=Ye,Ce.length++),Ce};Math.imul||(D=R);function k(Ve,v,I){I.negative=v.negative^Ve.negative,I.length=Ve.length+v.length;for(var Ce=0,P=0,_e=0;_e<I.length-1;_e++){var Le=P;P=0;for(var Ye=Ce&67108863,je=Math.min(_e,v.length-1),K=Math.max(0,_e-Ve.length+1);K<=je;K++){var L=_e-K,st=Ve.words[L]|0,dt=v.words[K]|0,Je=st*dt,pt=Je&67108863;Le=Le+(Je/67108864|0)|0,pt=pt+Ye|0,Ye=pt&67108863,Le=Le+(pt>>>26)|0,P+=Le>>>26,Le&=67108863}I.words[_e]=Ye,Ce=Le,Le=P}return Ce!==0?I.words[_e]=Ce:I.length--,I.strip()}function Re(Ve,v,I){var Ce=new Fe;return Ce.mulp(Ve,v,I)}o.prototype.mulTo=function(v,I){var Ce,P=this.length+v.length;return this.length===10&&v.length===10?Ce=D(this,v,I):P<63?Ce=R(this,v,I):P<1024?Ce=k(this,v,I):Ce=Re(this,v,I),Ce};function Fe(Ve,v){this.x=Ve,this.y=v}Fe.prototype.makeRBT=function(v){for(var I=new Array(v),Ce=o.prototype._countBits(v)-1,P=0;P<v;P++)I[P]=this.revBin(P,Ce,v);return I},Fe.prototype.revBin=function(v,I,Ce){if(v===0||v===Ce-1)return v;for(var P=0,_e=0;_e<I;_e++)P|=(v&1)<<I-_e-1,v>>=1;return P},Fe.prototype.permute=function(v,I,Ce,P,_e,Le){for(var Ye=0;Ye<Le;Ye++)P[Ye]=I[v[Ye]],_e[Ye]=Ce[v[Ye]]},Fe.prototype.transform=function(v,I,Ce,P,_e,Le){this.permute(Le,v,I,Ce,P,_e);for(var Ye=1;Ye<_e;Ye<<=1)for(var je=Ye<<1,K=Math.cos(2*Math.PI/je),L=Math.sin(2*Math.PI/je),st=0;st<_e;st+=je)for(var dt=K,Je=L,pt=0;pt<Ye;pt++){var rr=Ce[st+pt],cr=P[st+pt],fr=Ce[st+pt+Ye],ir=P[st+pt+Ye],ft=dt*fr-Je*ir;ir=dt*ir+Je*fr,fr=ft,Ce[st+pt]=rr+fr,P[st+pt]=cr+ir,Ce[st+pt+Ye]=rr-fr,P[st+pt+Ye]=cr-ir,pt!==je&&(ft=K*dt-L*Je,Je=K*Je+L*dt,dt=ft)}},Fe.prototype.guessLen13b=function(v,I){var Ce=Math.max(I,v)|1,P=Ce&1,_e=0;for(Ce=Ce/2|0;Ce;Ce=Ce>>>1)_e++;return 1<<_e+1+P},Fe.prototype.conjugate=function(v,I,Ce){if(!(Ce<=1))for(var P=0;P<Ce/2;P++){var _e=v[P];v[P]=v[Ce-P-1],v[Ce-P-1]=_e,_e=I[P],I[P]=-I[Ce-P-1],I[Ce-P-1]=-_e}},Fe.prototype.normalize13b=function(v,I){for(var Ce=0,P=0;P<I/2;P++){var _e=Math.round(v[2*P+1]/I)*8192+Math.round(v[2*P]/I)+Ce;v[P]=_e&67108863,_e<67108864?Ce=0:Ce=_e/67108864|0}return v},Fe.prototype.convert13b=function(v,I,Ce,P){for(var _e=0,Le=0;Le<I;Le++)_e=_e+(v[Le]|0),Ce[2*Le]=_e&8191,_e=_e>>>13,Ce[2*Le+1]=_e&8191,_e=_e>>>13;for(Le=2*I;Le<P;++Le)Ce[Le]=0;n(_e===0),n((_e&-8192)===0)},Fe.prototype.stub=function(v){for(var I=new Array(v),Ce=0;Ce<v;Ce++)I[Ce]=0;return I},Fe.prototype.mulp=function(v,I,Ce){var P=2*this.guessLen13b(v.length,I.length),_e=this.makeRBT(P),Le=this.stub(P),Ye=new Array(P),je=new Array(P),K=new Array(P),L=new Array(P),st=new Array(P),dt=new Array(P),Je=Ce.words;Je.length=P,this.convert13b(v.words,v.length,Ye,P),this.convert13b(I.words,I.length,L,P),this.transform(Ye,Le,je,K,P,_e),this.transform(L,Le,st,dt,P,_e);for(var pt=0;pt<P;pt++){var rr=je[pt]*st[pt]-K[pt]*dt[pt];K[pt]=je[pt]*dt[pt]+K[pt]*st[pt],je[pt]=rr}return this.conjugate(je,K,P),this.transform(je,K,Je,Le,P,_e),this.conjugate(Je,Le,P),this.normalize13b(Je,P),Ce.negative=v.negative^I.negative,Ce.length=v.length+I.length,Ce.strip()},o.prototype.mul=function(v){var I=new o(null);return I.words=new Array(this.length+v.length),this.mulTo(v,I)},o.prototype.mulf=function(v){var I=new o(null);return I.words=new Array(this.length+v.length),Re(this,v,I)},o.prototype.imul=function(v){return this.clone().mulTo(v,this)},o.prototype.imuln=function(v){n(typeof v=="number"),n(v<67108864);for(var I=0,Ce=0;Ce<this.length;Ce++){var P=(this.words[Ce]|0)*v,_e=(P&67108863)+(I&67108863);I>>=26,I+=P/67108864|0,I+=_e>>>26,this.words[Ce]=_e&67108863}return I!==0&&(this.words[Ce]=I,this.length++),this.length=v===0?1:this.length,this},o.prototype.muln=function(v){return this.clone().imuln(v)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(v){var I=b(v);if(I.length===0)return new o(1);for(var Ce=this,P=0;P<I.length&&I[P]===0;P++,Ce=Ce.sqr());if(++P<I.length)for(var _e=Ce.sqr();P<I.length;P++,_e=_e.sqr())I[P]!==0&&(Ce=Ce.mul(_e));return Ce},o.prototype.iushln=function(v){n(typeof v=="number"&&v>=0);var I=v%26,Ce=(v-I)/26,P=67108863>>>26-I<<26-I,_e;if(I!==0){var Le=0;for(_e=0;_e<this.length;_e++){var Ye=this.words[_e]&P,je=(this.words[_e]|0)-Ye<<I;this.words[_e]=je|Le,Le=Ye>>>26-I}Le&&(this.words[_e]=Le,this.length++)}if(Ce!==0){for(_e=this.length-1;_e>=0;_e--)this.words[_e+Ce]=this.words[_e];for(_e=0;_e<Ce;_e++)this.words[_e]=0;this.length+=Ce}return this.strip()},o.prototype.ishln=function(v){return n(this.negative===0),this.iushln(v)},o.prototype.iushrn=function(v,I,Ce){n(typeof v=="number"&&v>=0);var P;I?P=(I-I%26)/26:P=0;var _e=v%26,Le=Math.min((v-_e)/26,this.length),Ye=67108863^67108863>>>_e<<_e,je=Ce;if(P-=Le,P=Math.max(0,P),je){for(var K=0;K<Le;K++)je.words[K]=this.words[K];je.length=Le}if(Le!==0)if(this.length>Le)for(this.length-=Le,K=0;K<this.length;K++)this.words[K]=this.words[K+Le];else this.words[0]=0,this.length=1;var L=0;for(K=this.length-1;K>=0&&(L!==0||K>=P);K--){var st=this.words[K]|0;this.words[K]=L<<26-_e|st>>>_e,L=st&Ye}return je&&L!==0&&(je.words[je.length++]=L),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(v,I,Ce){return n(this.negative===0),this.iushrn(v,I,Ce)},o.prototype.shln=function(v){return this.clone().ishln(v)},o.prototype.ushln=function(v){return this.clone().iushln(v)},o.prototype.shrn=function(v){return this.clone().ishrn(v)},o.prototype.ushrn=function(v){return this.clone().iushrn(v)},o.prototype.testn=function(v){n(typeof v=="number"&&v>=0);var I=v%26,Ce=(v-I)/26,P=1<<I;if(this.length<=Ce)return!1;var _e=this.words[Ce];return!!(_e&P)},o.prototype.imaskn=function(v){n(typeof v=="number"&&v>=0);var I=v%26,Ce=(v-I)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=Ce)return this;if(I!==0&&Ce++,this.length=Math.min(Ce,this.length),I!==0){var P=67108863^67108863>>>I<<I;this.words[this.length-1]&=P}return this.strip()},o.prototype.maskn=function(v){return this.clone().imaskn(v)},o.prototype.iaddn=function(v){return n(typeof v=="number"),n(v<67108864),v<0?this.isubn(-v):this.negative!==0?this.length===1&&(this.words[0]|0)<v?(this.words[0]=v-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(v),this.negative=1,this):this._iaddn(v)},o.prototype._iaddn=function(v){this.words[0]+=v;for(var I=0;I<this.length&&this.words[I]>=67108864;I++)this.words[I]-=67108864,I===this.length-1?this.words[I+1]=1:this.words[I+1]++;return this.length=Math.max(this.length,I+1),this},o.prototype.isubn=function(v){if(n(typeof v=="number"),n(v<67108864),v<0)return this.iaddn(-v);if(this.negative!==0)return this.negative=0,this.iaddn(v),this.negative=1,this;if(this.words[0]-=v,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var I=0;I<this.length&&this.words[I]<0;I++)this.words[I]+=67108864,this.words[I+1]-=1;return this.strip()},o.prototype.addn=function(v){return this.clone().iaddn(v)},o.prototype.subn=function(v){return this.clone().isubn(v)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(v,I,Ce){var P=v.length+Ce,_e;this._expand(P);var Le,Ye=0;for(_e=0;_e<v.length;_e++){Le=(this.words[_e+Ce]|0)+Ye;var je=(v.words[_e]|0)*I;Le-=je&67108863,Ye=(Le>>26)-(je/67108864|0),this.words[_e+Ce]=Le&67108863}for(;_e<this.length-Ce;_e++)Le=(this.words[_e+Ce]|0)+Ye,Ye=Le>>26,this.words[_e+Ce]=Le&67108863;if(Ye===0)return this.strip();for(n(Ye===-1),Ye=0,_e=0;_e<this.length;_e++)Le=-(this.words[_e]|0)+Ye,Ye=Le>>26,this.words[_e]=Le&67108863;return this.negative=1,this.strip()},o.prototype._wordDiv=function(v,I){var Ce=this.length-v.length,P=this.clone(),_e=v,Le=_e.words[_e.length-1]|0,Ye=this._countBits(Le);Ce=26-Ye,Ce!==0&&(_e=_e.ushln(Ce),P.iushln(Ce),Le=_e.words[_e.length-1]|0);var je=P.length-_e.length,K;if(I!=="mod"){K=new o(null),K.length=je+1,K.words=new Array(K.length);for(var L=0;L<K.length;L++)K.words[L]=0}var st=P.clone()._ishlnsubmul(_e,1,je);st.negative===0&&(P=st,K&&(K.words[je]=1));for(var dt=je-1;dt>=0;dt--){var Je=(P.words[_e.length+dt]|0)*67108864+(P.words[_e.length+dt-1]|0);for(Je=Math.min(Je/Le|0,67108863),P._ishlnsubmul(_e,Je,dt);P.negative!==0;)Je--,P.negative=0,P._ishlnsubmul(_e,1,dt),P.isZero()||(P.negative^=1);K&&(K.words[dt]=Je)}return K&&K.strip(),P.strip(),I!=="div"&&Ce!==0&&P.iushrn(Ce),{div:K||null,mod:P}},o.prototype.divmod=function(v,I,Ce){if(n(!v.isZero()),this.isZero())return{div:new o(0),mod:new o(0)};var P,_e,Le;return this.negative!==0&&v.negative===0?(Le=this.neg().divmod(v,I),I!=="mod"&&(P=Le.div.neg()),I!=="div"&&(_e=Le.mod.neg(),Ce&&_e.negative!==0&&_e.iadd(v)),{div:P,mod:_e}):this.negative===0&&v.negative!==0?(Le=this.divmod(v.neg(),I),I!=="mod"&&(P=Le.div.neg()),{div:P,mod:Le.mod}):(this.negative&v.negative)!==0?(Le=this.neg().divmod(v.neg(),I),I!=="div"&&(_e=Le.mod.neg(),Ce&&_e.negative!==0&&_e.isub(v)),{div:Le.div,mod:_e}):v.length>this.length||this.cmp(v)<0?{div:new o(0),mod:this}:v.length===1?I==="div"?{div:this.divn(v.words[0]),mod:null}:I==="mod"?{div:null,mod:new o(this.modn(v.words[0]))}:{div:this.divn(v.words[0]),mod:new o(this.modn(v.words[0]))}:this._wordDiv(v,I)},o.prototype.div=function(v){return this.divmod(v,"div",!1).div},o.prototype.mod=function(v){return this.divmod(v,"mod",!1).mod},o.prototype.umod=function(v){return this.divmod(v,"mod",!0).mod},o.prototype.divRound=function(v){var I=this.divmod(v);if(I.mod.isZero())return I.div;var Ce=I.div.negative!==0?I.mod.isub(v):I.mod,P=v.ushrn(1),_e=v.andln(1),Le=Ce.cmp(P);return Le<0||_e===1&&Le===0?I.div:I.div.negative!==0?I.div.isubn(1):I.div.iaddn(1)},o.prototype.modn=function(v){n(v<=67108863);for(var I=(1<<26)%v,Ce=0,P=this.length-1;P>=0;P--)Ce=(I*Ce+(this.words[P]|0))%v;return Ce},o.prototype.idivn=function(v){n(v<=67108863);for(var I=0,Ce=this.length-1;Ce>=0;Ce--){var P=(this.words[Ce]|0)+I*67108864;this.words[Ce]=P/v|0,I=P%v}return this.strip()},o.prototype.divn=function(v){return this.clone().idivn(v)},o.prototype.egcd=function(v){n(v.negative===0),n(!v.isZero());var I=this,Ce=v.clone();I.negative!==0?I=I.umod(v):I=I.clone();for(var P=new o(1),_e=new o(0),Le=new o(0),Ye=new o(1),je=0;I.isEven()&&Ce.isEven();)I.iushrn(1),Ce.iushrn(1),++je;for(var K=Ce.clone(),L=I.clone();!I.isZero();){for(var st=0,dt=1;(I.words[0]&dt)===0&&st<26;++st,dt<<=1);if(st>0)for(I.iushrn(st);st-- >0;)(P.isOdd()||_e.isOdd())&&(P.iadd(K),_e.isub(L)),P.iushrn(1),_e.iushrn(1);for(var Je=0,pt=1;(Ce.words[0]&pt)===0&&Je<26;++Je,pt<<=1);if(Je>0)for(Ce.iushrn(Je);Je-- >0;)(Le.isOdd()||Ye.isOdd())&&(Le.iadd(K),Ye.isub(L)),Le.iushrn(1),Ye.iushrn(1);I.cmp(Ce)>=0?(I.isub(Ce),P.isub(Le),_e.isub(Ye)):(Ce.isub(I),Le.isub(P),Ye.isub(_e))}return{a:Le,b:Ye,gcd:Ce.iushln(je)}},o.prototype._invmp=function(v){n(v.negative===0),n(!v.isZero());var I=this,Ce=v.clone();I.negative!==0?I=I.umod(v):I=I.clone();for(var P=new o(1),_e=new o(0),Le=Ce.clone();I.cmpn(1)>0&&Ce.cmpn(1)>0;){for(var Ye=0,je=1;(I.words[0]&je)===0&&Ye<26;++Ye,je<<=1);if(Ye>0)for(I.iushrn(Ye);Ye-- >0;)P.isOdd()&&P.iadd(Le),P.iushrn(1);for(var K=0,L=1;(Ce.words[0]&L)===0&&K<26;++K,L<<=1);if(K>0)for(Ce.iushrn(K);K-- >0;)_e.isOdd()&&_e.iadd(Le),_e.iushrn(1);I.cmp(Ce)>=0?(I.isub(Ce),P.isub(_e)):(Ce.isub(I),_e.isub(P))}var st;return I.cmpn(1)===0?st=P:st=_e,st.cmpn(0)<0&&st.iadd(v),st},o.prototype.gcd=function(v){if(this.isZero())return v.abs();if(v.isZero())return this.abs();var I=this.clone(),Ce=v.clone();I.negative=0,Ce.negative=0;for(var P=0;I.isEven()&&Ce.isEven();P++)I.iushrn(1),Ce.iushrn(1);do{for(;I.isEven();)I.iushrn(1);for(;Ce.isEven();)Ce.iushrn(1);var _e=I.cmp(Ce);if(_e<0){var Le=I;I=Ce,Ce=Le}else if(_e===0||Ce.cmpn(1)===0)break;I.isub(Ce)}while(!0);return Ce.iushln(P)},o.prototype.invm=function(v){return this.egcd(v).a.umod(v)},o.prototype.isEven=function(){return(this.words[0]&1)===0},o.prototype.isOdd=function(){return(this.words[0]&1)===1},o.prototype.andln=function(v){return this.words[0]&v},o.prototype.bincn=function(v){n(typeof v=="number");var I=v%26,Ce=(v-I)/26,P=1<<I;if(this.length<=Ce)return this._expand(Ce+1),this.words[Ce]|=P,this;for(var _e=P,Le=Ce;_e!==0&&Le<this.length;Le++){var Ye=this.words[Le]|0;Ye+=_e,_e=Ye>>>26,Ye&=67108863,this.words[Le]=Ye}return _e!==0&&(this.words[Le]=_e,this.length++),this},o.prototype.isZero=function(){return this.length===1&&this.words[0]===0},o.prototype.cmpn=function(v){var I=v<0;if(this.negative!==0&&!I)return-1;if(this.negative===0&&I)return 1;this.strip();var Ce;if(this.length>1)Ce=1;else{I&&(v=-v),n(v<=67108863,"Number is too big");var P=this.words[0]|0;Ce=P===v?0:P<v?-1:1}return this.negative!==0?-Ce|0:Ce},o.prototype.cmp=function(v){if(this.negative!==0&&v.negative===0)return-1;if(this.negative===0&&v.negative!==0)return 1;var I=this.ucmp(v);return this.negative!==0?-I|0:I},o.prototype.ucmp=function(v){if(this.length>v.length)return 1;if(this.length<v.length)return-1;for(var I=0,Ce=this.length-1;Ce>=0;Ce--){var P=this.words[Ce]|0,_e=v.words[Ce]|0;if(P!==_e){P<_e?I=-1:P>_e&&(I=1);break}}return I},o.prototype.gtn=function(v){return this.cmpn(v)===1},o.prototype.gt=function(v){return this.cmp(v)===1},o.prototype.gten=function(v){return this.cmpn(v)>=0},o.prototype.gte=function(v){return this.cmp(v)>=0},o.prototype.ltn=function(v){return this.cmpn(v)===-1},o.prototype.lt=function(v){return this.cmp(v)===-1},o.prototype.lten=function(v){return this.cmpn(v)<=0},o.prototype.lte=function(v){return this.cmp(v)<=0},o.prototype.eqn=function(v){return this.cmpn(v)===0},o.prototype.eq=function(v){return this.cmp(v)===0},o.red=function(v){return new Xe(v)},o.prototype.toRed=function(v){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),v.convertTo(this)._forceRed(v)},o.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(v){return this.red=v,this},o.prototype.forceRed=function(v){return n(!this.red,"Already a number in reduction context"),this._forceRed(v)},o.prototype.redAdd=function(v){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,v)},o.prototype.redIAdd=function(v){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,v)},o.prototype.redSub=function(v){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,v)},o.prototype.redISub=function(v){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,v)},o.prototype.redShl=function(v){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,v)},o.prototype.redMul=function(v){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,v),this.red.mul(this,v)},o.prototype.redIMul=function(v){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,v),this.red.imul(this,v)},o.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(v){return n(this.red&&!v.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,v)};var O={k256:null,p224:null,p192:null,p25519:null};function $e(Ve,v){this.name=Ve,this.p=new o(v,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}$e.prototype._tmp=function(){var v=new o(null);return v.words=new Array(Math.ceil(this.n/13)),v},$e.prototype.ireduce=function(v){var I=v,Ce;do this.split(I,this.tmp),I=this.imulK(I),I=I.iadd(this.tmp),Ce=I.bitLength();while(Ce>this.n);var P=Ce<this.n?-1:I.ucmp(this.p);return P===0?(I.words[0]=0,I.length=1):P>0?I.isub(this.p):I.strip!==void 0?I.strip():I._strip(),I},$e.prototype.split=function(v,I){v.iushrn(this.n,0,I)},$e.prototype.imulK=function(v){return v.imul(this.k)};function ze(){$e.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}s(ze,$e),ze.prototype.split=function(v,I){for(var Ce=4194303,P=Math.min(v.length,9),_e=0;_e<P;_e++)I.words[_e]=v.words[_e];if(I.length=P,v.length<=9){v.words[0]=0,v.length=1;return}var Le=v.words[9];for(I.words[I.length++]=Le&Ce,_e=10;_e<v.length;_e++){var Ye=v.words[_e]|0;v.words[_e-10]=(Ye&Ce)<<4|Le>>>22,Le=Ye}Le>>>=22,v.words[_e-10]=Le,Le===0&&v.length>10?v.length-=10:v.length-=9},ze.prototype.imulK=function(v){v.words[v.length]=0,v.words[v.length+1]=0,v.length+=2;for(var I=0,Ce=0;Ce<v.length;Ce++){var P=v.words[Ce]|0;I+=P*977,v.words[Ce]=I&67108863,I=P*64+(I/67108864|0)}return v.words[v.length-1]===0&&(v.length--,v.words[v.length-1]===0&&v.length--),v};function q(){$e.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}s(q,$e);function W(){$e.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}s(W,$e);function We(){$e.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}s(We,$e),We.prototype.imulK=function(v){for(var I=0,Ce=0;Ce<v.length;Ce++){var P=(v.words[Ce]|0)*19+I,_e=P&67108863;P>>>=26,v.words[Ce]=_e,I=P}return I!==0&&(v.words[v.length++]=I),v},o._prime=function(v){if(O[v])return O[v];var I;if(v==="k256")I=new ze;else if(v==="p224")I=new q;else if(v==="p192")I=new W;else if(v==="p25519")I=new We;else throw new Error("Unknown prime "+v);return O[v]=I,I};function Xe(Ve){if(typeof Ve=="string"){var v=o._prime(Ve);this.m=v.p,this.prime=v}else n(Ve.gtn(1),"modulus must be greater than 1"),this.m=Ve,this.prime=null}Xe.prototype._verify1=function(v){n(v.negative===0,"red works only with positives"),n(v.red,"red works only with red numbers")},Xe.prototype._verify2=function(v,I){n((v.negative|I.negative)===0,"red works only with positives"),n(v.red&&v.red===I.red,"red works only with red numbers")},Xe.prototype.imod=function(v){return this.prime?this.prime.ireduce(v)._forceRed(this):v.umod(this.m)._forceRed(this)},Xe.prototype.neg=function(v){return v.isZero()?v.clone():this.m.sub(v)._forceRed(this)},Xe.prototype.add=function(v,I){this._verify2(v,I);var Ce=v.add(I);return Ce.cmp(this.m)>=0&&Ce.isub(this.m),Ce._forceRed(this)},Xe.prototype.iadd=function(v,I){this._verify2(v,I);var Ce=v.iadd(I);return Ce.cmp(this.m)>=0&&Ce.isub(this.m),Ce},Xe.prototype.sub=function(v,I){this._verify2(v,I);var Ce=v.sub(I);return Ce.cmpn(0)<0&&Ce.iadd(this.m),Ce._forceRed(this)},Xe.prototype.isub=function(v,I){this._verify2(v,I);var Ce=v.isub(I);return Ce.cmpn(0)<0&&Ce.iadd(this.m),Ce},Xe.prototype.shl=function(v,I){return this._verify1(v),this.imod(v.ushln(I))},Xe.prototype.imul=function(v,I){return this._verify2(v,I),this.imod(v.imul(I))},Xe.prototype.mul=function(v,I){return this._verify2(v,I),this.imod(v.mul(I))},Xe.prototype.isqr=function(v){return this.imul(v,v.clone())},Xe.prototype.sqr=function(v){return this.mul(v,v)},Xe.prototype.sqrt=function(v){if(v.isZero())return v.clone();var I=this.m.andln(3);if(n(I%2===1),I===3){var Ce=this.m.add(new o(1)).iushrn(2);return this.pow(v,Ce)}for(var P=this.m.subn(1),_e=0;!P.isZero()&&P.andln(1)===0;)_e++,P.iushrn(1);n(!P.isZero());var Le=new o(1).toRed(this),Ye=Le.redNeg(),je=this.m.subn(1).iushrn(1),K=this.m.bitLength();for(K=new o(2*K*K).toRed(this);this.pow(K,je).cmp(Ye)!==0;)K.redIAdd(Ye);for(var L=this.pow(K,P),st=this.pow(v,P.addn(1).iushrn(1)),dt=this.pow(v,P),Je=_e;dt.cmp(Le)!==0;){for(var pt=dt,rr=0;pt.cmp(Le)!==0;rr++)pt=pt.redSqr();n(rr<Je);var cr=this.pow(L,new o(1).iushln(Je-rr-1));st=st.redMul(cr),L=cr.redSqr(),dt=dt.redMul(L),Je=rr}return st},Xe.prototype.invm=function(v){var I=v._invmp(this.m);return I.negative!==0?(I.negative=0,this.imod(I).redNeg()):this.imod(I)},Xe.prototype.pow=function(v,I){if(I.isZero())return new o(1).toRed(this);if(I.cmpn(1)===0)return v.clone();var Ce=4,P=new Array(1<<Ce);P[0]=new o(1).toRed(this),P[1]=v;for(var _e=2;_e<P.length;_e++)P[_e]=this.mul(P[_e-1],v);var Le=P[0],Ye=0,je=0,K=I.bitLength()%26;for(K===0&&(K=26),_e=I.length-1;_e>=0;_e--){for(var L=I.words[_e],st=K-1;st>=0;st--){var dt=L>>st&1;if(Le!==P[0]&&(Le=this.sqr(Le)),dt===0&&Ye===0){je=0;continue}Ye<<=1,Ye|=dt,je++,!(je!==Ce&&(_e!==0||st!==0))&&(Le=this.mul(Le,P[Ye]),je=0,Ye=0)}K=26}return Le},Xe.prototype.convertTo=function(v){var I=v.umod(this.m);return I===v?I.clone():I},Xe.prototype.convertFrom=function(v){var I=v.clone();return I.red=null,I},o.mont=function(v){return new it(v)};function it(Ve){Xe.call(this,Ve),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}s(it,Xe),it.prototype.convertTo=function(v){return this.imod(v.ushln(this.shift))},it.prototype.convertFrom=function(v){var I=this.imod(v.mul(this.rinv));return I.red=null,I},it.prototype.imul=function(v,I){if(v.isZero()||I.isZero())return v.words[0]=0,v.length=1,v;var Ce=v.imul(I),P=Ce.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),_e=Ce.isub(P).iushrn(this.shift),Le=_e;return _e.cmp(this.m)>=0?Le=_e.isub(this.m):_e.cmpn(0)<0&&(Le=_e.iadd(this.m)),Le._forceRed(this)},it.prototype.mul=function(v,I){if(v.isZero()||I.isZero())return new o(0)._forceRed(this);var Ce=v.mul(I),P=Ce.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),_e=Ce.isub(P).iushrn(this.shift),Le=_e;return _e.cmp(this.m)>=0?Le=_e.isub(this.m):_e.cmpn(0)<0&&(Le=_e.iadd(this.m)),Le._forceRed(this)},it.prototype.invm=function(v){var I=this.imod(v._invmp(this.m).mul(this.r2));return I._forceRed(this)}})(t,bn)})(bn$1)),bn$1.exports}var bnExports=requireBn(),DEFAULTNETWORK={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},TESTNETWORK={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},SIGNETNETWORK={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},REGTESTNETWORK={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},SIMNETWORK={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},FEATUREBIT_ORDER=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],DIVISORS={m:new bnExports.BN(1e3,10),u:new bnExports.BN(1e6,10),n:new bnExports.BN(1e9,10),p:new bnExports.BN(1e12,10)},MAX_MILLISATS=new bnExports.BN("2100000000000000000",10),MILLISATS_PER_BTC=new bnExports.BN(1e11,10),TAGCODES={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},TAGNAMES={};for(var i=0,keys=Object.keys(TAGCODES);i<keys.length;i++){var currentName=keys[i],currentCode=TAGCODES[keys[i]].toString();TAGNAMES[currentCode]=currentName}var TAGPARSERS={1:function(t){return wordsToBuffer(t)},16:function(t){return wordsToBuffer(t)},13:function(t){return wordsToBuffer(t).toString("utf8")},19:function(t){return wordsToBuffer(t)},23:function(t){return wordsToBuffer(t)},27:function(t){return wordsToBuffer(t)},6:wordsToIntBE,24:wordsToIntBE,3:routingInfoParser,5:featureBitsParser};function getUnknownParser(t){return function(e){return{tagCode:parseInt(t),words:bech32Exports.encode("unknown",e,Number.MAX_SAFE_INTEGER)}}}function wordsToIntBE(t){return t.reverse().reduce(function(e,r,n){return e+r*Math.pow(32,n)},0)}function convert(t,e,r){for(var n=0,s=0,o=(1<<r)-1,c=[],u=0;u<t.length;++u)for(n=n<<e|t[u],s+=e;s>=r;)s-=r,c.push(n>>s&o);return s>0&&c.push(n<<r-s&o),c}function wordsToBuffer(t,e){var r=Buffer$1.from(convert(t,5,8));return t.length*5%8!==0&&(r=r.slice(0,-1)),r}function routingInfoParser(t){for(var e=[],r,n,s,o,c,u=wordsToBuffer(t);u.length>0;)r=u.slice(0,33).toString("hex"),n=u.slice(33,41).toString("hex"),s=parseInt(u.slice(41,45).toString("hex"),16),o=parseInt(u.slice(45,49).toString("hex"),16),c=parseInt(u.slice(49,51).toString("hex"),16),u=u.slice(51),e.push({pubkey:r,short_channel_id:n,fee_base_msat:s,fee_proportional_millionths:o,cltv_expiry_delta:c});return e}function featureBitsParser(t){for(var e=t.slice().reverse().map(function(s){return[!!(s&1),!!(s&2),!!(s&4),!!(s&8),!!(s&16)]}).reduce(function(s,o){return s.concat(o)},[]);e.length<FEATUREBIT_ORDER.length*2;)e.push(!1);var r={extra_bits:{}};if(FEATUREBIT_ORDER.forEach(function(s,o){var c;e[o*2]?c="required":e[o*2+1]&&(c="supported"),r[s]=c}),e.length>FEATUREBIT_ORDER.length*2){var n=e.slice(FEATUREBIT_ORDER.length*2);r.extra_bits={start_bit:FEATUREBIT_ORDER.length*2,bits:n,required:n.reduce(function(s,o,c){return c%2!==0?s||!1:s||o},!1)}}return r}function hrpToMillisat(t,e){var r,n;if(t.slice(-1).match(/^[munp]$/))r=t.slice(-1),n=t.slice(0,-1);else{if(t.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");n=t}if(!n.match(/^\d+$/))throw new Error("Not a valid human readable amount");var s=new bnExports.BN(n,10),o=r?s.mul(MILLISATS_PER_BTC).div(DIVISORS[r]):s.mul(MILLISATS_PER_BTC);if(r==="p"&&!s.mod(new bnExports.BN(10,10)).eq(new bnExports.BN(0,10))||o.gt(MAX_MILLISATS))throw new Error("Amount is outside of valid range");return e?o.toString():o}function decode(t,e){if(typeof t!="string")throw new Error("Lightning Payment Request must be string");if(t.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");var r=[],n=bech32Exports.decode(t,Number.MAX_SAFE_INTEGER);t=t.toLowerCase();var s=n.prefix,o=n.words,c=t.slice(s.length+1),u=o.slice(-104);o=o.slice(0,-104);var f=s.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(f&&!f[2]&&(f=s.match(/^ln(\S+)$/)),!f)throw new Error("Not a proper lightning payment request");r.push({name:"lightning_network",letters:"ln"});var x=f[1],p;switch(x){case DEFAULTNETWORK.bech32:p=DEFAULTNETWORK;break;case TESTNETWORK.bech32:p=TESTNETWORK;break;case SIGNETNETWORK.bech32:p=SIGNETNETWORK;break;case REGTESTNETWORK.bech32:p=REGTESTNETWORK;break;case SIMNETWORK.bech32:p=SIMNETWORK;break}if(!p||p.bech32!==x)throw new Error("Unknown coin bech32 prefix");r.push({name:"coin_network",letters:x,value:p});var g=f[2],y;if(g){var b=f[3];y=hrpToMillisat(g+b,!0),r.push({name:"amount",letters:f[2]+f[3],value:y})}else y=null;r.push({name:"separator",letters:"1"});var R=wordsToIntBE(o.slice(0,7));o=o.slice(7),r.push({name:"timestamp",letters:c.slice(0,7),value:R}),c=c.slice(7);for(var D,k,Re,Fe;o.length>0;){var O=o[0].toString();D=TAGNAMES[O]||"unknown_tag",k=TAGPARSERS[O]||getUnknownParser(O),o=o.slice(1),Re=wordsToIntBE(o.slice(0,2)),o=o.slice(2),Fe=o.slice(0,Re),o=o.slice(Re),r.push({name:D,tag:c[0],letters:c.slice(0,3+Re),value:k(Fe)}),c=c.slice(3+Re)}r.push({name:"signature",letters:c.slice(0,104),value:wordsToBuffer(u)}),c=c.slice(104),r.push({name:"checksum",letters:c});var $e={paymentRequest:t,sections:r,get expiry(){var We=r.find(function(Xe){return Xe.name==="expiry"});if(We)return W("timestamp")+We.value},get route_hints(){return r.filter(function(We){return We.name==="route_hint"}).map(function(We){return We.value})}},ze=function(We){if(We==="route_hint")return"continue";Object.defineProperty($e,We,{get:function(){return W(We)}})};for(var q in TAGCODES)ze(q);return $e;function W(We){var Xe=r.find(function(it){return it.name===We});return Xe?Xe.value:void 0}}const EcashSendModal=({isOpen:t,onClose:e,initialRecipient:r="",hideFollowsSelector:n=!1,forcePublic:s=!1})=>{const[o,c]=reactExports.useState(""),[u,f]=reactExports.useState(r),[x,p]=reactExports.useState(!1),[g,y]=reactExports.useState(!1),[b,R]=reactExports.useState(null),[D,k]=reactExports.useState(null),[Re,Fe]=reactExports.useState("sats"),[O,$e]=reactExports.useState(!1),[ze,q]=reactExports.useState(!1),W=reactExports.useRef(null),We=reactExports.useRef(null),[Xe,it]=reactExports.useState(null),[Ve,v]=reactExports.useState({total:0,sent:0,failed:0}),[I,Ce]=reactExports.useState(null),[P,_e]=reactExports.useState("unknown"),[Le,Ye]=reactExports.useState([]),[je,K]=reactExports.useState(!1),[L,st]=reactExports.useState(!1),[dt,Je]=reactExports.useState(null),{currentKeypairId:pt,wallets:rr,currentWalletId:cr}=useWalletStore(),ir=rr.find(tr=>tr.id===cr)?.keypairs.find(tr=>tr.id===pt),ft=tr=>{const yr=tr.trim();if(yr.startsWith("npub"))return"npub";const mr=yr.toLowerCase();return mr.startsWith("lnbc")||mr.startsWith("lntb")?"lightning_invoice":LnurlService.isLightningAddress(yr)?"lightning_address":"unknown"};reactExports.useEffect(()=>{console.log("[EcashSendModal] Sync effect: initialRecipient=",r?r.slice(0,20)+"...":"empty/undefined"),r&&(console.log("[EcashSendModal] Setting recipient from prop"),f(r))},[r]),reactExports.useEffect(()=>(console.log("[EcashSendModal] MOUNTED with initial recipient=",u?u.slice(0,20)+"...":"empty"),()=>console.log("[EcashSendModal] UNMOUNTED")),[]),reactExports.useEffect(()=>{const tr=ft(u);if(_e(tr),tr==="lightning_invoice")try{const yr=decode(u.trim());if(yr.sections){const mr=yr.sections.find(sr=>sr.name==="amount");if(mr&&mr.value){const sr=Math.floor(parseInt(mr.value)/1e3);c(Re==="sats"?sr.toString():satsToBTC(sr).toString())}}}catch(yr){console.error("Failed to decode invoice:",yr)}},[u,Re]),reactExports.useEffect(()=>{t&&ir&&(console.log("[EcashSendModal] Fetching contacts for keypair:",ir.npub),K(!0),Je(null),ProfileService.fetchContacts(ir.npub).then(tr=>{console.log("[EcashSendModal] Received contacts:",tr.length),Ye(tr)}).catch(tr=>{console.error("[EcashSendModal] Error fetching contacts:",tr),Je("Failed to fetch user follows")}).finally(()=>K(!1)))},[t,ir]);const{mints:nr,proofs:lr}=useEcashStore(),er=React.useMemo(()=>lr.reduce((tr,yr)=>tr+yr.amount,0),[lr]),pr=React.useMemo(()=>{const tr=new Map;return lr.forEach(yr=>{const mr=Object.keys(nr).find(sr=>{const Ar=nr[sr].keys;return Ar.keysets&&Array.isArray(Ar.keysets)&&Ar.keysets.some(ht=>ht.id===yr.id)||Ar[yr.id]});mr&&tr.set(mr,(tr.get(mr)||0)+yr.amount)}),tr},[lr,nr]),Er=React.useMemo(()=>{const tr=Object.keys(nr);if(tr.length===0)return;const yr=parseInt(o);if(!o||isNaN(yr)||yr<=0){let sr=tr[0],Ar=pr.get(sr)||0;return tr.forEach(ht=>{const Qe=pr.get(ht)||0;Qe>Ar&&(Ar=Qe,sr=ht)}),sr}if(P==="npub"){for(const sr of tr)if((pr.get(sr)||0)>=yr)return sr}if(P==="lightning_invoice"||P==="lightning_address"){let sr=tr[0],Ar=pr.get(sr)||0;return tr.forEach(ht=>{const Qe=pr.get(ht)||0;Qe>Ar&&(Ar=Qe,sr=ht)}),console.log(` Selected mint: ${sr} (balance: ${Ar} sats)`),sr}const mr=tr[0];return console.log(` Selected mint: ${mr} (balance: ${pr.get(mr)||0} sats)`),mr},[nr,o,P,pr]),xr=reactExports.useRef(!1);reactExports.useEffect(()=>{xr.current&&!t&&(R(null),k(null),c(""),f(""),y(!1)),xr.current=t},[t]);const wr=tr=>{const yr=[];let mr=tr;const sr=Array.from(pr.entries()).sort((Ar,ht)=>ht[1]-Ar[1]);for(const[Ar,ht]of sr){if(mr<=0)break;const Qe=Math.min(ht,mr);Qe>0&&(yr.push({mintUrl:Ar,amount:Qe,status:"pending"}),mr-=Qe)}return mr>0?null:yr.length>1?yr:null},Br=async()=>{if(!Er){k("No mints available");return}y(!0),k(null);try{const tr=await CashuService.meltTokens(Er,u);useEcashStore.getState().addHistoryItem({id:Math.random().toString(36).substring(7),type:"send",amount:tr.quote.amount,mint:Er,timestamp:Math.floor(Date.now()/1e3),isNutzap:!1,memo:"Lightning payment"}),R("paid"),setTimeout(e,2e3)}catch(tr){k(tr.message||"Payment failed")}finally{y(!1)}},hr=async()=>{if(!Er){k("No mints available");return}y(!0),k(null);try{const tr=parseInt(o);if(isNaN(tr)||tr<=0)throw new Error("Invalid amount");console.log(`Resolving Lightning address: ${u}`);const yr=await LnurlService.resolveToInvoice(u,tr),mr=await CashuService.meltTokens(Er,yr);useEcashStore.getState().addHistoryItem({id:Math.random().toString(36).substring(7),type:"send",amount:mr.quote.amount,mint:Er,timestamp:Math.floor(Date.now()/1e3),isNutzap:!1,memo:`Lightning payment to ${u}`}),R("paid"),setTimeout(e,2e3)}catch(tr){k(tr.message||"Payment failed")}finally{y(!1)}},Cr=tr=>{const yr=tr.target.files?.[0];if(!yr)return;const mr=new FileReader;mr.onload=sr=>{const Ar=sr.target?.result,ht=new Image;ht.src=Ar,ht.onload=()=>{const Qe=document.createElement("canvas"),lt=Qe.getContext("2d");if(!lt)return;Qe.width=ht.width,Qe.height=ht.height,lt.drawImage(ht,0,0);const ar=lt.getImageData(0,0,Qe.width,Qe.height),br=jsQR(ar.data,Qe.width,Qe.height);if(br){const Sr=br.data;f(Sr),$e(!1)}else k("No QR code found in image")}},mr.readAsDataURL(yr)},_r=(tr,yr)=>{if(!O){yr.getTracks().forEach(ht=>ht.stop());return}const mr=document.createElement("canvas"),sr=mr.getContext("2d",{willReadFrequently:!0}),Ar=()=>{if(tr.readyState===tr.HAVE_ENOUGH_DATA&&sr){mr.height=tr.videoHeight,mr.width=tr.videoWidth,sr.drawImage(tr,0,0,mr.width,mr.height);const ht=sr.getImageData(0,0,mr.width,mr.height),Qe=jsQR(ht.data,ht.width,ht.height);if(Qe){const lt=Qe.data;f(lt),yr.getTracks().forEach(ar=>ar.stop()),$e(!1);return}}document.getElementById("qr-modal")?requestAnimationFrame(Ar):yr.getTracks().forEach(ht=>ht.stop())};requestAnimationFrame(Ar)};reactExports.useEffect(()=>{let tr=null,yr=!0;return O&&(async()=>{if(O)try{const sr=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(!yr){sr.getTracks().forEach(ht=>ht.stop());return}tr=sr;const Ar=W.current;Ar&&(Ar.srcObject=sr,Ar.setAttribute("playsinline","true"),Ar.onloadedmetadata=()=>{Ar.play().catch(ht=>console.error("Play failed",ht)),_r(Ar,sr)})}catch(sr){console.error("Camera error:",sr),k("Failed to access camera"),$e(!1)}})(),()=>{yr=!1,tr&&tr.getTracks().forEach(sr=>sr.stop())}},[O]);const Tr=async()=>{const tr=parseInt(o);if(isNaN(tr)||tr<=0){k("Invalid amount");return}const yr=Er&&pr.get(Er)||0;if(!Er||yr<tr){const sr=wr(tr);if(sr){it(sr);return}else{const Ar=pr.size;if(Ar>1){const ht=Array.from(pr.entries()).map(([Qe,lt])=>`${Qe.replace("https://","").replace(/\/$/,"")}: ${lt} sats`).join(`
`);k(`Insufficient balance.
Need: ${tr} sats
Have: ${er} sats across ${Ar} mints

`+ht)}else k("Insufficient balance");return}}y(!0),k(null);try{const sr=parseInt(o);if(isNaN(sr)||sr<=0)throw new Error("Invalid amount");const Ar=await CashuService.sendToken(sr,Er,u,void 0,!x);let ht,Qe=[];if(typeof Ar=="string"?ht=Ar:(ht=Ar.token,Qe=Ar.usedProofs),x)R(ht),useEcashStore.getState().addHistoryItem({id:Math.random().toString(36).substring(7),type:"send",amount:sr,mint:Er,timestamp:Math.floor(Date.now()/1e3),isNutzap:!1,recipient:u,token:ht});else{const{decryptedKey:lt}=useAuthStore.getState();if(!lt)throw new Error("Wallet must be unlocked to send NutZaps");let ar=u;try{const zr=nip19_exports$1.decode(u);zr.type==="npub"&&(ar=zr.data)}catch(zr){console.warn("Could not decode recipient as npub, using as-is:",zr)}const{publishNutZapWithRetry:br}=await __vitePreload(async()=>{const{publishNutZapWithRetry:zr}=await import("./nutZapPublisher-Bb53jT4g.js");return{publishNutZapWithRetry:zr}},[],import.meta.url),Sr=`pending-${Date.now()}`,Rr=Qe.map(zr=>zr.secret);console.log(` Creating pending send (ID: ${Sr})...`),useEcashStore.getState().addPendingSend({id:Sr,token:ht,recipient:ar,amount:sr,mint:Er,timestamp:Math.floor(Date.now()/1e3),attempts:0,proofSecrets:Rr});const Lr=!1;console.log(" Publishing NutZap with retry logic...");const Gr=await br(ht,Er,sr,ar,lt);if(!Gr.success)throw console.error(" NutZap publish failed after all retries:",Gr.error),useEcashStore.getState().updatePendingSendAttempt(Sr,Gr.error),new Error(`Failed to publish NutZap after 3 attempts: ${Gr.error}

Your proofs are protected in pending sends (ID: ${Sr}). They will not be removed by auto-cleanup.`);console.log(` NutZap published successfully to ${Gr.relayCount} relays`),console.log(` Removing pending send (ID: ${Sr})...`),useEcashStore.getState().removePendingSend(Sr),console.log(" Publishing updated wallet state to NIP-60..."),await useEcashStore.getState().publishProofsToNostr(!0),console.log(" Wallet state published"),useEcashStore.getState().addHistoryItem({id:Math.random().toString(36).substring(7)+"-send",type:"send",amount:sr,mint:Er,timestamp:Math.floor(Date.now()/1e3),isNutzap:!0,recipient:u}),e()}}catch(sr){k(sr.message||"Send failed")}finally{y(!1)}},Nr=async()=>{if(!Xe)return;y(!0),k(null),v({total:Xe.length,sent:0,failed:0});let tr=0,yr=0;for(let mr=0;mr<Xe.length;mr++){const{mintUrl:sr,amount:Ar}=Xe[mr];it(ht=>ht.map((Qe,lt)=>lt===mr?{...Qe,status:"sending"}:Qe));try{const Qe=await CashuService.sendToken(Ar,sr,u,void 0,!x);let lt,ar=[];if(typeof Qe=="string"?lt=Qe:(lt=Qe.token,ar=Qe.usedProofs),x)useEcashStore.getState().addHistoryItem({id:Math.random().toString(36).substring(7),type:"send",amount:Ar,mint:sr,timestamp:Math.floor(Date.now()/1e3),isNutzap:!1,recipient:u,token:lt});else{const{decryptedKey:br}=useAuthStore.getState();if(!br)throw new Error("Wallet must be unlocked");let Sr=u;try{const Vr=nip19_exports$1.decode(u);Vr.type==="npub"&&(Sr=Vr.data)}catch{console.warn("Could not decode recipient as npub")}const Rr=`pending-multi-${Date.now()}-${mr}`,Lr=ar.map(Vr=>Vr.secret);console.log(` Creating pending send for mint ${mr+1}/${Xe.length} (ID: ${Rr})...`),useEcashStore.getState().addPendingSend({id:Rr,token:lt,recipient:Sr,amount:Ar,mint:sr,timestamp:Math.floor(Date.now()/1e3),attempts:0,proofSecrets:Lr});const{publishNutZapWithRetry:Gr}=await __vitePreload(async()=>{const{publishNutZapWithRetry:Vr}=await import("./nutZapPublisher-Bb53jT4g.js");return{publishNutZapWithRetry:Vr}},[],import.meta.url),zr=await Gr(lt,sr,Ar,Sr,br);if(!zr.success)throw console.error(` NutZap publish failed for mint ${mr+1}: ${zr.error}`),useEcashStore.getState().updatePendingSendAttempt(Rr,zr.error),new Error(`Failed to publish NutZap: ${zr.error}`);console.log(` Removing pending send for mint ${mr+1} (ID: ${Rr})...`),useEcashStore.getState().removePendingSend(Rr),console.log(" Publishing updated wallet state to NIP-60..."),await useEcashStore.getState().publishProofsToNostr(!0),useEcashStore.getState().addHistoryItem({id:Math.random().toString(36).substring(7),type:"send",amount:Ar,mint:sr,timestamp:Math.floor(Date.now()/1e3),isNutzap:!0,recipient:u})}it(br=>br.map((Sr,Rr)=>Rr===mr?{...Sr,status:"success"}:Sr)),v(br=>({...br,sent:br.sent+1})),tr+=Ar}catch(ht){console.error(`Failed to send from ${sr}:`,ht),it(br=>br.map((Sr,Rr)=>Rr===mr?{...Sr,status:"failed"}:Sr)),v(br=>({...br,failed:br.failed+1})),yr+=Ar,console.log(` Attempting fallback for ${Ar} sats...`);const Qe=new Set(Xe.slice(0,mr+1).map(br=>br.mintUrl)),lt=new Map(Array.from(pr.entries()).filter(([br])=>!Qe.has(br)));let ar=null;for(const[br,Sr]of lt.entries())if(Sr>=Ar){ar=br;break}if(ar){console.log(` Found fallback mint: ${ar} (${pr.get(ar)} sats)`);const br={mintUrl:ar,amount:Ar,status:"sending"};it(Sr=>[...Sr,br]),v(Sr=>({...Sr,total:Sr.total+1}));try{const Sr=await CashuService.sendToken(Ar,ar,u);if(!x){const{decryptedKey:Rr}=useAuthStore.getState();if(!Rr)throw new Error("Wallet must be unlocked");let Lr=u;try{const an=nip19_exports$1.decode(u);an.type==="npub"&&(Lr=an.data)}catch{console.warn("Could not decode recipient as npub")}const Gr=Nip61Service.createNutZapEvent(Sr,ar,Ar,Lr),zr=new NDKPrivateKeySigner(Rr),Vr=new NDK({explicitRelayUrls:["wss://relay.damus.io","wss://nos.lol","wss://relay.nostr.band","wss://relay.primal.net","wss://relay.snort.social"],signer:zr});await Vr.connect(2e3);const Zr=new NDKEvent(Vr,Gr);await Zr.sign(),await Zr.publish(),useEcashStore.getState().addHistoryItem({id:Zr.id||Math.random().toString(36).substring(7),type:"send",amount:Ar,mint:ar,timestamp:Zr.created_at||Math.floor(Date.now()/1e3),isNutzap:!0,recipient:u})}it(Rr=>Rr.map((Lr,Gr)=>Gr===Rr.length-1?{...Lr,status:"success"}:Lr)),v(Rr=>({...Rr,sent:Rr.sent+1})),tr+=Ar,yr-=Ar,console.log(` Fallback successful! Sent ${Ar} sats from ${ar}`)}catch(Sr){console.error(" Fallback also failed:",Sr),it(Rr=>Rr.map((Lr,Gr)=>Gr===Rr.length-1?{...Lr,status:"failed"}:Lr)),v(Rr=>({...Rr,failed:Rr.failed+1}))}}else console.log(` No fallback mint available with ${Ar} sats`)}}y(!1),Ce({success:yr===0,totalSent:tr,totalFailed:yr})},or=async()=>{switch(ft(u)){case"npub":await Tr();break;case"lightning_invoice":await Br();break;case"lightning_address":await hr();break;default:k("Invalid input. Enter npub, Lightning invoice (lnbc...), or Lightning address (name@domain.com)")}};return t?(console.log("[EcashSendModal] Rendering with recipient=",u?u.slice(0,20)+"...":"empty"),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[O&&jsxRuntimeExports.jsx("div",{id:"qr-modal",className:"fixed inset-0 bg-black/95 flex items-center justify-center p-4 z-[60] overflow-y-auto",children:jsxRuntimeExports.jsxs("div",{className:"relative w-full max-w-md bg-slate-900 rounded-xl p-4 border border-slate-800 my-auto",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-white mb-4 text-center",children:"Scan QR Code"}),jsxRuntimeExports.jsxs("div",{className:"relative aspect-square bg-black rounded-lg overflow-hidden mb-4",children:[jsxRuntimeExports.jsx("video",{ref:W,className:"w-full h-full object-cover",playsInline:!0,muted:!0}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 border-2 border-purple-500/50 rounded-lg pointer-events-none"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx("p",{className:"text-center text-slate-400 text-sm",children:"Camera not working? Upload an image instead."}),jsxRuntimeExports.jsx("input",{type:"file",ref:We,onChange:Cr,accept:"image/*",capture:"environment",className:"hidden"}),jsxRuntimeExports.jsxs("button",{onClick:()=>We.current?.click(),className:"w-full bg-slate-800 hover:bg-slate-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(QrCode,{className:"w-5 h-5"}),"Upload QR Image"]}),jsxRuntimeExports.jsx("button",{onClick:()=>$e(!1),className:"w-full bg-red-500/10 hover:bg-red-500/20 text-red-400 font-medium py-3 px-4 rounded-lg transition-colors",children:"Cancel"})]})]})}),jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsx("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-md overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-200",children:b?jsxRuntimeExports.jsxs("div",{className:"p-6 text-center space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto",children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-8 h-8 text-green-500"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-white",children:b==="paid"?"Payment Sent!":"Token Generated!"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-sm",children:"This is a private token. Share it securely with the recipient."}),jsxRuntimeExports.jsx("div",{className:"bg-slate-950 p-3 rounded-lg border border-slate-800 text-left",children:jsxRuntimeExports.jsx("p",{className:"font-mono text-xs text-slate-500 break-all line-clamp-4",children:b})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{navigator.clipboard.writeText(b),q(!0),setTimeout(()=>q(!1),2e3)},className:"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-medium transition-colors",children:ze?" Copied!":"Copy Token"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"flex-1 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-xl font-bold",children:"Done"})]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Send eCash"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-1 text-slate-400 hover:text-white rounded-lg",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Send To"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 border border-slate-800 rounded-xl p-2 pr-2 focus-within:ring-2 focus-within:ring-purple-500 focus-within:border-transparent transition-all",children:[jsxRuntimeExports.jsx("input",{type:"text",value:u,onChange:tr=>f(tr.target.value),placeholder:"npub, Lightning invoice (lnbc...), or name@domain.com",className:"flex-1 bg-transparent text-white outline-none font-mono text-sm px-2 min-w-0"}),jsxRuntimeExports.jsx("button",{onClick:()=>$e(!0),className:"p-2 hover:bg-slate-800 rounded-lg text-purple-500 transition-colors flex-shrink-0",title:"Scan QR Code",children:jsxRuntimeExports.jsx(QrCode,{className:"w-5 h-5"})})]}),P!=="unknown"&&u.trim()&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Detected: ",P==="npub"?" Nostr address (NutZap)":P==="lightning_invoice"?" Lightning invoice":" Lightning address"]}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:!n&&ir&&jsxRuntimeExports.jsxs("button",{onClick:()=>st(!L),className:`px-3 py-2 text-xs font-medium rounded-lg transition-colors flex items-center gap-2 ${L?"bg-purple-500/20 text-purple-400":"bg-purple-500/10 hover:bg-purple-500/20 text-purple-500"}`,children:[jsxRuntimeExports.jsx(User,{className:"w-3.5 h-3.5"}),L?"Hide Follows":"Select from Follows"]})}),L&&jsxRuntimeExports.jsx("div",{className:"mt-2 max-h-48 overflow-y-auto bg-slate-950 border border-slate-800 rounded-xl p-2 space-y-2 custom-scrollbar",children:je?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center p-4 text-slate-400 gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin text-purple-500"}),jsxRuntimeExports.jsx("span",{className:"text-xs",children:"Currently fetching user follows..."})]}):dt?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center p-4 text-red-400 gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{className:"text-xs",children:dt})]}):Le.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center p-4 text-slate-400 gap-2",children:[jsxRuntimeExports.jsx(User,{className:"w-5 h-5 opacity-50"}),jsxRuntimeExports.jsx("span",{className:"text-xs",children:"User not following anyone"})]}):Le.map(tr=>{if(!tr.npub)return null;const yr=tr.npub===u;return jsxRuntimeExports.jsxs("div",{onClick:()=>{f(tr.npub)},className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-colors group border ${yr?"bg-purple-500/10 border-purple-500/30":"hover:bg-slate-900 border-transparent"}`,children:[tr.picture?jsxRuntimeExports.jsx("img",{src:tr.picture,alt:tr.name,className:"w-8 h-8 rounded-full object-cover"}):jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center",children:jsxRuntimeExports.jsx(User,{className:"w-4 h-4 text-slate-500"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-sm text-white truncate",children:tr.name||"Unknown"}),tr.nip05&&jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-500 truncate",children:tr.nip05})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 mt-0.5",children:[jsxRuntimeExports.jsxs("span",{className:"font-mono truncate",children:[tr.npub.slice(0,8),"...",tr.npub.slice(-8)]}),jsxRuntimeExports.jsx("button",{onClick:mr=>{mr.stopPropagation(),navigator.clipboard.writeText(tr.npub)},className:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-white transition-colors",title:"Copy npub",children:jsxRuntimeExports.jsx(Copy,{className:"w-3 h-3"})})]})]})]},tr.npub)})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-1",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400",children:"Amount"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-slate-500",children:["Available: ",er.toLocaleString()," sats"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 border border-slate-800 rounded-xl p-3 focus-within:ring-2 focus-within:ring-purple-500 focus:border-transparent transition-all",children:[Re==="sats"?jsxRuntimeExports.jsx(SatoshiIcon,{className:"text-xl text-purple-500 flex-shrink-0"}):jsxRuntimeExports.jsx("span",{className:"text-xl text-purple-500 flex-shrink-0",children:""}),jsxRuntimeExports.jsx("input",{type:"number",value:o,onChange:tr=>c(tr.target.value),disabled:P==="lightning_invoice",placeholder:"0.00",className:"flex-1 bg-transparent text-white outline-none font-mono text-lg min-w-0 disabled:opacity-50 disabled:cursor-not-allowed"}),jsxRuntimeExports.jsx("button",{onClick:()=>{c(Re==="sats"?er.toString():satsToBTC(er).toString())},disabled:P==="lightning_invoice",className:"px-2 py-1 bg-purple-500/10 hover:bg-purple-500/20 text-purple-500 text-xs font-bold rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"MAX"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{const tr=parseFloat(o)||0;Re==="sats"?(c(satsToBTC(tr).toString()),Fe("btc")):(c(btcToSats(tr).toString()),Fe("sats"))},className:"p-2 hover:bg-slate-800 rounded-lg transition-colors flex-shrink-0",title:"Toggle unit",children:jsxRuntimeExports.jsx(ArrowUpDown,{className:"w-4 h-4 text-slate-400"})}),jsxRuntimeExports.jsx("span",{className:"text-slate-400 font-medium text-sm flex-shrink-0",children:Re==="sats"?"sats":"BTC"})]})]}),P==="npub"&&!s&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex bg-slate-950 p-1 rounded-xl border border-slate-800",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>p(!1),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-medium transition-all ${x?"text-slate-400 hover:text-white":"bg-purple-600 text-white shadow-lg"}`,children:[jsxRuntimeExports.jsx(Globe,{className:"w-4 h-4"}),"Public (NutZap)"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>p(!0),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-medium transition-all ${x?"bg-slate-700 text-white shadow-lg":"text-slate-400 hover:text-white"}`,children:[jsxRuntimeExports.jsx(ShieldCheck,{className:"w-4 h-4"}),"Private Token"]})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 text-center px-4",children:x?"Generates a token you can manually share. No event is published.":"Publishes a NIP-61 event visible to the recipient."})]}),D&&jsxRuntimeExports.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4"}),D]}),jsxRuntimeExports.jsx("button",{onClick:or,disabled:g||!o||!u,className:"w-full py-3 px-4 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2",children:g?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):"Send"})]})]})})}),Xe&&!g&&!I&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl max-w-md w-full p-6 shadow-2xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"Send from Multiple Mints?"}),jsxRuntimeExports.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"You don't have enough sats in one mint, but you have enough across multiple mints."}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3 mb-4",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"This will send:"}),Xe.map(({mintUrl:tr,amount:yr})=>jsxRuntimeExports.jsxs("div",{className:"text-sm text-slate-300 mb-1",children:[" ",yr," sats from ",new URL(tr).hostname]},tr))]}),jsxRuntimeExports.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3 mb-4",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-yellow-200",children:" If one mint fails, a partial payment may be sent."})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>it(null),className:"flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Nr,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg transition-colors",children:"Send from Multiple"})]})]})}),g&&Xe&&!I&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl max-w-md w-full p-6 shadow-2xl",children:[jsxRuntimeExports.jsxs("h3",{className:"text-xl font-bold text-white mb-4",children:["Sending ",o," sats..."]}),jsxRuntimeExports.jsx("div",{className:"space-y-2 mb-4",children:Xe.map(({mintUrl:tr,amount:yr,status:mr})=>jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[mr==="success"&&jsxRuntimeExports.jsx("span",{className:"text-green-400",children:""}),mr==="failed"&&jsxRuntimeExports.jsx("span",{className:"text-red-400",children:""}),mr==="sending"&&jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin text-purple-400"}),mr==="pending"&&jsxRuntimeExports.jsx("span",{className:"text-slate-500",children:""}),jsxRuntimeExports.jsxs("span",{className:"text-slate-300",children:[yr," sats from ",new URL(tr).hostname]})]},tr))}),jsxRuntimeExports.jsxs("div",{className:"mb-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-xs text-slate-400 mb-1",children:[jsxRuntimeExports.jsx("span",{children:"Progress"}),jsxRuntimeExports.jsxs("span",{children:[Ve.sent+Ve.failed,"/",Ve.total]})]}),jsxRuntimeExports.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2",children:jsxRuntimeExports.jsx("div",{className:"bg-purple-500 h-2 rounded-full transition-all duration-300",style:{width:`${(Ve.sent+Ve.failed)/Ve.total*100}%`}})})]})]})}),I&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl max-w-md w-full p-6 shadow-2xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:I.success?" Payment Sent!":" Partial Payment Sent"}),I.success?jsxRuntimeExports.jsxs("p",{className:"text-slate-300 mb-4",children:["Successfully sent ",I.totalSent," sats across ",Xe?.length," mints to recipient."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("p",{className:"text-slate-300 mb-4",children:["Sent ",I.totalSent,"/",I.totalSent+I.totalFailed," sats.",I.totalFailed," sats failed."]}),jsxRuntimeExports.jsx("div",{className:"bg-slate-800/50 rounded-lg p-3 mb-4 space-y-1",children:Xe?.map(({mintUrl:tr,amount:yr,status:mr})=>jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[mr==="success"&&jsxRuntimeExports.jsx("span",{className:"text-green-400",children:""}),mr==="failed"&&jsxRuntimeExports.jsx("span",{className:"text-red-400",children:""}),jsxRuntimeExports.jsxs("span",{className:"text-slate-300",children:[yr," sats from ",new URL(tr).hostname]})]},tr))})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{Ce(null),it(null),I.success&&e()},className:"w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg transition-colors",children:"Close"})]})})]})):null},MintsModal=({isOpen:t,onClose:e})=>{const{mints:r,discoveredMints:n,updateMintStatus:s}=useEcashStore(),[o,c]=reactExports.useState("my-mints"),[u,f]=reactExports.useState(""),[x,p]=reactExports.useState(null),[g,y]=reactExports.useState(null);if(!t)return null;const b=k=>{useEcashStore.getState().removeMint(k),p(null)},R=async k=>{y(k),s(k,"checking");try{const Re=await CashuService.validateMint(k);s(k,Re),Re==="online"&&await CashuService.loadMint(k)}catch{s(k,"offline")}finally{y(null)}},D=Object.values(n).filter(k=>!r[k.url]).filter(k=>k.url.toLowerCase().includes(u.toLowerCase())).sort((k,Re)=>Re.trustScore-k.trustScore);return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-md h-[500px] flex flex-col shadow-2xl animate-in fade-in zoom-in duration-200 overflow-hidden relative",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800 bg-slate-900/50",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Mints"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-1 text-slate-400 hover:text-white rounded-lg",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex border-b border-slate-800",children:[jsxRuntimeExports.jsx("button",{onClick:()=>c("my-mints"),className:`flex-1 py-3 text-sm font-bold transition-colors border-b-2 ${o==="my-mints"?"border-purple-500 text-purple-400":"border-transparent text-slate-500 hover:text-slate-300"}`,children:"My Mints"}),jsxRuntimeExports.jsx("button",{onClick:()=>c("discover"),className:`flex-1 py-3 text-sm font-bold transition-colors border-b-2 ${o==="discover"?"border-purple-500 text-purple-400":"border-transparent text-slate-500 hover:text-slate-300"}`,children:"Discover"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:o==="my-mints"?jsxRuntimeExports.jsx("div",{className:"space-y-3",children:Object.values(r).length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-8 text-slate-500",children:[jsxRuntimeExports.jsx("p",{children:"No mints added yet."}),jsxRuntimeExports.jsx("button",{onClick:()=>c("discover"),className:"text-purple-400 text-sm font-bold mt-2 hover:underline",children:"Discover Mints"})]}):Object.values(r).map(k=>jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 border border-slate-800 rounded-xl p-3 flex items-center justify-between group",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg",children:jsxRuntimeExports.jsx(Server,{className:"w-4 h-4 text-purple-400"})}),jsxRuntimeExports.jsxs("div",{className:"min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-medium text-white truncate max-w-[200px]",children:k.url.replace("https://","").replace(/\/$/,"")}),jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-500",children:k.keys&&k.keys.id||"Unknown ID"})]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>p(k.url),className:"p-2 text-slate-600 hover:text-red-400 hover:bg-red-900/10 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]},k.url))}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search mint URLs...",value:u,onChange:k=>f(k.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-xl py-2 pl-9 pr-4 text-white text-sm focus:border-purple-500 outline-none"})]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:D.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-8 text-slate-500 text-sm",children:u?"No matching mints found.":"No new mints discovered yet."}):D.map(k=>jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 border border-slate-800 rounded-xl p-3 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"p-2 bg-slate-800/50 rounded-lg",children:jsxRuntimeExports.jsx(Globe,{className:"w-4 h-4 text-slate-400"})}),jsxRuntimeExports.jsx("div",{className:`absolute -top-1 -right-1 w-2.5 h-2.5 rounded-full border-2 border-slate-950 ${k.status==="online"?"bg-green-500":k.status==="offline"?"bg-red-500":"bg-slate-500"}`})]}),jsxRuntimeExports.jsxs("div",{className:"min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-medium text-white truncate max-w-[150px]",children:k.url.replace("https://","")}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[jsxRuntimeExports.jsx(Activity,{className:"w-3 h-3"}),jsxRuntimeExports.jsxs("span",{children:["Trust: ",k.trustScore>0?"+":"",k.trustScore]})]})]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>R(k.url),disabled:g===k.url||k.status==="offline",className:"p-2 bg-purple-600/20 hover:bg-purple-600/40 text-purple-400 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:jsxRuntimeExports.jsx(Plus,{className:`w-4 h-4 ${g===k.url?"animate-spin":""}`})})]},k.url))})]})}),x&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 animate-in fade-in duration-200",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl p-6 w-full max-w-sm text-center shadow-xl",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 bg-red-500/10 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(TriangleAlert,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx("h4",{className:"text-lg font-bold text-white mb-2",children:"Remove Mint?"}),jsxRuntimeExports.jsxs("p",{className:"text-slate-400 text-sm mb-6",children:["Are you sure you want to remove ",jsxRuntimeExports.jsx("span",{className:"text-white font-mono",children:x.replace("https://","")}),"?",jsxRuntimeExports.jsx("br",{}),"Your proofs will remain, but you won't be able to transact until you re-add it."]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>p(null),className:"flex-1 py-2 px-4 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-medium transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:()=>b(x),className:"flex-1 py-2 px-4 bg-red-600 hover:bg-red-700 text-white rounded-xl font-bold transition-colors",children:"Remove"})]})]})})]})})},CrossMintTransferModal=({isOpen:t,onClose:e})=>{const{mints:r,proofs:n}=useEcashStore(),[s,o]=reactExports.useState(""),[c,u]=reactExports.useState(""),[f,x]=reactExports.useState(""),[p,g]=reactExports.useState("sats"),[y,b]=reactExports.useState(!1),[R,D]=reactExports.useState(null),[k,Re]=reactExports.useState(!1),Fe=Object.keys(r),O=s?n.filter(ze=>{const q=r[s]?.keys;return q?q.keysets&&Array.isArray(q.keysets)?q.keysets.some(W=>W.id===ze.id):!!q[ze.id]:!1}).reduce((ze,q)=>ze+q.amount,0):0;reactExports.useEffect(()=>{t&&(o(""),u(""),x(""),D(null),Re(!1))},[t]);const $e=async()=>{D(null),b(!0);try{const ze=p==="btc"?btcToSats(parseFloat(f)||0):parseInt(f);if(!s||!c)throw new Error("Please select both source and destination mints");if(s===c)throw new Error("Source and destination must be different");if(!ze||ze<=0)throw new Error("Amount must be greater than 0");if(ze>O)throw new Error(`Insufficient balance. Available: ${O} sats`);const q=await CashuService.transferBetweenMints(ze,s,c);if(!q.success)throw new Error(q.error||"Transfer failed");useEcashStore.getState().addHistoryItem({id:Math.random().toString(36).substring(7),type:"send",amount:ze,mint:s,timestamp:Math.floor(Date.now()/1e3),isNutzap:!1,recipient:`Transfer to ${c}`}),Re(!0),setTimeout(()=>{e()},2e3)}catch(ze){D(ze.message||"Transfer failed")}finally{b(!1)}};return t?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-md shadow-2xl",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-800",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-white",children:"Move Between Mints"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"text-slate-400 hover:text-white transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-6 h-6"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"From Mint"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("select",{value:s,onChange:ze=>o(ze.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-xl px-4 py-3 pr-10 text-white appearance-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all cursor-pointer",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Select source mint"}),Fe.map(ze=>jsxRuntimeExports.jsx("option",{value:ze,children:ze},ze))]}),jsxRuntimeExports.jsx(ChevronDown,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none"})]}),s&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Available: ",O.toLocaleString()," sats"]})]}),jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx(ArrowRight,{className:"w-6 h-6 text-purple-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"To Mint"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("select",{value:c,onChange:ze=>u(ze.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-xl px-4 py-3 pr-10 text-white appearance-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all cursor-pointer",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Select destination mint"}),Fe.filter(ze=>ze!==s).map(ze=>jsxRuntimeExports.jsx("option",{value:ze,children:ze},ze))]}),jsxRuntimeExports.jsx(ChevronDown,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-400",children:"Amount"}),s&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-slate-500",children:["Available: ",O.toLocaleString()," sats"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 border border-slate-800 rounded-xl p-3 focus-within:ring-2 focus-within:ring-purple-500 focus:border-transparent transition-all",children:[p==="sats"?jsxRuntimeExports.jsx(SatoshiIcon,{className:"text-xl text-purple-500 flex-shrink-0"}):jsxRuntimeExports.jsx("span",{className:"text-xl text-purple-500 flex-shrink-0",children:""}),jsxRuntimeExports.jsx("input",{type:"number",value:f,onChange:ze=>x(ze.target.value),placeholder:"0.00",className:"flex-1 bg-transparent text-white text-lg outline-none placeholder-slate-600 min-w-0",disabled:!s}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{const ze=parseFloat(f)||0;p==="sats"?(x(satsToBTC(ze)),g("btc")):(x(btcToSats(ze).toString()),g("sats"))},className:"p-2 hover:bg-slate-800 rounded-lg transition-colors flex-shrink-0",title:"Toggle unit",children:jsxRuntimeExports.jsx(ArrowUpDown,{className:"w-4 h-4 text-slate-400"})}),jsxRuntimeExports.jsx("span",{className:"text-slate-400 font-medium text-sm flex-shrink-0",children:p==="sats"?"sats":"BTC"})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-yellow-200",children:[" ",jsxRuntimeExports.jsx("strong",{children:"Note:"})," Lightning fees may apply during the transfer."]})}),R&&jsxRuntimeExports.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-200",children:R})}),k&&jsxRuntimeExports.jsx("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-3",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-green-200",children:" Transfer successful!"})})]}),jsxRuntimeExports.jsx("div",{className:"p-6 border-t border-slate-800",children:jsxRuntimeExports.jsx("button",{onClick:$e,disabled:y||!s||!c||!f||k,className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold py-3 rounded-xl hover:from-purple-700 hover:to-pink-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:y?"Transferring...":"Transfer"})})]})}):null},ProofsModal=({isOpen:t,onClose:e})=>{const{mints:r,proofs:n}=useEcashStore(),[s,o]=reactExports.useState(new Set),[c,u]=reactExports.useState(!1),f=g=>{o(y=>{const b=new Set(y);return b.has(g)?b.delete(g):b.add(g),b})};t&&n.length>0&&console.log(" Current proofs:",n.map(g=>({amount:g.amount,secret:g.secret,id:g.id})));const x=reactExports.useMemo(()=>{const g=Object.values(r),y={};g.forEach(R=>{y[R.url]={url:R.url,amount:0,count:0,isUnknown:!1}});const b={};return g.forEach(R=>{const D=R.keys;D&&(b[D.id]=R.url,D.keysets&&(Array.isArray(D.keysets)?D.keysets.forEach(k=>b[k.id]=R.url):Object.keys(D.keysets).forEach(k=>b[k]=R.url)))}),n.forEach(R=>{const D=b[R.id];if(D)y[D]||(y[D]={url:D,amount:0,count:0,isUnknown:!1}),y[D].amount+=R.amount,y[D].count+=1;else{const k=`unknown-${R.id}`;y[k]||(y[k]={url:`Unknown Keyset: ${R.id}`,amount:0,count:0,isUnknown:!0}),y[k].amount+=R.amount,y[k].count+=1}}),Object.values(y).filter(R=>R.amount>0||!R.isUnknown).sort((R,D)=>D.amount-R.amount)},[r,n]),p=n.reduce((g,y)=>g+y.amount,0);return t?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-md max-h-[600px] flex flex-col shadow-2xl animate-in fade-in zoom-in duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Proof Composition"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-1 text-slate-400 hover:text-white rounded-lg",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 bg-slate-900/50 text-center border-b border-slate-800",children:[jsxRuntimeExports.jsx("span",{className:"text-slate-500 text-sm uppercase tracking-wider font-bold",children:"Total Balance"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[jsxRuntimeExports.jsx(SatoshiIcon,{className:"w-6 h-6 text-purple-400"}),jsxRuntimeExports.jsx("span",{className:"text-3xl font-bold text-white",children:p.toLocaleString()}),jsxRuntimeExports.jsx("span",{className:"text-purple-400 font-bold",children:"sats"})]}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[n.length," proofs"]}),Object.keys(r).length>1&&jsxRuntimeExports.jsxs("button",{onClick:()=>u(!0),className:"mt-4 px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 mx-auto",children:[jsxRuntimeExports.jsx(ArrowRightLeft,{className:"w-4 h-4"}),"Move Between Mints"]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:x.length===0?jsxRuntimeExports.jsx("div",{className:"text-center text-slate-500 py-4",children:"No proofs found."}):x.map(g=>{const y=s.has(g.url);return jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 border border-slate-800 rounded-xl overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-slate-900/50 transition-colors",onClick:()=>f(g.url),children:[jsxRuntimeExports.jsxs("div",{className:"min-w-0 pr-4 flex-1",children:[jsxRuntimeExports.jsx("div",{className:`font-bold truncate ${g.isUnknown?"text-red-400":"text-white"}`,children:g.url.replace("https://","").replace(/\/$/,"")}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-slate-500",children:[g.count," proofs"]})]}),jsxRuntimeExports.jsxs("div",{className:"text-right whitespace-nowrap flex items-center gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"font-mono text-purple-400 font-bold",children:[g.amount.toLocaleString()," sats"]}),y?jsxRuntimeExports.jsx(ChevronUp,{className:"w-4 h-4 text-slate-400"}):jsxRuntimeExports.jsx(ChevronDown,{className:"w-4 h-4 text-slate-400"})]})]}),y&&jsxRuntimeExports.jsx("div",{className:"px-4 py-3 space-y-1 border-t border-white/10",children:n.filter(b=>{const R=Object.keys(r).find(D=>{const k=r[D].keys;return k.keysets&&Array.isArray(k.keysets)&&k.keysets.some(Re=>Re.id===b.id)||k[b.id]});return R===g.url||!R&&g.isUnknown&&g.url.includes(b.id)}).map((b,R)=>jsxRuntimeExports.jsxs("div",{className:"text-xs bg-slate-900/50 rounded p-2 font-mono",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-slate-400",children:[jsxRuntimeExports.jsx("span",{children:"Amount:"}),jsxRuntimeExports.jsxs("span",{className:"text-purple-400",children:[b.amount," sats"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-slate-500 mt-1",children:[jsxRuntimeExports.jsx("span",{children:"Secret:"}),jsxRuntimeExports.jsxs("span",{className:"truncate ml-2",children:[b.secret.substring(0,16),"..."]})]})]},R))})]},g.url)})})]}),jsxRuntimeExports.jsx(CrossMintTransferModal,{isOpen:c,onClose:()=>u(!1)})]}):null},PendingSendsModal=({isOpen:t,onClose:e})=>{const{pendingSends:r,removePendingSend:n,updatePendingSendAttempt:s}=useEcashStore(),{decryptedKey:o}=useAuthStore(),[c,u]=reactExports.useState(null),[f,x]=reactExports.useState(null),[p,g]=reactExports.useState(null),[y,b]=reactExports.useState(null);if(!t)return null;const R=async k=>{if(!o){alert("Wallet must be unlocked to retry");return}u(k.id);try{let Re=k.recipient;try{const W=nip19_exports$1.decode(k.recipient);W.type==="npub"&&(Re=W.data)}catch{console.warn("Could not decode recipient as npub")}const Fe=Nip61Service.createNutZapEvent(k.token,k.mint,k.amount,Re),O=new NDKPrivateKeySigner(o),$e=new NDK({explicitRelayUrls:["wss://relay.damus.io","wss://nos.lol","wss://relay.nostr.band","wss://relay.primal.net","wss://relay.snort.social"],signer:O});await $e.connect(2e3);const ze=new NDKEvent($e,Fe);await ze.sign();const q=await ze.publish();if(q.size>0)console.log(` Retry successful! Published to ${q.size} relays`),useEcashStore.getState().addHistoryItem({id:ze.id||Math.random().toString(36).substring(7),type:"send",amount:k.amount,mint:k.mint,timestamp:ze.created_at||Math.floor(Date.now()/1e3),isNutzap:!0,recipient:k.recipient}),n(k.id),console.log(" Publishing updated wallet state to NIP-60..."),await useEcashStore.getState().publishProofsToNostr(!0),g(`Successfully published to ${q.size} relays!`),setTimeout(()=>g(null),3e3);else throw new Error("No relays received the event")}catch(Re){console.error("Retry failed:",Re),s(k.id,Re.message),b(`Retry failed: ${Re.message}`),setTimeout(()=>b(null),5e3)}finally{u(null)}},D=k=>{navigator.clipboard.writeText(k.token),x(k.id),setTimeout(()=>x(null),2e3)};return jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-800",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-white",children:"Stuck Sends"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:[r.length," pending ",r.length===1?"send":"sends"," waiting to be published"]})]}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-slate-400"})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:r.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("p",{className:"text-slate-400",children:"No pending sends"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"All your sends have been published successfully!"})]}):jsxRuntimeExports.jsx("div",{className:"space-y-4",children:r.map(k=>jsxRuntimeExports.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-xl p-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-start justify-between mb-3",children:jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsxs("span",{className:"text-lg font-bold text-white",children:[k.amount," sats"]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-500",children:""}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-slate-400 font-mono",children:[k.recipient.slice(0,12),"...",k.recipient.slice(-8)]})]}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-slate-500",children:["From: ",new URL(k.mint).hostname]}),jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-500",children:new Date(k.timestamp).toLocaleString()}),k.attempts>0&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-yellow-400 mt-1",children:[" ",k.attempts," failed ",k.attempts===1?"attempt":"attempts"]}),k.lastError&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-red-400 mt-1",children:["Error: ",k.lastError]})]})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>R(k),disabled:c===k.id,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white text-sm font-bold rounded-lg transition-colors disabled:cursor-not-allowed",children:c===k.id?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(RefreshCw,{className:"w-4 h-4 animate-spin"}),"Retrying..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(RefreshCw,{className:"w-4 h-4"}),"Retry Publish"]})}),jsxRuntimeExports.jsx("button",{onClick:()=>D(k),className:"px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white text-sm rounded-lg transition-colors flex items-center gap-2",children:f===k.id?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"}),"Copied"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4"}),"Copy Token"]})})]})]},k.id))})}),jsxRuntimeExports.jsx("div",{className:"p-6 border-t border-slate-800 bg-slate-900/50",children:jsxRuntimeExports.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-yellow-200",children:[" ",jsxRuntimeExports.jsx("strong",{children:"Tip:"}),' These tokens are already locked to the recipient. Use "Retry Publish" to send them via Nostr, or "Copy Token" to send manually.']})})})]}),p&&jsxRuntimeExports.jsx("div",{className:"fixed bottom-4 right-4 z-[60] animate-in slide-in-from-bottom-5 fade-in duration-300",children:jsxRuntimeExports.jsxs("div",{className:"bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2",children:[jsxRuntimeExports.jsx(Check,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:p})]})}),y&&jsxRuntimeExports.jsx("div",{className:"fixed bottom-4 right-4 z-[60] animate-in slide-in-from-bottom-5 fade-in duration-300",children:jsxRuntimeExports.jsxs("div",{className:"bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2",children:[jsxRuntimeExports.jsx(X,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:y})]})})]})},EcashTransactionDetailsModal=({isOpen:t,onClose:e,transaction:r})=>{const[n,s]=reactExports.useState(null);if(reactExports.useEffect(()=>{if(!r)return;const c=r.type==="receive"?r.sender:r.recipient;c?ProfileService.fetchProfile(c).then(s).catch(u=>console.error("Failed to fetch profile:",u)):s(null)},[r]),!t||!r)return null;const o=c=>{navigator.clipboard.writeText(c)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-md overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Transaction Details"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-1 text-slate-400 hover:text-white rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"text-center pb-4 border-b border-slate-800",children:[jsxRuntimeExports.jsxs("div",{className:`text-3xl font-bold mb-1 ${r.type==="receive"?"text-green-500":"text-white"}`,children:[r.type==="receive"?"+":"-",r.amount,jsxRuntimeExports.jsx("span",{className:"text-lg ml-2 text-slate-400",children:"sats"})]}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-slate-400",children:[r.type==="receive"?"Received":"Sent"," ",r.isNutzap?"NutZap":"Private"]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Date & Time"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-white",children:new Date(r.timestamp*1e3).toLocaleString()})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Mint"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-white font-mono truncate flex-1",children:r.mint}),jsxRuntimeExports.jsx("button",{onClick:()=>window.open(r.mint,"_blank"),className:"p-1.5 hover:bg-slate-800 rounded-lg transition-colors",title:"Open mint URL",children:jsxRuntimeExports.jsx(ExternalLink,{className:"w-4 h-4 text-slate-400"})})]})]}),r.type==="receive"&&r.sender&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"From"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 bg-slate-800/50 rounded-lg p-3",children:[n?.picture?jsxRuntimeExports.jsx("img",{src:n.picture,alt:n.name,className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}):jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx(User,{className:"w-5 h-5 text-slate-400"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-white truncate",children:n?.name||`${r.sender.slice(0,8)}...${r.sender.slice(-6)}`}),n?.nip05&&jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-3.5 h-3.5 text-purple-400 flex-shrink-0"})]}),n?.nip05&&jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-400 truncate",children:n.nip05}),jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-500 font-mono truncate",children:r.sender})]}),jsxRuntimeExports.jsx("button",{onClick:()=>o(r.sender),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors flex-shrink-0",title:"Copy npub",children:jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4 text-slate-400"})})]})]}),r.type==="send"&&r.recipient&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"To"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 bg-slate-800/50 rounded-lg p-3",children:[n?.picture?jsxRuntimeExports.jsx("img",{src:n.picture,alt:n.name,className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}):jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx(User,{className:"w-5 h-5 text-slate-400"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-white truncate",children:n?.name||`${r.recipient.slice(0,8)}...${r.recipient.slice(-6)}`}),n?.nip05&&jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-3.5 h-3.5 text-purple-400 flex-shrink-0"})]}),n?.nip05&&jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-400 truncate",children:n.nip05}),jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-500 font-mono truncate",children:r.recipient})]}),jsxRuntimeExports.jsx("button",{onClick:()=>o(r.recipient),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors flex-shrink-0",title:"Copy npub",children:jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4 text-slate-400"})})]})]}),r.memo&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Memo"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-white bg-slate-800/50 rounded-lg p-3",children:r.memo})]}),!r.isNutzap&&r.token&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Token"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"text-xs text-white font-mono truncate flex-1 bg-slate-800/50 rounded-lg p-2",children:[r.token.slice(0,32),"..."]}),jsxRuntimeExports.jsx("button",{onClick:()=>o(r.token),className:"p-1.5 hover:bg-slate-800 rounded-lg transition-colors",title:"Copy token",children:jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4 text-slate-400"})})]})]}),r.isNutzap&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Event ID"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-white font-mono truncate flex-1",children:r.id}),jsxRuntimeExports.jsx("button",{onClick:()=>o(r.id),className:"p-1.5 hover:bg-slate-800 rounded-lg transition-colors",title:"Copy event ID",children:jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4 text-slate-400"})})]})]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-slate-800",children:jsxRuntimeExports.jsx("button",{onClick:e,className:"w-full py-2 px-4 bg-purple-500 hover:bg-purple-600 text-white font-bold rounded-xl transition-colors",children:"Close"})})]})})},EcashWallet=({initialRecipient:t="",autoOpenSend:e=!1,onSendComplete:r})=>{const{mints:n,proofs:s,history:o,pendingSends:c}=useEcashStore(),{publicKey:u}=useAuthStore(),[f,x]=reactExports.useState(!1),[p,g]=reactExports.useState(!1),[y,b]=reactExports.useState(!1),[R,D]=reactExports.useState(!1),[k,Re]=reactExports.useState(!1),[Fe,O]=reactExports.useState(null),[$e,ze]=reactExports.useState(new Map),[q,W]=reactExports.useState(t),[We,Xe]=reactExports.useState(!0),[it,Ve]=reactExports.useState(!1),[v,I]=reactExports.useState(null),[Ce,P]=reactExports.useState(null),[_e]=reactExports.useState(0);reactExports.useEffect(()=>{console.log("[EcashWallet] Sync effect: initialRecipient=",t?t.slice(0,20)+"...":"undefined"),t&&W(t)},[t]),reactExports.useEffect(()=>{console.log("[EcashWallet] AutoOpen effect: autoOpenSend=",e,"initialRecipient=",t?t.slice(0,20)+"...":"undefined"),e&&t&&(console.log("[EcashWallet] Opening send modal with recipient"),W(t),g(!0))},[e,t]),reactExports.useEffect(()=>{console.log(` EcashWallet (v${_e}): Effect triggered. PublicKey: ${u?"Present":"Missing"}`);const st=new NDK({explicitRelayUrls:["wss://relay.damus.io","wss://nos.lol","wss://relay.nostr.band","wss://relay.primal.net","wss://relay.snort.social","wss://relay.azzamo.net","wss://relay.cashumints.space"]});let dt=null,Je=null,pt=null;return console.log(` EcashWallet (v${_e}): Initializing NDK...`),Promise.race([st.connect(),new Promise(rr=>setTimeout(rr,3e3))]).then(()=>{if(console.log(` EcashWallet (v${_e}): NDK Connected to relays`),u){dt=st.subscribe({kinds:[KIND_NIP61_NUTZAP],"#p":[u]}),console.log(` EcashWallet (v${_e}): Subscribed to NIP-61 NutZaps`),dt.on("event",async cr=>{if(useEcashStore.getState().history.some(ft=>ft.id===cr.id))return;console.log(" EcashWallet: Received NutZap",cr.id);const ir=Nip61Service.parseNutZap(cr);if(ir&&cr.content)try{await CashuService.receiveToken(cr.content),useEcashStore.getState().addHistoryItem({id:`${cr.id}-receive`,type:"receive",amount:ir.amount,mint:ir.mint,timestamp:cr.created_at,isNutzap:!0,sender:nip19_exports$1.npubEncode(cr.pubkey),recipient:u}),console.log("NutZap Redeemed!"),L()}catch(ft){ft.message?.includes("already spent")?(console.log(" Token already spent, marking as processed"),useEcashStore.getState().addHistoryItem({id:`${cr.id}-receive`,type:"receive",amount:0,mint:ir.mint,timestamp:cr.created_at,isNutzap:!0,recipient:u})):console.error("Failed to redeem NutZap",ft)}});const{decryptedKey:rr}=useAuthStore.getState();rr&&(pt=Nip60Service.subscribeToWalletState(st,u,rr,cr=>{useEcashStore.getState().mergeWalletState(cr)}),console.log(` EcashWallet (v${_e}): Subscribed to NIP-60 Wallet State`))}else console.log(` EcashWallet (v${_e}): Skipping NIP-61 (No public key)`);Je=Nip87Service.subscribeToMints(st),console.log(` EcashWallet (v${_e}): Subscribed to NIP-87 Mints`)}),()=>{dt&&dt.stop(),Je&&Je.stop(),pt&&pt.stop()}},[u,_e]),reactExports.useEffect(()=>{const st=async()=>{const dt=new Set;o.forEach(pt=>{pt.isNutzap&&(pt.sender&&dt.add(pt.sender),pt.recipient&&dt.add(pt.recipient))});const Je=new Map($e);for(const pt of dt)if(!Je.has(pt))try{const rr=await ProfileService.fetchProfile(pt);rr&&Je.set(pt,rr)}catch(rr){console.error(`Failed to fetch profile for ${pt}:`,rr)}ze(Je)};o.length>0&&st()},[o]);const Le=s.reduce((st,dt)=>st+dt.amount,0),Ye=(Le/1e8).toFixed(8),je=async()=>{try{Ve(!0);const st=useEcashStore.getState().proofs,dt={};st.forEach(pt=>{let rr=Object.keys(n).find(cr=>{const fr=n[cr].keys;return fr.keysets&&Array.isArray(fr.keysets)&&fr.keysets.some(ir=>ir.id===pt.id)||fr[pt.id]});if(!rr){console.warn(` Skipping proof with keyset ${pt.id} - mint not found`);return}dt[rr]||(dt[rr]=[]),dt[rr].push(pt)});let Je=0;for(const[pt,rr]of Object.entries(dt)){if(rr.length===0)continue;const cr=await CashuService.consolidateProofs(pt,rr);useEcashStore.getState().removeProofs(rr,!0),useEcashStore.getState().addProofs(cr,!0),Je+=rr.length}console.log(" Publishing consolidated state to NIP-60 (skip merge)..."),await useEcashStore.getState().publishProofsToNostr(!0),P({success:!0,count:Je})}catch(st){console.error("Consolidation failed:",st),P({success:!1,count:0})}finally{Ve(!1)}},K=async()=>{try{Ve(!0);const st=useEcashStore.getState().proofs,dt={},Je=Object.keys(n).filter(ir=>n[ir].active);st.forEach(ir=>{let ft=Object.keys(n).find(nr=>{const lr=n[nr].keys;return lr.keysets&&Array.isArray(lr.keysets)&&lr.keysets.some(er=>er.id===ir.id)||lr[ir.id]});!ft&&Je.length>0&&(ft=Je[0]),ft&&(dt[ft]||(dt[ft]=[]),dt[ft].push(ir))});let pt=0,rr=0;const cr=useEcashStore.getState().pendingSends,fr=new Set(cr.flatMap(ir=>ir.proofSecrets||[]));fr.size>0&&console.log(` Manual cleanup: Protecting ${fr.size} proofs in ${cr.length} pending send(s)`);for(const[ir,ft]of Object.entries(dt)){if(ft.length===0)continue;const nr=ft.filter(pr=>!fr.has(pr.secret));if(nr.length===0){console.log(` Manual cleanup: Skipping ${ir} - all ${ft.length} proofs are in pending sends`);continue}nr.length<ft.length&&console.log(` Manual cleanup: Checking ${nr.length}/${ft.length} proofs from ${ir} (${ft.length-nr.length} protected)`);const{valid:lr,spent:er}=await CashuService.checkProofStates(ir,nr);pt+=lr.length,rr+=er.length,er.length>0&&(useEcashStore.getState().removeProofs(er,!0),console.log(` Removed ${er.length} spent proofs from ${ir}`))}rr>0?(console.log(" Publishing cleaned state to NIP-60 (skip merge)..."),await useEcashStore.getState().publishProofsToNostr(!0),I({spent:rr,valid:pt})):I({spent:0,valid:pt})}catch(st){console.error("Check proofs failed:",st),I({spent:-1,valid:0})}finally{Ve(!1)}},L=async()=>{try{console.log(" Auto-cleanup: Waiting for NIP-60 sync..."),await new Promise(fr=>setTimeout(fr,2e3)),console.log(" Auto-cleanup: Starting proof check...");const st=useEcashStore.getState().proofs,dt={},Je=Object.keys(n).filter(fr=>n[fr].active);st.forEach(fr=>{let ir=Object.keys(n).find(ft=>{const nr=n[ft].keys;return Array.isArray(nr)?nr.some(lr=>lr.id===fr.id):!1});!ir&&Je.length>0&&(ir=Je[0]),ir&&(dt[ir]||(dt[ir]=[]),dt[ir].push(fr))});let pt=0;const rr=useEcashStore.getState().pendingSends,cr=new Set(rr.flatMap(fr=>fr.proofSecrets||[]));cr.size>0&&console.log(` Auto-cleanup: Protecting ${cr.size} proofs in ${rr.length} pending send(s)`);for(const[fr,ir]of Object.entries(dt)){if(ir.length===0)continue;const ft=ir.filter(lr=>!cr.has(lr.secret));if(ft.length===0){console.log(` Auto-cleanup: Skipping ${fr} - all ${ir.length} proofs are in pending sends`);continue}ft.length<ir.length&&console.log(` Auto-cleanup: Checking ${ft.length}/${ir.length} proofs from ${fr} (${ir.length-ft.length} protected)`);const{spent:nr}=await CashuService.checkProofStates(fr,ft);pt+=nr.length,nr.length>0&&(useEcashStore.getState().removeProofs(nr,!0),console.log(` Auto-cleanup: Removed ${nr.length} spent proofs from ${fr}`))}pt>0&&(console.log(" Auto-cleanup: Publishing cleaned state to NIP-60..."),await useEcashStore.getState().publishProofsToNostr(!0),I({spent:pt,valid:st.length-pt}),setTimeout(()=>I(null),3e3))}catch(st){console.error("Auto-cleanup failed:",st)}};return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-br from-purple-900/40 to-indigo-900/40 border border-purple-500/20 rounded-2xl p-6 relative overflow-hidden",children:jsxRuntimeExports.jsxs("div",{className:"relative z-10",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-1",children:[jsxRuntimeExports.jsx("span",{className:"text-slate-400 font-medium text-sm",children:"Total Balance"}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:jsxRuntimeExports.jsx("button",{onClick:()=>Xe(!We),className:"p-1.5 hover:bg-slate-700/50 rounded-lg text-slate-300 hover:text-white transition-all",title:"Toggle denomination",children:jsxRuntimeExports.jsx(ArrowUpDown,{className:"w-4 h-4"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex items-baseline gap-2 mb-1",children:We?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SatoshiIcon,{className:"text-3xl max-[400px]:text-2xl max-[300px]:text-xl text-purple-400"}),jsxRuntimeExports.jsx("span",{className:"text-4xl max-[400px]:text-3xl max-[300px]:text-2xl font-bold text-white",children:Le.toLocaleString()}),jsxRuntimeExports.jsx("span",{className:"text-purple-400 font-bold",children:"sats"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"text-3xl max-[400px]:text-2xl max-[300px]:text-xl text-purple-400",children:""}),jsxRuntimeExports.jsx("span",{className:"text-4xl max-[400px]:text-3xl max-[300px]:text-2xl font-bold text-white",children:Ye}),jsxRuntimeExports.jsx("span",{className:"text-purple-400 font-bold",children:"BTC"})]})}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-1.5 text-sm text-slate-500 mb-6",children:We?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"text-base text-purple-400",children:""}),jsxRuntimeExports.jsxs("span",{children:[" ",Ye," BTC"]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SatoshiIcon,{className:"text-xs"}),jsxRuntimeExports.jsxs("span",{children:[" ",Le.toLocaleString()," sats"]})]})}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between gap-3 text-xs mb-6",children:[jsxRuntimeExports.jsxs("button",{onClick:K,disabled:it,className:"px-3 py-1.5 bg-slate-800/50 hover:bg-slate-700/50 border border-slate-600/30 hover:border-purple-500/50 rounded-lg text-slate-300 hover:text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[it&&jsxRuntimeExports.jsxs("svg",{className:"animate-spin h-3 w-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),it?"Checking...":"Clean Balance"]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>b(!0),className:"px-3 py-1.5 bg-slate-800/50 hover:bg-slate-700/50 border border-slate-600/30 hover:border-purple-500/50 rounded-lg text-slate-300 hover:text-white transition-all",children:[Object.keys(n).length," Mints"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>D(!0),className:"px-3 py-1.5 bg-slate-800/50 hover:bg-slate-700/50 border border-slate-600/30 hover:border-purple-500/50 rounded-lg text-slate-300 hover:text-white transition-all",children:[s.length," Proofs"]})]})]}),s.length>=1e3&&jsxRuntimeExports.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-xl p-4 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-yellow-500 text-lg",children:""}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h4",{className:"font-bold text-yellow-500 mb-1",children:"Too Many Proofs"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-yellow-200 mb-3",children:["You have ",s.length," proofs. Consolidate them to reduce sync size and improve performance."]}),jsxRuntimeExports.jsx("button",{onClick:je,disabled:it,className:"px-4 py-2 bg-yellow-500 hover:bg-yellow-600 disabled:bg-yellow-700 text-black font-bold rounded-lg transition-colors disabled:cursor-not-allowed",children:it?"Consolidating...":"Consolidate Proofs"})]})]})}),c.length>0&&jsxRuntimeExports.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-red-500 text-lg",children:""}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h4",{className:"font-bold text-red-500 mb-1",children:"Stuck Sends Detected"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-red-200 mb-3",children:["You have ",c.length," ",c.length===1?"send":"sends"," that failed to publish. The tokens are locked to recipients but not sent yet."]}),jsxRuntimeExports.jsxs("button",{onClick:()=>Re(!0),className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white font-bold rounded-lg transition-colors",children:["Recover ",c.length," ",c.length===1?"Send":"Sends"]})]})]})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 flex-wrap",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>x(!0),className:"flex-1 bg-slate-900/50 hover:bg-slate-900/70 text-white py-2 px-4 rounded-xl font-medium transition-colors flex items-center justify-center gap-2 border border-white/10",children:[jsxRuntimeExports.jsx(ArrowDownLeft,{className:"w-4 h-4 text-green-400"}),"Receive"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>g(!0),className:"flex-1 bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-xl font-bold transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(ArrowUpRight,{className:"w-4 h-4"}),"Send"]})]})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-baseline gap-2 px-1 mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"History (Nutzaps)"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-500",children:"Latest 1000 transactions"})]}),jsxRuntimeExports.jsx("div",{className:"space-y-3 overflow-y-auto pr-1",style:{maxHeight:"calc(100vh - 700px)"},children:o.filter(st=>st.amount>0).length===0?jsxRuntimeExports.jsx("div",{className:"p-8 text-center text-slate-500",children:"No transaction history found."}):o.filter(st=>st.amount>0).map(st=>{const dt=st.type==="receive"?st.sender:st.recipient,Je=dt?$e.get(dt):null;return jsxRuntimeExports.jsxs("button",{onClick:()=>O(st),className:"w-full text-left bg-slate-900 border border-slate-800 rounded-xl p-4 flex items-center justify-between hover:border-purple-500/50 transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[jsxRuntimeExports.jsx("div",{className:`p-2 rounded-full flex-shrink-0 ${st.type==="receive"?"bg-green-500/10 text-green-500":"bg-purple-500/10 text-purple-500"}`,children:st.type==="receive"?jsxRuntimeExports.jsx(ArrowDownLeft,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(ArrowUpRight,{className:"w-4 h-4"})}),dt?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[Je?.picture?jsxRuntimeExports.jsx("img",{src:Je.picture,alt:Je.name,className:"w-8 h-8 rounded-full object-cover flex-shrink-0"}):jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx(User,{className:"w-4 h-4 text-slate-500"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-400",children:st.type==="receive"?"from":"to"}),jsxRuntimeExports.jsx("span",{className:"font-bold text-white truncate",children:Je?.name||`${dt.slice(0,8)}...${dt.slice(-6)}`}),Je?.nip05&&jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-3.5 h-3.5 text-purple-400 flex-shrink-0"})]}),jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-400",children:new Date(st.timestamp*1e3).toLocaleDateString()})]})]}):jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"font-bold text-white",children:st.type==="receive"?"Received NutZap":"Sent NutZap"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-400",children:new Date(st.timestamp*1e3).toLocaleDateString()})]})]}),jsxRuntimeExports.jsx("div",{className:"text-right flex-shrink-0 ml-3",children:jsxRuntimeExports.jsxs("span",{className:`font-bold ${st.type==="receive"?"text-green-500":"text-white"}`,children:[st.type==="receive"?"+":"-",st.amount," sats"]})})]},st.id)})}),jsxRuntimeExports.jsx(EcashReceiveModal,{isOpen:f,onClose:()=>{x(!1),L()}}),jsxRuntimeExports.jsx(EcashSendModal,{isOpen:p,onClose:()=>{g(!1),W(""),L(),r&&r()},initialRecipient:q}),jsxRuntimeExports.jsx(MintsModal,{isOpen:y,onClose:()=>b(!1)}),jsxRuntimeExports.jsx(ProofsModal,{isOpen:R,onClose:()=>D(!1)}),jsxRuntimeExports.jsx(PendingSendsModal,{isOpen:k,onClose:()=>Re(!1)}),jsxRuntimeExports.jsx(EcashTransactionDetailsModal,{isOpen:!!Fe,onClose:()=>O(null),transaction:Fe}),v&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-md p-6 shadow-2xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:v.spent===-1?" Check Failed":" Clean Complete"}),v.spent===-1?jsxRuntimeExports.jsx("p",{className:"text-slate-300 mb-6",children:"Failed to check proofs. Please try again."}):v.spent>0?jsxRuntimeExports.jsxs("p",{className:"text-slate-300 mb-6",children:["Cleaned ",jsxRuntimeExports.jsx("span",{className:"text-red-400 font-bold",children:v.spent})," spent proofs!",jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx("span",{className:"text-green-400 font-bold",children:v.valid})," valid proofs remaining."]}):jsxRuntimeExports.jsxs("p",{className:"text-slate-300 mb-6",children:["All ",jsxRuntimeExports.jsx("span",{className:"text-green-400 font-bold",children:v.valid})," proofs are valid!"]}),jsxRuntimeExports.jsx("button",{onClick:()=>I(null),className:"w-full px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white font-bold rounded-lg transition-colors",children:"Close"})]})}),Ce&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-md p-6 shadow-2xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:Ce.success?" Consolidation Complete":" Consolidation Failed"}),Ce.success?jsxRuntimeExports.jsxs("p",{className:"text-slate-300 mb-6",children:["Successfully consolidated ",jsxRuntimeExports.jsx("span",{className:"text-purple-400 font-bold",children:Ce.count})," proofs!",jsxRuntimeExports.jsx("br",{}),"Your wallet now has fewer, more efficient proofs."]}):jsxRuntimeExports.jsx("p",{className:"text-slate-300 mb-6",children:"Failed to consolidate proofs. Please try again."}),jsxRuntimeExports.jsx("button",{onClick:()=>P(null),className:"w-full px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white font-bold rounded-lg transition-colors",children:"Close"})]})})]})},WalletView=({initialTab:t="bitcoin",initialRecipient:e="",initialFeeRate:r,autoOpenSend:n=!1,onSendComplete:s})=>{const[o,c]=reactExports.useState(t);return reactExports.useEffect(()=>{t&&c(t)},[t]),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"px-6 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900/50 p-1 rounded-xl border border-slate-800 flex gap-1 relative",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>c("bitcoin"),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-bold transition-all ${o==="bitcoin"?"bg-amber-500 text-slate-950 shadow-lg":"text-slate-400 hover:text-white"}`,children:[jsxRuntimeExports.jsx(Bitcoin,{className:"w-4 h-4"}),"Bitcoin"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>c("ecash"),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-bold transition-all ${o==="ecash"?"bg-purple-600 text-white shadow-lg":"text-slate-400 hover:text-white"}`,children:[jsxRuntimeExports.jsx(Banknote,{className:"w-4 h-4"}),"eCash"]})]})}),jsxRuntimeExports.jsx("div",{className:"animate-in fade-in duration-300",children:o==="bitcoin"?jsxRuntimeExports.jsx(BitcoinWallet,{initialRecipient:o==="bitcoin"?e:void 0,initialFeeRate:o==="bitcoin"?r:void 0,autoOpenSend:o==="bitcoin"&&n,onSendComplete:s}):jsxRuntimeExports.jsx(EcashWallet,{initialRecipient:t==="ecash"?e:void 0,autoOpenSend:t==="ecash"&&n,onSendComplete:s})})]})};function generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}const BOOTSTRAP_NODES=["https://node.icannot.xyz"];class DnnService{discoveredNodes=[];initialized=!1;async initialize(){this.initialized||(this.discoveredNodes=BOOTSTRAP_NODES.map(e=>({url:e,status:"unknown"})),await this.checkNodes(),this.initialized=!0)}async checkNodes(){const e=this.discoveredNodes.map(async r=>{try{console.log("[DnnService] Checking node:",r.url);const n=await fetch(`${r.url}/dnn/status`,{signal:AbortSignal.timeout(5e3)});n.ok?(r.status="online",r.lastSeen=Date.now(),console.log("[DnnService] Node online:",r.url)):(r.status="offline",console.warn("[DnnService] Node returned error:",r.url,n.status))}catch(n){r.status="offline",console.error("[DnnService] Failed to reach node:",r.url,n)}});await Promise.allSettled(e)}getOnlineNode(){return this.discoveredNodes.find(e=>e.status==="online")||null}getNodes(){return[...this.discoveredNodes]}async discoverPeers(){const e=this.getOnlineNode();if(e)try{const r=await fetch(`${e.url}/dnn/peers`,{signal:AbortSignal.timeout(5e3)});if(r.ok){const n=await r.json();if(Array.isArray(n))for(const s of n)typeof s=="string"&&!this.discoveredNodes.find(o=>o.url===s)&&this.discoveredNodes.push({url:s,status:"unknown"})}}catch(r){console.error("[DnnService] Failed to discover peers:",r)}}async getUserNames(e){const r=this.getOnlineNode();if(!r)return console.warn("[DnnService] No online nodes available"),[];try{const n=await fetch(`${r.url}/dnn/lookup/npub/${e}`,{signal:AbortSignal.timeout(1e4)});if(!n.ok)return console.error("[DnnService] Failed to fetch user names:",n.status),[];const s=await n.json();console.log("[DnnService] getUserNames response:",s);const o=[];if(s.names&&Array.isArray(s.names))for(const c of s.names){const u=c.encoded||"",f=u.replace(/-([a-z])/g,(x,p)=>p.toUpperCase());o.push({name:c.name||"",dnnId:u,format:u,encoded:u,dnnBlock:c.dnn_block||0,bitcoinBlock:c.bitcoin_block||0,position:c.position||0,status:"confirmed",camelCase:f})}return o}catch(n){return console.error("[DnnService] Failed to fetch user names:",n),[]}}async verifyDnnId(e,r){if(!e||!r)return!1;const n=this.getOnlineNode();if(!n)return console.warn("[DnnService] No online nodes available for verification"),!1;try{const s=e.toLowerCase();console.log(`[DnnService] Verifying DNN ID: ${e} (normalized: ${s}) for npub: ${r}`);const o=await fetch(`${n.url}/dnn/resolve/${s}`,{signal:AbortSignal.timeout(5e3)});if(!o.ok)return console.log(`[DnnService] DNN resolve failed with status: ${o.status}`),!1;const c=await o.json();return console.log("[DnnService] DNN resolve response:",c),console.log(`[DnnService] Comparing npub: '${c.npub}' === '${r}' = ${c.npub===r}`),c.npub===r}catch(s){return console.error("[DnnService] Failed to verify DNN ID:",s),!1}}async getPendingNames(e){const r=this.getOnlineNode();if(!r)return[];try{const n=await this.deriveAllAddresses(e);if(!n||n.length===0)return console.warn("[DnnService] Could not derive Bitcoin addresses for pubkey"),[];console.log("[DnnService] Derived",n.length,"addresses for pubkey:",e.slice(0,8));const s=[],o=new Set;for(const c of n){console.log("[DnnService] Checking address:",c);const u=await fetch(`${r.url}/dnn/anchors?address=${c}&status=pending`,{signal:AbortSignal.timeout(1e4)});if(!u.ok){console.warn("[DnnService] Failed to fetch transactions for",c,":",u.status);continue}const f=await u.json(),x=Array.isArray(f)?f:f?.results||[];console.log("[DnnService] Found",x.length,"transactions for address",c);for(const p of x){const g=p.transaction_id||p.TransactionID||"";o.has(g)||(o.add(g),p.has_anchor_event||s.push({name:p.name||p.encoded||`n${p.dnn_block||p.DNNBlock||0}.${p.position||p.Position||0}`,dnnId:`n${p.dnn_block||p.DNNBlock||0}.${p.position||p.Position||0}`,format:p.encoded||`n${p.dnn_block||p.DNNBlock||0}.${p.position||p.Position||0}`,dnnBlock:p.dnn_block||p.DNNBlock||0,bitcoinBlock:p.bitcoin_block||p.BitcoinBlock||0,position:p.position||p.Position||0,status:"pending",txid:g}))}}return console.log("[DnnService] Found",s.length,"total pending names"),s}catch(n){return console.error("[DnnService] Failed to fetch pending names:",n),[]}}async deriveAllAddresses(e){const r=this.getOnlineNode();if(!r)return console.warn("[DnnService] deriveAllAddresses: No online node"),[];try{const n=`${r.url}/dnn/derive-address/${e}`;console.log("[DnnService] deriveAllAddresses: Calling",n);const s=await fetch(n,{signal:AbortSignal.timeout(5e3)});if(s.ok){const o=await s.json();if(o.addresses&&Array.isArray(o.addresses)){const c=o.addresses.map(u=>u.address).filter(Boolean);return console.log("[DnnService] deriveAllAddresses: Got",c.length,"addresses"),c}}else{const o=await s.text();console.error("[DnnService] deriveAllAddresses: Error response",s.status,o)}}catch(n){console.error("[DnnService] Failed to derive addresses:",n)}return[]}async deriveAddress(e){const r=await this.deriveAllAddresses(e);return r.length>0?r[0]:null}generateClaimEvents(e,r,n){const s=Math.floor(Date.now()/1e3),o={name:generateUUID(),connection:generateUUID(),metadata:generateUUID(),anchor:generateUUID()},c={kind:61600,created_at:s,tags:[["d",o.name],["t","DNN"],...n?[["n",n]]:[]],content:JSON.stringify({updated_at:s})},u={kind:62600,created_at:s,tags:[["d",o.connection],["t","DNN"],["v","1"]],content:JSON.stringify({})},f={kind:63600,created_at:s,tags:[["d",o.metadata],["t","DNN"]],content:JSON.stringify({updated_at:s,metadata:{}})},x={kind:60600,created_at:s,tags:[["d",o.anchor],["n",""],["c",""],["m",""],["x",r],["t","DNN"]],content:JSON.stringify({updated_at:s})};return{nameEvent:c,connectionEvent:u,metadataEvent:f,anchorEvent:x,dTags:o}}createNaddr(e,r,n,s=[]){return nip19_exports$1.naddrEncode({identifier:n,pubkey:e,kind:r,relays:s})}fillAnchorEvent(e,r,n,s=[]){const o=this.createNaddr(r,61600,n.name,s),c=this.createNaddr(r,62600,n.connection,s),u=this.createNaddr(r,63600,n.metadata,s),f={...e};return f.tags=e.tags.map(x=>x[0]==="n"?["n",o]:x[0]==="c"?["c",c]:x[0]==="m"?["m",u]:x),f}}const dnnService=new DnnService,useDnnStore=create(t=>({nodes:[],nodesLoading:!1,confirmedNames:[],pendingNames:[],namesLoading:!1,initializeService:async()=>{t({nodesLoading:!0});try{await dnnService.initialize(),await dnnService.discoverPeers(),t({nodes:dnnService.getNodes()})}catch(e){console.error("[DnnStore] Failed to initialize:",e)}finally{t({nodesLoading:!1})}},fetchUserNames:async e=>{t({namesLoading:!0});try{let r=e;if(e.startsWith("npub")){const o=nip19_exports$1.decode(e);o.type==="npub"&&(r=o.data)}const n=await dnnService.getUserNames(e),s=await dnnService.getPendingNames(r);t({confirmedNames:n,pendingNames:s})}catch(r){console.error("[DnnStore] Failed to fetch names:",r)}finally{t({namesLoading:!1})}},refreshNodes:async()=>{t({nodesLoading:!0});try{await dnnService.checkNodes(),await dnnService.discoverPeers(),t({nodes:dnnService.getNodes()})}catch(e){console.error("[DnnStore] Failed to refresh nodes:",e)}finally{t({nodesLoading:!1})}},getOnlineNode:()=>dnnService.getOnlineNode()})),AcquireIdModal=({onClose:t,onOpenSend:e})=>jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 h-full",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800 max-w-md w-full",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Acquire a DNN ID"}),jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-amber-500/10 rounded-full flex items-center justify-center mx-auto",children:jsxRuntimeExports.jsx(Bitcoin,{className:"w-8 h-8 text-amber-500"})}),jsxRuntimeExports.jsx("div",{className:"text-center",children:jsxRuntimeExports.jsx("p",{className:"text-slate-300 leading-relaxed",children:"To acquire a new DNN ID, send Bitcoin to yourself (self-transfer) using your current address."})}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 rounded-lg p-4 border border-slate-800",children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-white mb-2",children:"Requirements:"}),jsxRuntimeExports.jsxs("ul",{className:"text-sm text-slate-400 space-y-2",children:[jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-0.5",children:""}),jsxRuntimeExports.jsxs("span",{children:["Minimum fee rate: ",jsxRuntimeExports.jsx("span",{className:"text-white font-medium",children:"1 sat/vB"})]})]}),jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-0.5",children:""}),jsxRuntimeExports.jsxs("span",{children:["Recipient: ",jsxRuntimeExports.jsx("span",{className:"text-white font-medium",children:"Your own address"})," (self-transfer)"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-0.5",children:""}),jsxRuntimeExports.jsxs("span",{children:["Confirmation time: ",jsxRuntimeExports.jsx("span",{className:"text-white font-medium",children:"~10 minutes"})]})]})]})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500 text-center",children:"After the transaction confirms, come back here to claim your DNN ID."})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 mt-6",children:[jsxRuntimeExports.jsx("button",{onClick:t,className:"flex-1 bg-slate-800 hover:bg-slate-700 text-white font-medium py-3 rounded-lg transition-colors",children:"Cancel"}),jsxRuntimeExports.jsxs("button",{onClick:e,className:"flex-1 bg-amber-500 hover:bg-amber-400 text-slate-950 font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2",children:["Open Send",jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4"})]})]})]})}),ClaimIdModal=({pendingName:t,onClose:e,onSuccess:r})=>{const[n,s]=reactExports.useState("intro"),[o,c]=reactExports.useState(0),[u,f]=reactExports.useState(""),[x,p]=reactExports.useState(""),[g,y]=reactExports.useState(""),{decryptedKey:b}=useAuthStore(),{relays:R}=useRelayStore(),D=()=>R.filter(Fe=>Fe.status==="connected").map(Fe=>Fe.url).slice(0,3),k=async Fe=>{const O=R.filter(W=>W.status==="connected");if(console.log("[ClaimIdModal] Publishing event kind",Fe.kind,"to",O.length,"relays"),console.log("[ClaimIdModal] Event ID:",Fe.id),O.length===0)throw console.error("[ClaimIdModal] No connected relays!"),new Error("No connected relays");const $e=O.map(async W=>{try{console.log("[ClaimIdModal] Opening WebSocket to",W.url);const We=new WebSocket(W.url);return new Promise(Xe=>{const it=setTimeout(()=>{console.warn("[ClaimIdModal] Timeout on",W.url),We.close(),Xe(!1)},5e3);We.onopen=()=>{console.log("[ClaimIdModal] WebSocket open, sending to",W.url),We.send(JSON.stringify(["EVENT",Fe]))},We.onmessage=Ve=>{try{const v=JSON.parse(Ve.data);if(console.log("[ClaimIdModal] Response from",W.url,":",v),v[0]==="OK"&&v[1]===Fe.id){clearTimeout(it),We.close();const I=v[2]===!0;console.log("[ClaimIdModal]",W.url,I?" SUCCESS":" FAILED",v[3]||""),Xe(I)}}catch{}},We.onerror=Ve=>{console.error("[ClaimIdModal] WebSocket error on",W.url,Ve),clearTimeout(it),Xe(!1)}})}catch(We){return console.error("[ClaimIdModal] Exception publishing to",W.url,We),!1}}),q=(await Promise.allSettled($e)).filter(W=>W.status==="fulfilled"&&W.value).length;return console.log("[ClaimIdModal] Published to",q,"/",O.length,"relays"),q>0},Re=async()=>{if(!b){p("No private key available. Please unlock your wallet."),s("error");return}s("publishing"),c(0),f("Preparing events...");try{const Fe=new Uint8Array(32);for(let L=0;L<32;L++)Fe[L]=parseInt(b.slice(L*2,L*2+2),16);const O=getPublicKey(Fe),$e=D(),ze=(t.format||"").split("-"),q=ze.length>1?ze[ze.length-1]:t.name||"";console.log("[ClaimIdModal] Claiming with desiredName:",q,"from format:",t.format);const{nameEvent:W,connectionEvent:We,metadataEvent:Xe,anchorEvent:it,dTags:Ve}=dnnService.generateClaimEvents(O,t.txid,q);c(10),f("Publishing Name Event (kind 61600)...");const v=finalizeEvent({...W,pubkey:O},Fe);await k(v)||console.warn("[ClaimIdModal] Name event may not have published to all relays"),c(25),f("Publishing Connection Event (kind 62600)...");const Ce=finalizeEvent({...We,pubkey:O},Fe);await k(Ce)||console.warn("[ClaimIdModal] Connection event may not have published to all relays"),c(50),f("Publishing Metadata Event (kind 63600)...");const _e=finalizeEvent({...Xe,pubkey:O},Fe);await k(_e)||console.warn("[ClaimIdModal] Metadata event may not have published to all relays"),c(75),f("Publishing Anchor Event (kind 60600)...");const Ye=dnnService.fillAnchorEvent(it,O,Ve,$e),je=finalizeEvent({...Ye,pubkey:O},Fe);if(!await k(je))throw new Error("Failed to publish anchor event");c(100),y(t.format||`n${t.dnnBlock}.${t.position}`),f("Claim complete!"),s("success")}catch(Fe){console.error("[ClaimIdModal] Claim failed:",Fe),p(Fe instanceof Error?Fe.message:"Unknown error occurred"),s("error")}};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 h-full",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800 max-w-md w-full",children:[n==="intro"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Claim Your DNN ID"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 rounded-lg p-4 border border-slate-800",children:[jsxRuntimeExports.jsx("p",{className:"text-slate-300 text-sm font-medium mb-2",children:"Your DNN ID:"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-amber-500 font-mono",children:t.format}),jsxRuntimeExports.jsxs("p",{className:"text-slate-400 text-xs mt-2",children:["DNN Block: ",t.dnnBlock,"  Position: ",t.position]})]}),jsxRuntimeExports.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:"To properly claim a DNN ID, you must publish four Nostr events. To make this quick and easy, we'll publish the first three events with empty values and then appropriately publish the fourth."}),jsxRuntimeExports.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3",children:jsxRuntimeExports.jsxs("p",{className:"text-amber-500 text-sm",children:[jsxRuntimeExports.jsx("strong",{children:"Events to publish:"})," 61600 (Name), 62600 (Connection), 63600 (Metadata), 60600 (Anchor)"]})})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 mt-6",children:[jsxRuntimeExports.jsx("button",{onClick:e,className:"flex-1 bg-slate-800 hover:bg-slate-700 text-white font-medium py-3 rounded-lg transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Re,className:"flex-1 bg-amber-500 hover:bg-amber-400 text-slate-950 font-bold py-3 rounded-lg transition-colors",children:"Claim"})]})]}),n==="publishing"&&jsxRuntimeExports.jsxs("div",{className:"text-center py-8",children:[jsxRuntimeExports.jsx(Loader,{className:"w-12 h-12 text-amber-500 animate-spin mx-auto mb-6"}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Publishing Events..."}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-sm mb-6",children:u}),jsxRuntimeExports.jsx("div",{className:"bg-slate-800 rounded-full h-3 overflow-hidden mb-2",children:jsxRuntimeExports.jsx("div",{className:"bg-amber-500 h-full transition-all duration-300",style:{width:`${o}%`}})}),jsxRuntimeExports.jsxs("p",{className:"text-slate-500 text-xs",children:[o,"% complete"]})]}),n==="success"&&jsxRuntimeExports.jsxs("div",{className:"text-center py-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-10 h-10 text-green-400"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"Congratulations!"}),jsxRuntimeExports.jsx("p",{className:"text-slate-300 mb-4",children:"You have claimed the DNN ID:"}),jsxRuntimeExports.jsx("div",{className:"bg-slate-950 rounded-lg p-4 border border-green-500/30 mb-6",children:jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-amber-500 font-mono",children:g})}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-sm mb-6 leading-relaxed",children:"You can now use this in your NIP-05 address field. DNN-supported Nostr clients will be able to identify it and make full use of its benefits. Visit a DNN node's dashboard to customize your DNN ID."}),jsxRuntimeExports.jsx("button",{onClick:r,className:"w-full bg-amber-500 hover:bg-amber-400 text-slate-950 font-bold py-3 rounded-lg transition-colors",children:"Close"})]}),n==="error"&&jsxRuntimeExports.jsxs("div",{className:"text-center py-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:jsxRuntimeExports.jsx(CircleAlert,{className:"w-10 h-10 text-red-400"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"Claim Failed"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 mb-4",children:x||"An error occurred while claiming your DNN ID."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:e,className:"flex-1 bg-slate-800 hover:bg-slate-700 text-white font-medium py-3 rounded-lg transition-colors",children:"Close"}),jsxRuntimeExports.jsx("button",{onClick:()=>s("intro"),className:"flex-1 bg-amber-500 hover:bg-amber-400 text-slate-950 font-bold py-3 rounded-lg transition-colors",children:"Try Again"})]})]})]})})};function promisifyRequest(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function createStore(t,e){let r;const n=()=>{if(r)return r;const s=indexedDB.open(t);return s.onupgradeneeded=()=>s.result.createObjectStore(e),r=promisifyRequest(s),r.then(o=>{o.onclose=()=>r=void 0},()=>{}),r};return(s,o)=>n().then(c=>o(c.transaction(e,s).objectStore(e)))}let defaultGetStoreFunc;function defaultGetStore(){return defaultGetStoreFunc||(defaultGetStoreFunc=createStore("keyval-store","keyval")),defaultGetStoreFunc}function get(t,e=defaultGetStore()){return e("readonly",r=>promisifyRequest(r.get(t)))}function set(t,e,r=defaultGetStore()){return r("readwrite",n=>(n.put(e,t),promisifyRequest(n.transaction)))}function del(t,e=defaultGetStore()){return e("readwrite",r=>(r.delete(t),promisifyRequest(r.transaction)))}class WebSecureStorage{async getItem(e){return await get(e)||null}async setItem(e,r){await set(e,r)}async removeItem(e){await del(e)}isHardwareBacked(){return!1}}let KeyStorePlugin=null;Capacitor.isNativePlatform()&&(KeyStorePlugin=registerPlugin("KeyStore"),console.log("[SecureStorage] KeyStore plugin registered"));class NativeSecureStorage{_keyStoreVerified=null;getPlugin(){if(!KeyStorePlugin)throw new Error("[KEYSTORE] CRITICAL: KeyStore plugin not available on native platform. This should never happen.");return KeyStorePlugin}async getItem(e){const r=this.getPlugin();try{console.log("[KEYSTORE] getItem:",e);const n=await r.getItem({key:e});return console.log("[KEYSTORE] getItem success:",e,n.value?"(has value)":"(empty)"),n.value||null}catch(n){throw console.error("[KEYSTORE] getItem FAILED:",e,n),new Error(`[KEYSTORE] Failed to retrieve key "${e}": ${n}`)}}async setItem(e,r){const n=this.getPlugin();try{console.log("[KEYSTORE] setItem:",e,`(${r.length} chars)`),await n.setItem({key:e,value:r}),console.log("[KEYSTORE] setItem success:",e)}catch(s){throw console.error("[KEYSTORE] setItem FAILED:",e,s),new Error(`[KEYSTORE] Failed to store key "${e}": ${s}`)}}async removeItem(e){const r=this.getPlugin();try{console.log("[KEYSTORE] removeItem:",e),await r.removeItem({key:e}),console.log("[KEYSTORE] removeItem success:",e)}catch(n){throw console.error("[KEYSTORE] removeItem FAILED:",e,n),new Error(`[KEYSTORE] Failed to remove key "${e}": ${n}`)}}isHardwareBacked(){return!0}async verifyKeyStoreWorking(){if(this._keyStoreVerified!==null)return console.log("[KEYSTORE] Verification: using cached result:",this._keyStoreVerified),this._keyStoreVerified;const e="__keystore_verification_test__",r="keystore_test_"+Date.now();try{console.log("[KEYSTORE] Verification: starting...");const n=this.getPlugin();console.log("[KEYSTORE] Verification: writing test value..."),await n.setItem({key:e,value:r}),console.log("[KEYSTORE] Verification: reading test value...");const s=await n.getItem({key:e});console.log("[KEYSTORE] Verification: cleaning up..."),await n.removeItem({key:e});const o=s.value===r;return console.log("[KEYSTORE] Verification:",o?"SUCCESS ":"FAILED - value mismatch"),this._keyStoreVerified=o,o}catch(n){return console.error("[KEYSTORE] Verification: FAILED with error:",n),this._keyStoreVerified=!1,!1}}}const SecureStorage=Capacitor.isNativePlatform()?new NativeSecureStorage:new WebSecureStorage,nativeStorage=Capacitor.isNativePlatform()?new NativeSecureStorage:null;async function getActualStorageType(){if(!Capacitor.isNativePlatform())return"indexeddb";try{const t=new Promise((n,s)=>setTimeout(()=>s(new Error("KeyStore verification timeout")),3e3)),e=nativeStorage?nativeStorage.verifyKeyStoreWorking():Promise.resolve(!1);return await Promise.race([e,t])?"keystore":"indexeddb"}catch(t){return console.error("[SecureStorage] Verification failed/timed out:",t),"unknown"}}const ActiveKeypairCard=({onSwitchKeypair:t,showQrButton:e=!0,onToast:r})=>{const{wallets:n,currentWalletId:s,currentKeypairId:o,updateKeypair:c}=useWalletStore(),u=n.find(Ce=>Ce.id===s),f=u?.keypairs.find(Ce=>Ce.id===o),{initializeService:x}=useDnnStore(),[p,g]=reactExports.useState(!1),[y,b]=reactExports.useState(null),[R,D]=reactExports.useState("nip05"),[k,Re]=reactExports.useState(null),[Fe,O]=reactExports.useState(null),[$e,ze]=reactExports.useState(!1),[q,W]=reactExports.useState(!1),[We,Xe]=reactExports.useState("checking"),it=f?.profile?.nip05||"",Ve=it&&!it.includes("@");reactExports.useEffect(()=>{x().then(()=>{W(!0)})},[]),reactExports.useEffect(()=>{getActualStorageType().then(Ce=>{Xe(Ce)})},[]),reactExports.useEffect(()=>{if(!it||!f?.npub){Re(null),O(null),it||D("npub");return}if(!(Ve&&!q))if(ze(!0),Re(null),O(null),Ve)dnnService.verifyDnnId(it,f.npub).then(Ce=>{O(Ce),ze(!1)}).catch(()=>{O(!1),ze(!1)});else{const[Ce,P]=it.split("@");Ce&&P?fetch(`https://${P}/.well-known/nostr.json?name=${Ce}`).then(_e=>_e.json()).then(_e=>{const Le=(()=>{try{const K=require("bech32-buffer").decode(f.npub);return Buffer.from(K.data).toString("hex")}catch{return f.npub}})(),Ye=_e.names?.[Ce]===Le;Re(Ye),ze(!1)}).catch(()=>{Re(!1),ze(!1)}):(Re(!1),ze(!1))}},[it,f?.npub,q,Ve]);const v=Ce=>{r?r(Ce):(b(Ce),setTimeout(()=>b(null),2e3))},I=async Ce=>{if(Ce.stopPropagation(),!f||!u)return;const P=Ce.currentTarget;P.classList.add("opacity-50");try{const{ProfileService:_e}=await __vitePreload(async()=>{const{ProfileService:Ye}=await Promise.resolve().then(()=>profile);return{ProfileService:Ye}},void 0,import.meta.url),Le=await _e.fetchProfile(f.npub);Le&&(c(u.id,f.id,{profile:{...Le,lastFetched:Date.now()}}),v("Profile refreshed!"))}catch(_e){console.error("[ActiveKeypairCard] Failed to refresh profile:",_e)}finally{P.classList.remove("opacity-50")}};return f?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800 flex items-center gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"relative rounded-lg bg-amber-500 text-slate-950 flex-shrink-0 overflow-hidden cursor-pointer group w-10 h-10",onClick:I,title:"Click to refresh profile",children:[f.profile?.picture?jsxRuntimeExports.jsx("img",{src:f.profile.picture,alt:f.profile.name||"Profile",className:"w-full h-full object-cover",onError:Ce=>{Ce.target.style.display="none"}}):null,jsxRuntimeExports.jsx("div",{className:`w-full h-full flex items-center justify-center bg-amber-500 ${f.profile?.picture?"hidden":""}`,children:jsxRuntimeExports.jsx(User,{className:"w-6 h-6 text-slate-950"})}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100",children:jsxRuntimeExports.jsx(RefreshCw,{className:"w-4 h-4 text-white"})})]}),jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-lg truncate",children:f.profile?.name||f.name}),jsxRuntimeExports.jsx("button",{onClick:t,className:"p-1 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",title:"Switch Address",children:jsxRuntimeExports.jsx(ArrowRightLeft,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-500 text-xs rounded-full flex-shrink-0",children:"Active"}),We==="checking"?jsxRuntimeExports.jsx(Loader,{className:"w-3 h-3 text-slate-400 animate-spin flex-shrink-0"}):We==="keystore"?jsxRuntimeExports.jsxs("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-400 text-xs rounded-full flex-shrink-0 flex items-center gap-1",children:[jsxRuntimeExports.jsx(Shield,{className:"w-3 h-3"}),"KeyStore"]}):We==="unknown"?jsxRuntimeExports.jsxs("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded-full flex-shrink-0 flex items-center gap-1",title:"Could not verify storage type",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-3 h-3"}),"Unknown"]}):jsxRuntimeExports.jsxs("span",{className:"px-2 py-0.5 bg-slate-600/20 text-slate-400 text-xs rounded-full flex-shrink-0 flex items-center gap-1",children:[jsxRuntimeExports.jsx(Database,{className:"w-3 h-3"}),"IndexedDB"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[it&&jsxRuntimeExports.jsx("button",{onClick:()=>D(Ce=>Ce==="nip05"?"npub":"nip05"),className:"p-1.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors flex-shrink-0",title:R==="nip05"?"Show npub":"Show NIP-05/DNN",children:jsxRuntimeExports.jsx(Repeat,{className:"w-3.5 h-3.5"})}),R==="nip05"&&it?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 flex-1 min-w-0",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-300 truncate",children:Ve?`@${it}`:it}),$e?jsxRuntimeExports.jsx(Loader,{className:"w-3.5 h-3.5 text-slate-400 animate-spin flex-shrink-0"}):Ve?Fe===!0?jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-3.5 h-3.5 text-green-400 flex-shrink-0"}):Fe===!1?jsxRuntimeExports.jsx(TriangleAlert,{className:"w-3.5 h-3.5 text-amber-500 flex-shrink-0"}):null:k===!0?jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-3.5 h-3.5 text-green-400 flex-shrink-0"}):k===!1?jsxRuntimeExports.jsx(TriangleAlert,{className:"w-3.5 h-3.5 text-amber-500 flex-shrink-0"}):null]}):jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-400 font-mono truncate flex-1",children:f.npub.length>16?`${f.npub.slice(0,8)}...${f.npub.slice(-6)}`:f.npub}),jsxRuntimeExports.jsx("button",{onClick:()=>{const Ce=R==="nip05"&&it?it:f.npub;navigator.clipboard.writeText(Ce),v(`Copied: ${Ce.slice(0,20)}...`)},className:"p-1.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors flex-shrink-0",title:R==="nip05"&&it?"Copy NIP-05/DNN":"Copy npub",children:jsxRuntimeExports.jsx(Copy,{className:"w-3.5 h-3.5"})}),e&&jsxRuntimeExports.jsx("button",{onClick:()=>g(!0),className:"p-1.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors flex-shrink-0",title:"Show QR code",children:jsxRuntimeExports.jsx(QrCode,{className:"w-3.5 h-3.5"})})]})]})]}),p&&f&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 h-full",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-sm w-full border border-slate-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold",children:"Your Npub"}),jsxRuntimeExports.jsx("button",{onClick:()=>g(!1),className:"p-2 hover:bg-slate-800 rounded-lg",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-white p-4 rounded-xl",children:jsxRuntimeExports.jsx(QRCodeSVG,{value:f.npub,size:200})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-400 font-mono text-center break-all",children:f.npub})]})]})}),y&&jsxRuntimeExports.jsx("div",{className:"fixed bottom-24 left-1/2 transform -translate-x-1/2 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-800 text-white px-4 py-2 rounded-full shadow-lg border border-slate-700 flex items-center gap-2",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4 text-green-400"}),jsxRuntimeExports.jsx("span",{className:"text-sm",children:y})]})})]}):null},toCamelCase=t=>t?t.replace(/-([a-z])/g,(e,r)=>r.toUpperCase()):"",IdsView=({onSwitchKeypair:t,onNavigateToWallet:e})=>{const{wallets:r,currentWalletId:n,currentKeypairId:s}=useWalletStore(),c=r.find(_e=>_e.id===n)?.keypairs.find(_e=>_e.id===s),{confirmedNames:u,pendingNames:f,namesLoading:x,nodesLoading:p,initializeService:g,fetchUserNames:y,refreshNodes:b}=useDnnStore(),[R,D]=reactExports.useState(!1),[k,Re]=reactExports.useState(!1),[Fe,O]=reactExports.useState(!1),[$e,ze]=reactExports.useState(null),[q,W]=reactExports.useState(null),[We,Xe]=reactExports.useState("confirmed"),[it,Ve]=reactExports.useState(!1);reactExports.useEffect(()=>{g().then(()=>{Ve(!0)})},[]),reactExports.useEffect(()=>{it&&c?.npub&&y(c.npub)},[it,c?.npub,c?.id]),reactExports.useEffect(()=>{const _e=async()=>{console.log("[IdsView] Network restored, reconnecting DNN nodes..."),await b(),c?.npub&&await y(c.npub)};return window.addEventListener("online",_e),()=>window.removeEventListener("online",_e)},[c?.npub,b,y]);const v=async()=>{await b(),c?.npub&&await y(c.npub)},I=_e=>{ze(_e),Re(!0)},Ce=u.length+f.length,P=Ce===0&&!x;return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx(ActiveKeypairCard,{onSwitchKeypair:t,onToast:_e=>W(_e)}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-white",children:"DNN IDs"}),jsxRuntimeExports.jsx("button",{onClick:()=>O(!0),className:"px-2 py-0.5 text-xs font-bold text-amber-500 bg-amber-500/10 border border-amber-500/30 rounded hover:bg-amber-500/20 transition-colors",children:"READ ME"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:v,disabled:x||p,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors disabled:opacity-50",title:"Refresh",children:jsxRuntimeExports.jsx(RefreshCw,{className:`w-5 h-5 ${x||p?"animate-spin":""}`})}),jsxRuntimeExports.jsxs("button",{onClick:()=>D(!0),className:"flex items-center gap-2 bg-amber-500 hover:bg-amber-400 text-slate-950 font-medium px-4 py-2 rounded-lg transition-colors",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"}),"Add ID"]})]})]}),x&&Ce===0&&jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx(Loader,{className:"w-8 h-8 text-amber-500 animate-spin"})}),P&&jsxRuntimeExports.jsxs("div",{className:"text-center py-12 bg-slate-900/50 rounded-xl border border-slate-800",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-slate-800 flex items-center justify-center",children:jsxRuntimeExports.jsx(User,{className:"w-8 h-8 text-slate-600"})}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 mb-4",children:"No DNN IDs yet"}),jsxRuntimeExports.jsxs("button",{onClick:()=>D(!0),className:"inline-flex items-center gap-2 bg-amber-500 hover:bg-amber-400 text-slate-950 font-medium px-4 py-2 rounded-lg transition-colors",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"}),"Get Your First ID"]})]}),!P&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-4 border-b border-slate-800",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>Xe("confirmed"),className:`pb-2 text-sm font-medium transition-colors grow ${We==="confirmed"?"text-amber-500 border-b-2 border-amber-500":"text-slate-400 hover:text-white"}`,children:["Confirmed (",u.length,")"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>Xe("pending"),className:`pb-2 text-sm font-medium transition-colors grow ${We==="pending"?"text-amber-500 border-b-2 border-amber-500":"text-slate-400 hover:text-white"}`,children:["Pending (",f.length,")"]})]}),We==="confirmed"&&jsxRuntimeExports.jsx("div",{className:"space-y-2",style:{maxHeight:"calc(100vh - 430px)",overflowY:"auto"},children:u.length===0?jsxRuntimeExports.jsx("p",{className:"text-center text-slate-400 py-8",children:"No confirmed IDs"}):u.map((_e,Le)=>jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-white",children:toCamelCase(_e.dnnId||"")}),_e.status==="confirmed"&&jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4 text-green-400"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{navigator.clipboard.writeText(toCamelCase(_e.dnnId||"")),W("ID copied!"),setTimeout(()=>W(null),2e3)},className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:["DNN Block: ",_e.dnnBlock,"  Position: ",_e.position]})]},Le))}),We==="pending"&&jsxRuntimeExports.jsx("div",{className:"space-y-2",style:{maxHeight:"calc(100vh - 430px)",overflowY:"auto"},children:f.length===0?jsxRuntimeExports.jsx("p",{className:"text-center text-slate-400 py-8",children:"No pending IDs"}):f.map((_e,Le)=>jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-amber-500/30",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(Clock,{className:"w-4 h-4 text-amber-500"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-white",children:toCamelCase(_e.dnnId||"")})]}),jsxRuntimeExports.jsx("button",{onClick:()=>I(_e),className:"px-3 py-1 bg-amber-500 hover:bg-amber-400 text-slate-950 text-sm font-medium rounded-lg transition-colors",children:"Claim"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Ready to claim on-chain"})]},Le))})]}),R&&c&&jsxRuntimeExports.jsx(AcquireIdModal,{onClose:()=>D(!1),onOpenSend:()=>{D(!1),e(c.npub,1)}}),k&&$e&&c&&jsxRuntimeExports.jsx(ClaimIdModal,{pendingName:$e,onClose:()=>{Re(!1),ze(null)},onSuccess:()=>{Re(!1),ze(null),c?.npub&&y(c.npub)}}),Fe&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-md w-full border border-slate-800 shadow-2xl",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 bg-amber-500/10 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(TriangleAlert,{className:"w-6 h-6 text-amber-500"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-white",children:"DNN Early Development"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 rounded-xl p-4 border border-slate-800 mb-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-slate-300 text-sm leading-relaxed mb-3",children:["DNN (Decentralized Naming Network) is still in ",jsxRuntimeExports.jsx("strong",{className:"text-amber-400",children:"early development"})," and actively being tested."]}),jsxRuntimeExports.jsxs("p",{className:"text-slate-400 text-sm leading-relaxed",children:["Things will change and you will ",jsxRuntimeExports.jsx("strong",{children:"most likely not keep"})," the IDs you acquire during this testing phase. The network may be reset, names may be reassigned, and features may change significantly."]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>O(!1),className:"w-full py-3 bg-amber-500 hover:bg-amber-400 text-slate-950 font-bold rounded-xl transition-colors",children:"I Understand"})]})}),q&&jsxRuntimeExports.jsx("div",{className:"fixed bottom-24 left-1/2 transform -translate-x-1/2 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-800 text-white px-4 py-2 rounded-full shadow-lg border border-slate-700 flex items-center gap-2",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4 text-green-400"}),jsxRuntimeExports.jsx("span",{className:"text-sm",children:q})]})})]})},TipModal=({isOpen:t,onClose:e,utxos:r,onSuccess:n,initialRecipientBtc:s,initialRecipientNpub:o})=>{const[c,u]=reactExports.useState(null);return t?c?c==="bitcoin"?jsxRuntimeExports.jsx(SendModal,{isOpen:!0,onClose:e,utxos:r,onSuccess:n,initialRecipient:s,hideFollowsSelector:!0,hideSendToSelf:!0}):c==="ecash"?jsxRuntimeExports.jsx(EcashSendModal,{isOpen:!0,onClose:e,initialRecipient:o,hideFollowsSelector:!0,forcePublic:!0}):null:jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-md shadow-2xl p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Tip Developer"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Choose your preferred method to support PWANS development:"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>u("bitcoin"),className:"flex-1 flex flex-col items-center gap-3 p-6 bg-slate-950 hover:bg-slate-800 border border-slate-800 hover:border-amber-500/50 rounded-xl transition-all group",children:[jsxRuntimeExports.jsx(Bitcoin,{className:"w-8 h-8 text-amber-500"}),jsxRuntimeExports.jsx("span",{className:"font-bold text-white",children:"Bitcoin"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-400 text-center",children:"Send on-chain Bitcoin"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>u("ecash"),className:"flex-1 flex flex-col items-center gap-3 p-6 bg-slate-950 hover:bg-slate-800 border border-slate-800 hover:border-purple-500/50 rounded-xl transition-all group",children:[jsxRuntimeExports.jsx(Coins,{className:"w-8 h-8 text-purple-500"}),jsxRuntimeExports.jsx("span",{className:"font-bold text-white",children:"eCash"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-400 text-center",children:"Send via Cashu"})]})]}),jsxRuntimeExports.jsx("button",{onClick:e,className:"w-full mt-4 px-4 py-2 bg-slate-800 hover:bg-slate-700 text-white rounded-lg transition-colors",children:"Cancel"})]})}):null},About=({onBack:t,onNavigateChangelog:e,onSettings:r})=>{const[n,s]=reactExports.useState(null),[o,c]=reactExports.useState(!1),[u,f]=reactExports.useState(""),[x,p]=reactExports.useState(!1),[g,y]=reactExports.useState(!1),[b,R]=reactExports.useState(!1),[D,k]=reactExports.useState(!1),[Re,Fe]=reactExports.useState([]),{eventCreatorMode:O,toggleEventCreatorMode:$e}=useSettingsStore(),[ze,q]=reactExports.useState(0),[W,We]=reactExports.useState(0),[Xe,it]=reactExports.useState(()=>localStorage.getItem("dev-mode")==="true"),Ve="npub18n4ysp43ux5c98fs6h9c57qpr4p8r3j8f6e32v0vj8egzy878aqqyzzk9r",{currentKeypairId:v,wallets:I,currentWalletId:Ce}=useWalletStore(),_e=I.find(K=>K.id===Ce)?.keypairs.find(K=>K.id===v);reactExports.useEffect(()=>{ProfileService.fetchProfile(Ve).then(s);try{const K=npubToBitcoinAddress(Ve);f(K)}catch{console.error("Failed to derive dev BTC address")}},[]),reactExports.useEffect(()=>{if(o&&_e)try{const K=npubToBitcoinAddress(_e.npub);fetchUTXOs(K).then(Fe)}catch(K){console.error(K)}},[o,_e]);const Le=(K,L)=>{navigator.clipboard.writeText(K),L(!0),setTimeout(()=>L(!1),2e3)},Ye=(K,L=8)=>K.length<=L*2?K:`${K.slice(0,L)}...${K.slice(-L)}`,je=()=>{const K=Date.now();if(K-W>5e3){q(1),We(K);return}const st=ze+1;if(q(st),We(K),st===5){const dt=!Xe;if(it(dt),localStorage.setItem("dev-mode",dt.toString()),dt)__vitePreload(()=>import("./eruda-tYmFxyrI.js").then(Je=>Je.e),[],import.meta.url).then(Je=>{Je.default.init(),console.log("[DevMode] Eruda console enabled")});else if(window.eruda){try{typeof window.eruda.destroy=="function"&&window.eruda.destroy()}catch(Je){console.warn("[DevMode] Eruda destroy failed:",Je)}setTimeout(()=>{const Je=document.getElementById("eruda");Je&&Je.remove()},100),console.log("[DevMode] Eruda console disabled")}q(0)}};return reactExports.useEffect(()=>{Xe&&__vitePreload(()=>import("./eruda-tYmFxyrI.js").then(K=>K.e),[],import.meta.url).then(K=>{K.default.init()})},[]),jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-slate-950 text-white p-4",children:[jsxRuntimeExports.jsxs("div",{className:"w-full mx-auto space-y-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-6 h-6 text-slate-400"})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold",children:"About"})]}),jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"text-center space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 mx-auto bg-slate-900 rounded-2xl flex items-center justify-center border border-slate-800 shadow-xl overflow-hidden",children:jsxRuntimeExports.jsx("img",{src:"./pwa-192x192.png",alt:"PWANS Logo",className:"w-full h-full object-cover"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-amber-500",children:"PWANS"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Progressive Web App Nostr Signer"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800 text-center",children:[jsxRuntimeExports.jsxs("p",{className:"text-slate-300 mb-4",children:[jsxRuntimeExports.jsx("strong",{children:"PWANS"})," is a Progressive Web App Nostr Signer."]}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"It stores your nsec/keypair locally on your device and allows other Nostr applications to connect and sign events remotely via NIP-46. It also bridges Nostr to the real world with Bitcoin seamlessly"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-amber-500 text-sm",children:"Native Android App"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-400 mt-1 mb-3",children:"Get the native version from ZapStore for enhanced security with hardware-backed KeyStore."}),jsxRuntimeExports.jsx("button",{onClick:()=>window.open("https://zapstore.dev/apps?q=pwans","_blank"),className:"w-full py-2.5 bg-[#4A90D9] hover:bg-[#5BA0E9] text-white font-bold rounded-lg transition-colors",children:"Get on ZapStore"})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 border border-slate-800",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-bold text-slate-500 uppercase tracking-wider mb-4 text-center",children:"Vibe Coded By"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-slate-800 overflow-hidden border-2 border-amber-500/20",children:n?.picture?jsxRuntimeExports.jsx("img",{src:n.picture,alt:"Dev",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-500 text-2xl font-bold",children:"?"})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h4",{className:"font-bold text-lg text-white",children:n?.name||"Unknown Developer"}),n?.nip05&&jsxRuntimeExports.jsxs("div",{className:"text-amber-500 text-sm flex items-center justify-center gap-1",children:[jsxRuntimeExports.jsx("span",{children:n.nip05}),jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-3 h-3"})]})]}),jsxRuntimeExports.jsxs("div",{className:"w-full space-y-3 mt-2",children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 rounded-xl p-3 border border-slate-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-1",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-500 font-bold",children:"Nostr Public Key"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-1",children:[jsxRuntimeExports.jsx("button",{onClick:()=>R(!b),className:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-white transition-colors",children:jsxRuntimeExports.jsx(QrCode,{className:"w-3.5 h-3.5"})}),jsxRuntimeExports.jsx("button",{onClick:()=>Le(Ve,p),className:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-white transition-colors",children:x?jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-3.5 h-3.5 text-green-500"}):jsxRuntimeExports.jsx(Copy,{className:"w-3.5 h-3.5"})})]})]}),b?jsxRuntimeExports.jsx("div",{className:"flex justify-center py-2 bg-white rounded-lg mb-2",children:jsxRuntimeExports.jsx(QRCodeSVG,{value:Ve,size:150})}):jsxRuntimeExports.jsx("div",{className:"font-mono text-xs text-slate-300 text-center break-all",children:Ye(Ve,12)})]}),u&&jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 rounded-xl p-3 border border-slate-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-1",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-500 font-bold",children:"Bitcoin Address"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-1",children:[jsxRuntimeExports.jsx("button",{onClick:()=>k(!D),className:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-white transition-colors",children:jsxRuntimeExports.jsx(QrCode,{className:"w-3.5 h-3.5"})}),jsxRuntimeExports.jsx("button",{onClick:()=>Le(u,y),className:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-white transition-colors",children:g?jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-3.5 h-3.5 text-green-500"}):jsxRuntimeExports.jsx(Copy,{className:"w-3.5 h-3.5"})})]})]}),D?jsxRuntimeExports.jsx("div",{className:"flex justify-center py-2 bg-white rounded-lg mb-2",children:jsxRuntimeExports.jsx(QRCodeSVG,{value:u,size:150})}):jsxRuntimeExports.jsx("div",{className:"font-mono text-xs text-amber-500/80 text-center break-all",children:Ye(u,12)})]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>c(!0),className:"w-full py-3 bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white font-bold rounded-xl shadow-lg shadow-amber-500/20 transition-all flex items-center justify-center gap-2 mt-2",children:[jsxRuntimeExports.jsx(Heart,{className:"w-5 h-5 fill-white"}),"Tip Developer"]})]})]}),r&&jsxRuntimeExports.jsxs("button",{onClick:r,className:"w-full bg-slate-900 rounded-xl p-4 border border-slate-800 hover:bg-slate-800 transition-colors flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center",children:jsxRuntimeExports.jsx(Settings$1,{className:"w-5 h-5 text-slate-400"})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-white",children:"Settings"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-400",children:"Background service & battery"})]})]}),jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-slate-500 rotate-180"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center pb-8 space-y-3",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center mb-6",children:jsxRuntimeExports.jsxs("button",{onClick:()=>$e(),className:"bg-slate-900 border border-slate-800 rounded-lg p-4 flex items-center gap-4 transition-colors hover:bg-slate-800",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Event Creator Mode"}),jsxRuntimeExports.jsx("div",{className:`relative w-14 h-7 rounded-md transition-all duration-300 ${O?"bg-gradient-to-r from-amber-500 to-amber-600":"bg-gradient-to-r from-slate-600 to-slate-700"}`,children:jsxRuntimeExports.jsx("div",{className:`absolute top-0.5 left-0.5 w-6 h-6 bg-white rounded-md shadow-lg transition-all duration-300 flex items-center justify-center ${O?"translate-x-7":"translate-x-0"}`,children:O?jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-slate-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]})}),jsxRuntimeExports.jsxs("p",{className:"text-slate-500 text-xs max-w-xs mx-auto leading-relaxed",children:[jsxRuntimeExports.jsx("strong",{children:"Disclaimer:"})," PWANS and its creator(s) hold no responsibility for any lost or compromised accounts or funds. The user holds full responsibility for how they use this app"]}),jsxRuntimeExports.jsxs("p",{className:"text-slate-600 text-xs font-mono cursor-pointer select-none",onClick:je,children:["v1.0.3 ",Xe&&""]}),jsxRuntimeExports.jsx("button",{onClick:e,className:"text-amber-500 text-xs hover:text-amber-400 transition-colors underline",children:"Changelog"})]})]})]}),o&&jsxRuntimeExports.jsx(TipModal,{isOpen:o,onClose:()=>c(!1),utxos:Re,onSuccess:()=>c(!1),initialRecipientBtc:u,initialRecipientNpub:Ve})]})},BatteryOptimization=registerPlugin("BatteryOptimization");class BatteryService{static async isOptimizationDisabled(){try{return(await BatteryOptimization.isIgnoringBatteryOptimizations()).isIgnoring}catch(e){return console.error("[BatteryService] Failed to check optimization status:",e),!1}}static async requestOptimizationExemption(){try{const e=await BatteryOptimization.requestIgnoreBatteryOptimization();e.alreadyIgnoring?console.log("[BatteryService] Already exempt from battery optimization"):e.notRequired?console.log("[BatteryService] Battery optimization not applicable on this device"):console.log("[BatteryService] Battery optimization dialog opened")}catch(e){console.error("[BatteryService] Failed to request exemption:",e)}}static async openSettings(){try{await BatteryOptimization.openBatteryOptimizationSettings()}catch(e){console.error("[BatteryService] Failed to open settings:",e)}}}const BackgroundService=Capacitor.isNativePlatform()?registerPlugin("BackgroundService"):null,BATTERY_OPT_PROMPTED_KEY="pwans_battery_opt_prompted";async function startBackgroundService(){if(!BackgroundService)return console.log("[BackgroundService] Not on native platform, skipping"),!1;try{return await BackgroundService.startService(),console.log("[BackgroundService] Started successfully"),localStorage.getItem(BATTERY_OPT_PROMPTED_KEY)||(await BatteryService.isOptimizationDisabled()||(console.log("[BackgroundService] First run, prompting for battery optimization"),await BatteryService.requestOptimizationExemption()),localStorage.setItem(BATTERY_OPT_PROMPTED_KEY,"true")),!0}catch(t){return console.error("[BackgroundService] Failed to start:",t),!1}}async function stopBackgroundService(){if(!BackgroundService)return!1;try{return await BackgroundService.stopService(),console.log("[BackgroundService] Stopped successfully"),!0}catch(t){return console.error("[BackgroundService] Failed to stop:",t),!1}}async function isBackgroundServiceRunning(){if(!BackgroundService)return!1;try{return(await BackgroundService.isServiceRunning()).running}catch(t){return console.error("[BackgroundService] Failed to check status:",t),!1}}const backgroundService=Object.freeze(Object.defineProperty({__proto__:null,isBackgroundServiceRunning,startBackgroundService,stopBackgroundService},Symbol.toStringTag,{value:"Module"})),Settings=({onBack:t})=>{const[e,r]=reactExports.useState(!1),[n,s]=reactExports.useState(!1),[o,c]=reactExports.useState(!1),[u,f]=reactExports.useState(!0),x=Capacitor.isNativePlatform();reactExports.useEffect(()=>{p()},[]);const p=async()=>{f(!0);try{if(x){const[R,D,k]=await Promise.all([BatteryService.isOptimizationDisabled(),isBackgroundServiceRunning(),isSilentAudioRunning()]);r(R),s(D),c(k)}}catch(R){console.error("[Settings] Failed to check statuses:",R)}finally{f(!1)}},g=async()=>{await BatteryService.requestOptimizationExemption(),setTimeout(p,1e3)},y=async()=>{n?await stopBackgroundService():await startBackgroundService(),await p()},b=async()=>{o?await stopSilentAudio():await startSilentAudio(),await p()};return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-slate-950 text-white p-4",children:jsxRuntimeExports.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-slate-400"})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold",children:"Settings"})]}),x?jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${n?"bg-amber-500/20":"bg-slate-800"}`,children:jsxRuntimeExports.jsx(Wifi,{className:`w-5 h-5 ${n?"text-amber-500":"text-slate-500"}`})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-white",children:"Background Service"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-400",children:"Keep connections alive when app is hidden"})]})]}),jsxRuntimeExports.jsx("button",{onClick:y,disabled:u,className:`relative w-12 h-6 rounded-full transition-colors ${n?"bg-amber-500":"bg-slate-700"}`,children:jsxRuntimeExports.jsx("div",{className:`absolute top-1 w-4 h-4 rounded-full bg-white transition-all ${n?"right-1":"left-1"}`})})]})}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${o?"bg-purple-500/20":"bg-slate-800"}`,children:jsxRuntimeExports.jsx(Volume2,{className:`w-5 h-5 ${o?"text-purple-500":"text-slate-500"}`})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-white",children:"Anti-Doze Mode"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-400",children:o?"Playing silent audio - max protection":"Optional: Prevents aggressive battery saving"})]})]}),jsxRuntimeExports.jsx("button",{onClick:b,disabled:u,className:`relative w-12 h-6 rounded-full transition-colors ${o?"bg-purple-500":"bg-slate-700"}`,children:jsxRuntimeExports.jsx("div",{className:`absolute top-1 w-4 h-4 rounded-full bg-white transition-all ${o?"right-1":"left-1"}`})})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mt-3",children:"Plays inaudible audio to prevent Android from killing the app. Use if other methods don't work on your device."})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${e?"bg-green-500/20":"bg-amber-500/20"}`,children:jsxRuntimeExports.jsx(Battery,{className:`w-5 h-5 ${e?"text-green-500":"text-amber-500"}`})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-white",children:"Battery Optimization"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-400",children:e?"Standard exemption active":"Enabled - may kill connections"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[!e&&jsxRuntimeExports.jsx("button",{onClick:g,disabled:u,className:"text-xs text-amber-500 font-medium px-3 py-1.5 bg-amber-500/10 rounded hover:bg-amber-500/20 transition-colors",children:"Fix"}),jsxRuntimeExports.jsx("button",{onClick:async()=>{await BatteryService.openSettings(),setTimeout(p,2e3)},disabled:u,className:"text-xs text-blue-400 font-medium px-3 py-1.5 bg-blue-500/10 rounded hover:bg-blue-500/20 transition-colors",children:"Settings"})]})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-500 mt-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500",children:"Samsung/Xiaomi:"}),' The standard exemption may not work. Tap "Settings"  Battery  set to "Unrestricted"']})]}),jsxRuntimeExports.jsx("div",{className:"bg-slate-950 rounded-xl p-4 border border-slate-800",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 leading-relaxed",children:"For reliable background operation, enable all three: Background Service, Accessibility Service, and Battery Optimization exemption. This ensures you receive signing requests even when the app is not in focus."})})]}):jsxRuntimeExports.jsxs("div",{className:"w-full bg-slate-900 rounded-xl p-6 border border-slate-800 text-center",children:[jsxRuntimeExports.jsx(Settings$1,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400",children:"Background settings are only available on the native Android app."})]})]})})},Changelog=({onBack:t})=>jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-slate-950 text-white p-4",children:[jsxRuntimeExports.jsxs("header",{className:"flex items-center gap-4 mb-8 border-b border-slate-800 pb-4",children:[jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-amber-500",children:"Changelog"})]}),jsxRuntimeExports.jsxs("div",{className:"max-w-2xl mx-auto space-y-8",children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-amber-500",children:"v1.0.3"}),jsxRuntimeExports.jsxs("div",{className:"relative flex items-center justify-center",children:[jsxRuntimeExports.jsx("div",{className:"absolute w-3 h-3 bg-green-500 rounded-full animate-ping opacity-75"}),jsxRuntimeExports.jsx("div",{className:"relative w-2 h-2 bg-green-500 rounded-full"})]}),jsxRuntimeExports.jsx("span",{className:"text-sm text-slate-400",children:"Latest"})]}),jsxRuntimeExports.jsx("p",{className:"text-slate-500 text-xs mb-4",children:"06 January 2026"}),jsxRuntimeExports.jsxs("ul",{className:"space-y-3 text-slate-300",children:[jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Native Android App:"})," PWANS is now available as a native Android app via ZapStore, featuring hardware-backed KeyStore security for your private keys"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"DNN Support:"})," Native integration for Decentralized Name/ID registration and claiming. Acquire and manage DNN IDs directly from PWANS"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"NIP-UPV2 Login:"})," Login to Nostr clients that support UPV2 using your DNN ID (or npub) and password - a traditional username/password experience, evolved for the Nostr age"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Reorganized Scanner UI:"})," Connection options are now within the camera scan modal for a more compact, streamlined experience"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Smart QR Detection:"})," The main scanner now intelligently detects Bitcoin addresses, npubs, and Lightning invoices, automatically routing you to the appropriate action (send Bitcoin, eCash, or pay invoice)"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Auto-Reconnect:"})," Force reconnects to Nostr relays, subscriptions, and WebSockets when the app becomes active again, ensuring reliable connectivity"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Auto-Approve Everything:"})," The ability to toggle on 'auto-approve everything' per connections (It won't auto-approve auto-blockers of a specific kind)"]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800",children:[jsxRuntimeExports.jsx("p",{className:"text-slate-300 text-center mb-4",children:"Appreciate this release? Want to help feed the dev(s) behind it?"}),jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsxs("button",{onClick:t,className:"bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold py-3 px-6 rounded-lg transition-colors flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{children:""}),"Support"]})})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-bold text-amber-500 mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{children:""}),"Future Scope"]}),jsxRuntimeExports.jsx("p",{className:"text-slate-400 text-xs mb-4",children:"Potential features that might come in future updates (no promises!)"}),jsxRuntimeExports.jsxs("ul",{className:"space-y-3 text-slate-300",children:[jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-slate-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Hardware Wallet Support:"})," Integration with hardware wallets for storing seeds/keys and signing operations, providing enhanced security by keeping private keys isolated in dedicated hardware"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-slate-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Secure Enclave Integration:"})," Support for communicating with specialized apps that create secure enclaves to store seeds/keys and perform signing operations, where PWANS sends signing requests and receives signed results without direct key access"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-slate-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Bitcoin Cold Signing:"})," Offline signing of Bitcoin transactions similarly to Nostr events"]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center gap-3 mb-4",children:jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-slate-400",children:"v1.0.2"})}),jsxRuntimeExports.jsx("p",{className:"text-slate-500 text-xs mb-4",children:"12 December 2025"}),jsxRuntimeExports.jsxs("ul",{className:"space-y-3 text-slate-300",children:[jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"eCash Wallet:"})," Full Cashu implementation with NutZap support for public ecash transfers over Nostr, private token sends, and Lightning integration for seamless on/off-ramping"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Multi-Mint Support:"})," Manage funds across multiple Cashu mints with automatic mint discovery via NIP-87 and intelligent multi-mint sending"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Robust Send System:"})," Pending sends tracking with automatic retry for failed NutZap publications, ensuring no funds are lost during network issues"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Cross-Mint Transfers:"})," Move funds between different mints using Lightning as the bridge for flexible mint management"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Enhanced UI/UX:"})," Comprehensive improvements across send/receive flows, wallet management, and transaction history with better visual feedback and error handling"]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center gap-3 mb-4",children:jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-slate-400",children:"v1.0.1"})}),jsxRuntimeExports.jsx("p",{className:"text-slate-500 text-xs mb-4",children:"07 December 2025"}),jsxRuntimeExports.jsxs("ul",{className:"space-y-3 text-slate-300",children:[jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Unified Connection UI:"}),' Merged "Connect App" and "Bunker" views into a single, streamlined interface for easier access']})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Event Creator Mode:"})," Create, sign, and broadcast arbitrary events directly (enable in About page)"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Offline Cold Signing:"}),' "Sign & Show QR" flow allows fully air-gapped signing. Import/Export events via file or Animated QRs to turn any device into a cold storage signer']})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"UX Polish:"})," Improved Npub truncation, copy buttons, and general UI refinements"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Connectivity Health Check:"}),' Improved detection of network changes and relay connection status to prevent stale "online" states']})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Manual Reconnect:"})," Added a refresh button on the dashboard to force valid connection checks and clear stale sockets"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Friendly Signing UI:"}),' Redesigned the signing request modal with a "Simple View" that uses human-readable descriptions and a toggle for technical details']})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Update Notifications:"})," Implemented new version detection with a reload prompt to easily update to the latest version"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Developer Mode:"})," Added developer mode to view detailed logs - enable by tapping the version number 5 times on the About page"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Auto-Approval Rules:"})," Added option to keep auto-approval rules when replacing an existing connection from the same client"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Relay Improvements:"})," Enhanced custom relay management and improved WebSocket connectivity for better reliability"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Bunker QR Code:"})," Added support for generating QR codes for your bunker connection string to easily connect other apps"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-amber-500 mt-1",children:""}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Auto-Block Action:"})," Added the ability to auto-block specific types of requests from apps, preventing them from prompting you again"]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-slate-400",children:"v1.0.0"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-slate-500",children:"Initial Release"})]}),jsxRuntimeExports.jsx("p",{className:"text-slate-500 text-xs mb-4",children:"06 December 2025"}),jsxRuntimeExports.jsxs("ul",{className:"space-y-3 text-slate-400",children:[jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-slate-600 mt-1",children:""}),jsxRuntimeExports.jsx("span",{children:"Initial PWA release with NIP-46 remote signing support"})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-slate-600 mt-1",children:""}),jsxRuntimeExports.jsx("span",{children:"Multi-wallet and multi-keypair management"})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-slate-600 mt-1",children:""}),jsxRuntimeExports.jsx("span",{children:"Connection management with auto-approval rules"})]}),jsxRuntimeExports.jsxs("li",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("span",{className:"text-slate-600 mt-1",children:""}),jsxRuntimeExports.jsx("span",{children:"Custom relay support"})]})]})]})]})]}),ActivityLog=({onClose:t})=>{const{entries:e,clearLog:r}=useActivityLogStore(),[n,s]=reactExports.useState(new Set),[o,c]=reactExports.useState(!1),u=g=>{s(y=>{const b=new Set(y);return b.has(g)?b.delete(g):b.add(g),b})},f=()=>{r(),c(!1)},x=g=>({approved:"bg-green-500/10 text-green-400 border-green-500/20",rejected:"bg-red-500/10 text-red-400 border-red-500/20",published:"bg-blue-500/10 text-blue-400 border-blue-500/20",error:"bg-orange-500/10 text-orange-400 border-orange-500/20"})[g],p=g=>new Date(g).toLocaleString();return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl max-w-3xl w-full max-h-[80vh] border border-slate-800 shadow-2xl flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center p-4 sm:p-6 border-b border-slate-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5 text-amber-500"}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Activity Log"})]}),jsxRuntimeExports.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white transition-colors","aria-label":"Close",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsx("div",{className:"px-4 sm:px-6 pt-4 pb-2",children:jsxRuntimeExports.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 text-sm text-blue-300",children:[jsxRuntimeExports.jsx("strong",{children:"Privacy:"})," Activity logs are stored locally on your device only. They include full event details for debugging purposes."]})}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-3",children:e.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(FileText,{className:"w-12 h-12 text-slate-700 mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-slate-500",children:"No activity yet"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Events will appear here as you use the signer"})]}):e.map(g=>{const y=n.has(g.id);return jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 rounded-lg border border-slate-800",children:[jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[jsxRuntimeExports.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold uppercase border ${x(g.action)}`,children:g.action}),jsxRuntimeExports.jsx("span",{className:"text-sm font-mono text-white",children:g.method})]}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-slate-500",children:[g.appName||"Unknown App","  ",g.appPubkey.slice(0,8),"...",g.appPubkey.slice(-8)]}),jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-600 mt-1",children:p(g.timestamp)}),g.error&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-red-400 mt-2 font-mono",children:["Error: ",g.error]})]}),g.event&&jsxRuntimeExports.jsx("button",{onClick:()=>u(g.id),className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 hover:text-white transition-colors flex-shrink-0",title:y?"Collapse":"Expand",children:y?jsxRuntimeExports.jsx(ChevronDown,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(ChevronRight,{className:"w-4 h-4"})})]})}),y&&g.event&&jsxRuntimeExports.jsxs("div",{className:"border-t border-slate-800 p-4 bg-slate-900/50",children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-400 mb-2 font-bold uppercase tracking-wider",children:"Event Data"}),jsxRuntimeExports.jsx("pre",{className:"text-xs text-slate-300 font-mono overflow-x-auto bg-slate-950 p-3 rounded border border-slate-800",children:JSON.stringify(g.event,null,2)})]})]},g.id)})}),e.length>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center p-4 sm:p-6 border-t border-slate-800 bg-slate-950/50",children:[jsxRuntimeExports.jsxs("div",{className:"text-sm text-slate-400",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-white",children:e.length})," ",e.length===1?"entry":"entries"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>c(!0),className:"px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg text-sm font-medium transition-colors flex items-center gap-1.5",children:[jsxRuntimeExports.jsx(Trash2,{className:"w-3.5 h-3.5"}),"Clear Log"]})]}),o&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center rounded-xl",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 max-w-sm mx-4 border border-slate-700",children:[jsxRuntimeExports.jsx("h4",{className:"text-lg font-bold text-white mb-2",children:"Clear Activity Log?"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-slate-400 mb-4",children:["This will permanently delete all ",e.length," log entries. This cannot be undone."]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>c(!1),className:"flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:f,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors",children:"Clear Log"})]})]})})]})})},ConnectedAppsList=()=>{const{connections:t,removeConnection:e,updateConnection:r,getRulesForConnection:n,removeRule:s}=useConnectionsStore(),{currentKeypairId:o}=useWalletStore(),[c,u]=reactExports.useState(null),[f,x]=reactExports.useState(!1),p=t.filter(b=>b.keypairId===o),g=b=>{e(b)},y=b=>{switch(b){case"connected":return jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-4 h-4 text-green-400"});case"connecting":return jsxRuntimeExports.jsx(Loader,{className:"w-4 h-4 text-yellow-400 animate-spin"});case"error":case"disconnected":return jsxRuntimeExports.jsx(CircleX,{className:"w-4 h-4 text-red-400"});default:return null}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-white",children:"Active Connections"}),jsxRuntimeExports.jsx("button",{onClick:()=>x(!0),className:"p-2 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition-colors",title:"Activity Log",children:jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsx("div",{className:"space-y-3 overflow-y-auto pr-1",style:{maxHeight:"calc(100vh - 430px)"},children:p.length===0?jsxRuntimeExports.jsx("p",{className:"text-slate-500 text-center py-4",children:"No active connections"}):p.map(b=>jsxRuntimeExports.jsxs("div",{className:"bg-slate-950 rounded-lg p-4 border border-slate-800 flex items-center justify-between group",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center gap-3",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"font-bold text-white flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"truncate max-w-[200px]",children:b.name||"Unknown App"}),y(b.status)]}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-slate-500 font-mono flex items-center gap-1",children:[b.signerPubkey.slice(0,8),"...",b.signerPubkey.slice(-8),b.startedVia==="nostrconnect"&&jsxRuntimeExports.jsx("span",{className:"bg-blue-500/10 text-blue-400 px-1.5 rounded text-[10px]",children:"CLIENT"}),b.startedVia==="bunker"&&jsxRuntimeExports.jsx("span",{className:"bg-purple-500/10 text-purple-400 px-1.5 rounded text-[10px]",children:"BUNKER"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>u(b.id),className:"p-2 hover:bg-slate-800 rounded-md text-slate-400 hover:text-white transition-colors",title:"Settings",children:jsxRuntimeExports.jsx(Settings$1,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("button",{onClick:()=>g(b.id),className:"p-2 hover:bg-red-500/20 rounded-md text-slate-400 hover:text-red-400 transition-colors",title:"Disconnect",children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]},b.id))})]}),c&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-6 max-w-md w-full border border-slate-800 shadow-2xl",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Connection Settings"}),jsxRuntimeExports.jsx("button",{onClick:()=>u(null),className:"text-slate-400 hover:text-white",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-bold text-white",children:"Auto-Approve Everything"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Approve all requests (except blocked)"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{const b=t.find(R=>R.id===c);if(b){const R=!b.autoApproveAll;r(c,{autoApproveAll:R}),setNativeAutoApproveAll(b.signerPubkey,R).catch(D=>{console.warn("[ConnectedAppsList] Failed to sync auto-approve to native:",D)})}},className:`relative flex-shrink-0 w-12 h-6 rounded-full transition-colors ${t.find(b=>b.id===c)?.autoApproveAll?"bg-green-500":"bg-slate-600"}`,children:jsxRuntimeExports.jsx("span",{className:`absolute top-1 w-4 h-4 rounded-full bg-white transition-all ${t.find(b=>b.id===c)?.autoApproveAll?"left-7":"left-1"}`})})]}),t.find(b=>b.id===c)?.autoApproveAll&&jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-400 mt-3 flex items-center gap-1",children:" Warning: All signing requests will be automatically approved"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-bold text-slate-400 uppercase tracking-wider mb-3",children:"Auto-Approval Rules"}),n(c).length===0?jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500 italic",children:"No active rules"}):jsxRuntimeExports.jsx("div",{className:"space-y-2",children:n(c).map(b=>jsxRuntimeExports.jsxs("div",{className:"bg-slate-800 rounded-lg p-3 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:`text-sm font-bold ${b.policy==="reject"?"text-red-400":"text-green-400"}`,children:b.kinds.map(R=>{const D=b.policy==="reject"?"Auto-Block":"Auto-Approve";return R===-4?`${D} NIP-04 Decryption`:R===-5?`${D} NIP-04 Encryption`:`${D} Kind ${R}`}).join(", ")}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-500",children:["Created ",new Date(b.createdAt).toLocaleDateString()]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>s(b.id),className:"p-1.5 hover:bg-red-500/20 rounded text-red-400 hover:text-red-300 transition-colors",children:jsxRuntimeExports.jsx(Trash2,{className:"w-3 h-3"})})]},b.id))})]}),jsxRuntimeExports.jsx("div",{className:"pt-4 border-t border-slate-800",children:jsxRuntimeExports.jsxs("button",{onClick:()=>{g(c),u(null)},className:"w-full bg-red-500/10 hover:bg-red-500/20 text-red-400 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"}),"Disconnect App"]})})]})]})}),f&&jsxRuntimeExports.jsx(ActivityLog,{onClose:()=>x(!1)})]})},useUPV2Store=create()(persist((t,e)=>({configs:{},loginHistory:[],lastOnlineAt:{},setConfig:r=>t(n=>({configs:{...n.configs,[r.keypairId]:r}})),getConfig:r=>e().configs[r],removeConfig:r=>t(n=>{const{[r]:s,...o}=n.configs;return{configs:o}}),updateConfig:(r,n)=>t(s=>{const o=s.configs[r];return o?{configs:{...s.configs,[r]:{...o,...n}}}:s}),isEnabled:r=>e().configs[r]?.enabled??!1,addLoginAttempt:r=>t(n=>({loginHistory:[...n.loginHistory,r].slice(-100)})),hasProcessedEvent:r=>e().loginHistory.some(n=>n.eventId===r),dismissAttempt:r=>t(n=>({loginHistory:n.loginHistory.map(s=>s.id===r?{...s,dismissed:!0}:s)})),dismissAllOfflineAttempts:r=>t(n=>({loginHistory:n.loginHistory.map(s=>s.keypairId===r&&s.status==="offline_missed"?{...s,dismissed:!0}:s)})),getOfflineAttempts:r=>e().loginHistory.filter(n=>n.keypairId===r&&n.status==="offline_missed"&&!n.dismissed),setLastOnlineAt:(r,n)=>t(s=>({lastOnlineAt:{...s.lastOnlineAt,[r]:n}})),getLastOnlineAt:r=>e().lastOnlineAt[r]}),{name:"amber-upv2",storage:createJSONStorage(()=>({getItem:async t=>{const{storage:e}=await __vitePreload(async()=>{const{storage:r}=await import("./storage-D7x1dBXQ.js");return{storage:r}},[],import.meta.url);return e.getItem(t)},setItem:async(t,e)=>{const{storage:r}=await __vitePreload(async()=>{const{storage:n}=await import("./storage-D7x1dBXQ.js");return{storage:n}},[],import.meta.url);return r.setItem(t,e)},removeItem:async t=>{const{storage:e}=await __vitePreload(async()=>{const{storage:r}=await import("./storage-D7x1dBXQ.js");return{storage:r}},[],import.meta.url);return e.removeItem(t)}}))}));function extract(t,e,r){return ahash$2(t),r===void 0&&(r=new Uint8Array(t.outputLen)),hmac$5(t,toBytes$3(r),toBytes$3(e))}const HKDF_COUNTER=Uint8Array.from([0]),EMPTY_BUFFER=Uint8Array.of();function expand(t,e,r,n=32){ahash$2(t),anumber$5(n);const s=t.outputLen;if(n>255*s)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(n/s);r===void 0&&(r=EMPTY_BUFFER);const c=new Uint8Array(o*s),u=hmac$5.create(t,e),f=u._cloneInto(),x=new Uint8Array(u.outputLen);for(let p=0;p<o;p++)HKDF_COUNTER[0]=p+1,f.update(p===0?EMPTY_BUFFER:x).update(r).update(HKDF_COUNTER).digestInto(x),c.set(x,s*p),u._cloneInto(f);return u.destroy(),f.destroy(),clean$2(x,HKDF_COUNTER),c.slice(0,n)}const hkdf=(t,e,r,n,s)=>expand(t,extract(t,e,r),n,s),UPV2_SALT_SUFFIX="NIP-UPV2",CHALLENGE_EXPIRY_MS=60*1e3,SESSION_DURATION_MS=1440*60*1e3;class UPV2Service{sessions=new Map;pendingChallenges=new Map;deriveLoginKey(e,r){const n=new TextEncoder().encode(r+UPV2_SALT_SUFFIX),s=new TextEncoder().encode(e),o=hkdf(sha256$5,s,n,void 0,32),c=bytesToHex$5(o),u=getPublicKey(o);return{sk:c,pk:u}}generateSessionId(){const e=new Uint8Array(16);return crypto.getRandomValues(e),bytesToHex$5(e)}generateChallenge(e,r){const n=new Uint8Array(32);crypto.getRandomValues(n);const s=bytesToHex$5(n),o=this.generateSessionId(),c=Date.now()+CHALLENGE_EXPIRY_MS,u={nonce:s,loginPk:e,sessionId:o,expiresAt:c};return this.pendingChallenges.set(s,u),console.log("[UPV2] Generated challenge:",{nonce:s.slice(0,16)+"...",loginPk:e.slice(0,16)+"...",expiresAt:new Date(c).toISOString()}),u}verifyChallenge(e,r,n){const s=this.pendingChallenges.get(r);if(!s)return{valid:!1,error:"Challenge not found or expired"};if(Date.now()>s.expiresAt)return this.pendingChallenges.delete(r),{valid:!1,error:"Challenge expired"};if(s.loginPk!==n)return{valid:!1,error:"Login key mismatch"};try{const o=new TextEncoder().encode(r),c=sha256$5(o),u=hexToBytes$7(e),f=hexToBytes$7(n);return schnorr$1.verify(u,c,f)?(this.pendingChallenges.delete(r),{valid:!0,sessionId:s.sessionId}):{valid:!1,error:"Invalid signature"}}catch(o){return console.error("[UPV2] Signature verification error:",o),{valid:!1,error:"Signature verification failed"}}}verifySignatureDirectly(e,r,n){try{const s=new TextEncoder().encode(r),o=sha256$5(s),c=hexToBytes$7(e),u=hexToBytes$7(n);return schnorr$1.verify(c,o,u)?{valid:!0}:{valid:!1,error:"Invalid signature"}}catch(s){return console.error("[UPV2] Direct signature verification error:",s),{valid:!1,error:"Signature verification failed"}}}createSession(e,r,n){const s=Date.now(),o={id:n,loginPk:e,keypairId:r,createdAt:s,expiresAt:s+SESSION_DURATION_MS,lastActivity:s};return this.sessions.set(n,o),console.log("[UPV2] Created session:",{id:n.slice(0,16)+"...",loginPk:e.slice(0,16)+"...",expiresAt:new Date(o.expiresAt).toISOString()}),o}validateSession(e){const r=this.sessions.get(e);return r?Date.now()>r.expiresAt?(this.sessions.delete(e),{valid:!1,error:"Session expired"}):(r.lastActivity=Date.now(),this.sessions.set(e,r),{valid:!0,session:r}):{valid:!1,error:"Session not found"}}invalidateSession(e){this.sessions.delete(e),console.log("[UPV2] Invalidated session:",e.slice(0,16)+"...")}invalidateAllSessionsForKeypair(e){let r=0;for(const[n,s]of this.sessions.entries())s.keypairId===e&&(this.sessions.delete(n),r++);return console.log(`[UPV2] Invalidated ${r} sessions for keypair:`,e),r}getLoginKeyFingerprint(e){return e.slice(0,8)}cleanup(){const e=Date.now();let r=0,n=0;for(const[s,o]of this.pendingChallenges.entries())e>o.expiresAt&&(this.pendingChallenges.delete(s),r++);for(const[s,o]of this.sessions.entries())e>o.expiresAt&&(this.sessions.delete(s),n++);return(r>0||n>0)&&console.log(`[UPV2] Cleanup: ${r} challenges, ${n} sessions`),{challengesCleaned:r,sessionsCleaned:n}}}const upv2Service=new UPV2Service,UPV2PasswordSection=({onToast:t})=>{const{wallets:e,currentWalletId:r,currentKeypairId:n}=useWalletStore(),{setConfig:s,updateConfig:o,getConfig:c}=useUPV2Store(),{password:u}=useAuthStore(),x=e.find(Ye=>Ye.id===r)?.keypairs.find(Ye=>Ye.id===n),[p,g]=reactExports.useState(!1),[y,b]=reactExports.useState(!1),[R,D]=reactExports.useState(""),[k,Re]=reactExports.useState(""),[Fe,O]=reactExports.useState(!1),[$e,ze]=reactExports.useState(!0),[q,W]=reactExports.useState(!1),[We,Xe]=reactExports.useState(null),it=n?c(n):void 0,Ve=!!it?.encryptedPassword,v=it?.enabled??!1,I=()=>{D(""),Re(""),O(!1),ze(!0),Xe(null)},Ce=async()=>{if(!(!x||!u)){if(R.length<8){Xe("Password must be at least 8 characters");return}if(R!==k){Xe("Passwords do not match");return}W(!0),Xe(null);try{const{pk:Ye}=upv2Service.deriveLoginKey(R,x.npub),{CryptoService:je}=await __vitePreload(async()=>{const{CryptoService:st}=await Promise.resolve().then(()=>crypto$2);return{CryptoService:st}},void 0,import.meta.url),K=await je.encrypt(R,u),L={keypairId:x.id,encryptedPassword:K,loginPk:Ye,enabled:!0,createdAt:Date.now()};s(L),console.log("[UPV2] Password set, login key:",Ye.slice(0,16)+"..."),g(!1),I(),t?.("Password login enabled")}catch(Ye){console.error("[UPV2] Failed to set password:",Ye),Xe("Failed to set password")}finally{W(!1)}}},P=async()=>{if(!(!x||!u||!it)){if(R.length<8){Xe("New password must be at least 8 characters");return}if(R!==k){Xe("Passwords do not match");return}W(!0),Xe(null);try{const{CryptoService:Ye}=await __vitePreload(async()=>{const{CryptoService:L}=await Promise.resolve().then(()=>crypto$2);return{CryptoService:L}},void 0,import.meta.url),{pk:je}=upv2Service.deriveLoginKey(R,x.npub),K=await Ye.encrypt(R,u);upv2Service.invalidateAllSessionsForKeypair(x.id),o(x.id,{encryptedPassword:K,loginPk:je,createdAt:Date.now()}),console.log("[UPV2] Password changed, new login key:",je.slice(0,16)+"..."),b(!1),I(),t?.("Password changed successfully")}catch(Ye){console.error("[UPV2] Failed to change password:",Ye),Xe("Failed to change password")}finally{W(!1)}}},_e=async()=>{!n||!it||(upv2Service.invalidateAllSessionsForKeypair(n),s({keypairId:n,encryptedPassword:"",loginPk:"",enabled:!1,createdAt:0}),t?.("Password login removed"))},Le=()=>{!n||!it||(o(n,{enabled:!v}),t?.(v?"Password login disabled":"Password login enabled"))};return x?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"bg-slate-900 rounded-xl border border-slate-800 overflow-hidden",children:jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${Ve?"bg-amber-500/20":"bg-slate-800"}`,children:Ve?v?jsxRuntimeExports.jsx(ShieldCheck,{className:"w-5 h-5 text-amber-500"}):jsxRuntimeExports.jsx(ShieldOff,{className:"w-5 h-5 text-slate-500"}):jsxRuntimeExports.jsx(Key,{className:"w-5 h-5 text-slate-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-white",children:"Password Login"}),Ve?jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-400",children:["Key: ",upv2Service.getLoginKeyFingerprint(it.loginPk),"..."]}):jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-400",children:"Login from any client with your DNN ID"})]})]}),Ve?jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:jsxRuntimeExports.jsx("button",{onClick:Le,className:`relative w-11 h-6 rounded-full transition-colors ${v?"bg-amber-500":"bg-slate-700"}`,children:jsxRuntimeExports.jsx("div",{className:`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${v?"left-6":"left-1"}`})})}):jsxRuntimeExports.jsx("button",{onClick:()=>g(!0),className:"px-4 py-2 bg-amber-500 hover:bg-amber-400 text-slate-950 font-medium text-sm rounded-lg transition-colors whitespace-nowrap",children:"Set Up"})]}),Ve&&jsxRuntimeExports.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-800 flex items-center justify-between",children:[jsxRuntimeExports.jsx("button",{onClick:_e,className:"text-sm text-red-400 hover:text-red-300 transition-colors",children:"Delete Password"}),jsxRuntimeExports.jsx("button",{onClick:()=>b(!0),className:"text-sm text-slate-400 hover:text-white transition-colors",children:"Change Password"})]})]})}),p&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 h-full",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-6 border border-slate-800 max-w-md w-full",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Set Up Password Login"}),jsxRuntimeExports.jsx("button",{onClick:()=>{g(!1),I()},className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-400",children:"Create a password to log in from any Nostr client using your DNN ID and password."}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Password"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:Fe?"text":"password",inputMode:$e?"numeric":"text",value:R,onChange:Ye=>D(Ye.target.value),placeholder:"Enter password (min 8 characters)",className:"w-full bg-slate-950 text-white rounded-lg px-4 py-3 border border-slate-700 focus:border-amber-500 focus:outline-none pr-24"}),jsxRuntimeExports.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ze(!$e),className:"p-1 text-slate-400 hover:text-white rounded transition-colors",title:$e?"Switch to full keyboard":"Switch to number pad",children:$e?jsxRuntimeExports.jsx(Type,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(Hash,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>O(!Fe),className:"p-1 text-slate-400 hover:text-white rounded transition-colors",children:Fe?jsxRuntimeExports.jsx(EyeOff,{className:"w-5 h-5"}):jsxRuntimeExports.jsx(Eye,{className:"w-5 h-5"})})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Confirm Password"}),jsxRuntimeExports.jsx("input",{type:Fe?"text":"password",inputMode:$e?"numeric":"text",value:k,onChange:Ye=>Re(Ye.target.value),placeholder:"Confirm password",className:"w-full bg-slate-950 text-white rounded-lg px-4 py-3 border border-slate-700 focus:border-amber-500 focus:outline-none"})]}),We&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-4 h-4"}),We]}),jsxRuntimeExports.jsx("div",{className:"bg-slate-950 rounded-lg p-3 border border-slate-800",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500",children:"Your password is stored encrypted and never leaves this device. It's used to derive a login key that clients can use to authenticate."})})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 mt-6",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{g(!1),I()},className:"flex-1 bg-slate-800 hover:bg-slate-700 text-white font-medium py-3 rounded-lg transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Ce,disabled:q||R.length<8||R!==k,className:"flex-1 bg-amber-500 hover:bg-amber-400 disabled:bg-amber-500/50 disabled:cursor-not-allowed text-slate-950 font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2",children:q?jsxRuntimeExports.jsx(Loader,{className:"w-5 h-5 animate-spin"}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Shield,{className:"w-5 h-5"}),"Enable"]})})]})]})}),y&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 h-full",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-xl p-6 border border-slate-800 max-w-md w-full",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Change Password"}),jsxRuntimeExports.jsx("button",{onClick:()=>{b(!1),I()},className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"New Password"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:Fe?"text":"password",inputMode:$e?"numeric":"text",value:R,onChange:Ye=>D(Ye.target.value),placeholder:"Enter new password (min 8 characters)",className:"w-full bg-slate-950 text-white rounded-lg px-4 py-3 border border-slate-700 focus:border-amber-500 focus:outline-none pr-24"}),jsxRuntimeExports.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ze(!$e),className:"p-1 text-slate-400 hover:text-white rounded transition-colors",title:$e?"Switch to full keyboard":"Switch to number pad",children:$e?jsxRuntimeExports.jsx(Type,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(Hash,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>O(!Fe),className:"p-1 text-slate-400 hover:text-white rounded transition-colors",children:Fe?jsxRuntimeExports.jsx(EyeOff,{className:"w-5 h-5"}):jsxRuntimeExports.jsx(Eye,{className:"w-5 h-5"})})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Confirm New Password"}),jsxRuntimeExports.jsx("input",{type:Fe?"text":"password",inputMode:$e?"numeric":"text",value:k,onChange:Ye=>Re(Ye.target.value),placeholder:"Confirm new password",className:"w-full bg-slate-950 text-white rounded-lg px-4 py-3 border border-slate-700 focus:border-amber-500 focus:outline-none"})]}),We&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-4 h-4"}),We]}),jsxRuntimeExports.jsx("div",{className:"bg-amber-500/10 rounded-lg p-3 border border-amber-500/30",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-400",children:"Changing your password will immediately invalidate all active login sessions. You'll need to log in again from all clients."})})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 mt-6",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{b(!1),I()},className:"flex-1 bg-slate-800 hover:bg-slate-700 text-white font-medium py-3 rounded-lg transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:P,disabled:q||R.length<8||R!==k,className:"flex-1 bg-amber-500 hover:bg-amber-400 disabled:bg-amber-500/50 disabled:cursor-not-allowed text-slate-950 font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2",children:q?jsxRuntimeExports.jsx(Loader,{className:"w-5 h-5 animate-spin"}):"Change Password"})]})]})})]}):null};function LoginHistory({keypairId:t}){const e=useUPV2Store(s=>s.loginHistory),r=useUPV2Store(s=>s.dismissAttempt),n=reactExports.useMemo(()=>{const s=e.filter(u=>u.keypairId===t),o=new Set;return s.filter(u=>o.has(u.eventId)?!1:(o.add(u.eventId),!0)).sort((u,f)=>f.timestamp-u.timestamp)},[e,t]);return n.length===0?jsxRuntimeExports.jsx("div",{className:"text-center text-slate-500 py-4",children:"No login attempts recorded yet."}):jsxRuntimeExports.jsx("div",{className:"space-y-2",children:jsxRuntimeExports.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:n.map((s,o)=>jsxRuntimeExports.jsx(LoginAttemptRow,{attempt:s,onDismiss:()=>r(s.id)},`${s.eventId}-${o}`))})})}function LoginAttemptRow({attempt:t,onDismiss:e}){const r=t.status==="offline_missed",n=new Date(t.timestamp).toLocaleString();return jsxRuntimeExports.jsxs("div",{className:`flex items-center justify-between p-2 rounded ${r&&!t.dismissed?"bg-red-500/10 border border-red-500/30":"bg-slate-800/50"}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[r&&!t.dismissed?jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 text-red-500"}):jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 text-green-500"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-white",children:t.clientName||"Unknown client"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[jsxRuntimeExports.jsx(Clock,{className:"w-3 h-3"}),n]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${r&&!t.dismissed?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"}`,children:r?t.dismissed?"Dismissed":"Offline":"Success"}),r&&!t.dismissed&&jsxRuntimeExports.jsx("button",{className:"h-6 w-6 p-0 flex items-center justify-center hover:bg-slate-700 rounded transition-colors",onClick:e,children:jsxRuntimeExports.jsx(X,{className:"w-3 h-3 text-slate-400"})})]})]})}function OfflineWarningBanner({keypairId:t,onViewDetails:e,onChangePassword:r,onDismiss:n}){const o=useUPV2Store(c=>c.loginHistory).filter(c=>c.keypairId===t&&c.status==="offline_missed"&&!c.dismissed);return o.length===0?null:jsxRuntimeExports.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("h4",{className:"font-semibold text-red-400",children:[o.length," login attempt",o.length>1?"s":""," while offline"]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"You, or someone else, tried to log in while your signer was offline. This may indicate your password has been compromised. If yes, then change your password."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 mt-3 justify-between",children:[jsxRuntimeExports.jsx("button",{onClick:e,className:"px-3 py-1.5 text-sm border border-slate-600 hover:bg-slate-800 rounded transition-colors text-white",children:"View Attempts"}),jsxRuntimeExports.jsx("button",{onClick:n,className:"px-3 py-1.5 text-sm hover:bg-slate-800 rounded transition-colors text-slate-400",children:"Dismiss"})]})]})]})})}const useClientConnections=(t,e)=>{const[r,n]=reactExports.useState(new Map),s=useConnectionsStore(f=>f.connections),o=reactExports.useRef(new Map),c=reactExports.useRef(new Set),u=reactExports.useRef(new Map);return reactExports.useEffect(()=>{if(!t||!e)return;(async()=>{const x=new Map(o.current);let p=!1;const g=s.filter(y=>y.keypairId===t.id);console.log(`[useClientConnections] Found ${g.length} connections for current keypair:`,g.map(y=>({id:y.id,name:y.name,signerPubkey:y.signerPubkey.slice(0,8),status:y.status})));for(const y of g){const b=u.current.get(y.id)||0;if(!x.has(y.id)&&!c.current.has(y.id)&&y.status!=="disconnected"&&b<3){c.current.add(y.id);try{console.log(`[useClientConnections] Initializing client for: ${y.name} (Attempt ${b+1}/3)`),console.log("[useClientConnections] Connection relays from store:",JSON.stringify(y.relays)),console.log("[useClientConnections] Connection relays count:",y.relays?.length);const R=new ClientService(e,y.id,{signerPubkey:y.signerPubkey,relays:y.relays,secret:y.secret,name:y.name,appUrl:y.appUrl,startedVia:y.startedVia});await R.connect(),useConnectionsStore.getState().connections.find(k=>k.id===y.id)?(x.set(y.id,R),p=!0,u.current.delete(y.id)):R.disconnect()}catch(R){console.error("Failed to init client:",R),u.current.set(y.id,b+1)}finally{c.current.delete(y.id)}}}for(const[y]of x.entries())s.find(b=>b.id===y)||(console.log("[useClientConnections] Removing client for:",y),x.get(y)?.disconnect(),x.delete(y),p=!0,u.current.delete(y));p&&(o.current=x,n(new Map(x)))})()},[s,t,e]),{clients:r}},UPV2_KIND=24134;class UPV2Handler{ndk;signer;privateKey;keypairId;sub=null;onApprovalRequired;processedEventIds=new Set;constructor(e,r,n,s,o){this.privateKey=e,this.keypairId=r,this.onApprovalRequired=o,this.signer=new NDKPrivateKeySigner(e),this.ndk=new NDK({explicitRelayUrls:s}),this.ndk.signer=this.signer}async connect(){console.log("[UPV2Handler] Connecting to relays...");try{await Promise.race([this.ndk.connect(),new Promise((n,s)=>setTimeout(()=>s(new Error("Connection timeout")),1e4))]);const e=await this.signer.user();console.log("[UPV2Handler] Connected, our pubkey:",e.pubkey.slice(0,16)+"...");const r=useUPV2Store.getState().getConfig(this.keypairId);if(!r||!r.enabled){console.log("[UPV2Handler] UPV2 not enabled for this keypair");return}await this.checkForOfflineAttempts(r.loginPk),useUPV2Store.getState().setLastOnlineAt(this.keypairId,Date.now()),this.sub=this.ndk.subscribe({kinds:[UPV2_KIND],"#p":[r.loginPk,e.pubkey],since:Math.floor(Date.now()/1e3)},{closeOnEose:!1}),console.log("[UPV2Handler] Listening for UPV2 requests on login_pk:",r.loginPk.slice(0,16)+"..."),this.sub.on("event",async n=>{await this.handleEvent(n,r.loginPk)})}catch(e){throw console.error("[UPV2Handler] Connection failed:",e),e}}async disconnect(){useUPV2Store.getState().setLastOnlineAt(this.keypairId,Date.now()),this.sub&&(this.sub.stop(),this.sub=null),console.log("[UPV2Handler] Disconnected")}async checkForOfflineAttempts(e){const r=useUPV2Store.getState(),n=r.getLastOnlineAt(this.keypairId);if(!n){console.log("[UPV2Handler] No lastOnlineAt recorded, skipping offline check");return}console.log("[UPV2Handler] Checking for offline attempts since:",new Date(n).toISOString());try{const s=await this.ndk.fetchEvents({kinds:[UPV2_KIND],authors:[e],since:Math.floor(n/1e3),until:Math.floor(Date.now()/1e3)});let o=0;for(const c of s){if(r.hasProcessedEvent(c.id))continue;const u=c.tags.find(p=>p[0]==="a");if(!u||u[1]!=="request_challenge")continue;let f,x;try{const p=nip44_exports.v2.utils.getConversationKey(hexToBytes$7(this.privateKey),c.pubkey),g=nip44_exports.v2.decrypt(c.content,p),y=JSON.parse(g);f=y.client,x=y.instance_id}catch{}r.addLoginAttempt({id:`offline-${c.id}`,eventId:c.id,keypairId:this.keypairId,loginPk:c.pubkey,timestamp:(c.created_at||0)*1e3,clientName:f,instanceId:x,status:"offline_missed"}),o++}o>0&&console.log(`[UPV2Handler]  Detected ${o} offline login attempt(s)`)}catch(s){console.error("[UPV2Handler] Failed to check offline attempts:",s)}}async handleEvent(e,r){const n=await this.signer.user();if(e.pubkey===n.pubkey||this.processedEventIds.has(e.id))return;this.processedEventIds.add(e.id),this.processedEventIds.size>100&&Array.from(this.processedEventIds).slice(0,50).forEach(u=>this.processedEventIds.delete(u)),console.log("[UPV2Handler] Received event:",{kind:e.kind,pubkey:e.pubkey.slice(0,16)+"...",tags:e.tags});const s=e.created_at||0;if(Math.floor(Date.now()/1e3)-s>60){console.log("[UPV2Handler] Ignoring stale event");return}try{const c=nip44_exports.v2.utils.getConversationKey(hexToBytes$7(this.privateKey),e.pubkey),u=nip44_exports.v2.decrypt(e.content,c),f=JSON.parse(u),x=e.tags.find(b=>b[0]==="a"),p=e.tags.find(b=>b[0]==="s");if(!x||!p){console.log("[UPV2Handler] Missing required tags");return}const g=x[1],y=p[1];if(console.log("[UPV2Handler] Action:",g,"Session:",y.slice(0,8)+"..."),e.pubkey!==r){console.log("[UPV2Handler] Login key mismatch, ignoring");return}switch(g){case"request_challenge":await this.handleChallengeRequest(e,y,f);break;case"login":await this.handleLogin(e,y,f);break;case"sign_event":await this.handleSignEvent(e,y,f);break;default:console.log("[UPV2Handler] Unknown action:",g)}}catch(c){console.error("[UPV2Handler] Failed to process event:",c)}}async handleChallengeRequest(e,r,n){console.log("[UPV2Handler] Processing challenge request");const s=typeof n.client=="string"?n.client:void 0,o=typeof n.instance_id=="string"?n.instance_id:void 0;useUPV2Store.getState().hasProcessedEvent(e.id)||useUPV2Store.getState().addLoginAttempt({id:`challenge-${e.id}`,eventId:e.id,keypairId:this.keypairId,loginPk:e.pubkey,timestamp:(e.created_at||0)*1e3,clientName:s,instanceId:o,status:"processed"});const c=upv2Service.generateChallenge(e.pubkey,this.keypairId),u={challenge:c.nonce,expires_at:c.expiresAt};await this.sendResponse(e.pubkey,"challenge",r,u),console.log("[UPV2Handler] Challenge issued, expires:",new Date(c.expiresAt).toISOString())}async handleLogin(e,r,n){console.log("[UPV2Handler] Processing login");const{challenge_signature:s,client:o,instance_id:c}=n;if(!s){console.log("[UPV2Handler] Missing challenge signature"),await this.sendError(e.pubkey,r,"Missing challenge signature");return}const{nonce:u}=n;if(!u){console.log("[UPV2Handler] Missing nonce"),await this.sendError(e.pubkey,r,"Missing nonce");return}const f=upv2Service.verifySignatureDirectly(s,u,e.pubkey);if(!f.valid){console.log("[UPV2Handler] Challenge verification failed:",f.error),await this.sendError(e.pubkey,r,f.error||"Verification failed");return}const x=upv2Service.createSession(e.pubkey,this.keypairId,r),p=`upv2-${r}`,g=useConnectionsStore.getState(),y=o||"UPV2 Login",b=g.connections.find(Re=>Re.keypairId===this.keypairId&&Re.startedVia==="upv2"&&Re.name===y);if(b){if(b.instanceId===c){console.log("[UPV2Handler] Same instanceId, refreshing existing connection"),g.updateConnection(b.id,{connectedAt:Date.now(),sessionExpiry:x.expiresAt,loginPk:e.pubkey}),await this.sendResponse(e.pubkey,"session_created",r,{session_id:r,expires_at:x.expiresAt}),useActivityLogStore.getState().addEntry({action:"approved",method:"upv2_login",appName:y,appPubkey:e.pubkey}),console.log("[UPV2Handler] Login successful (existing session refreshed)");return}console.log("[UPV2Handler] Different instanceId detected, prompting for new device authorization");const Fe=`upv2-replace-${Date.now()}`,O=e.pubkey,$e=this;useRequestStore.getState().addRequest({id:Fe,requestEventId:e.id,requestorPubkey:O,method:"upv2_replace_connection",params:[],timestamp:Date.now()/1e3,source:"upv2",internal:!0,title:"Authorize New Device?",description:`A new device is trying to login as "${y}". This will replace your existing connection and transfer your auto-approval rules.`,confirmLabel:"Replace",cancelLabel:"Deny",onSuccess:async()=>{console.log("[UPV2Handler] User approved replacement");const ze=g.getRulesForConnection(b.id);console.log("[UPV2Handler] Preserving",ze.length,"rules from old connection"),g.removeConnection(b.id),await $e.createConnectionAndRespond(O,p,y,x,r,ze,c)},onError:async()=>{console.log("[UPV2Handler] User denied replacement"),await $e.sendError(O,r,"Login denied by user")}});return}console.log("[UPV2Handler] New login attempt, prompting for approval");const R=`upv2-new-${Date.now()}`,D=e.pubkey,k=this;useRequestStore.getState().addRequest({id:R,requestEventId:e.id,requestorPubkey:D,method:"upv2_new_connection",params:[],timestamp:Date.now()/1e3,source:"upv2",internal:!0,title:"New Login Request",description:`"${y}" is requesting to login. Do you want to authorize this connection?`,confirmLabel:"Approve",cancelLabel:"Deny",onSuccess:async()=>{console.log("[UPV2Handler] User approved new login"),await k.createConnectionAndRespond(D,p,y,x,r,[],c)},onError:async()=>{console.log("[UPV2Handler] User denied new login"),await k.sendError(D,r,"Login denied by user")}})}async createConnectionAndRespond(e,r,n,s,o,c,u){const f=useConnectionsStore.getState();f.addConnection({id:r,keypairId:this.keypairId,signerPubkey:e,relays:Array.from(this.ndk.pool.relays.keys()),name:n,status:"connected",startedVia:"upv2",connectedAt:Date.now(),loginPk:e,sessionExpiry:s.expiresAt,instanceId:u}),setNativeKnownSender(e,!0).catch(x=>{console.warn("[UPV2Handler] Failed to sync known sender to native signer:",x)}),c.length>0&&(c.forEach(x=>{f.addRule({...x,id:Math.random().toString(36).substring(7),connectionId:r,createdAt:Date.now()})}),console.log("[UPV2Handler]  Copied",c.length,"rules to new connection")),await this.sendResponse(e,"session_created",o,{session_id:o,expires_at:s.expiresAt}),useActivityLogStore.getState().addEntry({action:"approved",method:"upv2_login",appName:n,appPubkey:e}),console.log("[UPV2Handler] Login successful, connection created:",r)}async handleSignEvent(e,r,n){console.log("[UPV2Handler] Processing sign_event request");const{challenge_signature:s,nonce:o,event:c}=n;if(!s||!o){await this.sendError(e.pubkey,r,"Missing challenge signature or nonce");return}const u=upv2Service.verifySignatureDirectly(s,o,e.pubkey);if(!u.valid){console.log("[UPV2Handler] Signature verification failed:",u.error),await this.sendError(e.pubkey,r,u.error||"Invalid signature");return}const f=upv2Service.validateSession(r);if(!f.valid){await this.sendError(e.pubkey,r,f.error||"Invalid session");return}const x=`upv2-${r}`,p=useConnectionsStore.getState().getConnection(x);if(!p){console.log("[UPV2Handler]  Ignoring sign_event from unknown/removed connection:",x);return}if(p){const y=typeof c=="string"?JSON.parse(c):c,b=y.kind,D=useConnectionsStore.getState().getRulesForConnection(x).filter(Fe=>Fe.kinds.includes(b));if(D.some(Fe=>Fe.policy==="reject")){console.log("[UPV2Handler] Auto-blocking kind",b),await this.sendError(e.pubkey,r,"Request blocked by policy"),useActivityLogStore.getState().addEntry({action:"rejected",method:"sign_event",appName:p.name,appPubkey:e.pubkey,error:"Blocked by policy",event:y});return}if(p.autoApproveAll){console.log("[UPV2Handler] Auto-approve-all enabled, approving kind",b),await this.signAndRespond(e.pubkey,r,c);return}if(D.some(Fe=>Fe.policy==="approve")){console.log("[UPV2Handler] Auto-approving kind",b),await this.signAndRespond(e.pubkey,r,c);return}}const g=`upv2-${r}-${Date.now()}`;useRequestStore.getState().addRequest({id:g,requestEventId:e.id,requestorPubkey:e.pubkey,method:"sign_event",params:[typeof c=="string"?c:JSON.stringify(c)],timestamp:e.created_at||Date.now()/1e3,source:"upv2",connectionId:x,encryptionMethod:"nip44"}),this.onApprovalRequired&&this.onApprovalRequired({id:g,method:"sign_event",event:c})}async signAndRespond(e,r,n){try{const s=typeof n=="string"?JSON.parse(n):n,o=new NDKEvent(this.ndk,s);await o.sign(this.signer),await this.sendResponse(e,"signed_event",r,{event:o.rawEvent()}),useActivityLogStore.getState().addEntry({action:"approved",method:"sign_event",appPubkey:e,event:s}),console.log("[UPV2Handler] Event signed and sent")}catch(s){console.error("[UPV2Handler] Failed to sign event:",s),await this.sendError(e,r,"Failed to sign event")}}async sendResponse(e,r,n,s){const o=JSON.stringify(s),c=nip44_exports.v2.utils.getConversationKey(hexToBytes$7(this.privateKey),e),u=nip44_exports.v2.encrypt(o,c),f=new NDKEvent(this.ndk);f.kind=UPV2_KIND,f.tags=[["a",r],["s",n],["p",e]],f.content=u,await f.sign(this.signer);const x=await f.publish();console.log("[UPV2Handler] Response sent to:",Array.from(x).map(p=>p.url))}async sendError(e,r,n){await this.sendResponse(e,"error",r,{error:n})}}const useUPV2Handler=()=>{const{wallets:t,currentWalletId:e,currentKeypairId:r}=useWalletStore(),n=useUPV2Store(y=>y.configs),{decryptedKey:s}=useAuthStore(),{relays:o}=useRelayStore(),c=reactExports.useRef(null),u=reactExports.useRef(!1),x=t.find(y=>y.id===e)?.keypairs.find(y=>y.id===r),p=r?n[r]:void 0,g=reactExports.useMemo(()=>o.map(y=>y.url).sort().join(","),[o]);return reactExports.useEffect(()=>{if(!x||!s||!p?.enabled){c.current&&(c.current.disconnect(),c.current=null);return}if(u.current||c.current)return;const y=g.split(",").filter(Boolean);if(y.length===0){console.log("[useUPV2Handler] No relays, skipping");return}u.current=!0;const b=new UPV2Handler(s,x.id,x.npub,y);return c.current=b,b.connect().then(()=>{console.log("[useUPV2Handler] Handler connected")}).catch(R=>{console.error("[useUPV2Handler] Failed to connect:",R),c.current=null}).finally(()=>{u.current=!1}),()=>{c.current&&(c.current.disconnect(),c.current=null),u.current=!1}},[x?.id,s,p?.enabled,p?.loginPk,p?.createdAt,g]),{handler:c.current}},useRelayMonitor=t=>{const{relays:e,updateRelayStatus:r,incrementFailedAttempts:n}=useRelayStore(),s=reactExports.useRef(null),o=reactExports.useRef(Date.now());reactExports.useEffect(()=>{if(!t)return;const c=async(p=!1,g=!1)=>{const y=e.filter(b=>b.status==="disconnected"||b.status==="error");if(y.length>0&&(console.log("[RelayMonitor] Attempting to reconnect",y.length,"relays"),y.forEach(b=>{if(!(b.failedAttempts>=10)){r(b.url,"connecting");try{t.ndk?.pool?.relays?.get(b.url)?.connect()}catch{r(b.url,"error"),n(b.url)}}})),t.hasActiveSubscription&&t.isSubscriptionHealthy){const b=t.hasActiveSubscription(),R=t.isSubscriptionHealthy();if(!b)console.warn("[RelayMonitor]  No active subscription! Reconnecting..."),await t.reconnectSubscription();else if(!R||p||g){let D=!1;if(g)console.log("[RelayMonitor] Network recovery detected - TRIGGERING FORCE RECONNECT."),D=!0;else if(p){const k=Date.now()-o.current;k<6e4?(console.log(`[RelayMonitor] App backgrounded for ${Math.round(k/1e3)}s - skipping FORCE reconnect.`),D=!1):(console.log(`[RelayMonitor] App backgrounded for ${Math.round(k/1e3)}s - TRIGGERING FORCE RECONNECT.`),D=!0)}else D=!1;(!R||D)&&(console.warn(`[RelayMonitor]  ${g?"Network Recovery":D?"Deep Sleep Wakeup":"Subscription unhealthy"}. Reconnecting... (Force: ${D})`),await t.reconnectSubscription(D))}}o.current=Date.now()};s.current=setInterval(()=>c(!1),1e4);const u=()=>{document.visibilityState==="visible"?(console.log("[RelayMonitor] App became visible - triggering FORCE reconnect..."),setNativeAppForeground(!0),c(!0,!0)):(console.log("[RelayMonitor] App going to background - native signer will handle"),setNativeAppForeground(!1),o.current=Date.now())};document.addEventListener("visibilitychange",u);const f=()=>{console.log("[RelayMonitor] Network online - triggering health check..."),c(!0,!0)},x=()=>{console.warn("[RelayMonitor] Network offline - pausing active checks (logs will be silent)")};return window.addEventListener("online",f),window.addEventListener("offline",x),()=>{s.current&&clearInterval(s.current),document.removeEventListener("visibilitychange",u),window.removeEventListener("online",f),window.removeEventListener("offline",x)}},[t,e,r,n])},Dashboard=()=>{const{logout:t,decryptedKey:e}=useAuthStore(),{currentWalletId:r,wallets:n,currentKeypairId:s}=useWalletStore(),{requests:o}=useRequestStore();useUPV2Handler();const[c,u]=reactExports.useState(""),[f,x]=reactExports.useState(navigator.onLine);reactExports.useEffect(()=>{const er=()=>x(!0),pr=()=>x(!1);return window.addEventListener("online",er),window.addEventListener("offline",pr),()=>{window.removeEventListener("online",er),window.removeEventListener("offline",pr)}},[]);const[p,g]=reactExports.useState("connections"),[y,b]=reactExports.useState(!1),[R,D]=reactExports.useState(!1),[k,Re]=reactExports.useState(!1),[Fe,O]=reactExports.useState(!1),[$e,ze]=reactExports.useState(!1),[q,W]=reactExports.useState(!1),[We,Xe]=reactExports.useState(null),it=useUPV2Store(er=>er.dismissAllOfflineAttempts),[Ve,v]=reactExports.useState(""),[I,Ce]=reactExports.useState("bitcoin"),[P,_e]=reactExports.useState(void 0),[Le,Ye]=reactExports.useState(!1),je=er=>{Xe(er)},[K,L]=reactExports.useState(!1),st=reactExports.useRef(null),{isOnline:dt,relays:Je}=useRelayStore(),pt=n.find(er=>er.id===r),rr=pt?.keypairs.find(er=>er.id===s),cr=o.find(er=>er.source==="client")||o[0];useRelayMonitor(st.current),reactExports.useEffect(()=>{if(rr)try{const{data:er}=nip19_exports$1.decode(rr.npub);u(`bunker://${er}?relay=wss://relay.primal.net&relay=wss://relay.damus.io&relay=wss://nos.lol&relay=wss://relay.nostr.band`)}catch(er){console.error("Invalid npub:",er)}},[rr]),reactExports.useEffect(()=>{if(e&&!st.current){console.log("[Dashboard] Creating new SignerService instance");const er=new SignerService(e);st.current=er,er.connect().catch(console.error);const pr=Er=>{const{url:xr}=Er.detail;console.log("[Dashboard] Received add-relay event for:",xr),er.addRelay(xr)};return window.addEventListener("add-relay",pr),()=>{console.log("[Dashboard] Cleaning up SignerService instance"),er.disconnect(),st.current=null,window.removeEventListener("add-relay",pr)}}else!e&&st.current&&(console.log("[Dashboard] Disconnecting SignerService due to no decryptedKey"),st.current.disconnect(),st.current=null,u(""))},[e]),reactExports.useEffect(()=>{window.history.pushState({dashboard:"root"},"");const er=pr=>{if(cr){lr(cr.id,cr.requestEventId,cr.requestorPubkey),window.history.pushState({dashboard:"root"},"");return}if(Fe){O(!1),window.history.pushState({dashboard:"root"},"");return}if(k){Re(!1),window.history.pushState({dashboard:"root"},"");return}if(R){D(!1),window.history.pushState({dashboard:"root"},"");return}if(y){b(!1),window.history.pushState({dashboard:"root"},"");return}if(p!=="connections"){g("connections"),window.history.pushState({dashboard:"root"},"");return}pr.preventDefault(),window.history.pushState({dashboard:"root"},"")};return window.addEventListener("popstate",er),()=>window.removeEventListener("popstate",er)},[p,y,k,R,Fe,cr]);const fr=(er,pr)=>{window.history.pushState({view:er},""),pr(!0)},ir=()=>{window.history.pushState({view:"wallet"},""),g("wallet")},{clients:ft}=useClientConnections(rr,e),nr=async(er,pr,Er,xr,wr,Br=!1)=>{console.log("[Dashboard] handleApprove called with remember:",Br);const hr=useRequestStore.getState().requests.find(Cr=>Cr.id===er);if(hr?.internal){console.log("[Dashboard] Processing INTERNAL request:",er);try{if(xr==="sign_event"&&st.current){const Cr=await st.current.signEventInternal(wr[0]);hr.onSuccess&&hr.onSuccess(Cr)}else hr.onSuccess&&hr.onSuccess(null)}catch(Cr){console.error("[Dashboard] Internal request failed:",Cr),hr.onError&&hr.onError(Cr)}useRequestStore.getState().removeRequest(er);return}if(Br){if(xr==="sign_event")try{const Cr=wr[0],Tr=JSON.parse(Cr).kind;console.log("[Dashboard] Attempting to save auto-approval rule for kind:",Tr),console.log("[Dashboard] Requestor pubkey:",Er);let Nr;if(cr?.connectionId&&(Nr=useConnectionsStore.getState().connections.find(or=>or.id===cr.connectionId)),Nr||(Nr=useConnectionsStore.getState().connections.find(or=>or.signerPubkey===Er)),Nr){console.log("[Dashboard] Found connection:",Nr.id,Nr.name);const{addRule:or}=useConnectionsStore.getState(),tr={id:Math.random().toString(36).substring(7),connectionId:Nr.id,kinds:[Tr],createdAt:Date.now()};console.log("[Dashboard] Calling addRule with:",tr),or(tr),console.log(`[Dashboard]  Rule saved for kind ${Tr}`)}else console.error("[Dashboard]  Connection not found for requestor:",Er)}catch(Cr){console.error("[Dashboard] Failed to save auto-approval rule:",Cr)}else if(xr==="nip04_decrypt"||xr==="nip04_encrypt")try{console.log(`[Dashboard] Attempting to save auto-approval rule for ${xr}`),console.log("[Dashboard] Requestor pubkey:",Er);let Cr;if(cr?.connectionId&&(Cr=useConnectionsStore.getState().connections.find(_r=>_r.id===cr.connectionId)),Cr||(Cr=useConnectionsStore.getState().connections.find(_r=>_r.signerPubkey===Er)),Cr){console.log("[Dashboard] Found connection:",Cr.id,Cr.name);const{addRule:_r}=useConnectionsStore.getState(),Tr=xr==="nip04_decrypt"?-4:-5,Nr={id:Math.random().toString(36).substring(7),connectionId:Cr.id,kinds:[Tr],createdAt:Date.now()};console.log("[Dashboard] Calling addRule with:",Nr),_r(Nr),console.log(`[Dashboard]  Rule saved for ${xr}`);const or=useRequestStore.getState().requests;console.log("[Dashboard] Checking pending requests for auto-approval:",or.length);const tr=or.filter(yr=>yr.id!==er&&yr.method===xr&&(yr.connectionId===Cr.id||yr.requestorPubkey===Er));tr.length>0&&(console.log(`[Dashboard] Found ${tr.length} pending requests to auto-approve`),setTimeout(async()=>{for(const yr of tr)if(console.log(`[Dashboard] Auto-approving pending request: ${yr.id}`),yr.connectionId){const mr=ft.get(yr.connectionId);mr&&await mr.approveRequest(yr.id,yr.requestEventId,yr.requestorPubkey,yr.method,yr.params)}else st.current?.approveRequest(yr.id,yr.requestEventId,yr.requestorPubkey,yr.method,yr.params),useRequestStore.getState().removeRequest(yr.id)},100))}else console.error("[Dashboard]  Connection not found for requestor:",Er)}catch(Cr){console.error("[Dashboard] Failed to save auto-approval rule:",Cr)}}if(xr==="connect")try{const Cr=useConnectionsStore.getState();Cr.connections.find(Tr=>Tr.signerPubkey===Er)||(console.log("[Dashboard] Saving new connection from connect request"),Cr.addConnection({id:Math.random().toString(36).substring(7),keypairId:s,signerPubkey:Er,name:"App "+Er.slice(0,4),relays:["wss://relay.primal.net","wss://nos.lol","wss://relay.nostr.band","wss://relay.damus.io"],secret:wr[1]||"",status:"connected",startedVia:"bunker",connectedAt:Date.now()}))}catch(Cr){console.error("[Dashboard] Failed to save connection:",Cr)}if(cr?.connectionId){const Cr=ft.get(cr.connectionId);if(Cr){console.log("[Dashboard] Approving via ClientService for connection:",cr.connectionId),Cr.approveRequest(er,pr,Er,xr,wr,cr.encryptionMethod);return}else console.warn("[ClientService] ClientService not found for connection:",cr.connectionId)}console.log("[Dashboard] Approving via SignerService"),st.current?.approveRequest(er,pr,Er,xr,wr),useRequestStore.getState().removeRequest(er)},lr=(er,pr,Er,xr=!1)=>{const wr=useRequestStore.getState().requests.find(Br=>Br.id===er);if(wr?.internal){console.log("[Dashboard] Rejecting INTERNAL request:",er),wr.onError&&wr.onError(new Error("User denied")),useRequestStore.getState().removeRequest(er);return}if(xr&&cr)try{const{method:Br,params:hr}=cr,Cr=useConnectionsStore.getState(),_r=cr.connectionId?Cr.connections.find(Tr=>Tr.id===cr.connectionId):Cr.connections.find(Tr=>Tr.signerPubkey===Er);if(_r){let Tr=[];Br==="sign_event"?Tr=[JSON.parse(hr[0]).kind]:Br==="nip04_decrypt"?Tr=[-4]:Br==="nip04_encrypt"&&(Tr=[-5]),Tr.length>0&&(Cr.addRule({id:Math.random().toString(36).substring(7),connectionId:_r.id,kinds:Tr,policy:"reject",createdAt:Date.now()}),console.log(`[Dashboard]  Auto-Block rule created for ${_r.name} (Kinds: ${Tr.join(", ")})`))}}catch(Br){console.error("[Dashboard] Failed to save auto-block rule:",Br)}if(cr?.connectionId){const Br=ft.get(cr.connectionId);if(Br){console.log("[Dashboard] Rejecting via ClientService for connection:",cr.connectionId),Br.rejectRequest(er,pr,Er);return}}st.current?.rejectRequest(er,pr,Er),useRequestStore.getState().removeRequest(er)};return reactExports.useEffect(()=>{if(!cr)return;const{method:er,params:pr,connectionId:Er,requestorPubkey:xr,id:wr}=cr;if(er!=="nip04_decrypt"&&er!=="nip04_encrypt"&&er!=="sign_event"&&er!=="get_public_key")return;const Br=useConnectionsStore.getState();let hr;if(Er?hr=Br.connections.find(Cr=>Cr.id===Er):hr=Br.connections.find(Cr=>Cr.signerPubkey===xr),hr){const Cr=Br.getRulesForConnection(hr.id);let _r;if(er==="sign_event")try{_r=JSON.parse(pr[0]).kind}catch{return}else if(er==="nip04_decrypt")_r=-4;else if(er==="nip04_encrypt")_r=-5;else if(er==="get_public_key"){console.log(`[Dashboard]  Safety Net: Auto-approving get_public_key request ${wr} for known connection`),nr(wr,cr.requestEventId,xr,er,pr,!1);return}if(_r!==void 0){const Tr=Cr.filter(Nr=>Nr.kinds.includes(_r));Tr.length>0&&(Tr.some(or=>or.policy==="reject")?(console.log(`[Dashboard]  Safety Net: Auto-blocking ${er} request ${wr} due to existing rule`),lr(wr,cr.requestEventId,xr,!1)):(console.log(`[Dashboard]  Safety Net: Auto-approving ${er} request ${wr} due to existing rule`),nr(wr,cr.requestEventId,xr,er,pr,!1)))}}},[cr]),y?jsxRuntimeExports.jsx(WalletManager,{onBack:()=>b(!1)}):p==="about"?jsxRuntimeExports.jsx(About,{onBack:()=>g("connections"),onNavigateChangelog:()=>g("changelog"),onSettings:()=>g("settings")}):p==="settings"?jsxRuntimeExports.jsx(Settings,{onBack:()=>g("about")}):p==="changelog"?jsxRuntimeExports.jsx(Changelog,{onBack:()=>g("about")}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-slate-950 text-white p-4",children:[jsxRuntimeExports.jsxs("header",{className:"flex justify-between items-center mb-8 border-b border-slate-800 pb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>{window.history.pushState({view:"about"},""),g("about")},className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[jsxRuntimeExports.jsx("img",{src:"./pwa-192x192.png",alt:"Logo",className:"w-8 h-8 rounded-lg"}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-amber-500",children:"PWANS"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>fr("relay-manager",Re),className:`flex items-center gap-1 text-xs px-2 py-1 rounded-full transition-colors cursor-pointer hover:opacity-80 ${dt()&&f?"bg-green-500/10 text-green-400":"bg-red-500/10 text-red-400"}`,title:`${Je.filter(er=>er.status==="connected").length}/${Je.length} relays connected - Click to manage`,children:[dt()&&f?jsxRuntimeExports.jsx(Wifi,{className:"w-3 h-3"}):jsxRuntimeExports.jsx(WifiOff,{className:"w-3 h-3"}),dt()&&f?"Online":"Offline"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[pt&&jsxRuntimeExports.jsxs("button",{onClick:()=>fr("wallet-manager",b),className:"flex items-center gap-2 px-3 py-2 bg-slate-900 hover:bg-slate-800 rounded-lg transition-colors border border-slate-800",children:[jsxRuntimeExports.jsx(Notebook,{className:"w-4 h-4 text-amber-500"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:pt.name})]}),jsxRuntimeExports.jsx("button",{onClick:async()=>{if(st.current&&!K){L(!0);try{await st.current.reconnectSubscription(!0),console.log("Manually reconnected")}catch(er){console.error("Manual reconnect failed",er)}finally{L(!1)}}},className:"p-2 hover:bg-slate-900 rounded-lg transition-colors text-slate-400 hover:text-white",title:"Force Reconnect",disabled:K,children:jsxRuntimeExports.jsx(RefreshCw,{className:`w-5 h-5 ${K?"animate-spin text-amber-500":""}`})}),jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 hover:bg-slate-900 rounded-lg transition-colors",title:"Lock Wallet",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5 text-slate-400"})})]})]}),jsxRuntimeExports.jsxs("main",{className:"max-w-2xl mx-auto space-y-4",children:[(p==="connections"||p==="wallet")&&jsxRuntimeExports.jsx(ActiveKeypairCard,{onSwitchKeypair:()=>fr("keypair-switcher",D),onToast:er=>Xe(er)}),R&&pt&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",onClick:()=>D(!1),children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-md w-full border border-slate-800 shadow-2xl",onClick:er=>er.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Switch Address"}),jsxRuntimeExports.jsx("button",{onClick:()=>D(!1),className:"p-1 hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-slate-400"})})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:pt.keypairs.map(er=>jsxRuntimeExports.jsxs("button",{onClick:async()=>{const{password:pr}=useAuthStore.getState();if(!pr){console.error("[Dashboard] No cached password for keypair switch");return}try{const{CryptoService:Er}=await __vitePreload(async()=>{const{CryptoService:Br}=await Promise.resolve().then(()=>crypto$2);return{CryptoService:Br}},void 0,import.meta.url),xr=await Er.decrypt(er.encryptedNsec,pr),wr=Er.nsecToHex(xr);useWalletStore.getState().setCurrentKeypair(er.id),useAuthStore.getState().unlock(wr,pr),D(!1)}catch(Er){console.error("[Dashboard] Failed to switch keypair:",Er)}},className:`w-full flex items-center gap-3 p-3 rounded-xl border transition-all ${s===er.id?"bg-amber-500/10 border-amber-500/50":"bg-slate-950 border-slate-800 hover:border-slate-700 hover:bg-slate-900"}`,children:[jsxRuntimeExports.jsxs("div",{className:`p-1 rounded-lg flex-shrink-0 ${s===er.id?"bg-amber-500 text-slate-950":"bg-slate-800 text-slate-400"}`,children:[er.profile?.picture?jsxRuntimeExports.jsx("img",{src:er.profile.picture,alt:er.profile.name||"Profile",className:"w-8 h-8 rounded-lg object-cover",onError:pr=>{pr.currentTarget.style.display="none",pr.currentTarget.nextElementSibling?.classList.remove("hidden")}}):null,jsxRuntimeExports.jsx(User,{className:`w-8 h-8 ${er.profile?.picture?"hidden":""}`})]}),jsxRuntimeExports.jsxs("div",{className:"text-left flex-1 min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"font-bold text-white truncate",children:er.profile?.name||er.name}),jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-400 font-mono truncate",children:er.npub})]}),s===er.id&&jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-5 h-5 text-amber-500"})]},er.id))})]})}),p==="connections"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[useSettingsStore.getState().eventCreatorMode&&jsxRuntimeExports.jsx(EventCreator,{onBroadcastSuccess:()=>je("Event published successfully!")}),jsxRuntimeExports.jsx(ConnectSigner,{bunkerURI:c,onBroadcastSuccess:()=>je("Event published successfully!"),scannerOpen:$e,onScannerClose:()=>ze(!1),onBitcoinAddressScanned:er=>{v(er),Ce("bitcoin"),Ye(!0),g("wallet")},onNpubScanned:(er,pr)=>{v(er),Ce(pr),Ye(!0),g("wallet")},onLightningInvoiceScanned:er=>{v(er),Ce("ecash"),Ye(!0),g("wallet")}}),s&&jsxRuntimeExports.jsx(OfflineWarningBanner,{keypairId:s,onViewDetails:()=>W(!0),onChangePassword:()=>{document.getElementById("upv2-password-section")?.scrollIntoView({behavior:"smooth"})},onDismiss:()=>s&&it(s)}),q&&s&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",onClick:()=>W(!1),children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-md w-full border border-slate-800 shadow-2xl",onClick:er=>er.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Login History"}),jsxRuntimeExports.jsx("button",{onClick:()=>W(!1),className:"p-1 hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-slate-400"})})]}),jsxRuntimeExports.jsx(LoginHistory,{keypairId:s})]})}),jsxRuntimeExports.jsx(UPV2PasswordSection,{onToast:er=>Xe(er)}),jsxRuntimeExports.jsx(ConnectedAppsList,{})]}),p==="wallet"&&jsxRuntimeExports.jsx(WalletView,{initialTab:I,initialRecipient:Ve,autoOpenSend:Le,onSendComplete:()=>{v(""),Ye(!1),_e(void 0)},initialFeeRate:P}),p==="ids"&&jsxRuntimeExports.jsx(IdsView,{onSwitchKeypair:()=>fr("keypair-switcher",D),onNavigateToWallet:(er,pr)=>{er&&(v(er),Ye(!0)),pr&&_e(pr),g("wallet")}})]}),jsxRuntimeExports.jsx(BottomNav,{currentView:p,onChange:er=>{er==="wallet"?ir():g(er==="ids"?"ids":"connections")},onScan:()=>{g("connections"),ze(!0)}}),cr&&jsxRuntimeExports.jsx(RequestModal,{request:cr,onApprove:er=>nr(cr.id,cr.requestEventId,cr.requestorPubkey,cr.method,cr.params,er),onReject:er=>lr(cr.id,cr.requestEventId,cr.requestorPubkey,er)}),k&&jsxRuntimeExports.jsx(RelayManager,{onClose:()=>Re(!1)}),We&&jsxRuntimeExports.jsx(Toast,{message:We,onClose:()=>Xe(null)}),Fe&&rr&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",onClick:()=>O(!1),children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-sm w-full border border-slate-800 shadow-2xl",onClick:er=>er.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-white",children:"Your Nostr Address"}),jsxRuntimeExports.jsx("button",{onClick:()=>O(!1),className:"p-1 hover:bg-slate-800 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-slate-400"})})]}),jsxRuntimeExports.jsx("div",{className:"bg-white p-4 rounded-xl mb-4",children:jsxRuntimeExports.jsx(QRCodeSVG,{value:rr.npub,size:256,level:"M",includeMargin:!1,className:"w-full h-auto"})}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-slate-400",children:"Npub"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 border border-slate-800 rounded-lg p-3",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-white font-mono flex-1 break-all",children:rr.npub}),jsxRuntimeExports.jsx("button",{onClick:()=>{navigator.clipboard.writeText(rr.npub),Xe("Npub copied!")},className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors flex-shrink-0",title:"Copy npub",children:jsxRuntimeExports.jsx(Copy,{className:"w-4 h-4"})})]})]})]})})]})},PersistenceManager=()=>{const{publicKey:t,isUnlocked:e}=useAuthStore();return reactExports.useEffect(()=>{const r=useEcashStore.subscribe(()=>{e&&t&&useEcashStore.getState().saveSession(t)});return()=>{r()}},[t,e]),null},DisclaimerModal=({onAgree:t})=>{const[e,r]=reactExports.useState("disclaimer"),n=Capacitor.isNativePlatform(),s=()=>{n?t():r("native-promo")};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-[100]",children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-md w-full border border-slate-800 shadow-2xl",children:[e==="disclaimer"&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center text-center space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-amber-500/10 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(TriangleAlert,{className:"w-8 h-8 text-amber-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Welcome to PWANS"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400",children:"Please read this important disclaimer before continuing."})]}),jsxRuntimeExports.jsx("div",{className:"bg-slate-950 rounded-xl p-4 border border-slate-800 text-left",children:jsxRuntimeExports.jsxs("p",{className:"text-slate-300 text-sm leading-relaxed",children:["PWANS and its creator(s) hold ",jsxRuntimeExports.jsx("strong",{children:"no responsibility"})," for any lost or compromised accounts or funds.",jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx("br",{}),"This is a self-custodial application. ",jsxRuntimeExports.jsx("strong",{children:"You"})," hold full responsibility for how you use this PWA and for securing your own keys.",jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx("br",{}),"You are also aware that the technologies used in this application are still in development and may have vulnerabilities that could potentially cause loss of funds or other damage."]})}),jsxRuntimeExports.jsxs("button",{onClick:s,className:"w-full py-3 bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold rounded-xl transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-5 h-5"}),"I Understand and Agree"]})]}),e==="native-promo"&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center text-center space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-amber-500/10 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Smartphone,{className:"w-8 h-8 text-amber-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Native App Available"}),jsxRuntimeExports.jsx("p",{className:"text-slate-400",children:"For enhanced security, consider the native version"})]}),jsxRuntimeExports.jsx("div",{className:"bg-slate-950 rounded-xl p-4 border border-slate-800 text-left",children:jsxRuntimeExports.jsxs("p",{className:"text-slate-300 text-sm leading-relaxed",children:["You're using the ",jsxRuntimeExports.jsx("strong",{children:"Progressive Web App"})," version of PWANS.",jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx("br",{}),"A ",jsxRuntimeExports.jsx("strong",{className:"text-amber-400",children:"native Android app"})," is available with ",jsxRuntimeExports.jsx("strong",{children:"hardware-backed KeyStore"})," security, providing better protection for your private keys.",jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx("br",{}),"Get it on ZapStore for the most secure experience."]})}),jsxRuntimeExports.jsxs("div",{className:"w-full space-y-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>window.open("https://zapstore.dev/apps?q=pwans","_blank"),className:"w-full py-2.5 bg-[#4A90D9] hover:bg-[#5BA0E9] text-white font-bold rounded-lg transition-colors",children:"Get on ZapStore"}),jsxRuntimeExports.jsx("button",{onClick:t,className:"w-full py-3 bg-slate-800 hover:bg-slate-700 text-white font-medium rounded-xl transition-colors",children:"Continue with PWA"})]})]})]})})};function registerSW(t={}){const{immediate:e=!1,onNeedRefresh:r,onOfflineReady:n,onRegistered:s,onRegisteredSW:o,onRegisterError:c}=t;let u,f,x;const p=async(y=!0)=>{await f,x?.()};async function g(){if("serviceWorker"in navigator){if(u=await __vitePreload(async()=>{const{Workbox:y}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:y}},[],import.meta.url).then(({Workbox:y})=>new y("./sw.js",{scope:"./",type:"classic"})).catch(y=>{c?.(y)}),!u)return;x=()=>{u?.messageSkipWaiting()};{let y=!1;const b=()=>{y=!0,u?.addEventListener("controlling",R=>{R.isUpdate&&window.location.reload()}),r?.()};u.addEventListener("installed",R=>{typeof R.isUpdate>"u"?typeof R.isExternal<"u"&&R.isExternal?b():!y&&n?.():R.isUpdate||n?.()}),u.addEventListener("waiting",b)}u.register({immediate:e}).then(y=>{o?o("./sw.js",y):s?.(y)}).catch(y=>{c?.(y)})}}return f=g(),p}function useRegisterSW(t={}){const{immediate:e=!0,onNeedRefresh:r,onOfflineReady:n,onRegistered:s,onRegisteredSW:o,onRegisterError:c}=t,[u,f]=reactExports.useState(!1),[x,p]=reactExports.useState(!1),[g]=reactExports.useState(()=>registerSW({immediate:e,onOfflineReady(){p(!0),n?.()},onNeedRefresh(){f(!0),r?.()},onRegistered:s,onRegisteredSW:o,onRegisterError:c}));return{needRefresh:[u,f],offlineReady:[x,p],updateServiceWorker:g}}const UpdatePrompt=()=>{const[t,e]=reactExports.useState(!1),[r,n]=reactExports.useState(!1),{needRefresh:[s,o],updateServiceWorker:c}=useRegisterSW({onRegistered(x){if(console.log("[PWA] Service Worker registered:",x),x&&(console.log("[PWA] Checking for updates immediately..."),x.update().catch(p=>console.error("[PWA] Update check failed:",p))),x){const p=setInterval(()=>{console.log("[PWA] Periodic update check..."),x.update().catch(g=>console.error("[PWA] Periodic update check failed:",g))},6e4);return()=>clearInterval(p)}},onRegisterError(x){console.error("[PWA] Service Worker registration error:",x)}});reactExports.useEffect(()=>{s&&(console.log("[PWA] Update available! Showing prompt..."),e(!0))},[s]);const u=async()=>{n(!0),e(!1),o(!1);try{if(c&&await c(!0),"serviceWorker"in navigator){const x=await navigator.serviceWorker.getRegistrations();for(const p of x)await p.unregister()}if("caches"in window){const x=await caches.keys();await Promise.all(x.map(p=>caches.delete(p)))}window.location.reload()}catch(x){console.error("[PWA] Update failed:",x),e(!0),n(!1)}},f=()=>{e(!1),o(!1)};return t?jsxRuntimeExports.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-md z-50 animate-slide-up",children:jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-amber-600 rounded-xl shadow-2xl border border-amber-400/20 p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0 mt-0.5",children:jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(RefreshCw,{className:"w-5 h-5 text-white"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"text-white font-bold text-sm mb-1",children:" New Version Available!"}),jsxRuntimeExports.jsx("p",{className:"text-amber-50 text-xs mb-3",children:"A new version of PWANS is ready. Reload to get the latest features and improvements."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs("button",{onClick:u,disabled:r,className:"flex-1 bg-white hover:bg-amber-50 text-amber-600 font-bold py-2 px-4 rounded-lg transition-colors text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[jsxRuntimeExports.jsx(RefreshCw,{className:`w-4 h-4 ${r?"animate-spin":""}`}),r?"Updating...":"Reload Now"]}),jsxRuntimeExports.jsx("button",{onClick:f,disabled:r,className:"bg-white/10 hover:bg-white/20 text-white font-medium py-2 px-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Dismiss",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]})]})})}):null};function App(){const{isUnlocked:t}=useAuthStore(),[e,r]=reactExports.useState(!1),[n,s]=reactExports.useState(!0);reactExports.useEffect(()=>{setNativeWalletUnlocked(t)},[t]),reactExports.useEffect(()=>{(async()=>{try{if(await get("disclaimer_accepted")){s(!1);return}const f=await get("wallet-storage");if(f)try{const x=JSON.parse(f);if(x.state&&x.state.wallets&&x.state.wallets.length>0){await set("disclaimer_accepted","true"),s(!1);return}}catch(x){console.error("Failed to parse wallet storage:",x)}r(!0)}catch(u){console.error("Error checking disclaimer status:",u)}finally{s(!1)}})()},[]);const o=async()=>{await set("disclaimer_accepted","true"),r(!1)};return n?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 text-amber-500 animate-spin"})}):e?jsxRuntimeExports.jsx(DisclaimerModal,{onAgree:o}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(PersistenceManager,{}),t?jsxRuntimeExports.jsx(Dashboard,{}):jsxRuntimeExports.jsx(Login,{}),jsxRuntimeExports.jsx(UpdatePrompt,{})]})}Capacitor.isNativePlatform()&&(document.documentElement.classList.add("native-app"),__vitePreload(async()=>{const{StatusBar:t,Style:e}=await import("./index-D7c4AeZI.js");return{StatusBar:t,Style:e}},[],import.meta.url).then(({StatusBar:t,Style:e})=>{t.setOverlaysWebView({overlay:!1}),t.setStyle({style:e.Dark}),t.setBackgroundColor({color:"#020617"})}).catch(console.error),__vitePreload(async()=>{const{startBackgroundService:t}=await Promise.resolve().then(()=>backgroundService);return{startBackgroundService:t}},void 0,import.meta.url).then(({startBackgroundService:t})=>{t().then(e=>{e&&console.log("[Native] Background service started for persistent connections")})}).catch(console.error));clientExports.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(App,{}));export{Buffer as B,Nip61Service as N,SecureStorage as S,NDKPrivateKeySigner as a,NDK as b,NDKEvent as c,getDefaultExportFromCjs$1 as g,process$1 as p,registerPlugin as r};
